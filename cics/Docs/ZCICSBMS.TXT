Z390/CICS Basic Mapping Support
===============================

This document outlines the extensions and facilities implemented in
Z390\CICS. Please refer to the IBM Manuals on BMS usage.

The documentation for EXEC CICS SEND MAP, RECEIVE MAP and SEND CONTROL
are in the Z390\CICS Application Programming Guide.

The following BMS facilities are not yet implemented:
   Support for devices outside the 3270 family
   Printers
   Extended Attributes and alternate screen size
   Dynamic Map Positioning
   Partitioning
   Paging

BMS Macros
----------

1) DFHMSD -- Mapset definition and termination

Although DFHMSD is optional it is recommended that one is coded.
A default set of values will be internally generated from the DFHMDI
macro if missing.

mapset  DFHMSD  TYPE=MAP/DSECT/FINAL
                MODE=IN/OUT/INOUT
                LANG=ASM
                CTRL=
                CURSLOC=YES/NO
                STORAGE=AUTO
                TIOAPFX=NO

Notes:
   LANG=ASM is the only option supported.
   TIOAPFX=YES is not supported.

Errors:
   A MAXIMUM OF 3 OPERANDS ALLOWED IN CTRL
   CANNOT HAVE MORE THAN ONE DFHMSD MACRO
   INVALID CURSLOC -- cursloc
   INVALID LANG -- lang
   INVALID MODE -- mode
   INVALID STORAGE -- storage
   INVALID TIOAPFX -- tioapfx
   INVALID TYPE -- type
   MAPSET NAME IS MISSING
   POSITIONAL OPERAND xxxx INVALID

2) DFHMDI -- Map definition

mapname DFHMDI  TYPE=MAP/DSECT
                MODE=IN/OUT/INOUT
                LANG=ASM
                CTRL=
                CURSLOC=YES/NO
                SIZE=(24,80)
                LINE=1
                COLUMN=1
                STORAGE=AUTO
                TIOAPFX=NO
Notes:
   TYPE, STORAGE and TIOAPFX are required here only if the DFHMSD macro
   is omitted.

   LANG=ASM is the only option supported.
   TIOAPFX=YES is not supported.

   Parameters TYPE, MODE, LANG, CTRL, CURSLOC, STORAGE, and TIOAPFX
   can all be omitted if the settings specified in DFHMSD are correct
   for this map.

   MODE may be specified as an override to DFHMSD.
   This facility is an extension.

   Any option(s) specified in CTRL will override all the options
   specified in DFHMSD.

   For LINE and COLUMN, only numeric parameters are supported.

Errors:
   A MAXIMUM OF 3 OPERANDS ALLOWED IN CTRL
   INVALID CTRL OPTION - ctrl
   INVALID CURSLOC -- cursloc
   INVALID MODE -- mode
   INVALID SIZE -- size
   INVALID TIOAPFX -- tioapfx
   MAPNAME IS MISSING
   MSD AND MDI TYPE MISMATCH
   POSITIONAL OPERAND xxxx INVALID

2) DFHMDF -- Field definition
fldname DFHMDF  POS=n/(n,n)
                LENGTH=
                ATTRB=
                JUSTIFY=
                INITIAL=
                XINIT=
                PICIN=
                PICOUT=
                OCCURS=
                GRPNAME=

Notes:
   If ATTRB is missing then ATTRB=(ASKIP,NORM) is assumed.
   If protection or intensity parameters are missing then a sensible
   default is assumed.

   A field specified as ATTRB=(UNPROT,NUM) will only accept digits
   0-9. Some 3270 models also allowed dots and commas.

   Extensive cross-checking is made, such that any 'unusual' map
   structure is flagged as an error. A peruse of the errors below give
   a good indication of these types of map structure.

Extensions:
   ATTRB=(ALPHA) has been added as the opposite of NUM

   XINIT=FF..
      The dots are replaced by a hex code of a fill character.
      This will generate an RA order to fill this field for its whole
      length.

      eg.
      Instead of coding INITIAL='__________'
      Code XINIT=FF6D

   PICIN and PICOUT
      Previously only available for COBOL and PL/I, it is now available
      for assembler.

      The parameter is (almost) a standard edit word with some
      restraints.

      Currently only numeric data can be subjected to PICIN/PICOUT.

      PICOUT...
         Operates for a SEND MAP, but not if MAPONLY is specified.
         Data is taken from the map structure and subjected to the
         edit word before being sent to the screen.

      PICIN...
         Operates for a RECEIVE MAP.
         The data received is subjected to the edit word and then
         passed to the application in the map structure.

         Note that the resulting data may no longer be numeric.

      The edit word has some strict rules at present. Suggested
      extensions are most welcome.

      The first hex pair must be 40, 5C, 5B or 4D (blank, asterisk,
      dollar, open bracket).
      Blank and asterisk are fill characters, dollar and open bracket
      are float characters.

      The remaining hex pairs can be 20 (digit select), 21 (significance
      starter), 4B (dot) or 6B (comma).

      The number of 20 and 21's must be odd.

      Examples...
         PICOUT=4020216B202020
         Data is 12345, displayed as   12,345

         PICOUT=5B20216B202020
         Data is 1234 , displayed as   $1,234

         PICOUT=5C20216B202020
         Data is 89,    displayed as  *****89

      PICIN is no different, just that it edits incoming data.

      If the data to be processed is not numeric after being PACKed,
      a MAPFAIL/8 condition is raised.

   IMG file
      For each TYPE=MAP generation, a mapname.IMG file is generated.
      This gives a symbolic picture of the resulting screen and can
      be used for planning map changes.

      See the file GUI6.IMG for a good example.

Errors:
   A MAXIMUM OF 2 OPERANDS ALLOWED IN JUSTIFY
   ADJACENT ATTRIBUTE AT POS nnn
   ATTRIBUTE CONFLICT - ALPHA AND NUM
   ATTRIBUTE CONFLICT - ASKIP AND ALPHA
   ATTRIBUTE CONFLICT - ASKIP AND NUM
   ATTRIBUTE CONFLICT - ASKIP AND PROT
   ATTRIBUTE CONFLICT - ASKIP AND UNPROT
   ATTRIBUTE CONFLICT - BRT AND DRK
   ATTRIBUTE CONFLICT - BRT AND NORM
   ATTRIBUTE CONFLICT - NORM AND DRK
   ATTRIBUTE CONFLICT - PROT AND UNPROT
   BAD LENGTH - length
   BOTH INITIAL AND XINIT ARE SPECIFIED
   CONFLICTING JUSTIFY PARMS
   GRPNAME AND OCCURS ARE SPECIFIED
   GRPNAME SPECIFIED WITHOUT FLDNAME
   IC ATTRIBUTE HAS OCCURRED IN ANOTHER MDF MACRO
   INITIAL/XINIT IS GREATER THAN LENGTH
   INITIAL/XINIT IS INVALID WITH LENGTH=0
   INVALID ATTRB OPTION - attrb
   INVALID JUSTIFY OPTION - justify
   INVALID OCCURS - occurs
   INVALID POS - pos
   JUSTIFY CONFLICT - BLANK AND ZERO
   JUSTIFY CONFLICT - LEFT AND RIGHT
   LENGTH=0 IS INVALID FOR NAMED FIELD
   PICIN/PICOUT CAN ONLY BE SPECIFIED FOR A NAMED FIELD
   PICIN/PICOUT HAS ODD NUMBER OF HEX DIGITS
   PICIN/PICOUT HEX LENGTH NOT EQUAL TO LENGTH
   PICIN/PICOUT IS INVALID
   PICIN/PICOUT: 1ST PAIR NOT 40, 5C, 5B, 4D
   PICIN/PICOUT: NUMBER OF 20/21 IS NOT ODD
   POS nnn OVERLAPS WITH ANOTHER FIELD
   POS COLUMN+LENGTH EXCEEDS DEFINED MAP SIZE
   POS EXCEEDS DEFINED MAP SIZE
   POS HAS TOO MANY PARAMETERS
   POSITIONAL OPERAND xxxx INVALID
   SINGLE POS EXCEEDS DEFINED MAP SIZE
   SPECIAL FORMAT XINIT CANNOT BE SPECIFIED IF LENGTH IS LESS THAN 8
   UNNAMED FIELD HAS UNPROT OR FSET, INPUT DATA CANNOT BE MAPPED
   XINIT HAS ODD NUMBER OF HEX DIGITS

The following errors occur owing to internal limits.
Please report them.

   AN INTERNAL ERROR HAS OCCURRED
   ERROR IN ATTRIBUTE TABLE nnnn

   AN INTERNAL ERROR HAS OCCURRED
   MAPSIZE TOO LARGE - nnnn

   AN INTERNAL ERROR HAS OCCURRED
   PICIN/PICOUT LENGTH GREATER THAN 50 BYTES

Map generation
--------------
See the sample MAP01.BAT.
This generates the TYPE=DSECT (MAP01.CPY) and the TYPE=MAP (MAP01.390).

As the program name is the same, the TYPE=DSECT assembler output is
renamed mapset.PR1.

Change Summary
--------------

Trademarks
----------
IBM, CICS and VSAM are registered trademarks of International Business
Machines Corporation.

Author: Melvyn Maltz
Shipping Date: June 27, 2008
Z390 version: V1.4.02
Z390/CICS version: V5
