Storage services
================

Register usage
--------------
These macros may use the following general registers:

GR 0, 1, 14
GR 15  return code

--SVC--   FUNCTION
DEC HEX
  4  04   GETMAIN
  5  05   FREEMAIN

Documentation
-------------
GETMAIN type,LV=,LOC=
   Acquire storage

   type is mandatory
      R   Obtain storage unconditionally.
          The default location is below 16M.
          If the storage is not available an abend S80A will occur.

      RC  Obtain storage conditionally.
          The default location is above 16M.
          The return code indicates whether the acquisition
          was successful.

      RU  Obtain storage unconditionally.
          The default location is above 16M.
          If the storage is not available an abend S80A will occur.

   LV= is mandatory
      LV=n       Obtain n bytes  (maximum value of n is 2G-1)
      LV=nK      Obtain nK bytes (maximum value of n is 2097151)
      LV=nM      Obtain nM bytes (maximum value of n is 2047)
      LV=(reg)   Length required is in GR reg

      Note: All storage requests will be rounded up to the next
            8-byte boundary and is not initialised.

   LOC= is optional
      If omitted, type R will default to LOC=ABOVE, types RC and RU
      will default to LOC=BELOW.
      LOC=BELOW  Try to acquire storage below 16M.
      LOC=ABOVE  Try to acquire storage above 16M.
      Also see 'Advanced topics' below

   Return Codes in GR 15:
      0  Successful completion
      4  Conditional request unsuccessful

   After a successful completion GR 0 will contain the address of
   the acquired storage.

   Examples:
   Getmain 1024 bytes below 16M, unconditionally
      GETMAIN R,LV=1024

   Getmain number of bytes in GR 3 below 16M, conditionally,
      GETMAIN RC,LV=(R3),LOC=BELOW

   Advanced topics:
      Storage is limited by the MEM(nnn) parameter on CALL EZ390,
      with nnn in Megabytes. The default is MEM(1).
      When the value is 16 or less then all GETMAINs will allocate
      storage LOC=BELOW. When the value is above 16, then 16M is
      available LOC=BELOW and the rest LOC=ABOVE.

      There is a preset maximum of MEM(50) set by Java.

      If this is insufficient, then code -Xmx nnnnnnnnn after the -Xrs
      option on CALL EZ370 to extend the MEM limit.
      WARNING: Over-extending memory this way may degrade the
               performance of your operating system (eg. Windows).

FREEMAIN LV=,A=
   Free storage

   LV= is mandatory
      LV=n       Free n bytes  (maximum value of n is 2G-1)
      LV=nK      Free nK bytes (maximum value of n is 2097151)
      LV=nM      Free nM bytes (maximum value of n is 2047)
      LV=label   The location of a 4-byte length
      LV=(reg)   Length to be freed is in GR reg.

   A= is optional
      If A= is omitted then GR 0 must contain the address of the
      storage to be freed.
      A=label  The location of the 4-byte address of the storage to
               be freed.
      A=(reg)  Address of the storage to be freed is in GR reg

   Note: A section of a previous GETMAIN may be freed. It is the
   programmer's responsibility to manage the resulting fragmentation.

Author: Melvyn Maltz
Publication date: Jan 15, 2006
Z390 version: V1.0.10
