         PRINT NOGEN                                                    00002000
TSSINSTX TITLE 'TOP SECRET SECURITY VERSION 3 - SITE SECURITY EXIT'     00003000
*--------------------------------------------------------------------*  00004000
*                                                                    *  00005000
*                                                                    *  00006000
*     MODULE  -  TSSINSTX        VERSION 3.0                         *  00007000
*                                                                    *  00008000
*                                                                    *  00009000
*   FUNCTION  -  TOP SECRET SECURITY / INSTALLATION EXIT             *  00010000
*                ALLOWS SITE TO INTERFACE WITH TOP SECRET            *  00011000
*                SECURITY VALIDATION INVOKED FROM SECURITY           *  00012000
*                SVC'S CALLS. FRACHECK CALL ONLY VALID FOR           *  00013000
*                THE VIOLATION ENTRY.                                *  00014000
*                                                                    *  00015000
*                                                                    *  00016000
*     METHOD  -  EXIT IS CALLED FOR SPECIFIC FUNCTION IF THAT        *  00017000
*                FUNCTION IS ACTIVE. BYTE-MATRIX OF ACTIVE FUNCTIONS *  00018000
*                MUST BE MAINTAINED BY THE CUSTOMER AT THE LABEL     *  00019000
*                'MATRIX'. IF THE RESPECTIVE FUNCTION BYTE IS SET    *  00020000
*                TO ZERO (######NO) THEN THE EXIT WILL NOT BE CALLED *  00021000
*                TO PROCESS THAT FUNCTION.                           *  00022000
*                                                                    *  00023000
*                                                                    *  00024000
*     INPUTS  -  REGISTER 1 POINTS TO PARAMETER LIST (SEE BELOW)     *  00025000
*                                                                    *  00026000
*                                                                    *  00027000
*     OUTPUT  -  REGISTER 15 CONTAINS RETURN CODE    (SEE BELOW)     *  00028000
*                REGISTERS 2-12 MUST BE RESTORED PRIOR TO EXITTING   *  00029000
*                                                                    *  00030000
*                                                                    *  00031000
*    LINKAGE  -  REGISTER 13 -> 72 BYTE SAVEAREA & 100 BYTE WORKAREA *  00032000
*                REGISTER 14 -> RETURN ADDRESS                       *  00033000
*                REGISTER 15 -> TSSINSTX EPA                         *  00034000
*                                                                    *  00035000
*                                                                    *  00036000
* ATTRIBUTES  -  ENTERED KEY ZERO, SUPERVISOR STATE (BE CAREFUL !)   *  00037000
*                                                                    *  00038000
*                                                                    *  00039000
*      A-MODE -  DEPENDENT UPON THE CALLER. CAN BE ENTERED IN BOTH   *  00040000
*                24- AND 31-BIT MODE ON AN MVS/XA SYSTEM.            *  00041000
*                                                                    *  00042000
*                                                                    *  00043000
*      R-MODE -  BELOW THE 24-BIT LINE.                              *  00044000
*                                                                    *  00045000
*                                                                    *  00046000
*      NOTES  -  1. MODULE SHOULD RESIDE IN TOP SECRET LIBRARY       *  00047000
*                2. F TSS,EXIT( OFF|ON )   (DE)ACTIVATES THIS CODE   *  00048000
*                3. CAN ISSUE ANY SVC INCLUDING RACHECK              *  00049000
*                4. FESTAE IN CONTROL TO TRAP ABENDS                 *  00050000
*                5. RUNNING UNDER SVC FOR RACINIT/RACHECK/RACDEF     *  00051000
*                6. RUNNING IN REQUESTOR'S ADDRESS SPACE             *  00052000
*                7. ESTABLISH REG 13 SAVEAREA AS REQUIRED            *  00053000
*                                                                    *  00054000
*                                                                    *  00055000
*                                                                    *  00056000
*--------------------------------------------------------------------*  00057000
         EJECT                                                          00058000
*--------------------------------------------------------------------*  00059000
* INPUT          | FOR A DESCRIPTION OF THE INCOMING PARAMETER LIST  *  00060000
*                | SEE THE DSECT BELOW.                              *  00061000
*                |                                                   *  00062000
*                |                                                   *  00063000
*--------------------------------------------------------------------*  00064000
         EJECT                                                          00065000
*-----------------------------------------------------------------*     00066000
*                 TSSINSTX RETURN CODES                           *     00067000
*-----------------------------------------------------------------*     00068000
         SPACE                                                          00069000
*-----------------------------------------------------------------*     00070000
* OUTPUT         | REGISTER 15 MUST CONTAIN A VALID RETURN CODE   |     00071000
*                | (RC) THAT WILL INDICATE FURTHER ACTION         |     00072000
*                | TO BE PERFORMED BY TOP SECRET:                 |     00073000
*                | FOR JOB INIT CHECKS:                           |     00074000
*                |         RC=00  CONTINUE NORMAL VALIDATION      |     00075000
*                |         RC=04  FAIL INITIATION                 |     00076000
*                |         RC=08  BYPASS SECURITY FOR JOB         |     00077000
*                |         RC=12  CONTINUE WITHOUT FURTHER CHECKS |     00078000
*                |         RC=16  RETRY REQUEST (UNDEFINED ONLY)  |     00079000
*                |         RC=20  CONTINUE WITHOUT PASSWORD CHECK |     00080000
*                |         RC=24  RESERVED                        |     00081000
*                |         RC=28  RESERVED                        |     00082000
*                | FOR VOLUME, DATASET & RESOURCE CHECKS:         |     00083000
*                |         RC=00  CONTINUE WITH NORMAL CHECKING   |     00084000
*                |         RC=04  FAIL THE ATTEMPT                |     00085000
*                |         RC=08  ACCESS GRANTED; DO NOT PERFORM  |     00086000
*                |                ANY FURTHER CHECKING            |     00087000
*                | FOR TSS COMMAND CHECKS:                        |     00088000
*                |         RC=00  CONTINUE WITH NORMAL CHECKING   |     00089000
*                |         RC=04  FAIL THE ATTEMPT                |     00090000
*                | FOR INTERNAL READER SUBMISSION CHECKS:         |     00091000
*                |         RC=00  CONTINUE WITH NORMAL CHECKING   |     00092000
*                |         RC=04  FAIL THE ATTEMPT                |     00093000
*----------------+------------------------------------------------+     00094000
         EJECT                                                          00095000
* NOTE THAT THE EXIT WILL NOT BE ACTIVATED IF THE FIRST SECTION HAS     00096000
* BEEN INCORRECTLY MODIFIED. DO NOT INSERT OR DELETE STATEMENTS         00097000
* FROM THIS POINT UNTIL LABEL 'PREINIT'. ONLY CHANGE THE MATRIX.        00098000
*                                                                       00099000
TSSINSTX CSECT                  DO NOT INSERT OR DELETE STATEMENTS HERE 00100000
         B     START-TSSINSTX(R15) NOT INSERT OR DELETE STATEMENTS HERE 00101000
*                               DO NOT INSERT OR DELETE STATEMENTS HERE 00102000
         DC    AL1(24)          DO NOT INSERT OR DELETE STATEMENTS HERE 00103000
         DC    C'TSSINSTX'      DO NOT INSERT OR DELETE STATEMENTS HERE 00104000
         DC    C'V3L0M000'      DO NOT INSERT OR DELETE STATEMENTS HERE 00105000
         DC    C'&SYSDATE'      DO NOT INSERT OR DELETE STATEMENTS HERE 00106000
*                                                                       00107000
         MNOTE *,'ACTIVATE EXIT FUNCTIONS BY CHANGING NO TO YES IN MATR.00108000
               IX BELOW'                                                00109000
*                                                                       00110000
MATRIX   DC    CL8'MATRIX'      DO NOT INSERT OR DELETE STATEMENTS HERE 00111000
*                                                                       00112000
#####YES EQU   255              FUNCTION IS ACTIVE                      00113000
######NO EQU   000              FUNCTION IS NOT ACTIVE                  00114000
*                                                                       00115000
         DC    AL1(#####YES) 00 PRE-INIT                                00116000
         DC    AL1(######NO) 04 VOLUME ACCESS VALIDATION                00117000
         DC    AL1(######NO) 08 DATASET VALIDATION                      00118000
         DC    AL1(######NO) 12 RESOURCE VALIDATION                     00119000
         DC    AL1(#####YES) 16 TSS COMMAND                             00120000
         DC    AL1(######NO) 20 ADDRESS SPACE TERMINATION               00121000
         DC    AL1(######NO) 24 POST-INIT                               00122000
         DC    AL1(######NO) 28 UNDEFINED ACID                          00123000
         DC    AL1(######NO) 32 NEW PASSWORD VERIFICATION               00124000
         DC    AL1(######NO) 36 TERMINAL I/O                            00125000
         DC    AL1(######NO) 40 SESSION TERMINATION                     00126000
         DC    AL1(######NO) 44 ONLINE (INTRDR) JOB SUBMISSION          00127000
         DC    AL1(######NO) 48 SECURITY FILE CHANGE                    00128000
         DC    AL1(#####YES) 52 ACTION(EXIT)                            00129000
         DC    AL1(######NO) 56 MESSAGE EDITTING                        00130000
         DC    AL1(######NO) 60 RESERVED-0                              00131000
         DC    AL1(######NO) 64 VIOLATION NOTIFICATION                  00132000
         DC    AL1(#####YES) 68 SITE VIA RACHECK CLASS='INSTEXIT'       00133000
         DC    AL1(#####YES) 72 COMMAND BEING SENT TO REMOTE TSS        00134000
         DC    AL1(######NO) 76 RESERVED-2                              00135000
         DC    AL1(######NO) 80 RESERVED-3                              00136000
         DC    AL1(######NO) 84 RESERVED-4                              00137000
         DC    AL1(######NO) 88 RESERVED-5                              00138000
         DC    AL1(######NO) 92 RESERVED-6                              00139000
         DC    AL1(######NO) 96 RESERVED-7                              00140000
         EJECT                                                          00141000
START    STM   R14,R12,12(R13)  PRESERVE REGISTERS IN PROVIDED SAVEAREA         
         LR    R12,R15        ESTABLISH ADDRESSABILITY                  00143000
         USING TSSINSTX,R12   FOR INSTALLATION EXIT                     00144000
         LR    R9,R1          ESTABLISH ADDRESSABILITY                  00145000
         USING TSSXPARM,R9    WITH INCOMING PARAMETERS                  00146000
         LA    R10,84(R13)    ESTABLISH ADDRESSABILITY                  00147000
         USING WORKAREA,R10   WITH WORKAREA (MAX LEN 100 BYTES)         00148000
         SPACE 3                                                        00149000
         MNOTE *,'REGISTER 13 CANNOT BE USED AS A SAVEAREA ASIS'        00150000
         SPACE 3                                                        00151000
         L     R1,TXAFUNC     PICK UP ...                               00152000
         L     R1,0(R1)       FUNCTION CODE                             00153000
         B     *+4(R1)        PROCESS ACCORDING TO FUNCTION:            00154000
         B     PREINIT     00 JOB/SESSION PRE-INITIATION                00155000
         B     VOLUME      04 VOLUME ACCESS VALIDATION                  00156000
         B     DATASET     08 DATASET ACCESS VALIDATION                 00157000
         B     RESOURCE    12 RESOURCE ACCESS VALIDATION                00158000
         B     COMMAND     16 TSS COMMAND USE VALIDATION                00159000
         B     TERM        20 JOB (ADDRESS SPACE) TERMINATION           00160000
         B     POSTINIT    24 JOB/SESSION INITIATION COMPLETE           00161000
         B     UNDEFIND    28 UNDEFINED ACID ENTRY                      00162000
         B     PASSWORD    32 PASSWORD CHANGE ENTRY                     00163000
         B     IO          36 VOICE OR DIGITIZED IMAGE REQUEST          00164000
         B     SESSEND     40 SESSION (USER) TERMINATION                00165000
         B     SUBMIT      44 INTERNAL READER SUBMISSION                00166000
         B     CHANGE      48 SECURITY FILE CHANGE                      00167000
         B     ACTION      52 PERMIT ACTION(EXIT)                       00168000
         B     MESSAGE     56 MESSAGE EDITING                           00169000
         B     EXIT0       60 FUTURE USE                                00170000
         B     VIOLATN     64 VIOLATION DETECTED                        00171000
         B     SITE        68 RACHECK CLASS=INSTEXIT                    00172000
         B     CPF         72 CMD BEING SENT TO REMOTE TSS     V4L3M000 00173000
         B     EXIT0       76 FUTURE USE                                00174000
         B     EXIT0       80 FUTURE USE                                00175000
         B     EXIT0       84 FUTURE USE                                00176000
         B     EXIT0       88 FUTURE USE                                00177000
         B     EXIT0       92 FUTURE USE                                00178000
         B     EXIT0       96 FUTURE USE                                00179000
         EJECT                                                          00180000
*                                                                       00181000
* EXIT POINTS                                                           00182000
*                                                                       00183000
EXIT0    SLR   R15,R15        CONTINUE NORMALLY                         00184000
         B     EXIT                                                     00185000
EXIT4    LA    R15,4          FAIL REQUEST                              00186000
         B     EXIT                                                     00187000
EXIT8    LA    R15,8          CONTINUE WITHOUT FURTHER CHECKING         00188000
         B     EXIT                                                     00189000
EXIT12   LA    R15,12         BYPASS                                    00190000
         B     EXIT                                                     00191000
EXIT16   LA    R15,16         RETRY UNDEFINED WITH NEW ACID             00192000
         B     EXIT                                                     00193000
EXIT20   LA    R15,20         CONTINUE WITHOUT PASSWORD CHECK           00194000
         B     EXIT                                                     00195000
EXIT24   LA    R15,24         RESERVED                                  00196000
         B     EXIT                                                     00197000
EXIT28   LA    R15,28         RESERVED                                  00198000
         B     EXIT                                                     00199000
EXIT32   LA    R15,32         RESERVED                                  00200000
         B     EXIT                                                     00201000
*                                                                       00202000
* STANDARD TERMINATION IF REGISTER 13 HAS NOT BEEN ALTERED              00203000
*                                                                       00204000
EXIT     L     R14,12(R13)                                                      
         LM    R0,R12,20(R13)                                                   
         BR    R14                                                              
         SPACE 5                                                        00207000
         MNOTE *,'SITE-WRITTEN CODE GOES ANYWHERE AFTER THIS POINT'     00208000
         EJECT                                                          00209000
*---------------------------------------------------------------------* 00210000
* PROCESS JOB/SESSION PRE-INITIATION                                  * 00211000
*---------------------------------------------------------------------* 00212000
         SPACE                                                          00213000
PREINIT  DS    0H                                                       00214000
* USER CODE GOES HERE TO INTERPRET INITIATION                           00215000
* THIS IS INVOKED PRIOR TO OBTAINING ACID SECURITY RECORD FROM TSS      00216000
* ONLY JOBNAME, ACID, TERMINAL, PASSWORD(S), INSTDATA, MODE,            00217000
* MAY BE CHANGED                                                        00218000
         B     EXIT0                                                    00219000
         EJECT                                                          00220000
*---------------------------------------------------------------------* 00221000
* PROCESS JOB/SESSION POST-INITATION                                  * 00222000
*---------------------------------------------------------------------* 00223000
         SPACE                                                          00224000
POSTINIT DS    0H                                                       00225000
* USER CODE GOES HERE TO INTERPRET INITIATION                           00226000
* THIS IS INVOKED AFTER OBTAINING ACID SECURITY RECORD FROM TSS         00227000
* INITIATION IS CONSIDERED COMPLETELY SUCCESSFUL AT THIS POINT          00228000
* ONLY DETAIL ERROR REASON CODE, INSTDATA, MODE MAY BE CHANGED          00229000
         B     EXIT0                                                    00230000
         EJECT                                                          00231000
*---------------------------------------------------------------------* 00232000
* PROCESS JOB TERMINATION                                             * 00233000
*---------------------------------------------------------------------* 00234000
         SPACE                                                          00235000
TERM     DS    0H                                                       00236000
* USER CODE GOES HERE TO PROCESS TERMINATION OF ADDRESS SPACE           00237000
* NO CHANGES ACCEPTED                                                   00238000
         B     EXIT0                                                    00239000
         SPACE 10                                                       00240000
*---------------------------------------------------------------------* 00241000
* PROCESS SESSION TERMINATION                                         * 00242000
*---------------------------------------------------------------------* 00243000
         SPACE                                                          00244000
SESSEND  DS    0H                                                       00245000
* USER CODE GOES HERE TO PROCESS ON-LINE USER SESSION SIGNOFF           00246000
* NO CHANGES ACCEPTED                                                   00247000
         B     EXIT0                                                    00248000
         EJECT                                                          00249000
*---------------------------------------------------------------------* 00250000
* PROCESS UNDEFINED ACID                                              * 00251000
*---------------------------------------------------------------------* 00252000
         SPACE                                                          00253000
UNDEFIND DS    0H                                                       00254000
* USER CODE GOES HERE TO PROCESS UNDEFINED ACID                         00255000
* THIS IS INVOKED AFTER CALLING TSS ADDRESS SPACE                       00256000
* AND AFTER TRYING TO USE ANY DEFAULT ACID ASSIGNMENT                   00257000
* ONLY JOBNAME, ACID, TERMINAL, PASSWORD(S), INSTDATA,                  00258000
*      DETAIL ERROR REASON CODE, MODE        MAY BE CHANGED             00259000
* SET R15=16 TO RETRY REQUEST WITH NEW ACID (CHANGE ACID)               00260000
         B     EXIT0                                                    00261000
         EJECT                                                          00262000
*---------------------------------------------------------------------* 00263000
* PASSWORD CHANGE                                                     * 00264000
*---------------------------------------------------------------------* 00265000
         SPACE                                                          00266000
PASSWORD DS    0H                                                       00267000
* USER CODE GOES HERE TO EXAMINE/VALIDATE PASSWORD                      00268000
* YOU CANNOT ALTER PASSWORDS HERE - USE PREINIT FOR THIS FUNCTION       00269000
* SET R15=04 TO REJECT PASSWORD AND FAIL INITIATION                     00270000
         B     EXIT0                                                    00271000
         EJECT                                                          00272000
*---------------------------------------------------------------------* 00273000
* PROCESS TERMINAL I/O OPERATIONS                                     * 00274000
*---------------------------------------------------------------------* 00275000
         SPACE                                                          00276000
IO       DS    0H                                                       00277000
* USER CODE GOES HERE TO PROVIDE VARIOUS TERMINAL CONTROL SEQUENCES     00278000
* FOR CLEARING SCREENS, INHIBITING PRINT DISPLAY, RESTORING PRINT,      00279000
* PROMPTING FOR DATA, BUILDING LOGON MENUS.                             00280000
         B     EXIT0                                                    00281000
* HERE TO CAUSE SCREEN TO BE CLEARED, IF APPROPRIATE                    00282000
CLEAR    NOP   0                                                        00283000
         B     EXIT0                                                    00284000
* HERE TO BUILD LOGON SCREEN, IF REQUIRED                               00285000
SCREEN   NOP   0                                                        00286000
         B     EXIT0                                                    00287000
* HERE TO INHIBIT PRINT DISPLAY                                         00288000
INHIBIT  DS    0H                                                       00289000
         B     EXIT0                                                    00290000
* TWX BLOT FOR HIDING PASSWORDS USING TEXT AND BACKSPACES               00291000
BLOT     DC    X'0D15'                                                  00292000
         DC    17C'*',17X'16'                                           00293000
         DC    17C'M',17X'16'                                           00294000
         DC    17C'E',17X'16'                                           00295000
LBLOT    EQU   *-BLOT                                                   00296000
* HERE TO RESTORE PRINT DISPLAY                                         00297000
RESTORE  DS    0H                                                       00298000
         B     EXIT0                                                    00299000
         SPACE 5                                                        00300000
*---------------------------------------------------------------------* 00301000
* OBTAIN VOICE OR OTHER DIGITIZED IMAGE USER IDENTIFICATION           * 00302000
*---------------------------------------------------------------------* 00303000
         SPACE                                                          00304000
VOICE    DS    0H                                                       00305000
* USER CODE GOES HERE TO PROMPT USER FOR VOICE/IMAGE IDENTIFICATION     00306000
* RETURN VOICE/IMAGE PATTERN IN AREA ADDRESSED BY TXAIVBFR              00307000
* NO OTHER INPUT PARAMETERS ARE APPLICABLE                              00308000
*                                                                       00309000
         L     R2,TXAIVBFR          -> IMAGE RETURN AREA                00310000
         B     EXIT0                                                    00311000
SMARTCRD DS    0H                                                       00312000
*                                                                       00313000
* Additionaly, this exit point may be used to prompt users for          00314000
* and verify "smart-cards". The return codes from this exit point       00315000
* are:                                                                  00316000
*                                                                       00317000
*  $IOKAY   (Continue normally)                                         00318000
*  $IFAIL   (Fail based upon smart-card)                                00319000
*  $INOPWCK (Skip password validation based upon smart-card)            00320000
*                                                                       00321000
         ICM   R1,15,TXAIPKY        -> Physkey data                     00322000
         BZ    EXIT0                None - Return                       00323000
         L     R2,TXAIPKL           -> Physkey data length              00324000
         B     EXIT0                                                    00325000
         EJECT                                                          00326000
*---------------------------------------------------------------------* 00327000
* PROCESS VOLUME VALIDATION                                           * 00328000
*---------------------------------------------------------------------* 00329000
         SPACE                                                          00330000
VOLUME   DS    0H                                                       00331000
* USER CODE GOES HERE TO INTERPRET VOLUME ACCESS                        00332000
* ONLY ACCESS, VOLSER (,DATASET) SHOULD BE CHANGED                      00333000
         B     EXIT0                                                    00334000
         EJECT                                                          00335000
*---------------------------------------------------------------------* 00336000
* PROCESS DATASET VALIDATION                                          * 00337000
*---------------------------------------------------------------------* 00338000
         SPACE                                                          00339000
DATASET  DS    0H                                                       00340000
* USER CODE GOES HERE TO INTERPRET DATASET ACCESS                       00341000
* ONLY ACCESS, DSNAME, VOLSER SHOULD BE CHANGED                         00342000
         B     EXIT0                                                    00343000
         EJECT                                                          00344000
*---------------------------------------------------------------------* 00345000
* PROCESS RESOURCE VALIDATION                                         * 00346000
*---------------------------------------------------------------------* 00347000
         SPACE                                                          00348000
RESOURCE DS    0H                                                       00349000
* USER CODE GOES HERE TO INTERPRET RESOURCE ACCESS                      00350000
* ONLY ACCESS, RESOURCE TYPE, RESOURCE-NAME SHOULD BE CHANGED           00351000
         MNOTE *,'RESOURCE CHECK CALLED IN USER KEY NOT KEY 0'          00352000
         MNOTE *,'WORKAREA IS ONLY 64 BYTES LOG FOR RESOURCE CALL'      00353000
         B     EXIT0                                                    00354000
         EJECT                                                          00355000
*---------------------------------------------------------------------* 00356000
* PROCESS TSS COMMAND VALIDATION                                      * 00357000
*---------------------------------------------------------------------* 00358000
         SPACE                                                          00359000
COMMAND  DS    0H                                                       00360000
* USER CODE GOES HERE TO INTERPRET TSS COMMAND USAGE                    00361000
* TXACTGTS CAN BE USED TO DETERMINE THE MACHINE OF ORIGIN WHEN V4L3M000 00362000
* CPF IS IN USE.  TXACTGTS = 0 INDICATES THE COMMAND           V4L3M000 00363000
* ORIGINATED ON THE LOCAL MACHINE.  IF TXACTGTS > 0, THEN IT   V4L3M000 00364000
* POINTS TO THE 8-CHAR NODE NAME OF THE ORIGINATING MACHINE.   V4L3M000 00365000
         WTO   'TSSINSTX COMMAND LOGIC 3'                               00366000
         B     EXIT0                                                    00367000
         EJECT                                                          00368000
*---------------------------------------------------------------------* 00369000
* PROCESS INTERNAL READER SUBMISSION                                  * 00370000
*---------------------------------------------------------------------* 00371000
         SPACE                                                          00372000
SUBMIT   DS    0H                                                       00373000
* USER CODE GOES HERE TO PROCESS JOB SUBMISSION.                        00374000
* ONLY THE ACID BEING SUBMITTED MAY BE CHANGED.                         00375000
         B     EXIT0                                                    00376000
         EJECT                                                          00377000
*---------------------------------------------------------------------* 00378000
* MESSAGE EDITING                                                     * 00379000
*---------------------------------------------------------------------* 00380000
         SPACE                                                          00381000
MESSAGE  DS    0H                                                       00382000
* USER CODE GOES HERE                                                   00383000
* CONTENTS OF MESSAGE BUFFER CAN BE CHANGED.                            00384000
* NOTE THAT CONSOLE DESCRIPTOR & ROUTE CODES FOLLOW THE TEXT.           00385000
* MAXIMUM LENGTH SHOULD BE 100 BYTES.                                   00386000
         L     R2,TXA#MBUF        -> MESSAGE BUFFER IN WTO FORMAT       00387000
         B     EXIT0                                                    00388000
         EJECT                                                          00389000
*---------------------------------------------------------------------* 00390000
* PROCESS SECURITY FILE CHANGE                                        * 00391000
*---------------------------------------------------------------------* 00392000
         SPACE                                                          00393000
CHANGE   DS    0H                                                       00394000
* USER CODE GOES HERE                                                   00395000
* CONTENTS OF CHANGE BUFFER MUST NOT BE ALTERED                         00396000
* USE THIS EXIT CALL TO PROPOGATE CHANGES TO MULTIPLE SITES.            00397000
         L     R2,TXA#RBUF        -> IMAGE BUFFER                       00398000
         B     EXIT0                                                    00399000
         EJECT                                                          00400000
*---------------------------------------------------------------------* 00401000
* PROCESS PERMIT ACTION(EXIT) OR RACHECK CLASS='INSTEXIT'             * 00402000
*---------------------------------------------------------------------* 00403000
         SPACE                                                          00404000
ACTION   DS    0H                                                       00405000
* USER CODE GOES HERE TO HANDLE SPECIAL REQUIREMENTS                    00406000
         L     R2,TXA#XE          -> EXTENSION ELEMENT                  00407000
         B     EXIT0                                                    00408000
         EJECT                                                          00409000
*---------------------------------------------------------------------* 00410000
* VIOLATION DETECTED.                                                 * 00411000
*---------------------------------------------------------------------* 00412000
         SPACE                                                          00413000
VIOLATN  DS    0H                                                       00414000
* USER CODE GOES HERE TO EXAMINE VIOLATION                              00415000
         B     EXIT0                                                    00416000
         EJECT                                                          00417000
*---------------------------------------------------------------------* 00418000
* SITE RACHECK CLASS=INSTEXIT,ENTITY=CODE+DATA                        * 00419000
*---------------------------------------------------------------------* 00420000
         SPACE                                                          00421000
SITE     DS    0H                                                       00422000
* USER CODE GOES HERE FOR SPECIAL CUSTOMIZATION                         00423000
         L     R2,TXA#DATA        -> ENTITY FROM RACHECK SVC            00424000
         B     EXIT0                                                    00425000
         EJECT                                                          00426000
*---------------------------------------------------------------------* 00427000
* PROCESS OUTBOUND COMMANDS                                    V4L3M000 00428000
*---------------------------------------------------------------------* 00429000
         SPACE                                                          00430000
CPF      DS    0H                                                       00431000
* USER CODE GOES HERE TO PROCESS COMMANDS TO BE SENT TO ANOTHER TSS     00432000
* NODE VIA CPF (COMMAND PROPOGATION FACILITY).                          00433000
* -> TXACTGTS IDENTIFIES THE TARGETED MACHINE(S).  IT POINTS TO A CHAIN 00434000
*    OF ELEMENTS WHOSE FORMAT IS DEFINED BY DSECT $$CPFTGT.             00435000
*        L     REG1,TXACTGTS      GET A(TARGET DATA)                    00436000
*        USING $$CPFTGT,REG1                                            00437000
* -> THE USER CAN CHANGE INDIVIDUAL TARGET NODE NAMES OR CAUSE A GIVEN  00438000
*    ENTRY TO BE IGNORED BY TURNING OFF $$CTFLG1,$$CTUSE.               00439000
* -> THE ENTIRE COMMAND CAN BE REJECTED BY PASSING BACK RC=4.           00440000
* -> BESIDE TXACTGTS, THE ONLY PARAMETERS THAT CONTAIN VALID DATA       00441000
*    AT THIS CALL ARE: TXACCACI (ISSUER'S ACID NAME), TXACTYPE          00442000
*    (ISSUER'S ACID TYPE), TXACCUBF (ADDRESS OF RAW COMMAND BUFFER),    00443000
*    TXACFUNC (COMMAND FUNCTION).                                       00444000
*                                                                       00445000
         WTO   'TSSINSTX: CPF LOGIC ENTERED'                            00446000
*                                                                       00447000
         L     R2,TXACFUNC          Address function code               00448000
*                                                                       00449000
         CLI   0(R2),TXACLIST       CPF of "LIST" cmd ?                 00450000
         BE    FORCELCL             Yes, Force local                    00451000
         CLI   0(R2),TXACWHOA       CPF of "WHOAMI" cmd ?               00452000
         BE    FORCELCL             Yes, Force local                    00453000
         CLI   0(R2),TXACHAS        CPF of "WHOHAS" cmd ?               00454000
         BE    FORCELCL             Yes, Force local                    00455000
         CLI   0(R2),TXACWHO        CPF of "WHOOWNS" cmd ?              00456000
         BE    FORCELCL             Yes, Force local                    00457000
*                                                                       00458000
         B     EXIT0                None of these, leave asis           00459000
*                                                                       00460000
FORCELCL DS    0H                   Force local                         00461000
         ICM   R3,15,TXACTGTS       Get target node list?               00462000
         BZ    EXIT0                None, leave asis                    00463000
         USING $$CPFTGT,R3          Map CPF Target(s)                   00464000
         L     R4,$$CTNOD@          Get 1ST node specified              00465000
         MVC   0(8,R4),=CL8'='      Change to the local node            00466000
         MVC   $$CTNODL,=H'1'       Update node name length for local   00467000
         OI    $$CTFLG1,$$CTUSE     Say use this entry but...           00468000
         OI    $$CTFLG2,$$CTEND      force no but this local node.      00469000
         WTO   'TSSINSTX: CPF CMD FORCED TO LOCAL ONLY'                 00470000
         B     EXIT0                Done                                00471000
         LTORG                                                          00472000
         EJECT    ,                                                     00473000
*---------------------------------------------------------------------* 00474000
*                                                              V4L3M000 00475000
* Data Mapping Macros.                                         V4L3M000 00476000
*                                                              V4L3M000 00477000
* Note: All of these macros may be found in the optional       V4L3M000 00478000
*       Materials file.                                        V4L3M000 00479000
*                                                              V4L3M000 00480000
*---------------------------------------------------------------------* 00481000
         #INSTXPL ,          Installation Exit Parameter List  V4L3M000 00482000
         #FACMATX ,          Facility Matrix Mapping           V4L3M000 00483000
         #SMF80 ,            Mapping of Type 80 SMF Record     V4L3M000 00484000
         #FLOG ,             Fast Log Buffer Mapping           V4L3M000 00485000
         #RFLAGS ,           Resource Code Equates             V4L3M000 00486000
         #DFLAGS ,           Detail Error Reason Codes (DRCs)  V4L3M000 00487000
         #AFLAGS ,           Access Level Equates              V4L3M000 00488000
         #FEEDBCK ,          Feedback Area Mapping             V4L3M000 00489000
         #RECOVER ,          Recovery Record Mapping           V4L3M000 00490000
         $$CPFTGT ,          Target Data for Commands With CPF V4L3M000 00491000
* WORKAREA                                                              00492000
WORKAREA DSECT                                                          00493000
WORK     DS    D                                                        00494000
         ORG   WORKAREA+100   LIMIT OF WORKAREA AS PROVIDED BY T/S      00495000
R0       EQU   0                                                        00496000
R1       EQU   1                                                        00497000
R2       EQU   2                                                        00498000
R3       EQU   3                                                        00499000
R4       EQU   4                                                        00500000
R5       EQU   5                                                        00501000
R6       EQU   6                                                        00502000
R7       EQU   7                                                        00503000
R8       EQU   8                                                        00504000
R9       EQU   9                                                        00505000
RA       EQU   10                                                       00506000
R10      EQU   10                                                       00507000
RB       EQU   11                                                       00508000
R11      EQU   11                                                       00509000
RC       EQU   12                                                       00510000
R12      EQU   12                                                       00511000
RD       EQU   13                                                       00512000
R13      EQU   13                                                       00513000
RE       EQU   14                                                       00514000
R14      EQU   14                                                       00515000
RF       EQU   15                                                       00516000
R15      EQU   15                                                       00517000
         END                                                            00518000
