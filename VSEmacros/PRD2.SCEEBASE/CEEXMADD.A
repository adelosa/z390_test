.********************************************************************** 00001000
.*                                                                    * 00002000
.*  CEEXMADD - BAL macro to add a single message to an LE/VSE messages* 00003000
.*             module.                                                * 00004000
.*                                                                    * 00005000
.*  Licensed Materials - Property of IBM                              * 00006000
.*                                                                    * 00007000
.*  5686-094  (C) Copyright IBM Corp. 1991,  1996                     * 00008000
.*  All rights reserved.                                              * 00009000
.*                                                                    * 00010000
.*                                                                    * 00011000
.*      US Government Users Restricted Rights - Use, duplication or   * 00012000
.*      disclosure restricted by GSA ADP Schedule Contract with IBM   * 00013000
.*      Corp.                                                         * 00014000
.*                                                                    * 00015000
.*  STATUS - Release level of this macro                              * 00016000
.*           LE/VSE Version 1 Release 4 Modification 0                * 00017000
.*                                                                    * 00018000
.*  FUNCTION:                                                         * 00019000
.*       This macro is used to add a single message to an LE/VSE      * 00020000
.*       messages module.                                             * 00021000
.*                                                                    * 00022000
.*  DEPENDENCIES - This macro is not to be called by a user routine.  * 00023000
.*                 Rather it is used by the ASSEMBLE routine generated* 00024000
.*                 by CEEBLDTX to contain the messages for use by     * 00025000
.*                 LE/VSE.                                            * 00026000
.*                                                                    * 00027000
.*  RESTRICTIONS - Used only by the ASSEMBLE routine generated by     * 00028000
.*                 CEEBLDTX.                                          * 00029000
.*                                                                    * 00030000
.*  REGISTER CONVENTIONS - none                                       * 00031000
.*                                                                    * 00032000
.*                                                                    * 00033000
.*  LINKAGE - CEEXMADD  &MSGNO=,      Message number of this message  * 00034000
.*                      &MSGRC=,      Severity of this message        * 00035000
.*                      &MSGCL=,      Message class of this message   * 00036000
.*                      &MSGKEY=,     Message subid parameter         * 00037000
.*                      &MSG1=,       Each piece of message text      * 00038000
.*                      ...,                                          * 00039000
.*                      &MSG50=                                       * 00040000
.*                      &MSGPN=0,     Number of message parts         * 00041000
.*                      &MSGPS1=(,,), Description of each message part* 00042000
.*                      ...,                                          * 00043000
.*                      &MSGPS32=(,,)                                 * 00044000
.*                                                                    * 00045000
.*  MESSAGES - none                                                   * 00046000
.*                                                                    * 00047000
.********************************************************************** 00048000
         MACRO                                                          00049000
&LABEL   CEEXMADD &MSGNO=,                                             X00050000
               &MSGRC=,                                                X00051000
               &MSGCL=,                                                X00052000
               &MSGKEY=,                                               X00053000
               &MSG1=,&MSG2=,&MSG3=,&MSG4=,&MSG5=,&MSG6=,&MSG7=,&MSG8=,X00054000
               &MSG9=,&MSG10=,&MSG11=,&MSG12=,&MSG13=,&MSG14=,&MSG15=, X00055000
               &MSG16=,&MSG17=,&MSG18=,&MSG19=,&MSG20=,&MSG21=,&MSG22=,X00056000
               &MSG23=,&MSG24=,&MSG25=,&MSG26=,&MSG27=,&MSG28=,&MSG29=,X00057000
               &MSG30=,&MSG31=,&MSG32=,&MSG33=,&MSG34=,&MSG35=,&MSG36=,X00058000
               &MSG37=,&MSG38=,&MSG39=,&MSG40=,&MSG41=,&MSG42=,&MSG43=,X00059000
               &MSG44=,&MSG45=,&MSG46=,&MSG47=,&MSG48=,&MSG49=,&MSG50=,X00060000
               &MSGPN=0,                                               X00061000
               &MSGPS1=(,,),&MSGPS2=(,,),&MSGPS3=(,,),&MSGPS4=(,,),    X00062000
               &MSGPS5=(,,),&MSGPS6=(,,),&MSGPS7=(,,),&MSGPS8=(,,),    X00063000
               &MSGPS9=(,,),&MSGPS10=(,,),&MSGPS11=(,,),&MSGPS12=(,,), X00064000
               &MSGPS13=(,,),&MSGPS14=(,,),&MSGPS15=(,,),&MSGPS16=(,,),X00065000
               &MSGPS17=(,,),&MSGPS18=(,,),&MSGPS19=(,,),&MSGPS20=(,,),X00066000
               &MSGPS21=(,,),&MSGPS22=(,,),&MSGPS23=(,,),&MSGPS24=(,,),X00067000
               &MSGPS25=(,,),&MSGPS26=(,,),&MSGPS27=(,,),&MSGPS28=(,,),X00068000
               &MSGPS29=(,,),&MSGPS30=(,,),&MSGPS31=(,,),&MSGPS32=(,,)  00069000
.*                                                                      00070000
         GBLA  &USECTR                                                  00071000
         GBLA  &UNUSED1(250),&UNUSED2(250),&UNUSED3(250),&UNUSED4(250)  00072000
         GBLA  &MPREV                                                   00073000
         GBLC  &CLASSES                                                 00074000
         GBLA  &MKPREV                                                  00075000
         GBLC  &ZEROS                                                   00076000
         LCLA  &MSGNUM                                                  00077000
         LCLA  &MSGNUML                                                 00078000
         LCLC  &MNAME                                                   00079000
         LCLA  &MSGCTR                                                  00080000
         LCLA  &MTXTCTR                                                 00081000
         LCLA  &CLINDEX                                                 00082000
         LCLC  &CLASS                                                   00083000
         LCLA  &LOCALCL                                                 00084000
         LCLA  &MK                                                      00085000
         LCLA  &KEYCTR                                                  00086000
         LCLC  &TEXT                                                    00087000
         LCLC  &CHKHEX                                                  00088000
         LCLC  &X                                                       00089000
         LCLC  &UNMSG                                                   00090000
         LCLC  &UNMSGL                                                  00091000
         LCLA  &PARTCTR                                                 00092000
         LCLA  &TOTPART                                                 00093000
         LCLC  &MSGPRT1,&MSGPRT2,&MSGPRT3                               00094000
         LCLA  &TEXTL                                                   00095000
         LCLA  &OTEXTL                                                  00096000
         LCLA  &CHKQCTR                                                 00097000
         LCLC  &CHKQQ                                                   00098000
         LCLC  &QQ                                                      00099000
         LCLC  &MSG(50)                                                 00100000
         LCLC  &MSGPS(96)                                               00101000
.*--------------------------------------------------------------------- 00102000
.*                                                                      00103000
.* Initial declarations used within this invocation of CEEXMADD         00104000
.*                                                                      00105000
.*--------------------------------------------------------------------- 00106000
.* limit for macro loops during expansion, default 4096 --------------- 00107000
         ACTR 9216                                                      00108000
.*--------------------------------------------------------------------- 00109000
&MSG(1)  SETC  '&MSG1'                                                  00110000
&MSG(2)  SETC  '&MSG2'                                                  00111000
&MSG(3)  SETC  '&MSG3'                                                  00112000
&MSG(4)  SETC  '&MSG4'                                                  00113000
&MSG(5)  SETC  '&MSG5'                                                  00114000
&MSG(6)  SETC  '&MSG6'                                                  00115000
&MSG(7)  SETC  '&MSG7'                                                  00116000
&MSG(8)  SETC  '&MSG8'                                                  00117000
&MSG(9)  SETC  '&MSG9'                                                  00118000
&MSG(10) SETC  '&MSG10'                                                 00119000
&MSG(11) SETC  '&MSG11'                                                 00120000
&MSG(12) SETC  '&MSG12'                                                 00121000
&MSG(13) SETC  '&MSG13'                                                 00122000
&MSG(14) SETC  '&MSG14'                                                 00123000
&MSG(15) SETC  '&MSG15'                                                 00124000
&MSG(16) SETC  '&MSG16'                                                 00125000
&MSG(17) SETC  '&MSG17'                                                 00126000
&MSG(18) SETC  '&MSG18'                                                 00127000
&MSG(19) SETC  '&MSG19'                                                 00128000
&MSG(20) SETC  '&MSG20'                                                 00129000
&MSG(21) SETC  '&MSG21'                                                 00130000
&MSG(22) SETC  '&MSG22'                                                 00131000
&MSG(23) SETC  '&MSG23'                                                 00132000
&MSG(24) SETC  '&MSG24'                                                 00133000
&MSG(25) SETC  '&MSG25'                                                 00134000
&MSG(26) SETC  '&MSG26'                                                 00135000
&MSG(27) SETC  '&MSG27'                                                 00136000
&MSG(28) SETC  '&MSG28'                                                 00137000
&MSG(29) SETC  '&MSG29'                                                 00138000
&MSG(30) SETC  '&MSG30'                                                 00139000
&MSG(31) SETC  '&MSG31'                                                 00140000
&MSG(32) SETC  '&MSG32'                                                 00141000
&MSG(33) SETC  '&MSG33'                                                 00142000
&MSG(34) SETC  '&MSG34'                                                 00143000
&MSG(35) SETC  '&MSG35'                                                 00144000
&MSG(36) SETC  '&MSG36'                                                 00145000
&MSG(37) SETC  '&MSG37'                                                 00146000
&MSG(38) SETC  '&MSG38'                                                 00147000
&MSG(39) SETC  '&MSG39'                                                 00148000
&MSG(40) SETC  '&MSG40'                                                 00149000
&MSG(41) SETC  '&MSG41'                                                 00150000
&MSG(42) SETC  '&MSG42'                                                 00151000
&MSG(43) SETC  '&MSG43'                                                 00152000
&MSG(44) SETC  '&MSG44'                                                 00153000
&MSG(45) SETC  '&MSG45'                                                 00154000
&MSG(46) SETC  '&MSG46'                                                 00155000
&MSG(47) SETC  '&MSG47'                                                 00156000
&MSG(48) SETC  '&MSG48'                                                 00157000
&MSG(49) SETC  '&MSG49'                                                 00158000
&MSG(50) SETC  '&MSG50'                                                 00159000
.*                                                                      00160000
&MSGPS(1)  SETC '&MSGPS1(1)'                                            00161000
&MSGPS(2)  SETC '&MSGPS1(2)'                                            00162000
&MSGPS(3)  SETC '&MSGPS1(3)'                                            00163000
&MSGPS(4)  SETC '&MSGPS2(1)'                                            00164000
&MSGPS(5)  SETC '&MSGPS2(2)'                                            00165000
&MSGPS(6)  SETC '&MSGPS2(3)'                                            00166000
&MSGPS(7)  SETC '&MSGPS3(1)'                                            00167000
&MSGPS(8)  SETC '&MSGPS3(2)'                                            00168000
&MSGPS(9)  SETC '&MSGPS3(3)'                                            00169000
&MSGPS(10) SETC '&MSGPS4(1)'                                            00170000
&MSGPS(11) SETC '&MSGPS4(2)'                                            00171000
&MSGPS(12) SETC '&MSGPS4(3)'                                            00172000
&MSGPS(13) SETC '&MSGPS5(1)'                                            00173000
&MSGPS(14) SETC '&MSGPS5(2)'                                            00174000
&MSGPS(15) SETC '&MSGPS5(3)'                                            00175000
&MSGPS(16) SETC '&MSGPS6(1)'                                            00176000
&MSGPS(17) SETC '&MSGPS6(2)'                                            00177000
&MSGPS(18) SETC '&MSGPS6(3)'                                            00178000
&MSGPS(19) SETC '&MSGPS7(1)'                                            00179000
&MSGPS(20) SETC '&MSGPS7(2)'                                            00180000
&MSGPS(21) SETC '&MSGPS7(3)'                                            00181000
&MSGPS(22) SETC '&MSGPS8(1)'                                            00182000
&MSGPS(23) SETC '&MSGPS8(2)'                                            00183000
&MSGPS(24) SETC '&MSGPS8(3)'                                            00184000
&MSGPS(25) SETC '&MSGPS9(1)'                                            00185000
&MSGPS(26) SETC '&MSGPS9(2)'                                            00186000
&MSGPS(27) SETC '&MSGPS9(3)'                                            00187000
&MSGPS(28) SETC '&MSGPS10(1)'                                           00188000
&MSGPS(29) SETC '&MSGPS10(2)'                                           00189000
&MSGPS(30) SETC '&MSGPS10(3)'                                           00190000
&MSGPS(31) SETC '&MSGPS11(1)'                                           00191000
&MSGPS(32) SETC '&MSGPS11(2)'                                           00192000
&MSGPS(33) SETC '&MSGPS11(3)'                                           00193000
&MSGPS(34) SETC '&MSGPS12(1)'                                           00194000
&MSGPS(35) SETC '&MSGPS12(2)'                                           00195000
&MSGPS(36) SETC '&MSGPS12(3)'                                           00196000
&MSGPS(37) SETC '&MSGPS13(1)'                                           00197000
&MSGPS(38) SETC '&MSGPS13(2)'                                           00198000
&MSGPS(39) SETC '&MSGPS13(3)'                                           00199000
&MSGPS(40) SETC '&MSGPS14(1)'                                           00200000
&MSGPS(41) SETC '&MSGPS14(2)'                                           00201000
&MSGPS(42) SETC '&MSGPS14(3)'                                           00202000
&MSGPS(43) SETC '&MSGPS15(1)'                                           00203000
&MSGPS(44) SETC '&MSGPS15(2)'                                           00204000
&MSGPS(45) SETC '&MSGPS15(3)'                                           00205000
&MSGPS(46) SETC '&MSGPS16(1)'                                           00206000
&MSGPS(47) SETC '&MSGPS16(2)'                                           00207000
&MSGPS(48) SETC '&MSGPS16(3)'                                           00208000
&MSGPS(49) SETC '&MSGPS17(1)'                                           00209000
&MSGPS(50) SETC '&MSGPS17(2)'                                           00210000
&MSGPS(51) SETC '&MSGPS17(3)'                                           00211000
&MSGPS(52) SETC '&MSGPS18(1)'                                           00212000
&MSGPS(53) SETC '&MSGPS18(2)'                                           00213000
&MSGPS(54) SETC '&MSGPS18(3)'                                           00214000
&MSGPS(55) SETC '&MSGPS19(1)'                                           00215000
&MSGPS(56) SETC '&MSGPS19(2)'                                           00216000
&MSGPS(57) SETC '&MSGPS19(3)'                                           00217000
&MSGPS(58) SETC '&MSGPS20(1)'                                           00218000
&MSGPS(59) SETC '&MSGPS20(2)'                                           00219000
&MSGPS(60) SETC '&MSGPS20(3)'                                           00220000
&MSGPS(61) SETC '&MSGPS21(1)'                                           00221000
&MSGPS(62) SETC '&MSGPS21(2)'                                           00222000
&MSGPS(63) SETC '&MSGPS21(3)'                                           00223000
&MSGPS(64) SETC '&MSGPS22(1)'                                           00224000
&MSGPS(65) SETC '&MSGPS22(2)'                                           00225000
&MSGPS(66) SETC '&MSGPS22(3)'                                           00226000
&MSGPS(67) SETC '&MSGPS23(1)'                                           00227000
&MSGPS(68) SETC '&MSGPS23(2)'                                           00228000
&MSGPS(69) SETC '&MSGPS23(3)'                                           00229000
&MSGPS(70) SETC '&MSGPS24(1)'                                           00230000
&MSGPS(71) SETC '&MSGPS24(2)'                                           00231000
&MSGPS(72) SETC '&MSGPS24(3)'                                           00232000
&MSGPS(73) SETC '&MSGPS25(1)'                                           00233000
&MSGPS(74) SETC '&MSGPS25(2)'                                           00234000
&MSGPS(75) SETC '&MSGPS25(3)'                                           00235000
&MSGPS(76) SETC '&MSGPS26(1)'                                           00236000
&MSGPS(77) SETC '&MSGPS26(2)'                                           00237000
&MSGPS(78) SETC '&MSGPS26(3)'                                           00238000
&MSGPS(79) SETC '&MSGPS27(1)'                                           00239000
&MSGPS(80) SETC '&MSGPS27(2)'                                           00240000
&MSGPS(81) SETC '&MSGPS27(3)'                                           00241000
&MSGPS(82) SETC '&MSGPS28(1)'                                           00242000
&MSGPS(83) SETC '&MSGPS28(2)'                                           00243000
&MSGPS(84) SETC '&MSGPS28(3)'                                           00244000
&MSGPS(85) SETC '&MSGPS29(1)'                                           00245000
&MSGPS(86) SETC '&MSGPS29(2)'                                           00246000
&MSGPS(87) SETC '&MSGPS29(3)'                                           00247000
&MSGPS(88) SETC '&MSGPS30(1)'                                           00248000
&MSGPS(89) SETC '&MSGPS30(2)'                                           00249000
&MSGPS(90) SETC '&MSGPS30(3)'                                           00250000
&MSGPS(91) SETC '&MSGPS31(1)'                                           00251000
&MSGPS(92) SETC '&MSGPS31(2)'                                           00252000
&MSGPS(93) SETC '&MSGPS31(3)'                                           00253000
&MSGPS(94) SETC '&MSGPS32(1)'                                           00254000
&MSGPS(95) SETC '&MSGPS32(2)'                                           00255000
&MSGPS(96) SETC '&MSGPS32(3)'                                           00256000
.*                                                                      00257000
&MSGNUM  SETA  &MSGNO                                                   00258000
&MSGNUML SETA  K'&MSGNO                                                 00259000
&MK      SETA  &MSGKEY(1)                                               00260000
&QQ      SETC  ''''''                                                   00261000
.*--------------------------------------------------------------------- 00262000
.*                                                                      00263000
.* The name field for each message is Mxxxx where xxxx is the message   00264000
.* number padded on the left with zeros.                                00265000
.*                                                                      00266000
.*--------------------------------------------------------------------- 00267000
         AIF   (&MSGNUML GE 4).XMADD1                                   00268000
&MNAME   SETC  'M'.'&ZEROS'(1,4-&MSGNUML).'&MSGNO'                      00269000
         AGO   .XMADD2                                                  00270000
.XMADD1  ANOP                                                           00271000
&MNAME   SETC  'M'.'&MSGNO'                                             00272000
.XMADD2  ANOP                                                           00273000
.*--------------------------------------------------------------------- 00274000
.*                                                                      00275000
.* Set MPREV to the the next message number after the last one          00276000
.* processed.                                                           00277000
.*                                                                      00278000
.*--------------------------------------------------------------------- 00279000
&MPREV   SETA  &MPREV+1                                                 00280000
.*--------------------------------------------------------------------- 00281000
.*                                                                      00282000
.* If this is a new message number, then set the previous message key   00283000
.* flag to 0, i.e. no message subids found yet for this message number. 00284000
.*                                                                      00285000
.*--------------------------------------------------------------------- 00286000
         AIF   (&MSGNUM LT &MPREV).XMADD3                               00287000
&MKPREV  SETA  0                                                        00288000
.*--------------------------------------------------------------------- 00289000
.*                                                                      00290000
.* Keep track of unused slots between previous message number and this  00291000
.* message number with dummy entries.                                   00292000
.*                                                                      00293000
.*--------------------------------------------------------------------- 00294000
&MSGCTR  SETA  &MPREV                                                   00295000
.LOOP    ANOP                                                           00296000
         AIF   (&MSGCTR GT &MSGNUM-1).ENDLOOP                           00297000
&USECTR  SETA  &USECTR+1                                                00298000
         AIF   (&USECTR LE 750).CHK500                                  00299000
&UNUSED4(&USECTR-750) SETA &MSGCTR                                      00300000
         AGO   .ENDCHK                                                  00301000
.CHK500  ANOP                                                           00302000
         AIF   (&USECTR LE 500).CHK250                                  00303000
&UNUSED3(&USECTR-500) SETA &MSGCTR                                      00304000
         AGO   .ENDCHK                                                  00305000
.CHK250  ANOP                                                           00306000
         AIF   (&USECTR LE 250).CHK0                                    00307000
&UNUSED2(&USECTR-250) SETA &MSGCTR                                      00308000
         AGO   .ENDCHK                                                  00309000
.CHK0    ANOP                                                           00310000
&UNUSED1(&USECTR) SETA &MSGCTR                                          00311000
.ENDCHK  ANOP                                                           00312000
.*                                                                      00313000
.* Declare unused message numbers as Mxxxx DS 0C                        00314000
.*                                                                      00315000
&UNMSGL  SETC  '&MSGCTR'                                                00316000
&MSGNUML SETA  K'&UNMSGL                                                00317000
         AIF   (&MSGNUML GE 4).XMADD4                                   00318000
&UNMSG   SETC  'M'.'&ZEROS'(1,4-&MSGNUML).'&MSGCTR'                     00319000
         AGO   .XMADD5                                                  00320000
.XMADD4  ANOP                                                           00321000
&UNMSG   SETC  'M'.'&MSGCTR'                                            00322000
.XMADD5  ANOP                                                           00323000
.*                                                                      00324000
&UNMSG   DS    0C                                                       00325000
.*                                                                      00326000
&MSGCTR  SETA  &MSGCTR+1                                                00327000
         AGO   .LOOP                                                    00328000
.ENDLOOP ANOP                                                           00329000
         AGO   .NOERROR                                                 00330000
.*                                                                      00331000
.* The only way message numbers can be non-increasing is if the         00332000
.* message is the same message number as the previous, and a message    00333000
.* key is present                                                       00334000
.*                                                                      00335000
.XMADD3  ANOP                                                           00336000
         AIF   (&MSGNUM NE &MPREV-1).ERROR                              00337000
         AIF   (&MK EQ 0).ERROR                                         00338000
         AGO   .NOERROR                                                 00339000
.ERROR   ANOP                                                           00340000
         MNOTE 12,'Message numbers must be in ascending order.'         00341000
         MNOTE 12,'This is violated at message number &MSGNO.'          00342000
         MEXIT                                                          00343000
.NOERROR ANOP                                                           00344000
&MPREV   SETA  &MSGNUM                                                  00345000
.*--------------------------------------------------------------------- 00346000
.*                                                                      00347000
.* Extract the class of the message number out of the range of          00348000
.* valid message classes passed to macro CEEXMBEG.                      00349000
.*                                                                      00350000
.*--------------------------------------------------------------------- 00351000
&CLASS   SETC  '&MSGCL'                                                 00352000
&CLINDEX SETA  1                                                        00353000
.CLLOOP  ANOP                                                           00354000
         AIF   (&CLINDEX GE 9).SETCL                                    00355000
         AIF   ('&CLASS' NE '&CLASSES'(&CLINDEX,1)).INCRCL              00356000
.SETCL   ANOP                                                           00357000
&LOCALCL SETA  &CLINDEX                                                 00358000
         AGO   .FINDKEY                                                 00359000
.INCRCL  ANOP                                                           00360000
&CLINDEX SETA  &CLINDEX+1                                               00361000
         AGO   .CLLOOP                                                  00362000
.*--------------------------------------------------------------------- 00363000
.*                                                                      00364000
.* If a message key does exist, then check for a previous message key.  00365000
.* Fill in header information if this is the first message key for      00366000
.* this message number.  Message key information consists of a double   00367000
.* word entry for each message key.  The double word contains a half    00368000
.* word of zeros, a half word of the message key, and a fullword        00369000
.* address of where the message actually is.  The final dummy entry     00370000
.* consists of a hlaf word of zeros, a halfword -1, and the address of  00371000
.* the initial "undefined" messaege.                                    00372000
.*                                                                      00373000
.*--------------------------------------------------------------------- 00374000
.FINDKEY ANOP                                                           00375000
         AIF   (&MK EQ 0).NOKEY                                         00376000
         AIF   (&MKPREV NE 0).CHECKEY                                   00377000
.*                                                                      00378000
         DS    0A                                                       00379000
&MNAME   EQU   *                                                        00380000
.*                                                                      00381000
&KEYCTR  SETA  2                                                        00382000
.INTLOOP ANOP                                                           00383000
         AIF   (&KEYCTR GT N'&MSGKEY).CONTINT                           00384000
.*                                                                      00385000
         DC    H'0'                                                     00386000
         DC    H'&MSGKEY(&KEYCTR)'                                      00387000
         DC    A(&MNAME._&MSGKEY(&KEYCTR))                              00388000
.*                                                                      00389000
&KEYCTR  SETA  &KEYCTR+1                                                00390000
         AGO   .INTLOOP                                                 00391000
.CONTINT ANOP                                                           00392000
.*                                                                      00393000
         DC    H'0'                                                     00394000
         DC    H'-1'                                                    00395000
         DC    A(M000A)                                                 00396000
.*                                                                      00397000
&MNAME   SETC  '&MNAME'.'_'.'&MSGKEY(1)'                                00398000
&MKPREV  SETA  &MK                                                      00399000
         AGO   .MSGDCL                                                  00400000
.CHECKEY ANOP                                                           00401000
         AIF   (&MK GT &MKPREV).KEYOK                                   00402000
         MNOTE 12,'Message subids must be in ascending order.'          00403000
         MNOTE 12,'This is violated at message number &MSGNO at message*00404000
                subid &MSGKEY(1).'                                      00405000
         MEXIT                                                          00406000
.*                                                                      00407000
.* Add as a new entry with a message key, i.e. Mxxxx_k                  00408000
.*                                                                      00409000
.KEYOK   ANOP                                                           00410000
&MNAME   SETC  '&MNAME'.'_'.'&MSGKEY(1)'                                00411000
&MKPREV  SETA  &MK                                                      00412000
         AGO   .MSGDCL                                                  00413000
.*                                                                      00414000
.* Add as a new entry without a message key                             00415000
.*                                                                      00416000
.NOKEY   ANOP                                                           00417000
&MKPREV  SETA  0                                                        00418000
.*                                                                      00419000
.* Fill in entry with class, return code and number of message sections 00420000
.*                                                                      00421000
.MSGDCL  ANOP                                                           00422000
         DS    0A                                                       00423000
&MNAME   EQU   *                                                        00424000
         DC    AL1(&LOCALCL)                                            00425000
         DC    AL1(&MSGRC+128)                                          00426000
         DC    H'&MSGPN'                                                00427000
.*--------------------------------------------------------------------- 00428000
.*                                                                      00429000
.* For each message section descriptor, there are three parts           00430000
.*                                                                      00431000
.*--------------------------------------------------------------------- 00432000
&PARTCTR SETA  1                                                        00433000
&TOTPART SETA  &MSGPN*3                                                 00434000
.PRTLOOP ANOP                                                           00435000
         AIF   (&PARTCTR GT &TOTPART).NOMORE                            00436000
.*                                                                      00437000
.* If the first part is null then, just fill in with zero               00438000
.*                                                                      00439000
&MSGPRT1 SETC  '&MSGPS(&PARTCTR)'                                       00440000
&MSGPRT2 SETC  '&MSGPS(&PARTCTR+1)'                                     00441000
&MSGPRT3 SETC  '&MSGPS(&PARTCTR+2)'                                     00442000
         AIF   ('&MSGPRT1' NE '').PART1                                 00443000
.*                                                                      00444000
         DC    AL1(0)                                                   00445000
         DC    FL2'0'                                                   00446000
.*                                                                      00447000
         AGO   .ENDSECT                                                 00448000
.PART1   ANOP                                                           00449000
.*                                                                      00450000
         DC    AL1(&MSGPRT1)                                            00451000
.*                                                                      00452000
.* If the second and third part is null then, just fill in with zero    00453000
.*                                                                      00454000
         AIF   ('&MSGPRT3' NE '').PART3                                 00455000
         AIF   ('&MSGPRT2' NE '').PART2                                 00456000
.*                                                                      00457000
         DC    FL2'0'                                                   00458000
.*                                                                      00459000
         AGO   .ENDSECT                                                 00460000
.*                                                                      00461000
.* If the third part is null then, just fill in with the second part    00462000
.*                                                                      00463000
.PART2   ANOP                                                           00464000
.*                                                                      00465000
         DC    FL2'&MSGPRT2'                                            00466000
.*                                                                      00467000
         AGO   .ENDSECT                                                 00468000
.*                                                                      00469000
.* If no parts are null then, fill in with the both parts               00470000
.*                                                                      00471000
.PART3   ANOP                                                           00472000
.*                                                                      00473000
         DC    AL1(&MSGPRT3)                                            00474000
         DC    AL1(&MSGPRT2)                                            00475000
.*                                                                      00476000
.ENDSECT ANOP                                                           00477000
&PARTCTR SETA  &PARTCTR+3                                               00478000
         AGO   .PRTLOOP                                                 00479000
.NOMORE  ANOP                                                           00480000
.*--------------------------------------------------------------------- 00481000
.*                                                                      00482000
.* Loop through looking at each section of message text                 00483000
.*                                                                      00484000
.*--------------------------------------------------------------------- 00485000
&MTXTCTR SETA  1                                                        00486000
.MSGLOOP ANOP                                                           00487000
         AIF   ('&MSG(&MTXTCTR)' EQ '').DONE                            00488000
&TEXT    SETC  '&MSG(&MTXTCTR)'                                         00489000
&TEXTL   SETA  K'&TEXT                                                  00490000
.*                                                                      00491000
.* Determine if the last character is an 'X'.  If so, then declare the  00492000
.* data as hex.                                                         00493000
.*                                                                      00494000
&CHKHEX  SETC  '&TEXT'(&TEXTL,1)                                        00495000
&X       SETC  'X'                                                      00496000
         AIF   ('&CHKHEX' NE '&X').NOTHEX                               00497000
.*                                                                      00498000
.* This will be processed as a hex string.  If the text string is null  00499000
.* i.e.  '' then just put in a DS 0C placeholder                        00500000
.*                                                                      00501000
&TEXT    SETC  '&TEXT'(1,&TEXTL-1)                                      00502000
         AIF   ('&TEXT' EQ '&QQ').HEXL0                                 00503000
.*                                                                      00504000
         DC    X&TEXT                                                   00505000
.*                                                                      00506000
         AGO   .ENDMLP                                                  00507000
.HEXL0   ANOP                                                           00508000
.*                                                                      00509000
         DS    0C                                                       00510000
.*                                                                      00511000
         AGO   .ENDMLP                                                  00512000
.*                                                                      00513000
.* If the length of the text is less than or equal to two then declare  00514000
.* as DS 0C, since the two is just the beginning and ending quote       00515000
.*                                                                      00516000
.NOTHEX  ANOP                                                           00517000
         AIF   ('&TEXT' NE '&QQ').ENDNQ                                 00518000
.*                                                                      00519000
         DS    0C                                                       00520000
.*                                                                      00521000
         AGO   .ENDMLP                                                  00522000
.*                                                                      00523000
.* First, the text string length must be less 2 since the beginning     00524000
.* and end quote should not be counter in the number of characters.     00525000
.*                                                                      00526000
.* Look through the text string looking for double quotes.  If found,   00527000
.* then the length of the string is actually less one, because only     00528000
.* one character should be counted.                                     00529000
.*                                                                      00530000
.ENDNQ   ANOP                                                           00531000
&TEXTL   SETA  &TEXTL-2                                                 00532000
&CHKQCTR SETA  2                                                        00533000
&OTEXTL  SETA  &TEXTL                                                   00534000
.QCHK    ANOP                                                           00535000
         AIF   (&CHKQCTR GT &OTEXTL).DCL                                00536000
&CHKQQ   SETC  '&TEXT'(&CHKQCTR,2)                                      00537000
         AIF   ('&CHKQQ' NE '&QQ').QCHK2                                00538000
&TEXTL   SETA  &TEXTL-1                                                 00539000
.QCHK2   ANOP                                                           00540000
&CHKQCTR SETA  &CHKQCTR+1                                               00541000
         AGO   .QCHK                                                    00542000
.*                                                                      00543000
.* Declare the text string                                              00544000
.*                                                                      00545000
.DCL     ANOP                                                           00546000
.*                                                                      00547000
         DC    CL&TEXTL.&TEXT                                           00548000
.*                                                                      00549000
.ENDMLP  ANOP                                                           00550000
.*                                                                      00551000
.* Increment text part counter and see if any more to process           00552000
.*                                                                      00553000
&MTXTCTR SETA  &MTXTCTR+1                                               00554000
         AGO   .MSGLOOP                                                 00555000
.*--------------------------------------------------------------------- 00556000
.*                                                                      00557000
.* Done with this message                                               00558000
.*                                                                      00559000
.*--------------------------------------------------------------------- 00560000
.DONE    ANOP                                                           00561000
         MEND                                                           00562000
