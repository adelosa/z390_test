.* IBM DISK OPERATING SYSTEM                                            00050000
* ISFMS - ISMOD9 - 5686-007-02-C440                            @U31TUJS 00100000
.* COPYRIGHT = THIS MACRO IS "RESTRICTED MATERIALS OF IBM"     @D41TDKY 00150000
.*             5686-007 (C) COPYRIGHT IBM CORP. 1977,1989      @U31TUJS 00200000
.*             ALL RIGHTS RESERVED                             @U31TUJS 00250000
.*             LICENSED MATERIALS - PROPERTY OF IBM            @U31TUJS 00300000
.*             SEE COPYRIGHT INSTRUCTIONS, G120-2083           @U31TUJS 00350000
.M7      ANOP                                                       3-9 00400000
*                        TABLES FOR LOAD-ROUTINE                        00450000
IJHKTABL DSECT                                                          00500000
IJHKCCB  DC    XL16'0'                 COMMAND CONTROL BLOCK            00550000
IJHKADDR DC    F'0'                    ADDRESS OF LOGIC MODULE @DL30SMP 00600000
         DC    XL1'0'                  FILE TYPE FOR OPEN/CLOSE         00650000
IJHKOPCO DC    XL1'0'                  OPTION SWITCHES                  00700000
         DC    CL7' '                  FILE NAME                        00750000
IJHKPDDV DC    XL1'0'                  PRIME DATA DEVICE TYPE INDIC     00800000
IJHKCCOD DC    XL1'0'                  C CODE                           00850000
IJHKHNDV DC    XL1'0'                  HI LEVEL INDEX DEVICE TYPE INDIC 00900000
         DC    XL1'0'                  REL PSTN XTNT-CELL TBL           00950000
         DC    XL1'0'                                                   01000000
IJHKFDRC DC    XL2'0'                  HR 1ST PD RCD IN CYL             01050000
         DC    H'0'                    HH LST PD TRK IN CYL             01100000
         DC    XL1'0'                  R HI RCD ON MI/CI TRK            01150000
IJHKNRPD DC    XL1'0'                  R HI RCD ON PD TRK               01200000
         DC    XL1'0'                  R HI RCD ON OFLO TRK             01250000
IJHKNRSH DC    XL1'0'                  R HI RCD ON SHARED TRK           01300000
IJHKNRTI DC    XL1'0'                  R HI RCD ON TI TRK               01350000
IJHKFLAG DC    XL1'0'                  SWITCHES                         01400000
         DC    XL7'0'                  MBBCCHH PD LO LMT                01450000
         DC    XL7'0'                  MBBCCHH CI LO LMT                01500000
         DC    XL7'0'                  MBBCCHH MI LO LMT                01550000
IJHXIND  DC    XL1'0'                  # OF IND LVLS & RPS SW'S@DL30SMP 01600000
IJHKLPDR DC    XL8'0'                  MBBCCHHR LST PD RCD              01650000
IJHKLGLN DC    H'0'                    LGCL RCD LEN                     01700000
         DC    H'0'                    KEY LEN                          01750000
IJHKBKLN DC    H'0'                    BLK LEN - NRCD*RL                01800000
         DC    H'0'                    OFLO RCD - LOGLEN+10             01850000
IJHKNRCD DC    H'0'                    BLOCKING FACTOR - NRCDS          01900000
         DC    H'0'                    MI/CI/TI RCD - KL+10             01950000
         DC    H'0'                    PD RCD - KL+BLKLEN               02000000
         DC    H'0'                    OFLO RCD - KL+LOGLEN+10          02050000
         DC    H'0'                    PD RCD - KL+BLKLEN+8             02100000
         DC    H'0'                    OFLO RCD - KL+LOGLEN+18          02150000
         DC    H'0'                    KEY PSTN IN BLKD RCD             02200000
IJHKSBKT DC    XL8'0'                  COMMON SEEK/SRCH ADDR AREA       02250000
IJHKLGCT DC    H'0'                    LGCL RCD COUNT FOR BLOCKING      02300000
         DC    H'0'                    HI NDX BYTE COUNT                02350000
IJHKPRCT DC    F'0'                    PRIME RCD COUNT                  02400000
         DC    XL1'0' .                LST TRK, LST BLK FULL INDIC      02450000
IJHKLTIR DC    XL5'0' .                CCHHR LST TI RCD                 02500000
IJHKLCIR DC    XL5'0' .                CCHHR LST CI RCD                 02550000
IJHKLMIR DC    XL5'0' .                CCHHR LST MI RCD                 02600000
         AIF   (NOT &SW(15)).M71                               @DL30SMP 02650000
IJHKBLD  DS    56C                      UNUSED CCW BLD AREA    @DL30SMP 02700000
         AGO   .M72                                            @DL30SMP 02750000
.M71     ANOP                                                  @DL30SMP 02800000
         DC    3D'0'                   SEEK,SIDE,TIC                    02850000
IJHKRDWR DC    3D'0'                   READ/WRITE,SIDE,TIC              02900000
IJHKVERF DC    D'0'                    VERIFY                           02950000
.M72     ANOP                                                  @DL30SMP 03000000
IJHKADCN DC    4F'0'                   ADDR IOAREA,WORKA,KEY IN WORKA   03050000
IJHKBPOS EQU   IJHKADCN+12             BLK PSTN ADDR FOR BLOCKING       03100000
IJHKMIXT DC    XL1'0'                  XTNSN AND MI INDIC               03150000
         DC    XL4'0'                  CCHH CI HI LMT                   03200000
         DC    XL4'0'                  CCHH MI HI LMT                   03250000
IJHKPDUL DC    XL7'0'                  MBBCCHH PD OLD HI LMT            03300000
         DC    XL7'0'                  MBBCCHH PD NEW HI LMT FOR XTNSN  03350000
IJHKLTM1 DC    XL1'0'                  LST PD TRK IN CYL - 1            03400000
IJHKKLM1 DC    H'0'                    KEY LEN - 1                      03450000
IJHKLLM1 DC    H'0'                    LGCL RCD LEN - 1                 03500000
IJHKTIDR DC    XL2'0'                  HR TI DUMMY RCD                  03550000
IJHKBFDR DC    XL2'0'                  HR RCD BEFORE 1ST PD RCD IN CYL  03600000
IJHKNRCM DC    XL1'0'                  NO RCDS ON MI/CI TRK - 1         03650000
IJHKCMCT DC    XL4'0'                  MI/CI ADDR CNTRL FLD             03700000
IJHKPDCT DC    XL3'0'                  PD ADDR CNTRL FLD                03750000
IJHKPDBG DC    XL3'0'                  PD BEGINNING OF VOL              03800000
IJHKPDEN DC    XL3'0'                  PD END OF VOL                    03850000
IJHKIOPT DC    XL2'0'                  PTR TO END OF EXTENT TABLE   3-4 03900000
IJHKXTBL DC    F'0'                    1ST ENTRY IN XTNT-CELL TABLE     03950000
         AIF   (NOT &SW(15)).M73       RPS NOT SPECIFIED       @DL30SMP 04000000
         EJECT                                                          04050000
******************TABLE FOR DTFIS EXTENSION******************* @DL30SMP 04100000
IJHXDTF  DSECT                         DTFIS RPS EXTENSION     @DL30SMP 04150000
IJHXSEEK DS    8C                      INITIAL SEEK CCW        @DL30SMP 04200000
IJHXSSC1 DS    8C                      INITIAL SET SECTOR CCW  @DL30SMP 04250000
         DS    16C                     SEARCH/TIC CCW'S        @DL30SMP 04300000
IJHXRDWR DS    8C                      READ/WRITE CCW          @DL30SMP 04350000
IJHXRSC1 DS    8C                      READ SECTOR CCW         @DL30SMP 04400000
IJHXSSC2 DS    8C                      VERIFY SET SECTOR CCW   @DL30SMP 04450000
         DS    16C                     SEARCH/TIC CCW'S        @DL30SMP 04500000
IJHXVERF DS    8C                      VERIFY CCW              @DL30SMP 04550000
         DS    64C                     REMAINDER CCW BLD AREA  @DL30SMP 04600000
IJHXARG  DS    0C                      RPS SECTOR ARGUMENTS    @DL30SMP 04650000
IJHXARG0 DS    1C                      SECTOR ARG FIELD # 0    @DL30SMP 04700000
IJHXARG1 DS    1C                      SECTOR ARG FIELD # 1    @DL30SMP 04750000
IJHXARG2 DS    1C                      SECTOR ARG FIELD # 2    @DL30SMP 04800000
IJHXARG3 DS    1C                      SECTOR ARG FIELD # 3    @DL30SMP 04850000
IJHXARG4 DS    1C                      SECTOR ARG FIELD # 4    @DL30SMP 04900000
IJHXARG5 DS    1C                      SECTOR ARG FIELD # 5    @DL30SMP 04950000
IJHXWRK  DS    2C                      RPS WORK AREA           @DL30SMP 05000000
IJHXWRK1 DS    8C                      RPS WORK AREA # 1       @DL30SMP 05050000
IJHXUR14 DS    4C                      USER REGISTER 14        @DL30SMP 05100000
IJHXAERT DS    4C                      ADDR RPS ERREXT RTN     @DL30SMP 05150000
IJHXMR14 DS    4C                      ISMOD REGISTER 14       @DL30SMP 05200000
IJHXUR13 DS    4C                      USER REGISTER 13        @DL30SMP 05250000
IJHXDCA  DS    4C                      ADDR DTF CCW BUILD AREA @DL30SMP 05300000
IJHXUMA  DS    4C                      ADDR USER ISMOD         @DL30SMP 05350000
IJHXUSA  DS    0D                      USER SAVE AREA (RDONLY) @DL30SMP 05400000
         DS    72C                                             @DL30SMP 05450000
IJHXERTM DS    44C                     RPS ERREXT ROUTINE      @DL30SMP 05500000
         DS    84C                     UNUSED AREA WITHIN EXT. @DL30SMP 05550000
***************END OF TABLE FOR DTFIS EXTENSION*************** @DL30SMP 05600000
         EJECT                                                 @DL30SMP 05650000
.M73     ANOP                                                  @DL30SMP 05700000
         AIF   ('&NAME' EQ '' ).M8                                  3-9 05750000
&NAME    CSECT                                                          05800000
         AGO   .NA                                                  3-9 05850000
.M8      ANOP                                                       3-9 05900000
IJHZ&B(3)&NM(3).Z&NM(5)   CSECT                                @DL30SMP 05950000
         AIF   (NOT &SW(25)).M9                                     3-4 06000000
         ENTRY IJHZ&B(3).ZZ&NM(5)                              @DL30SMP 06050000
IJHZ&B(3).ZZ&NM(5)  EQU *                                      @DL30SMP 06100000
         AIF   ('&NM(5)' EQ '&NM(6)').NA                            3-4 06150000
         ENTRY IJHZ&B(3).ZZ&NM(6)                              @DL30SMP 06200000
IJHZ&B(3).ZZ&NM(6)  EQU  *                                     @DL30SMP 06250000
.M9      AIF   ('&NM(5)' EQ '&NM(6)').NA                            3-9 06300000
         ENTRY IJHZ&B(3)&NM(3).Z&NM(6)                         @DL30SMP 06350000
IJHZ&B(3)&NM(3).Z&NM(6)  EQU  *                                @DL30SMP 06400000
.NA      USING IJHKTABL,1                                           3-9 06450000
         AIF   (NOT &SW(15)).NA1       RPS NOT SPECIFIED       @DL30SMP 06500000
         USING IJHXDTF,IJHREG10                                @DL30SMP 06550000
.NA1     ANOP                                                  @DL30SMP 06600000
         USING *,15                    DTFIS LOAD FUNCTION              06650000
IJHLLORG EQU   2                       LOWEST REGISTER SAVED            06700000
         AIF   (&SW(25)).NB                                         3-4 06750000
IJHLWORK EQU   5                       GENERAL WORK                 3-4 06800000
IJHLHIRG EQU   9                       HIGHEST REGISTER SAVED           06850000
IJHLONER EQU   2                       CONSTANT = 1                     06900000
         AGO   .NC                                                  3-4 06950000
.NB      ANOP                                                       3-4 07000000
IJHLHIRG EQU   12  HIGHEST REGISTER SAVED                           3-4 07050000
IJHLOIOA EQU   2   ADDR OF PREVIOUS IOAREA                          3-4 07100000
IJHLSVIO EQU   10                      PTR TO I/O AREA ADDR IN DTF  3-4 07150000
IJHLWORK EQU   11                      GENERAL WORK                 3-4 07200000
IJHLLNKC EQU   11 LINKAGE                                           3-4 07250000
IJHLONER EQU   12  CONSTANT = 1                                     3-4 07300000
IJHLZERO EQU   12                                                   3-4 07350000
.NC      ANOP                                                       3-4 07400000
IJHLIOAR EQU   3                       ADDR OF IOAREAL                  07450000
IJHLWRKL EQU   4                       ADDR OF WORKL                    07500000
IJHLKEYL EQU   5                       ADDR OF KEY IN WORKL             07550000
IJHLLGPS EQU   6                       ADDR LOGICAL RCD IN IOAREAL      07600000
IJHLKLEN EQU   7                       KEY LENGTH - 1                   07650000
IJHLC256 EQU   8                       CONSTANT = 256                   07700000
IJHLLGLN EQU   IJHLC256+1              LOGICAL RCD LEN - 1              07750000
IJHLLNKA EQU   4                       LINKAGE                          07800000
IJHLRCNT EQU   8                       LOGICAL RECORD COUNT             07850000
IJHLLNKB EQU   8                       LINKAGE                          07900000
IJHLCMPT EQU   9                       ADDR CI OR MI CCHHR BKT          07950000
IJHLADDR EQU   7                       POINTER TO DASD ADDR FLDS        08000000
IJHLCNTL EQU   5                       POINTER TO DASD ADDR CNTRL FLDS  08050000
IJHLMPTR EQU   5                       M POINTER                        08100000
IJHLSAVR EQU   13                                                   3-3 08150000
IJHLRTRN EQU   14 .                    LINKAGE TO USER                  08200000
         AIF   (NOT &SW(15)).NC1       RPS = NO                @DL30SMP 08250000
IJHKRDWR EQU   IJHXRDWR                EXT READ/WRITE CCW      @DL30SMP 08300000
IJHKVERF EQU   IJHXVERF                EXTENSION VERIFY CCW    @DL30SMP 08350000
IJHREG9  EQU   9                       REGISTER 9              @DL30SMP 08400000
IJHREG10 EQU   10                      REGISTER 10             @DL30SMP 08450000
IJHREG13 EQU   13                      REGISTER 13             @DL30SMP 08500000
IJHREG14 EQU   14                      REGISTER 14             @DL30SMP 08550000
IJHREG15 EQU   15                      REGISTER 15             @DL30SMP 08600000
IJHSVC50 EQU   50                      SVC 50 (ERROR FOUND)    @DL30SMP 08650000
IJHXCI   EQU   X'20'                   CYLINDER INDEX I/O      @DL30SMP 08700000
IJHXD0   EQU   0                       DISPLACEMENT OF 0       @DL30SMP 08750000
IJHXD1   EQU   1                       DISPLACEMENT OF 1       @DL30SMP 08800000
IJHXD8   EQU   8                       DISPLACEMENT OF 8       @DL30SMP 08850000
IJHXD9   EQU   9                       DISPLACEMENT OF 9       @DL30SMP 08900000
IJHXL1   EQU   1                       LENGTH OF 1             @DL30SMP 08950000
IJHXMI   EQU   X'10'                   MASTER INDEX I/O        @DL30SMP 09000000
IJHXMICI EQU   X'30'                   MI/CI I/O OPERATION     @DL30SMP 09050000
IJHXM1   EQU   X'07'                   MADK FOR REG BYTES 1/2/3@DL30SMP 09100000
IJHXNOOP EQU   X'03'                   NO-OP CCW OP-CODE       @DL30SMP 09150000
IJHXPD   EQU   X'80'                   PRIME DATA I/O          @DL30SMP 09200000
IJHXRPSF EQU   X'04'                   RPS DTFIS SWITCH        @DL30SMP 09250000
IJHXRPSI EQU   X'01'                   RPS HI-INDEX DEVICE SW  @DL30SMP 09300000
IJHXRSOC EQU   X'22'                   READ SECTOR CCW OP-CODE @DL30SMP 09350000
IJHXSSOC EQU   X'23'                   SET SECTOR CCW OP-CODE  @DL30SMP 09400000
IJHXTI   EQU   X'40'                   TRACK INDEX I/O         @DL30SMP 09450000
IJHXTIO  EQU   64                      TYPE OF I/O OPERATION   @DL30SMP 09500000
IJHXZERO EQU   X'00'                   ZERO                    @DL30SMP 09550000
.NC1     ANOP                                                  @DL30SMP 09600000
         TM    IJHKFLAG,X'30' .        Q-  PD FULL OR CI/MI TOO SMALL   09650000
         BCR   5,IJHLRTRN .            EXIT TO USER IF ERROR            09700000
         AIF   (NOT &SW(15)).NC2       RPS SUPPORT REQUIRED    @DL30SMP 09750000
         USING IJHXDTF,IJHREG13                                @DL30SMP 09800000
         LR    IJHREG15,IJHREG13       SAVE USER R13 IN R15    @DL30SMP 09850000
         L     IJHREG13,IJHKCCB+IJHXD8 GET ADDRESS OF THE      @DL30SMP 09900000
         LA    IJHREG13,IJHXD0(IJHREG13)  DTFIS EXTENSION      @DL30SMP 09950000
         ST    IJHREG15,IJHXUR13       SAVE USER REGISTER 13   @DL30SMP 10000000
         L     IJHREG15,IJHKADDR       RESTORE BASE REGISTER   @DL30SMP 10050000
         AH    IJHREG13,IJHXC184       CALCULATE ADDR DTFIS    @DL30SMP 10100000
*                                      EXTENSION SAVE AREA     @DL30SMP 10150000
         DROP  IJHREG13                                        @DL30SMP 10200000
.NC2     ANOP                                                  @DL30SMP 10250000
         AIF   (&SW(24)).ND            RDONLY SPECIFIED        @DL30SMP 10300000
         STM   IJHLLORG,IJHLHIRG,IJHMSAVE  SAVE REGISTERS               10350000
         AGO   .NE                                                  3-3 10400000
.ND      ANOP                                                       3-3 10450000
         STM   IJHLLORG,IJHLHIRG,0(IJHLSAVR) SAVE USER REGISTERS    3-3 10500000
.NE      ANOP                                                       3-3 10550000
         LM    IJHLIOAR,IJHLLGPS,IJHKADCN  IOAR, WRKL, KEYL, LGPS       10600000
         AIF   (NOT &SW(25)).NF                                     3-4 10650000
         L     IJHLOIOA,IJHKADCN       FOR ONE I/O AREA             3-4 10700000
         TM    IJHKOPCO,X'01'          ARE THERE 2 I/O AREAS        3-4 10750000
         BZ    IJHM1IOB                NO, BRANCH                   3-4 10800000
         LA    IJHLSVIO,IJHKXTBL       ADDR OF EXTENT TABLE         3-4 10850000
         AH    IJHLSVIO,IJHKIOPT       ADDR OF PREVIOUS I/O AREA    3-4 10900000
         L     IJHLOIOA,0(IJHLSVIO)        IN REGISTER              3-4 10950000
         TM    IJHKOPCO,X'40'          1ST TIME SW ON          @DA01038 11000000
         BO    IJHMLOC2                NO, SKIP RELOCATION     @DA01038 11050000
         OI    IJHKOPCO,X'40'          TURN 1ST TIME SW OFF    @DA01038 11100000
         LA    IJHLOIOA,4(IJHLSVIO)                            @DA01038 11150000
         S     IJHLOIOA,4(IJHLSVIO)    GET RELOCATION FACTOR   @DA01038 11200000
         A     IJHLOIOA,0(IJHLSVIO)                            @DA01038 11250000
         ST    IJHLOIOA,0(IJHLSVIO)    RELOCATE IOAREA2        @DA01038 11300000
IJHMLOC2 EQU   *                                               @DA01038 11350000
.NF      ANOP                                                       3-4 11400000
IJHM1IOB LH    IJHLKLEN,IJHKKLM1       KEY LENGTH - 1               3-4 11450000
         MVI   IJHKCCOD,0              RESET INDICATORS                 11500000
         AIF   (NOT &SW(25)).NG                                     3-4 11550000
         CLI   0(IJHLRTRN),X'AA'       WAS ENDFL ISSUED             3-4 11600000
         BE    IJHENDFL                YES, BRANCH                  3-4 11650000
.NG      ANOP                                                       3-4 11700000
         TM    IJHKFLAG,X'40'          Q-  1ST RCD IN FILE              11750000
         BO    IJHMFRST                NO KEY COMP ON 1ST RCD           11800000
         EX    IJHLKLEN,IJHMCMKY       COMPARE KEYS                     11850000
         BL    IJHMOKLO                OK IF OLD KEY LOW                11900000
         BE    IJHMOKEQ                ERROR IF EQUAL OR HIGH           11950000
         OI    IJHKCCOD,X'06'          SET OUT OF SEQ & DUP RCD INDIC   12000000
IJHMOKEQ XI    IJHKCCOD,X'04'          SET/RESET DUP RCD INDIC          12050000
         B     IJHMRTRN                ERROR EXIT                       12100000
IJHMFRST NI    IJHKFLAG,X'BF'          TURN OFF 1ST RCD INDIC           12150000
         AIF   (NOT &SW(25)).NH                                     3-4 12200000
         CR    IJHLOIOA,IJHLIOAR       ARE THERE 2 I/O AREAS        3-4 12250000
         BE    IJHMOKLO                NO, BRANCH                   3-4 12300000
         OI    IJHKCCB+2,X'80'   TURN ON TRAFFIC BIT                3-4 12350000
.NH      ANOP                                                       3-4 12400000
IJHMOKLO EX    IJHLKLEN,IJHMMVKY       MOVE KEY TO IOAREA               12450000
         LA    IJHLC256,256                                             12500000
         LH    IJHLLGLN,IJHKLLM1       LOGICAL RCD LEN - 1              12550000
*        LTR   IJHLLGLN,IJHLLGLN                                        12600000
*        BM    IJHMZDTA                                                 12650000
         SR    IJHLWORK,IJHLWORK       ZERO COUNTER                     12700000
         BXH   IJHLWORK,IJHLC256,IJHMEXMV  EXECUTE MOVE IF LEN LE 256   12750000
IJHMM256 MVC   0(256,IJHLLGPS),0(IJHLWRKL)  MOVE 256 BYTE SGMT TO IOAR  12800000
         AR    IJHLLGPS,IJHLC256       INCR IOAREA BASE                 12850000
         AR    IJHLWRKL,IJHLC256       INCR WORK AREA BASE              12900000
         BXLE  IJHLWORK,IJHLC256,IJHMM256  MOVE NEXT SGMT IF GT 256     12950000
IJHMEXMV EX    IJHLLGLN,IJHMVRMV       MOVE UP TO 256 BYTES             13000000
*JHMZDTA EQU   *                                                        13050000
         LA    IJHLONER,1                                               13100000
         L     IJHLWORK,IJHKPRCT       PRIME RCD CNT                    13150000
         ALR   IJHLWORK,IJHLONER       INCREMENT                        13200000
         ST    IJHLWORK,IJHKPRCT       SAVE                             13250000
         LH    IJHLRCNT,IJHKLGCT       LGCL RCD CNT                     13300000
         ALR   IJHLRCNT,IJHLONER       INCREMENT                        13350000
         AIF   (NOT &SW(25)).NI                                     3-7 13400000
         TM    IJHKOPCO,X'01'           ARE THERE 2 I/O AREAS       3-7 13450000
         BO    IJHMCKFL                 BRANCH IF YES               3-7 13500000
.NI      ANOP                                                       3-7 13550000
         CR    IJHLRCNT,IJHLONER       Q-  1ST LGCL RCD IN BLK          13600000
         BNE   IJHMCKFL                                                 13650000
         BAL   IJHLLNKA,IJHMRNBP       INCR RCD ID                      13700000
         STC   IJHLWORK,IJHKLPDR+7     UPDATE LST PD RCD ADDR RCD NO    13750000
         MVC   IJHKLPDR(7),IJHKSBKT    UPDATE LST PD RCD MBBCCHH        13800000
IJHMCKFL CH    IJHLRCNT,IJHKNRCD       Q-  BLOCK FULL                   13850000
         BL    IJHMUNFL                                                 13900000
         XC    IJHKLGCT(2),IJHKLGCT    ZERO LGCL RCD COUNT              13950000
         AIF   (NOT &SW(25)).NJ                                     3-4 14000000
         XR    IJHLIOAR,IJHLOIOA       SWITCH                       3-4 14050000
         XR    IJHLOIOA,IJHLIOAR           I/O                      3-4 14100000
         XR    IJHLIOAR,IJHLOIOA           AREAS                    3-4 14150000
         CR    IJHLOIOA,IJHLIOAR       ARE THERE 2 I/O AREAS        3-4 14200000
         BE    IJHMDADD                NO, BRANCH                   3-4 14250000
         ST    IJHLIOAR,IJHKADCN       SAVE I/O                     3-4 14300000
         ST    IJHLOIOA,0(IJHLSVIO)        AREAS                    3-4 14350000
.NJ      ANOP                                                       3-4 14400000
IJHMDADD EQU   *                                               @DL30SMP 14450000
         AIF   (NOT &SW(15)).NJ1       RPS NOT SPECIFIED       @DL30SMP 14500000
         ICM   IJHREG10,IJHXM1,IJHKCCB+IJHXD9 SET BASE FOR EXT @DL30SMP 14550000
.NJ1     ANOP                                                  @DL30SMP 14600000
         LA    IJHLLGPS,9(IJHLKLEN,IJHLIOAR)    IOAREA DATA ADDR    3-4 14650000
         ST    IJHLLGPS,IJHKBPOS       SAVE BLOCK POSITION              14700000
         AIF   (NOT &SW(23)).NM        ERREXT NOT SPECIFIED    @DL30SMP 14750000
         AIF   (NOT &SW(24)).NK        RDONLY NOT SPECIFIED    @DL30SMP 14800000
         MVI   64(13),X'80'            POST RECORD TYPE INDICATOR   3-4 14850000
         AGO   .NL                                                  3-4 14900000
.NK      ANOP                                                       3-4 14950000
         MVI   IJHMWORK+64,X'80'       POST RECORD TYPE INDICATOR   3-4 15000000
.NL      ANOP                                                       3-4 15050000
.NM      ANOP                                                       3-4 15100000
         AIF   (&SW(25)).NN                                         3-4 15150000
         BAL   IJHLLNKA,IJHMEXCP .     WRITE PRIME DATA RECORD          15200000
         AGO   .NO                                                  3-4 15250000
.NN      ANOP                                                       3-4 15300000
         CR    IJHLIOAR,IJHLOIOA .     ARE THERE TWO I/O AREAS      3-4 15350000
         BE    IJHM1IOA .              NO, BRANCH                   3-4 15400000
         BAL   IJHLLNKA,IJHMWAIT .     WAIT                         3-4 15450000
         BAL   IJHLLNKA,IJHMRCID  INCR S/S BUCKET                   3-4 15500000
         MVC   0(8,IJHLIOAR),0(IJHLOIOA)     MOVE CT. TO I/O AREA   3-9 15550000
         EX    IJHLKLEN,IJHMCTKY          TO NEW I/O AREA           3-4 15600000
         ST    2,IJHKRDWR               MOVE ADDR TO CCW            3-6 15650000
         MVI   IJHKRDWR,X'1D'           RESTORE OPCODE              3-6 15700000
         BAL   IJHLLNKC,IJHMEXCP       WRITE PRIME DATA RECORDS     3-4 15750000
         B     *+8                                                  3-7 15800000
IJHM1IOA BAL   IJHLLNKA,IJHMEXWT        WRITE PRIME DATA RECORD     3-7 15850000
.NO      ANOP                                                       3-4 15900000
         CLC   IJHKSBKT+6(1),IJHKTIDR  Q-  SHARED TRK                   15950000
         BH    IJHMPDTK                B IF NOT SHARED TRK              16000000
         CLC   4(1,IJHLIOAR),IJHKNRSH  Q-  END OF SHRD TRK              16050000
         BNE   IJHMRTRN                EXIT IF NOT END OF TRK           16100000
         AIF   (NOT &SW(25)).NP                                     3-4 16150000
         BAL   IJHLLNKA,IJHMWAIT       WAIT                         3-4 16200000
.NP      ANOP                                                       3-4 16250000
         MVC   7(1,IJHLLGPS),IJHKFDRC+1  R OF 1ST PD RCD ON SHRD TRK    16300000
         MVI   8(IJHLLGPS),X'08'       SET F TO TI ENTRY SHRD           16350000
         B     IJHMNDTK                TO END OF TRK RTN                16400000
         AIF   (NOT &SW(25)).NQ                                     3-4 16450000
IJHMRCID IC    IJHLWORK,4(IJHLOIOA)    REC NO FROM ID               3-4 16500000
         STC IJHLWORK,IJHKSBKT+7  TO S/S BKT                        3-4 16550000
         ALR   IJHLWORK,IJHLONER  INCREMENT                         3-4 16600000
         STC   IJHLWORK,4(IJHLOIOA)  TO ID                          3-4 16650000
         STC   IJHLWORK,IJHKLPDR+7  UPDATE LST PRIME DATA REC. NO   3-4 16700000
         MVC   IJHKLPDR(7),IJHKSBKT  UPDATE LST PD RCD MBBCCHH      3-4 16750000
         BR    IJHLLNKA                                             3-4 16800000
IJHENDFL EQU   *                                               @DL30SMP 16850000
         CR    IJHLIOAR,IJHLOIOA       ARE THERE 2 I/O AREAS        3-4 16900000
         BE    IJHMFXSS                NO, BRANCH                   3-4 16950000
         BAL   IJHLLNKA,IJHMWAIT       WAIT                         3-4 17000000
         ST    IJHLOIOA,IJHKADCN       RESTORE I/O AREA             3-4 17050000
IJHMFXSS LA    IJHLZERO,0                                           3-4 17100000
         CH    IJHLZERO,IJHKLGCT       WAS LAST BLOCK FULL     @DA05726 17150000
         BE    IJHMRDWR                YES, BRANCH                  3-4 17200000
         ST    IJHLIOAR,IJHKADCN       RESTORE I/O AREA             3-4 17250000
         LA    IJHLONER,1                                           3-4 17300000
         LR    IJHLOIOA,IJHLIOAR                                    3-4 17350000
         BAL   IJHLLNKA,IJHMRCID       INCR S/S BUCKET              3-4 17400000
         B     IJHMRDW1                                        @DA05726 17450000
IJHMRDWR ST    IJHLIOAR,0(IJHLSVIO)     RESTORE I/O AREA       @DA05726 17500000
         AIF   (NOT &SW(15)).NP1        RPS NOT SPECIFIED      @DM11935 17550000
IJHMRDW1 ICM   IJHREG10,IJHXM1,IJHKCCB+IJHXD9 SET BASE FOR EXT @DA05726 17600000
         MVC   IJHKRDWR+1(3),IJHKADCN+1  RESTORE CCW           @DA05726 17650000
         AGO   .NP2                                            @DA05726 17700000
.NP1     ANOP                                                  @DA05726 17750000
IJHMRDW1 MVC   IJHKRDWR+1(3),IJHKADCN+1 RESTORE CCW            @DA05726 17800000
.NP2     LA    IJHLRTRN,2(IJHLRTRN)    EXIT ADDRESS            @DA05726 17850000
         B     IJHMRTRN                                             3-4 17900000
.NQ      ANOP                                                       3-4 17950000
IJHMPDTK CLC   4(1,IJHLIOAR),IJHKNRPD  Q-  END OF PD TRK                18000000
         BNE   IJHMRTRN                EXIT IF NOT END OF TRK           18050000
         AIF   (NOT &SW(25)).NR                                     3-4 18100000
         BAL   IJHLLNKA,IJHMWAIT       WAIT                         3-4 18150000
.NR      ANOP                                                       3-4 18200000
         XC    7(2,IJHLLGPS),7(IJHLLGPS)  ZERO RF                       18250000
         AIF   (NOT &SW(15)).NR1       RPS NOT SPECIFIED       @DL30SMP 18300000
         MVI   IJHXARG2,IJHXZERO .     SET PD RD SEC ARG TO 0  @DL30SMP 18350000
.NR1     ANOP                                                  @DL30SMP 18400000
IJHMNDTK MVC   3(2,IJHLIOAR),IJHKLTIR+3  LST TI HR                      18450000
         MVI   6(IJHLIOAR),0           SET CNT DATA LEN TO 10           18500000
         MVI   7(IJHLIOAR),10          SET CNT DATA LEN TO 10           18550000
IJHMIXDA MVC   0(7,IJHLLGPS),IJHKSBKT  CURRENT TRK TO IOAREA DATA FIELD 18600000
         MVI   9(IJHLLGPS),X'1B'       SET P TO SEEK HH                 18650000
         AIF   (NOT &SW(23)).NU        ERREXT NOT SPECIFIED    @DL30SMP 18700000
         AIF   (NOT &SW(24)).NS        RDONLY NOT SPECIFIED    @DL30SMP 18750000
         MVI   64(13),X'40'            POST RECORD TYPE INDICATOR   3-4 18800000
         AGO   .NT                                                  3-4 18850000
.NS      ANOP                                                       3-4 18900000
         MVI   IJHMWORK+64,X'40'       POST RECORD TYPE INDICATOR   3-4 18950000
.NT      ANOP                                                       3-4 19000000
.NU      ANOP                                                       3-4 19050000
         BAL   IJHLLNKB,IJHMTIWR .     TO TI WRITER                     19100000
         MVC   7(3,IJHLLGPS),IJHMOVRF .SET RFP TO TI OVFLO END          19150000
         BAL   IJHLLNKB,IJHMTIWR .     TO TI WRITER                     19200000
         MVC   IJHKLTIR+3(2),3(IJHLIOAR)  SAVE TI TRK AND RCD NO        19250000
         CLC IJHKLPDR(6),IJHKPDUL .    END OF PD EXT                3-2 19300000
         BL    IJHMNLPD .                                               19350000
         CLC   IJHKLPDR+6(1),IJHKLTM1 .NXT TO LST PD TR IN CYL      3-2 19400000
         BL    IJHMNWTK                NO                           3-2 19450000
         OI    IJHKCCOD,X'20'          SET CCODE END OF XTNT INDIC      19500000
         OI    IJHKFLAG,X'20'          SET TABLE END OF XTNT INDIC      19550000
         B     IJHMRTRN                EXIT                             19600000
IJHMNLPD CLC   IJHKLPDR+6(1),IJHKLTM1  Q- NXT TO LST PD TRK IN CYL      19650000
         BH    IJHMCLND                GO TO END OF CYL RTN             19700000
IJHMNWTK IC    IJHLWORK,IJHKLPDR+6     CURRENT PD TRK NO                19750000
         ALR   IJHLWORK,IJHLONER       INCREMENT                        19800000
         STC   IJHLWORK,IJHKSBKT+6     SAVE IN S/S BKT                  19850000
         MVI   IJHKSBKT+7,0            ZERO PD RCD NO                   19900000
IJHMRSTR MVC   0(5,IJHLIOAR),IJHKSBKT+3  PD CCHHR TO CNT PRTN IOAREA    19950000
         MVC   6(2,IJHLIOAR),IJHKBKLN  BLK LEN TO COUNT DATA LEN        20000000
         B     IJHMRTRN                                                 20050000
IJHMCLND MVI   IJHKSBKT,1              CI/MI M NO = 1                   20100000
         MVC   6(4,IJHLLGPS),IJHMTIBG  HRFP OF CI DATA FIELD            20150000
         AIF   (NOT &SW(23)).NX        ERREXT NOT SPECIFIED    @DL30SMP 20200000
         AIF   (NOT &SW(24)).NV        RDONLY NOT SPECIFIED    @DL30SMP 20250000
         MVI   64(13),X'20' .          POST RECORD TYPE INDICATOR   3-4 20300000
         AGO   .NW                                                  3-4 20350000
.NV      ANOP                                                       3-4 20400000
         MVI   IJHMWORK+64,X'20' .     POST RECORD TYPE INDICATOR   3-4 20450000
.NW      ANOP                                                       3-4 20500000
.NX      ANOP                                                       3-4 20550000
         LA    IJHLCMPT,IJHKLCIR .     POINT AT CI BKT         @DL30SMP 20600000
         BAL   IJHLLNKB,IJHMCMWR .     GO WRITE CI ENTRY                20650000
         TM    IJHKMIXT,X'01'          Q-  USING MASTER INDEX           20700000
         BZ    IJHMNDCK                IF NOT, GO REINIT PD             20750000
         EX    0,IJHMIXDA              MBBCCHH OF CI TRK TO IOAREA DATA 20800000
         MVI   8(IJHLLGPS),X'02'       F OF MI DATA FIELD               20850000
         MVI   9(IJHLLGPS),X'1B'       P FOR CI/MI ENTRIES ON SAME CCH  20900000
         CLC   3(3,IJHLLGPS),IJHKLMIR  Q-  CI/MI ENTRIES ON SAME CCH    20950000
         BE    IJHMSPNT                                                 21000000
         MVI   9(IJHLLGPS),X'0B'       P FOR CI/MI ON SAME CC           21050000
         CLI   IJHKHNDV,X'02'          PD ON 2321                   4-0 21100000
         BNE   IJHMSPNT                BRANCH IF NOT                4-0 21150000
         CLC   3(2,IJHLLGPS),IJHKLMIR  Q-  CI/MI ON SAME CC             21200000
         BE    IJHMSPNT                                                 21250000
         MVI   9(IJHLLGPS),X'07'       P FOR CI/MI ON DIFRNT CC         21300000
IJHMSPNT EQU   *                                               @DL30SMP 21350000
         AIF   (NOT &SW(23)).N0        ERREXT NOT SPECIFIED    @DL30SMP 21400000
         AIF   (NOT &SW(24)).NY        RDONLY NOT SPECIFIED    @DL30SMP 21450000
         MVI   64(13),X'10'            POST RECORD TYPE INDICATOR   3-4 21500000
         AGO   .NZ                                                  3-4 21550000
.NY      ANOP                                                       3-4 21600000
         MVI   IJHMWORK+64,X'10'       POST RECORD TYPE INDICATOR   3-4 21650000
.NZ      ANOP                                                       3-4 21700000
.N0      ANOP                                                       3-4 21750000
         LA    IJHLCMPT,IJHKLMIR .     POINT AT MI BKT                  21800000
         BAL   IJHLLNKB,IJHMCMWR .     GO WRITE MI ENTRY                21850000
IJHMNDCK CLC   IJHKLPDR+3(3),IJHKPDEN .Q-  END OF PD VOL                21900000
         BE    IJHMNXPK .              B IF END                         21950000
         MVC   IJHKSBKT(6),IJHKLPDR .  CRNT PD MBBCCH TO S/S BKT        22000000
         LA    IJHLADDR,IJHKSBKT+3 .   POINT AT BKT                     22050000
         LA    IJHLCNTL,IJHKPDCT+3 .   POINT AT PD ADDR CNTRL FLD       22100000
         BAL   IJHLLNKA,IJHMUPDT       INCR ADDR                        22150000
IJHMNXCL MVC   IJHKSBKT+6(2),IJHKBFDR  HR OF RCD BEFORE 1ST PD RCD      22200000
         MVC   IJHKLTIR(3),IJHKSBKT+3  CCH TO LST TI ADDR FLD           22250000
         XC    IJHKLTIR+3(2),IJHKLTIR+3  ZERO TI HR                     22300000
         AIF   (NOT &SW(15)).N02       RPS NOT SPECIFIED       @DL30SMP 22350000
         MVI   IJHXARG2,IJHXZERO .     SET PD RD SEC ARG TO 0  @DL30SMP 22400000
         MVI   IJHXARG3,IJHXZERO .     SET TI RD SEC ARG TO 0  @DL30SMP 22450000
.N02     ANOP                                                  @DL30SMP 22500000
         B     IJHMRSTR                                                 22550000
IJHMNXPK IC    IJHLWORK,IJHKLPDR       CRNT M NO                        22600000
         ALR   IJHLWORK,IJHLONER       INCREMENT                        22650000
         STC   IJHLWORK,IJHKSBKT       SAVE IN S/S BKT                  22700000
         MVC   IJHKSBKT+3(3),IJHKPDBG  BEGIN VOL ADDR TO S/S BKT        22750000
         B     IJHMNXCL                                                 22800000
         CNOP  0,4                                                  3-4 22850000
IJHMUNFL STH   IJHLRCNT,IJHKLGCT       SAVE LGCL RCD CNT                22900000
         L     IJHLLGPS,IJHKBPOS       1ST BYTE OF CURRENT LGCL RCD     22950000
         AH    IJHLLGPS,IJHKLGLN       PLUS LGCL RCD LEN                23000000
         ST    IJHLLGPS,IJHKBPOS       SAVE BLOCK POSITION              23050000
         AIF   (&SW(24)).N1            RDONLY SPECIFIED        @DL30SMP 23100000
IJHMRTRN LM    IJHLLORG,IJHLHIRG,IJHMSAVE  RESTORE REGISTERS            23150000
         AGO   .N2                                                  3-3 23200000
.N1      ANOP                                                       3-3 23250000
IJHMRTRN LM    IJHLLORG,IJHLHIRG,0(IJHLSAVR) RESTORE USER REGISTERS 3-3 23300000
         AIF   (NOT &SW(15)).N2         RPS NOT SPECIFIED      @DL30SMP 23350000
         USING IJHXDTF,IJHREG13         DSECT FOR DTF EXTENT   @DL30SMP 23400000
         SH    IJHREG13,IJHXC184        TO THE DTF EXTENTION   @DL30SMP 23450000
         ST    IJHREG14,IJHXUR14        SAVE USER RETURN ADDR  @DL30SMP 23500000
         LA    IJHREG14,IJHKRTRN        LOAD ADDR EREXT RTRN   @DL30SMP 23550000
         ST    IJHREG14,IJHXMR14        SAVE ISMOD R14 IN EXT  @DL30SMP 23600000
         L     IJHREG14,IJHXAERT        PTR TO RPS ERREXT RTN  @DL30SMP 23650000
         L     IJHREG15,IJHXUR14        SET UP USER RTRN ADDR  @DL30SMP 23700000
         L     IJHREG13,IJHXUR13        RESTORE USER REG 13    @DL30SMP 23750000
         BR    IJHREG15                 RETURN TO USER (EREXT) @DL30SMP 23800000
         DROP  IJHREG13                                        @DL30SMP 23850000
         AGO   .N51                                            @DL30SMP 23900000
.N2      ANOP                                                       3-3 23950000
         AIF   (NOT &SW(23)).N8        ERREXT NOT SPECIFIED    @DL30SMP 24000000
         AIF   (&SW(24)).N5            RDONLY SPECIFIED        @DL30SMP 24050000
         BALR  14,14                   RETURN TO THE USER           3-4 24100000
         B     32(14)                  RE ENTER MODULE TO SKIP      3-4 24150000
         B     32(14)                  RE ENTER MODULE TO IGNORE    3-4 24200000
         LA    14,2(14)                PUT IT ON CORRECT BOUNDARY   3-4 24250000
         L     15,60(14)               RESTORE THE MOD BASE REGOSTR 3-4 24300000
         STM   2,9,IJHMSAVE            SAVE USER REGISTERS          3-4 24350000
         LM    14,9,IJHMWORK      RESTORE MOD REGISTERES            3-4 24400000
         NI    IJHKCCOD,X'7F'     TURN OFF ERROR BIT                3-4 24450000
         AIF   (NOT &SW(25)).N3                                     3-6 24500000
         B     IJHMRTRX                 GO TO RETRY THE I/O         3-6 24550000
         AGO   .N4                                                  3-6 24600000
.N3      B     IJHMRTRY                 GO TO RETRY THE I/O         3-6 24650000
.N4      ANOP                                                       3-6 24700000
         LA    14,2(14)                PUT IT ON CORRECT BOUNDARY   3-4 24750000
         L     15,60(14)               RESTORE THE MOD BASE REGOSTR 3-4 24800000
         STM   2,9,IJHMSAVE                                         3-4 24850000
         LM    14,9,IJHMWORK      RESTORE MOD REGISTERES            3-4 24900000
         NI    IJHKCCOD,X'7F'     TURN OFF ERROR BIT                3-4 24950000
         B     IJHMLEAV           GO TO IGNORE, SKIP ERR RECORD     3-4 25000000
         AGO   .N8                                                  3-4 25050000
.N5      ANOP                                                       3-4 25100000
         BALR  14,14                   LINK TO THE USER             3-4 25150000
.N51     ANOP                                                  @DL30SMP 25200000
IJHKRTRN EQU   *                                               @DL30SMP 25250000
         B     34(14)                                               3-4 25300000
         B     34(14)                                               3-4 25350000
         LM     14,1,0(IJHLSAVR)       RESTORE MOD BASE REGS        3-4 25400000
         MVC   48(16,IJHLSAVR),16(IJHLSAVR)                         3-4 25450000
        STM   2,9,0(IJHLSAVR)         SAVE THE USER REGISTERS       3-4 25500000
         LM    2,5,48(IJHLSAVR)                                     3-4 25550000
         LM    6,9,32(IJHLSAVR)                                @DA01505 25600000
         AIF   (NOT &SW(15)).N52       RPS NOT SPECIFIED       @DL30SMP 25650000
         ICM   IJHREG10,IJHXM1,IJHKCCB+IJHXD9 SET BASE FOR EXT @DL30SMP 25700000
.N52     ANOP                                                  @DL30SMP 25750000
         AIF   (NOT &SW(25)).N6                                     3-6 25800000
         B     IJHMRTRX                 GO TO RETRY THT I/O         3-6 25850000
         AGO   .N7                                                  3-6 25900000
.N6      B     IJHMRTRY                 GO TO RETRY I/O             3-6 25950000
.N7      ANOP                                                       3-6 26000000
         LM     14,1,0(IJHLSAVR)       RESTORE MOD BASE REGS        3-4 26050000
         MVC   48(16,IJHLSAVR),16(IJHLSAVR)                         3-4 26100000
        STM   2,9,0(IJHLSAVR)         SAVE THE USER REGISTERS       3-4 26150000
         LM    2,5,48(IJHLSAVR)                                     3-4 26200000
         LM    6,9,32(IJHLSAVR)                                @DA01505 26250000
         AIF   (NOT &SW(15)).N71       RPS NOT SPECIFIED       @DL30SMP 26300000
         ICM   IJHREG10,IJHXM1,IJHKCCB+IJHXD9 SET BASE FOR EXT @DL30SMP 26350000
.N71     ANOP                                                  @DL30SMP 26400000
         B     IJHMLEAV                IGNORE OR SKIP ERROR         3-4 26450000
.N8           ANOP                                                  3-4 26500000
         BR    IJHLRTRN                RETURN                           26550000
         AIF   (NOT &SW(23)).OA   ERREXT NOT SPECIFIED         @DL30SMP 26600000
         AIF   (&SW(24)).N9       RDONLY SPECIFIED             @DL30SMP 26650000
IJHMWORK DC    16F'0'             ERROR RETURN                      3-4 26700000
         DC    H'0'               SAVE AREA                         3-4 26750000
.N9      ANOP                                                       3-4 26800000
.OA      ANOP                                                       3-9 26850000
IJHMTIWR BAL   IJHLLNKA,IJHMIDBP       TO ID MOVER/INCR                 26900000
         CLC   IJHKSBKT+6(1),IJHKTIDR  Q-  LAST TI TRK IN CYL           26950000
         BE    IJHMSHRD                B IF TI TRK LST IN CYL           27000000
         AIF   (&SW(25)).OB                                         3-4 27050000
         BAL   IJHLLNKA,IJHMEXCP       WRITE NONSHRD TRK ENTRY      3-4 27100000
         AGO   .OC                                                  3-4 27150000
.OB      ANOP                                                       3-4 27200000
         MVC   IJHKRDWR+1(3),IJHKADCN+1 POINT CCW ADDR AT ENTRY     3-6 27250000
         BAL   IJHLLNKA,IJHMEXWT       WRITE NONSHRD TRK ENTRY      3-4 27300000
.OC      ANOP                                                       3-4 27350000
         CLC   4(1,IJHLIOAR),IJHKNRTI  Q-  END OF TI TRK                27400000
         BCR   4,IJHLLNKB              RETURN                           27450000
         IC    IJHLWORK,3(IJHLIOAR)    TI TRK NO                        27500000
         ALR   IJHLWORK,IJHLONER       INCREMENT                        27550000
         STC   IJHLWORK,3(IJHLIOAR)    SAVE                             27600000
         MVI   4(IJHLIOAR),0           ZERO TI RCD NO                   27650000
         AIF   (NOT &SW(15)).OC1       RPS NOT SPECIFIED       @DL30SMP 27700000
         MVI   IJHXARG3,IJHXZERO .     SET TI RD SEC ARG TO 0  @DL30SMP 27750000
.OC1     ANOP                                                  @DL30SMP 27800000
         BR    IJHLLNKB                RETURN                           27850000
IJHMSHRD EQU   *                                                    3-4 27900000
         AIF   (NOT &SW(25)).OD                                     3-4 27950000
         BAL   IJHLLNKA,IJHMWAIT       WAIT                         3-4 28000000
.OD      ANOP                                                       3-4 28050000
         STC   IJHLWORK,IJHKSBKT+7     SAVE CRNT RCD NO IN S/S BKT  3-4 28100000
         LA    IJHLWORK,8(IJHLIOAR)    ADDR KEY PRTN OF IOAREA          28150000
         ST    IJHLWORK,IJHKRDWR       POINT CCW ADDR AT KEY FIELD      28200000
         MVI   IJHKRDWR,X'0D'          MODIFY OP CODE TO WKD            28250000
         MVI   IJHKVERF,X'0E'          MODIFY OP CODE TO RKD            28300000
         AIF   (&SW(25)).OE                                         3-4 28350000
         BAL   IJHLLNKA,IJHMEXCP       WRITE SHRD TRK ENTRY         3-4 28400000
         AGO   .OF                                                  3-4 28450000
.OE      ANOP                                                       3-4 28500000
         BAL   IJHLLNKA,IJHMEXWT       WRITE SHRD TRK ENTRY         3-4 28550000
.OF      ANOP                                                       3-4 28600000
         ST    IJHLIOAR,IJHKRDWR       RESTORE CCW ADDR FIELD           28650000
         MVI   IJHKRDWR,X'1D'          RESTORE CCW OP CODE              28700000
         MVI   IJHKVERF,X'1E'          RESTORE CCW OP CODE              28750000
         BR    IJHLLNKB                RETURN                           28800000
IJHMCMWR MVC   0(5,IJHLIOAR),0(IJHLCMPT)  LAST CI/MI CCHHR TO ID FIELD  28850000
         BAL   IJHLLNKA,IJHMIDBP       TO ID MOVER/BUMPER               28900000
         STC   IJHLWORK,4(IJHLCMPT)    SAVE CI/MI RCD NO                28950000
         AIF   (&SW(25)).OG                                         3-4 29000000
         BAL   IJHLLNKA,IJHMEXCP       WRITE CI/MI                  3-4 29050000
         AGO   .OH                                                  3-4 29100000
.OG      ANOP                                                       3-4 29150000
         BAL   IJHLLNKA,IJHMEXWT       WRITE CI/MI                  3-4 29200000
.OH      ANOP                                                       3-4 29250000
         LR    IJHLADDR,IJHLCMPT                                        29300000
         LA    IJHLLNKA,IJHMZAPP                                        29350000
         CLC   4(1,IJHLIOAR),IJHKNRCM  Q-  NEXT TO LAST RCD ON TRK      29400000
         BL    IJHMNDCK                IF LOW, RETURN                   29450000
         BH    IJHMINCR                IF MORE, SET TO NEXT TRK         29500000
         LA    IJHLCNTL,IJHKCMCT+3     POINT AT CI/MI ADDR CNTRL FLD    29550000
         EX    0,IJHMCMPF              Q-  LAST TRK ON CYL/BAR          29600000
         BL    IJHMNDCK                IF LOW, RETURN                   29650000
         BAL   IJHLLNKA,IJHMUPDT       INCR ADDR                        29700000
IJHMZAPP MVI   4(IJHLCMPT),0           ZERO CI/MI RCD NO                29750000
         AIF   (NOT &SW(15)).OH1       RPS NOT SPECIFIED       @DL30SMP 29800000
         TM    IJHXTIO(IJHREG13),IJHXMI .MASTER INDEX I/O      @DL30SMP 29850000
         BNO   IJHXCYLI                NO, CYLINDER INDEX I/O  @DL30SMP 29900000
         MVI   IJHXARG5,IJHXZERO       SET SECTOR ARG # 5 TO 0 @DL30SMP 29950000
         B     IJHXCONT                RETURN TO CALLER        @DL30SMP 30000000
IJHXCYLI EQU   *                                               @DL30SMP 30050000
         MVI   IJHXARG4,IJHXZERO       SET SECTOR ARG # 4 TO 0 @DL30SMP 30100000
IJHXCONT EQU   *                                               @DL30SMP 30150000
.OH1     ANOP                                                  @DL30SMP 30200000
         BR    IJHLLNKB                RETURN                           30250000
IJHMIDBP MVC   IJHKSBKT+3(4),0(IJHLIOAR)  CCHH FROM ID TO S/S BUCKET    30300000
IJHMRNBP IC    IJHLWORK,4(IJHLIOAR)    RCD NO FROM ID                   30350000
         STC   IJHLWORK,IJHKSBKT+7     TO S/S BKT                       30400000
         ALR   IJHLWORK,IJHLONER       INCREMENT                        30450000
         STC   IJHLWORK,4(IJHLIOAR)    TO ID                            30500000
         BR    IJHLLNKA                                                 30550000
IJHMEXCP SR    IJHLMPTR,IJHLMPTR       ZERO M POINTER                   30600000
         IC    IJHLMPTR,IJHKSBKT       GET M NUMBER                     30650000
         SLL   IJHLMPTR,2              TIMES 4                          30700000
         LA    IJHLMPTR,IJHKXTBL-4(IJHLMPTR)  POINT AT CURNT M FLD      30750000
         MVC   IJHKCCB+6(2),0(IJHLMPTR)  LGCL UNIT ADDR TO CCB          30800000
         MVC   IJHKSBKT+1(2),2(IJHLMPTR)  BB TO SEEK FIELD              30850000
         AIF   (NOT &SW(15)).OH2       RPS NOT SPECIFIED       @DL30SMP 30900000
         B     IJHXRPS                 SET SECTOR ARGUMENTS    @DL30SMP 30950000
IJHXRPSR EQU   *                                               @DL30SMP 31000000
.OH2     ANOP                                                  @DL30SMP 31050000
IJHMRTRY SVC   0                  EXECUTE THE I/O                   3-4 31100000
         AIF   (NOT &SW(25)).OI                                     3-4 31150000
         BR    IJHLLNKC                                             3-4 31200000
IJHMRTRX LA    11,IJHMWAIT              FORCE WAIT AFTER RETRY      3-6 31250000
         B     IJHMRTRY                 GO TO RETRY THR I/O         3-6 31300000
IJHMEXWT BAL   IJHLLNKC,IJHMEXCP       EXCP                         3-4 31350000
.OI      ANOP                                                       3-4 31400000
IJHMWAIT TM    IJHKCCB+2,X'80'         WAIT                         3-4 31450000
         BO    *+6                                                      31500000
         SVC   7                                                        31550000
         AIF   (NOT &SW(23)).OK   ERREXT NOT SPECIFIED         @DL30SMP 31600000
         TM    IJHKCCB+3,X'D8'    DID AN ERROR OCCUR                3-4 31650000
         BC    7,IJHMEREX         IF YES, GO TO THE EROR EXIT       3-4 31700000
         TM    IJHKCCB+2,X'20'                                      3-4 31750000
         BO    IJHMEREX                                             3-4 31800000
IJHMLEAV XC    IJHKSBKT+1(2),IJHKSBKT+1     ZERO BUCKET COUNTER     3-4 31850000
         LA    IJHLONER,1               RESTORE WORK REGISTER       3-6 31900000
         BR    IJHLLNKA           RETURN TO THE CALLING ROUTINE     3-4 31950000
IJHMEREX OI    IJHKCCOD,X'80'     TURN ON BIT IN FILENAME C         3-4 32000000
         AIF   (&SW(24)).OJ            RDONLY SPECIFIED        @DL30SMP 32050000
         STM   14,9,IJHMWORK      SAVE THE MODULE REGISTERS         3-4 32100000
         ST    1,IJHMWORK+48      STORE THE DTF ADDR IN LIST        3-4 32150000
         MVC   IJHMWORK+56(8),IJHKSBKT      STORE DASD ADDR IN LIST 3-4 32200000
         MVC   IJHMWORK+52(4),IJHKADCN                              3-4 32250000
         SR    2,2                     ZERO CONPUTATION REG         3-4 32300000
         IC    2,IJHKSBKT+7            UPDATE TO CORRECT DASD ADDRES3-4 32350000
         LA    2,1(2)                                               3-4 32400000
         STC   2,IJHMWORK+63           PUT IT IN PARAMETER LIST     3-4 32450000
         L     1,12(1)            LOAD THE CSW CCW ADDR             3-4 32500000
         LA    2,8                THEN GET THE ADDR OF THE CCW      3-4 32550000
         SR    1,2                THAT ACTUALLY BLEW UP             3-4 32600000
         MVC     IJHMWORK+65(1),0(1)   SAVE THE OP COE OF BAD CCW   3-4 32650000
          TM     0(1),X'01'       WAS IT A WRITE OPERATION          3-4 32700000
         BO    IJHMWRIE           IF YES POST BIT IN LIST           3-4 32750000
         OI    IJHMWORK+64,X'02'  POST READ BIT IN LIST POSITION    3-4 32800000
         B     IJHMWRIE+4                                           3-4 32850000
IJHMWRIE OI      IJHMWORK+64,X'01'     POST BIT IN WRITE POSITON    3-4 32900000
         LA    1,IJHMWORK+48      POINT TO THE PARAMETER LIST       3-4 32950000
       AGO     .OL                                                  3-4 33000000
.OJ      ANOP                                                       3-4 33050000
         LM    10,12,32(IJHLSAVR)       RESTORE USER REGS      @DA20857 33100000
         STM   14,5,40(IJHLSAVR)       SAVE                    @DA01505 33150000
         LM    2,5,0(IJHLSAVR)             MODULE              @DA01505 33200000
         STM   6,9,0(IJHLSAVR)                   REGISTERS     @DA01505 33250000
         LM    6,9,16(IJHLSAVR)        STORE                   @DA01505 33300000
         MVC   16(16,IJHLSAVR),0(IJHLSAVR) USER                @DA01505 33350000
         MVC   0(16,IJHLSAVR),40(IJHLSAVR)       REGISTERS     @DA01505 33400000
         MVC   32(16,IJHLSAVR),16(IJHLSAVR)                    @DA01505 33450000
         MVC   16(16,IJHLSAVR),56(IJHLSAVR)                    @DA01505 33500000
         ST    2,68(IJHLSAVR)          SAVE REGISTER 2         @DA01505 33550000
         ST    1,48(IJHLSAVR)          SAVE THE DTF ADDR IN LIST    3-4 33600000
         MVC   52(4,IJHLSAVR),IJHKADCN                              3-4 33650000
         MVC   56(8,IJHLSAVR),IJHKSBKT SAVE DASD ERR ADDRESS        3-4 33700000
         SR    2,2                     ZERO CONPUTATION REG         3-4 33750000
         IC    2,IJHKSBKT+7            UPDATE TO CORRECT DASD ADDRES3-4 33800000
         LA    2,1(2)                                               3-4 33850000
         STC   2,63(IJHLSAVR)          PUT IT IN PARAMETER LIST     3-4 33900000
         L     1,12(1)                 GET CSW CCW ADDR             3-4 33950000
         LA    2,8                     GET ADDR OF CCW THAT ACTUALLY3-4 34000000
         SR    1,2                     FAILED                       3-4 34050000
         MVC   65(1,IJHLSAVR),0(1)     SAVE COMMAND CODE IN LIST    3-4 34100000
         TM    0(1),X'01'              WAS IT A WRITE               3-4 34150000
         BO    IJHMWRIE                IF YES POST BIT IN LIST      3-4 34200000
         OI    64(IJHLSAVR),X'02'      POST READ BIT IN LIST        3-4 34250000
         B     IJHMWRIE+4                                           3-4 34300000
IJHMWRIE OI    64(IJHLSAVR),X'01'      POST WRITE BIT IN LIST       3-4 34350000
         LA    1,48(IJHLSAVR)          POI T TO PARAMETER LIST      3-4 34400000
         L     2,68(IJHLSAVR)          RESTORE REGISTER 2      @DA01505 34450000
         AGO   .OL                                                  3-4 34500000
.OK           ANOP                                                  3-4 34550000
         XC    IJHKSBKT+1(2),IJHKSBKT+1  ZERO BB NUMBER             4-0 34600000
         TM    IJHKCCB+3,X'48'         Q-  TRK OVERRUN OR NO RCD FOUND  34650000
         BCR   8,IJHLLNKA              RETURN IF NO ERRORS              34700000
         OI    IJHKCCOD,X'80'          SET DASD ERROR INDIC             34750000
.OL      ANOP                                                       3-4 34800000
         CLI   0(IJHLRTRN),X'AA'       2 IO AREAS ?                 3-7 34850000
         AIF   (T'&ERREXT EQ 'O' OR T'&RDONLY EQ 'O').OP1      @DA01365 34900000
         BNE   IJHMRTRN+4              NO, RETURN              @DA01505 34950000
         AGO   .OQ1                                            @DA01365 35000000
.OP1     ANOP                                                  @DA01365 35050000
         BNE   IJHMRTRN                NO RETURN               @DA01365 35100000
.OQ1     ANOP                                                  @DA01365 35150000
         LA    IJHLRTRN,2(IJHLRTRN)                                 3-7 35200000
         AIF   (T'&ERREXT EQ 'O' OR T'&RDONLY EQ 'O').OR1      @DM08914 35250000
         B     IJHMRTRN+4              YES, ERROR RETURN       @DA01505 35300000
         AGO   .OS1                                            @DA01365 35350000
.OR1     ANOP                                                  @DA01365 35400000
         B     IJHMRTRN                NO RETURN               @DA08424 35450000
.OS1     ANOP                                                  @DA01365 35500000
         AIF   (NOT &SW(15)).OL1       RPS NOT SPECIFIED       @DL30SMP 35550000
IJHXRPS  EQU   *                                               @DL30SMP 35600000
         TM    IJHXIND,IJHXRPSF        RPS TYPE DTFIS          @DL30SMP 35650000
         BNO   IJHXRTRN .              NO, ISSUE SVC 0         @DL30SMP 35700000
         TM    IJHXIND,IJHXRPSI .      HI-INDEX DEV RPS TYPE   @DL30SMP 35750000
         BO    IJHXRPS0 .              YES, SET SECTOR ARG'S   @DL30SMP 35800000
         TM    IJHXTIO(IJHREG13),IJHXMICI .MI OR CI I/O        @DL30SMP 35850000
         BZ    IJHXRPS2 .              NO, TI I/O              @DL30SMP 35900000
         MVI   IJHXSSC1,IJHXNOOP .     SET SET SECTOR          @DL30SMP 35950000
         MVI   IJHXSSC2,IJHXNOOP .     AND READ SECTOR         @DL30SMP 36000000
         MVI   IJHXRSC1,IJHXNOOP .     CCW'S TO A NO-OP        @DL30SMP 36050000
         B     IJHXRTRN .              ISSUE SVC 0             @DL30SMP 36100000
IJHXRPS0 EQU   *                                               @DL30SMP 36150000
         TM    IJHXTIO(IJHREG13),IJHXMI .MASTER INDEX I/O      @DL30SMP 36200000
         BNO   IJHXRPS1 .              NO, CYLINDER INDEX I/O  @DL30SMP 36250000
         LA    IJHREG9,IJHXARG5 .      PUT ADDR SEC ARG FLD    @DL30SMP 36300000
         STCM  IJHREG9,IJHXM1,IJHXRSC1+IJHXD1 .# 5 INTO READ   @DL30SMP 36350000
* .                                    SECTOR CCW              @DL30SMP 36400000
         MVC   IJHXARG1(IJHXL1),IJHXARG5 .PUT SEC ARG FOR NEXT @DL30SMP 36450000
* .                                    MI RECORD INTO SECTOR   @DL30SMP 36500000
* .                                    ARGUMENT FIELD # 1      @DL30SMP 36550000
         LA    IJHLCMPT,IJHKLMIR       RESTORE REG 9           @DM09689 36600000
         B     IJHXRTRN                ISSUE SVC 0             @DL30SMP 36650000
IJHXRPS1 EQU   *                                               @DL30SMP 36700000
         TM    IJHXTIO(IJHREG13),IJHXCI .CYLINDER INDEX I/O    @DL30SMP 36750000
         BNO   IJHXRPS2 .              NO, TRACK INDEX I/O     @DL30SMP 36800000
         LA    IJHREG9,IJHXARG4 .      PUT ADDR SEC ARG FLD    @DL30SMP 36850000
         STCM  IJHREG9,IJHXM1,IJHXRSC1+IJHXD1 .# 4 INTO READ   @DL30SMP 36900000
* .                                    SECTOR CCW              @DL30SMP 36950000
         MVC   IJHXARG1(IJHXL1),IJHXARG4 .PUT SEC ARG FOR NEXT @DL30SMP 37000000
* .                                    CI RECORD INTO SECTOR   @DL30SMP 37050000
* .                                    ARGUMENT FIELD # 1      @DL30SMP 37100000
         LA    IJHLCMPT,IJHKLCIR       RESTORE REG 9           @DM09689 37150000
         B     IJHXRTRN                ISSUE SVC 0             @DL30SMP 37200000
IJHXRPS2 EQU   *                                               @DL30SMP 37250000
         TM    IJHXTIO(IJHREG13),IJHXTI .TRACK INDEX I/O       @DL30SMP 37300000
         BNO   IJHXRPS3 .              NO, PRIME DATA I/O      @DL30SMP 37350000
         LA    IJHREG9,IJHXARG3 .      PUT ADDR SEC ARG FLD    @DL30SMP 37400000
         STCM  IJHREG9,IJHXM1,IJHXRSC1+IJHXD1 .# 3 INTO READ   @DL30SMP 37450000
* .                                    SECTOR CCW              @DL30SMP 37500000
         MVC   IJHXARG1(IJHXL1),IJHXARG3 .PUT SEC ARG FOR NEXT @DL30SMP 37550000
* .                                    TI RECORD INTO SECTOR   @DL30SMP 37600000
* .                                    ARGUMENT FIELD # 1      @DL30SMP 37650000
         TM    IJHXIND,IJHXRPSI .      HI-INDEX DEV RPS TYPE   @DL30SMP 37700000
         BO    IJHXRTRN .              YES, ISSUE SVC 0        @DL30SMP 37750000
         B     IJHXRPS4 .              NO, SET UP PROPER READ  @DL30SMP 37800000
* .                                    AND SET SECTOR CCW      @DL30SMP 37850000
* .                                    OP-CODES                @DL30SMP 37900000
IJHXRPS3 EQU   *                                               @DL30SMP 37950000
         TM    IJHXTIO(IJHREG13),IJHXPD .PRIME DATA I/O        @DL30SMP 38000000
         BNO   IJHXERR .               NO, ERROR NO FLAG SET   @DL30SMP 38050000
         LA    IJHREG9,IJHXARG2 .      PUT ADDR SEC ARG FLD    @DL30SMP 38100000
         STCM  IJHREG9,IJHXM1,IJHXRSC1+IJHXD1 .# 2 INTO READ   @DL30SMP 38150000
* .                                    SECTOR CCW              @DL30SMP 38200000
         MVC   IJHXARG1(IJHXL1),IJHXARG2 .PUT SEC ARG FOR NEXT @DL30SMP 38250000
* .                                    PD RECORD INTO SECTOR   @DL30SMP 38300000
* .                                    ARGUMENT FIELD # 1      @DL30SMP 38350000
         TM    IJHXIND,IJHXRPSI .      HI-INDEX DEV RPS TYPE   @DL30SMP 38400000
         BO    IJHXRTRN .              YES, ISSUE SVC 0        @DL30SMP 38450000
IJHXRPS4 EQU   *                                               @DL30SMP 38500000
         MVI   IJHXSSC1,IJHXSSOC .     SET UP PROPER READ      @DL30SMP 38550000
         MVI   IJHXSSC2,IJHXSSOC .     AND SET SECTOR CCW      @DL30SMP 38600000
         MVI   IJHXRSC1,IJHXRSOC .     OP-CODES                @DL30SMP 38650000
IJHXRTRN EQU   *                                               @DL30SMP 38700000
         B     IJHXRPSR                ISSUE SVC 0             @DL30SMP 38750000
IJHXERR  EQU   *                                               @DL30SMP 38800000
         SVC   IJHSVC50                ERROR NO FLAG SET       @DL30SMP 38850000
.OL1     ANOP                                                  @DL30SMP 38900000
IJHMUPDT MVI   3(IJHLADDR),0           ZERO CRNT FLD IN ADDR            38950000
         BCTR  IJHLCNTL,0              DECR CNTRL POINTER               39000000
         BCTR  IJHLADDR,0              DECR ADDR POINTER                39050000
IJHMCMPF CLC   3(1,IJHLADDR),0(IJHLCNTL)  Q-  FIELD AT ITS UPPER LIMIT  39100000
         BNL   IJHMUPDT                B IF AT LMT                      39150000
IJHMINCR IC    IJHLWORK,3(IJHLADDR)    LOAD FLD                         39200000
         ALR   IJHLWORK,IJHLONER       INCREMENT                        39250000
         STC   IJHLWORK,3(IJHLADDR)    SAVE                             39300000
         BR    IJHLLNKA                RETURN                           39350000
IJHMCMKY CLC   8(0,IJHLIOAR),0(IJHLKEYL)  COMP PREV KEY VS CURNT KEY    39400000
IJHMMVKY MVC   8(0,IJHLIOAR),0(IJHLKEYL)  MOVE KEY TO IOAREA KEY FIELD  39450000
IJHMVRMV MVC   0(0,IJHLLGPS),0(IJHLWRKL)  MOVE UP TO 256 BYTES OF RCD   39500000
         AIF   (NOT &SW(25)).OM                                     3-4 39550000
IJHMCTKY MVC   8(0,IJHLIOAR),8(IJHLOIOA)     MOVE KEY TO I/O AREA   3-9 39600000
.OM      ANOP                                                       3-4 39650000
         AIF   (&SW(24)).OO            RDONLY SPECIFIED        @DL30SMP 39700000
         AIF   (&SW(25)).ON                                         3-4 39750000
IJHMSAVE DC    8F'0'                   SAVE AREA FOR REGS               39800000
         AGO   .OO                                                  3-4 39850000
.ON      ANOP                                                       3-4 39900000
IJHMSAVE DC    11F'0'  SAVE AREA FOR REGS                           3-4 39950000
.OO      ANOP                                                       3-3 40000000
IJHMTIBG DC    X'00000107'             HRFP OF NORMAL CI ENTRY          40050000
IJHMOVRF DC    X'FF1007'               RFP OF TI OVFLO END ENTRY        40100000
         AIF   (NOT &SW(15)).OO1       RPS NOT SPECIFIED       @DL30SMP 40150000
IJHXC184 DC    H'184'                  OFFSET TO DTFIS EXT S A @DL30SMP 40200000
.OO1     ANOP                                                  @DL30SMP 40250000
         AIF   (&SW(12)).AA            SEPASMB SPECIFIED       @DL30SMP 40300000
&SYSECT  CSECT                                                          40350000
