         TITLE 'PWRSASEX  -  SAS EXAMPLE PROGRAM'                       00001000
         MACRO                                                          00002000
&LABEL   DPLAY &LINE,&LENGTH,&ID=1                                      00003000
.*                                                                      00004000
         GBLB  &FDSP(15)                                                00005000
         LCLA  &LINLEN,&LENLEN                                          00006000
         LCLC  &LENREG,&LINREG,&DISP                                    00007000
         LCLB  &LENSW,&LINSW,&TXT,&DEF                                  00008000
.*                                                                      00009000
         AIF   (T'&ID EQ 'N' AND &ID LE 15).L001                        00010000
         MNOTE 8,'ID NOT NUMERIC OR GREATER THAN 15'                    00011000
         MEXIT                                                          00012000
.*                                                                      00013000
.L001    AIF   (T'&LINE NE 'O').L002                                    00014000
         MNOTE 8,'LINE NOT SPECIFIED'                                   00015000
         MEXIT                                                          00016000
.*                                                                      00017000
.L002    AIF   ('&LINE'(1,1) EQ '''').L003                              00018000
         AIF   (T'&LENGTH NE 'O').L004                                  00019000
         MNOTE 8,'LENGTH NOT SPECIFIED'                                 00020000
         MEXIT                                                          00021000
.*                                                                      00022000
.L003    ANOP                                                           00023000
&LENLEN  SETA  K'&LINE-2                                                00024000
&LENSW   SETB  1                                                        00025000
&TXT     SETB  1                                                        00026000
         AGO   .L007                                                    00027000
.*                                                                      00028000
.L004    ANOP                                                           00029000
         AIF   ('&LENGTH'(1,1) EQ '(').L006                             00030000
         AIF   (T'&LENGTH NE 'N').L005A                                 00031000
         AIF   (&LENGTH LE 120).L005                                    00032000
         MNOTE 4,'LENGTH = 120 ASSUMED'                                 00033000
&LENLEN  SETA  120                                                      00034000
&LENSW   SETB  1                                                        00035000
         AGO   .L007                                                    00036000
.*                                                                      00037000
.L005    ANOP                                                           00038000
&LENLEN  SETA  &LENGTH                                                  00039000
&LENSW   SETB  1                                                        00040000
         AGO   .L007                                                    00041000
.*                                                                      00042000
.L005A   ANOP                                                           00043000
         MNOTE 8,'INVALID LENGTH SPECIFICATION'                         00044000
         MEXIT                                                          00045000
.*                                                                      00046000
.L006    ANOP                                                           00047000
&LENLEN  SETA  K'&LENGTH-2                                              00048000
&LENREG  SETC  '&LENGTH'(2,&LENLEN)                                     00049000
.*       AIF   (T'&LENREG EQ 'N').L007                                  00050000
.*       MNOTE 8,'INVALID LENGTH SPECIFICATION'                         00051000
.*       MEXIT                                                          00052000
.*                                                                      00053000
.L007    ANOP                                                           00054000
         AIF   ('&LINE'(1,1) EQ '(').L008                               00055000
.*                                                                      00056000
&LINSW   SETB  1                                                        00057000
         AGO   .L009                                                    00058000
.*                                                                      00059000
.L008    ANOP                                                           00060000
&LINLEN  SETA  K'&LINE-2                                                00061000
&LINREG  SETC  '&LINE'(2,&LINLEN)                                       00062000
.*       AIF   (T'&LINREG EQ 'N').L009                                  00063000
.*       MNOTE 8,'INVALID REGISTER NOTATION FOR LINE SPECIFICATION'     00064000
.*       MEXIT                                                          00065000
.*                                                                      00066000
.L009    ANOP                                                           00067000
.*                                                                      00068000
         AIF   (&FDSP(&ID) NE 0).L010                                   00069000
&FDSP(&ID) SETB 1                                                       00070000
&DEF     SETB  1                                                        00071000
.*                                                                      00072000
&LABEL   DS    0H                                                       00073000
         B     DSPL&SYSNDX                                              00074000
DSCCB&ID CCB   SYSLOG,DSCCW&ID                                          00075000
DSCCW&ID CCW   X'09',0,X'20',0                                          00076000
.*                                                                      00077000
.L010    ANOP                                                           00078000
         AIF   (NOT &TXT).L012                                          00079000
         AIF   (&TXT AND &DEF).L011                                     00080000
.*                                                                      00081000
&LABEL   DS    0H                                                       00082000
         B     DSPL&SYSNDX                                              00083000
.*                                                                      00084000
.L011    ANOP                                                           00085000
.*                                                                      00086000
MDS&SYSNDX DC CL&LENLEN&LINE                                            00087000
.*                                                                      00088000
.L012    ANOP                                                           00089000
         AIF   (&DEF OR &TXT).L012A                                     00090000
&LABEL   DS    0H                                                       00091000
         AGO   .L012B                                                   00092000
.L012A   ANOP                                                           00093000
DSPL&SYSNDX DS 0H                                                       00094000
.L012B   ANOP                                                           00095000
         AIF   (&LENSW).L013                                            00096000
.*                                                                      00097000
         LR    0,&LENREG                                                00098000
         AGO   .L014                                                    00099000
.*                                                                      00100000
.L013    ANOP                                                           00101000
         LA    0,&LENLEN                                                00102000
.L014    ANOP                                                           00103000
         STCM  0,3,DSCCW&ID+6                                           00104000
.*                                                                      00105000
         AIF   (NOT &TXT).L017                                          00106000
         LA    0,MDS&SYSNDX                                             00107000
         AGO   .L019                                                    00108000
.*                                                                      00109000
.L017    AIF   ('&LINE'(1,1) NE '(').L018                               00110000
         LR    0,&LINREG                                                00111000
         AGO   .L019                                                    00112000
.*                                                                      00113000
.L018    ANOP                                                           00114000
         L     0,=A(&LINE)                                              00115000
.*                                                                      00116000
.L019    ANOP                                                           00117000
         STCM  0,7,DSCCW&ID+1                                           00118000
         L     1,=A(DSCCB&ID)                                           00119000
         EXCP  (1)                                                      00120000
         WAIT  (1)                                                      00121000
.*                                                                      00122000
         MEND                                                           00123000
         PUNCH ' PHASE PWRSASEX,*'                                      00124000
*********************************************************************** 00125000
**                                                                   ** 00126000
**                      P W R S A S E X                              ** 00127000
**                                                                   ** 00128000
**       VSE/POWER SPOOL ACCESS SUPPORT:  EXAMPLE PROGRAM            ** 00129000
**                                                                   ** 00130000
*********************************************************************** 00131000
*                                                                     * 00132000
*   THIS PROGRAM - NAMED PWRSASEX - ACTS AS A SPOOL-ACCESS-SERVICE    * 00133000
*   USER THAT INTERACTS WITH VSE/POWER USING THE SPOOL-ACCESS SUPPORT * 00134990
*                                                                     * 00136000
*   PWRSASEX CAN RUN IN ANY PARTITION, UNDER OR OUTSIDE THE CONTROL   * 00137000
*   OF VSE/POWER.  FOR SUCCESSFUL COMPLETION, HOWEVER, AN ADDITIONAL  * 00138000
*   PARTITION UNDER CONTROL OF VSE/POWER AND WITH EXECUTION ...       * 00139290
*                          C L A S S  =  4                            * 00139580
*   MUST BE WAITING FOR WORK.                                         * 00140000
*   N O T E : THE MANUAL SUGGESTS TO SUBMIT JOB 'PWRSARUN' TO THE     * 00140100
*             EXECUTION CLASS=A. PWRSARUN GIVES CONTROL TO 'PWRSASEX' * 00140200
*             THAT SUBMITS JOB 'EXAMPLE' FOR CLASS=4 AND THAT SURVEYS * 00140300
*             THE EXECUTION OF JOB EXAMPLE. YOU MAY CHANGE THE EXE-   * 00140400
*             CUTION CLASS OF JOB EXAMPLE BY ALTERING THE * $$ JOB    * 00140500
*             STATEMENT AT CODE LABEL 'JECL1'. JOB PWRSARUN AND JOB   * 00140600
*             EXAMPLE MAY EVEN HAVE THE SAME DYNAMIC CLASS, PROVIDED  * 00140700
*             THIS CLASS ALLOWS AT LEAST TWO PARTITIONS TO BE ACTIVE. * 00140800
*                                                                     * 00141000
*   THE PROGRAM'S OPERATIONAL STEPS ARE:                              * 00142000
*                                                                     * 00143000
*   1.  IDENTIFY ITSELF TO THE SYSTEM'S XPCC SUPPORT WITH THE USER    * 00144000
*       IDENTIFICATION 'PWRSASEX'.                                    * 00145490
*                                                                     * 00146000
*   2.  TRY TO ESTABLISH A COMMUNICATION PATH TO VSE/POWER -- TERMIN- * 00147000
*       ATE IF THIS PATH CANNOT BE ESTABLISHED WITHIN TWO MINUTES     * 00148000
*                                                                     * 00149000
*   3.  USE THE PUT SERVICE TO SUBMIT THE JOB 'EXAMPLE' TO THE        * 00150000
*       VSE/POWER RDR QUEUE FOR EXECUTION IN CLASS=4.                 * 00151490
*                                                                     * 00152000
*   4.  USE THE CTL SERVICE TO SUBMIT A PDISPLAY COMMAND, IN          * 00153590
*       ORDER TO LOCATE THE OUTPUT OF JOB 'EXAMPLE' IN THE            * 00154180
*       VSE/POWER LST QUEUE, AND SHOW THE QUEUE-DISPLAY MESSAGE ON    * 00155000
*       THE CONSOLE. IF THE OUTPUT IS NOT YET AVAILABLE, THE PROGRAM  * 00156590
*       RE-ISSUES THE PDISPLAY COMMAND EVERY 10TH OF A SECOND FOR TWO * 00157180
*       MINUTES.  IF THEN THE OUTPUT IS STILL NOT AVAILABLE, PWRSASEX * 00158000
*       TERMINATES.                                                   * 00159000
*       N O T E :  THE CTL SERVICE IS PRESENTED IN TWO FLAVOURS, YOU  * 00159300
*                  MAY SELECT FLAVOUR TWO AT CODE LABEL 'CTL1'.       * 00159600
*                                                                     * 00160000
*   5.  RETRIEVE THE LST QUEUE ENTRY 'EXAMPLE' USING THE GET SERVICE. * 00161000
*       N O T E :  THE GET SERVICE IS PRESENTED IN TWO FLAVOURS ACC.  * 00161300
*                  TO THE PRE-SELECTION AT CODE LABEL 'CTL1'.         * 00161600
*                                                                     * 00162000
*       THE PROGRAM CAUSES THE COMPLETE ENTRY TO BE DISPLAYED ON THE  * 00163000
*       CONSOLE. PWRSASEX ISSUES A GET-RESTART REQUEST THAT POSITIONS * 00164490
*       THE RETRIEVAL POINTER IN THE MIDDLE OF THE QUEUE ENTRY AND    * 00165000
*       REDISPLAYS THE SECOND HALF.                                   * 00166000
*                                                                     * 00167000
*       PWRSASEX ENDS GET PROCESSING BY ISSUING A QUIT REQUEST.       * 00168000
*                                                                     * 00169000
*   6.  SUBMIT THE DATA CARDS OF JOB 'EXAMPLE' TO THE VSE/POWER       * 00173000
*       LST-QUEUE AS ENTRY 'EXAMPSEG' AND ISSUE PUT-SEGMENT REQUESTS  * 00174000
*       TO GET THREE (RBS-LIKE) SEGMENTS OF EQUAL SIZE.               * 00175490
*                                                                     * 00176000
*       NOTE: THE ASA CONTROL 'CHARACTER PRINT-AND-SKIP-2' IS USED    * 00177000
*             FOR THE SUBMITTED LINES.                                * 00178000
*                                                                     * 00179000
*   7.  DISCONNECT THE COMMUNICATION PATH TO VSE/POWER.               * 00180000
*                                                                     * 00181000
*   8.  TERMINATE (LOG OFF FROM) THE VSE XPCC SUPPORT.                * 00182000
*                                                                     * 00183000
*   9.  TERMINATE PWRSASEX PROGRAM.                                   * 00183300
*                                                                     * 00183600
*********************************************************************** 00184000
*                                                                     * 00185000
*  THE FOLLOWING MACROS ARE REQUIRED:                                 * 00186000
*                                                                     * 00187000
*      SYSTEM MACROS:  XPCC                                           * 00188000
*                      XPCCB                                          * 00189000
*                      MAPXPCCB                                       * 00190000
*                      SETIME                                         * 00192000
*                      WAITM                                          * 00193000
*                      WAIT                                           * 00194000
*                                                                     * 00195000
*      VSE/POWER:      PWRSPL                                         * 00196000
*                                                                     * 00197000
*                                                                     * 00198000
*      AN INLINE MACRO (AVAILABLE WITH THE EXAMPLE).  IT IS USED FOR  * 00199000
*      DISPLAYING MESSAGES ON THE CONSOLE.  THE MACRO CALLS ARE IN    * 00200000
*      THE FORMAT:                                                    * 00201000
*                                                                     * 00202000
*          DPLAY MESSAGE-LABEL,LENGTH                                 * 00203000
*          DPLAY (REG1),(REG2)                                        * 00204000
*                                                                     * 00205000
*  NOTE: LINES WITH THE @-SIGN AT THE END REPRESENT THE INTERFACE     * 00206000
*        TO VSE/POWER.                                                * 00207000
*        LINES WITHOUT THE @-SIGN AT THE END REPRESENT THE INTERFACE  * 00208000
*        TO THE SYSTEM'S XPCC SUPPORT (STEPS 1, 2, 7, 8 AND 9).       * 00209490
*                                                                     * 00210000
*  CHANGE ACTIVITY:                                                   * 00211000
*                                                                     * 00212000
*   DO NOT CONNECT TO POWER IF XPCC IDENT RC >= X'08'         @DY43262* 00213000
*   VSE/POWER 6.1.1 TURBO DISPATCHER SHIPMENT                 @DY44055* 00214290
*   GUIDANCE FOR FIXED-FORMAT DISPLAY AND DIRECT GET REQUEST  @DY45495* 00214580
*********************************************************************** 00215000
         EJECT                                                          00216000
         SPACE 2                                                        00217000
*        REGISTER USAGE                                                 00218000
         SPACE 1                                                        00219490
*        R0 - **** - WORK REGISTER                                      00220000
*        R1 - **** - WORK REGISTER, ALSO USED BY PWRSPL MACRO           00221000
*        R2 - **** - WORK REGISTER                                      00222000
*        R3 - **** - WORK REGISTER                                      00223000
*        R4 - **** - ADDR REG FOR CROSS PARTITION CONTROL BLOCK XPCCB   00224000
*        R5 - **** - ADDRESS REGISTER FOR USER DATA TO BE SENT          00225000
*        R6 - **** - ADDRESS REGISTER FOR RECEIVED USER DATA            00226000
*        R7 - **** - ADDRESS REGISTER FOR SPL DSECT                     00227000
*        R8 - **** - FIRST BASE REGISTER OF PWRSASEX                    00228000
*        R9 - **** - SECOND BASE REGISTER OF PWRSASEX                   00229000
*        RA - **** - WORK REGISTER                                      00230000
*        RB - **** - WORK REGISTER                                      00231000
*        RC - **** - WORK REGISTER                                      00232000
*        RD - **** - BRANCH AND LINK REGISTER FOR SENDR SUBROUTINE      00233000
*        RE - **** - BRANCH AND LINK REGISTER FOR DATDSPLY SUBROUTINE   00234000
*        RF - **** - MACRO CALL RETURN CODE REGISTER                    00235000
         EJECT                                                          00236000
SAMPIN   START 120                 START OF THIS SAMPLE PROGRAM         00237000
         BALR  R8,0                GET START ADDRESS                    00238000
         USING *,R8,R9             ESTABLISH ADDRESSABILITY             00239000
         SPACE 1                                                        00240490
         LA    R9,4095(,R8)        LOAD SECOND BASE REGISTER WITH       00241000
         LA    R9,1(,R9)           CONTENTS OF FIRST + 4096             00242000
         SPACE 1                                                        00243490
         LA    R4,OWNXPCCB         GET ADDR OF CROSS PART. CONTROL BLK  00244000
         USING IJBXPCCB,R4         ESTABLISH ADDRESSABILITY FOR DSECT   00245000
         SPACE 2                                                        00246000
         LA    R5,IJBXSUSR         GET ADDR OF USER DATA TO BE SENT     00247000
         USING PXUUSER,R5          ESTABLISH ADDRESSABILITY FOR DSECT   00248000
         SPACE 2                                                        00249000
         LA    R6,IJBXRUSR         GET ADDR OF RECEIVED USER DATA       00250000
         USING PXPUSER,R6          ESTABLISH ADDRESSABILITY FOR DSECT   00251000
         SPACE 2                                                        00252000
         LA    R7,OWNSPL           GET ADDR OF SPL                      00253000
         USING OWNSPLDS,R7         ESTABLISH ADDRESSABILITY FOR DSECT   00254000
         SPACE 2                                                        00254300
         MVC   FAILCOPY,FAILMSG    PRESERVE EMPTY MESSAGE SKELETON      00254600
         EJECT                                                          00255000
*********************************************************************** 00256000
**                     S T E P :   1                                 ** 00257490
**          >> IDENTIFY PWRSASEX AS VSE/AF XPCC USER <<              ** 00257980
** IF THE MACRO FAILS, THE PROGRAM DISPLAYS A MESSAGE AND TERMINATES ** 00258470
**  - WITHOUT A DUMP IF IT FAILED BECAUSE OF LACK OF STORAGE         ** 00259000
**  - WITH A DUMP OTHERWISE.                                         ** 00260490
*********************************************************************** 00261000
         SPACE 1                                                        00262000
IDENT    DS    0H                                                       00263000
         SPACE 1                                                        00264000
         XPCC  XPCCB=(R4),FUNC=IDENT   IDENTIFY 'PWRSASEX' TO AF-XPCC   00265000
         SPACE 1                                                        00266000
         CLM   RF,M1,EIGHTDC       RETURN CODE < X'08'?                 00267590
         BL    CONCT               ..YES, CONNECT TO POWER              00268180
         SPACE 1                                                        00269000
         MVC   FAILFUNC,=C'IDENTIFY'  INSERT FAILING FUNCTION INTO MSG  00270000
         BAL   RE,MSGRETC          INSERT XPCC RETURN CODE INTO MSG     00271000
         MVC   FAILLABL,=C'IDENT ' INSERT CODE LABEL FOR DIAGNOSTIC     00272490
         BAL   RE,MSGDSPLY         DISPLAY MESSAGE ON CONSOLE           00273000
         CLI   IJBXRETC,IJBXNSTO   DID IDENT FAIL DUE TO NO STORAGE ?   00274000
         BE    FINEND              ..YES, TERMINATE WITH EOJ MACRO      00275000
         B     FINDUMP             BRANCH TO TERMINATION WITH DUMP      00276000
         EJECT                                                          00277000
*********************************************************************** 00278000
**                     S T E P :   2                                 ** 00278500
**      >> ESTABLISH THE XPCC CONNECTION TO VSE/POWER <<             ** 00279000
** IF THE MACRO FAILS, THE PROGRAM DISPLAYS A FAILURE MESSAGE AND    ** 00280000
** TERMINATES.  THE PROGRAM WAITS UP TO TWO MINUTES FOR THE CONNEC-  ** 00281490
** TION TO BE COMPLETED.                                             ** 00282000
** IF THE CONNECTION IS ESTABLISHED AS REQUESTED, THE PROGRAM DIS-   ** 00283000
** PLAYS A CONFIRMATION MESSAGE.                                     ** 00284000
*********************************************************************** 00285000
         SPACE 1                                                        00286000
CONCT    DS    0H                                                       00287000
         SPACE 1                                                        00288000
         XPCC  XPCCB=(R4),FUNC=CONNECT        CONNECT TO VSE/POWER      00289000
         SPACE 1                                                        00290000
         LTR   RF,RF               IS CONNECTION ALREADY AVAILABLE ?    00291000
         BZ    CONNOK              ..YES, BYPASS WAIT FOR CONNECTION    00292000
         SPACE 1                                                        00293000
         CLM   RF,M1,EIGHTDC        WAS RETURN CODE X'08' GIVEN BACK ?  00294000
         BL    WAITCECB            ..NO, MUST BE '04', SO WAIT FOR CECB 00295000
         CLI   IJBXRETC,IJBXQSCE   DID POWER GIVE XPCC TERMQSCE ?       00296000
         BE    TERMQSCE            ..YES, GO TO HANDLE THAT STATE       00297000
         MVC   FAILFUNC,=C'CONNECT '   INSERT FAILING FUNCTION INTO MSG 00298000
         BAL   RE,MSGRETC          INSERT XPCC RETURN CODE INTO MSG     00299000
         MVC   FAILLABL,=C'CONCT ' INSERT CODE LABEL FOR DIAGNOSTIC     00300490
         BAL   RE,MSGDSPLY         DISPLAY MESSAGE ON CONSOLE           00301000
         CLI   IJBXRETC,IJBXNSTO   DID CONNECT FAIL DUE TO NO STOR. ?   00302000
         BE    TERMN               ..YES, GO TO CLOSE XPCC INTERFACE    00303000
         SPACE 1                                                        00304000
         B     FINDUMP             GO TO TERMINATION WITH DUMP          00305000
         SPACE 1                                                        00306000
TERMQSCE DS    0H                                                       00307000
         DPLAY FAILM1,72           DISPLAY FAILURE MESSAGE              00308000
         SPACE 1                                                        00309000
         B     TERMN               GO TO CLOSE XPCC INTERFACE CORRECTLY 00310000
         SPACE 1                                                        00311000
WAITCECB DS    0H                  CONNECTION IS STILL 'PENDING'        00312000
         SETIME 120,INTECB         INSTALL WAIT INTERVAL OF TWO MIN.    00313000
         LA    R3,IJBXCECB         LOAD ADDRESS OF CONNECTION ECB       00314000
         ST    R3,LISTCECB         COMPLETE WAITLIST                    00315000
         WAITM WAITLIST            WAIT FOR CONNECTION OR 2 MIN. COMPL. 00316000
         TM    IJBXCECB+2,POSTBIT  CONNECTION COMPLETE?                 00317000
         BO    CONNOK              ..YES, CONTINUE AT CONNOK            00318490
         SPACE 1                                                        00319000
         DPLAY FAILM3,72           ISSUE MSG THAT TIME LIMIT EXCEEDED   00320000
         SPACE 1                                                        00321000
         B     DISCT               GO TO DISCONNECT AND TERMINATE       00322000
         SPACE 1                                                        00323000
CONNOK   DS    0H                  NOW, CONNECTION ECB IS POSTED        00324000
         DPLAY SUCCM1,72                                                00325000
         EJECT                                                          00326000
**********************************************************************@ 00327000
**                     S T E P :   3                                 *@ 00327500
**      >>          PUT-REQUEST TO RDR QUEUE          <<             *@ 00328000
**  THE JOB 'EXAMPLE' IS SUBMITTED TO THE VSE/POWER RDR QUEUE.       *@ 00329000
**********************************************************************@ 00330000
         SPACE 1                                                      @ 00331000
*        REGISTER USAGE FOR PUT-REQUEST TO RDR QUEUE                  @ 00332000
         SPACE 2                                                      @ 00333000
*        R3 -  *****  - WORK REGISTER                                 @ 00334000
*        RA - BUFPTR  - POINTER FOR THE SEND BUFFER                   @ 00335000
*        RB - DATAPTR - POINTER FOR THE INPUT CARDS                   @ 00336000
*        RC -  *****  - TEMPORARY ADDR. REG FOR SPL DSECT             @ 00337000
         SPACE 2                                                      @ 00338000
*   THE GENERATED SPL (OWNSPL) IS UPDATED INDICATING A PUT OPEN       @ 00339000
*   REQUEST AND IS THEN SENT TO VSE/POWER.                            @ 00340490
         SPACE 2                                                      @ 00341000
PUTA1    DS    0H                                                     @ 00342000
         SPACE 1                                                      @ 00342100
         DPLAY SUCCM1A,72                                               00342200
         SPACE 1                                                      @ 00342300
*        THE SPL IS UPDATED FOR A 'PUT-OPEN JOB' REQUEST, SPECIFYING  @ 00342400
*         - THE MANDATORY FIELDS 'QUEUE, USERID'                      @ 00342500
*         FOR DETAILS ON MANDAT./OPT. FIELDS SEE PWRSPL REQ=PUT (JOB).@ 00342600
*         NOTE: THE JOB ATTRIBUTES WILL BE EXTRACTED FROM THE JECL    @ 00342700
*               JOB STATEMENT SUBMITTED LATER WITH THE JOB DATA.      @ 00342800
         SPACE 1                                                      @ 00342900
         PWRSPL TYPE=UPD,SPL=OWNSPL,REQ=PUT,QUEUE=RDR                 @ 00343000
         SPACE 2                                                      @ 00344000
         MVI   PXUBTYP,PXUBTSPL    INDICATE BUFFER TYPE = SPL         @ 00345000
         MVI   PXUACT1,0           CLEAR ALL OTHER BYTES IN PXUUSER,  @ 00346000
         MVI   PXUSIGNL,0          WHICH MAY BE CHANGED BY THE USER   @ 00347000
         SPACE 1                                                      @ 00348000
*        THE SPL IS DIRECTLY USED AS XPCC SEND BUFFER                 @ 00349000
         SPACE 1                                                      @ 00350000
         STCM  R7,M7,IJBXADR       INSERT SPL ADDRESS AS BUFFER ADDR. @ 00351000
         LA    R3,SPLGLEN          LOAD LENGTH OF SPL                 @ 00352000
         ST    R3,IJBXBLN          INSERT BUFFER LENGTH INTO XPCCB    @ 00353000
         SPACE 1                                                      @ 00354000
         MVC   FAILLABL,=C'PUTA1 ' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00355490
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00356000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00357000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00358000
*        THE VERIFICATION SPL RETURNED BY VSE/POWER FOR A PUT-OPEN    @ 00359190
*        REQUEST IS IGNORED, THE VERIFICATION SPL RETURNED LATER FOR  @ 00359380
*        A PUT-CLOSE REQUEST MAY BE OF MORE INTEREST.                 @ 00359570
         SPACE 2                                                      @ 00360000
*        FOR THE SUBSEQUENT 'PUT-SPOOL' REQUESTS THE PXU-USER FIELD   @ 00360300
*        SETTINGS ARE ESTABLISHED, AND                                @ 00360600
*        THE SEND BUFFER IS FILLED WITH INPUT CARDS (EACH CARD        @ 00361000
*        PRECEDED BY A RECORD PREFIX) UNTIL NO MORE CARD FITS.        @ 00362000
*        THE BUFFER IS THEN PASSED TO VSE/POWER IN THE ACTUALLY       @ 00363000
*        USED LENGTH.                                                 @ 00364000
         SPACE 1                                                      @ 00365000
         MVI   PXUBTYP,PXUBTNDB    BUFFER TYPE = NORMAL DATA BUFFER   @ 00366000
         MVI   PXUACT1,0           CLEAR ACTION BYTE                  @ 00367000
         SPACE 1                                                      @ 00368000
         LA    BUFPTR,SENDBUF      GET ADDRESS OF SEND BUFFER         @ 00369000
         STCM  BUFPTR,M7,IJBXADR   INSERT BUFFER ADDRESS INTO XPCCB   @ 00370000
         LA    DATAPTR,JECL1       GET ADDR OF FIRST INPUT CARD, ...  @ 00371290
*                                  USUALLY THE * $$ JOB STATEMENT     @ 00371580
         SPACE 1                                                      @ 00372000
FILLBUF  DS    0H                                                     @ 00373000
         CLC   ENDIND,0(DATAPTR)   END OF FILE REACHED?             @ 0 00374490
         BE    PUTA3               YES, GO TO SEND FINAL BUFFER       @ 00375000
         CL    BUFPTR,LASTPREC     ENOUGH SPACE FOR ONE MORE RECORD?  @ 00376000
         BH    PUTA2               NO, GO TO SEND NORMAL BUFFER       @ 00377000
         USING RECPRFIX,BUFPTR     GET DSECT FOR RECORD LAYOUT        @ 00378000
         XC    0(RECPRFXL,BUFPTR),0(BUFPTR)   CLEAR BYTES FOR PREFIX  @ 00379000
         MVI   RECTYPE,RECTNORM    INSERT REC. TYPE IN REC. PREFIX    @ 00380000
         LA    R3,L'DATACARD       LOAD LENGTH OF DATA CARD           @ 00381000
         STH   R3,RECLNGTH         INSERT LENGTH OF DATA CARD IN PREF.@ 00382000
         LA    BUFPTR,RECPRFXL(,BUFPTR)        SKIP PREFIX IN BUFFER  @ 00383000
         DROP  BUFPTR                                                 @ 00384000
         MVC   0(L'DATACARD,BUFPTR),0(DATAPTR) MOVE DATA INTO BUFFER  @ 00385000
         LA    BUFPTR,L'DATACARD(,BUFPTR)   POINT TO NEXT FREE B.SPACE@ 00386000
         LA    DATAPTR,L'DATACARD(,DATAPTR) POINT TO NEXT INPUT CARD  @ 00387000
         B     FILLBUF             TRY TO FILL IN NEXT INPUT CARD     @ 00388000
         SPACE 1                                                      @ 00389000
PUTA2    DS    0H                                                     @ 00390000
         LA    R3,SENDBUF          GET AGAIN START ADDR OF SEND BUFFER@ 00391000
         SR    BUFPTR,R3           CALC. ACTUALLY USED BUFFER LENGTH  @ 00392000
         ST    BUFPTR,IJBXBLN      INSERT ACTUAL BUF.LENGTH INTO XPCCB@ 00393000
         MVC   FAILLABL,=C'PUTA2 ' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00394490
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00395000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00396000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00397000
         LA    BUFPTR,SENDBUF      GET AGAIN ADDRESS OF SEND BUFFER   @ 00398000
         B     FILLBUF             GO TO FILL BUFFER AGAIN            @ 00399000
         SPACE 2                                                      @ 00400190
*        FOR THE SUBSEQUENT 'PUT-CLOSE' REQUEST THE PXU-USER FIELD    @ 00400380
*        IS SET UP WITH THE END-OF-DATA INDICATION, AND               @ 00400570
*        THE BUFFER BEING FILLED WHEN END OF FILE WAS DETECTED        @ 00401000
*        IS PASSED TO VSE/POWER AS FINAL BUFFER.                      @ 00402990
         SPACE 1                                                      @ 00404000
PUTA3    DS    0H                                                     @ 00405000
         SPACE 1                                                      @ 00406000
         MVI   PXUACT1,PXUATEOD    INDICATE END OF DATA               @ 00407000
         LA    R3,SENDBUF          GET AGAIN START ADDR OF SEND BUFFER@ 00408000
         SR    BUFPTR,R3           CALC. ACTUALLY USED BUFFER LENGTH  @ 00409000
         ST    BUFPTR,IJBXBLN      INSERT ACTUAL BUF.LENGTH INTO XPCCB@ 00410000
         MVC   FAILLABL,=C'PUTA3 ' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00411490
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00412000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00413000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00414000
         CLI   PXPFBKCD,PXP00OK    WAS POWER FEEDBACKCODE ALSO ZERO?  @ 00415000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00416000
         SPACE 1                                                      @ 00417000
*   THE VERIFICATION SPL RETURNED BY VSE/POWER IS ANALYZED, AND       @ 00418490
*   JOBNAME AND JOBNUMBER ARE SAVED.                                  @ 00419000
*   IF MESSAGES ARE QUEUED, A 'RETURN MESSAGE' REQUEST IS SENT. SUB-    00420490
*   SEQUENTLY, THE DATDSPLY ROUTINE IS CALLED IN ORDER TO DISPLAY     @ 00421000
*   THE RETURNED MESSAGES.                                            @ 00422000
         SPACE 1                                                      @ 00423000
         LA    RC,REPLBUF          GET AD. OF REPLY AREA FOR SPL DSECT@ 00424000
         DROP  R7                                                     @ 00425000
         USING OWNSPLDS,RC         ESTABLISH ADDRESSABILITY FOR DSECT @ 00426000
         MVC   JOBNAME,SPLGJB      SAVE JOBNAME RETURNED BY POWER     @ 00427000
         MVC   JOBNUM,SPLGJN       SAVE RETURNED BINARY JOBNUMBER     @ 00428490
         DROP  RC                                                     @ 00429000
         USING OWNSPLDS,R7         REESTABLISH ADDRESSABILITY FOR SPL @ 00430000
         SPACE 1                                                      @ 00431000
         TM    PXPINFO,PXPIMSG     ARE MESSAGES QUEUED?               @ 00432000
         BZ    CTL1                NO, CONTINUE WITH CONTROL REQUEST  @ 00433490
         SPACE 1                                                      @ 00434000
PUTA4    DS    0H                                                     @ 00435000
         XC    IJBXBLN,IJBXBLN     INDICATE ZERO BUFFER LENGTH        @ 00436000
         MVI   PXUBTYP,0           CLEAR BUFFER TYPE BYTE IN USER DATA@ 00437000
         MVI   PXUACT1,PXUATRMR    INDICATE RETURN MESSAGE REQUEST    @ 00438000
         MVC   FAILLABL,=C'PUTA4 ' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00439490
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00440000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00441000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00442000
         BAL   RE,DATDSPLY         YES, GO TO DISPLAY RETURNED MSG'S  @ 00443000
         EJECT                                                        @ 00444000
**********************************************************************@ 00445000
**                     S T E P :   4                                 *@ 00446090
**              >>    CONTROL REQUEST    <<                          *@ 00446180
**                                                                   *@ 00446270
** COMMANDS CAN BE SUBMITTED TO VSE/POWER IN                         *@ 00446360
**  1) FIXED FORMAT - SEE 'PWRSPL FUNC=ALTER|CANCEL|DELETE|...       *@ 00446450
**                                  ...DISPLAY|HOLD|RELEASE', OR     *@ 00446540
**  2) FREE FORMAT  - SEE 'PWRSPL FUNC=COMMAND' IN THE FORMAT AS AN  *@ 00446630
**                                     OPERATOR WOULD KEY IT - FOR   *@ 00446720
**                                     ALL ALLOWED COMMANDS ACCEPTED *@ 00446810
**                                     VIA THE SPOOL-ACCESS INTERFACE*@ 00446900
**                                                                   *@ 00446990
** DISPLAY COMMANDS CAN REQUEST MESSAGES TO BE RETURNED AS           *@ 00447080
**  A) FIXED FORMAT RECORDS - SEE 'PWRSPL OPT=FORMAT', TO BE         *@ 00447170
**                            PROCESSED ACC. TO DSECT 'PXFMDSCT'     *@ 00447260
**  B) FREE FORMAT MESSAGES - SEE 'PWRSPL OPT=RESET', TO BE          *@ 00447350
**                            PROCESSED AS CONSOLE DISPLAY MESSAGES  *@ 00447440
**                                                                   *@ 00447530
** FOR PDISPLAY, THE COMMAND FORMATS 1) AND 2) CAN BE COMBINED WITH  *@ 00447620
** ANY MESSAGE FORMAT A) OR B). IN THE FOLLOWING, PWRSASEX OFFERS    *@ 00447710
** TWO COMBINATIONS AT LABEL                                         *@ 00447800
**  - 'CTLA1'  - CMD FORMAT 1) WITH MSG FORMAT B). THIS IS STANDARD  *@ 00447890
**                            FLOW, LEADS INTO LABEL 'GETB1' REQUEST.*@ 00447980
**  - 'CTLAB1' - CMD FORMAT 2) WITH MSG FORMAT A). THIS FLOW MUST BE *@ 00448070
**                            SELECTED, LEADS INTO GETBB1 REQUEST.   *@ 00448160
**********************************************************************@ 00450000
         SPACE 1                                                      @ 00451030
CTL1     DS    0H                                                     @ 00451060
         SPACE 1                                                      @ 00451090
         DPLAY SUCCM1B,72                                               00451120
         SPACE 1                                                      @ 00451150
         B     CTLA1               TAKE STANDARD FLOW, OR SELECT ...  @ 00451180
*        B     CTLAB1              ... ALTERNATIVE FLOW BY YOUR OWN   @ 00451210
         SPACE 1                                                      @ 00451240
         SPACE 1                                                      @ 00451270
**********************************************************************@ 00451300
**            >>  C T L  S T A N D A R D  F L O W  <<                *@ 00451330
** A FIXED FORMAT PDISPLAY COMMAND (FOR FREE FORMAT MESSAGES) IS     *@ 00451360
** SUBMITTED IN ORDER TO LOCATE THE OUTPUT OF JOB 'EXAMPLE' IN THE   *@ 00451390
** LST QUEUE (CLASS=S, ACC. TO * $$ LST) AND PRESENT THE LIST QUEUE  *@ 00451420
** DISPLAY LINE ON THE CONSOLE.                                      *@ 00451450
** NOTE: THE FREE FORMAT DISPLAY LINE(S) IS PRECEDED BY THE 'QUEUE   *@ 00451480
**       HEADER' LINE AS WITH NORMAL OPERATOR DISPLAY.               *@ 00451510
** NOTE: THE FIRST LST OUTPUT OF A JOB HAS ALWAYS THE SAME JOBNUMBER *@ 00451540
**       AS THE PARENT JOB. ITS JOBNUMBER HAS BEEN SAVED IN BINARY   *@ 00451570
**       FORMAT. IT IS NEEDED NOW IN THE SAME FORMAT.                *@ 00451600
**********************************************************************@ 00451630
         SPACE 1                                                      @ 00451660
*        REGISTER USAGE FOR CTL-REQUEST                               @ 00452000
         SPACE 1                                                      @ 00453490
*        RA - *****  - COUNTER FOR NUMBER OF WAIT INTERVALS           @ 00454000
         SPACE 1                                                      @ 00455190
*        THE SPL IS UPDATED FOR A DISPLAY-CTL REQUEST, SPECIFYING     @ 00455380
*         - THE MANDATORY SELECTION FIELDS 'QUEUE, JOBNAME, USERID'   @ 00455570
*         - PLUS OPTIONAL SELECTION FIELDS 'CLASS, JOBNUMBER'         @ 00455760
*         - PLUS RESETTING (FOR SAFETY) THE OPTIONAL 'OPT=..'.        @ 00455950
*         FOR DETAILS ON MANDATORY/OPTIONAL SEE PWRSPL REQ=CTL.       @ 00456140
         SPACE 1                                                      @ 00457000
CTLA1    DS    0H                                                     @ 00458000
         PWRSPL TYPE=UPD,SPL=OWNSPL,QUEUE=LST,REQ=CTL,CLASS=S,         *00459000
               JOBN=JOBNAME,JNUM=JOBNUM,FUNC=DISPLAY,OPT=RESET        @ 00460890
         SPACE 1                                                      @ 00461840
         LA    RA,12               PREPARE COUNTER FOR WAIT INTERVALS @ 00462000
         MVI   PXUBTYP,PXUBTSPL    INDICATE BUFFER TYPE = SPL         @ 00463000
         MVI   PXUACT1,0           CLEAR ACTION BYTE                  @ 00464000
         SPACE 1                                                      @ 00465000
*        THE UPDATED SPL IS DIRECTLY USED AS XPCC BUFFER.             @ 00466000
         SPACE 1                                                      @ 00467000
         STCM  R7,M7,IJBXADR       INSERT SPL ADDRESS AS BUFFER ADDR. @ 00468000
         SPACE 1                                                      @ 00469000
         LA    R3,SPLGLEN          LOAD LENGTH OF SPL                 @ 00474490
         ST    R3,IJBXBLN          INSERT BUFFER LENGTH INTO XPCCB    @ 00475000
         SPACE 1                                                      @ 00476000
         MVC   FAILLABL,=C'CTLA2 ' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00477490
CTLA2    DS    0H                                                     @ 00478000
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00479000
         SPACE 1                                                      @ 00482000
*   THE PROGRAM TESTS THE POWER RC/FBKCD TO SEE IF THE OUTPUT OF THE  @ 00483000
*   JOB 'EXAMPLE' COULD BE LOCATED.                                   @ 00484000
*   IF THIS OUTPUT COULD NOT YET BE LOCATED, THE PROGRAM REPEATS THE  @ 00485000
*   CTL REQUEST EVERY 10 SECONDS IN ORDER TO WAIT FOR REQUEST         @ 00486690
*   COMPLETION.  HOWEVER PWRSASEX DISCONNECTS AFTER 12 UNSUCCESSFUL   @ 00487380
*   ATTEMPTS.                                                         @ 00488070
*   ANY OTHER RC/FBKCD COMBINATION SHOULD NOT OCCUR AND INDICATES A   @ 00489000
*   FAILURE OF THE REQUEST.                                           @ 00490000
         SPACE 1                                                      @ 00491000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00491300
         BE    CTLA3               YES, CONTINUE WITH MSG DISPLAY     @ 00491600
         CLI   PXPRETCD,PXPRCOKF   WAS POWER RETURN CODE X'04'        @ 00492000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00493000
         CLI   PXPFBKCD,PXP04DNF   WAS OUTPUT NOT FOUND ? (PARENT ..  @ 00494290
*                                  .. JOB NOT YET COMPLETED)         )@ 00494580
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00495000
         SPACE 1                                                      @ 00496000
         SETIME 10,INTECB          INSTALL WAIT INTERVAL OF 10 SEC.   @ 00497000
         WAIT   INTECB             WAIT                               @ 00498000
         BCT   RA,CTLA2            LOOP (MAX. 12 TIMES)               @ 00499000
         SPACE 1                                                      @ 00500000
         DPLAY FAILM4,72           DISPLAY FAILURE MESSAGE            @ 00501000
         SPACE 1                                                      @ 00502000
         B     DISCT               DISCONN AND TERMIN XPCC LINK, EOJ  @ 00503000
         SPACE 1                                                      @ 00504000
CTLA3    DS    0H                                                     @ 00505000
         SPACE 1                                                      @ 00506090
         DPLAY SUCCM1C,72                                               00506180
         SPACE 1                                                      @ 00506270
         BAL   RE,DATDSPLY         GO TO DISPLAY THE MESSAGE RETURNED @ 00506360
*                                  ...  IN 'CONSOLE DISPLAY' FORMAT   @ 00506450
         B     GETB1               GO FOR NORMAL GET-OPEN REQUEST     @ 00506540
         EJECT                                                        @ 00507000
         SPACE 1                                                      @ 00507006
**********************************************************************@ 00507012
**            >>  C T L  A L T E R N A T I V E  <<                   *@ 00507018
** A FREE FORMAT PDISPLAY COMMAND (FOR FIXED FORMAT MESSAGE) IS      *@ 00507024
** SUBMITTED IN ORDER TO LOCATE THE OUTPUT OF JOB 'EXAMPLE' IN THE   *@ 00507030
** LST QUEUE (CLASS=S, ACC. TO * $$ LST). SELECTED FIELDS OF THE     *@ 00507036
** FIXED FORMAT MESSAGE ARE PASSED TO THE ARTIFICIALLY BUILT '1QSAS' *@ 00507042
** MESSAGE, WHICH IS THEN DISPLAYED ON THE CONSOLE.                  *@ 00507048
** NOTE: FIXED FORMAT MESSAGES ARE NOT PRECEDED BY A 'QUEUE HEADER'  *@ 00507054
**       LINE; QUEUE TYPE CAN BE DERIVED FROM PXFMQUID & -FLG1/-FLG3.*@ 00507060
** NOTE: THE FIRST LST OUTPUT OF A JOB HAS ALWAYS THE SAME JOBNUMBER *@ 00507066
**       AS THE PARENT JOB ITSELF. THE SAVED BINARY JOBNUMBER HAS    *@ 00507072
**       TO BE CONVERTED TO DECIMAL FOR USE IN THE PDISPLAY COMMAND. *@ 00507078
**********************************************************************@ 00507084
         SPACE 1                                                      @ 00507090
*        REGISTER USAGE FOR CTL-REQUEST                               @ 00507096
         SPACE 1                                                      @ 00507102
*        RA - *****  - COUNTER FOR NUMBER OF WAIT INTERVALS           @ 00507108
         SPACE 1                                                      @ 00507114
*        THE SPL IS UPDATED FOR A COMMON-CTL REQUEST, SPECIFYING      @ 00507120
*         - THE MANDATORY SELECTION FIELD 'USERID'                    @ 00507126
*         - PLUS SELECTION CRITERIA IN A FREE FORMAT COMMAND          @ 00507132
*         - PLUS THE OPTIONAL SELECTION CRITERION 'OPT=FORMAT'.       @ 00507138
*         FOR DETAILS ON MANDATORY/OPTIONAL SEE PWRSPL REQ=CTL.       @ 00507144
         SPACE 1                                                      @ 00507150
CTLAB1   DS    0H                                                     @ 00507156
         PWRSPL TYPE=UPD,SPL=OWNSPL,REQ=CTL,FUNC=COMMAND,              *00507162
               OPT=FORMAT                                             @ 00507168
         SPACE 1                                                      @ 00507174
*                                                                     @ 00507180
*        CONSTRUCT: 'PDISPLAY LST,<JOBNAME>,<JOBNUMBER>,CCLASS=S '    @ 00507186
*                                                                     @ 00507192
         SPACE 1                                                      @ 00507198
*        FEED JOBNAME TO FREE FORMAT COMMAND SKELETON                 @ 00507204
         SPACE 1                                                      @ 00507210
         MVC   CMDBODY(L'JOBNAME),JOBNAME  PLUG SAVED NAME INTO CMD   @ 00507216
         LA    R3,CMDBODY          POINT TO START OF JOBNAME          @ 00507222
CTLAB1A  DS    0H                                                     @ 00507228
         CLI   0(R3),C' '          FIRST TRAILING BLANK FOUND ?       @ 00507234
         BE    CTLAB1C             YES, GO TO PROVIDE 'COMMA'         @ 00507240
         LA    R3,1(R3)            PROCEED TO NEXT NAME BYTE          @ 00507246
         B     CTLAB1A             GO AND CHECK FOR BLANK             @ 00507252
CTLAB1C  DS    0H                                                     @ 00507258
         MVI   0(R3),C','          PROVIDE 'COMMA' AFTER JOBNAME      @ 00507264
         LA    R3,1(R3)            POINT TO BEGIN OF JOBNUMBER        @ 00507270
         SPACE 1                                                      @ 00507276
*        FEED DECIMAL JOBNUMBER TO FREE FORMAT COMMAND                @ 00507282
         SPACE 1                                                      @ 00507288
         SR    R1,R1               CLEAR REGISTER                     @ 00507294
         ICM   R1,3,JOBNUM         PICK UP BINARY JOB NUMBER          @ 00507300
         CVD   R1,HELP8            CONVERT TO PACKED DECIMAL          @ 00507306
         UNPK  HELP5,HELP8+5(3)    UNPACK 3 DIGITS                    @ 00507312
         OI    HELP5+4,X'F0'       CHANGE X'C.' TO PRINTABLE X'F.'    @ 00507318
         MVC   0(5,R3),HELP5       PLUG 5 DIGIT JOBNUMBER WITH ...    @ 00507324
         LA    R3,5(R3)            POINT BEHIND JOBNUMBER             @ 00507330
         MVI   0(R3),C','          PROVIDE 'COMMA' AFTER JOBNAME      @ 00507336
         LA    R3,1(R3)            POINT TO BEGIN OF C-SELECTION FLD. @ 00507342
         SPACE 1                                                      @ 00507348
*        TERMINATE COMMAND BY 'CCLASS=S ', PASS COMMAND TO PWRSPL     @ 00507354
         SPACE 1                                                      @ 00507360
         MVC   0(L'CMDCLAS,R3),CMDCLAS  PASS CLASS SELECTION OPERAND  @ 00507366
         MVC   SPLCFLD,JOBCMD      PLUG FREE FORMAT CMD INTO PWRSPL   @ 00507372
         SPACE 1                                                      @ 00507378
         LA    RA,12               PREPARE COUNTER FOR WAIT INTERVALS @ 00507384
         MVI   PXUBTYP,PXUBTSPL    INDICATE BUFFER TYPE = SPL         @ 00507390
         MVI   PXUACT1,0           CLEAR ACTION BYTE                  @ 00507396
         SPACE 1                                                      @ 00507402
*        THE UPDATED SPL IS DIRECTLY USED AS XPCC BUFFER.             @ 00507408
         SPACE 1                                                      @ 00507414
         STCM  R7,M7,IJBXADR       INSERT SPL ADDRESS AS BUFFER ADDR. @ 00507420
         SPACE 1                                                      @ 00507426
         LA    R3,SPLGLEN          LOAD LENGTH OF SPL                 @ 00507432
         ST    R3,IJBXBLN          INSERT BUFFER LENGTH INTO XPCCB    @ 00507438
         SPACE 1                                                      @ 00507444
         MVC   FAILLABL,=C'CTLAB2' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00507450
CTLAB2   DS    0H                                                     @ 00507456
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00507462
         SPACE 1                                                      @ 00507468
*   THE PROGRAM TESTS THE POWER RC/FBKCD TO SEE IF THE OUTPUT OF THE  @ 00507474
*   JOB 'EXAMPLE' COULD BE LOCATED.                                   @ 00507480
*   IF THIS OUTPUT COULD NOT YET BE LOCATED, THE PROGRAM REPEATS THE  @ 00507486
*   CTL REQUEST EVERY 10 SECONDS IN ORDER TO WAIT FOR REQUEST COMPLE- @ 00507492
*   TION.  HOWEVER PWRSASEX DISCONNECTS AFTER 12 UNSUCCESSFUL AT-     @ 00507498
*   TEMPTS.                                                           @ 00507504
*   ANY OTHER RC/FBKCD COMBINATION SHOULD NOT OCCUR AND INDICATES A   @ 00507510
*   FAILURE OF THE REQUEST.                                           @ 00507516
         SPACE 1                                                      @ 00507522
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00507528
         BE    CTLAB3              YES, CONTINUE WITH MSG DISPLAY     @ 00507534
         CLI   PXPRETCD,PXPRCOKF   WAS POWER RETURN CODE X'04'        @ 00507540
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00507546
         CLI   PXPFBKCD,PXP04DNF   WAS OUTPUT NOT FOUND ? (PARENT ..  @ 00507552
*                                  .. JOB NOT YET COMPLETED)         )@ 00507558
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00507564
         SPACE 1                                                      @ 00507570
         SETIME 10,INTECB          INSTALL WAIT INTERVAL OF 10 SEC.   @ 00507576
         WAIT   INTECB             WAIT                               @ 00507582
         BCT   RA,CTLAB2           LOOP (MAX. 12 TIMES)               @ 00507588
         SPACE 1                                                      @ 00507594
         DPLAY FAILM4,72           DISPLAY FAILURE MESSAGE            @ 00507600
         SPACE 1                                                      @ 00507606
         B     DISCT               DISCONN AND TERMIN XPCC LINK, EOJ  @ 00507612
         SPACE 1                                                      @ 00507618
CTLAB3   DS    0H                                                     @ 00507624
         SPACE 1                                                      @ 00507630
         DPLAY SUCCM1C,72                                               00507636
         SPACE 1                                                      @ 00507642
         BAL   RE,DATDSPLY         GO TO INTERPRET THE FIXED FORMAT   @ 00507648
*                                  MSG (ONLY ONE MESSAGE RECORD IS    @ 00507654
*                                  EXPECTED) VIA PXFMDSCT, DISPLAY    @ 00507660
*                                  '1QSAS', SAVE INTERNAL Q-ENTRY     @ 00507666
*                                  NUMBER FOR THE SUBSEQUENT 'DIRECT' @ 00507672
*                                  GET REQUEST.                       @ 00507678
         B     GETBB1              GO FOR 'DIRECT' GET-OPEN REQUEST   @ 00507684
         EJECT                                                        @ 00507690
**********************************************************************@ 00507696
**                     S T E P :   5                                 *@ 00507702
**            >>   GET REQUEST FROM LST QUEUE    <<                  *@ 00507708
**                                                                   *@ 00507714
** GET SERVICE REQUESTS CAN BE SUBMITTED TO VSE/POWER AS             *@ 00507720
**  1) 'GET FOR UPDATE' - ALLOWING ACCESS TO DISPATCHABLE ENTRIES,   *@ 00507726
**                        AND TERMINATE GET BY 'CLOSE' (MAY DELETE   *@ 00507732
**                        ENTRY) OR BY 'QUIT' (PRESERVES ENTRY)      *@ 00507738
**  2) 'GET FOR BROWSE' - SEE PWRSPL MODE=BROWSE (SPLGFB1) FOR       *@ 00507744
**                        ACCESSING ENTRIES INDEPENDENT OF THEIR     *@ 00507750
**                        DISPOSITION, BUT TERMINATE GET REQUEST     *@ 00507756
**                        BY 'QUIT' ONLY.                            *@ 00507762
** BOTH GET REQUEST TYPES CAN BE INITIATED IN TWO FLAVOURS AS        *@ 00507768
**  A) NORMAL GET - WITH MANDATORY 'QUEUE, JOBNAME, CLASS, AND       *@ 00507774
**                        FROM/TO USERID ' AS PWRSPL SEARCH FIELDS   *@ 00507780
**  B) DIRECT GET - WITH SAME MANDATORY SEARCH FIELDS PLUS FIELD     *@ 00507786
**                        SPLXQNUM, SPECIFYING THE INTERNAL QUEUE    *@ 00507792
**                        ENTRY NUMBER - PROVIDED IT IS KNOWN BEFORE.*@ 00507798
**                        SEE ALSO "DIRECT QUEUE ENTRY GET ACCESS..."*@ 00507804
**                        IN THIS MANUAL FOR ADVANTAGES OF 'DIRECT'. *@ 00507810
**                                                                   *@ 00507816
** GET REQUEST TYPE 1) AND 2) CAN BE INITIATED WITH ANY A) OR B)     *@ 00507822
** SELECTION FLAVOURS. IN THE FOLLOWING, PWRSASEX OFFERS TWO         *@ 00507828
** COMBINATIONS AT LABEL                                             *@ 00507834
**  - 'GETB1'  - GET FOR UPDATE 1) WITH FLAVOUR A) 'NORMAL'. THIS IS *@ 00507840
**                            THE STANDARD CONTROL FLOW.             *@ 00507846
**  - 'GETBB1' - GET FOR BROWSE 2) WITH FLAVOUR B) 'DIRECT'. THIS    *@ 00507852
**                            FLOW IS SELECTED WHEN ENABLING 'CTLAB1'*@ 00507858
**                                                                   *@ 00507864
** N O T E :  REFER TO "SCOPE OF GET/CTL(DISPLAY) ACCESS TO QUEUE   *@ 00507870
**            ENTRIES" IN THIS MANUAL FIRST:                         *@ 00507876
**            THE SUBSEQUENT GET REQ. WITH INHERITED USERID=SASUSER1 *@ 00507882
**            IS ALLOWED TO ACCESS OUTPUT ENTRY 'EXAMPLE', BECAUSE   *@ 00507888
**            PARENT JOB WAS SUBMITTED BY 'PWRSPL USERID=SASUSER1',  *@ 00507894
**            WHICH IS PROPAGATED TO ITS OUTPUT - HAVING ALSO THE    *@ 00507900
**            FROM/TO=SASUSER1 ATTRIBUTE.                            *@ 00507906
**            WHEN ACCESSING QUEUE ENTRIES WITH FROM/TO USERID NOT   *@ 00507912
**            MATCHING TO YOUR PWRSPL SPECIFICATION, CONSIDER TO     *@ 00507918
**            GENERATE POWER WITH A 'MASTER PASSWORD'. WHEN SUPPLY-  *@ 00507924
**            ING THIS PASSWORD (LEFT BOUND, PADDED BLANK) IN FIELD  *@ 00507930
**            'SPLGPW', YOUR GET/CTL REQUEST IS ENTITLED FOR         *@ 00507936
**            UNLIMITED ACCESS TO ANY QUEUE ENTRY.                   *@ 00507942
**********************************************************************@ 00507948
         SPACE 2                                                      @ 00507954
**********************************************************************@ 00508000
**            >>  G E T  S T A N D A R D  F L O W  <<                *@ 00509790
**  THE 'GET FOR UPDATE' SERVICE WITH 'NORMAL' SELECTION SPECIFIED   *@ 00510580
**  IS USED TO RETRIEVE THE LST QUEUE ENTRY OF JOB 'EXAMPLE' AND TO  *@ 00511370
**  DISPLAY ITS DATA ON THE CONSOLE. THEN THE GET-RESTART FUNCTION   *@ 00512160
**  IS USED TO DISPLAY THE SECOND HALF OF THE ENTRY AGAIN.           *@ 00512950
**********************************************************************@ 00514000
         SPACE 1                                                      @ 00515000
*        REGISTER USAGE FOR GET-REQUEST FROM LST QUEUE                @ 00516000
         SPACE 1                                                      @ 00517490
*        R3 - ****    - WORK REGISTER                                 @ 00518000
*        RA - BUFPTR  - POINTER FOR THE SEND BUFFER                   @ 00519000
         SPACE 1                                                      @ 00520090
GETB1    DS    0H                                                     @ 00520180
         DPLAY SUCCM7,72           DISPLAY MESSAGE                    @ 00520270
         SPACE 1                                                      @ 00520360
*        THE SPL IS UPDATED FOR A 'GET-OPEN' REQUEST, SPECIFYING      @ 00520450
*         - THE MANDATORY SELECTION 'CLASS, JOBNAME, QUEUE, USERID'   @ 00520540
*         - PLUS OPTIONAL SELECTION FIELD 'JOBNUMBER'                 @ 00520630
*         - PLUS RESETTING (FOR SAFETY) THE OPTIONAL 'OPT=..'.        @ 00520720
*         FOR DETAILS ON MANDATORY/OPTIONAL SEE PWRSPL REQ=GET.       @ 00520810
* NOTE:  ONLY PARAMETERS WHICH ARE DIFFERENT FROM THOSE USED IN THE   @ 00520900
*        PREVIOUS CTL-REQUEST ARE SPECIFIED IN THE UPDATE SPL.        @ 00522000
         SPACE 1                                                      @ 00523000
         PWRSPL TYPE=UPD,SPL=(R7),REQ=GET,OPT=RESET                   @ 00525990
         SPACE 1                                                      @ 00528000
         MVI   PXUBTYP,PXUBTSPL    INDICATE BUFFER TYPE = SPL         @ 00529000
         MVI   PXUACT1,0           CLEAR ACTION BYTE 1                @ 00530000
         SPACE 1                                                      @ 00531000
         STCM  R7,M7,IJBXADR       INSERT SPL ADDRESS AS BUFFER ADDR. @ 00532000
         LA    R3,SPLGLEN          LOAD LENGTH OF SPL                 @ 00533490
         ST    R3,IJBXBLN          INSERT BUFFER LENGTH INTO XPCCB    @ 00534000
         SPACE 1                                                      @ 00535000
         MVC   FAILLABL,=C'GETB1 ' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00536490
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00537000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00538000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00539000
         B     GETB2               GO AND TAKE STANDARD FLOW, WHEN    @ 00540010
*                                  COMING FROM 'CTLA1' CONTROL REQ.   @ 00540020
         SPACE 2                                                      @ 00540030
**********************************************************************@ 00540040
**            >>  G E T  A L T E R N A T I V E  <<                   *@ 00540050
**  THE 'GET FOR BROWSE' SERVICE WITH 'DIRECT' SELECTION SPECIFIED   *@ 00540060
**  IS USED TO RETRIEVE THE LST QUEUE ENTRY OF JOB 'EXAMPLE' AND TO  *@ 00540070
**  DISPLAY ITS DATA ON THE CONSOLE. THEN THE GET-RESTART FUNCTION   *@ 00540080
**  IS USED TO DISPLAY THE SECOND HALF OF THE ENTRY AGAIN.           *@ 00540090
**********************************************************************@ 00540100
         SPACE 1                                                      @ 00540110
*        REGISTER USAGE FOR GET-REQUEST FROM LST QUEUE                @ 00540120
         SPACE 1                                                      @ 00540130
*        R3 - ****    - WORK REGISTER                                 @ 00540140
*        RA - BUFPTR  - POINTER FOR THE SEND BUFFER                   @ 00540150
         SPACE 1                                                      @ 00540160
GETBB1   DS    0H                                                     @ 00540170
         DPLAY SUCCM7,72           DISPLAY MESSAGE                    @ 00540180
         SPACE 1                                                      @ 00540190
*        THE SPL IS UPDATED FOR 'DIRECT GET-OPEN' REQUEST, SPECIFYING @ 00540200
*         - THE MANDATORY SELECTION 'CLASS, JOBNAME, QUEUE, USERID'   @ 00540210
*         - PLUS OPTIONAL SELECTION FIELD 'MODE=BROWSE'               @ 00540220
*         - PLUS RESETTING (FOR SAFETY) THE OPTIONAL 'OPT=..'.        @ 00540230
*         FOR DETAILS ON MANDATORY/OPTIONAL SEE PWRSPL REQ=GET.       @ 00540240
         SPACE 1                                                      @ 00540250
         PWRSPL TYPE=UPD,SPL=(R7),REQ=GET,OPT=RESET,MODE=BROWSE,       *00540260
               JOBN=JOBNAME,CLASS=S,QUEUE=LST,JNUM=ZERONUM            @ 00540270
         SPACE 1                                                      @ 00540280
*        SEE "DIRECT QUEUE ENTRY GET (ALSO CTL) ACCESS ..." IN THIS   @ 00540290
*        MANUAL FOR REQUIRED PWRSPL SPECIFICTIONS.                    @ 00540300
         SPACE 1                                                      @ 00540310
         MVC   SPLXQNUM,JOBQNUM    SPECIFY SAVED Q-ENTRY-# FOR DIRECT @ 00540320
*                                  GET ACCESS TO DISPLAYED Q-ENTRY,   @ 00540330
*                                  NO JOBNUMBER NEEDED FOR UNIQUENESS @ 00540340
         OI    SPLGOPT2,SPLGO2QN   INDICATE 'USE QUEUE ENTRY NUMBER'  @ 00540350
*                                  TO ENABLE 'DIRECT' GET REQUEST     @ 00540360
         MVI   PXUBTYP,PXUBTSPL    INDICATE BUFFER TYPE = SPL         @ 00540370
         MVI   PXUACT1,0           CLEAR ACTION BYTE 1                @ 00540380
         SPACE 1                                                      @ 00540390
         STCM  R7,M7,IJBXADR       INSERT SPL ADDRESS AS BUFFER ADDR. @ 00540400
         LA    R3,SPLGLEN          LOAD LENGTH OF SPL                 @ 00540410
         ST    R3,IJBXBLN          INSERT BUFFER LENGTH INTO XPCCB    @ 00540420
         SPACE 1                                                      @ 00540430
         MVC   FAILLABL,=C'GETBB1' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00540440
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00540450
         NI    SPLGOPT2,X'FF'-SPLGO2QN   RESET 'USE INT. Q-ENTRY-#'   @ 00540460
         XC    SPLXQNUM,SPLXQNUM   RESET INTERNAL QUEUE ENTRY NUMBER  @ 00540470
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00540480
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE,  @ 00540490
*                                  DISPLAY ALSO PXPFBKC2 IF NOT FOUND @ 00540500
         B     GETB2               GO AND JOIN COMMON FLOW NOW        @ 00540510
         SPACE 1                                                      @ 00540520
         EJECT                                                        @ 00540530
*   THE VERIFICATION SPL RETURNED BY VSE/POWER, WHICH COULD BE CHECKED@ 00541000
*   FOR USEFUL INFORMATION (SUCH AS FORMSID), IS IGNORED BY PWRSASEX. @ 00542000
*                                                                     @ 00543390
*   FOR THE SUBSEQUENT 'GET-SPOOL-DATA' REQUEST, THE PXU-USER FIELD   @ 00543780
*   IS FLAGGED WITH A SEND-DATA REQUEST, AND A NULL BUFFER IS PASSED  @ 00544170
*   TO VSE/POWER.                                                     @ 00544560
         SPACE 1                                                      @ 00545000
GETB2    DS    0H                                                     @ 00546000
         XC    IJBXBLN,IJBXBLN     INDICATE ZERO BUFFER LENGTH        @ 00547000
         MVI   PXUBTYP,0           CLEAR BUFFER TYPE BYTE IN USER DATA@ 00548000
         MVI   PXUACT1,PXUATSDR    INDICATE SEND DATA REQUEST         @ 00549000
         MVC   FAILLABL,=C'GETB2 ' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00550490
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00551000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00552000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00553000
         MVI   GETFCT,C'G'         INDICATE: DATDSPLY IS CALLED BY GET@ 00554000
         BAL   RE,DATDSPLY         GO TO DISPLAY RETURNED DATA        @ 00555000
*                                  AND DO NOT RETURN UNTIL LAST DATA  @ 00556000
*                                  RECORD IS DISPLAYED                @ 00557000
         MVI   GETFCT,C' '         RESET INDICATION                   @ 00558000
         SPACE 1                                                      @ 00559000
         DPLAY SUCCM2,72           DISPLAY MSG TO INDICATE RESTART RQ.@ 00560000
         SPACE 2                                                      @ 00561590
*        A 'RESTART CONTROL RECORD' IS BUILT IN THE SEND BUFFER AND   @ 00562180
*        PASSED TO VSE/POWER. THE LOGICAL RECORD NUMBER - PREVIOUSLY  @ 00563000
*        SAVED BY THE DATDSPLY ROUTINE - IS USED AS RESTART POINT.    @ 00564490
         SPACE 1                                                      @ 00565000
GETB3    DS    0H                                                     @ 00566000
         SPACE 1                                                      @ 00567000
         MVI   PXUBTYP,PXUBTCTL    BUFFER TYPE = CONTROL RECORD       @ 00568000
         MVI   PXUACT1,0           CLEAR ACTION BYTE 1                @ 00569000
         LA    BUFPTR,SENDBUF      GET ADDRESS OF SEND BUFFER         @ 00570000
         STCM  BUFPTR,M7,IJBXADR   INSERT BUFFER ADDRESS INTO XPCCB   @ 00571000
         SPACE 1                                                      @ 00572000
         USING PXRSDSCT,BUFPTR     GET DSECT FOR RESTART CONTROL REC. @ 00573000
         XC    0(PXRSLENG,BUFPTR),0(BUFPTR)   CLEAR RESTART CONTROL R.@ 00574000
         MVI   PXRSTYPE,PXRSTRST   INDICATE RECORD TYPE = RESTART CTL.@ 00575000
         MVC   PXRSRECN,PWRRECNO   INSERT PREVIOUSLY SAVED LOG. REC.# @ 00576000
         LA    R3,PXRSLENG         LOAD LENGTH OF RESTART CTL. REC.   @ 00577000
         STH   R3,PXRSRLEN         INSERT LENGTH INTO RESTART CTL. REC@ 00578000
         ST    R3,IJBXBLN          INSERT LENGTH INTO XPCCB           @ 00579000
         DROP  BUFPTR                                                 @ 00580000
         SPACE 1                                                      @ 00581000
         MVC   FAILLABL,=C'GETB3 ' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00582490
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00583000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00584000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00585000
         MVI   GETFCT,C'G'         INDICATE: DATDSPLY IS CALLED BY GET@ 00586000
         BAL   RE,DATDSPLY         YES, GO TO DISPLAY RETURNED DATA   @ 00587000
*                                  AND DO NOT RETURN UNTIL LAST DATA  @ 00588000
*                                  RECORD IS DISPLAYED                @ 00589000
         MVI   GETFCT,C' '         RESET INDICATION                   @ 00590000
         SPACE 1                                                      @ 00591000
*   FOR THE SUBSEQUENT 'GET-QUIT' REQUEST, THE PXU-USER FIELD IS      @ 00592490
*   FLAGGED WITH A 'QUIT' INDICATION, AND A NULL BUFFER IS PASSED     @ 00592980
*   TO VSE/POWER.                                                     @ 00593470
         SPACE 1                                                      @ 00594000
GQUIT    DS    0H                                                     @ 00595000
         XC    IJBXBLN,IJBXBLN     INSERT ZERO BUFFER LENGTH          @ 00596000
         MVI   PXUBTYP,0           CLEAR BUFFER TYPE BYTE IN USER DATA@ 00597000
         MVI   PXUACT1,PXUATABR    INDICATE QUIT REQUEST              @ 00598000
         SPACE 1                                                      @ 00599000
*        IF A CLOSE OR PURGE REQUEST IS DESIRED (ONLY IN CASE OF      @ 00600590
*        'NORMAL' GET), ONE OF THE FOLLOWING STATEMENTS MUST BE CODED @ 00601180
         SPACE 1                                                      @ 00602000
*GCLOSE  MVI   PXUACT1,PXUATRQS    REQUIRED SETTING FOR A CLOSE REQU. @ 00603000
*GPURGE  MVI   PXUACT1,PXUATPRG    REQUIRED SETTING FOR A PURGE REQU. @ 00604000
         SPACE 1                                                      @ 00605000
         MVC   FAILLABL,=C'GQUIT ' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00606490
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00607000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00608000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00609000
         SPACE 2                                                      @ 00610000
         EJECT                                                        @ 00611000
**********************************************************************@ 00612000
**                     S T E P :   6                                 *@ 00612500
**          >>      PUT REQUEST TO LST QUEUE          <<             *@ 00613000
**  THE DATA CARDS OF THE EXAMPLE JOB ARE SUBMITTED TO THE VSE/POWER *@ 00614000
**  LST QUEUE AS 'EXAMPSEG'.  A SEGMENT REQUEST IS ISSUED            *@ 00615000
**  AFTER EACH SEVENTH RECORD.                                       *@ 00616000
**********************************************************************@ 00617000
         SPACE 1                                                      @ 00618000
*        REGISTER USAGE FOR PUT-REQUEST TO LST QUEUE                  @ 00619000
         SPACE 2                                                      @ 00620000
*        R2 - RECORDCT - RECORD COUNTER FOR SEGMENTATION IN LOOP      @ 00621000
*        RA - BUFPTR   - POINTER FOR THE SEND BUFFER                  @ 00622000
*        RB - DATAPTR  - POINTER FOR THE INPUT CARDS                  @ 00623000
         SPACE 2                                                      @ 00624000
PUTB1    DS    0H                                                     @ 00625990
         SPACE 1                                                      @ 00626980
         DPLAY SUCCM8,72           DISPLAY MESSAGE                    @ 00628000
         SPACE 1                                                      @ 00629000
*        THE SPL IS UPDATED FOR A 'PUT-OPEN OUTPUT' REQ., SPECIFYING  @ 00630090
*         - THE MANDATORY FIELDS 'QUEUE, JOBNAME, USERID', AND        @ 00630180
*         - THE OPTIONAL FIELDS 'CLASS, MODE, (OPT, PWD)' FOR UPD REQ.@ 00630270
*        FOR DETAILS ON MANDAT./OPT. FIELDS SEE PWRSPL REQ=PUT OUTPUT.@ 00630360
*        NOTE: ALL FURTHER OUTPUT ATTRIBUTES HAVE TO BE SET BY OWN    @ 00630450
*              CODE, TO FEED UPDATE SPL FIELDS ACC. TO "SUBMITTING    @ 00630540
*              OUTPUT DATA" IN THIS MANUAL.                           @ 00630630
         SPACE 1                                                      @ 00630720
         PWRSPL TYPE=UPD,REQ=PUT,SPL=OWNSPL,CLASS=Z,JOBN=JOBNLAB,      *00631000
               QUEUE=LST,MODE=RESET                                   @ 00632000
         SPACE 2                                                      @ 00633000
*   SET ADDITIONAL OUTPUT SPECIFIC FIELDS IN THE SPL BY OWN CODE      @ 00634490
         MVI   SPLDDP,DISP         INDICATE OUTPUT DISPOSITION        @ 00635000
         MVI   SPLONSEP,SEPPAGE    INDICATE OUTPUT SEPARATOR PAGES    @ 00636000
         MVI   SPLDPR,PRIOR        INDICATE OUTPUT PRIORITY           @ 00637000
         MVC   SPLOFORM,FORMS      INDICATE OUTPUT FORMS              @ 00638000
         MVI   SPLORCFM,SPLORASA   INDICATE ASA CC FOR OUTPUT         @ 00639000
         MVI   SPLDSID,C'N'        INDICATE 'NO' SPECIFIC TARGET SYSID@ 00639300
*                                  FIELD IS REQUIRED FOR SHARED SYST. @ 00639600
         SPACE 1                                                      @ 00640000
         MVI   PXUACT1,0           CLEAR ACTION BYTE 1 IN USER DATA   @ 00641000
         MVI   PXUBTYP,PXUBTSPL    INDICATE BUFFER TYPE = SPL         @ 00642000
         SPACE 1                                                      @ 00643000
         STCM  R7,M7,IJBXADR       INSERT SPL ADDRESS AS BUFFER ADDR. @ 00644000
         LA    R3,SPLGLEN          LOAD LENGTH OF SPL                 @ 00645000
         ST    R3,IJBXBLN          INSERT BUFFER LENGTH INTO XPCCB    @ 00646000
         SPACE 1                                                      @ 00647000
         MVC   FAILLABL,=C'PUTB1 ' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00648490
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00649000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00650000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00651000
         SPACE 2                                                      @ 00652000
*   THE VERIFICATION SPL RETURNED BY VSE/POWER IS IGNORED.            @ 00653390
*                                                                     @ 00653780
*   FOR THE SUBSEQUENT 'PUT-SPOOL-DATA' REQUEST, THE PXU-USER FIELD   @ 00654170
*   SETTINGS ARE ESTABLISHED, AND THE SEND BUFFER IS FILLED WITH      @ 00654560
*   'OUTPUT LINE RECORDS' (EACH RECORD PRECEDED BY A RECORD PREFIX)   @ 00654950
*   UNTIL NO MORE RECORD FITS.                                        @ 00655340
*   THE BUFFER IS THEN PASSED TO VSE/POWER IN THE ACTUALLY USED       @ 00655730
*   LENGTH. THE OUTPUT IS ALWAYS SEGMENTED AFTER SEVEN RECORDS.       @ 00656120
         SPACE 1                                                      @ 00657000
PUTB2    DS    0H                                                     @ 00658000
         MVI   PXUBTYP,PXUBTNDB    BUFFER TYPE = NORMAL DATA BUFFER   @ 00659000
         MVI   PXUACT1,0           CLEAR ACTION BYTE 1 IN USER DATA   @ 00660000
         SPACE 1                                                      @ 00661000
         LA    BUFPTR,SENDBUF      GET ADDRESS OF SEND BUFFER         @ 00662000
         STCM  BUFPTR,M7,IJBXADR   INSERT BUFFER ADDRESS INTO XPCCB   @ 00663000
         LA    DATAPTR,DATACARD    GET ADDR OF FIRST INPUT CARD       @ 00664000
         SPACE 1                                                      @ 00665000
         LA    RECORDCT,NOOFRECS   INITIALIZE RECORD COUNTER          @ 00666000
FILLBUFO DS    0H                                                     @ 00667000
         CLC   JCL2(3),0(DATAPTR) END OF DATA REACHED?                @ 00668000
         BE    SDEOD               YES, GO TO SEND FINAL BUFFER       @ 00669000
         SPACE 1                                                      @ 00670000
         CL    BUFPTR,LASTPREC     ENOUGH SPACE FOR ONE MORE RECORD?  @ 00671000
         BH    SDNDB               NO, GO TO SEND NORMAL BUFFER       @ 00672000
         SPACE 1                                                      @ 00673000
         USING RECPRFIX,BUFPTR     GET DSECT FOR RECORD LAYOUT        @ 00674000
         XC    0(RECPRFXL,BUFPTR),0(BUFPTR)   CLEAR BYTES FOR PREFIX  @ 00675000
         MVI   RECTYPE,RECTNORM    INSERT REC. TYPE INTO REC. PREFIX  @ 00676000
         MVI   RECCCODE,C'-'       SET ASA CC IN REC. PREFIX TO SKIP2 @ 00677000
         LA    R3,NOOFRECS         MAX NUMBER OF RECORDS IN A SEGMENT @ 00678000
         CLR   RECORDCT,R3         FIRST RECORD OF SEGMENT?           @ 00679000
         BNE   LAB1                NO, CONTINUE AT LABEL LABL1        @ 00680000
         MVI   RECCCODE,C'1'       SET ASA CC IN REC.PREF. TO NXT.PAGE@ 00681000
         SPACE 1                                                      @ 00682000
LAB1     DS    0H                                                     @ 00683000
         LA    R3,L'DATACARD       LOAD LENGTH OF DATA                @ 00684000
         STH   R3,RECLNGTH         INSERT LENGTH OF DATACARD IN PREFIX@ 00685000
         LA    BUFPTR,RECPRFXL(,BUFPTR) SKIP PREFIX IN BUFFER         @ 00686000
         MVC   0(L'DATACARD,BUFPTR),0(DATAPTR) MOVE DATA IN BUFFER    @ 00687000
         LA    BUFPTR,L'DATACARD(,BUFPTR) POINT TO NEXT FREE BUFSPACE @ 00688000
         LA    DATAPTR,L'DATACARD(,DATAPTR) POINT TO NEXT INPUT CARD  @ 00689000
         BCT   RECORDCT,FILLBUFO   DO LOOP AND DECREMENT RECORDCOUNTER@ 00690000
         SPACE 1                                                      @ 00691000
         CLC   JCL2(3),0(DATAPTR) END OF DATA REACHED?                @ 00692000
         BE    SDEOD               YES, GO TO SEND FINAL BUFFER       @ 00693000
         MVI   PXUACT1,PXUATSGM    INDICATE OUTPUT SEGMENTATION       @ 00694000
SDNDB    DS    0H                                                     @ 00695000
         LA    R3,SENDBUF          GET AGAIN START ADDR. OF SEND BUFF @ 00696000
         SR    BUFPTR,R3           CALC. ACTUALLY USED BUFFER LENGTH  @ 00697000
         ST    BUFPTR,IJBXBLN      INSERT ACTUAL BUF.LENGTH INTO XPCCB@ 00698000
         MVC   FAILLABL,=C'SDNDB ' INSERT PART OF CODE LABEL FOR DIAGN@ 00699490
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00700000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00701000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00702000
         LA    BUFPTR,SENDBUF      GET ADDRESS OF SEND BUFFER         @ 00703000
         LTR   RECORDCT,RECORDCT   IS RECORD COUNTER ZERO?            @ 00704000
         BNZ   KEEPRCT             NO, KEEP ACTUAL VALUE OF RECORDCT  @ 00705000
         LA    RECORDCT,NOOFRECS   INITIALIZE REC COUNTER AGAIN       @ 00706000
KEEPRCT  DS    0H                                                     @ 00707000
         MVI   PXUACT1,0           CLEAR ACTION BYTE 1 IN USER DATA   @ 00708000
         B     FILLBUFO            GOTO CHECK NEXT INPUT CARD         @ 00709000
         SPACE 2                                                      @ 00710000
SDEOD    DS    0H                                                     @ 00711000
         MVI   PXUACT1,0           CLEAR ACTION BYTE 1 IN USER DATA   @ 00712000
         MVI   PXUACT1,PXUATEOD    ACTION BYTE = END OF DATA          @ 00713000
         LA    R3,SENDBUF          GET AGAIN START ADDR. OF SEND BUFF @ 00714000
         SR    BUFPTR,R3           CALC. ACTUALLY USED BUFFER LENGTH  @ 00715000
         ST    BUFPTR,IJBXBLN      INSERT ACTUAL BUF.LENGTH INTO XPCCB@ 00716000
         L     R3,IJBXBLN          LOAD ACTUAL SEND BUFFER LENGTH     @ 00717000
         LTR   R3,R3               IS BUFFER LENGTH  ZERO?            @ 00718000
         BNZ   NOTNLB              NO, IND. NORMAL DATA BUFFER        @ 00719000
         MVI   PXUBTYP,0           CLEAR BUFFER TYPE IN USER DATA     @ 00720000
NOTNLB   DS    0H                                                     @ 00721000
         MVC   FAILLABL,=C'SDEOD ' INSERT PART OF CODE LABEL FOR DIAGN@ 00722490
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00723000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00724000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00725000
         SPACE 2                                                      @ 00726000
*        THE EXTENDED SPL RETURNED BY VSE/POWER IS IGNORED.           @ 00727000
         SPACE 1                                                      @ 00728000
PUTB3    DS    0H                                                     @ 00729000
         TM    PXPINFO,PXPIMSG     MESSAGES QUEUED?                   @ 00730000
         BNO   DISPLAY             NO, GO TO DISPLAY INFO MESSAGES    @ 00731000
         MVC   FAILLABL,=C'PUTB3 ' INSERT CODE LABEL FOR DIAGNOSTIC   @ 00732490
         XC    IJBXBLN,IJBXBLN     INDICATE ZERO BUFFER LENGTH        @ 00733000
         MVI   PXUBTYP,0           CLEAR USER DATA IN XPCCB           @ 00734000
         MVI   PXUACT1,PXUATRMR    INDICATE RETURN QUEUED MESSAGES    @ 00735000
         BAL   RD,SENDR            GO TO SENDR ROUTINE                @ 00736000
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURN CODE ZERO?        @ 00737000
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE   @ 00738000
         BAL   RE,DATDSPLY         YES, GO TO DISPLAY RETURNED MSG'S  @ 00739000
         SPACE 1                                                      @ 00740000
DISPLAY  DS    0H                                                     @ 00741000
         DPLAY SUCCM3,72           DISPLAY MESSAGE                    @ 00742000
         DPLAY SUCCM4,72           DISPLAY MESSAGE                    @ 00743000
         DPLAY SUCCM6,72           DISPLAY MESSAGE                    @ 00744000
         SPACE 1                                                      @ 00745000
         B     DISCT               DISCONN AND TERMIN XPCC LINK, EOJ  @ 00746000
         EJECT                                                        @ 00747000
*********************************************************************** 00834000
**                     S T E P :   7                                 ** 00834500
**    >> DISCONNECT THE XPCC COMMUNICATION LINK TO VSE/POWER <<      ** 00835000
** IF THE MACRO FAILS, THE PROGRAM DISPLAYS A DIAGNOSTIC MESSAGE AND ** 00836000
** TERMINATES WITH A DUMP.                                           ** 00837000
*********************************************************************** 00838000
         SPACE 1                                                        00839000
DISCT    DS    0H                                                       00840000
         XPCC  XPCCB=(R4),FUNC=DISCONN   DISCONNECT LINK TO VSE/POWER   00841000
         SPACE 1                                                        00842000
         LTR   RF,RF               WAS DISCONNECT SUCCESSFUL, RF='00' ? 00843000
         BZ    TERMN               ..YES CONTINUE WITH XPCC TERMINATION 00844000
         SPACE 1                                                        00845000
         MVC   FAILFUNC,=C'DISCONN '   INSERT FAILING FUNCTION          00846000
         BAL   RE,MSGRETC          INSERT XPCC RETURN CODE INTO MSG     00847000
         MVC   FAILLABL,=C'DISCT ' INSERT CODE LABEL FOR DIAGNOSTIC     00848490
         BAL   RE,MSGDSPLY         DISPLAY MESSAGE ON CONSOLE           00849000
         B     FINDUMP             GO TO TERMINATION WITH DUMP          00850000
         EJECT                                                          00851000
*********************************************************************** 00852000
**                     S T E P :   8                                 ** 00852500
**    >> TERMINATE INTERACTION WITH THE VSE/AF XPCC SUPPORT <<       ** 00853000
** IF THE MACRO FAILS, THE PROGRAM DISPLAYS A DIAGNOSTIC MESSAGE AND ** 00854000
** TERMINATES WITH A DUMP.                                           ** 00855000
*********************************************************************** 00856000
         SPACE 1                                                        00857000
TERMN    DS    0H                                                       00858000
         XPCC XPCCB=(R4),FUNC=TERMIN   TERMINATE CROSS PART. INTERFACE  00859000
         LTR   RF,RF               DID WE GET A ZERO RET-CODE ?         00860000
         BZ    FINEND              ..YES, GO TO NORMAL EOJ MACRO        00861000
         SPACE 1                                                        00862000
         MVC   FAILFUNC,=C'TERMIN  '  INSERT FAILING FUNCTION INTO MSG  00863000
         BAL   RE,MSGRETC          INSERT XPCC RETURN CODE INTO MSG     00864000
         MVC   FAILLABL,=C'TERMN ' INSERT CODE LABEL FOR DIAGNOSTIC     00865490
         BAL   RE,MSGDSPLY         DISPLAY MESSAGE ON CONSOLE           00866000
         B     FINDUMP             GO TO TERMINATION WITH DUMP          00867000
         EJECT                                                          00868000
*********************************************************************** 00869000
**                     S T E P :   9                                 ** 00869500
**                  >> TERMINATE PWRSASEX  <<                        ** 00870000
*********************************************************************** 00871000
         SPACE 1                                                        00872000
FINDUMP  DS    0H                  TERMINATION FORCED DUE TO ERROR      00873000
*        DUMP                      A PARTITION DUMP CAN BE FORCED IF    00874000
*                                  NECESSARY FOR DEBUG PURPOSES         00875000
         SPACE 1                                                        00876000
FINEND   DS    0H                  NORMAL TERMINATION                   00877000
         EOJ                       NORMAL END OF PWRSASEX PROGRAM       00878000
         EJECT                                                          00879000
*********************************************************************** 00879008
**                     S U B R O U T I N E S                         ** 00879016
**                  >>   DATDSPLY ROUTINE      <<                    ** 00879024
**  THIS ROUTINE DISPLAYS THE FOLLOWING INFO RETURNED BY VSE/POWER:  ** 00879032
**   - MESSAGES IN 'OPERATOR' DISPLAY FORMAT (CTL OR PUT REQUEST)    ** 00879040
**   - MESSAGES IN 'FIXED FORMAT' (CTL OPT=FORMAT), CONVERTED TO THE ** 00879048
**     OWN CONSOLE MESSAGE '1QSAS'                                   ** 00879056
**   - DATA RECORDS OF RETRIEVED QUEUE ENTRIES (GET REQUEST)         ** 00879064
*********************************************************************** 00879072
         SPACE 1                                                        00879080
*        REGISTER USAGE FOR DATDSPLY ROUTINE                            00879088
         SPACE 1                                                        00879096
*        RA - BUFPTR  - POINTER FOR THE REPLY BUFFER                    00879104
*        RC - BUFLN   - REG TO CALCULATE THE LENGTH OF THE DATA STILL   00879112
*                       TO BE DISPLAYED                                 00879120
*        R0, R1, R2, R3 - WORK REGISTER                                 00879128
*                                                                       00879136
*        CALLED FROM: PUT REQUEST TO RDR QUEUE                          00879144
*                     CTL REQUEST                                       00879152
*                     GET REQUEST                                       00879160
*                     PUT REQUEST TO LST QUEUE                          00879168
*                                                                       00879176
*        EXIT TO CALLER IF ALL AVAILABLE MESSAGES/DATA ARE DISPLAYED    00879184
         SPACE 2                                                        00879192
DATDSPLY DS    0H                                                       00879200
         SR    R0,R0               SET R0 TO ZERO                       00879208
         CLM   R0,M7,IJBXSLN       NO MORE DATA TO DISPLAY?             00879216
         BER   RE                  RETURN TO CALLER                     00879224
         LA    BUFPTR,REPLBUF      POINT TO REPLY BUFFER                00879232
         SR    BUFLN,BUFLN         CLEAR REGISTER                       00879240
         ICM   BUFLN,M7,IJBXSLN    GET LENGTH OF DATA TO BE DISPLAYED   00879248
         SPACE 1                                                        00879256
*   PWRSASEX DISPLAYS, RECORD AFTER RECORD, THE DATA OR MESSAGES RE-    00879264
*   TURNED BY VSE/POWER.  THE RECORD PREFIX OF EACH DATA RECORD IS      00879272
*   ANALIZED BUT NOT DISPLAYED.                                         00879280
*   IF DATDSPLY IS CALLED TO DISPLAY PARTS OF A FIXED FORMAT MESSAGE    00879288
*   RECORD (ONLY ONE EXPECTED), THE RETURNED 'INTERNAL' QUEUE ENTRY     00879296
*   NUMBER OF OUTPUT 'EXAMPLE' IS SAVED FOR THE ALTERNATIVE FLOW OF THE 00879304
*   'DIRECT GET' REQUEST.                                               00879312
*   IF DATDSPLY IS CALLED BY THE GET FUNCTION, THE LOGICAL RECORD       00879320
*   NUMBER OF THE 12TH DATA CARD OF OUTPUT ENTRY 'EXAMPLE' IS SAVED.    00879328
*   PWRSASEX USES THIS NUMBER LATER AS A RESTART POINT.                 00879336
         SPACE 1                                                        00879344
DSPL0    DS    0H                                                       00879352
         USING RECPRFIX,BUFPTR     GET DSECT OF RECORD LAYOUT           00879360
         CLI   GETFCT,C'G'         WAS DATDSPLY CALLED BY GET?          00879368
         BNE   DSPL1               NO, GO FOR MESSAGE INTERPRETATION    00879376
         CLC   RECPRFXL(4,BUFPTR),=C'* 12'  IS THE CURRENT CARD NO.12   00879384
         BNE   DSPL1X              NO, GO TO DISPLAY DATA RECORD        00879392
         MVC   PWRRECNO,RECLOGNO   SAVE LOGICAL RECORD NUMBER           00879400
         B     DSPL1X              GO TO DISPLAY DATA RECORD            00879408
         SPACE 1                                                        00879416
DSPL1    DS    0H                                                       00879424
         CLI   RECTYPE,RECTFIXM    FIXED FORMAT MSG RECORD RETURNED ?   00879432
         BNE   DSPL1X              GO TO DISPLAY CONSOLE MESSAGE        00879440
         LH    R2,RECLNGTH         GET LENGTH OF FIRST/NEXT DATA REC.   00879448
         LA    BUFPTR,RECPRFXL(,BUFPTR)  POINT TO FIX FORMAT RECORD     00879456
         DROP  BUFPTR              RELEASE PREFIX ADDRESSABILITY        00879464
         USING PXFMDSCT,BUFPTR     MAKE FIX FORM MSG ADDRESSABLE        00879472
         MVC   FFMHD+15(L'JOBNAME),PXFMNAME   PASS NAME TO MSG SKELET.  00879480
         SR    R1,R1               CLEAR REGISTER                       00879488
         ICM   R1,3,PXFMJNUM       PICK UP BINARY JOB NUMBER            00879496
         CVD   R1,HELP8            CONVERT TO PACKED DECIMAL            00879504
         UNPK  HELP5,HELP8+5(3)    UNPACK 3 DIGITS                      00879512
         OI    HELP5+4,X'F0'       CHANGE X'C.' TO PRINTABLE X'F.'      00879520
         MVC   FFNHD+5(5),HELP5    PASS DEC. JOBNUMBER TO MSG SKEL      00879528
         MVC   FFCHD+7(1),PXFMCLSS      PASS JOB CLASS TO MSG SKELETON  00879536
         MVC   JOBQNUM,PXFMQNUM    SAVE INTERNAL Q-ENTRY-# FOR DIR. GET 00879544
         DROP  BUFPTR              RELEASE FF-MSG ADDRESSABILITY        00879552
         SPACE 1                                                        00879560
         DPLAY FFDSPLY,72          DISPLAY ASSEMBLED DISPLAY LINE       00879568
         SPACE 1                                                        00879576
         B     DSPL1Y              GO PROCESS NEXT/LAST PASSED RECORD   00879584
         SPACE 2                                                        00879592
DSPL1X   DS    0H                                                       00879600
         USING RECPRFIX,BUFPTR     MAKE RECORD PREFIX ADDRESSABLE       00879608
         LH    R2,RECLNGTH         GET LENGTH OF FIRST/NEXT DATA REC.   00879616
         LA    BUFPTR,RECPRFXL(,BUFPTR)     SKIP RECORD PREFIX          00879624
         DROP  BUFPTR              RELEASE PREFIX ADDRESSABILITY        00879632
         SPACE 1                                                        00879640
         DPLAY (BUFPTR),(R2)       DISPLAY CURRENT DATA RECORD          00879648
         SPACE 2                                                        00879656
DSPL1Y   DS    0H                                                       00879664
         LA    R1,RECPRFXL(,R2)    CALC. LENGTH OF RECORD INCL. PREFIX  00879672
         SR    BUFLN,R1            CALC.LENGTH OF DATA STILL IN BUFFER  00879680
         LA    BUFPTR,0(R2,BUFPTR)     POINT TO NEXT RECORD             00879688
         LTR   BUFLN,BUFLN         ALL DATA IN BUFFER DISPLAYED?        00879696
         BNZ   DSPL0               NO, GO TO DISPLAY NEXT DATA REC.     00879704
         SPACE 1                                                        00879712
         CLI   PXPFBKCD,PXP00EOD   END OF DATA?                         00879720
         BER   RE                  YES, RETURN TO CALLER                00879728
         SPACE 1                                                        00879736
*   IF THIS ROUTINE IS CALLED BY THE GET FUNCTION, 'SEND (MORE) DATA'   00879744
*   HAS TO BE INDICATED IN THE ACTION BYTE. IN ALL OTHER CASES          00879752
*   'RETURN (MORE) MESSAGES' MUST BE SET.                               00879760
         SPACE 1                                                        00879768
DSPL2    DS    0H                                                       00879776
         XC    IJBXBLN,IJBXBLN     INDICATE ZERO BUFFER LENGTH          00879784
         MVI   PXUBTYP,0            CLEAR BUFFER TYPE BYTE              00879792
         MVI   PXUACT1,PXUATRMR    INDICATE A 'RETURN MESSAGE' REQUEST  00879800
         CLI   GETFCT,C'G'          WAS DATDSPLY CALLED BY GET?         00879808
         BNE   DSPL3                NO, KEEP RETURN MESSAGE INDICATION  00879816
         MVI   PXUACT1,PXUATSDR    INDICATE A 'SEND DATA' REQUEST       00879824
DSPL3    DS    0H                                                       00879832
         MVC   FAILLABL,=C'DSPL2 ' INSERT CODE LABEL FOR DIAGNOSTIC     00879840
         BAL   RD,SENDR            GO TO SENDR ROUTINE                  00879848
         CLI   PXPRETCD,PXPRCOK    WAS POWER RETURNCODE ZERO?           00879856
         BNE   REQFAIL             NO, GO TO HANDLE REQUEST FAILURE     00879864
         B     DATDSPLY            YES, START DISPLAYING AGAIN          00879872
         EJECT                                                          00879880
*********************************************************************** 00879888
**      >> ROUTINE TO HANDLE REQUEST FAILURES         <<             ** 00879896
**  THE ROUTINE IS CALLED IF POWER RC/FBKC WAS NOT ZERO              ** 00879904
*********************************************************************** 00879912
         SPACE 1                                                        00879920
REQFAIL  DS    0H                                                       00879928
         MVC   FAILFUNC,=C'SENDR   ' INSERT FAILING FUNCTION INTO MSG   00879936
         BAL   RE,MSGRCFB          PREPARE RC/FBKC DISPLAY              00879944
         BAL   RE,MSGDSPLY         DISPLAY MESSAGE ON CONSOLE           00879952
         B     FINDUMP             GO TO TERMINATION WITH DUMP          00879960
         EJECT                                                          00879968
*********************************************************************** 00880000
**     >>       MESSAGE BUILD ROUTINE FOR FAILMSG            <<      ** 00881000
** BRANCHED TO FROM ANY CALLER TO FILL SELECTED FIELDS OF THE DIAG-  ** 00882000
** NOSTIC MESSAGE.  RETURNS TO CALLER VIA REGISTER 14 (RE).          ** 00883000
*********************************************************************** 00884000
         SPACE 1                                                        00885000
MSGRETC  DS    0H                                                       00886000
         UNPK  HELP,IJBXRETC(2)        UNPACK HEX XPCC RETURN CODE      00887000
         TR    HELP(2),TRTAB           CONVERT TO PRINTABLE HEX-VALUE   00888000
         MVC   FAILRETC,HELP           INSERT PRINTABLE XPCC RET. CODE  00889000
         BR    RE                      RETURN TO CALLER                 00890000
         SPACE 1                                                        00891000
MSGREAS  DS    0H                                                       00892000
         UNPK  HELP,IJBXREAS(2)        UNPACK HEX XPCC REASON CODE      00893000
         TR    HELP(2),TRTAB           CONVERT TO PRINTABLE HEX-VALUE   00894000
         MVC   FAILREAS,HELP           INSERT PRINTABLE XPCC REAS. CODE 00895000
         BR    RE                      RETURN TO CALLER                 00896000
         SPACE 1                                                        00897000
MSGRCFB  DS    0H                                                       00898000
         UNPK  HELP,PXPRETCD(2)        UNPACK HEX POWER RETURN CODE     00899000
         TR    HELP(2),TRTAB           CONVERT TO PRINTABLE HEX-VALUE   00900000
         MVC   FAILPWRC,HELP           INSERT PRINTABLE POWER RET. CODE 00901000
         SPACE 1                                                        00902000
         UNPK  HELP,PXPFBKCD(2)        UNPACK HEX POWER FEEDBACK CODE   00903000
         TR    HELP(2),TRTAB           CONVERT TO PRINTABLE HEX-VALUE   00904000
         MVC   FAILPWFB,HELP           INSERT POWER FEEDACK CODE        00905000
         SPACE 1                                                        00905310
         CLC   FAILLABL,=C'GETBB1'     CALLED FROM 'DIRECT' GET, WHERE  00905320
*                                      FEEDBACK CODE 2 IS MEANINGFUL ?  00905330
         BNE   MSGRCFB2                NO, CONTINUE                     00905340
         CLI   PXPRETCD,PXPRCOKF       POWER RETCD = X'04' ?            00905350
         BNE   MSGRCFB2                NO, CONTINUE                     00905360
         CLI   PXPFBKCD,PXP04NOF       POWER FEEDBACK-1 = X'01' ?       00905370
         BNE   MSGRCFB2                NO, CONTINUE                     00905380
         UNPK  HELP,PXPFBKC2(2)        UNPACK HEX POWER FEEDBACK-2 CODE 00905390
         TR    HELP(2),TRTAB           CONVERT TO PRINTABLE HEX-VALUE   00905400
         MVC   FAILPWF2,HELP           INSERT POWER FEEDACK-2 CODE      00905410
MSGRCFB2 DS    0H                                                       00905420
         SPACE 1                                                        00905430
*   FOR RETC/FBKCD CODE PXP08CON (08/22) OR PXP08ROS (08/25) GENERALLY, 00905440
*   CONSIDER TO DISPLAY ALSO THE FEEDBACK-2 CODE FROM PXPFBKC2.         00905600
         BR    RE                      RETURN TO CALLER                 00906000
         SPACE 1                                                        00907000
MSGDSPLY DS    0H                                                       00908000
         DPLAY FAILMSG,72              DISPLAY FAILURE MESSAGE          00909290
         MVC   FAILMSG,FAILCOPY        REFRESH FAILURE MESSAGE          00909580
         SPACE 1                                                        00910000
         BR    RE                                                       00911000
         EJECT                                                          00912000
*********************************************************************** 00913000
**            >> CENTRAL XPCC SENDR ROUTINE  <<                      ** 00914000
**  BEFORE THIS ROUTINE IS CALLED, THE PROGRAM INSERTS THE CALLING   ** 00915000
**  POINT IN THE DIAGNOSTIC MESSAGE THAT IS ISSUED SHOULD THE SENDR  ** 00916000
**  MACRO FAIL.  THIS ROUTINE:                                       ** 00917000
**   - ISSUES THE XPCC MACRO WITH FUNC=SENDR AND WAITS FOR THE       ** 00918000
**     SECB TO BE POSTED.  IT CHECKS REGISTER 15 (RF) AND THE VSE    ** 00919000
**   - CHECKS REGISTER 15 (RF) AND THE VSE RETURN- AND REASON CODES  ** 00920000
**     IN FIELDS IJBXRETC AND IJBXREAS, RESPECTIVELY.                ** 00921000
**   - CHECKS THE VSE/POWER RETURN CODE IN FIELD PXPRETCD IF         ** 00922000
**     VSE/POWER DISCONNECTS THE COMMUNICATION PATH WITH A PURGE.    ** 00923000
**  THE ROUTINE RETURNS TO THE CALLER IF THE XPCC MACRO CALL COM-    ** 00924000
**  PLETED SUCCESSFULLY OR, IN CASE OF A FAILURE, THE VSE/POWER RE-  ** 00925000
**  TURN CODE IS NOT TOO SEVERE.  RETURN IS PROVIDED VIA REGISTER    ** 00926000
**  13 (RD).                                                         ** 00927000
*********************************************************************** 00928000
         SPACE 1                                                        00929890
*        REGISTER USAGE FOR SENDR ROUTINE                               00930780
         SPACE 2                                                        00931670
*        R3 - WORK REGISTER (FOR WAIT)                                  00932560
*        RD - REGISTER USED TO RETURN TO CALLER                         00933450
*                                                                       00934340
*        CALLED FROM: PUT REQUEST TO RDR QUEUE                          00935230
*                     CTL REQUEST                                       00936120
*                     GET REQUEST                                       00937010
*                     PUT REQUEST TO LST QUEUE                          00937900
*                     DATDSPLY ROUTINE                                  00938790
*                                                                       00939680
*        EXIT TO CALLER (SEE COMMENT ABOVE)                             00940570
*                OR TO DISCT OR FINDUMP IN CASE OF A FAILURE            00941460
*                                                                       00942350
         SPACE 2                                                        00943240
         SPACE 1                                                        00945000
SENDR    DS    0H                                                       00946000
         XPCC  XPCCB=(R4),FUNC=SENDR      SEND BUFFER TO VSE/POWER      00947000
         LTR   RF,RF               DID WE GET A ZERO RETURN CODE ?      00948000
         BZ    WAITSECB            ..YES, THEN WAIT FOR REPLY OF POWER  00949000
         SPACE 2                                                        00950000
*   IF THE SENDR MACRO COMPLETES WITH RF=X'08', THEN THE ROUTINE:       00951000
*   1.  FILLS THE DIAGNOSTIC MESSAGE ACCORDING TO THE VSE RETURN CODE.  00952000
*   2.  DISPLAYS THE MESSAGE.                                           00953000
*   3.  TERMINATES WITH OR WITHOUT A DUMP.                              00954000
*   THERE IS NO RETURN TO THE CALLER OF SENDR.                          00955000
         SPACE 1                                                        00956000
TESTRETC DS    0H                                                       00957000
         CLI   IJBXRETC,IJBXNOC3   DID POWER ABNORMALLY TERMINATE ?     00958000
         BE    ABNPOW              ..YES, THEN GO TO STOP PWRSASEX      00959000
         MVC   FAILFUNC,=C'SENDR  '    INSERT 'SENDR ' INTO MSG TEXT    00960000
         BAL   RE,MSGRETC          PUT XPCC RETURN CODE INTO MSG        00961000
         CLI   IJBXRETC,IJBXNOC2   DID POWER GIVE A DISCONNECT PURGE ?  00962000
         BE    TERMCONN            ..YES,THEN GO TO SHOW WHY, TERMINATE 00963000
         BAL   RE,MSGDSPLY         DISPLAY DIAGNOSTIC MESSAGE ON CONS.  00964000
         B     FINDUMP             TERMINATE PWRSASEX WITH PART.DUMP    00965000
         SPACE 1                                                        00966000
ABNPOW   DS    0H                                                       00967000
         DPLAY FAILM2,72                                                00968000
         SPACE 1                                                        00969000
         B     DISCT               DISCONN AND TERMIN XPCC LINK, EOJ    00970000
         SPACE 2                                                        00971000
*   THE ROUTINE WAITS FOR THE SEND ECB TO BE POSTED.  IT RETURNS TO THE 00972000
*   CALLER IF THE SYSTEM PASSED A REASON CODE OF ZERO, THAT IS, THE     00973000
*   XPCC CONNECTION IS ERROR FREE.                                      00974000
*   FOR A NON-ZERO REASON CODE, THE ROUTINE DISPLAYS A DIAGNOSTIC       00975000
*   MESSAGE AND TERMINATES WITH OR WITHOUT A DUMP.                      00976000
         SPACE 1                                                        00977000
WAITSECB DS    0H                                                       00978000
         LA    R3,IJBXSECB         LOAD ADDRESS OF SEND COMPLETION ECB  00979000
         WAIT  (R3)                WAIT FOR COMPLETION  OF SENDR        00980000
         CLI   IJBXREAS,REASOK     DID ANY CONNECTION ERROR OCCUR ?     00981000
         BER   RD                  .. NO, THEN RETURN TO CALLER         00982000
         SPACE 1                                                        00983000
BADREAS  DS    0H                                                       00984000
         TM    IJBXREAS,IJBXABDC   DID POWER TERMINATE ABNORMALLY ?     00985000
         BO    ABNPOW              .. YES, GIVE MESSAGE AND GO TO EOJ   00986000
         MVC   FAILFUNC,=C'SENDR  '    INSERT 'SENDR ' INTO MSG TEXT    00987000
         BAL   RE,MSGREAS          FILL XPCC REASON CODE INTO MSG       00988000
TERMCONN DS    0H                                                       00989000
         BAL   RE,MSGRCFB          PUT POWER RETURN/FEEDBACK TO MSG     00990000
         BAL   RE,MSGDSPLY         DISPLAY DIAGNOSTIC MESSAGE           00991000
         CLI   PXPRETCD,PXPRCPVL   POWER RC = PROTOCOL VIOLATION?       00992000
         BE    FINDUMP             .. YES, USER ERROR                   00993000
         B     DISCT               SYSTEM ERROR OCCURED        @D23QDIR 00994000
         EJECT                                                          00995000
*********************************************************************** 00996000
**                D E F I N I T I O N S                              ** 00997000
*********************************************************************** 00998000
         SPACE 2                                                        00999000
TRTAB    EQU   *-240               ENTRY POINT FOR TRANSLATE TABLE      01000000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6' TRANSLATE TABLE      01001000
         SPACE 1                                                        01002000
EIGHTDC  DC    X'08'               BYTE TO TEST RETURN CODE             01003000
HELP     DC    CL3' '              FIELD FOR UNPACK RET CODE            01004000
HELP5    DS    CL5                 FIELD FOR UNPACK JOBNUMBER           01004200
         DS    0D                  ENFORCE ALIGNMENT FOR 'CVD' FIELD    01004400
HELP8    DS    CL8                 FIELD FOR CONVERT DECIMAL JOBNUMBER  01004600
         SPACE 1                                                        01005000
WAITLIST DC    A(INTECB)           INTECB = 1ST ELEMENT OF WAITLIST     01006000
LISTCECB DC    A(0)                IJBXCECB = 2ND ELEM. OF WAITLIST     01007000
LISTEND  DC    X'FF'               INDICATE END OF WAITLIST             01008000
         SPACE 1                                                        01009000
INTECB   DS    F                   ECB USED TO WAIT FOR TIMER INTERVALS 01010000
         SPACE 1                                                        01011000
EIGHT    EQU   X'08'               RETURN CODE X'08'                    01012000
POSTBIT  EQU   X'80'               MASK FOR A POSTED ECB                01013000
REASOK   EQU   X'00'               ZERO VSE/AF REASON CODE              01014000
         EJECT                                                          01015000
*********************************************************************** 01016590
*            DEFINITIONS FOR PUT,CTL AND GET REQUEST                  * 01017180
*********************************************************************** 01017770
         SPACE 1                                                        01018360
M1       EQU   1                   MASK BIT SETTING                     01018950
M7       EQU   7                   MASK BIT SETTING                     01019540
ZERO     EQU   0                                                        01020130
ONE      EQU   1                                                        01020720
         SPACE 1                                                        01021310
NOOFRECS EQU   7                   NUMBER OF RECORDS IN A SEGMENT       01021900
DISP     EQU   C'L'                DISPOSITION OF OUTPUT TO BE SENT     01022490
PRIOR    EQU   C'9'                PRIORITY OF OUTPUT TO BE SENT        01023080
SEPPAGE  EQU   4                   NUMBER OR SEPARATOR PAGES/CARDS      01023670
         SPACE 1                                                        01024260
RECORDCT EQU   2                   USE R2 AS REC COUNTER IN LOOP        01024850
BUFPTR   EQU   10                  USE RA AS BUFPOINTER                 01025440
DATAPTR  EQU   11                  USE RB AS DATA POINTER               01026030
BUFLN    EQU   12                  USE RC TO CALC REMAINING BUFLEN      01026620
         SPACE 2                                                        01027210
JOBNAME  DS    CL8                 FIELD TO SAVE JOBNAME RET'D BY POW.  01027800
JOBNUM   DS    XL2                 FIELD TO SAVE JOBNUMB.RET'D BY POW.  01028390
PWRRECNO DS    F                   FIELD TO SAVE POW. LOGICAL REC NO.   01028980
JOBQNUM  DS    F                   FIELD TO SAVE INT. QUEUE ENTRY NO.   01029570
ZERONUM  DC    H'0'                TO INDICATE 'NO JOBNUMBER SPECIFIED' 01030160
*                                  BECAUSE SPLXQNUM IS 'UNIQUE'         01030750
GETFCT   DC    C' '                FIELD TO IDENTIFY GET AS CALLER OF   01031340
*                                                           DATDSPLY    01031930
         SPACE 1                                                        01032520
FORMS    DC    CL8'AABB'           FORMS OF OUTPUT TO BE SENT           01033110
JOBNLAB  DC    CL8'EXAMPSEG'       NAME OF OUTPUT TO BE SPOOLED         01033700
         SPACE 1                                                        01034290
JOBCMD   DS    0CL130              COMMAND AT ITS MAXIMUM LENGTH, TER-  01034880
*                                  MINATED WITH AT LEAST ONE BLANK(!)   01035470
CMDHEAD  DC    CL13'PDISPLAY LST,'   FIXED START OF COMMAND             01036060
CMDBODY  DC    CL117' '              DYNAMIC BODY/END OF COMMAND        01036650
         SPACE 1                                                        01037240
CMDCLAS  DC    C'CCLASS=S '        SELECTION CLASS FOR PDISPLAY         01037830
         SPACE 1                                                        01038420
FFDSPLY  DS    0CL72               MESSAGE EXTRACT FROM FF MSG RECORD   01039010
FFMHD    DC    CL23'1QSAS  LST JNM=        '   MSG HEADER PLUS JOBNAME  01039600
FFNHD    DC    CL10' JNB=     '                JOBNUMBER ONLY           01040190
FFCHD    DC    CL8' CLASS= '                   JOBCLASS ONLY            01040780
         DC    CL31' '                         BLANK MESSAGE TRAILER    01041370
         EJECT                                                          01041960
*********************************************************************** 01044000
*            MESSAGE AREA FOR FAILING MACRO CALLS                     * 01045000
*********************************************************************** 01046000
         SPACE 1                                                        01047000
FAILMSG  DS    0CL72                                                    01048000
F1       DC    C'FUNC='                                                 01049000
FAILFUNC DC    CL8' '              REQUESTED FUNCTION                   01050000
F2       DC    C' FAILED AT: '                                          01051000
FAILLABL DC    CL6' '              CODE LABEL OF FAILING FUNCTION       01052590
F3       DC    C' XPCC='                                                01053180
FAILRETC DC    CL2'00'             RETURN CODE RECEIVED IN IJBXRETC     01054000
F4       DC    C'/'                                                     01055000
FAILREAS DC    CL2'00'             REASON CODE RECEIVED IN IJBXREAS     01056000
F5       DC    C' PWR-RC/FB1/FB2='                                      01057490
FAILPWRC DC    CL2'00'             VSE/POWER RETURN CODE IN IJBXRUSR    01058000
F6       DC    C'/'                                                     01059000
FAILPWFB DC    CL2'00'             POWER FEEDBACK CODE 1 IN IJBXRUSR    01060190
F7       DC    C'/'                                                     01060380
FAILPWF2 DC    CL2'00'             POWER FEEDBACK CODE 2 IN IJBXRUSR    01060570
F8       DC    CL6' '                                                   01060760
         SPACE 1                                                        01060950
FAILCOPY DS    CL72                                                     01061140
         SPACE 1                                                        01062000
FAILM1   DC    CL72'VSE/POWER ALREADY IN TERMINATION, NO MORE CONNECTIO*01063000
               N REQUEST ACCEPTED'                                      01064000
FAILM2   DC    CL72'VSE/POWER ABNORMAL TERMINATION, CONNECTION DISRUPTE*01065000
               D'                                                       01066000
FAILM3   DC    CL72'CONNECTION COULD NOT BE COMPLETED WITHIN 2 MINUTES' 01067000
FAILM4   DC    CL72'LIST QUEUE ENTRY COULD NOT BE FOUND, PWRSASEX WILL *01068000
               STOP'                                                    01069000
         SPACE 1                                                        01070000
SUCCM1   DC    CL72'>>> XPCC CONNECTION TO VSE/POWER SUCCESSFULLY BUILT*01071000
                <<<'                                                    01072000
SUCCM1A  DC    CL72'>>> PWRSASEX WILL SUBMIT JOB ''EXAMPLE'' FOR EXECUT*01073390
               ION IN CLASS 4 (!) <<<'                                  01073780
SUCCM1B  DC    CL72'>>> PWRSASEX WILL WAIT FOR EXECUTION OF JOB ''EXAMP*01074170
               LE'' IN CLASS 4 <<<'                                     01074560
SUCCM1C  DC    CL72'>>> NOW ISSUE PDISPLAY FOR OUTPUT ''EXAMPLE'' AND P*01074950
               ASS IT TO CONSOLE <<<'                                   01075340
SUCCM2   DC    CL72'>>> NOW PWRSASEX WILL RESTART ON RECORD NO.12 <<<'  01075730
SUCCM3   DC    CL72'>>> THE VSE/POWER LIST QUEUE MUST NOW CONTAIN 3 RBS*01076120
               -LIKE SEGMENTS ... <<<'                                  01076510
SUCCM4   DC    CL72'>>> ... NAMED ''EXAMPSEG'' AND A SINGLE ENTRY NAMED*01076900
                ''EXAMPLE'' <<<'                                        01077290
SUCCM6   DC    CL72'>>> *** SUCCESSFUL TERMINATION OF PWRSASEX *** <<<' 01078000
SUCCM7   DC    CL72'>>> NOW FOLLOWS THE DISPLAY OF THE LIST ENTRY ''EXA*01079590
               MPLE'' <<<'                                              01080180
SUCCM8   DC    CL72'>>> NEXT PWRSASEX WILL SUBMIT DATA TO THE LIST QUEU*01081000
               E <<<'                                                   01082000
         EJECT                                                          01083000
*********************************************************************** 01084000
*         JOB 'EXAMPLE' TO BE PASSED TO VSE/POWER                     * 01085000
*********************************************************************** 01086000
         SPACE 1                                                        01087000
JECL1    DC    C'* $$ JOB JNM=EXAMPLE,DISP=K,CLASS=4                 '  01088690
JECL2    DC    C'* $$ LST LST=SYSLST,DISP=K,CLASS=S                  '  01089490
JCL1     DC    C'// JOB EXAMPLE                                      '  01090000
DATACARD DC    C'* 01---------------------*----------------------01 *'  01091000
         DC    C'* 02-------------------*    *-------------------02 *'  01092000
         DC    C'* 03-----------------*        *-----------------03 *'  01093000
         DC    C'* 04---------------*            *---------------04 *'  01094000
         DC    C'* 05-------------*                *-------------05 *'  01095000
         DC    C'* 06-----------*                    *-----------06 *'  01096000
         DC    C'* 07---------*                        *---------07 *'  01097000
         DC    C'* 08-------*                            *-------08 *'  01098000
         DC    C'* 09-----*                                *-----09 *'  01099000
         DC    C'* 10---*                                    *---10 *'  01100000
         DC    C'* 11-*                                        *-11 *'  01101000
         DC    C'* 12---*                                    *---12 *'  01102000
         DC    C'* 13-----*                                *-----13 *'  01103000
         DC    C'* 14-------*                            *-------14 *'  01104000
         DC    C'* 15---------*                        *---------15 *'  01105000
         DC    C'* 16-----------*                    *-----------16 *'  01106000
         DC    C'* 17-------------*                *-------------17 *'  01107000
         DC    C'* 18---------------*            *---------------18 *'  01108000
         DC    C'* 19-----------------*        *-----------------19 *'  01109000
         DC    C'* 20-------------------*    *-------------------20 *'  01110000
         DC    C'* 21---------------------*----------------------21 *'  01111000
JCL2     DC    C'/&&                                                  ' 01112000
JECL3    DC    C'* $$ EOJ                                            '  01113000
ENDIND   DC    C'/+'                                                    01114000
         EJECT                                                          01115000
*********************************************************************** 01116000
*        CROSS PARTITION CONTROL BLOCK                                * 01117000
*********************************************************************** 01118000
         SPACE 1                                                        01119000
OWNXPCCB XPCCB APPL=PWRSASEX,TOAPPL=SYSPWR,                            *01120000
               BUFFER=(SENDBUF,400),REPAREA=(REPLBUF,500)               01121000
         SPACE 2                                                        01122000
*********************************************************************** 01123000
*        STORAGE RESERVATION FOR  XPCC SEND AND REPLY BUFFER          * 01124000
*********************************************************************** 01125000
         SPACE 1                                                        01126000
SENDBUF  DS    CL400              BUFFER USED FOR XPCC SENDR TO POWER   01127000
LASTPREC DC    A(SENDBUF+L'SENDBUF-RECPRFXL-L'DATACARD) LAST POSSIBLE   01128000
*                                 RECORD THAT FITS INTO SEND BUFFER     01129000
REPLBUF  DS    CL500              BUFFER FOR RECEIPT OF DATA FROM POWER 01130000
         EJECT                                                          01131000
*********************************************************************** 01132000
         LTORG                                                          01133000
*********************************************************************** 01134000
         EJECT                                                          01135000
**********************************************************************@ 01136000
**      >>          GENERATE   S P L                  <<             *@ 01137000
**       THIS SPL IS LATER ON UPDATED IN ORDER TO INDICATE A         *@ 01138000
**       PUT, CTL, OR GET REQUEST WITH THE DESIRED PARAMETERS        *@ 01139490
**********************************************************************@ 01140000
         SPACE 1                                                      @ 01141000
OWNSPL   PWRSPL TYPE=GEN,USERID=SASUSER1,PRFX=OWN                     @ 01142000
         EJECT                                                        @ 01143000
*********************************************************************** 01144000
*        DUMMY SECTION OF  VSE/POWER SPOOL PARAMETER LIST (SPL)       * 01145000
*********************************************************************** 01146000
         SPACE 1                                                        01147000
OWNSPLDS PWRSPL TYPE=MAP                                                01148000
         EJECT                                                          01149000
*********************************************************************** 01150000
*        DUMMY SECTION OF  CROSS PARTITION CONTROL BLOCK  (XPCCB)     * 01151000
*********************************************************************** 01152000
         SPACE 1                                                        01153000
         MAPXPCCB                                                       01154000
         EJECT                                                          01155000
*********************************************************************** 01156000
*        GENERAL EQUATES                                              * 01157000
*********************************************************************** 01158000
         SPACE 1                                                        01159000
R0       EQU   0                   WORK REGISTER                        01160000
R1       EQU   1                   WORK REGISTER + USED BY PWRSPL MACRO 01161000
R2       EQU   2                   WORK REGISTER                        01162000
R3       EQU   3                   WORK REGISTER                        01163000
R4       EQU   4                   ADDR REG FOR XPCCB DSECT             01164000
R5       EQU   5                   ADDR REG FOR USER DATA TO BE SENT    01165000
R6       EQU   6                   ADDR REG FOR RECEIVED USER DATA      01166000
R7       EQU   7                   ADDR REG FOR SPL DSECT               01167000
R8       EQU   8                   FIRST BASE REGISTER OF PWRSASEX      01168000
R9       EQU   9                   SECOND BASE REGISTER OF PWRSASEX     01169000
RA       EQU   10                  WORK REGISTER                        01170000
RB       EQU   11                  WORK REGISTER                        01171000
RC       EQU   12                  WORK REGISTER                        01172000
RD       EQU   13                  BRANCH AND LINK REGISTER FOR SENDR   01173000
RE       EQU   14                  BRANCH AND LINK REG. FOR DATDSPLY    01174000
RF       EQU   15                  MACRO CALL RETURN CODE REGISTER      01175000
         SPACE 1                                                        01176000
