*%/*                                                                    00002700
         MACRO                                                          00050000
&NAME    MODESET  &KEY=,&MODE=,&REG=,&MF=,                             X00100001
               &EXTKEY=,&SAVEKEY=,&KEYADDR=,&WORKREG=,&RELATED=,       X00150000
               &KEYREG=                                                 00190001
.*                                                             @D61BDVB 00230001
         GBLC  &SYSSPLV                                        @D61BDVB 00270001
         LCLA  &PSWKEY                                                  00310001
.* THE FOLLOWING ARE THE LOCAL SET SYMBOLS FOR THE 4 BYTE PARM LIST     00350000
         LCLB  &B0,&B1,&B2,&B3,&B4,&B5,&B6,&B7                          00400000
         LCLB  &B8,&B9,&B10,&B11,&B12,&B13,&B14,&B15                    00450000
         LCLB  &B16,&B17,&B18,&B19,&B20,&B21,&B22,&B23                  00500000
         LCLB  &B24,&B25,&B26,&B27,&B28,&B29,&B30,&B31                  00550000
.* THE FOLLOWING ARE USED BY THE VSE EXTENSION                 @D61BDVB 00551801
         LCLA  &NUMBER                                         @D61BDVB 00553601
         LCLC  &UREG                                           @D61BDVB 00555401
         LCLC  &EKEY                                           @D61BDVB 00557201
         LCLC  &SKEYREG                                        @D61BDVB 00559001
         AGO   .SKIP                                           @D61BDVB 00560801
******************************************************                  00562601
*                                                    *                  00564401
*   LICENSED MATERIALS - PROPERTY OF IBM             *                  00566201
*   THIS MACRO IS "RESTRICTED MATERIALS OF IBM"      *                  00568001
*   5686-032 (C) COPYRIGHT IBM CORP. 1993            *                  00569801
*   SEE COPYRIGHT INSTRUCTIONS                       *                  00571601
*                                                    *                  00573401
******************************************************                  00575201
.SKIP    ANOP                                                  @D61BDVB 00577001
.*------------------------------------------------------------*@D61BDVB 00578801
.*       IBM DISK OPERATING SYSTEM                                      00580601
.*       SUPERVISOR - MODESET - 5686-007-06-C44                         00582401
.*------------------------------------------------------------*@D61BDVB 00584201
.**** START OF SPECIFICATIONS ***************************************** 00586001
.*                                                                    * 00587801
.*01* MACRO NAME = MODESET                                         *    00589601
.*                                                                    * 00591401
.*01* DESCRIPTIVE NAME = PERFORMS FAST KEY / MODE SWITCH              * 00593201
.*                                                                    * 00595001
.*01* FUNCTION   = PERFORMS PSWKEY AND/OR MODE SWITCH                 * 00596801
.*                 (1) AS LINE CODE - REQUIRING (SEMI-)PRIVILEGD STATE* 00598601
.*                 (2) AS SVC - REQUESTING SUPERVISOR SERVICE         * 00600401
.*                                                                    * 00602201
.*01* NOTES =      MVS COMPATIBLE MACRO (IMPORTED FROM MVS            * 00604001
.*                 FOR VSE/ESA 1.4.0) REQUIRES SPLEVEL SET=4          * 00605801
.*                                                                    * 00607601
.*                 PREVIOUS VSE MACRO EXPANSION IS FORCED VIA         * 00609401
.*                 SPLEVEL SET=N , N<4                                * 00611201
.*                                                                    * 00613001
.*02* PROCESSOR = ASSEMBLER-H - PL/AS (BILINGUAL)                     * 00614801
.*                                                                    * 00616601
.*01* MACRO PARAMETERS =                                              * 00618401
.*    (1) IN-LINE CODE GENERATION                                     * 00620201
.*        EXTKEY     =   ZERO|TCB                                     * 00622001
.*       |KEYADDR    =   ADDRESS OF ONE BYTE-FIELD, CONTAINING THE KEY* 00623801
.*       |KEYREG     =   REGISTER CONTAINING THE KEY                  * 00625601
.*                       (ONE OF THIS PARAMETERS IS REQUIRED)         * 00627401
.*        SAVEKEY    =   ADDRES OR REGISTER WHERE CURRENT KEY SHOULD  * 00629201
.*                       BE SAVED                                     * 00631001
.*        WORKREG    =   REGISTER TO BE USED AS WORKREG               * 00632801
.*        RELATED    =   ANY VALUE (FOR DOCUMENTATION ONLY)           * 00634601
.*    (2) SVC GENERATION                                              * 00636401
.*        KEY        =   ZERO|NZERO|USER                              * 00638201
.*        MODE       =   PROB|SUP                                     * 00640001
.*                       (AT LEAST ONE OF THE PARAMETERS MUST BE      * 00641801
.*                        SPECIFIED FOR MF=L OR WITHOUT MF)           * 00643601
.*        RELATED    =   ANY VALUE (FOR DOCUMENTATION ONLY)           * 00645401
.*        MF         =   L|(E,LIST)                                   * 00647201
.*                       LIST OR EXECUTE FORMAT                       * 00649001
.*01* MACROS = NONE                                                   * 00650801
.*                                                                    * 00652601
.*01* STATUS = VSE/ESA 2.1.0  (Y-4)  - VSE COMPONENT. SIF             * 00654401
.*                        93-10-24 MVS COMPATIBLE MODESET             * 00656201
.*--------------------------------------------------------------------* 00658001
.*01*RESTRICTIONS FOR PREVIOUS VSE/ESA                                * 00659801
.*        LABEL   MODESET  EXTKEY=N/(REG)                             * 00661601
.*                         WORKREG=(REG)                              * 00663401
.*                         SAVEKEY=OLD-KEY-ADDR/(REG)                 * 00665201
.*        OR                                                          * 00667001
.*                                                                    * 00668801
.*        LABEL   MODESET  KEY=ZERO/USER                              * 00670601
.*                                                                    * 00672401
.*        PARAMETERS:                                                 * 00674201
.*        EXTKEY:          N IS NEW PSW KEY IF EXTKEY=N OR            * 00676001
.*                         THE REGISTER R CONTAINS THE NEW PSW KEY IF * 00677801
.*                         EXTKEY=(R)                                 * 00679601
.*        WORKREG:         REGISTER USED FOR SAVING REGISTER 2        * 00681401
.*        SAVEKEY:         SAVES OLD PSW KEY (ADDRESS OR REGISTER)    * 00683201
.*                                                                    * 00685001
.*        IF THE KEY PARAMETER IS SET, ALL OTHER PARAMETERS MUST BE   * 00686801
.*        OMITTED                                                     * 00688601
.*                                                                    * 00690401
.*        KEY:             =ZERO MEANS, THAT THE USER WANTS TO HAVE   * 00692201
.*                               PSW KEY 0                            * 00694001
.*                         =USER MEANS, THAT THE CALLER HAS PSW KEY 0 * 00695801
.*                               NOW AND WANTS TO HAVE HIS OLD KEY    * 00697601
.*                               AGAIN                                * 00699401
.*                                                                    * 00701201
.** END OF SPECICATIONS *********************************************** 00703001
.*   MACCOMP Y-1 SC1CL/PZD81                                          * 00704801
.*   MACSTAT Y-1 72273/DCR20593                                       * 00706601
.*   MACSTAT Y-3 77277/OZ26071                               @ZA26071 * 00708401
.*   MACSTAT Y-3 82039/OZ59816 MISSING & ON KEYREG PARAMETER @ZA59816 * 00710201
.*   MACSTAT Y-4 93200/ VSE/ESA SINGLE SUPERVISOR            @D61BDVB * 00712001
.*   STATUS  OS/VS2 HBB2102                                    @G860PXB 00713801
.*                                                                 @D1A 00715601
.*$D1=0057      JBB1326   800923   PDXB:   KEY 2,3,4,7 SUPPORT     @D1A 00717401
.*                                         KEYREG,RELATED SUPPORT  @D1A 00719201
.*$P1=0187      JBB1326   810130   PDXB                            @P1A 00721001
.*              VSE/ESA   931208   MVS COMPATIBLE MODESET      @D61BDVB 00722801
.*------------------------------------------------------------*@D61BDVB 00724601
.* TEST FOR SPLEVEL (PREVIOUS VSE VERSION REQUESTED)          *@D61BDVB 00726401
.*------------------------------------------------------------*@D61BDVB 00728201
.*                                                             @D61BDVB 00730001
         SPLEVEL TEST                                          @D61BDVB 00731801
         AIF  (('&SYSSPLV' EQ '1') OR                                  *00733601
               ('&SYSSPLV' EQ '2') OR                                  *00735401
               ('&SYSSPLV' EQ '3')).VSEOLD                     @D61BDVB 00737201
.*------------------------------------------------------------*@D61BDVB 00739001
*   MODESET VSE-ESA 2.1.0 - MACSTAT Y-4                                 00740801
.*                                                             @D61BDVB 00742601
         AIF  ((T'&KEY EQ 'O') AND (T'&MODE EQ 'O') AND                X00744401
                (T'&MF EQ 'O') AND (T'&REG EQ '0')).PCK        @D61BDVB 00747201
         AGO   .PCK1                                                    00750000
.PCK     AIF   ((T'&EXTKEY EQ 'O') AND (T'&SAVEKEY EQ 'O') AND         X00800000
               (T'&KEYADDR EQ 'O') AND (T'&WORKREG EQ 'O') AND         X00850000
               (T'&KEYREG EQ 'O')).ERROR9                      @ZA59816 00900000
.*                                                                      00925001
.*------------------------------------------------------------*@D61BDVB 00950001
.* TEST FOR PROTECTION KEY PARAMETERS (INLINE CODE GENERATION)*@D61BDVB 00975001
.*------------------------------------------------------------*@D61BDVB 01000001
.PCK1    AIF   ((T'&EXTKEY NE 'O') OR                                  *01025001
               (T'&KEYADDR NE 'O') OR                                  *01050001
               (T'&SAVEKEY NE 'O') OR                                  *01060002
               (T'&KEYREG NE 'O')).INLINE                      @D61BDVB 01075001
.*------------------------------------------------------------*@D61BDVB 01100001
.* MODESET SVC MACRO GENERATION                               *@D61BDVB 01125001
.*------------------------------------------------------------*@D61BDVB 01150001
.*           TEST FOR NO LONGER SUPPORTED PARAMETERS           @D61BDVB 01175001
.*                                                             @D61BDVB 01200001
         AIF   (T'&REG NE 'O').ERROR1     REG NOT SUPPORTED    @D61BDVB 01225001
         AIF   ((T'&MF NE 'O') AND ('&MF' NE 'L')).MF                   01250000
         AIF   (T'&KEY EQ 'O').MDE     KEY NOT SPECIFIED                01300000
         AIF   (('&KEY' NE 'ZERO') AND ('&KEY' NE 'NZERO') AND         *01333301
                ('&KEY' NE 'USER')).ERROR2                     @D61BDVB 01366601
&B26     SETB  1                                                        01400000
&B27     SETB  ('&KEY' EQ 'ZERO')      SET 0 KEY IF ZERO SPECIFIED      01450000
.MDE     ANOP                                                           01500000
         AIF   (T'&MODE EQ 'O').ENAB   MODE NOT SPECIFIED               01550000
         AIF   (('&MODE' NE 'PROB') AND ('&MODE' NE 'SUP')).ERROR3      01600000
&B29     SETB  1                                                        01650000
&B28     SETB  ('&MODE' EQ 'SUP')      INDICATE SUPV STATE IF SUP SPEC  01700000
.ENAB    ANOP                                                           01750000
.MF      ANOP                                                           02050000
         AIF   (T'&MF NE 'O').CK2      WAS MF OMITTED?                  02100000
         CNOP  0,4                                                      02150000
&NAME    BAL   1,*+8                                                    02200000
         AGO   .DC                                                      02250000
.CK2     ANOP                                                           02300000
         AIF   ('&MF' NE 'L').CK3      WAS MF=L SPECIFIED?              02350000
&NAME    DS    0F                                                       02400000
.DC      ANOP                                                           02450000
         DC    B'&B0&B1&B2&B3&B4&B5&B6&B7&B8&B9&B10&B11&B12&B13&B14&B15X02500000
               &B16&B17&B18&B19&B20&B21&B22&B23&B24&B25&B26&B27&B28&B29X02550000
               &B30&B31'                                                02600000
         AIF   (T'&MF EQ 'O').LD                                        02650000
         MEXIT                                                          08300000
.LD      ANOP                                                           08342100
         L     1,0(0,1)                                                 08384201
         AGO   .SVC                                                     08426300
.CK3     ANOP                                                           08468400
         AIF   ('&MF(1)' NE 'E').ERROR6                        @D61BDVB 08518401
         AIF   ((T'&KEY NE 'O') OR (T'&MODE NE 'O')).ERROR8    @D61BDVB 08568401
.CK6     AIF   ('&MF(2)' NE '(1)').CK5                                  08721000
&NAME    L     1,0(1,0)                                                 08763101
         AGO   .SVC                                                     08805200
.CK5     ANOP                                                           08847300
         AIF   ('&MF(2)'(1,1) EQ '(').ERROR7                            08889400
         AIF   (T'&MF(2) EQ 'N').ERROR7                                 08931500
&NAME    L     1,&MF(2)                                                 08973600
.SVC     ANOP                                                           09015700
         SIMSVC WR=(15)                                        @D61BDVB 09036701
         SVC   107                                                      09057800
         MEXIT                                                          09100000
.*                                                             @D61BDVB 09100501
.*------------------------------------------------------------*@D61BDVB 09101001
.* MODESET INLINE CODE MACRO GENERATION                        @D61BDVB 09101501
.*------------------------------------------------------------*@D61BDVB 09102001
.* TEST THAT THE PROTECTION KEY PARAMETERS ARE MUTUALLY EXCLUSIVE       09102900
.* FROM OTHER MODESET PARAMETERS                                        09105800
.INLINE  ANOP                                                  @D61BDVB 09106800
.*       AIF   ('&SYSSPLV' EQ '4').ERROR21                     @D....VB 09107800
         AIF   ((T'&KEY NE 'O') OR (T'&MODE NE 'O') OR                 *09108801
               (T'&REG NE 'O') OR (T'&MF NE 'O')).ERROR11      @D61BDVB 09110401
         AIF   (T'&NAME    EQ 'O').EXTKEY                      @D61BDVB 09112701
&NAME    DS    0H                                              @D61BDVB 09115001
.EXTKEY  ANOP                                                           09117400
.* TEST IF EXTKEY PARAMETER SPECIFIED AND VALID                         09120300
         AIF   (T'&EXTKEY EQ 'O').KEYAD   TEST IF EXTKEY OMITTED        09123200
         AIF   (T'&KEYADDR NE 'O').ERROR15   ERROR IF KEYADDR ALSO      09126100
         AIF   (T'&KEYREG NE 'O').ERROR15    ERROR IF KEYREG ALSO  @D1A 09129000
         AIF   ('&EXTKEY' EQ 'SCHED').SCHED       SCHEDULER KEY         09131900
         AIF   (('&EXTKEY' EQ 'HASP') OR ('&EXTKEY' EQ 'JES')).JES      09134800
.*                                                JES KEY               09137700
         AIF   ('&EXTKEY' EQ 'RSM').RSM           RSM KEY               09140600
         AIF   ('&EXTKEY' EQ 'VSM').VSM           VSM KEY               09143500
         AIF   ('&EXTKEY' EQ 'SRM').SRM           SRM KEY               09146400
         AIF   ('&EXTKEY' EQ 'SUPR').SUPR         SUPREVISOR KEY        09149300
         AIF   ('&EXTKEY' EQ 'DATAMGT').DTMGT     DATA MGT KEY          09152200
         AIF   ('&EXTKEY' EQ 'TCAM').TCAM         TCAM KEY              09155100
         AIF   ('&EXTKEY' EQ 'VTAM').VTAM         VTAM KEY              09158000
         AIF   ('&EXTKEY' EQ 'TCB' ).EXTKEY0                   @D61BDVB 09160101
         AIF   (('&EXTKEY' EQ 'RBT1') OR                               X09162201
                ('&EXTKEY' EQ 'RBT234')).ERROR20               @D61BDVB 09164401
         AIF   ('&EXTKEY' EQ 'ZERO').ZEROK                              09166700
         AIF   ('&EXTKEY' EQ 'KEY2').ZEROD                     @D61BDVB 09169601
         AIF   ('&EXTKEY' EQ 'KEY3').ZEROD                     @D61BDVB 09172501
         AIF   ('&EXTKEY' EQ 'KEY4').ZEROD                     @D61BDVB 09175401
         AIF   ('&EXTKEY' EQ 'KEY7').ZEROD                     @D61BDVB 09178301
         AGO   .ERROR16                                                 09181200
.EXTKEY0 AIF   (T'&WORKREG EQ 'O').ERROR14                              09184100
         AIF   ((&WORKREG LT 0) OR (&WORKREG GT 15)).ERROR12            09187000
         AIF   (T'&SAVEKEY EQ 'O').EXTKEY1                              09189900
         AIF   ('&SAVEKEY' EQ '(2)').WKREG10                   @D61BDVB 09192201
         AIF   (&WORKREG EQ 2).WKREG10 SKIP REG SAVING IF REG2 @D61BDVB 09194501
         LR    &WORKREG,2          SAVE REGISTER 2             @D61BDVB 09196801
.WKREG10 ANOP                                                  @D61BDVB 09199101
         IPK   0(0)                SAVE CURRENT PSW KEY                 09201500
         AIF   ('&SAVEKEY' EQ '(2)').EXTKEY1                   @D61BDVB 09202901
         STC   2,&SAVEKEY                                               09204400
         AIF   (&WORKREG EQ 2).EXTKEY1 SKIP REG SAVING IF REG2 @D61BDVB 09205801
         LR    2,&WORKREG          RESTORE REGISTER 2                   09207300
.EXTKEY1 ANOP                                                           09230500
         AIF   ('&EXTKEY' EQ 'TCB').TCB     KEY FROM TCB                09233400
         AIF   ('&EXTKEY' EQ 'RBT1').RBT1   KEY FROM SVRB               09236300
         AIF   ('&EXTKEY' EQ 'RBT234').RBT234  KEY FROM CALLERS RB      09239200
.* SYMBOLIC NONE PUBLIC VALUES - NOT SUPPORTED BY VSE/ESA      @D61BDVB 09242101
.SCHED   ANOP                                                           09245000
&PSWKEY  SETA  X'10'          SCHEDULER KEY IS 1                        09247900
         AGO   .MVSKEY                                         @D61BDVB 09250801
.JES     ANOP                                                           09253700
&PSWKEY  SETA  X'10'          JES KEY IS 1                              09256600
         AGO   .MVSKEY                                         @D61BDVB 09259501
.RSM     ANOP                                                           09262400
&PSWKEY  SETA  0              RSM KEY IS 0                              09265300
         AGO   .MVSKEY                                         @D61BDVB 09268201
.VSM     ANOP                                                           09271100
&PSWKEY  SETA  0              VSM KEY IS 0                              09274000
         AGO   .MVSKEY                                         @D61BDVB 09276901
.SRM     ANOP                                                           09279800
&PSWKEY  SETA  0              SYSTEM RESOURCE MANAGER KEY IS 0          09282700
         AGO   .MVSKEY                                         @D61BDVB 09285601
.SUPR    ANOP                                                           09288500
&PSWKEY  SETA  0              SUPERVISOR KEY IS 0                       09291400
         AGO   .MVSKEY                                         @D61BDVB 09294301
.DTMGT   ANOP                                                           09297200
&PSWKEY  SETA  X'50'          DATA MGT KEY IS 5                         09300100
         AGO   .MVSKEY                                         @D61BDVB 09303001
.TCAM    ANOP                                                           09305900
&PSWKEY  SETA  X'60'          TCAM KEY IS 6                             09308800
         AGO   .ZEROD                                          @D....VB 09311700
.VTAM    ANOP                                                           09314600
&PSWKEY  SETA  X'60'          VTAM KEY IS 6                             09317500
         AGO   .ZEROD                                          @D....VB 09317800
.RBT1    ANOP                 EXTKEY=RBT1   NOT VALID IN VSE   @D61BDVB 09318101
         AGO   .MVSKEY                                                  09318401
.RBT234  ANOP                 EXTKEY=RBT234 NOT VALID IN VSE   @D61BDVB 09318701
.*                                                                      09319001
.*------------------------------------------------------------*@D61BDVB 09319401
.* GATHER SPECIAL MVS INTERNAL KEY SETTINGS                    @D61BDVB 09319801
.*------------------------------------------------------------*@D61BDVB 09320201
.MVSKEY  AGO   .ERROR20                                        @D61BDVB 09320601
.*------------------------------------------------------------*@D61BDVB 09321001
.* GATHER KEY1 - KEY7 --- VSE/ESA ACTION: KEY=0                @D61BDVB 09321401
.*------------------------------------------------------------*@D61BDVB 09321801
.ZEROD   ANOP                                                  @D61BDVB 09322201
         MNOTE 1,' EXTKEY ARGUMENT SET TO KEY0 BY VSE/ESA '    @D61BDVB 09322700
.ZEROK   ANOP                                                           09323300
&PSWKEY  SETA  0                                                        09326200
         AGO   .SETKEY                                                  09329100
.*------------------------------------------------------------*@D61BDVB 09339201
.* GET KEY FROM PCB                                           *@D61BDVB 09349301
.*------------------------------------------------------------*@D61BDVB 09359401
.TCB     ANOP                                                           09369700
         IC    &WORKREG,PCEKEY     GET KEY FROM PCB            @D61BDVB 09379801
         SPKA  0(&WORKREG)         SET PSW KEY                          09390000
         MEXIT                                                          09400000
.*------------------------------------------------------------*@D61BDVB 09450001
.* EXTKEY PARAMETER PROCESSING                                 @D61BDVB 09500001
.*------------------------------------------------------------*@D61BDVB 09550001
.SETKEY  ANOP                                                           09790000
         AIF   (T'&SAVEKEY EQ 'O').SETKEYC                     @D61BDVB 09816201
         AIF   ('&SAVEKEY' EQ '(2)').SETKEYB                   @D61BDVB 09842401
         AIF   (T'&WORKREG EQ 'O').ERROR14  TEST FOR WORKREG OPERAND    09868600
         AIF   ((&WORKREG LT 0) OR (&WORKREG GT 15)).ERROR12 VALID CHK  09874800
         AIF   (&WORKREG EQ 2).SETKEYB  TEST IF REG 2 TO BE SAVED       09881000
         LR    &WORKREG,2          SAVE REGISTER 2                      09893401
.SETKEYB ANOP                                                           09905800
         IPK   0(0)               SAVE CURRENT PSW KEY                  09912001
.SETKEYC ANOP                                                           09918200
         SPKA  &PSWKEY.(0)         SET PSW KEY                          09924400
         AIF   (T'&SAVEKEY EQ 'O').SETKEYX                     @D61BDVB 09926401
         AIF   ('&SAVEKEY' EQ '(2)').SETKEYX                   @D61BDVB 09928401
         STC   2,&SAVEKEY                                               09930600
         AIF   (&WORKREG EQ 2).SETKEYX                         @D61BDVB 09936801
         LR    2,&WORKREG     RESTORE REGISTER 2                        09943000
.SETKEYX ANOP                                                  @D61BDVB 09946501
         MEXIT                                                          09950000
.*------------------------------------------------------------*@D61BDVB 09975901
.* KEYADDR PARAMETER PROCESSING                                @D61BDVB 10001801
.*------------------------------------------------------------*@D61BDVB 10027701
.KEYAD   ANOP                                                           10053800
         AIF   (T'&KEYADDR EQ 'O').KREG      TEST IF KEYADDR OMITTED    10057600
         AIF   (T'&KEYREG NE 'O').ERROR15                          @D1A 10061400
         AIF   ('&KEYADDR' EQ '(2)').KEYAD10                            10065200
         AIF   (T'&WORKREG EQ 'O').ERROR14   TEST FOR WORKREG OPERAND   10069000
         AIF   ((&WORKREG LT 0) OR (&WORKREG GT 15)).ERROR12 VALID CHK  10072800
         AIF   (T'&SAVEKEY EQ 'O').KEYAD2                      @D61BDVB 10076601
         AIF   ('&SAVEKEY' EQ '(2)').KEYAD1                    @D61BDVB 10080401
         AIF   (&WORKREG EQ 2).KEYAD1   TEST IF REG 2 TO BE SAVED       10084200
         LR    &WORKREG,2          SAVE REGISTER 2                      10091801
.KEYAD1  ANOP                                                           10099400
         IPK   0(0)                SAVE CURRENT PSW KEY                 10103201
         AIF   ('&SAVEKEY' EQ '(2)').KEYAD2                    @D61BDVB 10107001
         STC   2,&SAVEKEY                                               10110800
         AIF   (&WORKREG EQ 2).KEYAD2                                   10114600
         LR    2,&WORKREG          RESTORE REGISTER 2                   10118400
.KEYAD2  ANOP                                                           10122200
         IC    &WORKREG,&KEYADDR   GET KEY FROM SAVE LOCATION           10126000
         SPKA  0(&WORKREG)         SET PSW KEY                          10145000
         MEXIT                                                          10150000
.*                                                                      10196001
.KEYAD10 AIF   (T'&SAVEKEY EQ 'O').KEYAD11                              10242000
         AIF   ('&SAVEKEY' EQ '(2)').ERROR18                            10265000
         AIF   (T'&WORKREG EQ 'O').ERROR14                              10288000
         AIF   (&WORKREG EQ 2).ERROR18                                  10311000
         LR    &WORKREG,2          SAVE REGISTER 2                      10334001
         IPK   0(0)                SAVE CURRENT PSW KEY                 10357000
         STC   2,&SAVEKEY                                               10380000
         LR    2,&WORKREG          RESTORE REGISTER 2                   10403000
.KEYAD11 ANOP                                                           10414501
         SPKA  0(2)               SET PSW KEY                           10426000
         MEXIT                                                          10450000
.*------------------------------------------------------------*@D61BDVB 10487501
.* KEYREG  PARAMETER PROCESSING                                @D61BDVB 10525001
.*------------------------------------------------------------*@D61BDVB 10562501
.KREG    ANOP                                                      @D1A 10600000
         AIF   (T'&KEYREG EQ 'O').NKEYAD                           @D1A 10650000
         AIF   (T'&SAVEKEY EQ 'O').KREG15                      @D61BDVB 10700001
         AIF   ('&SAVEKEY(1)' EQ '&KEYREG').ERROR19                @D1A 10750000
         AIF   ('&SAVEKEY' EQ '(2)').KREG10                        @D1A 10800000
         AIF   (T'&WORKREG EQ 'O').ERROR14                         @D1A 10850000
         AIF   ((&WORKREG LT 0) OR (&WORKREG GT 15)).ERROR12       @P1A 10900000
         AIF   (&WORKREG EQ 2).ERROR18                             @D1A 10950000
         AIF   ('&WORKREG' EQ '&KEYREG').ERROR19                   @D1A 11000000
         LR    &WORKREG,2          SAVE REGISTER 2                 @D1A 11033301
.KREG10  ANOP                                                      @D1A 11066601
         IPK   0(0)                SAVE CURRENT PSW KEY            @D1A 11100000
         AIF   ('&SAVEKEY' EQ '(2)').KREG15                    @D61BDVB 11125001
         STC   2,&SAVEKEY                                          @D1A 11150000
         LR    2,&WORKREG          RESTORE REGISTER 2              @D1A 11200000
.KREG15  ANOP                                                  @D61BDVB 11250001
         SPKA  0(&KEYREG)          SET PSW KEY                     @D1A 11450000
         MEXIT                                                     @D1A 11500000
.*------------------------------------------------------------*@D61BDVB 11550001
.* SAVEKEY PARAMETER PROCESSING                                @D61BDVB 11600001
.*------------------------------------------------------------*@D61BDVB 11650001
.NKEYAD  ANOP                                                           11700000
         AIF   (T'&SAVEKEY EQ 'O').ERROR13   WORKREG ONLY OPERAND       11750000
         AIF   ('&SAVEKEY' EQ '(2)').NKEYAD2                   @D61BDVB 11800001
         AIF   (T'&WORKREG EQ 'O').ERROR14   TEST FOR WORKREG OPERAND   11850000
         AIF   ((&WORKREG LT 0) OR (&WORKREG GT 15)).ERROR12 VALID CHK  11900000
         AIF   (&WORKREG EQ 2).NKEYAD2  TEST IF REG 2 TO BE SAVED       11950000
         LR    &WORKREG,2          SAVE REGISTER 2                      12000001
.NKEYAD2 ANOP                                                           12150000
         IPK   0(0)                SAVE CURRENT PSW KEY                 12200001
         AIF   ('&SAVEKEY' EQ '(2)').NKEYADX                   @D61BDVB 12250001
         STC   2,&SAVEKEY                                               12300000
         AIF   (&WORKREG EQ 2).NKEYADX                         @D61BDVB 12350001
         LR    2,&WORKREG          RESTORE REGISTER 2                   12400000
.NKEYADX ANOP                                                  @D61BDVB 12425001
         MEXIT                                                          12450000
.*------------------------------------------------------------*@D61BDVB 12500001
.*   ERROR EXITS                                              *@D61BDVB 12550001
.*------------------------------------------------------------*@D61BDVB 12600001
.ERROR1  ANOP                                                           12800000
         MNOTE 12,'REG FUNCTION NO LONGER SUPPORTED'             YM4244 12850000
         MEXIT                                                          12900000
.ERROR2  ANOP                                                           12950000
         MNOTE 12,'INVALID KEY OPERAND SPECIFIED'                       13000000
         MEXIT                                                          13050000
.ERROR3  ANOP                                                           13100000
         MNOTE 12,'INVALID MODE OPERAND SPECIFIED'                      13150000
         MEXIT                                                          13350000
.ERROR6  ANOP                                                           13400000
         MNOTE 12,'INVALID MF OPERAND'                                  13450000
         MEXIT                                                          13500000
.ERROR7  ANOP                                                           13550000
         MNOTE 12,'INVALID REGISTER SPECIFICATION'                      13600000
         MEXIT                                                          13650000
.ERROR8  ANOP                                                           13700000
         MNOTE 12,'MF=E SPECIFIED WITH OTHER OPERANDS'                  13750000
         AGO   .CK6                                                     13800000
.ERROR9  ANOP                                                           13850000
         MNOTE 12,'NO OPERANDS SPECIFIED'                               13900000
         MEXIT                                                          14100000
.ERROR11 ANOP                                                           14150000
         MNOTE 12,'PSW KEY OPERANDS SPECIFIED WITH OTHER OPERANDS'      14200000
         MEXIT                                                          14250000
.ERROR12 ANOP                                                           14300000
         MNOTE 12,'INVALID WORKREG PARAMETER'                           14350000
         MEXIT                                                          14400000
.ERROR13 ANOP                                                           14450000
         MNOTE 12,'WORKREG SPECIFIED ALONE'                             14500000
         MEXIT                                                          14550000
.ERROR14 ANOP                                                           14600000
         MNOTE 12,'WORKREG OPERAND MISSING'                             14650000
         MEXIT                                                          14700000
.ERROR15 ANOP                                                           14750000
         MNOTE 12,'EXTKEY, KEYADDR, AND KEYREG MUST BE MUTUALLY EXCLUSI*14800000
               VE'                                                      14850000
         MEXIT                                                          14900000
.ERROR16 ANOP                                                           14950000
         MNOTE 12,'INVALID EXTKEY OPERAND'                              15000000
         MEXIT                                                          15050000
.ERROR18 ANOP                                                           15100000
         MNOTE  12,'REGISTER 2 USAGE CONFLICT'                          15150000
         MEXIT                                                     @D1A 15200000
.ERROR19 ANOP                                                      @D1A 15250000
         MNOTE 12,'CONFLICT BETWEEN KEYREG AND WORKREG OR SAVEKEY' @D1A 15300000
         MEXIT                                                     @D1A 15300301
.ERROR20 ANOP                                                  @D61BDVB 15300601
         MNOTE 12,'EXTKEY ARGUMENT NOT SUPPORTED IN VSE/ESA'   @D61BDVB 15300901
         MEXIT                                                 @D61BDVB 15301001
.ERROR21 ANOP                                                  @D61BDVB 15301101
         MNOTE 12,'INLINE CODE GENERATION NOT SUPPORTED IN RELEASE'    *15301201
                                                               @D61BDVB 15301301
         MEXIT                                                 @D61BDVB 15301401
.*                                                             @D61BDVB 15301501
.*------------------------------------------------------------*@D61BDVB 15301801
.*                                                             @D61BDVB 15302101
.VSEOLD  ANOP                                                  @D61BDVB 15302401
.*------------------------------------------------------------*@D61BDVB 15302701
.*    MACRO EXPANSION OF PREVIOUS VSE RELEASES                *@D61BDVB 15303001
.* A000000-999999                                              @D14BDOW 15303301
         AIF ((T'&MODE NE 'O') OR (T'&REG NE 'O') OR (T'&KEYREG NE 'O')*15303601
               OR (T'&KEYADDR NE 'O') OR (T'&MF NE 'O') OR             *15303901
               (T'&RELATED NE 'O')).XERR010 UNSUPPORTED IN VSE @D61BDVB 15304201
*   MODESET VSE/AF SP 4.1                                               15304501
.*                                                             @D61BDVB 15304801
         AIF (T'&NAME EQ 'O').NOLAB                                     15305101
&NAME    DS 0H                                                          15305401
.NOLAB   ANOP                                                           15305701
.*                                                                      15306001
.*  CHECK WHETHER KEY PARAMETER EXISTS                                  15306301
.*                                                                      15306601
         AIF (T'&KEY NE 'O').KEY                                        15306901
.*                                                                      15307201
.*  CHECK WORKREG PARAMETER                                             15307501
.*                                                                      15307801
         AIF (T'&WORKREG EQ 'O').MISWREG                                15308101
         AIF ('&WORKREG'(1,1) NE '(').IMPWREG                           15308401
.REG     ANOP                                                           15308701
&NUMBER  SETA K'&WORKREG                                                15309001
&UREG    SETC '&WORKREG'(2,&NUMBER-2)                                   15309301
         AIF ('&UREG' EQ '2').WRWREG                                    15309601
.*                                                                      15309901
.*  CHECK EXTKEY - PARAMETER                                            15310201
.*                                                                      15310501
         AIF (T'&EXTKEY EQ 'O').MISEKEY                                 15310801
         AIF ('&EXTKEY'(1,1) EQ '(').CHKSKEY                            15311101
         AIF (&EXTKEY GT 15 ).ERRKEY                                    15311401
.*                                                                      15311701
.*  CHECK SAVEKEY - PARAMETER                                           15312001
.*                                                                      15312301
.CHKSKEY AIF (T'&SAVEKEY EQ 'O').MISSKEY                                15312601
&EKEY    SETC '&SAVEKEY'(1,1)                                           15312901
         AIF ('&EKEY' EQ '1' OR '&EKEY' EQ '2' OR '&EKEY' EQ '3' OR    *15313201
               '&EKEY' EQ '4' OR '&EKEY' EQ '5' OR '&EKEY' EQ '6' OR   *15313501
               '&EKEY' EQ '7' OR '&EKEY' EQ '8' OR '&EKEY' EQ '9').WRSK 15313801
.*                                                                      15314101
.*  CHECK PART TERMINATED, START ACTIONS                                15314401
.*  SAVE CONTENT OF REG2 TO WORKREG AND CLEAR REG2                      15314701
.*  REG2 WILL BE CHANGED BY THE IPK INSTRUCTION                         15315001
.*                                                                      15315301
.STARTEX LR &UREG,2                                                     15315601
         SR 2,2                                                         15315901
.*                                                                      15316201
.*  SET CURRENT PSW TO BITS 24-27 OF REG2                               15316501
.*                                                                      15316801
         IPK                                                            15317101
         SRL 2,4(0)                                                     15317401
.*                                                                      15317701
.*  STORE THE CURRENT PSW TO SAVEKEY                                    15318001
.*                                                                      15318301
         AIF ('&SAVEKEY'(1,1) NE '(').SKEYADR                           15318601
&NUMBER  SETA K'&SAVEKEY                                                15318901
&SKEYREG SETC '&SAVEKEY'(2,&NUMBER-2)                                   15319201
         LR &SKEYREG,2                                                  15319501
         AGO .CONT                                                      15319801
.SKEYADR STC 2,&SAVEKEY                                                 15320101
.*                                                                      15320401
.*  SET NEW PSW                                                         15320701
.*                                                                      15321001
.CONT    SR 2,2                                                         15321301
         AIF ('&EXTKEY'(1,1) EQ '(').SKREG                              15321601
&NUMBER  SETA K'&EXTKEY                                                 15321901
&EKEY    SETC '&EXTKEY'(1,&NUMBER)                                      15322201
         LA 2,&EKEY                                                     15322501
         AGO .SHIFT                                                     15322801
.SKREG   ANOP                                                           15323101
&NUMBER  SETA K'&EXTKEY                                                 15323401
&EKEY    SETC '&EXTKEY'(2,&NUMBER-2)                                    15323701
         LR 2,&EKEY                                                     15324001
.SHIFT   SLA 2,4(0)                                                     15324301
         SPKA 0(2)                                                      15324601
.*                                                                      15324901
.*  RESET REG2                                                          15325201
.*                                                                      15325501
         LR 2,&UREG                                                     15325801
         MEXIT                                                          15326101
.*                                                                      15326401
.*  KEY PARAMETER IS GIVEN; CHECK, WETHER ALL OTHER PARAMETERS ARE      15326701
.*  OMITTED                                                             15327001
.*                                                                      15327301
.KEY     AIF (T'&EXTKEY NE 'O').NEXTKEY                                 15327601
.XCK1    AIF (T'&WORKREG NE 'O').NWREG                                  15327901
.XCK2    AIF (T'&SAVEKEY NE 'O').NSKEY                                  15328201
.START   AIF ('&KEY' EQ 'ZERO').ZERO                                    15328501
         AIF ('&KEY' EQ 'USER').USER                                    15328801
         AGO .ERRKEY                                                    15329101
.ZERO    CNOP 0,4                          MAKES ALIGNMENT TO FULLWORD  15329401
         L 1,*+8                                                        15329701
         B *+8                                                          15330001
         DC X'FF000000'                                                 15330301
         SVC 13                                                         15330601
         MEXIT                                                          15330901
.USER    CNOP 0,4                                                       15331201
         L 1,*+8                                                        15331501
         B *+8                                                          15331801
         DC X'FF0000FF'                                                 15332101
         SVC 12                                                         15332401
         MEXIT                                                          15332701
.*                                                                      15333001
.*  MNOTES                                                              15333301
.*                                                                      15333601
.MISWREG MNOTE 8,'WORKREG PARAMETER MISSING - MACRO IGNORED'            15333901
         MEXIT                                                          15334201
.IMPWREG MNOTE 8,'IMPROPER PARAMETER WORKREG - MACRO IGNORED'           15334501
         MEXIT                                                          15334801
.WRWREG  MNOTE 8,'REG2 NOT ALLOWED AS WORKREG - MACRO IGNORED'          15335101
         MEXIT                                                          15335401
.MISEKEY MNOTE 8,'EXTKEY PARAMETER MISSING - MACRO IGNORED'             15335701
         MEXIT                                                          15336001
.MISSKEY MNOTE 8,'SAVEKEY PARAMETER MISSING - MACRO IGNORED'            15336301
         MEXIT                                                          15336601
.WRSK    MNOTE 8,'NO ABSOLUTE ADDR. ALLOWED - MACRO IGNORED'            15336901
         MEXIT                                                          15337201
.NEXTKEY MNOTE 6,'EXTKEY PARAMETER MUST BE OMITTED'                     15337501
         AGO .XCK1                                                      15337801
.NWREG   MNOTE 6,'WORKREG PARAMETER MUST BE OMITTED'                    15338101
         AGO .XCK2                                                      15338401
.NSKEY   MNOTE 6,'SAVEKEY PARAMETER MUST BE OMITTED'                    15338701
         MEXIT                                                          15339001
.ERRKEY  MNOTE 8,'IMPROPER EXTKEY PARAMETER - MACRO IGNORED'            15339301
         MEXIT                                                          15339601
.XERR010 MNOTE 8,'MVS PARAMETER(S) NOT SUPPORTED IN VSE/SP VERSION'    *15339901
                                                               @D61BDVB 15343201
.*------------------------------------------------------------*@D61BDVB 15346501
         MEND                                                           15350000
* */                                                                    15400000
* MODESET:                                                              15450000
*/********************************************************************/ 15500000
*/* PL/S VERSION OF MODESET MACRO. WHEN ISSUED CAUSES A SUPERVISOR   */ 15550000
*/* ROUTINE TO ALTER THE SVC OLD PSW SO THAT THE DESIRED PSW WILL BE */ 15600000
*/* LOADED WHEN MODESET RETURNS TO THE USER. SOME FORMS, INSTEAD,    */ 15650000
*/* GENERATE INLINE CODE.                                            */ 15700000
*/********************************************************************/ 15750000
*  MACRO                                                                15800000
*    KEYS(KEY,                     /* KEY(NZERO OR ZERO)             */ 15850000
*         MODE,                    /* MODE(PROB OR SUP)              */ 15900000
*         SYSMASK,                 /* SYSMASK(RELOC,YES OR NO)       */ 15950000
*                                  /*  SYSMASK(IO,YES OR NO)         */ 16000000
*                                  /* SYSMASK(EXT,YES OR NO)         */ 16050000
*         MF,                      /* MF(L OR E,LIST NAME)           */ 16100000
*         REG,                     /* REG(VBL NAME)                  */ 16150000
*         RELATED,                 /* INFORMATIONAL PARAMETER    @D1A*/ 16200000
*         RTCD,                    /* RTCD(VBL NAME)-SVC RETURN CODE */ 16250000
*         EXTKEY,                  /* EXTKEY(SCHED OR RSM OR VSM OR  */ 16300000
*                                  /*        SRM OR SUPR OR          */ 16350001
*                                  /*        DATAMGT OR TCAM OR ATCAM*/ 16400000
*                                  /*     OR HASP OR TCB OR RBT1 OR     16450000
*                                            RBT234                  */ 16500000
*                                  /* OR KEY2,KEY3,KEY4,KEY7     @D1A*/ 16525001
*         KEYADDR,                 /* KEY CONTAINED IN A 1 BYTE LOC.    16550000
*                                     WITHIN ROUTINES WORK STORAGE   */ 16600000
*         KEYREG,                  /* KEY CONTAINED IN REGISTER.        16625001
*                                     INCLUDED FOR COMPATIBILITY. SAME  16650001
*                                     AS KEYADDR FOR PLS.        @D1A*/ 16675001
*         WORKREG,                 /* REGISTER INTO WHICH CONTENTS OF   16700000
*                                     REGISTER 2 ARE SAVED           */ 16750000
*         SAVEKEY);                /* SAVEKEY(VBL NAME)              */ 16800000
*/********************************************************************/ 16800101
*/*                                                                  */ 16800201
*/*                                                                  */ 16800301
*/* MACDATE = 94-12-08                                               */ 16800401
*/*                                                                  */ 16800501
*/* FUNCTION =                                                       */ 16800601
*/* PL/S VERSION OF MODESET MACRO. WHEN ISSUED CAUSES A SUPERVISOR   */ 16800701
*/* ROUTINE TO ALTER THE SVC OLD PSW SO THAT THE DESIRED PSW WILL BE */ 16800801
*/* LOADED WHEN MODESET RETURNS TO THE USER. SOME FORMS, INSTEAD,    */ 16800901
*/* GENERATE INLINE CODE.                                        @D1A*/ 16801001
*/* LOADED WHEN MODESET RETURNS TO THE USER.                         */ 16801101
*/*                                                                  */ 16801201
*/* CHANGE ACTIVITY -                                                */ 16801301
*/* $D1=0057      JBB1326   800923   PDXB: KEY 2,3,4,7 SUPPORT   @D1A*/ 16801401
*/*                                        KEYREG,RELATED PARMS  @D1A*/ 16801501
*/* $P1=0182      JBB1326   810129   PDXB: FIX KEYREG/WORKREG    @P1A*/ 16801601
*/*  @G860PXB -- USE 24-BIT RBLINKB FIELD                            */ 16801701
*/* VSE/ESA 2.1.0  MVS COMPATIBLES MODESET: SINGLE SUPERVISOR@D61BDVB*/ 16801801
*/*                                                                  */ 16801901
*/********************************************************************/ 16802001
*/*                                                                  */ 16802101
*/********************************************************************/ 16802201
*/*          DEFINE EXTERNAL VARIABLES                               */ 16802301
*/********************************************************************/ 16802401
*DECLARE                                                                16802501
*  EHALIST     CHARACTER EXTERNAL, /* STANDARD LIST NAME             */ 16802601
*  EHAREGS     CHARACTER EXTERNAL, /* NAMES OF REGISTER VARIABLES    */ 16802701
*  EHAMAXLEN   FIXED     EXTERNAL, /* HOLDS LEN OF STANDARD LIST     */ 16802801
*  EHARC       FIXED     EXTERNAL, /* HOLDS RETURN CODE              */ 16802901
*  SYSSPLV     CHARACTER EXTERNAL; /* LEVEL INDICATOR        @D61BDVB*/ 16803001
*  EHARC = 0;                      /* INITIALIZE RETURN CODE         */ 16803101
*/********************************************************************/ 16803201
*/*          DEFINE AND INITIALIZE LOCAL VARIABLES                   */ 16803301
*/********************************************************************/ 16803401
*DECLARE                                                                16803501
*  IVERR       FIXED,              /* HOLDS ERROR CODE               */ 16803601
*  IVCOUNT     FIXED,              /* LOOP COUNTER                   */ 16803701
*  IVMAXARG    FIXED,              /* ARGUMENT COUNTER               */ 16803801
*  IVMCOUNT    FIXED,                                                   16803901
*  ISAVEXTF    FIXED,              /* SAVEKEY/EXTKEY IND             */ 16804001
*  ICOL        FIXED,              /* STARTING COL -MACCOL+2         */ 16804101
*  IVCOMM      CHARACTER,          /* USED TO BUILD COMMENT STRING   */ 16804201
*  ISAVEXTC    CHARACTER,          /* USED TO BUILD COMMENT FOR EXTKEY  16804301
*                                     SAVEKEY, KEYADDR, WORKREG,        16804401
*                                     AND KEYREG                 @D1C*/ 16804501
*  IVLIST      CHARACTER,                                               16804601
*  IREGS       CHARACTER,          /* HOLDS REGISTER NAMES           */ 16804701
*  IVMASK      CHARACTER,          /* USED TO BUILD 32 BIT PATTERN   */ 16804801
*  IVBONE      CHARACTER,          /* ON FLAG                        */ 16804901
*  IZERO       CHARACTER,          /* CHARACTER ZERO                 */ 16805001
*  ISPKA       CHARACTER,          /* HOLDS OFFSET FOR SPKA INSTR.   */ 16805101
*  ITCBRB      CHARACTER,          /* GET RB PTR FROM TCB INSTR.     */ 16805201
*  IVSTPK      CHARACTER,          /* SAVE PROTECTION KEY INSTR.     */ 16805301
*  IVIPK       CHARACTER,          /* IPK INSTR. FORM                */ 16805401
*  ITCBPK      CHARACTER,          /* EXTKEY(TCB) INSTR. COMMENT     */ 16805501
*  IRBPTRC     CHARACTER,          /* EXTKEY(RBT1/RBT234)            */ 16805601
*  IVPK(8)     CHARACTER,          /* HOLDS TEXT TO BE GENERATED BY     16805701
*                                     SAVEKEY/EXTKEY/KEYADDR/KEYREG     16805801
*                                     KEYS                       @D1C*/ 16805901
*  IMSG31      CHARACTER,          /* TOO MANY ARGUMENTS MESSAGE     */ 16806001
*  INOTEXT     CHARACTER,          /* NO TEXT GENERATED MSG          */ 16806101
*  IVMSG13(10) CHARACTER,          /* ARRAY OF AHA0013 MSGS          */ 16806201
*  IVBITS(32)  CHARACTER;          /* SIMULATE BIT ARRAY FOR PARMLIST*/ 16806301
*  IVBONE = '1';                   /* INITIALIZE ON FLAG             */ 16806401
*  IVLIST = '';                    /* NULL LIST ANME                 */ 16806501
*  IZERO = '0';                    /* INITIALIZE TO ZERO             */ 16806601
*  IREGS = '';                     /* NULL REGISTER NAMES            */ 16806701
*  IVMASK = '';                    /* NULL SYSMASK STRING            */ 16806801
*  IVCOUNT = 1;                    /* INITIALIZE LOOP COUNTER        */ 16806901
*  IVMCOUNT = 1;                   /* INITIALIZE COUNT               */ 16807001
*  ISPKA = IZERO;                  /* DEFAULT OFFSET FOR SPKA INSTR. */ 16807101
*  ISAVEXTF = 0;                   /* INITIALIZE SAVEKEY/EXTKEY IND  */ 16807201
*  IVERR = 0;                      /* INITIALIZE ERROR CODE          */ 16807301
*  INOTEXT = '. NO TEXT IS GENERATED.';                                 16807401
*  IMSG31 = ' IS TOO LONG. ARGUMENTS ARE IGNORED AFTER ';               16807501
*  IVCOMM = '';                    /* NULL COMMENT STRING            */ 16807601
*                                                                       16807701
*  /* SPLEVEL (TEST) DONE VIA MACPARM                        @D61BDVB*/ 16807801
*  SYSSPLV = MACPARM;                                      /*@D61BDVB*/ 16807901
*  IF SYSSPLV = '' THEN SYSPLV = '4';                      /*@D61BDVB*/ 16808001
*  IF (SYSSPLV = '1' | SYSSPLV = '2' | SYSPLV = '3') THEN  /*@D61BDVB*/ 16808101
*    DO;                                                   /*@D61BDVB*/ 16808201
*     IVERR = 12;                  /*        SET ERROR CODE  @D61BDVB*/ 16808301
*     ANS MSG('AHA0013 - NO PL/AS SUPPORTED IN RELEASE'|| INOTEXT)      16808401
*                    NORESCAN;                             /*@D61BDVB*/ 16808501
*    END;                                                               16808601
*  IF ((EXTKEY = '' | KEYADDR = '' | KEYREG = '' )                   16808701
*       & (SYSSPLV = '4')) THEN                                         16808801
*    DO;                                                   /*@D61BDVB*/ 16808901
*     IVERR = 12;                  /*        SET ERROR CODE  @D61BDVB*/ 16809001
*     ANS MSG('AHA0013 INLINE CODE GENERATION NOT SUPPORTED IN RELEASE' 16809101
*         || INOTEXT) NORESCAN;                            /*@D61BDVB*/ 16809201
*    END;                                                               16809301
*LHA00100:                                                              16809401
*  IF IVCOUNT <= 32 THEN           /* LOOP TO INITIALIZE LOCAL ARRAY */ 16809501
*    DO;                                                                16809601
*     IVBITS(IVCOUNT) = IZERO;     /* FOR THE 4 BYTE PARMLIST        */ 16809701
*     IVCOUNT = IVCOUNT +1;        /* INCR INDEX                     */ 16809801
*     GOTO LHA00100;                                                    16809901
*    END;                                                               16810001
*  IVCOUNT = 1;                    /* RESET LOOP COUNTER             */ 16810101
*/********************************************************************/ 16810201
*/*          PROCESS MF KEY                                          */ 16810301
*/********************************************************************/ 16810401
*  IF MF = '' THEN                 /* STANDARD FORM?                 */ 16810501
*    GOTO LHA00300;                /* YES-SKIP AHEAD & BYPASS MF PROC*/ 16810601
*  IF MF(1) = '' THEN                                                  16810701
*    IVCOMM = 'MF'||MF;            /*     BUILD COMMENT              */ 16810801
*  ELSE IVCOMM = MF;                                                    16810901
*  IF MF(2) = '' THEN              /*     WAS LISTNAME SUPPLIED?     */ 16811001
*    DO;                           /*     NO-ERROR                   */ 16811101
*     IVERR = 12;                  /*        SET ERROR CODE          */ 16811201
*     ANS MSG('AHA0013 MF LIST NAME IS REQUIRED BUT IS NOT SUPPLIED'||  16811301
*        INOTEXT) NORESCAN;                                             16811401
*    END;                                                               16811501
*  IF MF(1) = 'L' THEN             /*     YES-LIST FORM?             */ 16811601
*    DO;                           /*        YES-                    */ 16811701
*     IVMAXARG = 3;                /*        SET MAX NO OF ARGS = 3  */ 16811801
*     GOTO LHA00200;               /*        SCAN FOR NEXT KEY       */ 16811901
*    END;                                                               16812001
*  IF MF(1) = 'E' THEN            /*        NO-IS THIS EXECUTE FORM?*/ 16812101
*    DO;                           /*           NO-ERROR             */ 16812201
*     IVERR = 12;                  /*           SET ERROR CODE       */ 16812301
*     ANS MSG('AHA0043 MF TYPE MUST BE L OR E'||INOTEXT) NORESCAN;      16812401
*     GOTO LHA00300;               /*           SCAN FOR NEXT KEY    */ 16812501
*    END;                                                               16812601
*  ELSE IVMAXARG = 2;              /*           YES-SET MAX ARGS =2  */ 16812701
*LHA00200:                                                              16812801
*  IF NUMBER(MF) > IVMAXARG THEN   /*     TOO MANY ARGUMENTS?        */ 16812901
*    DO;                           /*     YES-ERROR                  */ 16813001
*     EHARC = 4;                   /*        SET RETURN CODE         */ 16813101
*     ANS MSG('AHA0031 MF'||MF||IMSG31||QUOTE(MF(IVMAXARG))) NORESCAN;  16813201
*    END;                                                               16813301
*/********************************************************************/ 16813401
*/*LHA00300: PROCESS 'KEY' KEY.                                      */ 16813501
*/********************************************************************/ 16813601
*LHA00300:                                                              16813701
*  IF KEY = '' THEN                /* 'KEY' KEY SPECIFIED?           */ 16813801
*    GOTO LHA00400;                /* NO- SCAN FOR NEXT KEY          */ 16813901
*  IVCOMM = IVCOMM || ' KEY';      /*     YES-BUILD COMMENT STRING   */ 16814001
*  IF KEY(1) = '' THEN             /* YES-WAS SUBLIST SPECIFIED?     */ 16814101
*    DO;                           /*     NO-ERROR                   */ 16814201
*     IVERR = 12;                  /*        SET ERROR CODE          */ 16814301
*     IVMSG13(IVCOUNT)='KEY';      /*        BUILD MSG TEXT          */ 16814401
*     IVCOUNT = IVCOUNT +1;        /*        INCR MSG COUNT          */ 16814501
*     GOTO LHA00400;               /*        SCAN FOR NEXT KEY       */ 16814601
*    END;                                                               16814701
*  ELSE IVCOMM=IVCOMM||KEY;                                             16814801
*  IF KEY(1) = 'ZERO' THEN         /*        KEY(ZERO) SPECIFIED?    */ 16814901
*    DO;                           /*        YES-                    */ 16815001
*     IVBITS(28) = IVBONE;         /*        SET ZERO KEY IN SVCOPSW */ 16815101
*     IVBITS(27) = IVBONE;         /*        SHOW THAT KEY SUPPLIED  */ 16815201
*     GOTO LHA00400;               /*        SCAN FOR NEXT KEY       */ 16815301
*    END;                                                               16815401
*  IF (KEY(1) = 'NZERO') &        /*        WAS KEY(NZERO)  @D61BDVB*/ 16815501
*    (KEY(1) = 'USER') THEN       /*        OR (USER) SPEC. @D61BDVB*/ 16815601
*    DO;                           /*        NO-ERROR                */ 16815701
*     IVERR = 12;                  /*        SET ERROR CODE          */ 16815801
*     ANS MSG('AHA0043 KEY ARGUMENT MUST BE ZERO OR NZERO'||INOTEXT)    16815901
*         NORESCAN;                                                     16816001
*    END;                                                               16816101
*  ELSE IVBITS(27) = IVBONE;       /*                                */ 16816201
*/********************************************************************/ 16816301
*/*LHA00400: PROCESS 'MODE' KEY                                      */ 16816401
*/********************************************************************/ 16816501
*LHA00400:                                                              16816601
*  IF MODE = '' THEN               /* WAS 'MODE' KEY SPECIFIED?      */ 16816701
*    GOTO LHA00500;                /* NO-SCAN FOR NEXT KEY           */ 16816801
*  IVCOMM = IVCOMM ||' MODE';      /*     YES-BUILD COMMENT STRING   */ 16816901
*  IF MODE(1) = '' THEN            /* YES-WAS SUBLIST SUPPLIED?      */ 16817001
*    DO;                           /*     NO-ERROR                   */ 16817101
*     IVERR = 12;                  /*        SET ERROR CODE          */ 16817201
*     IVMSG13(IVCOUNT)='MODE';     /*        BUILD MSG TEXT          */ 16817301
*     IVCOUNT = IVCOUNT +1;        /*        INCR MSG COUNT          */ 16817401
*     GOTO LHA00500;               /*        SCAN FOR NEXT KEY       */ 16817501
*    END;                                                               16817601
*  ELSE IVCOMM = IVCOMM||MODE;                                          16817701
*  IF MODE(1) = 'SUP' THEN         /*        IS THIS MODE(SUP)?      */ 16817801
*    DO;                           /*        YES-                    */ 16817901
*     IVBITS(29) = IVBONE;         /*           SET MODE IND ON      */ 16818001
*     IVBITS(30) = IVBONE;         /*           SHOW THAT MODEKEY SUP*/ 16818101
*     GOTO LHA00500;               /*           SCAN FOR NEXT KEY    */ 16818201
*    END;                                                               16818301
*  IF MODE(1) = 'PROB' THEN       /*        WAS MODE(PROB) SPECFD?  */ 16818401
*    DO;                           /*        NO-ERROR                */ 16818501
*     IVERR = 12;                  /*           SET ERROR CODE       */ 16818601
*     ANS MSG('AHA0043 MODE ARGUMENT MUST BE SUP/PROB'||INOTEXT);       16818701
*    END;                                                               16818801
*  ELSE IVBITS(30) = IVBONE;       /*        YES-PROB PROG MODE      */ 16818901
*/********************************************************************/ 16819001
*/*LHA00500: PROCESS 'REG' KEY.                                      */ 16819101
*/********************************************************************/ 16819201
*LHA00500:                                                              16819301
*  IF REG = '' THEN                /* WAS REG KEY SPECIFIED?         */ 16819401
*    GOTO LHA00600;                /* NO-SCAN FOR NEXT KEY           */ 16819501
*   IVERR = 12;                    /* REG IS NO LONGER         YM4244*/ 16819601
*   ANS MSG('AHA0023 REG IS INVALID.') NORESCAN; /* SUPPORTED  YM4244*/ 16819701
*/********************************************************************/ 16819801
*/*LHA00600: PROCESS 'SYSMASK' KEY.                                  */ 16819901
*/********************************************************************/ 16820001
*LHA00600:                                                              16820101
*  IF SYSMASK = '' THEN            /* WAS SYSMASK KEY SPECIFIED?     */ 16820201
*    GOTO LHA00900;                                                     16820301
*  IVERR = 12;                     /* SYSMASK IS NO LONGER     YM4244*/ 16820401
*  ANS MSG('AHA0023 SYSMASK IS INVALID.')NORESCAN;/* SUPPORTED YM4244*/ 16820501
*/********************************************************************/ 16820601
*/*          PROCESS 'RTCD' KEY.                                     */ 16820701
*/********************************************************************/ 16820801
*LHA00900:                                                              16820901
*  IF RTCD = '' THEN               /* RTCD KEY SPECIFIED?            */ 16821001
*    GOTO LHA00950;                /* NO-SCAN FOR NEXT KEY           */ 16821101
*  IF RTCD(1) = '' THEN            /* YES-KEYLIST SUPPLIED?          */ 16821201
*    DO;                           /*     NO-ERROR                   */ 16821301
*     IVERR = 12;                  /*        SET ERROR CODE          */ 16821401
*     IVMSG13(IVCOUNT) = 'RTCD';   /*        BUILD MSG TEXT          */ 16821501
*     IVCOUNT = IVCOUNT + 1;       /*        INCR MSG COUNT          */ 16821601
*    END;                                                               16821701
*  IF NUMBER(RTCD) > 1 THEN        /* TOO MANY ARGUMENTS?            */ 16821801
*    DO;                           /* YES                            */ 16821901
*     EHARC = 4;                   /*     SET RETURN CODE OF 4       */ 16822001
*     ANS MSG('AHA0031 RTCD'||RTCD||IMSG31||QUOTE(RTCD(1))) NORESCAN;   16822101
*    END;                                                               16822201
*/********************************************************************/ 16822301
*/*          PROCESS 'SAVEKEY' KEY.                                  */ 16822401
*/********************************************************************/ 16822501
*LHA00950:                                                              16822601
*  IF SAVEKEY = '' THEN            /* YES-WAS 'SAVEKEY' SPECIFIED?   */ 16822701
*    GOTO LHA01000;                /* NO-SCAN FOR NEXT KEY           */ 16822801
*  ISAVEXTF = 1;                   /* YES-SHOW THAT SAVEKEY SUPPLIED */ 16822901
*  IF SAVEKEY(1) = '' THEN         /*     WAS KEYLIST SUPPLIED?      */ 16823001
*    DO;                           /*     NO-ERROR                   */ 16823101
*     IVERR = 12;                  /*        SET ERROR CODE          */ 16823201
*     IVMSG13(IVCOUNT) ='SAVEKEY'; /*        BUILD MSG TEXT          */ 16823301
*     IVCOUNT = IVCOUNT +1;        /*        INCR MSG COUNT          */ 16823401
*     GOTO LHA01000;               /*        SCAN FOR NEXT KEY       */ 16823501
*    END;                                                               16823601
*  IF NUMBER(SAVEKEY) > 1 THEN     /* TOO MANY ARGUMENTS SUPPLIED?   */ 16823701
*    DO;                           /* YES-                           */ 16823801
*     EHARC = 4;                   /*     SET RETURN CODE OF 4       */ 16823901
*     ANS MSG('AHA0031 SAVEKEY'||SAVEKEY||IMSG31||QUOTE(SAVEKEY(1)))    16824001
*        NORESCAN;                                                      16824101
*    END;                                                               16824201
*  IF INDEX(EHAREGS,'02F') =0 THEN /*     REGISTER 2 DEFINED YES?    */ 16824301
*    EHAREGS= EHAREGS||'02F';      /*     NO-DEFINE REGISTER 2       */ 16824401
*  IREGS = 'GPR02F';               /*     DEFINE REGISTER 2          */ 16824501
*  ISAVEXTC = ' SAVEKEY'||SAVEKEY; /* SHOW THAT SAVEKEY WAS SUPPLIED */ 16824601
*/********************************************************************/ 16824701
*/*LHA01000: PROCESS 'EXTKEY' KEY.                                   */ 16824801
*/********************************************************************/ 16824901
*LHA01000:                                                              16825001
*  IF EXTKEY = '' THEN             /* WAS 'EXTKEY' SPECIFIED?        */ 16825101
*    GOTO LHA01200;                /* NO-                            */ 16825201
*  IF NUMBER(EXTKEY) > 1 THEN       /*    YES-TOO MANY ARGUMENTS?    */ 16825301
*    DO;                           /*        YES-ERROR               */ 16825401
*     EHARC = 4;                   /*        SET RETURN CODE         */ 16825501
*     ANS MSG('AHA0031 EXTKEY'||EXTKEY||IMSG31||QUOTE(EXTKEY(1)))       16825601
*        NORESCAN;                                                      16825701
*    END;                                                               16825801
*  ISAVEXTC = ISAVEXTC ||' EXTKEY'||EXTKEY;/* SHOW THAT EXTKEY SUPPLD*/ 16825901
*  IF EXTKEY(1) = 'TCB' THEN       /* KEY TO BE OBTAINED FROM TCB?   */ 16826001
*    GOTO LHA01050;                /* YES-SKIP AHEAD                 */ 16826101
*  IF EXTKEY(1) = 'RBT1' THEN      /* RTN ISSUING MODESET TYPE 1 SVC?*/ 16826201
*    GOTO LHA01030;                /* YES-SKIP AHEAD         @D61BDVB*/ 16826301
*  IF EXTKEY(1)  = 'RBT234' THEN   /* IS IT TYPE 2,3 OR 4 SVC?       */ 16826401
*    GOTO LHA01030;                /* YES-SKIP AHEAD         @D61BDVB*/ 16826501
*  ISAVEXTF = ISAVEXTF + 2;        /*     SHOW THAT EXTKEY(RSM/VSM ETC) 16826601
*                                         WAS SUPPLIED               */ 16826701
*  IF EXTKEY(1) ='SCHED' THEN      /*        EXTKEY(SCHED)?          */ 16826801
*    GOTO LHA01020;                /* YES-SKIP AHEAD         @D61BDVB*/ 16826901
* /* DO;                                                                16827001
*     ISPKA = '16';                          SET SPKA INST OFFSET       16827101
*     GOTO LHA01100;                         SKIP AHEAD                 16827201
*    END;                                                    @D61BDVB*/ 16827301
*  IF EXTKEY(1)= 'HASP' THEN       /*     EXTKEY(HASP)?              */ 16827401
*    GOTO LHA01020;                /* YES-SKIP AHEAD         @D61BDVB*/ 16827501
* /* DO;                                  YES-                          16827601
*     ISPKA = '16';                                                     16827701
*     GOTO LHA01100;                      SKIP AHEAD                    16827801
*    END;                                                    @D61BDVB*/ 16827901
*  IF EXTKEY(1)= 'JES' THEN        /*     EXTKEY(JES)?               */ 16828001
*    GOTO LHA01020;                /* YES-SKIP AHEAD         @D61BDVB*/ 16828101
* /* DO;                                  YES-                          16828201
*     ISPKA = '16';                                                     16828301
*     GOTO LHA01100;                      SKIP AHEAD                    16828401
*    END;                                                    @D61BDVB*/ 16828501
*  IF EXTKEY(1) = 'RSM' THEN       /*        EXTKEY(RSM)?            */ 16828601
*    GOTO LHA01020;                /* YES-SKIP AHEAD         @D61BDVB*/ 16828701
*  /*GOTO LHA01100;                          SKIP AHEAD              */ 16828801
*  IF EXTKEY(1) = 'VSM' THEN       /*        EXTKEY(VSM)?            */ 16828901
*    GOTO LHA01020;                /* YES-SKIP AHEAD         @D61BDVB*/ 16829001
*  /*GOTO LHA01100;                          SKIP AHEAD              */ 16829101
*  IF EXTKEY(1) = 'SRM' THEN       /*        EXTKEY(SRM)?            */ 16829201
*    GOTO LHA01020;                /* YES-SKIP AHEAD         @D61BDVB*/ 16829301
*  /* GOTO LHA01100;                         SKIP AHEAD              */ 16829401
*  IF EXTKEY(1) = 'SUPR' THEN      /*        EXTKEY(SUPR)?           */ 16829501
*    GOTO LHA01020;                /* YES-SKIP AHEAD         @D61BDVB*/ 16829601
*  /*GOTO LHA01100;                          SKIP AHEAD              */ 16829701
*  IF EXTKEY(1) = 'DATAMGT' THEN   /*        EXTKEY(DATAMGT)?        */ 16829801
*    GOTO LHA01020;                /* YES-SKIP AHEAD         @D61BDVB*/ 16829901
*  /*DO;                                                                16830001
*     ISPKA = '80';                          SET SPKA INST OFFSET       16830101
*     GOTO LHA01100;                         SKIP AHEAD                 16830201
*    END;                                                    @D61BDVB*/ 16830301
*  IF EXTKEY(1) = 'TCAM' THEN      /*        EXTKEY(TCAM)?           */ 16830401
*    DO;                                                                16830500
*  /* ISPKA = '96';                          SET SPKA INST OFFSET    */ 16830600
*     GOTO LHA01100;                         SKIP AHEAD                 16830801
*    END;                                                               16830900
*  IF EXTKEY(1) = 'ZERO' THEN      /*        EXTKEY(ZERO)            */ 16831001
*    GOTO LHA01100;                /*        SKIP AHEAD              */ 16831101
*  IF EXTKEY(1)= 'KEY2' THEN       /*     EXTKEY(KEY2)?          @D1A*/ 16831201
*    GOTO LHA01040;                /* YES-SKIP AHEAD         @D61BDVB*/ 16831301
*  /*DO;                                  YES-                   @D1A   16831401
*     ISPKA = '32';                       GET KEY VALUE          @D1A   16831501
*     GOTO LHA01100;                      SKIP AHEAD             @D1A   16831601
*    END;                                                    @D61BDVB*/ 16831701
*  IF EXTKEY(1)= 'KEY3' THEN       /*     EXTKEY(KEY3)?          @D1A*/ 16831801
*    GOTO LHA01040;                /* YES-SKIP AHEAD         @D61BDVB*/ 16831901
*  /*DO;                                  YES-                   @D1A   16832001
*     ISPKA = '48';                       GET KEY VALUE          @D1A   16832101
*     GOTO LHA01100;                      SKIP AHEAD             @D1A   16832201
*    END;                                                    @D61BDVB*/ 16832301
*  IF EXTKEY(1)= 'KEY4' THEN       /*     EXTKEY(KEY4)?          @D1A*/ 16832401
*    GOTO LHA01040;                /* YES-SKIP AHEAD         @D61BDVB*/ 16832501
*  /*DO;                                  YES-                   @D1A   16832601
*     ISPKA = '64';                       GET KEY VALUE          @D1A   16832701
*     GOTO LHA01100;                      SKIP AHEAD             @D1A   16832801
*    END;                                                    @D61BDVB*/ 16832901
*  IF EXTKEY(1)= 'KEY7' THEN       /*     EXTKEY(KEY7)?          @D1A*/ 16833001
*    GOTO LHA01040;                /* YES-SKIP AHEAD         @D61BDVB*/ 16833101
*  /*DO;                                  YES-                   @D1A   16833201
*     ISPKA = '112';                      GET KEY VALUE          @D1A   16833301
*     GOTO LHA01100;                      SKIP AHEAD             @D1A   16833401
*    END;                                                    @D61BDVB*/ 16833501
*  IF EXTKEY(1) = 'VTAM' THEN     /*        EXTKEY(VTAM)?           */ 16833601
*    DO;                           /* NO-NONE OF THE ABOVE, ERROR    */ 16833701
*     IVERR = 12;                  /*    SET ERROR CODE              */ 16833801
*     ANS MSG('AHA0045 - EXTKEY ARGUMENT IS NULL/INVALID'||INOTEXT)     16833901
*        NORESCAN;                 /*     WRITE ERROR MESSAGE@D61BDVB*/ 16834001
*    END;                                                               16834101
*    ELSE;                                                              16834201
*/*ELSE ISPKA = '96';                                                */ 16834301
*  GOTO LHA01100;                     SKIP AHEAD                        16834400
*/***********************************************************@D61BDVB*/ 16834501
*LHA01020:/* GATHER MVS INTERNAL KEY SETTINGS                @D61BDVB*/ 16834601
*/***********************************************************@D61BDVB*/ 16834701
*LHA01030:/* UNSUPPORTED PARAMETERS IN VSE/ESA               @D61BDVB*/ 16834801
*/***********************************************************@D61BDVB*/ 16834901
*    DO;                           /*                        @D61BDVB*/ 16835001
*     IVERR = 12;                  /*    SET ERROR CODE      @D61BDVB*/ 16835101
*     ANS MSG('AHA0045 - EXTKEY ARGUMENT NOT SUPPORTED IN VSE/ESA'      16835201
*        || INOTEXT) NORESCAN;     /*     WRITE ERROR MESSAGE@D61BDVB*/ 16835301
*    END;                          /*                        @D61BDVB*/ 16835401
*  GOTO LHA01100;                  /* SKIP AHEAD             @D61BDVB*/ 16835501
*/***********************************************************@D61BDVB*/ 16835601
*LHA01040:/* IGNORED PARAMETERS IN VSE/ESA                   @D61BDVB*/ 16835701
*/***********************************************************@D61BDVB*/ 16835801
*    DO;                           /*                        @D61BDVB*/ 16835901
*     IVERR = 4;                   /*    SET ERROR CODE      @D61BDVB*/ 16836001
*     ANS MSG('EXTKEY SET TO KEY0 BY VSE/ESA');   /*         @D61BDVB*/ 16836101
*    END;                          /*                        @D61BDVB*/ 16836201
*  GOTO LHA01100;                  /* SKIP AHEAD             @D61BDVB*/ 16836301
*/********************************************************************/ 16836401
*LHA01050:/* WORKREG REQUIRED WITH EXTKEY(TCB/RBT1/RBT234)           */ 16836501
*/********************************************************************/ 16836601
*  ISAVEXTF = ISAVEXTF +8;         /*EXTKEY(TCB/RBT1/RBT234) IND @D1C*/ 16836701
*  IF WORKREG = '' THEN            /* WAS WORKREG SUPPLIED?          */ 16836801
*    DO;                           /* NO- ERROR                      */ 16836901
*     IVERR = 12;                  /*     ERROR CODE                 */ 16837001
*     ANS MSG('AHA0013 - WORKREG IS REQUIRED WITH EXTKEY(TCB)'          16837101
*        ||INOTEXT) NORESCAN;                      /*        @D61BDVB*/ 16837201
*    END;                                                               16837301
*/********************************************************************/ 16837401
*LHA01100:/* EXTKEY, KEYADDR, AND KEYREG ARE MUTUALLY EXCLUSIVE      */ 16837501
*/********************************************************************/ 16837601
*  IF KEYADDR = ''                /* WAS KEYADDR SUPPLIED?          */ 16837701
*   | KEYREG = '' THEN            /* OR KEYREG                  @D1C*/ 16837801
*    DO;                                                                16837901
*     IVERR = 12;                  /*     SET ERROR CODE OF 12       */ 16838001
*     ANS MSG('AHA0023 '||QUOTE('KEYADDR')||' OR '||QUOTE('KEYREG')||   16838101
*              ' IS INVALID WITH '||                                    16838201
*        QUOTE('EXTKEY')||INOTEXT) NORESCAN;/* WRITE S TYPE MSG  @D1A*/ 16838301
*    END;                                                               16838401
*  GOTO LHA01300;                  /*     SKIP AHEAD                 */ 16838501
*/********************************************************************/ 16838601
*LHA01200:/* PROCESS KEYADDR KEYWORD                                 */ 16838701
*/********************************************************************/ 16838801
*  IF KEYADDR = '' THEN            /* WAS PROTECTION KEY SUPPLIED?   */ 16838901
*    GOTO LHA01250;                /* NO, TRY KEYREG                 */ 16839001
*  IF KEYADDR(1) = '' THEN         /* WAS KEYADDR LIST SUPPLIED?     */ 16839101
*    DO;                                                                16839201
*     IVERR = 12;                  /*     SET ERROR CODE             */ 16839301
*     IVMSG13(IVCOUNT)= 'KEYADDR'; /*     BUILD MESSAGE TEXT         */ 16839401
*     IVCOUNT = IVCOUNT + 1;       /*     INCR MSG COUNT BY 1        */ 16839501
*    END;                                                               16839601
*  ISAVEXTF = ISAVEXTF +4;         /*     KEYADDR SUPPLIED IND       */ 16839701
*  ISAVEXTC = ISAVEXTC ||' KEYADDR'||KEYADDR;/* SHOW THAT KEYADDR WAS   16839801
*                                               SUPPLIED             */ 16839901
*  IF WORKREG(1) = '' THEN        /* WORK REGISTER SUPPLIED?        */ 16840001
*    ISPKA = WORKREG(1);           /* YES-                           */ 16840101
*  IF KEYREG = '' THEN            /* WAS KEYADDR SUPPLIED?      @D1A*/ 16840201
*    DO;                           /* KEYREG WITH KEYADDR        @D1A*/ 16840301
*     IVERR = 12;                  /*     SET ERROR CODE OF 12   @D1A*/ 16840401
*     ANS MSG('AHA0023 '||QUOTE('KEYREG')||                             16840501
*              ' IS INVALID WITH '||                                    16840601
*       QUOTE('KEYADDR')||INOTEXT) NORESCAN;/* WRITE S TYPE MSG  @D1A*/ 16840701
*    END;                          /*                            @D1A*/ 16840801
*  GOTO LHA01300;                  /* PROCESS WORKREG            @D1A*/ 16840901
*/********************************************************************/ 16841001
*LHA01250:/* PROCESS KEYREG KEYWORD                              @D1A*/ 16841101
*/********************************************************************/ 16841201
*  IF KEYREG = '' THEN             /* WAS KEY IN REG SUPPLIED?   @D1A*/ 16841301
*    GOTO LHA01300;                /* NO, PROCESS WORKREG        @D1A*/ 16841401
*  IF KEYREG(1) = '' THEN          /* WAS KEYREG LIST SUPPLIED?  @D1A*/ 16841501
*    DO;                           /* YES                        @D1A*/ 16841601
*     IVERR = 12;                  /*     SET ERROR CODE         @D1A*/ 16841701
*     IVMSG13(IVCOUNT)= 'KEYREG';  /*     BUILD MESSAGE TEXT     @D1A*/ 16841801
*     IVCOUNT = IVCOUNT + 1;       /*     INCR MSG COUNT BY 1    @D1A*/ 16841901
*    END;                                                               16842001
*  ISAVEXTF = ISAVEXTF +6;         /*     KEYREG SUPPLIED IND    @D1A*/ 16842101
*  ISAVEXTC = ISAVEXTC ||' KEYREG'||KEYREG;/* SHOW THAT KEYREG WAS      16842201
*                                               SUPPLIED         @D1A*/ 16842301
*  IF WORKREG(1) = '' THEN        /* WORK REGISTER SUPPLIED?        */ 16842401
*    ISPKA = WORKREG(1);           /* YES-                           */ 16842501
*/********************************************************************/ 16842601
*LHA01300:/* PROCESS WORKREG KEYWORD                                 */ 16842701
*/********************************************************************/ 16842801
*  IF ISAVEXTF = 0 THEN            /* EXTKEY/SAVEKEY/KEYADDR/KEYREG     16842901
*                                     SUPPLIED?                  @D1C*/ 16843001
*    GOTO LHA01500;                /* NO- SKIP AHEAD                 */ 16843101
*  IF WORKREG = '' THEN            /* WAS WORKREG KEY SPECIFIED?     */ 16843201
*    GOTO LHA01400;                /* NO-SKIP AHEAD                  */ 16843301
*  IF WORKREG = 'WORKREG' THEN     /* WAS WORKREG SUPPLIED?          */ 16843401
*    DO;                           /* NO- ERROR                      */ 16843501
*     IVERR = 12;                  /*     SET ERROR CODE             */ 16843601
*     IVMSG13(IVCOUNT)= 'WORKREG'; /*     BUILD MSG TEXT             */ 16843701
*     IVCOUNT = IVCOUNT + 1;       /*     INCR MSG COUNT BY 1        */ 16843801
*    END;                                                               16843901
*  IF EXTKEY = '' THEN             /*    IS EXTKEY SPECIFIED?        */ 16844001
*    GOTO LHA01400;                /*    NO-SKIP AHEAD               */ 16844101
*  IF EXTKEY(1) = 'TCB' THEN                                            16844201
*    ISPKA = WORKREG(1);           /*    WORKREG USED WITH SPKA      */ 16844301
*  IF EXTKEY(1) = 'RBT1' THEN                                           16844401
*    ISPKA = WORKREG(1);           /*    WORKREG USED WITH SPKA      */ 16844501
*  IF EXTKEY(1) = 'RBT234' THEN                                         16844601
*    ISPKA = WORKREG(1);           /*    WORKREG USED WITH SPKA      */ 16844701
*/********************************************************************/ 16844801
*/* SAVEKEY/KEYADDR/EXTKEY/WORKREG/KEYREG ARE MUTUALLY EXCLUSIVE     */ 16844901
*/* WITH OTHER MODESET PARAMETERS(KEYS).                         @D1C*/ 16845001
*/********************************************************************/ 16845101
*LHA01400:                                                              16845201
*  IF IVCOMM = '' THEN            /* WERE OTHER PARAMETERS SUPPLIED?*/ 16845301
*    DO;                           /* YES- ERROR                     */ 16845401
*     IVERR = 12;                  /*     SET ERROR CODE OF 12       */ 16845501
*    ANS MSG('AHA0023 '||QUOTE('EXTKEY/SAVEKEY/KEYADDR/WORKREG/KEYREG') 16845601
*||' IS INVALID WITH '||IVCOMM||INOTEXT) NORESCAN;                      16845701
*    END;                                                               16845801
*/********************************************************************/ 16845901
*LHA01500:/* WRITE 'S' TYPE MESSAGES IF ANY                          */ 16846001
*/********************************************************************/ 16846101
*  IVCOUNT = IVCOUNT -1;           /*     DECR MSG COUNT             */ 16846201
*  IF IVCOUNT > 0 THEN             /*     DONE?                      */ 16846301
*    DO;                           /* NO-                            */ 16846401
*  ANS MSG('AHA0013 '||IVMSG13(IVCOUNT)||' KEYLIST IS REQUIRED BUT IS   16846501
*NOT SUPPLIED'||INOTEXT) NORESCAN; /* WRITE SERIOUS ERROR MSG        */ 16846601
*  GOTO LHA01500;                                                       16846701
*    END;                                                               16846801
*  IF MF(1) = 'E' THEN            /* WAS MF(E,LISTNAME) SPECIFIED?  */ 16846901
*    GOTO LHA02200;                /* NO-SCAN FOR NEXT KEY           */ 16847001
*  IF IVCOMM =  'MF'||MF  THEN    /* YES-CHECK FOR OTHER KEYS       */ 16847101
*    DO;                           /* YES-ERROR                      */ 16847201
*     IVERR = 12;                  /*     SET ERROR CODE             */ 16847301
*     ANS MSG('AHA0023 MF'||MF||' IS INVALID WITH OTHER KEYS'||         16847401
*        INOTEXT) NORESCAN;        /* WRITE SERIOUS ERROR MSG        */ 16847501
*    END;                                                               16847601
*LHA02200:                                                              16847701
*  IF IVCOMM = '' THEN            /* ANY KEYS SUPPLIED WITH MODESET?*/ 16847801
*    GOTO LHA02270;                /* YES-SKIP AHEAD                 */ 16847901
*/********************************************************************/ 16848001
*LHA02240:/* CHECK IF ADDITIONAL PARAMETERS WERE SPECIFIED           */ 16848101
*/********************************************************************/ 16848201
*  IF ISAVEXTC = '' THEN           /* EXTKEY/SAVEKEY/KEYADDR/KEYREG     16848301
*                                     SUPPLIED                   @D1C*/ 16848401
*    DO;                                                                16848501
*     IVERR = 12;                  /* SET ERROR CODE OF 12           */ 16848601
*     ANS MSG('AHA0013 KEYS ARE REQUIRED BUT ARE NOT SUPPLIED'          16848701
*        ||INOTEXT) NORESCAN;      /* WRITE S TYPE MESSAGE           */ 16848801
*     GOTO LHA09000;               /* RETURN TO INVOKER              */ 16848901
*    END;                                                               16849001
*/********************************************************************/ 16849101
*LHA02270:/* CHECK ERROR CODE. DONOT GENERATE TEXT IF RETURN CODE>4  */ 16849201
*/********************************************************************/ 16849301
*  IF IVERR = 12 THEN              /* WERE THERE ANY S TYPE MSGS?    */ 16849401
*    GOTO LHA09000;                /* YES-RETURN TO INVOKER          */ 16849501
*/********************************************************************/ 16849601
*/*          WRITE LABEL(S) IF ANY                                   */ 16849701
*/********************************************************************/ 16849801
*  IF LENGTH(MACLABEL) = 0 THEN   /* ANY LABEL(S) SUPPLIED?         */ 16849901
*     ANS(MACLABEL) COL(MACLMAR);  /* WRITE LABEL(S)                 */ 16850001
*  ICOL = MACCOL + 2;              /* STARTING COL FOR TEXT          */ 16850101
*  IF ISAVEXTF = 0 THEN           /* WAS SAVEKEY/EXTKEY/KEYADDR/       16850201
*                                     KEYREG SPECIFIED?          @D1C*/ 16850301
*     GOTO LHA05000;               /* YES-SKIP AHEAD                 */ 16850401
*  IVMASK = '';                    /* NO- RESET MASK                 */ 16850501
*  IVCOUNT = 1;                    /*     RESET LOOP COUNTER         */ 16850601
*/********************************************************************/ 16850701
*LHA02300:/* UNLOAD 32 BIT PATTERN INTO IVMASK                       */ 16850801
*/********************************************************************/ 16850901
*  IF IVCOUNT > 32 THEN           /*     DONE?                      */ 16851001
*    DO;                           /*     NO-                        */ 16851101
*     IVMASK = IVMASK||IVBITS(IVCOUNT);                                 16851201
*     IVCOUNT = IVCOUNT + 1;       /*     INCR LOOP COUNT            */ 16851301
*     GOTO LHA02300;                                                    16851401
*    END;                                                               16851501
*/********************************************************************/ 16851601
*/*          GENERATE TEXT FOR LIST FORM                             */ 16851701
*/********************************************************************/ 16851801
*  IF RELATED = '' THEN           /* WAS RELATED SPECIFIED      @D1A*/ 16851901
*    IVCOMM = IVCOMM||' RELATED'||RELATED; /* ADD TO COMMENT     @D1A*/ 16852001
*  IF MF(1) = 'L' THEN            /* LIST FORM?                     */ 16852101
*    GOTO LHA02400;                /* NO-MUST BE STANDARD INVOCATION */ 16852201
*  ANS('/*MODESET '||IVCOMM||'*/') NORESCAN COL(MACCOL);                16852301
*  IVLIST='?AHAMDSET('||MF(2)||',';/*     BUILD ANS STRING           */ 16852401
*  IF INDEX(IVMASK,IVBONE)=0 THEN /*     ANY KEYS SPECIFIED?        */ 16852501
*    IVLIST= IVLIST || IVMASK;     /*     YES-LIST TO BE INITIALIZED */ 16852601
*  IF MF(3) = '' THEN                                                  16852701
*    IVLIST=IVLIST||','||MF(3);    /*     LIST ATTR TO BE APPLIED    */ 16852801
*  ANS(IVLIST || ');') COL(MACCOL);                                     16852901
*  GOTO LHA09000;                  /*     RETURN TO INVOKER          */ 16853001
*/********************************************************************/ 16853101
*LHA02400:/* COMMON TO EXECUTE AND STANDARD FORMS                    */ 16853201
*/********************************************************************/ 16853301
*  IVCOMM = 'MODESET '||IVCOMM;                                         16853401
*  IF RTCD = '' THEN              /* WAS RTCD KEY SUPPLIED?         */ 16853501
*    IVCOMM = IVCOMM||' RTCD'||RTCD;/* SHOW THAT RTCD KEY WAS SUPPLD */ 16853601
*  ANS('DO; '||COMMENT(IVCOMM)) NORESCAN COL(MACCOL);                   16853701
*  IF REG = '' THEN               /* IS THIS REGISTER FORM?         */ 16853801
*  GOTO LHA04000;                  /* GENERATE SVC INST. ONLY        */ 16853901
*  IF MF(1) = 'E' THEN             /* IS THIS EXECUTE FORM?          */ 16854001
*    DO;                           /* YES-GET LIST NAME              */ 16854101
*     IVLIST = MF(2);              /*    MAKE LOCAL COPY OF LIST NAME*/ 16854201
*     GOTO LHA02500;               /*     SKIP AHEAD                 */ 16854301
*    END;                                                               16854401
*/********************************************************************/ 16854501
*/*          GENERATE TEXT FOR STANDARD INVOCATION.                  */ 16854601
*/********************************************************************/ 16854701
*  IVLIST= 'I107';                 /* STANDARD LIST NAME             */ 16854801
*  IF INDEX(EHALIST,IVLIST)= 0 THEN /* STANDARD LIST DEFINED YET?    */ 16854901
*    EHALIST = EHALIST|| IVLIST;   /* NO-DEFINE IT                   */ 16855001
*  IF EHAMAXLEN < 4 THEN           /* STANDARD LIST OF < 4 BYTES?    */ 16855101
*    EHAMAXLEN = 4;                /* YES-SHOW THAT 4 BYTES LIST REQD*/ 16855201
*  IVLIST = IVLIST || IZERO;       /* BUILD LEVEL 2 NAME             */ 16855301
*  ANS(IVLIST||'1 = '||QUOTE(IVMASK(1:8))||'B;'||COMMENT('OR MASK'))    16855401
*        NORESCAN COL(ICOL);                                            16855501
*  ANS(IVLIST||'2 = '||QUOTE(IVMASK(9:16)) ||'B;'||COMMENT('AND MASK')) 16855601
*        NORESCAN COL(ICOL);                                            16855701
*  ANS(IVLIST||'3 = '||QUOTE(IVMASK(17:24))||'B;'||COMMENT('RESERVED')) 16855801
*        NORESCAN COL(ICOL);                                            16855901
*  ANS(IVLIST||'4 = '||QUOTE(IVMASK(25:32))||'B;') NORESCAN COL(ICOL);  16856001
*  IVLIST = 'I107';                /* STANDARD LIST NAME             */ 16856101
*/********************************************************************/ 16856201
*LHA02500:/* LOAD REGISTER 1 WITH PARAMETER LIST                     */ 16856301
*/********************************************************************/ 16856401
*  IF INDEX(EHAREGS,'01F') = 0 THEN /* REGISTER 1 DEFINED  YET?      */ 16856501
*    EHAREGS = EHAREGS||'01F';     /* NO-DEFINE IT                   */ 16856601
*  IREGS = 'GPR01F';               /* REGISTER 1 TO BE USED          */ 16856701
*  ANS('RESPECIFY GPR01F RESTRICTED;') NORESCAN COL(ICOL);              16856801
*  ANS('GPR01F = '||IVLIST||'; /*MODESET PARMLIST*/') NORESCAN          16856901
*        COL(ICOL);                                                     16857001
*/********************************************************************/ 16857101
*LHA04000:/* GENERATE SVC INSTRUCTION & SAVE RETRUN CODE IF ANY      */ 16857201
*/********************************************************************/ 16857301
*  IF INDEX(EHAREGS,'15F') = 0 THEN /* REGISTER 15 DEFINED YET?      */ 16857401
*    EHAREGS = EHAREGS||'15F';     /* NO-DEFINE IT                   */ 16857501
*  IF IREGS = '' THEN             /* ANY REGISTERS DEFINED YET?     */ 16857601
*    IREGS = IREGS||',';           /* YES-                           */ 16857701
*  IREGS = IREGS||'GPR15F';        /*     DEFINE REGISTER 15         */ 16857801
*  ANS('RESPECIFY GPR15F RESTRICTED;') NORESCAN COL(ICOL); /*@D61BDVB*/ 16857901
*  ANS('GENERATE (SIMSVC) ;'                                            16858001
*          ||COMMENT('ISSUE SIMSVC')) NORESCAN COL(ICOL);  /*@D61BDVB*/ 16858101
*                                                          /*@D61BDVB*/ 16858201
*  ANS('SVC (107);'||COMMENT('ISSUE MODESET SVC')) NORESCAN COL(ICOL);  16858301
*  IF RTCD = '' THEN               /* SVC RETURN CODE TO BE SAVED?   */ 16858401
*    GOTO LHA04100;                /* NO- SKIP AHEAD                 */ 16858501
*  ANS('RESPECIFY GPR15F RESTRICTED;') NORESCAN COL(ICOL);              16858601
*  ANS(RTCD(1)||' = GPR15F; '||COMMENT('SVC RETURN CODE'))              16858701
*        NORESCAN COL(ICOL);                                            16858801
*LHA04100:                                                              16858901
*  IF IREGS = '' THEN             /* WAS REGISTER 1 USED?           */ 16859001
*  ANS('RESPECIFY ('||IREGS||') UNRESTRICTED;') NORESCAN COL(ICOL);     16859101
*  ANS('END; '||COMMENT(IVCOMM)) NORESCAN COL(MACCOL);                  16859201
*  GOTO LHA09000;                  /* RETURN TO INVOKER              */ 16859301
*/********************************************************************/ 16859401
*LHA05000:/* COMMON TO SAVEKEY/EXTKEY/KEYADDR/WORKREG/KEYREG     @D1A*/ 16859501
*/********************************************************************/ 16859601
*  IVCOUNT = 0;                    /* RESET INSTRUCTION COUNT        */ 16859701
*  IVMCOUNT = 0;                   /* RESET LOOP COUNT               */ 16859801
*  IVIPK = 'IPK; /*SAVE CURRENT PSW KEY*/';                             16859901
*  IVSTPK = SAVEKEY(1)||' = GPR02F;';/* SAVE PROTECTION KEY          */ 16860001
*  ITCBRB = ' = TCBRBP; /*RB PTR FROM TCB*/';                           16860101
*  ITCBPK = ' = PCEKEY; /*GET KEY FROM PCB*/';             /*@D61BDVB*/ 16860201
*  IRBPTRC = WORKREG(1)||' = ' ||WORKREG(1)                             16860301
*        ||' -> RBOPSW(2); /*PSW KEY FROM RB OLD PSW*/';                16860401
*  ISPKA ='SPKA ('||ISPKA||'); /*SET PSW KEY*/';                        16860501
*  IF RELATED = '' THEN           /* WAS RELATED SPECIFIED      @D1A*/ 16860601
*    ISAVEXTC = ISAVEXTC||' RELATED'||RELATED; /* INTO COMMENT @D1A*/   16860701
*  ISAVEXTC = 'MODESET '||ISAVEXTC;                                     16860801
*  IF WORKREG = '' THEN                                                16860901
*    ISAVEXTC =ISAVEXTC||' WORKREG'||WORKREG;                           16861001
*  ANS('DO; '||COMMENT(ISAVEXTC)) NORESCAN COL(MACCOL);                 16861101
*  IF IREGS = '' THEN             /* WERE THERE ANY REGISTERS?      */ 16861201
*     ANS('RESPECIFY ('||IREGS||') RESTRICTED;') NORESCAN COL(ICOL);    16861301
*  IF SAVEKEY = '' THEN            /* WAS SAVEKEY SUPPLIED?          */ 16861401
*    GOTO LHA05100;                /* NO- SKIP AHEAD                 */ 16861501
*  IF WORKREG = '' THEN           /* YES-WAS WORK REGISTER SUPPLIED?*/ 16861601
*    DO;                           /*     YES-                       */ 16861701
*     IVCOUNT = IVCOUNT +1;        /*        INCR INSTR. COUNT BY 1  */ 16861801
*     IVPK(IVCOUNT)=WORKREG(1)||' = GPR02F; /*SAVE REGISTER 2*/';       16861901
*    END;                                                               16862001
*  IVCOUNT = IVCOUNT +1;           /* INCR. INSTR. COUNT BY 1        */ 16862101
*  IVPK(IVCOUNT) = IVIPK;          /* IPK INSTRUCTION FORM           */ 16862201
*  IF ISAVEXTF = 3 THEN            /*    WAS THIS EXTKEY, SAVEKEY SEQ*/ 16862301
*    DO;                           /*     YES-                       */ 16862401
*     IVCOUNT = IVCOUNT +1;        /*        INCR. INSTR. COUNT BY 1 */ 16862501
*     IVPK(IVCOUNT) = ISPKA;       /*        SPKA INSTRUCTION        */ 16862601
*    END;                                                               16862701
*  IVCOUNT = IVCOUNT + 1;          /* INCR. INSTR. COUNT BY 1        */ 16862801
*  IVPK(IVCOUNT) =IVSTPK;          /* SAVE PROTECTION KEY INSTR.     */ 16862901
*  IF WORKREG = '' THEN           /* WAS WORK REGISTER SUPPLIED?    */ 16863001
*    DO;                           /* YES-RESTORE REGISTER 2         */ 16863101
*     IVCOUNT = IVCOUNT + 1;                                            16863201
*     IVPK(IVCOUNT)='GPR02F ='||WORKREG(1)||'; /*RESTORE REGISTER 2*/'; 16863301
*    END;                                                               16863401
* LHA05150:                        /* NO SAVEKEY                 @D1A*/ 16863501
*  IF ISAVEXTF >= 8 THEN           /*WAS EXTKEY(RBT1/RBT234/TCB) @D1C*/ 16863601
*    GOTO LHA05100;                /*     YES-SKIP AHEAD             */ 16863701
*  IF KEYADDR = '' THEN           /* WAS KEYADDR SUPPLIED?          */ 16863801
*    GOTO LHA05200;                /* YES-SKIP AHEAD                 */ 16863901
*  IF KEYREG = '' THEN            /* WAS KEY REG SUPPLIED ?     @D1A*/ 16864001
*    GOTO LHA05250;                /* YES-SKIP AHEAD             @D1A*/ 16864101
*  GOTO LHA05500;                  /* SKIP AHEAD                     */ 16864201
*/********************************************************************/ 16864301
*LHA05100:/* BUILD TEXT FOR EXTKEY(TCB/RBT1/RBT234)                  */ 16864401
*/********************************************************************/ 16864501
*  IF EXTKEY(1) = 'TCB' THEN       /*     EXTKEY(TCB)?               */ 16864601
*    DO;                                                                16864701
*     IVPK(IVCOUNT+1)=WORKREG(1)||ITCBPK;/* GET KEY FORM TCB INSTR.  */ 16864801
*     IVPK(IVCOUNT+2)=ISPKA;       /*     SPKA INSTRUCTION           */ 16864901
*     IVCOUNT = IVCOUNT + 2;       /*     INDEX TO NEXT INSTR.       */ 16865001
*     GOTO LHA05500;               /*     SKIP AHEAD                 */ 16865101
*    END;                                                               16865201
*/*   DELETION START ----------------------------------------@D61BDVB*/ 16865301
*  IF EXTKEY(1) = 'RBT1' THEN      /* WAS THIS TYPE 1 SVC?           */ 16865401
*    DO;                                                                16865501
*     IVPK(IVCOUNT+1)=WORKREG(1)||ITCBRB;/* GET RB PTR FROM TCB INSTR*/ 16865601
*     IVPK(IVCOUNT+2)= IRBPTRC;    /*     PROTECTION KEY FROM RBOPSW */ 16865701
*     IVPK(IVCOUNT+3)= ISPKA;      /*     SPKA INSTRUCTION           */ 16865801
*     IVCOUNT = IVCOUNT +3;        /*     INDEX TO NEXT INSTRUCTION  */ 16865901
*     GOTO LHA05500;               /*     SKIP AHEAD                 */ 16866001
*    END;                                                               16866101
*  IF EXTKEY(1) = 'RBT234' THEN    /* TYPE 2, 3 OR 4 SVC             */ 16866201
*    DO;                           /* YES                            */ 16866301
*     IVPK(IVCOUNT+1)=WORKREG(1)||ITCBRB;/* GET RB PTR FORM TCB INSTR*/ 16866401
*     IVPK(IVCOUNT+2)=WORKREG(1)||' = '||WORKREG(1)                     16866501
*        ||' -> RBLINKB; /*NEXT RB ADDRESS @G860PXB*/';                 16866601
*     IVPK(IVCOUNT+3)= IRBPTRC;    /*     PROTECTION KEY FROM RBOPSW */ 16866701
*     IVPK(IVCOUNT+4)= ISPKA;                                           16866801
*     IVCOUNT = IVCOUNT +4;        /*     INDEX TO NEXT INSTR.       */ 16866901
*     GOTO LHA05500;               /*     SKIP AHEAD                 */ 16867001
*    END;                                                               16867101
*/*   DELETION END   ----------------------------------------@D61BDVB*/ 16867201
*  IF EXTKEY = '' THEN            /* EXTKEY(VSM/RSM) SPECIFIED?     */ 16867301
*    DO;                           /* YES-                           */ 16867401
*     IVCOUNT = IVCOUNT + 1;       /*     INCR INSTR. COUNT BY 1     */ 16867501
*     IVPK(IVCOUNT)= ISPKA;                                             16867601
*     GOTO LHA05500;               /*     SKIP AHEAD                 */ 16867701
*    END;                                                               16867801
*  IF WORKREG = '' THEN           /* WAS WORK REGISTER SUPPLIED?    */ 16867901
*    DO;                           /* YES-                           */ 16868001
*     IF KEYADDR='' THEN           /* KEYREG, NOT KEYADDR        @P1A*/ 16868101
*       GOTO LHA05250;             /* YES, IGNORE WORKREG        @P1A*/ 16868201
*     IVPK(IVCOUNT+1)=WORKREG(1)||' = '||KEYADDR(1)                     16868301
*        ||'; /*GET KEY FROM SAVE LOCATION*/';                          16868401
*     IVPK(IVCOUNT+2)= ISPKA;                                           16868501
*     IVCOUNT = IVCOUNT +2;        /*     INCR INSTR. COUNT BY 1     */ 16868601
*    END;                                                               16868701
*  ELSE IF KEYADDR='' THEN       /*                             @D1C*/ 16868801
*/********************************************************************/ 16868901
*LHA05200:/* BUILD TEXT FOR KEYADDR OPTION                           */ 16869001
*/********************************************************************/ 16869101
*    DO;                                                                16869201
*     IVCOUNT = IVCOUNT +1;        /*     INCR INSTR. COUNT BY 1     */ 16869301
*     IVPK(IVCOUNT)='SPKA ('||KEYADDR(1)||'); /*SET PSW KEY*/';         16869401
*    END;                                                               16869501
*  ELSE                            /*                            @D1A*/ 16869601
* LHA05250:                        /*                            @D1A*/ 16869701
*    DO;                           /*                            @D1A*/ 16869801
*      IVCOUNT = IVCOUNT + 1;      /* INCR. INSTRUCTION COUNT    @D1A*/ 16869901
*      IVPK(IVCOUNT)='SPKA '||KEYREG||'; /* SET PSW KEY */';            16870001
*                                  /* INCLUDE SPKA               @D1A*/ 16870101
*    END;                          /*                            @D1A*/ 16870201
*/********************************************************************/ 16870301
*LHA05500:/* GENERATE TEXT FOR KEYADDR/EXTKEY/SAVEKEY/KEYREG     @D1C*/ 16870401
*/********************************************************************/ 16870501
*  IF  IVCOUNT > 0 THEN            /* DONE ANSWERING TEXT?           */ 16870601
*    DO;                           /* NO-                            */ 16870701
*     IVMCOUNT= IVMCOUNT + 1;      /*     INCR INDEX BY 1            */ 16870801
*     ANS(IVPK(IVMCOUNT)) NORESCAN COL(ICOL);                           16870901
*     IVCOUNT = IVCOUNT -1;        /*     DECR. INSTR. COUNT BY 1    */ 16871001
*     GOTO LHA05500;                                                    16871101
*    END;                                                               16871201
*  IF IREGS = '' THEN             /* ANY REGISTERS USED?            */ 16871301
*    ANS('RESPECIFY ('||IREGS||') UNRESTRICTED;') NORESCAN COL(ICOL);   16871401
*  ANS('END; '||COMMENT(ISAVEXTC)) NORESCAN COL(MACCOL);                16871501
*/********************************************************************/ 16871601
*LHA09000:/* RETURN TO INVOKER                                       */ 16871701
*/********************************************************************/ 16871801
*  IF IVERR > 4 THEN               /* ANY 'S' TYPE MSGS?             */ 16871901
*    EHARC = IVERR;                /* YES-SET RETURN CODE            */ 16872001
*  RETURN CODE(EHARC);             /* RETURN TO INVOKER              */ 16872101
*%END;                                                                  16900000
