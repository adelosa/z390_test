.* IBM  DISK OPERATING SYSTEM                                           00050000
.* ISFMS - ISMOD6 - 5686-007-02-C440                           @U31TUJS 00100000
.* COPYRIGHT = THIS MACRO IS "RESTRICTED MATERIALS OF IBM"     @U31TUJS 00150000
.*             5686-007 (C) COPYRIGHT IBM CORP. 1977,1989      @U31TUJS 00200000
.*             ALL RIGHTS RESERVED                             @U31TUJS 00250000
.*             LICENSED MATERIALS - PROPERTY OF IBM            @U31TUJS 00300000
.*             SEE COPYRIGHT INSTRUCTIONS, G120-2083           @U31TUJS 00350000
* ISFMS - ISMOD6 - 5686-007-02-C440                            @U31TUJS 00400000
* CCW CONTENTS: X'08', POINTER TO *-8, FLAGS 60, 5.                     00450000
         DC    X'436C'                  READ ID.                        00500000
* CCW CONTENTS: X'12', 'IJHACRID', FLAGS 60, 10.                        00550000
         DC    X'7941'                  SEARCH KEY EQUAL/HIGH.          00600000
* CCW CONTENTS: X'69', POINTER TO KEYARG, FLAGS 40, KEYLENGTH.          00650000
         DC    X'046B'                  TIC *-16.                       00700000
* CCW CONTENTS: X'08', POINTER TO *-16, FLAGS 60, 5.                    00750000
         DC    X'1B02'                  READ DATA.                      00800000
* CCW CONTENTS: X'06', POINTER TO IOAREAL+8+KL, FLAGS 00, BLOCKSIZE.    00850000
         AIF   (NOT &SW(23)).JF                                     3-4 00900000
         AIF   (&SW(24)).JE             RDONLY SPECIFIED       @DL30SMP 00950000
         MVI   IJHEWORK,X'82'           INDICATE READ DATA          3-4 01000000
         MVC   IJHEWORK+1(3),IJHAKLN8+1 IOAREA ADDRESS              3-4 01050000
         AGO   .JF                                                  3-4 01100000
.JE      ANOP                                                       3-4 01150000
         MVI   44(13),X'82'             INDICATE READ DATA          3-4 01200000
         MVC   45(3,13),IJHAKLN8+1      IOAREA ADDRESS              3-4 01250000
.JF      ANOP                                                       3-4 01300000
         AIF   (NOT &SW(11)).JG                                     3-9 01350000
         BAL   IJHREG4,IJHAIOPH        EXCP, WAIT, ERROR TEST       3-9 01400000
         AGO   .JH                                                  3-9 01450000
.JG      ANOP                                                       3-9 01500000
         BAL   4,IJHAIOOP               EXCP, WAIT, & TEST FOR ERRORS.  01550000
.JH      ANOP                                                       3-9 01600000
IJHACGTO MVC   IJHCSADR+3(5),IJHACRID   MOVE IN RECORD ID.              01650000
         AIF   (&SW(22)).JT             GO IF PRIME DATA IN CORE ADD.   01700000
         AIF   (NOT &SW(7)).JI          FIXBLK OR FIXUNB       @DL30SMP 01750000
         TM    IJHCOPT,X'08'            IF UNBLOCKED RECORDS,           01800000
         BZ    IJHAA26                    GO HERE.                      01850000
.JI      AIF   (NOT &SW(6)).JN          FIXUNB SPECIFIED       @DL30SMP 01900000
         BAL   IJHARG2,IJHACDBK         GO TO DE-BLOCK ROUTINE.         01950000
         AIF   (NOT &SW(11)).JJ                                     3-9 02000000
         B     IJHSER2H                FREE TRKS AND RETURN TO USER 3-9 02050000
         AGO   .JK                                                  3-9 02100000
.JJ      ANOP                                                       3-9 02150000
         B     IJHSER2                  RETURN TO USER.                 02200000
.JK      ANOP                                                       3-9 02250000
         LH    IJHA4,IJHCKYSZ           STORE KEY OF PHYSICAL RECORD    02300000
         BCTR  IJHA4,0                    IN KEYARG.                    02350000
         L     13,IJHADKEY              POINTER TO ADD KEY          3-4 02400000
         EX    IJHA4,IJHAA22                                            02450000
IJHACTET CLC   IJHCSADR+7(1),IJHACLTR   IF LAST RECORD HAS BEEN UPDATED 02500000
         BE    IJHANEOT                   GO TO EOT ROUTINE.            02550000
         BAL   IJHA4,IJHCBLD1           BUILD CCW TO READ NEXT PRIME    02600000
*                                         RECORD.                       02650000
         AIF   (NOT &SW(15)).JK1        RPS NOT SPECIFIED      @DL30SMP 02700000
         DC    X'F101' .                SET SECTOR             @DL30SMP 02750000
* CCW CONTENTS: X'23', PTR TO SECTOR ARG, FLAGS 60, LNTH = 1 . @DL30SMP 02800000
.JK1     ANOP                                                  @DL30SMP 02850000
         DC    X'8C4B'                  SEARCH ID EQUAL.                02900000
* CCW CONTENTS: X'31', 'IJHCSADR+3', FLAGS 40, 5.                       02950000
         DC    X'066B'                  TIC TO *-8.                     03000000
* CCW CONTENTS: X'08', POINTER TO *-8, FLAGS 60, 5.                     03050000
         DC    X'436C'                  READ ID.                        03100000
* CCW CONTENTS: X'12', 'IJHACRID', FLAGS 60, 10.                        03150000
         DC    X'AA06'                  READ KEY, DATA.                 03200000
* CCW CONTENTS: X'0E', 'IOAREAL+8', FLAGS 00, KEYLEN + BLOCKSIZE.       03250000
         AIF   (NOT &SW(23)).JM                                     3-4 03300000
         AIF   (&SW(24)).JL             RDONLY SPECIFIED       @DL30SMP 03350000
         MVI   IJHEWORK,X'82'           INDICATE READ DATA          3-4 03400000
         MVC   IJHEWORK+1(3),IJHADKEY+5 IOAREA ADDRESS              3-4 03450000
         AGO   .JM                                                  3-4 03500000
.JL      ANOP                                                       3-4 03550000
         MVI   44(13),X'82'             INDICATE READ DATA          3-4 03600000
         MVC   45(3,13),IJHADKEY+5       IOAREA ADDRESS             3-4 03650000
.JM      ANOP                                                       3-4 03700000
         BAL   4,IJHAIOOP               EXCP, WAIT, ERROR TEST.         03750000
         B     IJHACGTO                 LOOP.                           03800000
.JN      AIF   (NOT &SW(5)).JS          FIXBLK SPECIFIED       @DL30SMP 03850000
IJHAA26  BAL   4,IJHCBLD1               BUILD CCW TO READ KEY & BLOCK.  03900000
         AIF   (NOT &SW(15)).JN1        RPS NOT SPECIFIED      @DL30SMP 03950000
         DC    X'F101' .                SET SECTOR             @DL30SMP 04000000
* CCW CONTENTS: X'23', PTR TO SECTOR ARG, FLAGS 60, LNTH = 1 . @DL30SMP 04050000
.JN1     ANOP                                                  @DL30SMP 04100000
         DC    X'8C4B'                  SEARCH ID EQUAL.                04150000
* CCW CONTENTS: X'31', 'IJHCSADR+3', FLAGS 40, 5.                       04200000
         DC    X'066B'                  TIC TO *-8.                     04250000
* CCW CONTENTS: X'08', POINTER TO *-8, FLAGS 60, 5.                     04300000
         DC    X'AA06'                  READ KEY, DATA.                 04350000
* CCW CONTENTS: X'0E', 'IOAREAL+8', FLAGS 00, KEYLEN + BLOCKSIZE.       04400000
         AIF   (NOT &SW(23)).JP                                     3-4 04450000
         AIF   (&SW(24)).JO             RDONLY SPECIFIED       @DL30SMP 04500000
         MVI   IJHEWORK,X'82'           INDICATE READ DATA          3-4 04550000
         MVC   IJHEWORK+1(3),IJHADKEY+5 IOAREA ADDRESS              3-4 04600000
         AGO   .JP                                                  3-4 04650000
.JO      ANOP                                                       3-4 04700000
         MVI   44(13),X'82'             INDICATE READ DATA          3-4 04750000
         MVC   45(3,13),IJHADKEY+5       IOAREA ADDRESS             3-4 04800000
.JP      ANOP                                                       3-4 04850000
         BAL   4,IJHAIOOP               EXCP, WAIT, & TEST FOR ERRORS.  04900000
         AIF   (NOT &SW(24)).ERR64A    RDONLY NOT SPECIFIED    @DL30SMP 04950000
         L     IJHARG6,IJHADKEY        RESTORE ADDR OF ADD KEY      3-9 05000000
.ERR64A  ANOP                                                       3-9 05050000
         LH    4,IJHCKYSZ               FOR DUPLICATION OF KEYS,        05100000
         BCTR  4,0                        GO TO ERROR ROUTINE.          05150000
         EX    4,IJHAA30                                                05200000
         BE    IJHACDUP                                                 05250000
         BAL   4,IJHCBLD1               BUILD CCW TO WRITE AND VERIFY.  05300000
         AIF   (NOT &SW(15)).JP1        RPS NOT SPECIFIED      @DL30SMP 05350000
         DC    X'F101' .                SET SECTOR             @DL30SMP 05400000
* CCW CONTENTS: X'23', PTR TO SECTOR ARG, FLAGS 60, LNTH = 1 . @DL30SMP 05450000
.JP1     ANOP                                                  @DL30SMP 05500000
         DC    X'8C4B'                  SEARCH ID EQUAL.                05550000
* CCW CONTENTS: X'31', 'IJHCSADR+3', FLAGS 40, 5.                       05600000
         DC    X'066B'                  TIC TO *-8.                     05650000
* CCW CONTENTS: X'08', POINTER TO *-8, FLAGS 60, 5.                     05700000
         DC    X'28C6'                  WRITE KEY, DATA.                05750000
* CCW CONTENTS: X'0D', POINTER TO WORKL, FLAGS 40, KEYLEN&BLOCKSIZE.    05800000
         AIF   (NOT &SW(15)).JP2        RPS NOT SPECIFIED      @DL30SMP 05850000
         DC    X'F111' .                SET SECTOR             @DL30SMP 05900000
* CCW CONTENTS: X'23', PTR TO SECTOR ARG, FLAGS 60, LNTH = 1 . @DL30SMP 05950000
.JP2     ANOP                                                  @DL30SMP 06000000
         DC    X'8C4B'                  SEARCH ID EQUAL.                06050000
* CCW CONTENTS: X'31', 'IJHCSADR+3', FLAGS 40, 5.                       06100000
         DC    X'066B'                  TIC TO *-8.                     06150000
* CCW CONTENTS: X'08', POINTER TO *-8, FLAGS 60, 5.                     06200000
         DC    X'A836'                  VERIFY KEY, DATA.               06250000
* CCW CONTENTS: X'0E', POINTER TO WORKL, FLAGS 30, KEYLEN+BLOCKSIZE.    06300000
         AIF   (NOT &SW(23)).JR                                     3-4 06350000
         AIF   (&SW(24)).JQ             RDONLY SPECIFIED       @DL30SMP 06400000
         MVI   IJHEWORK,X'81'           INDICATE WRITE DATA         3-4 06450000
         MVC   IJHEWORK+1(3),IJHACUSE+1 IOAREA ADDRESS              3-4 06500000
         AGO   .JR                                                  3-4 06550000
.JQ      ANOP                                                       3-4 06600000
         MVI   44(13),X'81'             INDICATE WRITE DATA         3-4 06650000
         MVC   45(3,13),IJHACUSE+1      IOAREA ADDRESS              3-4 06700000
.JR      ANOP                                                       3-4 06750000
         BAL   4,IJHAIOOP               EXCP, WAIT, & TEST FOR ERRORS.  06800000
         L     IJHARG6,IJHADKEY         POINTER TO KEYARG           3-4 06850000
         EX    0,IJHAISKY               MOVE KEY FROM WORKL TO KEYARG.  06900000
         LH    IJHA7,IJHCABCD           BRANCH TO EXCHANGE KEY & DATA   06950000
         LR    9,IJHARG5                  IN WORKL & IOAREAL AREAS.     07000000
         LA    10,8(IJHARG4)                                            07050000
         BAL   4,IJHAASHF                                               07100000
         CLC   IJHCSADR+7(1),IJHACLTR   IF LAST PRIME RECORD HAS BEEN   07150000
         BE    IJHANEOT                   REWRITTEN, GO TO EOT ROUTINE. 07200000
         LA    9,IJHCSADR+7             BRANCH TO UPDATE THE RECORD     07250000
         BAL   4,IJHACUPD                 NUMBER.                       07300000
         B     IJHAA26                  LOOP TO CONTINUE PROCESS.       07350000
.JS      ANOP                                                       3-9 07400000
         AGO   .J8                      GO TO EOF ROUTINE.          3-9 07450000
.JT      ANOP                                                       3-9 07500000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07550000
*NOTES FOR PRIME DATA IN CORE:                                        * 07600000
*       #5 IS BASE REGISTER FOR PRIME DATA IN CORE PARAMETERS.        * 07650000
*       #6 IS # OF RECORDS LEFT ON TRACK--CALCULATED IN 'IJHAPRM4'.   * 07700000
*                                       --RE-CALCULATED IN 'IJHACITF'.* 07750000
*       #14 IS # OF RECORDS TO BE READ--CALCULATED IN 'IJHAPRM1' AS   * 07800000
*                                       FUNCTION OF # OF RECORDS LEFT * 07850000
*                                       ON TRACK (#6).                * 07900000
*                                     --MODIFIED IN 'IJHACDBK'.       * 07950000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08000000
         USING IJHPSIZE,5               ESTABLISH ADDRESSABILITY FOR    08050000
         SR    7,7                      DECREMENT SEEK ADDRESS RECORD   08100000
         IC    7,IJHCSADR+7               NUMBER BY 1.                  08150000
         BCTR  7,0                                                      08200000
         STC   7,IJHCSADR+7                                             08250000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08300000
IJHAPRM4 SR    6,6                      INITIALIZE.                     08350000
         IC    6,IJHACLTR               CALCULATE # RECORDS LEFT ON     08400000
         SR    6,7                        TRACK.                        08450000
IJHAPRM7 BAL   4,IJHAPRM1               MODIFY CCW CHAIN IF NECESSARY.  08500000
         AIF   (NOT &SW(15)).JT1       RPS NOT SPECIFIED       @DL30SMP 08550000
         ST    IJHREG6,IJHVTRS         SAVE REGISTER 6         @DL30SMP 08600000
         ICM   IJHREG6,IJHVM1,IJHCCCB+IJHVD9  SET BASE FOR EXT @DL30SMP 08650000
         MVC   IJHCCCW+IJHVD1(IJHVL3),IJHPDSP2+IJHVD1  BUILD   @DL30SMP 08700000
         MVI   IJHCCCW,IJHVTOC         TIC TO READ CCW CHAIN   @DL30SMP 08750000
         L     IJHREG6,IJHVTRS         RESTORE REGISTER 6      @DL30SMP 08800000
         AGO   .JT2                                            @DL30SMP 08850000
.JT1     ANOP                                                  @DL30SMP 08900000
         MVC   IJHCCCW+1(3),IJHPDSP2+1  BUILD TIC TO READ CCW CHAIN.    08950000
         MVI   IJHCCCW,X'08'                                            09000000
.JT2     ANOP                                                  @DL30SMP 09050000
         AIF   (NOT &SW(23)).JV                                     3-4 09100000
         AIF   (&SW(24)).JU             RDONLY SPECIFIED       @DL30SMP 09150000
         MVI   IJHEWORK,X'82'           INDICATE READ DATA          3-4 09200000
         MVC   IJHEWORK+1(3),IJHPDSP2+1 IOAREA ADDRESS              3-4 09250000
         AGO   .JV                                                  3-4 09300000
.JU      ANOP                                                       3-4 09350000
         MVI   44(13),X'82'             INDICATE READ DATA          3-4 09400000
         MVC   45(3,13),IJHPDSP2+1      IOAREA ADDRESS              3-4 09450000
.JV      ANOP                                                       3-4 09500000
         LR    14,15                    RESTORE REGISTER 14 FOR    3-10 09550000
         AH    14,IJHSDISP             USE AS SECOND BASE REGISTER 3-10 09600000
         LR    13,0  POINT TO SAVE AREA                        @DA00134 09650000
         TM    IJHCOPT,X'04'            VERIFY OPTION          @DA01137 09700000
         BNO   *+8                      NO                     @DA01137 09750000
         BAL   4,IJHSWAPR               SET OFF SKIP BIT       @DA01137 09800000
         BAL   4,IJHAIOOP               EXCP, WAIT, ERROR TEST.         09850000
         AIF   (NOT &SW(7)).JW          BOTH SPECIFIED         @DL30SMP 09900000
         TM    IJHCOPT,X'08'            FOR UNBLOCKED RECORDS,          09950000
         BZ    IJHAA26                    GO HERE.                      10000000
.JW      AIF   (NOT &SW(6)).JX          FIXUNB SPECIFIED       @DL30SMP 10050000
         BAL   4,IJHACDBK                                               10100000
         AIF   (NOT &SW(5)).J2          FIXBLK SPECIFIED       @DL30SMP 10150000
         B     IJHAA26A                                                 10200000
.JX      ANOP                                                       3-9 10250000
IJHAA26  LH    4,IJHCKYSZ               FOR DUPLICATION OF KEYS,        10300000
         BCTR  4,0                        GO TO ERROR ROUTINE.          10350000
         LM    IJHARG4,IJHARG6,IJHAARAD RESTORE POINTERS            3-4 10400000
         EX    4,IJHAA30                                                10450000
         BE    IJHARS23                                             3-4 10500000
         LH    7,IJHCABCD               INITIALIZE COUNT AND POINTERS   10550000
         LA    10,8(11)                   TO IOAREAL & WORKL.           10600000
         SH    10,IJHCCMAX                                              10650000
         LR    9,12                                                     10700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 10750000
IJHAPRM6 AH    10,IJHCCMAX              BUMP POINTER TO IOAREAL.        10800000
         AIF   (&SW(24)).JY                                         3-4 10850000
         ST    10,IJHSV10               SAVE POINTER                3-4 10900000
         AGO   .JZ                                                  3-4 10950000
.JY      ANOP                                                       3-4 11000000
         LR    13,0                     POINT TO SAVE AREA          3-4 11050000
         ST    10,68(13)                SAVE POINTER                3-4 11100000
.JZ      ANOP                                                       3-4 11150000
         LR    14,15                   ESTABLISH                   3-10 11200000
         AH    14,IJHSDISP               ADDRESSABILITY            3-10 11250000
         BAL   4,IJHAASHF               EXCHANGE KEY & DATA IN IOAREAL  11300000
         AIF   (&SW(24)).J0                                         3-4 11350000
         L     10,IJHSV10               RESTORE POINTER             3-4 11400000
         AGO   .J1                                                  3-4 11450000
.J0      ANOP                                                       3-4 11500000
         L     10,68(13)                RESTORE POINTER             3-4 11550000
.J1      ANOP                                                       3-4 11600000
         LR    9,12                     REINITIALIZE POINTER        3-4 11650000
         LH    7,IJHCABCD                 AND LENGTH AND WORKLA4C  3-10 11700000
         LH    14,IJHDCWRK             COUNT OF RECDS TO BE RD @DA07584 11750000
         BCTR  14,0                    DECREMENT                   3-10 11800000
         STH   14,IJHDCWRK             SAVE NEW COUNT          @DA07584 11850000
         LTR   14,14                                               3-10 11900000
         BP    IJHAPRM6                LOOP IF NECESSARY           3-10 11950000
         LR    4,12                     MOVE LAST IOAREAL KEY TO        12000000
         LR    12,10                      KEYARG.                       12050000
         L     IJHARG6,IJHADKEY         POINTER TO KEYARG               12100000
         EX    0,IJHAISKY                                               12150000
         LR    12,4                                                     12200000
.J2      ANOP                                                       3-9 12250000
IJHAA26A EQU   *                                               @DL30SMP 12300000
         AIF   (NOT &SW(15)).J21       RPS NOT SPECIFIED       @DL30SMP 12350000
         ST    IJHREG6,IJHVTRS         SAVE REGISTER 6         @DL30SMP 12400000
         ICM   IJHREG6,IJHVM1,IJHCCCB+IJHVD9  SET BASE FOR EXT @DL30SMP 12450000
         MVC   IJHCCCW+IJHVD1(IJHVL3),IJHPDSP1+IJHVD1  BUILD   @DL30SMP 12500000
         MVI   IJHCCCW,IJHVTOC         TIC TO WRITE CCW CHAIN  @DL30SMP 12550000
         L     IJHREG6,IJHVTRS         RESTORE REGISTER 6      @DL30SMP 12600000
         AGO   .J22                                            @DL30SMP 12650000
.J21     ANOP                                                  @DL30SMP 12700000
         MVC   IJHCCCW+1(3),IJHPDSP1+1  BUILD TIC TO WRITE CCW CHAIN.   12750000
         MVI   IJHCCCW,X'08'                                            12800000
.J22     ANOP                                                  @DL30SMP 12850000
         AIF   (NOT &SW(23)).J4                                     3-4 12900000
         AIF   (&SW(24)).J3             RDONLY SPECIFIED       @DL92SMP 12950000
         MVI   IJHEWORK,X'81'           INDICATE WRITE DATA         3-4 13000000
         MVC   IJHEWORK+1(3),IJHAARAD+1 IOAREA ADDRESS              3-4 13050000
         AGO   .J4                                                  3-4 13100000
.J3      ANOP                                                       3-4 13150000
         LR    IJHREG13,IJHREG0        RESTORE POINTER              3-9 13200000
         MVI   44(13),X'81'             INDICATE WRITE DATA         3-4 13250000
         MVC   45(3,13),IJHAARAD+1       IOAREA ADDRESS             3-4 13300000
.J4      ANOP                                                       3-4 13350000
         LR    14,15                    RESTORE REGISTER 14 FOR    3-10 13400000
         AH    14,IJHSDISP              USE AS SECOND BASE REGISTER3-10 13450000
         TM    IJHCOPT,X'04'            VERIFY OPTION          @DA01137 13500000
         BNO   *+8                      NO                     @DA01137 13550000
         BAL   4,IJHSWAPW               SET ON SKIP BIT        @DA01137 13600000
         BAL   4,IJHAIOOP               EXCP, WAIT, ERROR TEST.         13650000
         BAL   4,IJHAPRM1               MODIFY CCW CHAIN IF NECESSARY.  13700000
         AIF   (NOT &SW(6)).J6          FIXUNB SPECIFIED       @DL30SMP 13750000
         AIF   (NOT &SW(5)).J5          FIXBLK SPECIFIED       @DL30SMP 13800000
         TM    IJHCOPT,X'08'            FOR UNBLOCKED RECORDS,          13850000
         BZ    IJHAPRM8                   GO HERE.                      13900000
.J5      ANOP                                                       3-9 13950000
         LA    8,IJHAPRM8               BRANCH HERE FOR UNPADDED KEY    14000000
         BAL   7,IJHAJ29                  IN WORKL.                     14050000
         NI    IJHPSW,X'7F'             TURN OFF EOF HIT BIT.           14100000
         BAL   9,IJHACUPP              BUMP PRIME RECORD COUNT      3-4 14150000
         AIF   (NOT &SW(11)).J51                                   3-10 14200000
         B     IJHSER2H               FREE TRACK AND RETURN TO USER3-10 14250000
         AGO   .J6                                                 3-10 14300000
.J51     ANOP                                                      3-10 14350000
         B     IJHSER2                 RETURN TO USER              3-10 14400000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 14450000
.J6      ANOP                                                       3-9 14500000
IJHAPRM8 SR    7,7                      BUMP SEEK ADDRESS BY # RECORDS  14550000
         IC    7,IJHCSADR+7               READ.                         14600000
         AR    7,14                                                     14650000
         STC   7,IJHCSADR+7             (MUST USE #7).                  14700000
IJHACTET CLC   IJHCSADR+7(1),IJHACLTR   IF LAST PRIME RECORD HAS BEEN   14750000
         BE    IJHANEOT                   RE-WRITTEN, GO TO EOT ROUT.   14800000
         B     IJHAPRM4                 LOOP.                           14850000
         AIF   (&SW(24) OR NOT &SW(5)).J7  RDONLY OR FIXBLK    @DL30SMP 14900000
IJHSV10  DS    F                                                    3-4 14950000
.J7      ANOP                                                       3-4 15000000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 15050000
IJHARS23 BAL   4,IJHCINIT              LOAD BASE REGISTERS          3-4 15100000
         NI    IJHPSW,X'7F'            TURN OFF EOF-HIT !2          3-4 15150000
         B     IJHACDUP                   AND BRANCH.                   15200000
IJHSWAPR LH    9,IJHPMAX                  CALC # OF CCW'S      @DA01137 15250000
         L     IJHEIGHT,IJHPDSP2          POINT TO READ CCW    @DA01137 15300000
         LA    IJHEIGHT,16(IJHEIGHT)      PLUS 16              @DA01137 15350000
IJHSKIPR NI    4(IJHEIGHT),X'EF'          CLEAR SKIP BIT       @DA01137 15400000
         LA    IJHEIGHT,8(IJHEIGHT)       INCR TO NEXT CCW     @DA01137 15450000
         BCT   9,IJHSKIPR                 LOOP                 @DA01137 15500000
         BR    4                          RETURN               @DA01137 15550000
IJHSWAPW LH    9,IJHPMAX                  CALC # OF CCW'S      @DA01137 15600000
         L     IJHEIGHT,IJHPDSP2          POINT TO WRITE CCW   @DA01137 15650000
         LA    IJHEIGHT,16(IJHEIGHT)      PLUS 16              @DA01137 15700000
IJHSKIPW OI    4(IJHEIGHT),X'10'          TURN ON SKIP BIT     @DA01137 15750000
         LA    IJHEIGHT,8(IJHEIGHT)       INCR TO NEXT CCW     @DA01137 15800000
         BCT   9,IJHSKIPW                 LOOP                 @DA01137 15850000
         BR    4                          RETURN               @DA01137 15900000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 15950000
IJHAPRM1 LA    5,16                       PRIME DATA IN CORE        3-3 16000000
         LNR   5,5                        PARAMETERS.               3-3 16050000
         AR    5,3                                                  3-3 16100000
IJHEIGHT EQU   8                                                        16150000
         LH    9,IJHPMAX               CALC NO OF CCW'S MINUS ONE   3-3 16200000
         BCTR  9,0                                                  3-3 16250000
         SR    8,8                      SKIP MODIFYING CCW S IF THE 3-4 16300000
         CR    8,9                      NUMBER OF RECORDS TO BE     3-4 16350000
         BE    IJHAPRM2                READ EQUALS 1                3-4 16400000
         L     IJHEIGHT,IJHPDSP2       POINT TO READ CCW PLUS 16    3-3 16450000
         LA    IJHEIGHT,16(IJHEIGHT)                                    16500000
IJHCHAIN OI    4(IJHEIGHT),X'40'       TURN ON CHAINING BIT         3-4 16550000
         LA    IJHEIGHT,8(IJHEIGHT)    INCRE TO NEXT CCW            3-3 16600000
         BCT   9,IJHCHAIN              LOOP                         3-4 16650000
         LH    9,IJHPMAX               CALC NO OF CCW'S MINUS ONE   3-3 16700000
         BCTR  9,0                                                      16750000
         L     IJHEIGHT,IJHPDSP1       POIMT TO WRITE CCW PLUS 16   3-3 16800000
IJHCHANE LA    IJHEIGHT,16(IJHEIGHT)                                3-4 16850000
         OI    4(IJHEIGHT),X'40'       TURN WRITE CHAINING BIT ON   3-3 16900000
         LA    IJHEIGHT,8(IJHEIGHT)    INCRE TO NEXT CCW            3-3 16950000
         CLI   0(IJHEIGHT),X'31'       WAS SIDE CHANGED WITH TIC    3-4 17000000
         BE    IJHNOXC                 NO,BRANCH                    3-4 17050000
         XC    0(4,IJHEIGHT),12(IJHEIGHT)   FLIP-FLOP THE SEARCH    3-4 17100000
         XC    12(4,IJHEIGHT),0(IJHEIGHT)   ID EQUAL WITH THE TIC   3-4 17150000
         XC    0(4,IJHEIGHT),12(IJHEIGHT)   TO THE READ CCW'S       3-4 17200000
IJHNOXC  BCT   9,IJHCHANE              LOOP                         3-4 17250000
         CH    6,IJHPMAX                IF # RECORDS LEFT ON TRK IS 3-3 17300000
         BNL   IJHAPRM2                   GREATER THAN OR = TO MAX. #   17350000
*                                         IN CORE, GO HERE.             17400000
         LR    14,6                     # REC. TO BE READ = # LEFT ON   17450000
*                                         TRACK.                        17500000
         LR    9,14                     MODIFY FLAG IN READ CCW CHAIN.  17550000
         MH    9,IJHAPH8                                                17600000
         A     9,IJHPDSP2                                               17650000
         XI    12(9),X'40'                                              17700000
         LR    9,14                     GET POINTER TO APPLICABLE       17750000
         BCTR  9,0                        "SIDE" IN WRITE CCW CHAIN.    17800000
         MH    9,IJHAPH24                                               17850000
         A     9,IJHPDSP1                                               17900000
         STH   14,IJHDCWRK             COUNT OF RECDS TO BE RD @DA07584 17950000
         TM    IJHCOPT,X'04'            IF VERIFY IS NOT SPECIFIED,     18000000
         BZ    IJHAPRM3                   GO HERE.                      18050000
         XC    24(4,9),36(9)            MODIFY WRITE CCW CHAIN (SWITCH  18100000
         XC    36(4,9),24(9)              "SIDE" & "TIC").              18150000
         EX    0,*-12                                                   18200000
         BR    4                        RETURN TO CALLING ROUTINE.      18250000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18300000
IJHAPRM3 XI    20(9),X'40'              MODIFY FLAG IN WRITE CCW CHAIN. 18350000
         BR    4                        RETURN TO CALLING ROUTINE.      18400000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18450000
IJHAPRM2 LH    14,IJHPMAX               SET # REC TO BE READ = MAX. #   18500000
         STH   14,IJHDCWRK             COUNT OF RECDS TO BE RD @DA07584 18550000
         BR    4                          IN CORE, & RETURN.            18600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18650000
IJHAPH8  DC    H'8'                     CONSTANT.                       18700000
IJHAPH24 DC    H'24'                    CONSTANT.                       18750000
.J8      ANOP                                                       3-9 18800000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18850000
* ROUTINE IF EOF IS SENSED DURING READ OPERATION (DURING INSERTION INTO 18900000
* LAST PRIME DATA TRACK).                                               18950000
IJHACITF EQU   *                                                        19000000
         AIF   (NOT &SW(22)).J9         IF SINGLE ADD, SKIP.        3-9 19050000
         BAL   4,IJHAPRM1               MODIFY CCW CHAINS IF NECESSARY. 19100000
IJHACITI XI    IJHPSW,X'80'             FLIP-FLOP EOF HIT BIT.          19150000
         BC    8,IJHACITX               IF SECOND TIME EOF HIT, BRANCH. 19200000
         SR    7,7                      USE LAST PRIME DATA RECORD      19250000
         IC    7,IJHCSADR+7               ADDRESS TO RE-CALCULATE # OF  19300000
         IC    6,IJHCCLPA+7               RECORDS LEFT ON TRACK.        19350000
         SR    6,7                                                      19400000
         BZ    IJHACITI                 IF RESULT IS ZERO, GO HERE.     19450000
         B     IJHAPRM7                 BRANCH.                         19500000
IJHACITX LA    9,IJHCSADR+7            ADDR OF RCD NO TO BE UPDATED 3-2 19550000
         BAL   4,IJHAA14                                                19600000
         TM    IJHCOPT,X'08'            BLOCKED RECORDS             3-4 19650000
         BZ    IJHUNBLK                 NO                          3-4 19700000
         MVC   IJHACRID(5),IJHCSADR+3   MOVE UPDATED COUNT          3-4 19750000
         SR    4,4                                                  3-4 19800000
         IC    4,IJHCSADR+7             DECREMENT                   3-4 19850000
         BCTR  4,0                        SEEK RECORD               3-4 19900000
         STC   4,IJHCSADR+7                 NUMBER                  3-4 19950000
.J9      ANOP                                                       3-9 20000000
IJHUNBLK LR    14,15                    RESTORE BASEREGS       @DA01058 20050000
         AH    14,IJHSDISP                                     @DA01058 20100000
         BAL   IJHARG2,IJHACPD1         WRITE OVER EOF RECORD  @DA01058 20150000
         BAL   IJHARG2,IJHACEOF         WRITE NEW EOF RECORD.           20200000
         AIF   (NOT &SW(11)).KA                                     3-9 20250000
         EX    IJHREG0,IJHAOMTO        MOVE TRK INDX ADDR TO SEEK   3-9 20300000
         BAL   IJHREG10,IJHCMCAL       GET LOGICAL UNIT NUMBER      3-9 20350000
         B     IJHSER2H                FREE, AND RETURN TO USER     3-9 20400000
         AGO   .KB                                                  3-9 20450000
.KA      ANOP                                                       3-9 20500000
         B     IJHSER2                  RETURN TO USER.                 20550000
.KB      ANOP                                                       3-9 20600000
*********************************************************************** 20650000
*NAME: NORMAL SQUEEZE INTO OVERFLOW AT END OF PRIME TRACK.            * 20700000
*FUNCTION: TO MOVE THE FORMER LAST RECORD ON THE PRIME DATA TRACK     * 20750000
*          ONTO THE OVERFLOW AREA, AND TO ADJUST THE INDICES          * 20800000
*          ACCORDINGLY.                                               * 20850000
*ENTRY POINT: 'IJHANEOT'--MOVE RECORD TO OVERFLOW AREA.               * 20900000
*INPUT: WORKL AREA CONTAINS OVERFLOW RECORD (KEY + DATA) TO BE ADDED. * 20950000
*       KEYARG CONTAINS KEY OF LAST RECORD ON PRIME DATA TRACK.       * 21000000
*       'IJHARG4'(#11) POINTS TO IOAREAL.                             * 21050000
*       'IJHARG5'(#12) POINTS TO WORKL.                               * 21100000
*       'IJHARG6'(#13) POINTS TO KEYARG.                              * 21150000
*       'IJHAOADR' CONTAINS LAST OVERFLOW RECORD ADDRESS.             * 21200000
*       'IJHAOMBB' CONTAINS NEW OVERFLOW RECORD ADDRESS.              * 21250000
*       'IJHACTIA' POINTS TO START OF TRACK INDEX.                    * 21300000
*       'IJHACOCR' CONTAINS UPDATED COCR.                             * 21350000
*       'IJHACTNA' CONTAINS ID OF NORMAL TRACK INDEX ENTRY.           * 21400000
*       'IJHACTIN' POINTS TO THE PRIME DATA TRACK.                    * 21450000
*       'IJHACTOA' CONTAINS ID OF OVERFLOW TRACK INDEX ENTRY.         * 21500000
*       'IJHCBCKT' POINTS TO FIRST CHAINED OVERFLOW RECORD.           * 21550000
*OUTPUT: COCR RE-WRITTEN.                                             * 21600000
*        NORMAL TRACK INDEX ENTRY UPDATED.                            * 21650000
*        OVERFLOW TRACK INDEX ENTRY UPDATED.                          * 21700000
*        ENTRY ADDED TO OVERFLOW AREA.                                * 21750000
*EXIT: NORMAL--B IJHSER2, RETURN TO USER.                             * 21800000
*      ERROR --EXIT TAKEN IN CALLED ROUTINE 'IJHAIOOP'.               * 21850000
*EXTERNAL ROUTINES: 'IJHAOSQU'--WRITE NEW OVERFLOW RECORD.            * 21900000
*                   'IJHAOMTO'--CONSTRUCT TRACK INDEX OVERFLOW ENTRY. * 21950000
*                   'IJHACBKI'--GET POINTER & HIGH KEY, NORMAL ENTRY. * 22000000
*                   'IJHCBLD1'--CCW BUILD.                            * 22050000
*                   'IJHAIOOP'--EXCP, WAIT, ERROR TEST.               * 22100000
*REGISTER USE: #1 THRU #14.                                           * 22150000
*NOTES: NONE.                                                         * 22200000
*********************************************************************** 22250000
IJHANEOT AH    IJHARG4,IJHCKYSZ         INSERT SEQUENCE LINK FIELD OF   22300000
IJHAA27  MVC   8(10,IJHARG4),IJHCBCKT     NEW OVERFLOW RECORD.          22350000
         AIF   (NOT &SW(11)).KC                                     3-9 22400000
         SVC   IJHSVC36                FREE PRIME DATA TRACK        3-9 22450000
         NI    IJHCILN,X'FF'-IJHTRKHD  CLEAR DATA TRACK HELD BIT    3-9 22500000
.KC      ANOP                                                       3-9 22550000
         L     IJHARG4,IJHAARAD         RESTORE POINTER TO IOAREAL.     22600000
         LR    14,15                    RESTORE                @DA06368 22650000
         AH    14,IJHSDISP                   BASEREG           @DA06368 22700000
         BAL   IJHARG2,IJHAOSQU         WRITE NEW OVERFLOW RECORD.      22750000
         BAL   IJHARG2,IJHAOMTO         CONSTRUCT TRACK INDEX OVERFLOW  22800000
         L     IJHARG6,IJHADKEY         POINTER TO ADD KEY          3-4 22850000
         BAL   IJHARG3,IJHACBKI           ENTRY, AND GET POINTER AND    22900000
*                                         HIGH KEY FOR NORMAL ENTRY.    22950000
         BAL   IJHA4,IJHCBLD1           BUILD CCW TO WRITE TRACK INDEX. 23000000
         AIF   (NOT &SW(15)).KC1        RPS NOT SPECIFIED      @DL30SMP 23050000
         DC    X'F041' .                SET SECTOR (ARG = 0)   @DL30SMP 23100000
* CCW CONTENTS: X'23', PTR TO SECTOR ARG, FLAGS 60, LNTH = 1 . @DL30SMP 23150000
.KC1     ANOP                                                  @DL30SMP 23200000
         DC    X'8C4B'                  SEARCH ID EQUAL.                23250000
*CCW CONTENTS: X'31', 'IJHCSADR+3', FLAGS 40, 5.            (RE-WRITE   23300000
         DC    X'066B'                  TIC TO *-8.            COCR.)   23350000
*CCW CONTENTS: X'08', POINTER TO *-8, FLAGS 60, 5.                      23400000
         DC    X'B06C'                  UPDATE COCR.                    23450000
*CCW CONTENTS: X'05', 'IJHACOCR', FLAGS 60, 10.                         23500000
         AIF   (NOT &SW(15)).KC2        RPS NOT SPECIFIED      @DL30SMP 23550000
         DC    X'F141' .                SET SECTOR             @DL30SMP 23600000
* CCW CONTENTS: X'23', PTR TO SECTOR ARG, FLAGS 60, LNTH = 1 . @DL30SMP 23650000
         DC    X'D17B'                  READ HOME ADDRESS      @DL30SMP 23700000
* CCW CONTENTS: X'1A','IJHACTNA', FLAGS 70, 5.                 @DL30SMP 23750000
.KC2     ANOP                                                  @DL30SMP 23800000
         DC    X'E14B'                  SEARCH ID EQUAL (M/T).          23850000
*CCW CONTENTS: X'B1', 'IJHACTNA', FLAGS 40, 5.          (RE-WRITE       23900000
         DC    X'066B'                  TIC TO *-8.      NORMAL TRACK   23950000
*CCW CONTENTS: X'08', POINTER TO *-8, FLAGS 60, 5.       INDEX ENTRY.)  24000000
         DC    X'2A45'                  WRITE KEY, DATA.                24050000
*CCW CONTENTS: X'0D', POINTER TO IOAREAL+8, FLAGS 40, KEYLEN+10.        24100000
         DC    X'E24B'                  SEARCH ID EQUAL (M/T).          24150000
*CCW CONTENTS: X'B1', 'IJHACTOA', FLAGS 40, 5.                          24200000
         DC    X'066B'                  TIC TO *-8.     (RE-WRITE       24250000
*CCW CONTENTS: X'08', POINTER TO *-8, FLAGS 60, 5.       OVERFLOW       24300000
         DC    X'BDCC'                  WRITE DATA.      TRACK INDEX    24350000
*CCW CONTENTS: X'05', 'IJHCBCKT', FLAGS 40, 10.          ENTRY.)        24400000
         AIF   (NOT &SW(15)).KC3        RPS NOT SPECIFIED      @DL30SMP 24450000
         DC    X'F240' .                READ SECTOR            @DL30SMP 24500000
* CCW CONTENTS: X'22', PTR TO SECTOR ARG, FLAGS 60, LNTH = 1 . @DL30SMP 24550000
         DC    X'F251' .                SET SECTOR             @DL30SMP 24600000
* CCW CONTENTS: X'23', PTR TO SECTOR ARG, FLAGS 60, LNTH = 1 . @DL30SMP 24650000
.KC3     ANOP                                                  @DL30SMP 24700000
         DC    X'824B'                  SEARCH ID EQUAL.                24750000
*CCW CONTENTS: X'31', 'IJHACTOA', FLAGS 40, 5.                          24800000
         DC    X'066B'                  TIC TO *-8.                     24850000
*CCW CONTENTS: X'08', POINTER TO *-8, FLAGS 60, 5.                      24900000
         DC    X'1D3C'                  VERIFY DATA.                    24950000
*CCW CONTENTS: X'06', 'IJHCBCKT', FLAGS 30, 10.                         25000000
         AIF   (NOT &SW(23)).KE                                     3-4 25050000
         LA    4,IJHCBCKT               IOAREA ADDRESS              3-4 25100000
         AIF   (&SW(24)).KD             RDONLY SPECIFIED       @DL30SMP 25150000
         ST    4,IJHEWORK                                           3-4 25200000
         MVI   IJHEWORK,X'41'           INDICATE WRITE TRACK INDEX  3-4 25250000
         AGO   .KE                                                  3-4 25300000
.KD      ANOP                                                       3-4 25350000
         ST    4,44(13)                                             3-4 25400000
         MVI   44(13),X'41'             INDICATE WRITE TRACK INDEX  3-4 25450000
.KE      ANOP                                                       3-4 25500000
         BAL   4,IJHAIOOP               EXCP, WAIT, ERROR TEST.         25550000
         AIF   (NOT &SW(11)).KF                                     3-9 25600000
         B     IJHSER2H                FREE AND RETURN TO USER      3-9 25650000
         AGO   .KG                                                  3-9 25700000
.KF      ANOP                                                       3-9 25750000
         B     IJHSER2                  RETURN TO USER.                 25800000
.KG      ANOP                                                       3-9 25850000
         AIF   (NOT &SW(6)).KX          FIXUNB SPECIFIED       @DL30SMP 25900000
         AIF   (&SW(22)).KR             GO IF PRIME DATA IN CORE ADD.   25950000
* * *  SUBROUTINE TO INSERT ADDITION ON PRIME TRACK               * * * 26000000
IJHACOMP CLC   0(0,8),0(4)              USED BY AN "EX".                26050000
         AIF   (&SW(24)).KH             RDONLY SPECIFIED       @DL30SMP 26100000
IJHASV5  DC    F'0'                                                 3-4 26150000
IJHACDBK ST    5,IJHASV5                SAVE RETURN REGISTER        3-4 26200000
         AGO   .KI                                                  3-4 26250000
.KH      ANOP                                                       3-4 26300000
IJHACDBK LR    13,0                     POINT TO SAVE AREA          3-4 26350000
         ST    5,68(13)                 SAVE RETURN REGISTER        3-4 26400000
.KI      ANOP                                                       3-4 26450000
         LH    5,IJHCBFAC               GET DEBLOCKING FACTOR       3-4 26500000
         L     IJHARG3,IJHAKLN8         GET DATA ADDRESS.               26550000
IJHACLOP LR    4,IJHARG3                GET POINTER TO FIRST KEY IN     26600000
         AH    4,IJHCKYLC                 IOAREAL.                      26650000
         BCTR  4,0                                                      26700000
         LR    8,IJHARG5                GET POINTER TO KEY IN WORKL.    26750000
         AH    8,IJHCKYLC                                               26800000
         BCTR  8,0                                                      26850000
         LH    IJHA7,IJHCKYSZ           GET KEY LENGTH LESS 1.          26900000
         BCTR  IJHA7,0                                                  26950000
         EX    IJHA7,IJHACOMP           COMPARE WORKL AND IOAREAL KEYS. 27000000
         BE    IJHACDUP                   IF EQUAL, GO HERE.            27050000
         BH    IJHACBMP                 IF HIGH, GO TO NEXT RECORD.     27100000
         LH    IJHA7,IJHCRESZ           GET LOGICAL RECORD LENGTH.      27150000
         LA    IJHARG6,8(IJHARG4)       GET POINTER TO PHYSICAL         27200000
*                                         RECORD KEY.                   27250000
         EX    0,IJHAISKY               MOVE WORKL KEY TO PHYSICAL      27300000
*                                         RECORD KEY.                   27350000
         L     IJHARG6,IJHADKEY         RESTORE POINTER TO ADD KEYARG.  27400000
         LR    9,IJHARG5                EXCHANGE WORKL AND              27450000
         LR    10,IJHARG3                 IOAREAL RECORDS.              27500000
         BAL   4,IJHAASHF                                               27550000
         LR    4,IJHARG5                GET POINTER TO FIRST            27600000
         AH    4,IJHCKYLC                 BYTE AFTER KEY                27650000
         LH    9,IJHCKYSZ                 IN WORKL.                     27700000
         AR    4,9                                                      27750000
         BCTR  4,0                                                      27800000
IJHAA28  BCTR  4,0                      IF WORKL KEY IS                 27850000
         CLI   0(4),X'FF'                 NOT PADDED,                   27900000
         BNE   IJHACBMP                   BRANCH.                       27950000
         BCT   9,IJHAA28                                                28000000
IJHACPAD BCT   5,IJHAB29                BRANCH IF NOT END OF BLOCK  3-4 28050000
         OI    IJHACSTI,X'01'           SET EOB INDICATOR.              28100000
         EX    0,IJHACTET               IF NOT END OF TRACK,            28150000
         BNE   IJHAA29                    BRANCH.                       28200000
         OI    IJHACSTI,X'02'           SET EOT INDICATOR.              28250000
IJHAA29  BAL   IJHA4,IJHCBLD1           BUILD CCW TO RE-WRITE RECORD.   28300000
         AIF   (NOT &SW(15)).KI1        RPS NOT SPECIFIED      @DL30SMP 28350000
         DC    X'F101' .                SET SECTOR             @DL30SMP 28400000
.KI1     ANOP                                                  @DL30SMP 28450000
         DC    X'8C4B066B'                SIDE, TIC.                    28500000
         DC    X'2AC6'                    WKD.                          28550000
         AIF   (NOT &SW(15)).KI2        RPS NOT SPECIFIED      @DL30SMP 28600000
         DC    X'F111' .                SET SECTOR             @DL30SMP 28650000
.KI2     ANOP                                                  @DL30SMP 28700000
         DC    X'8C4B066B'                SIDE, TIC.                    28750000
         DC    X'AA36'                    VERIFY.                       28800000
         AIF   (NOT &SW(23)).KK                                     3-4 28850000
         AIF   (&SW(24)).KJ             RDONLY SPECIFIED       @DL30SMP 28900000
         MVI   IJHEWORK,X'81'           INDICATE WRITE DATA         3-4 28950000
         MVC   IJHEWORK+1(3),IJHADKEY+5 I/O AREA ADDRESS            3-4 29000000
         AGO   .KK                                                  3-4 29050000
.KJ      ANOP                                                       3-4 29100000
         MVI   44(13),X'81'             INDICATE WRITE DATA         3-4 29150000
         MVC   45(3,13),IJHADKEY+5      I/O AREA ADDRESS            3-4 29200000
.KK      ANOP                                                       3-4 29250000
         BAL   4,IJHAIOOP               EXCP, WAIT, ERROR TEST.         29300000
         BAL   9,IJHACUPP               UPDATE PRIME RECORD COUNT   3-4 29350000
         AIF   (&SW(24)).KL             RDONLY SPEDIFIED       @DL30SMP 29400000
         L     5,IJHASV5                RESTORE RETURN REGISTER     3-4 29450000
         AGO   .KM                                                  3-4 29500000
.KL      ANOP                                                       3-4 29550000
         LR    13,0                     POINT TO SAVE AREA          3-4 29600000
         L     5,68(13)                 RESTORE RETURN REGISTER     3-4 29650000
.KM      ANOP                                                       3-4 29700000
         BR    IJHARG2                  RETURN TO CALLING ROUTINE.      29750000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 29800000
IJHACBMP AH    IJHARG3,IJHCRESZ         GET POINTER TO NEXT RECORD.     29850000
         BCT   5,IJHACLOP               BRANCH IF END OF BLOCK      3-4 29900000
         BAL   IJHA4,IJHCBLD1           BUILD CCW TO RE-WRITE RECORD.   29950000
         AIF   (NOT &SW(15)).KM1        RPS NOT SPECIFIED      @DL30SMP 30000000
         DC    X'F101' .                SET SECTOR             @DL30SMP 30050000
.KM1     ANOP                                                  @DL30SMP 30100000
         DC    X'8C4B066B'                SIDE, TIC.                    30150000
         DC    X'2AC6'                    WKD.                          30200000
         AIF   (NOT &SW(15)).KM2        RPS NOT SPECIFIED      @DL30SMP 30250000
         DC    X'F111' .                SET SECTOR             @DL30SMP 30300000
.KM2     ANOP                                                  @DL30SMP 30350000
         DC    X'8C4B066B'                SIDE, TIC.                    30400000
         DC    X'AA36'                    VERIFY.                       30450000
         AIF   (NOT &SW(23)).KO                                     3-4 30500000
         AIF   (&SW(24)).KN             RDONLY SPECIFIED       @DL30SMP 30550000
         MVI   IJHEWORK,X'81'           INDICATE WRITE DATA         3-4 30600000
         MVC   IJHEWORK+1(3),IJHADKEY+5 I/O AREA ADDRESS            3-4 30650000
         AGO   .KO                                                  3-4 30700000
.KN      ANOP                                                       3-4 30750000
         MVI   44(13),X'81'             INDICATE WRITE DATA         3-4 30800000
         MVC   45(3,13),IJHADKEY+5      I/O AREA ADDRESS            3-4 30850000
.KO      ANOP                                                       3-4 30900000
         BAL   4,IJHAIOOP               EXCP, WAIT, ERROR TEST.         30950000
         AIF   (&SW(24)).KP             RDONLY SPECIFIED       @DL30SMP 31000000
         L     5,IJHASV5                RESTORE RETURN REGISTER     3-4 31050000
         AGO   .KQ                                                  3-4 31100000
.KP      ANOP                                                       3-4 31150000
         LR    13,0                     POINT TO SAVE AREA          3-4 31200000
         L     5,68(13)                 RESTORE RETURN REGISTER     3-4 31250000
.KQ      ANOP                                                       3-4 31300000
         B     4(IJHARG2)               RETURN TO CALLING ROUTINE + 4.  31350000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 31400000
IJHAB29  AH    IJHARG3,IJHCRESZ         GET POINTER TO KEY              31450000
         AH    IJHARG3,IJHCKYLC           OF NEXT LOGICAL RECORD.       31500000
         BCTR  IJHARG3,0                                                31550000
         LR    IJHARG6,IJHARG3                                          31600000
         EX    0,IJHAISKY                                               31650000
         B     IJHAA29                  BRANCH.                         31700000
         AGO   .KX                                                  3-9 31750000
.KR      ANOP                                                       3-9 31800000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 31850000
*NAME: DE-BLOCKING ROUTINE.                                           * 31900000
*FUNCTION: TO INSERT A LOGICAL RECORD INTO A PHYSICAL RECORD, AND TO  * 31950000
*          SHIFT THE REMAINING LOGICAL RECORDS.                       * 32000000
*ENTRY POINTS: 'IJHACDBK'.                                            * 32050000
*INPUT: #1,#11 THRU #13 INITIALIZED.                                  * 32100000
*       FOR OTHER THAN EOF ADD, #14 CONTAINS # RECORDS TO BE READ.    * 32150000
*       #4 IS RETURN REGISTER.                                        * 32200000
*OUTPUT: RECORD INSERTED.                                             * 32250000
*        #2, #3, #11 THRU #13 RESTORED.                               * 32300000
*EXIT: BR 4, RETURN TO CALLING ROUTINE.                               * 32350000
*EXTERNAL ROUTINES: 'IJHAASHF'-EXCHANGE AREAS.                        * 32400000
*                   'IJHAJ29'--CHECK FOR PADDED KEY IN WORKL.         * 32450000
*REGISTER USE  #0 SAVES POINTER TO SAVE AREA (RDONLY)                 * 32500000
*              #1 POINTS TO DTF.                                      * 32550000
*              #2 IS LOADED WITH BLOCKING FACTOR.                     * 32600000
*              #3 POINTS TO LOGICAL RECORD.                           * 32650000
*              #5 SAVES RETURN ADDRESS                                * 32700000
*              #6 NOT USED                                            * 32750000
*              #4, #7 THRU #10 USED AS WORK REGISTERS.                * 32800000
*              #11 (IJHARG4) POINTS TO KEY OF PHYSICAL RECORD.        * 32850000
*              #12 (IJHARG5) POINTS TO WORKL.                         * 32900000
*              #13 USED AS WORK REGISTER.                             * 32950000
*              #14 CONTAINS # RECORDS TO BE READ (OTHER THAN EOF ADD).* 33000000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 33050000
IJHACOMP CLC   0(0,8),0(4)              USED BY AN "EX".                33100000
IJHACDBK EQU   *                                               @DL30SMP 33150000
         AIF   (NOT &SW(15)).KR1                               @DL30SMP 33200000
         ST    6,IJHVTRS               SAVE CONTENTS REG 6     @DL30SMP 33250000
         LR    6,3                     6 PTR DTFIS TBLE 3      @DL30SMP 33300000
.KR1     ANOP                                                  @DL30SMP 33350000
         L     3,IJHAKLN8               GET PTR FIRST LOGICAL  @DL30SMP 33400000
*                                         RECORD.                       33450000
         LA    IJHARG4,8(IJHARG4)       GET POINTER TO KEY OF FIRST     33500000
*                                         PHYSICAL RECORD.              33550000
         AIF   (&SW(24)).KS                                         3-4 33600000
         ST    4,IJHASAV4  SAVE RETURN POINT                        3-3 33650000
         AGO   .KT                                                  3-4 33700000
.KS      ANOP                                                       3-4 33750000
         ST    4,68(13)                 SAVE RETURN REGISTER        3-4 33800000
.KT      ANOP                                                       3-4 33850000
IJHAD29  LH    2,IJHCBFAC               GET BLOCKING FACTOR.            33900000
IJHACLOP LH    9,IJHCKYSZ               GET KEYSIZE -1.                 33950000
         BCTR  9,0                                                      34000000
         LR    8,IJHARG5                GET POINTER TO KEY IN WORKL.    34050000
         AH    8,IJHCKYLC                                               34100000
         BCTR  8,0                                                      34150000
         LR    4,3                      GET POINTER TO KEY OF LOGICAL   34200000
         AH    4,IJHCKYLC                 RECORD.                       34250000
         BCTR  4,0                                                      34300000
         EX    9,IJHACOMP               IF WORKL KEY IS LOWER THAN      34350000
         BL    IJHAC29                    IOAREAL KEY, GO HERE.         34400000
         BE    IJHARS23                FOR DUPLICATE KEYS, GO HERE  3-3 34450000
IJHAE29  AH    3,IJHCRESZ               INCREMENT POINTER TO LOG. REC.  34500000
         BCT   2,IJHACLOP               DECREMENT BLOCKING FACTOR AND   34550000
*                                         LOOP IF NOT EOB.              34600000
         SH    3,IJHCRESZ               DECREMENT POINTER TO LOG. REC.  34650000
         USING IJHPSIZE,9               * ESTABLISH            @DA07584 34700000
         LA    9,16                     * ADDRESSABLITY        @DA07584 34750000
         LNR   9,9                      *PRIME DATA            @DA07584 34800000
         AH    9,IJHCATB3               * IN CORE              @DA07584 34850000
         AR    9,1                      * PARAMETERS           @DA07584 34900000
         LH    14,IJHDCWRK              DECREMENT              @DA07584 34950000
         BCTR  14,0                     RECORDS READ           @DM08104 35000000
         STH   14,IJHDCWRK              BY ONE                 @DA07584 35050000
         DROP  9                                               @DA07584 35100000
         LTR   14,14                         AND BRANCH            3-10 35150000
         BP    IJHAH29                           IF NOT = 0        3-10 35200000
         L     IJHARG6,IJHADKEY         MOVE LAST IOAREAL KEY TO        35250000
         LR    IJHARG5,3                  KEYARG.                       35300000
         BAL   4,IJHAK29                                                35350000
         B     IJHAPRET                 BRANCH TO RETURN.               35400000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 35450000
IJHAH29  AH    3,IJHCABCD+2             BUMP POINTER TO LOGICAL         35500000
         BCTR  3,0                        RECORD BY 8+KEYLEN + LOG.     35550000
         BCTR  3,0                        REC. LENGTH.                  35600000
         AH    IJHARG4,IJHCCMAX         BUMP POINTER TO PHYSICAL        35650000
         B     IJHAD29                    RECORD KEY AND BRANCH.        35700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 35750000
IJHAC29  LR    IJHARG6,IJHARG4          UPDATE PHYSICAL RECORD KEY.     35800000
         BAL   4,IJHAK29                                                35850000
         LR    9,IJHARG5                EXCHANGE IOAREAL & WORKL        35900000
         LR    10,3                       LOGICAL RECORDS.              35950000
         LH    IJHA7,IJHCRESZ                                           36000000
         LR    14,15                   ESTABLISH                   3-10 36050000
         AH    14,IJHSDISP               ADDRESSABILITY            3-10 36100000
         BAL   4,IJHAASHF                                               36150000
         LA    8,IJHAE29                BRANCH HERE FOR UNPADDED        36200000
         BAL   7,IJHAJ29                  KEY IN WORKL.                 36250000
         BCT   2,IJHAB29                FOR NOT EOB, BRANCH.            36300000
         OI    IJHACSTI,X'01'           SET EOB FULL INDICATOR.         36350000
         LH    9,IJHCATB3               GET POINTER TO TABLE #3.        36400000
         AR    9,1                                                      36450000
         TM    IJHAGATE-IJHCTBL3(9),X'01' IF NOT EOF ADD,               36500000
         BZ    IJHAF29                    GO HERE.                      36550000
         CLC   IJHCSADR+7(1),IJHACLTR-IJHCTBL3(9) FOR EOT,              36600000
         BE    IJHAG29                    GO HERE.                      36650000
         B     IJHAPRET                 BRANCH TO RETURN.               36700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 36750000
* * * * * * * FOR WORKL KEY = X'FF', BR 7. FOR NOT =, BR 8. * * * * * * 36800000
IJHAJ29  LH    9,IJHCKYSZ               GET KEYSIZE.                    36850000
         LR    4,IJHARG5                GET POINTER TO JUST AFTER KEY   36900000
         AH    4,IJHCKYLC                 IN WORKL.                     36950000
         AR    4,9                                                      37000000
         BCTR  4,0                                                      37050000
IJHAA28  BCTR  4,0                      IF WORKL KEY IS                 37100000
         CLI   0(4),X'FF'                 NOT PADDED,                   37150000
         BCR   7,8                        GO HERE.                      37200000
         BCT   9,IJHAA28                                                37250000
         BR    7                        IF PADDED, GO HERE.             37300000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 37350000
IJHAF29  SH    IJHARG4,IJHAPH8          GET POINTER TO LAST             37400000
*                                         PHYSICAL RECORD COUNT.        37450000
         CLC   4(1,IJHARG4),IJHACLTR-IJHCTBL3(9) FOR NOT EOT,           37500000
         BNE   IJHAPRET                   BRANCH TO RETURN.             37550000
IJHAG29  OI    IJHACSTI,X'02'           SET EOT INDICATOR.              37600000
         B     IJHAPRET                 BRANCH TO RETURN.               37650000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 37700000
IJHAB29  AH    3,IJHCKYLC               GET POINTER TO KEY IN NEXT      37750000
         BCTR  3,0                        LOGICAL RECORD, AND PAD       37800000
         AH    3,IJHCRESZ                 WITH X'FF'.                   37850000
         LR    13,3                                                     37900000
         BAL   4,IJHAK29                                                37950000
IJHAPRET BAL   4,IJHCINIT               RESTORE REGISTERS #2,#3,        38000000
         AIF   (NOT &SW(15)).KT1                               @DL30SMP 38050000
         L     6,IJHVTRS               RESTORE REG 6           @DL30SMP 38100000
.KT1     ANOP                                                  @DL30SMP 38150000
         LM    IJHARG4,IJHARG6,IJHAARAD   AND 'IJHARG4' TO 'IJHARG6'.   38200000
         AIF   (&SW(24)).KU                                         3-4 38250000
         L     4,IJHASAV4  RETURN TO CALLING ROUTINE                3-3 38300000
         AGO   .KV                                                  3-4 38350000
.KU      ANOP                                                       3-4 38400000
         LR    13,0                     POINT TO SAVE AREA          3-4 38450000
         L     4,68(13)                 RESTORE RETURN REGISTER     3-4 38500000
         L     IJHARG6,IJHADKEY         POINTER TO KEYARG           3-4 38550000
.KV      ANOP                                                       3-4 38600000
         BR    4                                                        38650000
         AIF   (&SW(24)).KW                                         3-4 38700000
IJHASAV4 DS    F                                                    3-3 38750000
.KW      ANOP                                                       3-4 38800000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 38850000
IJHAK29  LH    9,IJHCATB3               GET POINTER TO TABLE #3.        38900000
         AR    9,1                                                      38950000
         EX    0,IJHAISKY-IJHCTBL3(9)   EXECUTE 'IJHAISKY'.             39000000
         BR    4                        RETURN TO CALLING ROUTINE.      39050000
.KX      ANOP                                                       3-9 39100000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 39150000
*NAME: NORMAL ADDITION TO OVERFLOW TRACK.                             * 39200000
*FUNCTION: TO ADD AN ENTRY TO THE OVERFLOW AREA, AND TO MAKE          * 39250000
*          ASSOCIATED INDEX & SEQUENCE LINK UPDATES.                  * 39300000
*ENTRY POINT: 'IJHAOBEG'.                                             * 39350000
*INPUT: WORKL AREA CONTAINS OVERFLOW RECORD (KEY + DATA) TO BE ADDED. * 39400000
*       'IJHARG4'(#11) POINTS TO IOAREAL.                             * 39450000
*       'IJHARG5'(#12) POINTS TO WORKL.                               * 39500000
*       'IJHAOADR' CONTAINS LAST OVERFLOW RECORD ADDRESS.             * 39550000
*       'IJHAOMBB' CONTAINS NEW OVERFLOW RECORD ADDRESS.              * 39600000
*       'IJHACTIA' POINTS TO START OF TRACK ADDRESS.                  * 39650000
*       'IJHACOCR' CONTAINS UPDATED COCR.                             * 39700000
*       'IJHACTNA' POINTS TO OVERFLOW TRACK INDEX ENTRY.              * 39750000
*       'IJHCSADR' POINTS TO FIRST RECORD IN OVERFLOW CHAIN.          * 39800000
*OUTPUT: OVERFLOW RECORD WRITTEN.                                     * 39850000
*        COCR RE-WRITTEN.                                             * 39900000
*        OVERFLOW INDEX ENTRY UPDATED (NO PREVIOUS OVERFLOW RECORDS), * 39950000
*          OR PREVIOUS LOW OVERFLOW RECORD SEQUENCE LINK UPDATED.     * 40000000
*EXIT: NORMAL--B IJHSER2, RETURN TO USER.                             * 40050000
*      DUPLICATE RECORD--BE IJHACDUP, RETURN TO USER.                 * 40100000
*EXTERNAL ROUTINES: 'IJHAOMCO'--GET NEW OVERFLOW RECORD ADDRESS.      * 40150000
*                   'IJHCBLD1'--CCW BUILDER.                          * 40200000
*                   'IJHAIOOP'--EXCP, WAIT, ERROR TEST.               * 40250000
*                   'IJHAOSQU'--WRITE NEW OVERFLOW RECORD.            * 40300000
