         MACRO                                                          00050000
&WTON    WTOR123 &MESSAGE,&RADDRES,&RLENGTH,&EADDRES,                  X00100061
               &ROUTCDE=,&DESC=,&MF=                           @D53CDFG 00150061
.*##################################################################### 00200000
.*###############               ####################################### 00250000
.*###############  DECLARATION  ########## VERSION: 21.03.1990 10.00 H# 00300000
.*###############               ####################################### 00350000
.*##################################################################### 00400000
         LCLA  &BT           BIT NUMBER                                 00450000
         LCLA  &BALVAR       OFFSET FOR THE DC-BLOCK                    00500000
         LCLA  &BLCKLEN      WTO/WTOR BLOCK LENGTH                      00550000
         LCLA  &BLENLEN      WTO/WTOR BLOCK LENGTH STORAGE (BYTE)       00600000
         LCLA  &CHARLEN      LENGTH OF A VALID MESSAGE LINE             00650000
         LCLA  &CHARNR       POINTER TO THE ACTUELL CHARACTER IN A      00700000
.*                           MESSAGE                                    00750000
         LCLA  &COUNT        NUMBER OF MESSAGE LINES                    00800000
         LCLA  &DEFROUT      DEFAULT ROUTING CODE                       00850000
         LCLA  &DEFDESC      DEFAULT DESCRIPTOR CODE                    00900000
         LCLA  &DESCL        DESCRIPTOR CODE STORAGE (BYTE)             00950000
         LCLA  &INSTBAL      LENGTH OF BAL-INSTRUCTION                  01000000
         LCLA  &IOOFF        I/O OFFSET (BYTE)                          01050000
         LCLA  &IOOFFL       I/O OFFSET STORAGE (BYTE)                  01100000
         LCLA  &LINETYP      LINE TYPE                                  01150000
         LCLA  &LTP          LINE TYPE STORAGE (BYTE)                   01200000
         LCLA  &MAXPARA      MAXIMUM NUMBER OF PARAMETER                01250000
         LCLA  &MAXROUT      HIGHEST ROUTING CODE                       01300000
         LCLA  &MINROUT      LOWEST ROUTING CODE                        01350000
         LCLA  &MLINLEN      MAXIMAL LENGHT OF THE ACTUELL MESSAGE LINE 01400000
         LCLA  &NR           MESSAGE NUMBER                             01450000
         LCLA  &OFFSET       OFFSET FOR "ST" COMMAND                    01500000
         LCLA  &RCDE         ROUTING CODE STORAGE (BYTE)                01550000
         LCLA  &RCDELEN      ROUTING CODE LENGTH                        01600000
         LCLA  &RLINLEN      REAL MESSAGE-LINE LENGTH                   01650000
         LCLA  &ROUTNR       ROUTING CODE NUMBER                        01700000
         LCLA  &RPLYADL      REPLY ADDRESS STORAGE (BYTE)               01750000
         LCLA  &RPLYCON      REPLY CONSTANTS STORAGE (BYTE)             01800000
         LCLA  &RPLYLEL      REPLY LENGTH STORAGE (BYTE)                01850000
         LCLA  &RPLYMAX      MAXIMAL VALID REPLY LENGTH                 01900000
         LCLA  &SCHR(10)     NUMBER OF SPEZIAL CHARACTERS (' OR &)      01950000
.*                           IN ONE MESSAGE                             02000000
         LCLA  &TLEN         TEXT LENGTH STORAGE                        02050000
.*                                                                      02100000
         LCLB  &DC(16)       2 BYTE DESCRIPTOR CODE ARRAY               02150000
         LCLB  &ERRFLG       ERROR FLAG                                 02200000
         LCLB  &MFEFLG       EXECUTE-FORM-FLAG                          02250000
         LCLB  &MFLFLG       LIST-FORM-FLAGG CODE                       02300000
         LCLB  &RC(16)       2 BYTE ROUTING CODE ARRAY                  02350000
.*                                                                      02400000
         LCLC  &CHRBOUN      LOWER BOUNDERY FOR NON PRINTABLE CHARACTER 02450000
         LCLC  &CHARSTR      VALID MESSAGE STRING WITH PRINTABLE        02500000
.*                           CHARACTERS                                 02550000
         LCLC  &ECBADR       OPERAND FOR ECB-ADDRESS "ST" COMMAND       02600000
         LCLC  &MSG(10)      ARRAY WHICH CONTAINS THE VALID MESSAGES    02650000
         LCLC  &REGNR        REGISTER NUMBER                            02700000
         LCLC  &RPLYADR      OPERAND FOR REPLY-ADDRESS "ST" COMMAND     02750000
         LCLC  &RPLYLEN      OPERAND FOR REPLY-LENGTH "ST" COMMAND      02800000
         LCLC  &VALDMSG      CONTAINS MESSAGE IF MESSAGE IS VALID       02850000
.********************************************************************** 02900000
.*       IBM DISK OPERATING SYSTEM                                      02950000
.*       SUPERVISOR - WTOR - 5686-032-09-C56                            03000000
         AGO   .NOCOPY                                                  03050000
*        THIS MACRO IS "RESTRICTED MATERIALS OF IBM"                    03100000
*        5686-007 (C) COPYRIGHT IBM CORP. 1979,1989                     03150000
*        ALL RIGHTS RESERVED                                            03200000
*        LICENSED MATERIALS-PROPERTY OF IBM                             03250000
*        SEE COPYRIGHT INSTRUCTIONS, G120-2083                          03300000
************************************** ******************************** 03350000
*                                                                       03400000
* MACRO NAME:             *****************                             03450000
*                         * ############# *                             03500000
*                         * #           # *                             03550000
*                         * #  W T O R  # *                             03600000
*                         * #           # *                             03650000
*                         * ############# *                             03700000
*                         *****************                             03750000
*                                                                       03800000
*                                                                       03850000
* FUNCTION:   THE WTOR MACRO INSTRUCTION CAUSES A MESSAGE REQUIRING     03900000
*             AN REPLY TO BE WRITTEN TO ONE OR MORE OPERATOR CONSOLES   03950000
*             THE NECESSARY INFORMATION FOR THE REPLY IS PROVIDED BY    04000000
*             THE USER                                                  04050000
*                                                                       04100000
* SYNTAX:                                                               04150000
*                                                                       04200000
*             NAME       OPTIONAL         (LABEL-NAME)                  04250000
*             WTOR       MANDATORY        (MACRO-NAME)                  04300000
*             MESSAGE    MANDATORY        (ONE MESSAGE)                 04350000
*             RADDRES    MANDATORY        (REPLY ADDRESS)               04400000
*             RLENGTH    MANDATORY        (REPLY MESSAGE LENGTH)        04450000
*             EADDRES    MANDATORY        (ECB ADDRESS)                 04500000
*             ROUTCDE=   OPTIONAL         (ROUTING CODE, DEFAULT=2,     04550000
*                                          MASTER CONSOLE INFORMATION)  04600000
*             DESC=      IGNORED          (DESCRIPTOR CODE DEFAULT=7,   04650000
*                                          APPLICATION                  04700000
*                                          PROGRAM/PROCESSOR)           04750000
*             MF=        OPTIONAL         (MACRO-FORM, DEFAULT=NORMAL)  04800000
*                                                                       04850000
*                                                                       04900000
* VARIABLES: ARITHMETIC                                                 04950000
*                                                                       05000000
*             &BT                BIT NUMBER IN ROUTING AND DESCRIPTION  05050000
*                                CODE                                   05100000
*             &BALVAR            OFFSET FOR DC-BLOCK                    05150000
*             &BLCKLEN           WTO/WTOR BLOCK LENGTH                  05200000
*             &BLENLEN           WTO/WTOR BLOCK LENGTH STORAGE (BYTE)   05250000
*             &CHARLEN           LENGTH OF A VALID MESSAGE LINE         05300000
*             &CHARNR            POINTER TO THE ACTUELL CHARACTER IN A  05350000
*                                MESSAGE                                05400000
*             &COUNT             COUNTS NUMBER OF MESSAGE LINES         05450000
*             &DEFROUT           DEFAULT ROUTING CODE                   05500000
*             &DEFDESC           DEFAULT DESCRIPTOR CODE                05550000
*             &INSTBAL           LENGTH OF BAL-INSTRUCTION (4 BYTE)     05600000
*             &IOOFF             I/O OFFSET IN BYTE                     05650000
*             &IOOFFL            STORAGE FOR I/O OFFSET (2 BYTE)        05700000
*             &LINETYP           CODED LINETYP, VALUES ARE:             05750000
*                                 X'80'       SINGLE LINE MSG           05800000
*                                 X'8X'       INVALID                   05850000
*                                 X'4X'       "C"-LINE, REST X-LINES    05900000
*                                 X'3X'       "L"-LINE, REST X-LINES    05950000
*                                 X'2X'       "D"-LINE, REST X-LINES    06000000
*                                 X'1X'       "DE"-LINE, REST X-LINES   06050000
*                                 X'XX'       RESERVED FOR LATER USE    06100000
*                                THE FIRST DIGIT SPEZIFIES THE LINE     06150000
*                                TYPE AND THE SECOND SPEZIFIES HOW      06200000
*                                MUCH MESSAGE LINES ARE FOLLOWING       06250000
*                                IN WTOR MACRO IS ONLY X'80' POSSIBLE   06300000
*             &LTP               STORAGE FOR LINETYPE (1 BYTE)          06350000
*             &MAXROUT           HIGHEST ROUTING CODE                   06400000
*             &MAXPARA           MAXIMUM NUMBER OF PARAMETER            06450000
*             &MINROUT           LOWEST ROUTING CODE                    06500000
*             &MLINLEN           MAXIMAL LENGHT OF THE ACTUELL MESSAGE  06550000
*             &NR                MESSAGE NUMBER                         06600000
*             &OFFSET            OFFSET FOR "ST" COMMAND                06650000
*             &RCDE              STORAGE FOR ROUTING CODE (2 BYTE)      06700000
*             &RCDELEN           ROUTING CODE LENGTH                    06750000
*             &RLINLEN           REAL LENGHT OF THE ACTUELL MESSAGE     06800000
*             &ROUTNR            ROUTING CODE NUMBER                    06850000
*                                WHICH ARE SUPPRESSED BY THE ASSEMBLER  06900000
*             &RPLYADL           REPLY ADDRESS STORAGE (BYTE)           06950000
*             &RPLYCON           REPLY CONSTANTS STORAGE (BYTE)         07000000
*                                REPLY-ADDRESS (4 BYTE), REPLY-LENGTH   07050000
*                                (2 BYTE), ECB-ADDRESS (4 BYTE)         07100000
*             &RPLYLEL           REPLY LENGTH STORAGE (BYTE)            07150000
*             &RPLYMAX           MAXIMAL VALID REPLY LENGTH             07200000
*             &SCHR(10)          NUMBER OF SPEZIAL CHARACTERS (' OR &)  07250000
*                                IN ONE MESSAGE WHICH ARE SUPPRESSED    07300000
*                                BY THE ASSEMBLER                       07350000
*             &TLEN              STORAGE FOR TEXT LENGTH (2 BYTE)       07400000
*                                                                       07450000
*            BOOLEAN                                                    07500000
*                                                                       07550000
*             &DC                DESCRIPTOR CODE, 2 BYTE DESCRIPTION    07600000
*             &ERRFLG            FLAG ("1" IF AN ERROR HAS OCCURED      07650000
*                                AND NO DATA BLOCK SHOULD BE GENERATED  07700000
*             &MFEFLG            FLAG ("1" IF EXECUTEFORM IS REQUIRED)  07750000
*             &MFLFLG            FLAG ("1" IF LISTFORM IS REQUIRED)     07800000
*             &RC                ROUTING CODE, 2 BYTE DESCRIPTION       07850000
*                                                                       07900000
*            CHARACTER                                                  07950000
*                                                                       08000000
*             &CHRBOUN           LOWER BOUNDERY FOR NON PRINTABLE       08050000
*                                CHARACTER                              08100000
*             &CHARSTR           VALID MESSAGE STRING WITH PRINTABLE    08150000
*                                CHARACTERS                             08200000
*             &ECBADR            OPERAND FOR ECB-ADDRESS                08250000
*             &MSG(10)           ARRAY CONTAINING THE VALID MESSAGES    08300000
*             &REGNR             REGISTER WHICH CONTAINS THE MESSAGE-   08350000
*                                TABLE POINTER                          08400000
*             &RPLYADR           OPERAND FOR REPLY-ADDRESS              08450000
*             &RPLYLEN           OPERAND FOR REPLY-LENGTH               08500000
*             &VALDMSG           CONTAINS MESSAGE IF MESSAGE IS VALID   08550000
*                                                                       08600000
* OPERATION: 1- DECLARATION                                             08650000
*            2- INITIALISATION                                          08700000
*            3- CHECK IF LIST OR EXECUTE FORM IS REQUIRED               08750000
*            4- CHECK IF VALID MESSAGE                                  08800000
*            5- CHECK SINGLE LINE MESSAGE BEGIN                         08850000
*            6- CHECK MESSAGE LENGTH                                    08900000
*            7- CHECK CHARACTERS                                        08950000
*            8- CHECK REPLY ADDRESS                                     09000000
*            9- CHECK REPLY LENGTH                                      09050000
*           10- CHECK ECB ADDRESS                                       09100000
*           11- CHECK IF THERE IS ANOTHER MESSAGE LINE                  09150000
*           12- CHECK IF VALID ROUTING CODE                             09200000
*           13- CHECK DESCRIPTOR CODE                                   09250000
*           14- STORE MESSAGE                                           09300000
*           15- SUPERVISOR CALL                                         09350000
*                                                                       09400000
* SPECIAL HINTS:                                                        09450000
*                                                                       09500000
*            1- THE MAXIMAL NUMBER OF ALLOWED MESSAGE LINES IS 1        09550000
*                                                                       09600000
*            2- THE MAXIMAL REPLY LENGTH IS 115 (&RPLYMAX)              09650000
*                                                                       09700000
*            3- USED REGISTERS (NORMAL/LIST FORM)                       09750000
*                       0      FUNKTIONCODE                             09800000
*                       1      PARAMETERBLOCK BEGIN                     09850000
*                      15      RETURNCODE                               09900000
*                                                                       09950000
*                                                                       10000000
* STORAGE LAYOUT FOR THE SUPERVISOR:                                    10050000
*                                                                       10100000
*|BLK-LEN|ROUTCDE|DESC|I/O-OFF|L-TYP|MSGLEN| MSG |R-ADR|R-LEN |ECB-ADR| 10150000
*|-------|-------|----|-------|-----|------|- ---|-----|------|-------| 10200000
*|   2   |   2   | 2  |   2   |  1  |   2  |  X  |  4  |   2  |   4   | 10250000
*                                                                       10300000
*********************************************************************** 10350000
.*                                                                      10400000
.*                                                                      10450000
.*                                                                      10500000
.NOCOPY  ANOP                                                           10550000
.*##################################################################### 10600000
.*################                 #################################### 10650000
.*################ INITIALISATION  #################################### 10700000
.*################                 #################################### 10750000
.*##################################################################### 10800000
&BT      SETA  0             BIT NUMBER                                 10850000
&BALVAR  SETA  0             OFFSET FOR THE DC-BLOCK                    10900000
&BLCKLEN SETA  0             WTO/WTOR BLOCK LENGTH                      10950000
&BLENLEN SETA  2             WTO/WTOR BLOCK LENGTH STORAGE (BYTE)       11000000
&CHARLEN SETA  0             LENGTH OF A VALID MESSAGE LINE             11050000
&CHARNR  SETA  0             POINTER TO THE ACTUELL CHARACTER IN A      11100000
.*                           MESSAGE                                    11150000
&COUNT   SETA  0             NUMBER OF MESSAGE LINES                    11200000
&DEFROUT SETA  2             DEFAULT ROUTING CODE                       11250000
&DEFDESC SETA  7             DEFAULT DESCRIPTOR CODE                    11300000
&DESCL   SETA  2             DESCRIPTOR CODE STORAGE (BYTE)             11350000
&INSTBAL SETA  4             LENGTH OF BAL-INSTRUCTIN IN BYTE           11400000
&IOOFF   SETA  0             I/O OFFSET (BYTE)                          11450000
&IOOFFL  SETA  2             I/O OFFSET STORAGE (BYTE)                  11500000
&LINETYP SETA  0             LINE TYPE                                  11550000
&LTP     SETA  1             LINE TYPE STORAGE (BYTE)                   11600000
&MAXROUT SETA  16            HIGHEST ROUTING CODE                       11650000
&MAXPARA SETA  4             MAXIMUM NUMBER OF PARAMETER                11700000
&MINROUT SETA  1             LOWEST ROUTING CODE                        11750000
&MLINLEN SETA  122           MAXIMAL LENGTH OF THE ACTUELL MESSAGE      11800000
&NR      SETA  1             MESSAGE NUMBER                             11850000
&OFFSET  SETA  10            OFFSET FOR "ST" COMMAND                    11900000
&RCDE    SETA  2             ROUTING CODE STORAGE (BYTE)                11950000
&RCDELEN SETA  0             ROUTING CODE LENGTH                        12000000
&RLINLEN SETA  0             REAL MESSAGE LINE LENGTH                   12050000
&ROUTNR  SETA  1             ROUTING CODE NUMBER                        12100000
&RPLYADL SETA  4             REPLY ADDRESS STORAGE (BYTE)               12150000
&RPLYCON SETA  10            REPLY CONSTANTS STORAGE (BYTE)             12200000
&RPLYLEL SETA  2             REPLY LENGTH STORAGE (BYTE)                12250000
&RPLYMAX SETA  115           MAXIMAL VALID REPLY LENGTH                 12300000
&TLEN    SETA  2             TEXT LENGTH STORAGE                        12350000
.*                                                                      12400000
&ERRFLG  SETB  0             ERROR FLAG                                 12450000
&MFEFLG  SETB  0             EXECUTE-FORM-FLAG                          12500000
&MFLFLG  SETB  0             LIST-FORM-FLAGG CODE                       12550000
.*                                                                      12600000
&CHRBOUN SETC  ' '           LOWER BOUNDERY FOR NON PRINTABLE CHARACTER 12650000
&CHARSTR SETC  ''            VALID MESSAGE STRING WITH PRINTABLE        12700000
.*                           CHARACTERS                                 12750000
&ECBADR  SETC  ''            OPERAND FOR ECB-ADDRESS                    12800000
&REGNR   SETC  ''            REGISTER NUMBER                            12850000
&RPLYADR SETC  ''            OPERAND FOR REPLY-ADDRESS "ST" COMMAND     12900000
&RPLYLEN SETC  ''            OPERAND FOR REPLY-LENGTH "ST" COMMAND      12950000
&VALDMSG SETC  ''            CONTAINS MESSAGE IF MESSAGE IS VALID       13000000
.*                                                                      13050000
.*--------------------------- SET POINTER TO STORAGE POSITION OF ------ 13100000
.*--------------------------- FIRST LINETYPE -------------------------- 13150000
&BALVAR  SETA  &INSTBAL+&BLENLEN+&RCDE+&DESCL+&IOOFFL+&RPLYCON          13200000
.*##################################################################### 13250000
.*###############                                            ########## 13300000
.*###############  CHECK IF LIST OR EXECUTE FORM IS REQUIRED ########## 13350000
.*###############                                            ########## 13400000
.*##################################################################### 13450000
.MFCHECK ANOP                                                           13500000
.*--------------------------- CHECK IF MF IS OMITTED ------------------ 13550000
         AIF   (T'&MF(1) EQ 'O').NAMEOK                                 13600000
.*--------------------------- CHECK IF LISTFORM WAS SPECIFIED --------- 13650000
         AIF   ((N'&MF EQ 1) AND ('&MF' EQ 'L')).LSTFORM                13700000
&MFEFLG  SETB  1                                                        13750000
.*--------------------------- CHECK IF EXECUTE FORM WAS SPECIFIED ----- 13800000
         AIF   ( ('&MF'(1,3) EQ '(E,' )                                X13850000
                 AND                                                   X13900000
                 ('&MF'(K'&MF,1) EQ ')' )       ).CNT1CHK               13950000
         AGO   .WRGSYNT                                                 14000000
.CNT1CHK ANOP                                                           14050000
         AIF     (N'&MF EQ 2).MFEOK                                     14100000
.WRGSYNT MNOTE 16,'ERROR - INVALID SYNTAX IN MF-PARAMETER'              14150000
&ERRFLG  SETB  1                                                        14200000
         AGO   .NAMEOK                                                  14250000
.MFEOK   ANOP                                                           14300000
.*--------------------------- CHECK IF NOT MORE THAN ONE MESSAGE ------ 14350000
.*--------------------------- SPECIFIED ------------------------------- 14400000
         AIF   (N'&SYSLIST GT &MAXPARA).MOREMSG                         14450000
.*--------------------------- CHECK EXECUTE FORM SYNTAX --------------- 14500000
         AIF   (T'&MESSAGE EQ 'O').CHKRNR                               14550000
         MNOTE 4,'WARNING - EXECUTE FORM SPECIFIED; ALL MESSAGES IGNOREX14600000
               D'                                                       14650000
.CHKRNR  AIF   (N'&ROUTCDE EQ 0).CHKDNR                                 14700000
         MNOTE 4,'WARNING - EXECUTE FORM SPECIFIED; ALL ROUTING CODES IX14750000
               GNORED'                                                  14800000
.CHKDNR  AIF   (N'&DESC EQ 0).ADRORRE                                   14850000
         MNOTE 4,'WARNING - EXECUTE FORM SPECIFIED; ALL DESCRIPTOR CODEX14900000
               S IGNORED'                                               14950000
.ADRORRE ANOP                                                           15000000
.*--------------------------- CHECK IF LABEL WAS SPECIFIED ------------ 15050000
         AIF   (T'&WTON EQ 'O').NOLAB                                   15100000
.*--------------------------- WRITE LABEL ----------------------------- 15150000
&WTON    DS    0H                                                       15200000
.NOLAB   ANOP                                                           15250000
.*--------------------------- CHECK IF REGISTER WAS SPECIFIED --------- 15300000
         AIF   ( ( '&MF(2)'(1,1) EQ '(' )                              X15350000
                 AND                                                   X15400000
                 ( '&MF(2)'(K'&MF(2),1) EQ ')' )              ).REGISTR 15450000
         AGO   .ADDRESS                                                 15500000
.REGISTR ANOP                                                           15550000
.*--------------------------- REGISTER SPECIFIED ---------------------- 15600000
&REGNR   SETC  '&MF(2)'(2,K'&MF(2)-2)                                   15650000
.*--------------------------- CHECK IF REGISTER 1 WAS SPECIFIED ------- 15700000
         AIF   ('&REGNR' EQ '1').EXADR                                  15750000
.*--------------------------- REGISTER 1 WAS NOT SPECIFIED ------------ 15800000
.*--------------------------- SAVE POINTER IN REGISTER ---------------- 15850000
         LR    (1),&MF(2)                       * POINTER TO LISTBLOCK* 15900000
         AGO   .EXADR                                                   15950000
.ADDRESS ANOP                                                           16000000
.*--------------------------- ADDRESS SPECIFIED ----------------------- 16050000
.*--------------------------- SAVE POINTER IN REGISTER ---------------- 16100000
         LA    (1),&MF(2)                       * POINTER TO LISTBLOCK* 16150000
         AGO   .EXADR                                                   16200000
.LSTFORM ANOP                                                           16250000
&MFLFLG  SETB  1                                                        16300000
.*##################################################################### 16350000
.*###############                          ############################ 16400000
.*###############  CHECK IF VALID MESSAGE  ############################ 16450000
.*###############                          ############################ 16500000
.*##################################################################### 16550000
.NAMEOK  ANOP                                                           16600000
.*--------------------------- CHECK IF MESSAGE WAS SPECIFIED ---------- 16650000
.*--------------------------- AND NO NULL-STRING <''> ----------------- 16700000
         AIF   ( (T'&MESSAGE NE 'O')                                   X16750000
                 AND                                                   X16800000
                 (K'&MESSAGE GT 2)                            ).TEXTOK  16850000
         MNOTE 16,'ERROR - SYNTAX ERROR IN MESSAGE-LINE'                16900000
&ERRFLG  SETB  1                                                        16950000
         AGO .LOOKNXT                                                   17000000
.*##################################################################### 17050000
.*###############                                   ################### 17100000
.*###############  CHECK SINGLE LINE MESSAGE BEGIN  ################### 17150000
.*###############                                   ################### 17200000
.*##################################################################### 17250000
.TEXTOK  ANOP                                                           17300000
.*--------------------------- CHECK IF VALID SINGLE LINE MESSAGE BEGIN  17350000
         AIF   ('&MESSAGE'(1,1) EQ '''').MSG                            17400000
         MNOTE 16,'ERROR - INVALID FIRST CHAR IN MESSAGE-LINE'          17450000
&ERRFLG  SETB  1                                                        17500000
         AGO .LOOKNXT                                                   17550000
.MSG     ANOP                                                           17600000
&LINETYP SETA  80                                                       17650000
.*##################################################################### 17700000
.*###############                    ################################## 17750000
.*###############  CHECK CHARACTERS  ################################## 17800000
.*###############                    ################################## 17850000
.*##################################################################### 17900000
.MSGOK   ANOP                                                           17950000
&VALDMSG SETC  '&MESSAGE'(2,K'&MESSAGE-2)                               18000000
&CHARLEN SETA  K'&MESSAGE-2                                             18050000
&CHARNR  SETA  1                                                        18100000
&CHARSTR SETC  ''                                                       18150000
.CHKNXT  ANOP                                                           18200000
.*--------------------------- CHECK IF CHARACTER IS PRINTABLE --------  18250000
         AIF   ('&VALDMSG'(&CHARNR,1) GT '&CHRBOUN').CHAROK             18300000
.*--------------------------- REPLACE NON PRINTABLE CHARACTER BY BLANK  18350000
&CHARSTR SETC  '&CHARSTR'.' '                                           18400000
         AGO   .STROK                                                   18450000
.CHAROK  ANOP                                                           18500000
.*--------------------------- CHECK IF CHARACTER IS NOT EQUAL ' ------  18550000
         AIF   ('&VALDMSG'(&CHARNR,1) NE '''').CHKAMP                   18600000
.*--------------------------- CHARACTER = ' --------------------------  18650000
&CHARSTR SETC  '&CHARSTR'.'&VALDMSG'(&CHARNR,1)                         18700000
&CHARNR  SETA  &CHARNR+1                                                18750000
.*--------------------------- INCREMENT SPEZIAL CHARACTERV COUNT -----  18800000
&SCHR(&NR) SETA  &SCHR(&NR)+1                                           18850000
.*--------------------------- CHECK IF NEXT CHARACTER EQUAL ' --------  18900000
         AIF   ('&VALDMSG'(&CHARNR,1) EQ '''').CONSTR                   18950000
         MNOTE 16,'ERROR - INVALID MESSAGE TEXT IN MESSAGE LINE'        19000000
&ERRFLG  SETB  1                                                        19050000
         AGO   .LOOKNXT                                                 19100000
.CHKAMP  ANOP                                                           19150000
.*--------------------------- CHECK IF CHARACTER IS NOT EQUAL & ------- 19200000
         AIF   ('&VALDMSG'(&CHARNR,1) NE '&&'(1,1)).CONSTR              19250000
.*--------------------------- CHARACTER = & --------------------------- 19300000
&CHARSTR SETC  '&CHARSTR'.'&VALDMSG'(&CHARNR,1)                         19350000
&CHARNR  SETA  &CHARNR+1                                                19400000
.*--------------------------- CHECK IF NEXT CHARACTER IS NOT EQUAL & -- 19450000
.*--------------------------- => VARIABLE WAS SPECIFIED --------------- 19500000
         AIF   ('&VALDMSG'(&CHARNR,1) NE '&&'(1,1)).CHKLOOP             19550000
.*--------------------------- INCREMENT SPEZIAL CHARACTER COUNT ------- 19600000
&SCHR(&NR) SETA  &SCHR(&NR)+1                                           19650000
.CONSTR  ANOP                                                           19700000
&CHARSTR SETC  '&CHARSTR'.'&VALDMSG'(&CHARNR,1)                         19750000
.STROK   ANOP                                                           19800000
&CHARNR  SETA  &CHARNR+1                                                19850000
.CHKLOOP ANOP                                                           19900000
.*--------------------------- IS THERE ANOTHER CHARACTER TO BE CHECKED? 19950000
         AIF   (&CHARNR LE &CHARLEN).CHKNXT                             20000000
&MSG(&NR) SETC  '&CHARSTR'                                              20050000
.*##################################################################### 20100000
.*###############                        ############################## 20150000
.*###############  CHECK MESSAGE LENGTH  ############################## 20200000
.*###############                        ############################## 20250000
.*##################################################################### 20300000
.*--------------------------- CHECK IF MESSAGE LENGTH LESS THAN LIMIT - 20350000
         AIF   ((K'&SYSLIST(&NR,1)-2-&SCHR(&NR)) LE &MLINLEN).ANOTHER   20400000
         MNOTE 16,'ERROR - MESSAGE-LINE EXEEDS &MLINLEN CHARACTER LIMITX20450000
               '                                                        20500000
&ERRFLG  SETB  1                                                        20550000
         AGO   .LOOKNXT                                                 20600000
.ANOTHER ANOP                                                           20650000
.*--------------------------- SET POINTER TO STORAGE LOCATION OF ------ 20700000
.*--------------------------- NEXT MESSAGE LINETYPE ------------------- 20750000
&BALVAR  SETA  &BALVAR+&LTP+&TLEN+&CHARLEN-&SCHR(&NR)                   20800000
.LOOKNXT ANOP                                                           20850000
&NR      SETA  &NR+1                                                    20900000
.*--------------------------- INCREMENT VALID MSG-LINE COUNT ---------- 20950000
&COUNT   SETA  &COUNT+1                                                 21000000
.*##################################################################### 21050000
.*###############                       ############################### 21100000
.*###############  CHECK REPLY ADDRESS  ############################### 21150000
.*###############                       ############################### 21200000
.*##################################################################### 21250000
.EXADR   ANOP                                                           21300000
.*--------------------------- CHECK IF EXECUTE FORM IS NOT SPECIFIED -- 21350000
         AIF   (&MFEFLG EQ 0).NOEXADR                                   21400000
.*--------------------------- CHECK IF REPLY ADDRESS, LENGTH AND ------ 21450000
.*--------------------------- ECB ADDRESS ARE OMITTED ----------------- 21500000
         AIF   ( (T'&RADDRES NE 'O')                                   X21550000
                 OR                                                    X21600000
                 (T'&RLENGTH NE 'O')                        ).NOTOMIT   21650000
         AIF   (T'&EADDRES EQ 'O').MOREMSG                              21700000
.NOTOMIT ANOP                                                           21750000
.*--------------------------- LOAD POINTER TO I/O OFFSET -------------- 21800000
         LA    (15),6(0,1)                      * I/O OFFSET POINTER  * 21850000
.*--------------------------- POINTER TO REPLY ADDRESS ---------------- 21900000
         AH    (15),0(0,15)                     * RPLY ADDRESS POINTER* 21950000
.*--------------------------- CHECK IF REPLY ADDRESS OMITTED ---------- 22000000
         AIF   (T'&RADDRES EQ 'O').EXLEN                                22050000
.*--------------------------- CHECK IF REGISTER WAS SPECIFIED --------- 22100000
         AIF   ( ('&RADDRES'(1,1) EQ '(' )                             X22150000
                 AND                                                   X22200000
                 ('&RADDRES'(K'&RADDRES,1) EQ ')' ) ).EXADREG           22250000
.*--------------------------- ADDRESS SPECIFIED ----------------------- 22300000
         LA    (0),&RADDRES                     * LOAD RPLY ADDR      * 22350000
         ST    (0),0(0,15)                      * REFRESH RPLY ADDR   * 22400000
         AGO   .EXLEN                                                   22450000
.EXADREG ANOP                                                           22500000
.*--------------------------- REGISTER SPECIFIED ---------------------- 22550000
         ST    &RADDRES,0(0,15)                 * REFRESH RPLY ADDR   * 22600000
         AGO   .EXLEN                                                   22650000
.NOEXADR ANOP                                                           22700000
.*--------------------------- CHECK IF REPLY ADDRESS IS NOT OMITTED --- 22750000
.*--------------------------- AND NOT MORE THAN 1 OPERAND SPECIFIED --- 22800000
         AIF   ( (T'&RADDRES NE 'O' )                                  X22850000
                 AND                                                   X22900000
                 (N'&RADDRES EQ 1)                          ).RPLYADR   22950000
.*--------------------------- CHECK IF LIST FORM WAS SPECIFIED -------- 23000000
.*--------------------------- AND REPLY ADDRESS IS OMMITTED ----------- 23050000
         AIF   ( (&MFLFLG EQ 1)                                        X23100000
                 AND                                                   X23150000
                 (T'&RADDRES EQ 'O')                        ).SUBNUL1   23200000
         MNOTE 16,'ERROR - REPLY ADDRESS OMITTED'                       23250000
&ERRFLG  SETB  1                                                        23300000
         AGO   .RPLYLEN                                                 23350000
.SUBNUL1 ANOP                                                           23400000
&RPLYADR SETC  '(0)'                                                    23450000
         AGO   .RPLYLEN                                                 23500000
.RPLYADR ANOP                                                           23550000
.*--------------------------- CHECK REPLY ADDRESS SYNTAX -------------- 23600000
.*--------------------------- CHECK IF REGISTER WAS SPECIFIED --------- 23650000
         AIF   ( ('&RADDRES'(1,1) EQ '(' )                             X23700000
                 AND                                                   X23750000
                 ('&RADDRES'(K'&RADDRES,1) EQ ')' )        ).VALREG1    23800000
         AGO   .RADADR                                                  23850000
.VALREG1 ANOP                                                           23900000
.*--------------------------- CHECK IF LIST FORM IS NOT SPECIFIED ----- 23950000
         AIF   (&MFLFLG EQ 0).RADRREG                                   24000000
         MNOTE 16,'ERROR - REPLY ADDRESS SPECIFIED AS REGISTER IN LIST X24050000
               FORM'                                                    24100000
&ERRFLG  SETB  1                                                        24150000
         AGO   .RPLYLEN                                                 24200000
.RADRREG ANOP                                                           24250000
.*--------------------------- REGISTER SPECIFIED ---------------------- 24300000
&RPLYADR SETC  '(0)'                                                    24350000
         AGO   .RPLYLEN                                                 24400000
.RADADR  ANOP                                                           24450000
.*--------------------------- ADDRESS SPECIFIED ----------------------- 24500000
&RPLYADR SETC  '(&RADDRES)'                                             24550000
         AGO   .RPLYLEN                                                 24600000
.*##################################################################### 24650000
.*###############                      ################################ 24700000
.*###############  CHECK REPLY LENGTH  ################################ 24750000
.*###############                      ################################ 24800000
.*##################################################################### 24850000
.EXLEN   ANOP                                                           24900000
&NR      SETA  &NR+1                                                    24950000
.*--------------------------- CHECK IF REPLY LENGTH IS NOT SPECIFIED -- 25000000
         AIF   (T'&RLENGTH EQ 'O').EXECB                                25050000
.*--------------------------- CHECK IF REGISTER WAS SPECIFIED --------- 25100000
         AIF   ( ('&RLENGTH'(1,1) EQ '(' )                             X25150000
                 AND                                                   X25200000
                 ('&RLENGTH'(K'&RLENGTH,1) EQ ')' )        ).EXLEREG    25250000
.*--------------------------- ADDRESS SPECIFIED ----------------------- 25300000
         LA    (0),&RLENGTH                     * LOAD RPLY LENGTH    * 25350000
         STH   (0),&RPLYADL.(0,15)              * REFRESH RPLY LENGTH * 25400000
         AGO   .EXECB                                                   25450000
.EXLEREG ANOP                                                           25500000
.*--------------------------- REGISTER SPECIFIED ---------------------- 25550000
         STH   &RLENGTH,&RPLYADL.(0,15)         * REFRESH RPLY LENGTH * 25600000
         AGO   .EXECB                                                   25650000
.RPLYLEN ANOP                                                           25700000
&NR      SETA  &NR+1                                                    25750000
.*--------------------------- CHECK IF REPLY LENGTH IS NOT OMITTED ---- 25800000
.*--------------------------- AND NOT MORE THAN 1 OPERAND SPECIFIED --- 25850000
         AIF   ( (T'&RLENGTH NE 'O' )                                  X25900000
                 AND                                                   X25950000
                 (N'&RLENGTH EQ 1)                         ).RPLYSYN    26000000
.*--------------------------- CHECK IF LIST FORM WAS SPECIFIED -------- 26050000
.*--------------------------- AND REPLY LENGTH IS OMITTED ------------- 26100000
         AIF   ( (&MFLFLG EQ 1)                                        X26150000
                 AND                                                   X26200000
                 (T'&RLENGTH EQ 'O')                        ).SUBNUL2   26250000
         MNOTE 16,'ERROR - REPLY LENGTH OMITTED'                        26300000
&ERRFLG  SETB  1                                                        26350000
         AGO   .ECBADR                                                  26400000
.SUBNUL2 ANOP                                                           26450000
&RPLYLEN SETC  '(0)'                                                    26500000
         AGO   .ECBADR                                                  26550000
.RPLYSYN ANOP                                                           26600000
.*--------------------------- CHECK REPLY LENGTH SYNTAX --------------- 26650000
.*--------------------------- CHECK IF REGISTER WAS SPECIFIED --------- 26700000
         AIF   ( ('&RLENGTH'(1,1) EQ '(' )                             X26750000
                 AND                                                   X26800000
                 ('&RLENGTH'(K'&RLENGTH,1) EQ ')' )         ).VALREG2   26850000
.*--------------------------- CHECK IF REPLY LENGTH IS SPECIFIED ------ 26900000
.*--------------------------- WITH DECIMAL DIGITS --------------------- 26950000
         AIF   (T'&RLENGTH EQ 'N').RLENDIG                              27000000
         AGO   .RLENADR                                                 27050000
.VALREG2 ANOP                                                           27100000
.*--------------------------- REGISTER SPECIFIED ---------------------- 27150000
.*--------------------------- CHECK IF LIST FORM IS NOT SPECIFIED ----- 27200000
         AIF   (&MFLFLG EQ 0).RLENREG                                   27250000
         MNOTE 16,'ERROR - REPLY LENGTH SPECIFIED AS REGISTER IN LIST FX27300000
               ORM'                                                     27350000
&ERRFLG  SETB  1                                                        27400000
         AGO   .ECBADR                                                  27450000
.RLENDIG ANOP                                                           27500000
.*--------------------------- DECIMAL DIGITS SPECIFIED ---------------- 27550000
.*--------------------------- CHECK IF REPLY LENGTH IS LESS THAN ------ 27600000
.*--------------------------- MAXIMUM --------------------------------- 27650000
         AIF   (&RLENGTH LE &RPLYMAX).RLENADR                           27700000
         MNOTE 16,'ERROR - REPLY LENGTH EXEEDS MAXIMUM OF &RPLYMAX'     27750000
&ERRFLG  SETB  1                                                        27800000
         AGO   .ECBADR                                                  27850000
.RLENREG ANOP                                                           27900000
.*--------------------------- REGISTER SPECIFIED ---------------------- 27950000
&RPLYLEN SETC  '(0)'                                                    28000000
         AGO   .ECBADR                                                  28050000
.RLENADR ANOP                                                           28100000
.*--------------------------- ADDRESS OR DECIMAL DIGITS SPECIFIED ----- 28150000
&RPLYLEN SETC  '(&RLENGTH)'                                             28200000
         AGO   .ECBADR                                                  28250000
.*##################################################################### 28300000
.*###############                     ################################# 28350000
.*###############  CHECK ECB ADDRESS  ################################# 28400000
.*###############                     ################################# 28450000
.*##################################################################### 28500000
.EXECB   ANOP                                                           28550000
&NR      SETA  &NR+1                                                    28600000
.*--------------------------- CHECK IF NO ECB ADDRESS WAS SPECIFIED --- 28650000
         AIF   (T'&EADDRES EQ 'O').MOREMSG                              28700000
.*--------------------------- CHECK IF REGISTER WAS SPECIFIED --------- 28750000
         AIF   ( ('&EADDRES'(1,1) EQ '(' )                             X28800000
                 AND                                                   X28850000
                 ('&EADDRES'(K'&EADDRES,1) EQ ')' )         ).EXECREG   28900000
.*--------------------------- ADDRESS SPECIFIED ----------------------- 28950000
         LA    (0),&EADDRES                     * LOAD ECB ADDR       * 29000000
         ST    (0),&RPLYADL+&RPLYLEL.(0,15)     * REFRESH ECB ADDRESS * 29050000
         AGO   .MOREMSG                                                 29100000
.EXECREG ANOP                                                           29150000
.*--------------------------- REGISTER SPECIFIED ---------------------- 29200000
         ST    &EADDRES,&RPLYADL+&RPLYLEL.(0,15) * REFRESH ECB ADDR   * 29250000
         AGO   .MOREMSG                                                 29300000
.ECBADR  ANOP                                                           29350000
&NR      SETA  &NR+1                                                    29400000
.*--------------------------- CHECK IF ECB ADDRESS IS NOT OMITTED ----- 29450000
.*--------------------------- AND NOT MORE THAN 1 OPERAND SPECIFIED --- 29500000
         AIF   ( (T'&EADDRES NE 'O' )                                  X29550000
                 AND                                                   X29600000
                 (N'&EADDRES EQ 1)                        ).ECBSYN      29650000
.*--------------------------- CHECK IF LIST FORM WAS SPECIFIED -------- 29700000
.*--------------------------- AND ECB ADDRESS IS OMITTED -------------- 29750000
         AIF   ( (&MFLFLG EQ 1)                                        X29800000
                 AND                                                   X29850000
                 (T'&EADDRES EQ 'O')                        ).SUBNUL3   29900000
         MNOTE 16,'ERROR - ECB ADDRESS OMITTED'                         29950000
&ERRFLG  SETB  1                                                        30000000
         AGO   .MOREMSG                                                 30050000
.SUBNUL3 ANOP                                                           30100000
&ECBADR  SETC  '(0)'                                                    30150000
         AGO   .MOREMSG                                                 30200000
.ECBSYN  ANOP                                                           30250000
.*--------------------------- CHECK ECB ADDRESS SYNTAX ---------------- 30300000
.*--------------------------- CHECK IF REGISTER WAS SPECIFIED --------- 30350000
         AIF   ( ('&EADDRES'(1,1) EQ '(' )                             X30400000
                 AND                                                   X30450000
                 ('&EADDRES'(K'&EADDRES,1) EQ ')' )          ).VALREG3  30500000
         AGO   .ECBDIG                                                  30550000
.VALREG3 ANOP                                                           30600000
.*--------------------------- REGISTER SPECIFIED ---------------------- 30650000
.*--------------------------- CHECK IF LIST FORM WAS NOT SPECIFIED ---- 30700000
         AIF   (&MFLFLG EQ 0).REGECB                                    30750000
         MNOTE 16,'ERROR - ECB ADDRESS SPECIFIED AS REGISTER IN LIST FOX30800000
               RM'                                                      30850000
&ERRFLG  SETB  1                                                        30900000
         AGO   .MOREMSG                                                 30950000
.REGECB  ANOP                                                           31000000
.*--------------------------- REGISTER SPECIFIED ---------------------- 31050000
&ECBADR  SETC  '(0)'                                                    31100000
         AGO   .MOREMSG                                                 31150000
.ECBDIG  ANOP                                                           31200000
.*--------------------------- ADDRESS SPECIFIED ----------------------- 31250000
&ECBADR  SETC  '(&EADDRES)'                                             31300000
.*##################################################################### 31350000
.*###############                                          ############ 31400000
.*###############  CHECK IF THERE IS ANOTHER MESSAGE LINE  ############ 31450000
.*###############                                          ############ 31500000
.*##################################################################### 31550000
.MOREMSG ANOP                                                           31600000
.*--------------------------- CHECK IF THERE ARE NOT MORE PARAMETER --- 31650000
.*--------------------------- SPECIFIED THAN ALLOWED ------------------ 31700000
         AIF   (N'&SYSLIST LE &MAXPARA).ROUT                            31750000
         MNOTE 16,'ERROR - TOO MANY POSITIONAL PARAMETER SPECIFIED'     31800000
         AGO   .ENDE                                                    31850000
.*##################################################################### 31900000
.*###############                              ######################## 31950000
.*###############  CHECK IF VALID ROUTING CODE ######################## 32000000
.*###############                              ######################## 32050000
.*##################################################################### 32100000
.ROUT    ANOP                                                           32150000
.*--------------------------- CHECK IF EXECUTE FORM WAS SPECIFIED ----- 32200000
         AIF   (&MFEFLG EQ 1).STORE                                     32250000
&RCDELEN SETA  N'&ROUTCDE                                               32300000
.*--------------------------- CHECK IF ROUTING CODE WAS NOT OMITTED --- 32350000
         AIF   (T'&ROUTCDE(&ROUTNR) NE 'O').ROUTOK                      32400000
&ROUTNR  SETA  &ROUTNR+1                                                32450000
.*--------------------------- CHECK IF AN ERROR HAS OCCURED ----------- 32500000
.*--------------------------- => NO DEFAULT WARNING ------------------- 32550000
         AIF   (&ERRFLG EQ 1).DESCCDE                                   32600000
.*--------------------------- ALL ROUTINGCODES CHECKED ? -------------- 32650000
         AIF   (&ROUTNR LE &RCDELEN).ROUT                               32700000
         MNOTE 0,'INFORMATION - ROUTING CODE ''&DEFROUT'' ASSUMED'      32750000
.DEFROUT ANOP                                                           32800000
.*--------------------------- DEFAULT ROUTING CODE BINARY CODED ------- 32850000
&RC(2)   SETB 1                                                         32900000
         AGO   .DESCCDE                                                 32950000
.ROUTOK  ANOP                                                           33000000
.*--------------------------- CHECK IF ROUTING CODE IS OMITTED -------- 33050000
         AIF   (T'&ROUTCDE(&ROUTNR) EQ 'O').ADD1RCD                     33100000
.*--------------------------- CHECK IF ROUTING CODE IS VALID ---------- 33150000
         AIF   ( (&ROUTCDE(&ROUTNR) GE &MINROUT)                       X33200000
                 AND                                                   X33250000
                 (&ROUTCDE(&ROUTNR) LE &MAXROUT)              ).NXTROUT 33300000
         MNOTE 16,'ERROR - INVALID ROUTING CODE ''&ROUTCDE(&ROUTNR)'' (X33350000
               VALID : &MINROUT - &MAXROUT)'                            33400000
&ERRFLG  SETB  1                                                        33450000
         AGO   .ADD1RCD                                                 33500000
.NXTROUT ANOP                                                           33550000
.*--------------------------- CHECK IF ROUTING CODE WAS NOT SPECIFIED-- 33600000
.*--------------------------- BEFOR ----------------------------------- 33650000
         AIF   (NOT &RC(&ROUTCDE(&ROUTNR))).BITOUT                      33700000
         MNOTE 16,'ERROR - ROUTING CODE ''&ROUTCDE(&ROUTNR)'' SPECIFIEDX33750000
                MORE THAN ONCE'                                         33800000
&ERRFLG  SETB  1                                                        33850000
         AGO   .ADD1RCD                                                 33900000
.BITOUT  ANOP                                                           33950000
&BT      SETA  &ROUTCDE(&ROUTNR)                                        34000000
.*--------------------------- SET FLAG FOR THIS ROUTINGCODE ----------- 34050000
&RC(&BT) SETB 1                                                         34100000
.ADD1RCD ANOP                                                           34150000
.*--------------------------- ALL ROUTINGCODE PARAMETER CHECKED ? ----- 34200000
         AIF   (&RCDELEN LE &ROUTNR).DESCCDE                            34250000
.*--------------------------- GET NEXT ROUTING CODE ------------------- 34300000
&ROUTNR  SETA  &ROUTNR+1                                                34350000
         AGO   .ROUTOK                                                  34400000
.*##################################################################### 34450000
.*###############                        ############################## 34500000
.*###############  CHECK DESCRIPTOR CODE ############################## 34550000
.*###############                        ############################## 34600000
.*##################################################################### 34650000
.DESCCDE ANOP                                                           34700000
.*--------------------------- CHECK IF DESCRIPTOR CODE IS OMITTED ----- 34750000
         AIF   (N'&DESC EQ 0).DESCOK                                    34800000
.*--------------------------- CHECK IF AN ERROR HAS OCCURED ----------- 34850000
.*--------------------------- OR EXECUTE FORM WAS SPECIFIED ----------- 34900000
.*--------------------------- => NO DEFAULT WARNING ------------------- 34950000
         AIF   ( (&ERRFLG EQ 1)                                        X35000000
                 OR                                                    X35050000
                 (&MFEFLG EQ 1)  ).STORE                                35100000
         MNOTE 0,'INFORMATION - DESCRIPTOR CODE SUPPRESSED; ''&DEFDESC'X35150000
               ' ASSUMED'                                               35200000
.DESCOK  ANOP                                                           35250000
.*--------------------------- DEFAULT DESCRIPTOR CODE BINARY CODED ---- 35300000
&DC(7)   SETB 1                                                         35350000
.*##################################################################### 35400000
.*###############                 ##################################### 35450000
.*###############  STORE MESSAGE  ##################################### 35500000
.*###############                 ##################################### 35550000
.*##################################################################### 35600000
.STORE   ANOP                                                           35650000
.*--------------------------- CHECK IF AN ERROR HAS OCCURED ----------- 35700000
.*--------------------------- => DO NOT STORE ------------------------- 35750000
         AIF   (&ERRFLG EQ 1).ENDE                  ERROR HAS OCCURED   35800000
.*--------------------------- CHECK IF EXECUTE FORM WAS NOT SPECIFIED - 35850000
         AIF   (&MFEFLG EQ 0).NOEXEC                                    35900000
&BALVAR  SETA  &INSTBAL+&RPLYCON                                        35950000
         AGO   .CALLSVC                                                 36000000
.NOEXEC  ANOP                                                           36050000
&NR      SETA  1                                                        36100000
.NXT     ANOP                                                           36150000
&RLINLEN SETA  K'&MESSAGE-2-&SCHR(&NR)                                  36200000
.*--------------------------- SET OFFSET TO HALFWORD BOUNDERY --------- 36250000
&BALVAR  SETA  ((&BALVAR+1)/2*2)                                        36300000
&BLCKLEN SETA  &BALVAR-&INSTBAL                                         36350000
&IOOFF   SETA  &BALVAR-(&INSTBAL+&BLENLEN+&RCDE+&DESCL)-&RPLYCON        36400000
.*--------------------------- CHECK IF LIST FORM WAS SPECIFIED -------- 36450000
         AIF   (&MFLFLG EQ 1).LISTFRM                                   36500000
&WTON    LA    (0),4                            * LOAD FUNCTIONCODE   * 36550000
         BAL   (1),*+&BALVAR                                            36600000
         AGO   .NORMAL                                                  36650000
.LISTFRM ANOP                                                           36700000
&WTON    DS    0H                               * FORCE ALIGNMENT     * 36750000
.NORMAL  ANOP                                                           36800000
         DC    AL2(&BLCKLEN)                    * WTO/WTOR BLOCK LENGTH 36850000
         DC    B'&RC(1)&RC(2)&RC(3)&RC(4)&RC(5)&RC(6)&RC(7)&RC(8)&RC(9)X36900000
               &RC(10)&RC(11)&RC(12)&RC(13)&RC(14)&RC(15)&RC(16)'      X36950000
                                                * ROUTING CODE        * 37000000
         DC    B'&DC(1)&DC(2)&DC(3)&DC(4)&DC(5)&DC(6)&DC(7)&DC(8)&DC(9)X37050000
               &DC(10)&DC(11)&DC(12)&DC(13)&DC(14)&DC(15)&DC(16)'      X37100000
                                                * DESCRIPTOR CODE     * 37150000
         DC    AL2(&IOOFF)                      * I/O OFFSET          * 37200000
         DC    X'&LINETYP'                      * MESSAGE LINE TYPE   * 37250000
         DC    AL2(&RLINLEN)                    * MESSAGE LENGTH      * 37300000
         DC    C'&MSG(&NR)'                     * MESSAGE TEXT        * 37350000
         DS    0H                               * FORCE ALIGNMENT     * 37400000
         DC    AL4&RPLYADR                      * REPLY ADDRESS       * 37450000
         DC    AL2&RPLYLEN                      * REPLY LENGTH        * 37500000
         DC    AL4&ECBADR                       * USER ECB ADDRESS    * 37550000
.*--------------------------- CHECK IF LISTFORM WAS SPECIFIED --------- 37600000
         AIF   (&MFLFLG EQ 1).CALLSVC                                   37650000
.*--------------------------- CHECK IF NO REGISTER WAS SPECIFIED ------ 37700000
.*--------------------------- FOR REPLY ADDRESS ----------------------- 37750000
         AIF   ( ('&RADDRES'(1,1) NE '(' )                             X37800000
                 OR                                                    X37850000
                 ('&RADDRES'(K'&RADDRES,1) NE ')' )           ).LENREG  37900000
.*--------------------------- REGISTER SPECIFIED ---------------------- 37950000
         STCM  &RADDRES,X'F',*-&OFFSET                                  38000000
&OFFSET  SETA  &OFFSET+4                                                38050000
.LENREG  ANOP                                                           38100000
.*--------------------------- CHECK IF NO REGISTER WAS SPECIFIED ------ 38150000
.*--------------------------- FOR REPLY LENGTH ------------------------ 38200000
         AIF   ( ('&RLENGTH'(1,1) NE '(' )                             X38250000
                 OR                                                    X38300000
                 ('&RLENGTH'(K'&RLENGTH,1) NE ')' )           ).ECBREG  38350000
.*--------------------------- REGISTER SPECIFIED ---------------------- 38400000
         STH   &RLENGTH,*-&OFFSET+4                                     38450000
&OFFSET  SETA  &OFFSET+4                                                38500000
.ECBREG  ANOP                                                           38550000
.*--------------------------- CHECK IF NO REGISTER WAS SPECIFIED ------ 38600000
.*--------------------------- FOR ECB ADDRESS ------------------------- 38650000
         AIF   ( ('&EADDRES'(1,1) NE '(' )                             X38700000
                 OR                                                    X38750000
                 ('&EADDRES'(K'&EADDRES,1) NE ')' )          ).CALLSVC  38800000
.*--------------------------- REGISTER SPECIFIED ---------------------- 38850000
         STCM  &EADDRES,X'F',*-&OFFSET+6                                38900000
.CALLSVC ANOP                                                           38950000
.*--------------------------- CHECK IF MF WAS OMITTED ----------------- 39000000
         AIF   (T'&MF EQ 'O').SUPCALL                                   39050000
.*--------------------------- CHECK IF LISTFORM WAS SPECIFIED --------- 39100000
         AIF   (&MFLFLG EQ 1).ENDE                                      39150000
         LA    (0),4                            * LOAD FUNCTIONCODE   * 39200000
.*##################################################################### 39250000
.*###############                  #################################### 39300000
.*###############  SUPERVISOR CALL #################################### 39350000
.*###############                  #################################### 39400000
.*##################################################################### 39450000
.SUPCALL ANOP                                                           39500000
         SVC   32                                                       39550000
.ENDE    ANOP                                                           39600000
         MEND                                                           39650000
