         MACRO                                                          00001000
         SGPDATA                                                        00002000
         GBLA  &NPART             NUMBER OF STATIC PARTITIONS           00003000
         GBLA  &NCLASS            NUMBER OF CLASSES            @D51IDRP 00004000
         GBLB  &LOLEV             TEMP LOAD-LEVELLER OPTION             00005000
         GBLB  &LOLEV1            TEMP OPTION FOR PMR STATIST. @D52VDRP 00006000
         GBLB  &SGPDATA           PRINT REQUIRED               @D21ZDRP 00007000
         GBLA  &AGEPMSK           EPA  MASK                    @DA33314 00008000
         LCLA  &DEACT                                          @D35EDRP 00009000
         LCLA  &N                                              @D35CDKH 00010000
.************************************************************* @D35NDRP 00011000
*                                                            * @D35NDRP 00012000
.*       IBM DISK OPERATING SYSTEM                           * @D35NDRP 00013000
*        SUPERVISOR - SGPDATA - 5686-066                     * @D61NDRP 00014000
************************************************************** @D35NDRP 00015000
*                                                            * @D35NDRP 00016000
*        LICENSED MATERIALS - PROPERTY OF IBM                * @D318DRP 00017000
*        THIS MACRO IS "RESTRICTED MATERIALS OF IBM"         * @D318DRP 00018000
*        5686-066 (C) COPYRIGHT IBM CORP. 1977, 2002         *          00019002
*        SEE COPYRIGHT INSTRUCTIONS                          * @D318DRP 00020000
*                                                            * @D35NDRP 00021000
************************************************************** @D35NDRP 00022000
         AIF   (NOT &SGPDATA).NOPRT10                          @D61NDRP 00023000
         PRINT GEN                                             @D21ZDRP 00024000
.NOPRT10 ANOP                                                  @D21ZDRP 00025000
         TITLE 'VSE/AF SUPERVISOR    SGPDATA     PAGE MANAGEMENT (DATA-*00026000
               AREA)'                                          @D14BDRP 00027000
         SPACE 2                                                        00028000
* /* START OF SPECIFICATIONS ****************************************** 00029000
*                                                                       00030000
*01* MODULE NAME = SGPDATA                                              00031000
*                                                                       00032000
*01* MODULE TYPE = SUPERVISOR GENERATION MACRO                          00033000
*                                                                       00034000
*01* DESCRIPTIVE NAME = DATA SECTION FOR PAGE MANAGEMENT SERVICES       00035000
*                       AND GENERAL PAGE MANAGEMENT ROUTINES            00036000
*                                                                       00037000
*01* CHANGE ACTIVITY = AS FOLLOWS                                       00038000
*    CHANGE DESRIPTIONS                                                 00039000
*            NEW MACRO -- FIRST RELEASE 35                              00040000
*       E - SUPPORT                                            @D35EDRP 00041004
*                                                              @D35EDGA 00042000
*       FBA - SUPPORT                                          @D35DDRP 00043004
*       S/370 - SUPPORT                                        @D35CDKH 00044004
*                                                              @D35CDAA 00045000
*                                                              @D35CDRP 00046000
*       MULTI EXTENT PDS  REL.35.D                             @D35ZDAA 00047004
*       16 MB REAL STORAGE FOR /370                            @D14ADVB 00048004
*       VAE - SUPPORT                                          @D14NDFG 00049004
*       4 K PAGESIZE FOR 370 AND VM MODE                       @DA33314 00050004
*       PHO INTERFACE CHANGE                                   @DA35398 00051004
*       PMR PERFORMANCE IMPROVEMENT WITH 4K PAGES              @DA35638 00052004
*       WAITFF5 BECAUSE REG4 HAS SCB INSTEAD OF CCW PTR        @DA35398 00053004
*       PGTPCB PAGE OUT PRIORITY MASK INCORRECT DEFINED        @DA36099 00054004
*       SUPPORT MORE ADDRESS SPACES       (SPE DY37265)        @D218DKH 00055004
*       SPE DY37265                                            @D21ZDMZ 00056004
*       ADDR OF SVAPFIX AND PFREE2ND MOVED TO SUPAVT           @D21ZDMZ 00057004
*       HANDLE VIO FILE-SIZE OVER 16M CORRECTLY                @DA37768 00058004
*       SOFTWARE RE-IPL                                        @D31QDHB 00059004
*       NEW SYSTEM LAYOUT                                      @D51GDRP 00060004
*       31-BIT REAL AND XA I/O SUPPORT                         @D51GDTP 00061004
*       MORE PARTITION SUPPORT                                 @D51IDRP 00062004
*       ACCESS REGISTERS SUPPORT                               @D51KDTP 00063004
*       31-BIT ENABLING                                        @D52VDVB 00064004
*       DATA SPACE SUPPORT                                     @D52GDWL 00065004
*       SKIP BLOCKED PAGE-IN IF NO COPY ON PDS                 @D61NDVB 00066004
*       SUPPORT PAGE-FAULTS IN HOME SPACE                      @D61PDRP 00067004
*       NEW DEBUG INTERFACE                                    @D61NDRP 00068004
*       TURBO DISPATCHER SUPPORT                               @D61RDVB 00069004
*       MAINTAIN CURSELCT AND I-BIT PROPERLY                   @DY44117 00070004
*       ADDITIONAL 4 BYTES IN SAVE AREA FOR GENSERV            @DY44241 00071004
*       HARDWAIT FF1 DUE TO INCORRECT PFIX EXCHANGE RTN (VIO)  @DY45878 00071104
* A000000-999999                                               @D35EDRP 00072000
**** END OF SPECIFICATIONS *******************************************/ 00073000
PMGMDATA DS    0D                                              @D61NDRP 00074000
         DC    CL8'SGPDATA '      CODE IDENTIFICATION IN DUMP           00076000
         DC    CL8'@DY45878'      LAST DEVELOPMENT / APAR               00076503
*********************************************************************** 00077000
*                                                                     * 00078000
*        DATA SECTION OF PAGE-MANAGEMENT                              * 00079000
*                                                                     * 00080000
*********************************************************************** 00081000
*                                                                       00082000
*    A T T E N T I O N : ATFIX, ATFREE HAVE TO FOLLOW IMMEDIATLY        00083000
*                        THE CHARACTER-STRING 'SGPDATA '                00084000
ATFIX    DC    AL1(128),AL3(TFIX) ENTRY ADDR FOR TFIX ROUTINE  @D52VDRP 00085000
ATFREE   DC    AL1(128),AL3(TFREE) ENTRY ADDR FOR TFREE RTN    @D52VDRP 00086000
         SPACE 2                                                        00087000
         PMCOM ,                  PAGE MANAGEMENT COMM.AREA    @D14NDFG 00088000
*                                                                       00089000
*                                                                       00090000
****     ADDRESS-CONSTANTS AND ENTRY-POINT ADDRESSES           @D369DRP 00091000
*              USED BY EXTERNAL ROUTINES                       @D369DRP 00092000
*                                                                       00093000
         DS    0F                                              @DA33314 00094000
APMRADR  DC    A(PMRADR)          BASE ADDR OF PMR-ROUTINES    @DA28061 00095000
APMRADR1 DC    A(PMRADR+4096)     SECOND BASE FOR PMR ROUTINES @D51GDTP 00096000
ASVPFREE DC    A(SVPFREE)         EP ADDR OF PFREE FROM BTAM AP@DA28061 00097000
ADRAPDEQ DC    AL1(128),AL3(DRAPDEQ) ENTRY FOR MCRAS           @D52VDRP 00098000
ATPOUT   DC    A(TPOUT)           ENTRY ADDR FOR TPOUT WITH RET@KD40259 00099000
AALBEXIT DC    A(ALBEXIT)         ALLBOUND PROC. FOR LOAD LEVEL@DA28061 00100000
AREACTEX DC    A(REACTEX)         UNCOND. REACTIVATION         @DA28061 00101000
AENQUI   DC    AL1(128),AL3(ENQUI) ENTRY ADDR FOR ENQUI RTN    @D52VDRP 00102000
ASVC089  DC    A(SVC089)          ENTRY ADDR FOR TPOUT         @DA28061 00103000
AFREEPDS DC    AL1(128),AL3(FREEPDS) ENTRY ADDR OF FREEPDS RTN @D52VDRP 00104000
ATFREEPH DC    AL1(128),AL3(TFREEPHS) ENTRYADDR, TFREE OF PHASE@D52VDRP 00105000
ARESPHO  DC    AL1(128),AL3(RESPHO) ENTRY ADDR OF RESPHO RTN   @D52GDWL 00106000
ASCANPGT DC    A(SCANPGT)         ENTRY ADDR OF SCAN PAGETAB   @DA28061 00107000
ATFIXCCW DC    AL1(128),AL3(TFIXCCW) TFIX ENTRY FOR CCW TRANSL @D52VDRP 00108000
ATFRECCW DC    AL1(128),AL3(TFREECCW) TFREE ENTRY, CCW TRANSL  @D52VDRP 00109000
ASVC71B  DC    A(SVC71B)          BASE ADDRESS OF SVC_71 RTN   @D14NDVB 00110000
AGETREL3 DC    AL1(128),AL3(GETREAL3) ENTRY FOR GETREAL(FREFRM)@D52VDRP 00111000
APMRSERV DC    A(PMRSERV)         GENERAL SERVICE ROUTINES     @D52VDVB 00112000
APMRIORT DC    A(PMRIOMOD)        I/O ROUTINES                 @D52VDVB 00113000
APMRSSRV DC    A(PMRSSRV)         SPECIAL SERVICE ROUTINES     @D61RDRP 00114000
APGINSIO DC    A(PGINSIO)         ENTRY ADDR OF PGINSIO        @D52VDVB 00115000
APGICPLT DC    A(PGICOMPL)        ENTRY ADDR OF PGICOMPL       @D52VDVB 00116000
APGOSIO  DC    A(PGOUTSIO)        ENTRY ADDR OF PGOUTSIO       @D52VDVB 00117000
APGOCPLT DC    A(PGOCOMPL)        ENTRY ADDR OF PGOCOMPL       @D52VDVB 00118000
APGOQPFT DC    A(PGOQPFTE)        ENTRY ADDR OF PGOQPFTE       @D52VDVB 00119000
APFTPOSL DC    A(PFTEPOSL)        ENTRY ADDR OF PFTEPOSL       @D52VDVB 00120000
APMRIOER DC    A(PMRIOERR)        ENTRY ADDR OF PMRIOERR       @D52VDRP 00121000
AFIXEXCH DC    A(FIXEXCHG)        ENTRY ADDR OF FIXEXCHG       @D52VDRP 00122000
AVMPF    DC    AL1(128),AL3(VMPF) ENTRY ADDR FOR PSEUDO PF     @D52VDRP 00123000
APBITFNC DC    AL1(128),AL3(PBITFUNC)  PBIT-FUNCTION           @DXXXXRP 00124000
.* -----------------------------------------------------------          00125000
         SPACE 1                                                        00126000
PICTR    DC    F'0'               TOTAL NUMBER OF PAGE-INS              00127000
POCTR    DC    F'0'               TOTAL NUMBER OF PAGE-OUTS             00128000
POCTRUNC DC    F'0'               TOTAL NUMBER OF UNC-PAGE-OUTS@D52VDVB 00129000
POCTRPRE DC    F'0'               TOTAL NUMBER OF PRE-PAGE-OUTS@D52VDVB 00130000
CPGOTUNC DC    F'0'               CURRENT NBR OF UNC-PAGE-OUTS @D52VDVB 00131000
CPGOTPRE DC    F'0'               CURRENT NBR OF PRE-PAGE-OUTS @D52VDVB 00132000
         SPACE 1                                                        00133000
AAAADR   DC    A(0)               ALTERNATE ADDR AREA ADDRESS  @D35CDKH 00134000
AAAEND   DC    A(0)               END OF ALTERNATE ADDR. AREA  @D35CDKH 00135000
APAGETAB DC    A(PAGETAB)         ADDR OF PAGETAB SET          @D14BDRP 00136000
PGTABEND DC    A(EPAGETAB)        END ADDR OF PAGETAB                   00137000
AEOPGTAB DC    A(PAGETAB)         ADDR OF 1ST FREE PAGETAB-ENTRY        00138000
         SPACE 2                                                        00139000
****     DATAFIELDS USED BY EXTERNAL ROUTINES                  @D14NDFG 00140000
*                                                                       00141000
         SPACE 1                                                        00142000
         DS    0H                                                       00143000
TPIDENT  DS    0XL4               LENGTH FOR FOLLOWING FIELDS  @D51IDRP 00144000
*    ***  ATTENTION TPPIK AND TPTID HAVE TO FOLLOW IMMED.      @D519DRP 00145000
TPPIK    DC    H'0'               PIK OF TPIN TASK             @D36IDFR 00146000
TPTID    DC    H'0'               TID OF TPIN TASK             @D36IDFR 00147000
         SPACE 2                                                        00148000
*                                                                       00149000
****     ADDRESS-CONSTANTS AND ENTRY-POINT ADDRESSES           @D369DRP 00150000
*              USED BY INTERNAL ROUTINES                       @D369DRP 00151000
*                                                                       00152000
ASGPSVC  DC    A(SGPSVC)          BASE ADDR OF SGPSVC -RTN'S   @D14BDRP 00153000
APAGSTB  DC    A(PAGSTB)          BASE ADDR OF PAGESTAT RTN    @D52GDWL 00154000
APMPGSER DC    A(PMPGSER)         BASE FOR PGSER RTN           @D52VDVB 00155000
APMRRADR DC    A(PMRRADR)         BASE ADDR OF GET-/FREEREAL   @D35CDKH 00156000
APMFIXAD DC    A(PMFIXADR)        BASE ADDR OF PFIX-SUPPORT ROUTINES    00157000
APMFIXA2 DC    A(PMFIXAD2)        BASE FOR TFIX SUPPORT RTN    @D52VDRP 00158000
IPFQPTR  DC    A(IPFQHEAD)        ADDR OF INVALIDE PAGE-FR QUEUE HEADER 00159000
APAGEOPT DC    A(PAGEOPT)         BASE ADDR OF PAGE HANDL. OPTIM. RTN'S 00160000
ALOLEV   DC    A(LOLEV)           BASE ADDR OF LOAD LEVELER             00161000
REACTECB DC    F'0'                                            @DA26818 00162000
*                                                                       00163000
*                                                                       00164000
APMR     DC    AL1(128),AL3(PMR)  ENTRY ADDR OF PAGE-MANAGER   @D52VDRP 00165000
AGENPGQE DC    A(GENPGQE)         ENTRY ADDR FOR GENPGQE RTN            00166000
AGENPGQX DC    A(GENPGQX)         2ND ENTRY ADDR TO GENPGQE    @D52VDRP 00167000
AENQUIX  DC    AL1(128),AL3(ENQUIX)    2ND ENTRY PT ENQUI RTN. @D52VDRP 00168000
ASCNPGQO DC    A(SCDELPGO)        SCAN AND DELETE PFTE IN PGQUO@D52VDVB 00169000
AENQUOW  DC    A(ENQUOW)          ENTRY FOR PAGE-OUT WITH WAIT @D36IDRP 00170000
AENQUOUN DC    A(ENQUOUNC)        ENTRY FOR UNC. PAGE-OUT      @D61RDRP 00171000
AENQUOBL DC    A(ENQUOBLK)        ENTRY FOR BLOCKED PAGE-OUT   @D61RDRP 00172000
ATERMPGN DC    A(TERMPGIN)        ENTRY FOR PAGEIN DEACTIVATION@D36IDRP 00173000
AREALADR DC    A(REALADR)         ENTRY FOR REALADR ROUTINE    @D52VDRP 00174000
AREALADV DC    A(REALADV)         ENTRY FOR REALADR ROUTINE    @D52VDRP 00175000
         SPACE 2                                                        00176000
*                                                                       00177000
****     DATAFIELDS USED BY INTERNAL ROUTINES                  @D369DRP 00178000
*                                                                       00179000
*                                                                       00180000
         SPACE 1                                                        00181000
*                                                                       00182000
****     CONSTANTS                ****                                  00183000
*                                                                       00184000
         DS    0F                                                       00185000
         DC    CL8'PF-ADDR.'      EYECATCHER: PHOPGADR         @DA35398 00186000
* PHOPGADR:BYTE 0-2 PF-ADDR.ON PG BOUNDARY *2**-8,BYTE 3 SPACE#@D52VDRP 00187000
PHOPGADR DC    A(0)                                            @DA35398 00188000
GENPGADR DC    A(0)               FIELD FOR SAVING SCB ADDRESS @DA35908 00189000
CBITMON  DC    X'00000002'        MASK TO SET C-BIT ON         @D52VDVB 00190000
RBITMSK  DC    X'00000004'        MASK TO SET R-BIT ON                  00191000
RCBITON  DC    X'00000006'        MASK TO SET R-,C-BIT ON      @D14BDRP 00192000
RBITOFF  DC    X'000000FA'        MASK TO SET RBIT OFF         @DA35638 00193000
IPTEMSK  DC    X'7FFFFC00'        MASK TO GET OFFSET OF 1ST PTE IN     *00194000
                                   SEGM. OUT OF PTE OFFSET     @D51GDRP 00195000
PTECON   DS    0XL4               PTE ...                      @D14ADVB 00196000
         DC    XL3'0'             ... PATTERN ...              @D14ADVB 00197000
         DC    AL1(PTEPGCO+PTEIBIT) ... FOR CONNECTED STATE    @D14ADVB 00198000
CBITMSK  DC    X'000000FC'        MASK TO TURN OFF C-BIT       @D35CDKH 00199000
PDSMSK   DC    X'00000001'        MASK TO SET PDS BIT ON       @D35CDKH 00200000
PMRPSPCB DC    X'00000100'  MASK TO SET PRIV. SPACE CONTROL BIT@D52GDRP 00201000
PMASTMSK DC    X'7FFFFFC0' MASK TO GET ASTE ADDR OUT OF ALEASTE@D52VDRP 00202000
         DS    0F                                              @D14BDRP 00203000
EPADRMSK DC    AL3(&AGEPMSK)      TO MASK OUT EXT.PAGE ADDRESS @DA37768 00204000
         DC    AL1(0)                                          @DA37768 00205000
FWHWMASK DC    X'0000FFFF'        MASK TO GET HALFW. OUT OF FW @D14BDRP 00206000
BLKINMSK DC    X'0000000F'        MASK TO GET BLOCKINDEX       @D14BDRP 00207000
PMRFF00  DC    X'FFFFFF00'        MASK TO CLEAR HIGH ORDERED           -00208000
                                       THREE BYTES             @D52VDVB 00209000
PMRPFXMX DC    X'00007FFF'        MAXIMAL VALUE TO BE PFIXED   @D52VDVB 00210000
SDAID    DC    CL6'SDAID'         CONSTANTS                    @D35CDKH 00211000
BATTON   DC    CL7'$$BATTN'       FOR SVC55(GETREAL)           @D35CDKH 00212000
BVSEPT   DC    CL7'$$BVSEPT'      FOR SVC55(GETREAL)           @D14NDVB 00213000
TFIXMAX  DC    X'7FFF'            MAX VALUE OF TFIXC                    00214000
LASTLNG  DC    A(L'RESTENT+1)     LENGTH OF CHPT/RESTART PFIXENTRY+1    00215000
RESTLNG  DC    A(L'RESTENT)       LENGTH OF CHPT/RESTART PFIXENTRY      00216000
PAGTBLNG DC    AL2(L'PGTBLNG)     LENGTH OF PAGETAB ENTRY               00217000
SCANSEL  DC    F'8'               ACTUAL SEARCHING DEPTH       @KD40096 00218000
SCANCUR  DC    F'8'               CURRENT SEARCHING DEPTH IN PSQ        00219000
SCANMAX  DC    F'16'              MAXIMAL SEARCHING DEPTH IN PSQ        00220000
SCANMIN  DC    F'6'               MINIMAL SEARCHING DEPTH IN PSQ        00221000
EYESCB   DC    CL4'SCB '          EYECATCHER OF SCB            @D52GDWL 00222000
*                                                                       00223000
****     VARIABLE DATAFIELDS      ****                                  00224000
*                                                                       00225000
         SPACE 1                                                        00226000
         DS    0F                                              @D52VDRP 00227000
APT      DC    F'0'               ADDR OF ACTUAL PAGETABLE (PMR@D52VDRP 00228000
CNT1     DC    F'0'               # OF PFTE'S WITH R-BIT ZERO FOUND     00229000
*                                 DURING SCAN                           00230000
SELCTFLG DC    X'00'              FLAG-BYTE USED IN SELECTPG-RTN        00231000
NEWSTRT  EQU   X'80'              NEW START OF PSQ FOUND                00232000
REPLFND  EQU   X'40'              PFTE WITH (0,0) ALREADY FOUND         00233000
*                                                                       00234000
SWBYTE   DC    X'00'              BYTE FOR SWITCHES IN PFIX    @D35CDKH 00235000
PGIOSW   EQU   X'80'              IND. PAGE I/O RUNNING ON PF  @D52VDRP 00236000
SPTERES  EQU   X'40'              PTE BELONG. TO RESERVED FRAME MUST   *00237001
                                  NOT SET. (FIXEXCHG-RTN)      @DY45878 00238003
SPTEORI  EQU   X'20'              PTE BELONG. TO ORIGINAL FRAME MUST   *00238101
                                  NOT SET. (FIXEXCHG-RTN)      @DY45878 00238203
*                                                                       00239000
PGOFL    DC    X'00'              FLAG-BYTE FOR ENQUOW HANDL.  @D14BDRP 00240000
POSTRQ   EQU   X'80'              WAIT/POSTING REQUIRED        @D14BDRP 00241000
*                                                                       00242000
PMRFLAG  DC    X'00'              FLAG-BYTE FOR PMR            @D14BDRP 00243000
VIOCLREQ EQU   X'40'              FREEPAGE REQ. FROM VIOCLOSE  @D14BDRP 00244000
PMRIOWT  EQU   X'08'              WAITING ON PAGE-OUT COMPLETE @D52VDVB 00245000
         DS    0F                                              @D35CDRP 00246000
RELPF    DS    F                  SAVE AREA FOR PAGE-FRAME#    @D51GDRP 00247000
*                                                                       00248000
*                                                                       00249000
POPTRET  DC    X'00'              RETURN CODE FIELD            @DD15681 00250000
         DS    0F                                              @D35NDRP 00251000
PREV     DC    F'0'                                            @D35NDRP 00252000
PREV3    EQU   PREV+3             LAST BYTE OF PREV            @D52VDRP 00253000
FLTFLG   EQU   X'40'              PAGEFAULT BEFORE NEXT COMPL. @D52VDRP 00254000
PMRINVBG DC    CL4'INVA'          INDICATE BEGIN OF INVPAGE    @D52VDRP 00255000
PMRINVND DC    CL4'INVE'          INDICATE END   OF INVPAGE    @D52VDRP 00256000
*                                                                       00257000
PMRDBGEN DC    CL4'PMRE'          INDICATE ENQUEUE ENTRY       @D51GDRP 00258000
PMRDBGIO DC    CL4'PMRI'          INDICATE I/O COMPL. ENTRY    @D51GDRP 00259000
PMRDBGHD DC    CL4'PMRH'          INDICATE START OF NEXT REQ.  @D51GDRP 00260000
PMRDADDR DC    CL4'ADDR'          INDICATE ADRESSABLE          @KD40295 00261000
PMRDMUN  DC    CL4'MUN '          INDICATE MAKE UNADDRESSABLE  @KD40295 00262000
PMRDDISC DC    CL4'DISC'          INDICATE DISCONNECT          @KD40295 00263000
FREPDSBG DC    CL4'PDSA'          INDICATE BEGIN OF FREEPDS    @KD40295 00264000
FREPDSND DC    CL4'PDSE'          INDICATE END OF FREEPDS      @KD40295 00265000
PMRDCBON DC    CL4'CBON'          INDICATE CHANGE BIT ON       @KD40295 00266000
PMRDCBOF DC    CL4'CBOF'          INDICATE CHANGE BIT OFF      @KD40295 00267000
         DS    0F                                              @KD40295 00268000
PMRSVDBG DS    16F                SAVE AREA FOR DEGUG ONLY     @KD40295 00269000
         SPACE 1                                                        00270000
*   ADDRESSES/CONSTANTS USED BY VIO-SUPPORT                    @D149DRP 00271000
         VIOCM DSECT=NO                                        @D14BDRP 00272000
SBLKSIZE DC    AL2(SGBLKN*16)     NUMBER OF VIO-BLOCKS COVERED BY ONE  *00273000
                                              SEGMENT BLOCK    @DA33314 00274000
VIOTIBOF DC    AL2(VIOTIB-VIOTABE) OFFSET OF VIOTIB IN VIOTAB  @D14BDRP 00275000
         SPACE 1                                                        00276000
*   ACTUAL ADDRESSES USED BY PMR                               @D149DRP 00277000
PAGEADDR DC    F'0'               TIBSTATE VAL.OF LAST PAGE IN @D36IDFR 00278000
PFDEVCB  DC    F'0'               ADDR OF ACTUAL DEVICE BLOCK  @D14BDRP 00279000
PFPGQE   DC    F'0'               ADDR OF ACTUAL REQ. ELEMENT  @D14BDRP 00280000
PFPCB    DS    F                  A(CLASS-PCB) USED BY DELENTR @D14BDRP 00281000
PFVTABE  DC    F'0'               VTAB-ENTRY ADDR, IF PAGE IN  @D14BDRP 00282000
*                                 V-POOL, ZERO IF NOT IN V-POOL@D14BDRP 00283000
PFSCB    DC    F'0'               ADDR OF SCB BEL. TO PAGEADDR @D52VDRP 00284000
PMRSCB   DC    F'0'               ADDR OF SCB FOR GETPDS/CHKVP.@D52VDRP 00285000
         SPACE 2                                                        00286000
PGQOCNT  DC    AL2(PGQOMAX)       NUMBER OF FREE PAGEOUT TIB'S @D14BDRP 00287000
PGQOFREE DC    A(PGQUO)           ADDR OF 1ST FREE PAGEOUT TIB @D14BDRP 00288000
PGQOLAST DC    A(PGQUOE)          ADDR OF LAST FREE PAGEOUT TIB@D52VDVB 00289000
PSQRPTR  DC    A(0)               PTR TO PFTE TO BE REPLACED            00290000
PSQCPTR  DC    A(0)               PTR TO CURRENT PFTE          @KXA8151 00291000
PSQCAPTE DC    A(0)               PTR TO CURRENT PTE           @KXA1851 00292000
PFWRKPSS DC    XL((&NPART+&NCLASS+1)/8+1)'00' PFPSS WORKFIELD  @D51IDRP 00293000
         SPACE 1                                                        00294000
         DS    0F                                              @D61RDVB 00295000
DEVDEACT DC    XL4'80000000' DEVICE-MASK FOR DEACT. PARTITIONS @D61RDVB 00296000
.*    THE DEACTIVATED PARTITION IS IDENTIFIED BY A SPECIAL     @D61RDVB 00297000
.*    PDS DEVICE WITH THE MASK                                 @D61RDVB 00298000
.*             B'100000000000000000000000000000000'            @D61RDVB 00299000
.*    THE DEACTIVATION IS REQUESTED IS BY:                     @D61RDVB 00300000
PFDEACTX EQU   X'01'               DEACTIVATE PF PROCESSING    @D61RDVB 00301000
.*    THE REACTIVATION IS REQUESTED IS BY:                     @D61RDVB 00302000
PFREACTX EQU   X'00'               REACTIVATE PF PROCESSING    @D61RDVB 00303000
.*    EACH PDS DEVCB IS IDENTIFIED BY A 4 BYTE DEVICE-MASK:    @D61RDVB 00304000
.*     1ST DEV B'010000000000000000000000000000000'            @D61RDVB 00305000
.*     2ND DEV B'001000000000000000000000000000000'            @D61RDVB 00306000
.*     3RD DEV B'000100000000000000000000000000000'            @D61RDVB 00307000
.*     NTH DEV B'000---(N)----01000000000000000000'            @D61RDVB 00308000
.*    WITH  N < 17                                             @D61RDVB 00309000
*                                                                       00310000
****           SAVE AREAS USED IN PAGE-MANAGEMENT   ****                00311000
*                                                                       00312000
         SPACE 1                                                        00313000
BLKTBSAV DS    F                  SAVE AREA FOR OLD BLKTBE     @D51GDTP 00314000
PARTPIK  DS    H                  SAVEAREA FOR REQ. PIK (DEQUI)@D14BDRP 00315000
         DS    0F                                              @D14BDRP 00316000
PTUSGEPA DS    F                  EPA OF 1ST PAGE OF BLOCK IN          *00317000
                                       PTUSG-RTN               @D51GDRP 00318000
         SPACE 1                                                        00319000
* SAVE AREAS FOR INTERRUPTIBLE ROUTINES                        @D149DRP 00320000
GREALSV  DS    7F           (7F)  SAVE AREA IN SVC GETREAL     @D35CDKH 00321000
FIXSAVAR DS    16F                SAVE AREAS FOR FIX SUPPORT   @D52VDVB 00322000
FIXSAV1  EQU   FIXSAVAR           SAVE AREA FOR TFIX  (3F)     @D52VDVB 00323000
FIXSAV2  EQU   FIXSAVAR+12        SAVE AREA FOR TFIX  (1F)     @D52VDVB 00324000
FIXSAV3  EQU   FIXSAVAR+16        SAVE AREA FOR TFIX  (1F)     @D52VDVB 00325000
STFIXCCW EQU   FIXSAVAR     (16F) SAVE AREA FOR TFIX FROM CCW-T@D35CDKH 00326000
         DS    0F                                              @D52VDVB 00327000
PGSERMSK DC    X'0000FFFF'        MASK FOR FUNCTION CODES              *00328000
                                  ... IN PGSER SERVICES        @D52VDVB 00329000
PGSERC20 DC    X'40000000'        MASK FOR PGSER RC = 20       AD52GDVB 00330000
PMRPXFLG DC    X'00'              FLAG                         @D52VDVB 00331000
PMRPXLOB EQU   X'01'              INDICATION 24 BIT PFIX AREA  @D52VDVB 00332000
PMRPXHIB EQU   X'02'              INDICATION 31 BIT PFIX AREA  @D52VDVB 00333000
         DC    XL3'0'             RESERVED                     @D52VDVB 00334000
PMRPXLOP DS    F                  ADDRESS OF PFTE (24 BIT PFIX)@D52VDVB 00335000
PMRPXHIP DS    F                  ADDRESS OF PFTE (31 BIT PFIX)@D52VDVB 00336000
PMRFXAR2 DS    0F                                              @D52VDVB 00337000
         DC    AL1(0)                                          @D52VDVB 00338000
         DC    AL1(PCBPXAR2)                                   @D52VDVB 00339000
         DC    AL1(0)                                          @D52VDVB 00340000
         DC    AL1(PCBPXFIX)                                   @D52VDVB 00341000
PMRPXSVA DS    0F                                              @D52VDVB 00342000
         DC    AL1(PCBPXNOG+PCBPXRET)                          @D52VDVB 00343000
         DC    AL1(PCBPXABO+PCBPXAR1+PCBPXAR2+PCBPXAR3)        @D52VDVB 00344000
         DC    AL1(0)                                          @D52VDVB 00345000
         DC    AL1(PCBPXFRE+PCBPXFIX)                          @D52VDVB 00346000
PMRPGSER DS    0F                                              @D52VDVB 00347000
PMRPXREQ DS    X                                               @D52VDVB 00348000
PMRPXOPT DS    X                                               @D52VDVB 00349000
         DS    X                                               @D52VDVB 00350000
PMRPXFCT DS    X                                               @D52VDVB 00351000
         SPACE 1                                                        00352000
PFIXSAV1 DS    F                  SAVE AREA FOR PFIX IN SVA    @D14BDRP 00353000
PFIXSAV2 DS    F                  SAVE AREA FOR PFIX IN SVA    @D14BDRP 00354000
         SPACE 1                                                        00355000
*    SAVE AREAS FOR INTERRUPTIBLE ROUTINES                     @D149DRP 00356000
PMRSAVE  DS    15F                SAVE AREA FOR NON INTERRUPTIBLE      *00357000
                  SUBROUTINES ON 1ST LEVEL ( R7 AS RETURN ADDR)@D14BDRP 00358000
PMRSAVE2 DS    16F                SAVE AREA FOR NON INTERRUPTIBLE       00359000
*                      SUBROUTINES ON 2ND LEVEL ( RA AS RETURN ADDR)    00360000
PMRSAV21 EQU   PMRSAVE2+36                                     @D14BDRP 00361000
PMRSAVLO DS    15F                SAVE AREA FOR LOWEST LEVEL   @KD40056 00362000
PMRSAVX  DS    F                  SPECIAL SAVE AREA            @D52VDRP 00363000
PMRSLEVA DS    16F                                             @D52GDWL 00364000
PMRSLEV0 DS    16F                                             @D52VDVB 00365000
PMRSLEV1 DS    16F                                             @D52VDVB 00366000
PMRSLEV2 DS    16F                                             @D52VDVB 00367000
PMRSLEV3 DS    16F                                             @D52VDVB 00368000
PMRSVGEN DS    4F                 SAVE AREA FOR GENSERV        @DY44241 00369000
OFR7     EQU   PMRSLEV1-PMRSLEV1                               @D52VDVB 00370000
OFR8     EQU   OFR7+4                                          @D52VDVB 00371000
OFR9     EQU   OFR8+4                                          @D52VDVB 00372000
OFR10    EQU   OFR9+4                                          @D52VDVB 00373000
OFR11    EQU   OFR10+4                                         @D52VDVB 00374000
OFR12    EQU   OFR11+4                                         @D52VDVB 00375000
OFR13    EQU   OFR12+4                                         @D52VDVB 00376000
OFR14    EQU   OFR13+4                                         @D52VDVB 00377000
OFR15    EQU   OFR14+4                                         @D52VDVB 00378000
OFR0     EQU   OFR15+4                                         @D52VDVB 00379000
OFR1     EQU   OFR0+4                                          @D52VDVB 00380000
OFR2     EQU   OFR1+4                                          @D52VDVB 00381000
OFR3     EQU   OFR2+4                                          @D52VDVB 00382000
OFR4     EQU   OFR3+4                                          @D52VDVB 00383000
OFR5     EQU   OFR4+4                                          @D52VDVB 00384000
OFR6     EQU   OFR5+4                                          @D52VDVB 00385000
*                                                                       00386000
PGINSAVE DS    18F                                             @D52VDVB 00387000
PGINASAV EQU   PGINSAVE-PGINSAVE                               @D61NDVB 00388000
PGINASCB EQU   PGINASAV+4                                      @D61NDVB 00389000
PGINARE  EQU   PGINASCB+4                                      @D61NDVB 00390000
PGINARF  EQU   PGINARE+4                                       @D61NDVB 00391000
PGINAR0  EQU   PGINARF+4                                       @D61NDVB 00392000
PMRSACCW DS    A                  ADDRESS OF CURRENT R/W CCW   @D52VDVB 00393000
PMRSAIDL DS    A                  ADDRESS OF CURRENT IDAL      @D52VDVB 00394000
PMRSASRC DS    A                  ADDRESS OF CURRENT SEARCH    @D52VDVB 00395000
         USING PMGMDATA,R8                                     @D14BDRP 00396000
*        SAVEAREAS FOR LOAD LEVELLER                                    00397000
SAVELL   DS    16F                                             @KD40259 00398000
         SPACE 5                                                        00399000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       00400000
*                                                                       00401000
*        CONSTANTS AND FIELDS USED FOR LOAD LEVELLING                   00402000
*                                                                       00403000
         SPACE 3                                                        00404000
RTMASK   DC    X'8040201008040201'                                      00405000
         SPACE 1                                                        00406000
TIMEA    DC    F'0'               BEGIN OF DEACT. INTERVAL              00407000
TIMEB    DC    2F'0'              ACT. TIME AT DEACT. MEASUREM.         00408000
TIME1    DC    F'0'               BEGIN OF REACT. INTERVAL              00409000
TIME2    DC    2F'0'              ACT. TIME AT REACT. MEASUREM.         00410000
TIMEDEF  DC    H'0'                                                     00411000
         SPACE 3                                                        00412000
PIDCTR   DC    F'0'               PAGE-IN CTR FOR DEACT. INTERV.        00413000
PIRCTR   DC    F'0'               PAGE-IN CTR FOR REACT. INTERV.        00414000
EXPAVD   DC    F'0'               EXP.AV.OF NPI/(TIMEB-TIMEA)  @DA33314 00415000
EXPAVE   DC    F'0'               EXP.AV.OF PIRCTR/(TIME2-TIME1)        00416000
EXPAVR   DC    F'0'               EXP.AV.OF RRCTR/(TIMEB-TIMEA)@DA33314 00417000
EXPAVX   DC    F'0'               EXP.AV.OF RRCTR/(TIME2-TIME1)@DA33314 00418000
EXPOUNC  DC    F'0'               EXP.AV.OF UNC. PAGEOUTS / T  @D52VDVB 00419000
EXPOPRE  DC    F'0'               EXP.AV.OF PRE PAGE OUTS / T  @D52VDVB 00420000
RRCTR    DC    F'0'               REENTRY-RATE COUNTER DEACT.  @DA33314 00421000
RRCTRX   DC    F'0'               REENTRY-RATE COUNTER REACT.  @DA33314 00422000
TRTDVX   DC    X'FF00FF0000000000'                                      00423000
         DC    8X'00'                                                   00424000
         DC    X'FF00000000000000'                                      00425000
         DC    8X'00'                                                   00426000
         DC    X'FFFFFFFF000000FF'                                      00427000
         DC    X'FFFFFFFFFF00FF00'                                      00428000
TRTDV    EQU   TRTDVX-X'B0'                                             00429000
         SPACE 3                                                        00430000
*        LL - PARAMETERS                                                00431000
         SPACE 1                                                        00432000
ACONST   DC    F'0'               A=MAXIMUM NUMBER OF PAGE-INS          00433000
*                                   PER SECOND                          00434000
BCONST   DC    F'0'               B=MAXIMUM REENTRY-RATE                00435000
NPI      DC    F'0'               N=NUMBER OF PAGE-INS DEFINING         00436000
*                                   DEACT.-MEASUREM. INTERV.            00437000
DCONST   DC    F'0'               D=THRESHOLD FOR FAST-TRANSL. @D35EDGA 00438000
CCONST   DC    F'0'               C=MINIMUM NUMBER OF PAGE-INS @D35EDGA 00439000
*                                   PER SECOND                 @D35EDGA 00440000
MINTIME  DC    F'0'               M=MINIMUM LENGTH OF REACT.-           00441000
*                                   MEASUREM. INTERV. (IN SECONDS)      00442000
         SPACE 1                                                        00443000
&DEACT   SETA  (&NPART+&NCLASS+2)*4                            @D36IDRP 00444000
         DS    0F                                              @D51IDRP 00445000
TPPCBSAV DC    XL&DEACT'00'       SAVE AREA FOR PART/CLACC PCB'S       *00446000
                                  DEACTIVATED BY TPIN          @D51IDRP 00447000
TPPCBSVE EQU   *                  END OF PCB LIST              @D61RDRP 00448000
MINDEACT DC    H'2'               MIN # OF NOT DEACT PART      @D35EDGA 00449000
         SPACE 1                                               @D64ADVB 00450000
         TITLE 'VSE/AF SUPERVISOR    SGPDATA     PAGE MANAGEMENT (GENER*00451000
               AL ROUTINES)'                                   @D14BDRP 00452000
*  ROUTINES FOR HANDLING OF QUEUES OF PAGE-FRAME TABLE ENTRIES @D14BDRP 00453000
         SPACE 2                                                        00454000
*-------------------------------------------------------------*         00455000
*  PMRREMOV - REMOVE PFTE FROM QUEUE                          *         00456000
*        RA - RETURN REGISTER                                 *         00457000
*        RC - POINTS TO PFTE TO BE REMOVED                    *         00458000
*        R4,R5 - WORKING REGISTERS                            *         00459000
*-------------------------------------------------------------*         00460000
         USING PFTE,RC                                                  00461000
*SGLINK  PMRREMOV,S,INPUT=(R8:APMGMDAT,RA:LINK,RC:PFTE),WORK=(R4,R5)    00462000
PMRREMOV DS    0H                                              @D14BDRP 00463000
         BAL   R4,TESTREM-PMGMDATA(R8) CHECK WHETHER QUEUE OK  @D14BDRP 00464000
         L     R4,PFTEFPTR                                              00465000
         L     R5,PFTEBPTR                                              00466000
         DROP  RC                                                       00467000
         USING PFTE,R4                                                  00468000
         ST    R5,PFTEBPTR                                              00469000
         DROP  R4                                                       00470000
         USING PFTE,R5                                                  00471000
         ST    R4,PFTEFPTR                                              00472000
         DROP  R5                                                       00473000
         BR    RA                 RETURN                                00474000
         SPACE 3                                                        00475000
*-------------------------------------------------------------*         00476000
*  PMRINSBT - INSERT PFTE IN QUEUE                            *         00477000
*        RB - POINTS TO QUEUE ENTRY BEFORE WHICH THE NEW ENTRY*         00478000
*             HAS TO BE INSERTED. IF RB POINTS TO QUEUE HEADER*         00479000
*             INSERTION IS ON THE BOTTOM OF THE QUEUE.        *         00480000
*        RC - POINTS TO PFTE TO BE INSERTED                   *         00481000
*        RA - RETURN REGISTER                                 *         00482000
*        R4,R5 - WORK REGISTERS                               *         00483000
*        IF INSERTION IS IN IPFQ, S370FLG.PNRINV HAS TO BE    *@D61NDRP 00484000
*        SET ALREADY AT ENTRY.                                *@D61NDRP 00485000
*-------------------------------------------------------------*         00486000
*SGLINK  PMRINSBT,S,INPUT=(R8:APMGMDAT,RA:LINK,RB,RC:PFTE),WORK=(R4,R5) 00487000
PMRINSBT DS    0H                                                       00488000
         BAL   R4,TESTINS-PMGMDATA(R8) CHECK WHETHER QUEUE OK  @D14BDRP 00489000
         USING PFTE,RB                                                  00490000
         L     R4,PFTEBPTR                                              00491000
         ST    RC,PFTEBPTR                                              00492000
         DROP  RB                                                       00493000
         USING PFTE,R4                                                  00494000
         L     R5,PFTEFPTR                                              00495000
         ST    RC,PFTEFPTR                                              00496000
         DROP  R4                                                       00497000
         USING PFTE,RC                                                  00498000
         ST    R4,PFTEBPTR                                              00499000
         ST    R5,PFTEFPTR                                              00500000
         DROP  RC                                                       00501000
         BR    RA                 RETURN                                00502000
         SPACE 3                                                        00503000
*-------------------------------------------------------------*@D14BDRP 00504000
*        CLEARPF - ROUTINE                                     @D14BDRP 00505000
*                  CLEARS THE PAGE-FRAME TO ZERO AND           @D14BDRP 00506000
*                  ENQUEUES THE PFTE IN IPFQ                   @D14BDRP 00507000
*        INPUT:                                                @D14BDRP 00508000
*           R7 - RETURN ADDR                                   @D14BDRP 00509000
*           RC - ADDR OF PFTE BELONGING TO RE/RA               @D14BDRP 00510000
*          IF ENTERED VIA CLEARPF                              @D14BDRP 00511000
*           RE - ADDR OF PAGE FRAME TO BE HANDLED              @D14BDRP 00512000
*          IF ENTERED VIA CLEARPF2                             @D14BDRP 00513000
*           RA - ADDR OF PAGE FRAME TO BE HANDLED              @D14BDRP 00514000
*        WORK REGISTER:                                        @D14BDRP 00515000
*           R4,R5,RA,RB                                        @D14BDRP 00516000
*                                                              @D14BDRP 00517000
*        CALLED BY:                                            @D14BDRP 00518000
*          FREEREAL,DEQIFREE,PAGWRTIO,RELPAGE,VIOFRBLK         @D14BDRP 00519000
*              AT CLEARPF WITH AMODE(31),DATOFF                @D529DRP 00520000
*          INVPAGE AT CLEARPF2 WITH AMODE(31),DATOFF           @D529DRP 00521000
*        CALLED ROUTINES: PMRINSBT WITH AMODE(31),DATOFF       @D529DRP 00522000
*-------------------------------------------------------------*@D14BDRP 00523000
         SPACE 1                                               @D14BDRP 00524000
*SGLINK  CLEARPF,S,INPUT=(R7:LINK,RC:PFTE,RE),WORK=(R4,R5,RA,RB)        00525000
CLEARPF  LR    RA,RE              GET TARGET ADDR FOR MVCL     @D14BDRP 00526000
*SGLINK  CLEARPF2,S,INPUT=(R7:LINK,RA,RC:PFTE),WORK=(R4,R5,RA,RB)       00527000
CLEARPF2 TM    SUPFLAG,VMSYS      RUNNING UNDER VM?            @DA33314 00528000
         BO    CLEARVM            YES, ISSUE RELEASE PAGE TO VM@DA33314 00529000
         L     RB,PAGESIZE        GET LENGTH OF PAGE (ONE PAGE)@DA33314 00530000
         LR    R4,RA              GET SOURCE ADDR FOR MVCL     @DA33314 00531000
         SLR   R5,R5              SET PAD AND LENGTH TO ZERO   @D51GDTP 00532000
         MVCL  RA,R4              CLEAR PAGE FRAME             @DA33314 00533000
         USING PFTE,RC                                         @DA33314 00534000
CLEARPF6 TM    PFTEFLG,POABIT     PAGE OUT ACTIVE ?            @DA33314 00535000
         BO    CLEARPF3           YES, BRANCH                  @DA33314 00536000
         L     RB,IPFQBPTR        ADDR OF LAST ENTRY IN IPFQ   @DA33314 00537000
         BAL   RA,PMRINSBT        INSERT PFTE ON TOP OF IT     @DA33314 00538000
         NI    S370FLG,NFRP+PFTERES RESET ALL EXCEPT THE TWO   @KY30163 00539000
         OI    S370FLG,PNRINV     INDICATE PFTE IS INVALID     @DA33314 00540000
         NI    PFTEFLG3,XFF-POSLISON-CURSELCT INITIALIZE BITS  @DY44117 00541000
         BR    R7                 ==========>                  @DA33314 00542000
CLEARPF3 BAL   R5,PMRHWERR        *TEMP                        @D52VDRP 00543000
         OI    PFTEFLG,PCBIT      CHANGE TO UNCOND. PAGE-OUT   @DA33314 00544000
         DROP  RC                                              @DA33314 00545000
         BR    R7                 ==========>                  @DA33314 00546000
CLEARVM  DS    0H                 LET VM RELEASE THE PAGE      @D51GDTP 00547000
         DC    X'83AA0010'        ISSUE 'RELEASE PAGE' TO VM   @D51GDTP 00548000
         B     CLEARPF6                                        @DA33314 00549000
         SPACE 2                                                        00550000
*-------------------------------------------------------------*         00551000
*        CHKSAREA  ROUTINE                                    *         00552000
*           CHECK ADDR WHETHER IT BELONGS TO SHARED AREA      *         00553000
*        INPUT:                                               *         00554000
*           R2 - RETURN ADDRESS                               *         00555000
*           RD - ADDRESS TO BE CHECKED                        *         00556000
*          IN ADDITION IF ENTERED VIA CHKSAREX:               *@D52VDRP 00557000
*           R4 - SCB ADDRESS OF SPACE, THE VIRTUAL ADDRESS    *@D52VDRP 00558000
*                 BELONGS TO                                  *@D52VDRP 00559000
*        OUPUT:                                               *         00560000
*           R4 - ADDRESS OF SCB BELONGING TO AREA             *@D529DRP 00561000
*        WORK REGISTER:                                       *         00562000
*           R3        :                                       *         00563000
*        CALLED BY:                                           *         00564000
*           EPACNVRT, PTASG, PTUSG, INVPAGE, HANDLENT,        *@D529DRP 00565000
*           PGINPSLI                  WITH AMODE(31),DATON    *@D529DRP 00566000
*-------------------------------------------------------------*         00567000
         SPACE 1                                                        00568000
*SGLINK  CHKSAREX,S,INPUT=(R2:LINK,R4:SCB,RD),WORK=(R3),OUTPUT=(R4:SCB) 00569000
CHKSAREX DS    0H                 ENTRY POINT FOR ROUTINES...  @D52GDWL 00570000
*                                 ... THAT PASS A(ACT. SCB)    @D52GDWL 00571000
         USING SCBADR,R4          ... AS INPUT IN R4           @D52GDWL 00572000
         TM    SCBFLG,SCBDSP      SCB OF A DATA SPACE?         @D52GDWL 00573000
         BOR   R2                 YES, =======> RETURN, R4 O.K.@D52GDWL 00574000
         DROP  R4                 RELEASE SCB                  @D52GDWL 00575000
         B     CHKSARE1           SKIP SETTING OF SPACE SCB    @D52VDRP 00576000
*                                                              @D52GDWL 00577000
*SGLINK  CHKSAREA,S,INPUT=(R2:LINK,RD),WORK=(R3),OUTPUT=(R4:SCB)        00578000
CHKSAREA L     R4,SCBPTR          ASSUME PRIVATE AREA          @D52VDRP 00579000
CHKSARE1 L     R3,IJBSMCOM        STOR. MANAGMNT COMM. AREA    @D51GDRP 00580000
         USING SMCOM,R3                                        @D51GDRP 00581000
         C     RD,SMCPRPBG        ADDR IN PRIVATE AREA         @D52VDRP 00582000
         BL    CHKSARE2           NO, GET ADDR OF SHARED SCB   @D52VDRP 00583000
         C     RD,SMCPRPND        REALLY IN PRIVATE AREA       @D52VDRP 00584000
         BNHR  R2                 YES, ======> RETURN          @D52VDRP 00585000
CHKSARE2 L     R4,ASCBATAB                                     @D52VDRP 00586000
         USING SCBATAB,R4                                      @D52VDRP 00587000
         L     R4,ASCBS           GET ADDR OF SHARED SCB       @D52VDRP 00588000
         DROP  R4                 DROP BASE FOR SCBATAB        @D52VDRP 00589000
         BR    R2                 ===========> RETURN          @D52VDRP 00590000
         DROP  R3                 DROP SMCOM                   @D51GDRP 00591000
         SPACE 3                                                        00592000
*--SUBROUTINE TO TEST PFTE S ---------------------------------*@DA33314 00593000
         SPACE 1                                               @DA33314 00594000
TESTREM  DS    0H                                              @D52VDRP 00595000
* TEST WHETHER PFTE IS ENQUEUED                                @DA33314 00596000
         USING PFTE,RC                                         @DA33314 00597000
         STM   R3,R6,TESTSV36     SAVE REGISTERS               @D61NDRP 00598000
         TM    PFTEFLG,PFTEQBIT   ENTRY REALY IN QUEUE ?       @DA33314 00599000
         BO    TESTRQ30           YES, O.K.                    @D61NDRP 00600000
         BAL   R5,PMRHWERR        NO, =====> HARDWAIT          @D61NDRP 00601000
TESTRQ30 NI    PFTEFLG,XFF-PFTEQBIT   RESET QUEUED INDICATION  @DA33314 00602000
         L     R4,IPFQPTR         POINT TO IPFQ HEADER         @D61NDRP 00603000
         TM    S370FLG,PNRINV     FRAME IN IPFQ                @D61NDRP 00604000
         BO    TESTRQ32           YES, BRANCH                  @D61NDRP 00605000
         L     R4,PSQPTR          POINT TO SELECT. QUEUE HEADER@D61NDRP 00606000
TESTRQ32 L     R5,0(,R4)          GET LENGTH OF QUEUE          @D61NDRP 00607000
         BCTR  R5,0                                            @D61NDRP 00608000
         ST    R5,0(,R4)          SET NEW LENGTH               @D61NDRP 00609000
         DROP  RC                                              @DA33314 00610000
         B     TESTRQRT           RETURN, DON'T CHECK QUEUE    @D61NDRP 00611000
         LA    R5,1(,R5)          SET BACK OLD ...             @D61NDRP 00612000
         ST    R5,0(,R4)          ... LENGTH VALUE             @D61NDRP 00613000
*    SEARCH FOR QUEUE HEADER                                   @DA33314 00614000
         LR    R4,RC                                           @DA33314 00615000
         C     RC,IPFQPTR         HEADER TO BE REMOVED         @DA33314 00616000
TESTRQ10 BE    TESTRQ10           YES, LOOP                    @DA33314 00617000
         C     RC,PSQPTR          HEADER TO BE REMOVED         @DA33314 00618000
TESTRQ20 BE    TESTRQ20           YES, LOOP                    @DA33314 00619000
         USING PFTE,R4                                         @DA33314 00620000
TESTRQ00 DS    0H                                              @D14BDRP 00621000
         L     R4,PFTEFPTR                                     @D14BDRP 00622000
         C     R4,IPFQPTR                                      @D14BDRP 00623000
         BE    TESTRQ01                                        @D14BDRP 00624000
         C     R4,PSQPTR                                       @D14BDRP 00625000
         BNE   TESTRQ00                                        @D14BDRP 00626000
*    R4 POINTS TO QUEUE HEADER                                 @D14BDRP 00627000
TESTRQ01 L     R5,0(R4)           GET NUMBER OF ENTR. IN QUEUE @D14BDRP 00628000
         LR    R6,R4                                           @D14BDRP 00629000
         DROP  R4                 DROP PFTE BASE               @D52VDRP 00630000
         USING PFTE,R6                                         @D14BDRP 00631000
TESTRQ02 LR    R3,R6              SAVE LAST PFTE ADDR          @D14BDRP 00632000
         L     R6,PFTEFPTR                                     @D14BDRP 00633000
         C     R3,PFTEBPTR        BACKWARD CHAIN OK            @D14BDRP 00634000
TESTRQ40 BNE   TESTRQ40           NO, LOOP                     @D14BDRP 00635000
         CR    R4,R6              END OF QUEUE REACHED         @D14BDRP 00636000
TESTRQ03 BE    TESTRQ03           YES, LOOP                    @D14BDRP 00637000
         BCT   R5,TESTRQ02        LOOP THRU QUEUE              @D14BDRP 00638000
         L     R5,0(R4)                                        @D14BDRP 00639000
         BCTR  R5,0                                            @D14BDRP 00640000
         ST    R5,0(R4)           SET NEW NUMBER OF ENTRIES    @D14BDRP 00641000
         DROP  R6                                              @D14BDRP 00642000
TESTRQRT LM    R3,R6,TESTSV36     RESTORE REGISTERS            @D61NDRP 00643000
         BR    R4                 RETURN                       @D14BDRP 00644000
         SPACE 2                                                        00645000
TESTINS  DS    0H                                              @D52VDRP 00646000
* TEST WHETHER PFTE IS ENQUEUED                                @D14BDRP 00647000
         USING PFTE,RC                                         @D14BDRP 00648000
         STM   R3,R6,TESTSV36     SAVE REGISTERS               @D61NDRP 00649000
         TM    PFTEFLG,PFTEQBIT   ENTRY NOT IN QUEUE ?         @D14BDRP 00650000
         BNO   TESTIQ30           YES, O.K.                    @D61NDRP 00651000
         BAL   R5,PMRHWERR        NO, =====> HARDWAIT          @D61NDRP 00652000
TESTIQ30 OI    PFTEFLG,PFTEQBIT   SET QUEUED INDICATION        @D14BDRP 00653000
         DROP  RC                                              @D14BDRP 00654000
         USING PFTE,RB            POINT TO PREV. ENTRY         @D61NDRP 00655000
         L     R4,IPFQPTR         POINT TO IPFQ HEADER         @D61NDRP 00656000
         TM    S370FLG,PNRINV     FRAME IN IPFQ                @D61NDRP 00657000
         BO    TESTIQ32           YES, BRANCH                  @D61NDRP 00658000
         L     R4,PSQPTR          POINT TO SELECT. QUEUE HEADER@D61NDRP 00659000
TESTIQ32 L     R5,0(,R4)          GET LENGTH OF QUEUE          @D61NDRP 00660000
         LA    R5,1(,R5)                                       @D61NDRP 00661000
         ST    R5,0(,R4)          SET NEW LENGTH               @D61NDRP 00662000
         DROP  RB                                              @D61NDRP 00663000
         B     TESTIQRT           RETURN, DON'T CHECK QUEUE    @D61NDRP 00664000
         BCTR  R5,0               SET BACK OLD ...             @D61NDRP 00665000
         ST    R5,0(,R4)          ... LENGTH VALUE             @D61NDRP 00666000
*    SEARCH FOR QUEUE HEADER                                   @D14BDRP 00667000
         LR    R4,RB                                           @D14BDRP 00668000
         C     RC,IPFQPTR         HEADER TO BE INSERTED        @D14BDRP 00669000
TESTIQ10 BE    TESTIQ10           YES, LOOP                    @D14BDRP 00670000
         C     RC,PSQPTR          HEADER TO BE INSERTED        @D14BDRP 00671000
TESTIQ20 BE    TESTIQ20           YES, LOOP                    @D14BDRP 00672000
         USING PFTE,R4                                         @D14BDRP 00673000
TESTIQ00 DS    0H                                              @D14BDRP 00674000
         C     R4,IPFQPTR                                      @D14BDRP 00675000
         BE    TESTIQ01                                        @D14BDRP 00676000
         C     R4,PSQPTR                                       @D14BDRP 00677000
         BE    TESTIQ01                                        @D14BDRP 00678000
         L     R4,PFTEFPTR                                     @D14BDRP 00679000
         B     TESTIQ00                                        @D14BDRP 00680000
*    R4 POINTS TO QUEUE HEADER                                 @D14BDRP 00681000
TESTIQ01 L     R5,0(R4)           GET NUMBER OF ENTR. IN QUEUE @D14BDRP 00682000
         LTR   R5,R5              QUEUE EMPTY                  @D14BDRP 00683000
         BZ    TESTIQ04           YES, O.K.                    @D14BDRP 00684000
         DROP  R4                                              @D14BDRP 00685000
         LR    R6,R4                                           @D14BDRP 00686000
         USING PFTE,R6                                         @D14BDRP 00687000
TESTIQ02 LR    R3,R6              SAVE LAST PFTE ADDR          @D14BDRP 00688000
         L     R6,PFTEFPTR                                     @D14BDRP 00689000
         C     R3,PFTEBPTR        BACKWARD CHAIN OK            @D14BDRP 00690000
TESTIQ40 BNE   TESTIQ40           NO, LOOP                     @D14BDRP 00691000
         CR    R4,R6              END OF QUEUE REACHED         @D14BDRP 00692000
TESTIQ03 BE    TESTIQ03           YES, LOOP                    @D14BDRP 00693000
         BCT   R5,TESTIQ02        LOOP THRU QUEUE              @D14BDRP 00694000
TESTIQ04 L     R5,0(R4)                                        @D14BDRP 00695000
         A     R5,F1                                           @D14BDRP 00696000
         ST    R5,0(R4)           SET NEW NUMBER OF ENTRIES    @D14BDRP 00697000
         DROP  R6                                              @D14BDRP 00698000
TESTIQRT LM    R3,R6,TESTSV36     RESTORE REGISTERS            @D61NDRP 00699000
         BR    R4                 RETURN                       @D14BDRP 00700000
TESTSV36 DC    4F'0'                                           @D61NDRP 00701000
         SPACE 3                                                        00702000
TABCNTEN EQU   257                ENABLE COUNT FOR INVPAGE     @D14BDVB 00703000
         SPACE 1                                               @D14BDVB 00704000
*-------------------------------------------------------------*@D14BDVB 00705000
*     ENTER HARD WAIT, ERROR DETECTED DURING PAGEMANAGEMENT FUNCTION    00706000
*-------------------------------------------------------------*@D14BDVB 00707000
PMRHWERR MVI   HWIDBYTE,HWPMRERR  SET HARD WAIT CODE           @D14ZDRP 00708000
         MVI   IJBHWORG,HWORG144  UNIQUE HARD WAIT ORIGINATOR  @D31QDHB 00709000
         B     HARDWAIT           ENTER HARD WAIT              @D14ZDRP 00710000
         SPACE 1                                               @D14ADVB 00711000
TFREWTF5 MVI   HWIDBYTE,HWTFXCNT  SET HARD WAIT CODE                    00712000
         MVI   IJBHWORG,HWORG148  UNIQUE HARD WAIT ORIGINATOR  @D31QDHB 00713000
         B     HARDWAIT           ENTER HARD WAIT                       00714000
         SPACE 1                                                        00715000
*   PAGE I/O ERROR DURING READ/WRITE, ENTER HARD-WAIT          @D149DRP 00716000
PAGHWTF9 MVI   HWIDBYTE,HWPAGEIO SET HARD WAIT CODE                     00717000
         MVI   IJBHWORG,HWORG184  UNIQUE HARD WAIT ORIGINATOR  @D31QDHB 00718000
         B     HARDWAIT           ENTER HARD-WAIT              @D52VDVB 00719000
         SPACE 3                                                        00720000
*-------------------------------------------------------------*@DA35398 00721000
*      EPACNVRT- ROUTINE                                       @DA35398 00722000
*        CONVERTS VIRTUAL ADDRESS INTO EPA FORMAT              @D519DRP 00723000
*      ENTRY POINTS:                                           @D519DRP 00724000
*        EPACNVRT - FOR TRANSLATION OF PAGE-FAULT ADDRESS      @D519DRP 00725000
*                   (ACCESS REGISTER POSSIBLE (ESA MODE ONLY)  @D519DRP 00726000
*        EPACNVR2 - FOR TRANSLATION NORMAL VIRT. ADDRESS       @D519DRP 00727000
*        INPUT:                                                @DA35398 00728000
*           GENPGADR IF CALLED VIA EPACNVRT VIA XMMOVE:        @DY44889 00729301
*                ASN, THE PAGE-FAULT ADDRESS BELONGS TO        @DY44889 00729701
*           R4 - IF CALLED VIA EPACNVRT:                       @D52VDRP 00730101
*                SCB-ADDR(SPACE),THE PAGE-FAULT ADDR BELONGS TO@D52VDRP 00730501
*              - IF CALLED VIA EPACNVR2:                       @D52VDRP 00731000
*                SCB-ADDR OF PRIVATE/SHARED AREA, THE VIRTUAL  @D52VDRP 00732000
*                ADDRESS BELONGS TO.                           @D52VDRP 00733000
*           R8 - BASE AND DATA ADDRESS                         @DA35398 00734000
*           RE - RETURN ADDRESS                                @DA35398 00735000
*           RD - VIRTUAL ADDRESS                               @DA35398 00736000
*        OUTPUT:                                               @D519DRP 00737000
*           RD - EPA ON PAGE BOUNDARY,                         @D519DRP 00738000
*          IF CALLED VIA EPACNVRT:                             @D52VDRP 00739000
*           GENPGADR - ADDRESS OF SCB BELONGING TO THE AREA    @D52VDRP 00740000
*                      THE EPA BELONGS TO.                     @D52VDRP 00741000
*        WORK REGISTER:                                        @DA35398 00742000
*           R1, R5                                             @DA35398 00743000
*        CALLED AT EPACNVRT BY:                                @D61VDRP 00744000
*           ENQUI                        WITH AMODE(31),DATON  @D529DRP 00745000
*        CALLED AT EPACNVR2 BY:                                @D61VDRP 00746000
*           ASPTE, HANDLLST, INVPAGE, PGINPSLI, POSTENT,       @D529DRP 00747000
*           PTASG, PTUSG                 WITH AMODE(31),DATON  @D529DRP 00748000
*-------------------------------------------------------------*@DA35398 00749000
         SPACE 1                                               @DA35398 00750000
*SGLINK EPACNVRT,S,INPUT=(R4,R8,RD,RE),WORK=(R1,R5),OUTPUT=(RD)         00751000
EPACNVRT DS    0H                 ENTRY POINT                  @DA35398 00752000
         CLI   RID+1,DISPID       DISPATCHER RID               @D64ADVB 00753000
         BE    EPACNV00           YES,--------->               @D64ADVB 00754000
         CLI   RID+1,SYSTEMID     SYSTEM RID                   @D64ADVB 00755000
         BE    EPACNV00           YES,--------->               @D64ADVB 00756000
         BAL   R5,PMRHWERR        OTHERWISE HW CONDTION        @D64ADVB 00757000
EPACNV00 DS    0H                                              @D64ADRP 00758000
         STM   R2,R3,PROTSAV      SAVE REG. USED               @D64ADRP 00759000
         NI    TRADDR+3,X'03'     CLEAR UNPRED. BITS           @D61PDRP 00760000
         CLI   TRADDR+3,X'03'     ARE WE IN HOME SPACE MODE    @D61PDRP 00761000
         BNE   EPACNV03           NO, BRANCH                   @D61PDRP 00762000
*   GET ADDR OF SCB FOR HOME SPACE                             @D61PDRP 00763000
EPACNV02 DS    0H                                              @D64ADRP 00764000
         L     R5,PCBPTR          GET ACT. PCB                 @D61PDRP 00765000
         USING PCBADR,R5                                       @D61PDRP 00766000
         L     R4,PCBASCB         GET SCB FOR HOME SPACE       @D61PDRP 00767000
         LTR   R4,R4              IS IT SHARED                 @D61PDRP 00768000
         BNZ   EPACNVR1           NO, SCB ADDR IS CORRECT      @D61PDRP 00769000
         DROP  R5                 DROP BASE FOR PCBADR         @D61PDRP 00770000
         L     R4,ASCBATAB        YES, GET ...                 @D61PDRP 00771000
         USING SCBATAB,R4                                      @D61PDRP 00772000
         L     R4,ASCBS           ... ADDR OF SHARED SCB       @D61PDRP 00773000
         B     EPACNVR1           CONTINUE WITH THIS SCB       @D61PDRP 00774000
         DROP  R4                 DROP BASE FOR SCBATAB        @D61PDRP 00775000
         SPACE 1                                                        00776000
EPACNV03 DS    0H                                              @D61PDRP 00777000
         L     R3,TCBPTR                                       @D64ADOW 00778000
         USING TCBADR,R3                                       @D64ADOW 00779000
         L     R2,TCBATCBE        GET TCB EXTENSION            @D64ADOW 00780000
         USING TCBXADR,R2                                      @D64ADOW 00781000
         CLI   RID+1,DISPID       DISPATCHER RID               @D64ADVB 00782000
         BNE   EPACNV04           NO, --------->               @D64ADVB 00783000
         STCTL CR0,CRE,PMRSLEV0   SAVE CONTROL REGS            @D64ADVB 00784000
         LA    R1,PMRSLEV0        ADDRESS OF CR SA             @D64ADVB 00785000
         B     EPACNV05           --------->                   @D64ADVB 00786000
EPACNV04 DS    0H                                              @D61PDRP 00787000
         LA    R1,TCBX1CRS        ADDRESS OF 1ST CR SA         @D64ADVB 00788000
         CLI   TCBRID,USERTID   SAVED RID = X'08'              @D64ADVB 00789000
         BE    EPACNV05           YES,  --------->             @D64ADVB 00790000
         CLI   TCBRID,RESVCID   SAVED RID = X'10'              @D64ADVB 00791000
         BE    EPACNV05           YES,  --------->             @D64ADVB 00792000
         DROP  R3                                              @D64ADVB 00793000
         LA    R1,TCBX2CRS        ADDRESS OF 2ND CR SA         @D64ADVB 00794000
EPACNV05 DS    0H                                              @D61PDRP 00795000
         CLI   TRADDR+3,X'01'     IN ACCESS REGISTER MODE      @D51KDTP 00796000
         BNE   EPACNVR0           NO, CHECK FURTHER            @D64ADRP 00797000
         CLI   ACCIDEXC,ZERO      WAS IT DUE TO INSTR. FETCH   @D51KDRP 00798000
         BE    EPACNVPS           YES, USE PRIMARY ASN         @D64ADRP 00799000
         MVN   EPACNMOD+3(1),ACCIDEXC MOVE IN ACCESS REGISTER# @D51KDTP 00800000
EPACNMOD EAR   R5,*-*             EXTRACT ACCESS               @D51KDTP 00801000
         ST    R5,EPACALET        SAVE ALET                    @D52GDRP 00802000
         N     R5,EPACNVR8        GET ALET NUMBER              @D51KDTP 00803000
         C     R5,F2              WAS PRIMARY/SEC/HOME SPACE   @D64ADRP 00804000
         BH    EPACNV06           NO, BRANCH                   @D64ADRP 00805000
         BE    EPACNV02           =2: USE HOME SPACE           @D64ADRP 00806000
         LTR   R5,R5              IS PRIMARY SPACE USED        @D64ADRP 00807000
         BZ    EPACNVPS           YES, USE PRIMARY ASN         @D64ADRP 00808000
         B     EPACNVSS           NO,  USE SECONDARY ASN       @D64ADRP 00809000
EPACNV06 DS    0H                                              @D64ADRP 00810000
         L     R4,SAVCR5-SAVCR(0,R1)  GET PASN-AL ORIGIN       @D64ADVB 00811000
         TM    EPACALET,ALETPAL   IS IT PASN-AL                @D52GDRP 00812000
         BO    EPACNV08           YES, BRANCH                  @D52GDRP 00813000
         L     R4,SAVCR2-SAVCR(0,R1)  GET DUCT ORIGIN          @D64ADVB 00814000
EPACNV08 DS    0H                                              @D52VDRP 00815000
*        AMODESW SET,DAT=OFF      ENTER REAL MODE (DAT=OFF)    @D52GDRP 00816000
         AMODESW SET,DAT=OFF      ENTER REAL MODE (DAT=OFF)    @D52GDRP 00817000
         DROP  R2                 DROP BASE FOR TCBXADR, SINCE WE ARE  *00818000
                                    NOW REAL                   @D64ADRP 00819000
         USING DUCT,R4                                         @D52GDRP 00820000
.* NOTE, ASTEALD IS ON SAME OFFSET AS DUCTALD (BY H/W)         @D52GDRP 00821000
         L     R4,DUCTALD         GET ACCESS LIST ...          @D52GDRP 00822000
         N     R4,MASK128         ...  DESIGNATION             @D52GDRP 00823000
         SLL   R5,ALESH           GET OFFSET IN ACCESS LIST    @D52VDRP 00824000
         AR    R4,R5              POINT TO ACCESS LIST ENTRY   @D52GDRP 00825000
         USING ALE,R4             INFORM ASSEMBLER             @D51KDTP 00826000
         L     R4,ALEASTE         GET REAL ADDR OF ASTE        @D52VDRP 00827000
         N     R4,PMASTMSK        SET OFF USELESS BITS         @D52VDRP 00828000
         USING ASTE,R4            INFORM ASSEMBLER             @D51KDTP 00829000
         L     R4,ASTESCB         GET SCB ADDRESS FOR SPACE    @D51KDTP 00830000
         DROP  R4                 CANCEL ADDRESSABILITY        @D51KDTP 00831000
*        AMODESW SET,DAT=ON       ENTER VIRTUAL MODE (DAT=ON)  @D52GDRP 00832000
         AMODESW SET,DAT=ON       ENTER VIRTUAL MODE (DAT=ON)  @D52GDRP 00833000
         B     EPACNVR1           CONTINUE WITH THIS SCB       @D64ADRP 00834000
         SPACE 1                                                        00835000
EPACNVR0 DS    0H                                              @D64ADRP 00836000
         USING TCBXADR,R2                                      @D64ADRP 00837000
         CLI   TRADDR+3,X'00'     IS PRIMARY USED              @D64ADRP 00838000
         BNE   EPACNV10           NO, BRANCH                   @D64ADRP 00839000
         USING SCBADR,R4                                       @D64ADRP 00840000
         TM    SCBFLG,SCBPMRSP    PAGEMANAGER ADDR. SPACE ?    @D64ADRP 00841000
         BO    EPACNVR1           YES, USE PROVIDED SCB        @D64ADRP 00842000
.*  NOTE: PMR ADDRESS SPACES HAVE NO ASN                       @D64ADRP 00843000
         DROP  R4                 DROP BASE FOR SCBADR         @D64ADRP 00844000
         TM    SYSFLAG2,IPLBIT    IPL IN PROGRESS              @D64ADRP 00845000
         BO    EPACNVR1           YES, USE PROVIDED SCB        @D64ADRP 00846000
EPACNVPS DS    0H                 NO,  USE PRIMARY ASN         @D64ADVB 00847000
         MVC   EPACR,SAVCR4-SAVCR(R1)  GET CR 4                @D64ADVB 00848000
         CLI   GENPGADR,XFF       IS XMMOVE CALLING            @DY44889 00848200
         BNE   EPACNV11           NO, --->                     @DY44889 00848400
         MVC   EPACR,GENPGADR     USE ASN SPECIFIED FROM XMMOVE@DY44889 00848600
         B     EPACNV11           SKIP SECONDARY CHECK         @D64ADRP 00849000
EPACNV10 CLI   TRADDR+3,X'10'     IS SECONDARY USED            @D64ADRP 00850000
         BNE   EPACNVR1           NO, BRANCH                   @D64ADRP 00851000
EPACNVSS DS    0H                 YES, SAVE SECONDARY ASN      @D64ADVB 00852000
         MVC   EPACR,SAVCR3-SAVCR(R1)  GET CR 3                @D64ADVB 00853000
EPACNV11 DS    0H                                              @D64ADRP 00854000
         LH    R4,EPACR+2         GET ...                      @D64ADRP 00855000
         N     R4,FWHWMASK        ... ASN IN REGISTER 4        @D64ADRP 00856000
.*     ASN = 0 VALID - IDENTIFYING SYSTEM                      @D64ADVB 00857000
.*DEL    BNZ   EPACNVXX           BR IF ASN /= 0               @D64ADVB 00858000
.*DEL    LA    R4,1(,0)           USE ASN = 1 (SPACE 0 )       @D64ADVB 00859000
.*DEL    STH   R4,EPACR+2         SAVE IT                      @D64ADVB 00860000
EPACNVXX DS    0H                                              @D64ADVB 00861000
         MVC   EPACALET,TCBX1CRE  GET ASN 1ST TABLE...         @D64ADRP 00862000
*        AMODESW SET,DAT=OFF      ENTER REAL MODE (DAT=OFF)    @D64ADRP 00863000
         AMODESW SET,DAT=OFF      ENTER REAL MODE (DAT=OFF)    @D64ADRP 00864000
         DROP  R2                 DROP BASE FOR TCBXADR, SINCE WE ARE  *00865000
                                    NOW REAL                   @D64ADRP 00866000
         SLR   R5,R5              ...                          @D64ADRP 00867000
         ICM   R5,14,EPACALET+1   ... ORIGIN                   @D64ADRP 00868000
         SLL   R5,4               ... IN R5 (AFTO)             @D64ADRP 00869000
         N     R5,BIT0OFF         SET HIGH ORDER BIT OFF       @D64ADRP 00870000
         SRL   R4,6               GET AFX (INDEX IN 1ST ASN)   @D64ADRP 00871000
         SLL   R4,2               GET OFFSET IN ASN 1ST TABLE  @D64ADRP 00872000
         L     R5,0(R5,R4)        GET ASN 1ST TBL ENTRY ASTO)  @D64ADRP 00873000
         LH    R4,EPACR+2         GET ...                      @D64ADRP 00874000
         N     R4,ASXMSK          ... ASX IN R4                @D64ADRP 00875000
         SLL   R4,6               GET OFFSET IN ASN 2ND TABLE  @D64ADRP 00876000
         AR    R5,R4              GET ADDRESS OF ASTE          @D64ADRP 00877000
         USING ASTE,R5                                         @D64ADRP 00878000
         L     R4,ASTESCB         GET SCB ADDRESS FOR SPACE    @D64ADRP 00879000
         DROP  R5                 DROP BASE FOR ASTE           @D64ADRP 00880000
*        AMODESW SET,DAT=ON       ENTER VIRTUAL MODE (DAT=ON)  @D64ADRP 00881000
         AMODESW SET,DAT=ON       ENTER VIRTUAL MODE (DAT=ON)  @D64ADRP 00882000
         SPACE 1                                                        00883000
EPACNVR1 DS    0H                                              @D52VDRP 00884000
         N     RD,EPADRMSK        CLEAR HIGH ORDER BIT         @D52VDRP 00885000
         BAL   R2,CHKSAREX        GET SCB BEL. TO ADDR. IN RD  @D52VDRP 00886000
*SGLINK CHKSAREX,INPUT=(R2,R4,RD),OUTPUT=(R4),WORK=(R3)        @D52VDRP 00887000
         LM    R2,R3,PROTSAV      RESTORE REGISTER             @D52VDRP 00888000
         ST    R4,GENPGADR        SAVE SCB ADDR FOR PHO ETC.   @D52VDRP 00889000
         SPACE 2                                                        00890000
*SGLINK EPACNVRT,S,INPUT=(R4,R8,RD,RE),WORK=(R5),OUTPUT=(RD)   @D61PDRP 00891000
EPACNVR2 DS    0H                                              @D51GDRP 00892000
         USING SCBADR,R4                                       @D52VDRP 00893000
         N     RD,EPADRMSK                                     @DA35398 00894000
         TM    SCBFLG,SCBDSP      IS IT FOR DATA SPACE         @D52GDRP 00895000
         BOR   RE                 YES, =============>          @D52GDRP 00896000
         L     R5,ASIDSTR         ADDRESS OF SPACE IDS         @D52VDRP 00897000
         USING SIDSTR,R5                                       @D52VDRP 00898000
         CLC   SCBID,SIDR         IS IT SPACE R                @D52VDRP 00899000
         BNE   EPACNVR3           NO, --->                     @D52VDRP 00900000
         BAL   R5,PMRHWERR        YES,  ERROR                  @D52VDRP 00901000
         DROP  R4                 DROP BASE FOR SCB            @D52VDRP 00902000
EPACNVR3 DS    0H                                              @D52VDRP 00903000
         L     R5,IJBSMCOM                                     @D52VDRP 00904000
         USING SMCOM,R5                                        @D52VDRP 00905000
         C     RD,SMCPRPBG        IS IT SHARED_24 AREA         @D52VDRP 00906000
         BL    EPACNVR7           YES, BRANCH (EPA=ADDR)       @D52VDRP 00907000
         C     RD,SMCSVA31        IT IT SHARED_31 AREA         @D52VDRP 00908000
         BNL   EPACNVR6           YES, BRANCH                  @D52VDRP 00909000
         S     RD,SMCPRPBG        NO, GET EPA FOR PRIV. AREA   @D52VDRP 00910000
         B     EPACNVR7           SKIP SHARED CODE             @D52VDRP 00911000
EPACNVR6 S     RD,SMCSVA31        GET EPA FOR                  @D52VDRP 00912000
         A     RD,SMCPRPBG        .... SHARED AREA             @D52VDRP 00913000
EPACNVR7 BR    RE                 ==========>                  @D52VDRP 00914000
         SPACE 2                                               @D64ADVB 00915000
PROTSAV  DS    2F                                              @D64ADRP 00916000
EPACNVR8 DC    0F'0',X'0000FFFF'  GET ALET NUMBER              @D51KDTP 00917000
EPACALET DS    F                  SAVE AREA FOR ALET           @D52GDRP 00918000
EPACR    DS    F                  CONTROL REG 2, 3, 4 OR 5     @D64ADVB 00919000
MASK128  DC    X'FFFFFF80'        SET ON 128 BYTE BOUNDARY     @D52GDRP 00920000
ASXMSK   DC    X'0000003F'        GET AFX OUT OF ASN           @D64ADRP 00921000
         SPACE 4                                                        00922000
*-------------------------------------------------------------*         00923000
*      CHKVPOOL- ROUTINE                                       @D519DRP 00924000
*        CHECKS WHETHER PAGE IS IN VPOOL AND SETS PFVTABE      @D519DRP 00925000
*      ENTRY POINT:                                            @D519DRP 00926000
*        CHKVPOOL                                              @D519DRP 00927000
*        INPUT:                                                @DA35398 00928000
*           R8 - BASE AND DATA ADDRESS                         @D519DRP 00929000
*           RA - RETURN ADDRESS                                @D519DRP 00930000
*           R5 - PAGE ADDRESS (EPA)                            @D519DRP 00931000
*        OUTPUT:                                               @D519DRP 00932000
*           R5 - ADDR OF VTABE, IF PAGE IN VPOOL,              @D519DRP 00933000
*                UNPREDICTABLE OTHERWISE                       @D519DRP 00934000
*        EXIT                                                  @D519DRP 00935000
*           WITH OFFSET 0, IF PAGE NOT IN VPOOL                @D519DRP 00936000
*           WITH OFFSET 4, IF PAGE IS IN VPOOL                 @D519DRP 00937000
*        WORK REGISTER:                                        @D519DRP 00938000
*           R5                                                 @D519DRP 00939000
*        CALLED BY:                                            @D519DRP 00940000
*           ENQUI, PMR WITH AMODE(31),ANY                      @D519DRP 00941000
*-------------------------------------------------------------*         00942000
         SPACE 1                                                        00943000
*SGLINK  CHKVPOOL,S,INPUT=(R5,RA:LINK),WORK=(R5),OUTPUT=(R5)            00944000
CHKVPOOL DS    0H                 ENTRY POINT                  @D52VDRP 00945000
         ST    R4,PMRSAVLO+OFR4   SAVE R4                      @D52GDWL 00946000
         MVI   PFVTABE,X'FF'      INDICATE PAGE NOT IN VPOOL   @D52VDRP 00947000
         STOSM PSWMASK,SMDAT      SET DAT ON                   @D52VDRP 00948000
         L     R4,PMRSCB          SCB BEL. TO EPA              @D52VDRP 00949000
         TM    SCBFLG-SCBADR(R4),SCBDSP   IS IT A DATA SPACE?  @D52GDWL 00950000
         BO    CHKVP050           YES                          @D52GDWL 00951000
         TM    SCBFLG-SCBADR(R4),SCBSHA   IS IT SHARED AREA    @D52VDRP 00952000
         BNO   CHKVP050           NO                           @D52GDWL 00953000
         SSM   PSWMASK            RESET PSW MASK               @D52VDRP 00954000
         USING PMGMDATA,R8                                     @D52VDRP 00955000
         S     R5,VIOVPEPA        BELONGS PAGE TO VPOOL        @D52VDRP 00956000
         BM    CHKVP060           ======> NO, RETURN           @D52VDRP 00957000
         C     R5,VIOVPSZE        DOES PAGE BELONG TO VPOOL    @D52VDRP 00958000
         BNL   CHKVP060           ======> NO, RETURN           @D52VDRP 00959000
         SRL   R5,VTOFSHFT        GET ADDRESSS                 @D52VDRP 00960000
         A     R5,VIOAVTAB        * OF VTAB ENTRY              @D52VDRP 00961000
         ST    R5,PFVTABE         SAVE VTAB ENTRY ADDRESS      @D52VDRP 00962000
         L     R4,PMRSAVLO+OFR4   RELOAD REGISTER              @D52GDWL 00963000
         B     4(,RA)             ======> RETURN, PAGE IN VPOOL@D52VDRP 00964000
*                                                              @D52GDWL 00965000
CHKVP050 SSM   PSWMASK            RESET PSW MASK               @D52GDWL 00966000
CHKVP060 L     R4,PMRSAVLO+OFR4   RELOAD REGISTER              @D52GDWL 00967000
         BR    RA                 ======> RET. PAGE NOT IN VP  @D52GDWL 00968000
         SPACE 4                                                        00969000
*-------------------------------------------------------------*         00970000
*      CHKVPOL1- ROUTINE                                       @D519DRP 00971000
*        CHECKS WHETHER PAGE IS IN VPOOL, DON'T TOUCH PFVTABE  @D519DRP 00972000
*      ENTRY POINT:                                            @D519DRP 00973000
*        CHKVPOL1                                              @D519DRP 00974000
*        INPUT:                                                @DA35398 00975000
*           R8 - BASE AND DATA ADDRESS                         @D519DRP 00976000
*           RA - RETURN ADDRESS                                @D519DRP 00977000
*           R5 - PAGE ADDRESS (EPA)                            @D519DRP 00978000
*        OUTPUT:                                               @D519DRP 00979000
*           R5 - ADDR OF VTABE, IF PAGE IN VPOOL,              @D519DRP 00980000
*                UNPREDICTABLE OTHERWISE                       @D519DRP 00981000
*        EXIT                                                  @D519DRP 00982000
*           WITH OFFSET 0, IF PAGE NOT IN VPOOL                @D519DRP 00983000
*           WITH OFFSET 4, IF PAGE IS IN VPOOL                 @D519DRP 00984000
*        WORK REGISTER:                                        @D519DRP 00985000
*           R5                                                 @D519DRP 00986000
*        CALLED BY:                                            @D519DRP 00987000
*           PAGEMUN, GETPDS WITH AMODE(31),ANY                 @D519DRP 00988000
*-------------------------------------------------------------*         00989000
         SPACE 1                                                        00990000
*SGLINK  CHKVPOL1,S,INPUT=(R5,RA:LINK),WORK=(R5),OUTPUT=(R5)            00991000
CHKVPOL1 DS    0H                 ENTRY POINT                  @D52VDRP 00992000
         ST    R4,PMRSAVLO+OFR4   SAVE R4                      @D52GDWL 00993000
         STOSM PSWMASK,SMDAT      SET DAT ON                   @D52VDRP 00994000
         L     R4,PMRSCB          SCB BEL. TO EPA              @D52VDRP 00995000
         USING SCBADR,R4                                       @D52VDRP 00996000
         TM    SCBFLG,SCBSHA      IS IT SHARED AREA            @D52VDRP 00997000
         BNO   CHKVPO20           NO                           @D52GDWL 00998000
         SSM   PSWMASK            RESET PSW MASK               @D52VDRP 00999000
         USING PMGMDATA,R8                                     @D52VDRP 01000000
         S     R5,VIOVPEPA        BELONGS PAGE TO VPOOL        @D52VDRP 01001000
         BM    CHKVPO30           ======> NO, RETURN           @D52VDRP 01002000
         C     R5,VIOVPSZE        DOES PAGE BELONG TO VPOOL    @D52VDRP 01003000
         BNL   CHKVPO30           ======> NO, RETURN           @D52VDRP 01004000
         SRL   R5,VTOFSHFT        GET ADDRESSS                 @D52VDRP 01005000
         A     R5,VIOAVTAB        * OF VTAB ENTRY              @D52VDRP 01006000
         L     R4,PMRSAVLO+OFR4   SAVE R4                      @D52GDWL 01007000
         B     4(,RA)             ======> RETURN, PAGE IN VPOOL@D52VDRP 01008000
*                                                              @D52GDWL 01009000
CHKVPO20 SSM   PSWMASK            RESET PSW MASK               @D52GDWL 01010000
CHKVPO30 L     R4,PMRSAVLO+OFR4   SAVE R4                      @D52GDWL 01011000
         BR    RA                 ======> RET. PAGE NOT IN VP  @D52GDWL 01012000
         DROP  R4                 RELEASE SCB BASE             @D52GDWL 01013000
         SPACE 2                                                        01014000
PMRPATCH DC    40S(*)             PATCH AREA FOR PAGEMANAGEMENT@D14ZDRP 01015000
         DROP  R8                                              @D14ZDRP 01016000
         SPACE 2                                                        01017000
*-------------------------------------------------------------*@DXXXXRP 01018000
*      PBITFUNC- ROUTINE                                       @DXXXXRP 01019000
*        THIS ROUTINE IS PROVIDED FOR GENERAL PURPOSES, TO     @DXXXXRP 01020000
*        FIND THE CAUSE FOR A STORAGE ALTERATION..             @DXXXXRP 01021000
*        IT SETS THE PAGE-PROTECTION IN THE PTE FOR A GIVEN    @DXXXXRP 01022000
*        PAGE ON OR OFF, DEPENDING ON R0.                      @DXXXXRP 01023000
*        IF THE P-BIT IS ON, AN ATTEMPT TO STORE IN THIS PAGE  @DXXXXRP 01024000
*        CAUSES A PROTECTION EXCEPTION.                        @DXXXXRP 01025000
*      CALLING SEQUENCE:                                       @DXXXXRP 01026000
*        L     R9,APMGMDAT                                     @DXXXXRP 01027000
*        L     R9,APBITFNC-PMGMDATA(R9)                        @DXXXXRP 01028000
*        BASSM RE,R9                                           @DXXXXRP 01029000
*      INPUT:                                                  @DXXXXRP 01030000
*           R0 - 0 SET P-BIT OFF                               @DXXXXRP 01031000
*                #0 SET P-BIT ON                               @DXXXXRP 01032000
*           R9 - ADDRESS OF PBITFUNC                           @DXXXXRP 01033000
*           RE - RETURN ADDRESS                                @DXXXXRP 01034000
*           RD - VIRTUAL ADDRESS                               @DXXXXRP 01035000
*        OUTPUT:                                               @DXXXXRP 01036000
*           P-BIT SET ON OR OFF                                @DXXXXRP 01037000
*        WORK REGISTER:                                        @DXXXXRP 01038000
*           R4, R5, R8, RD                                     @DXXXXRP 01039000
*-------------------------------------------------------------*@DXXXXRP 01040000
         SPACE 1                                               @DXXXXRP 01041000
         USING PBITFUNC,R9                                     @DXXXXRP 01042000
PBITFUNC DS    0H                 ENTRY POINT                  @DXXXXRP 01043000
         L     R8,APMGMDAT        GET BASE OF PMR DATA AREA    @DXXXXRP 01044000
         USING PMGMDATA,R8                                     @DXXXXRP 01045000
         N     RD,EPADRMSK        SET ADDRESS ON PAGE BOUNDARY @DXXXXRP 01046000
         L     R4,SCBPTR          GET ACTUAL SCB               @DXXXXRP 01047000
*  GET SCB BELONGING TO RD, AND EPA                            @DXXXXRP 01048000
         L     R5,IJBSMCOM        STOR. MANAGMNT COMM. AREA    @DXXXXRP 01049000
         USING SMCOM,R5                                        @DXXXXRP 01050000
         C     RD,SMCPRPBG        ADDR IN PRIVATE AREA         @DXXXXRP 01051000
         BL    PBITF1             NO, GET ADDR OF SHARED SCB   @DXXXXRP 01052000
         C     RD,SMCPRPND        REALLY IN PRIVATE AREA       @DXXXXRP 01053000
         BNH   PBITF2             YES, HANDLE PRIVATE AREA     @DXXXXRP 01054000
* ADDRESS IS IN 31-BIT SHARED AREA                             @DXXXXRP 01055000
         S     RD,SMCSVA31        GET EPA FOR                  @DXXXXRP 01056000
         A     RD,SMCPRPBG        .... SHARED AREA             @DXXXXRP 01057000
PBITF1   DS    0H                 ADDR IN SHARED-24, EPA=ADDR  @DXXXXRP 01058000
         L     R4,ASCBATAB                                     @DXXXXRP 01059000
         USING SCBATAB,R4                                      @DXXXXRP 01060000
         L     R4,ASCBS           GET ADDR OF SHARED SCB       @DXXXXRP 01061000
         DROP  R4                 DROP BASE FOR SCBATAB        @DXXXXRP 01062000
         B     PBITF3             SKIP PRIVATE AREA CASE       @DXXXXRP 01063000
PBITF2   DS    0H                 ADDR IN PRIVATE AREA         @DXXXXRP 01064000
         S     RD,SMCPRPBG        NO, GET EPA FOR PRIV. AREA   @DXXXXRP 01065000
PBITF3   SRL   RD,PTSHIFT         GET OFFSET IN PT             @DXXXXRP 01066000
         USING SCBADR,R4                                       @DXXXXRP 01067000
         L     R5,SCBAPMRA        GET SCB OF PMRAS             @DXXXXRP 01068000
*   SWITCH TO PMR ADDRESS SPACE                                @DXXXXRP 01069000
*        SGSETUP SETSCB,NEXTSCB=R5,OPTION=SAVE,WR1=R1,WR2=R2   @DXXXXRP 01070000
         SGSETUP SETSCB,NEXTSCB=R5,OPTION=SAVE,WR1=R1,WR2=R2   @DXXXXRP 01071000
         LR    R5,RD                                           @DXXXXRP 01072000
         SRL   R5,SNSHIFT-PTSHIFT GET SEG #                    @DXXXXRP 01073000
         SLL   R5,SNSTESH          X SEG LENGTH                @DXXXXRP 01074000
         AL    R5,SCBVSTO         ADDRESS OF RELATED STE       @DXXXXRP 01075000
         USING STE,R5                                          @DXXXXRP 01076000
         TM    STEFLG,STEINV      SEGMENT ENTRY INVALID        @DXXXXRP 01077000
         BZ    PBITVR3            NO, CONTINUE                 @DXXXXRP 01078000
         SR    RD,RD              YES,                         @DXXXXRP 01079000
         BCTR  RD,0               INDICATE ERROR               @DXXXXRP 01080000
         BSM   0,RE               ======> RETURN               @DXXXXRP 01081000
         DROP  R5                 DROP BASE FOR STE            @DXXXXRP 01082000
PBITVR3  AL    RD,SCBAPT          ADDRESS OF PAGE TABLE ENTRY  @DXXXXRP 01083000
         USING PTE,RD             * IN PMRAS                   @DXXXXRP 01084000
         LTR   R0,R0              P-BIT TO BE SET ON  ?                 01085000
         BNZ   PBITON             YES, BRANCH                           01086000
*                                 NO,                          @DXXXXRP 01087000
         NI    PTESTAT,XFF-X'02'  SET P-BIT OFF                @DXXXXRP 01088000
         B     PBITEXIT                                                 01089000
PBITON   OI    PTESTAT,X'02'      SET P-BIT ON                 @DXXXXRP 01090000
PBITEXIT DS    0H                                              @DXXXXRP 01091000
*    SWITCH BACK TO ORIGINAL ADDRESS SPACE                     @DXXXXRP 01092000
*        SGSETUP RESETSCB,WR1=R1,WR2=R2                        @DXXXXRP 01093000
         SGSETUP RESETSCB,WR1=R1,WR2=R2                        @DXXXXRP 01094000
         BSM   0,RE               ==========> RETURN           @DXXXXRP 01095000
         DROP  R4                 DROP BASE FOR SCB            @DXXXXRP 01096000
         DROP  R8                 DROP BASE FOR PMGMDATA       @DXXXXRP 01097000
         DROP  R9                 DROP CODE BASE               @DXXXXRP 01098000
         DROP  RD                 DROP BASE FOR PTE            @DXXXXRP 01099000
         TITLE 'VSE/AF SUPERVISOR    SGPDATA     PAGE MANAGEMENT (DATA-*01100000
               AREA)'                                          @D14BDRP 01101000
*                                                                       01102000
*                                                                       01103000
*                                                                       01104000
****     TABLES  AND QUEUES       ****                                  01105000
*                                                                       01106000
*                                                                       01107000
         SPACE 1                                                        01108000
*     HEADER FOR INVALID PAGE FRAME QUEUE                               01109000
         DS    0F                                              @D52VDRP 01110000
IPFQHEAD DC    XL(LPFTE)'0'       RESERVE AREA FOR HEADER      @D52VDRP 01111000
         ORG   IPFQHEAD+(S370FLG-PFTE)                         @D61NDRP 01112000
         DC    AL1(PNRINV)        INDICATE BELONGS TO IPFQ     @D61NDRP 01113000
         ORG   IPFQHEAD+(PFTEFPTR-PFTE)                        @D52VDRP 01114000
IPFQFPTR DC    A(IPFQHEAD)        FORWARD PTR                           01115000
IPFQBPTR DC    A(IPFQHEAD)        BACKWARD PTR                          01116000
*     HEADER FOR PAGE FRAME SELECTION QUEUE                             01117000
PSQHEAD  DC    XL(LPFTE)'0'       RESERVE AREA FOR HEADER      @D52VDRP 01118000
         ORG   *-(PFTE+LPFTE-PFTEFPTR)                         @D52VDRP 01119000
PSQFPTR  DC    A(PSQHEAD)         FORWARD PTR                           01120000
PSQBPTR  DC    A(PSQHEAD)         BACKWARD PTR                          01121000
         SPACE 3                                                        01122000
.* -----------------------------------------------------------          01123000
         AIF   (NOT &LOLEV1).NOSTA1                            @D52VDRP 01124000
SWCON    DC    F'20'              S                                     01125000
PFCTR    DC    F'0'               TOTAL NUMBER OF PAGE-FAULTS           01126000
UPFCTR   DC    F'0'               TOTAL NUMBER OF USER PAGE-FAULTS     *01127000
                                   HANDLED UNDER PMR           @D52VDRP 01128000
PFUCTR   DC    F'0'               TOTAL NUMBER OF PAGE-FAULTS  @D14BDRP 01129000
*                                  HANDLED UNDER USER-ID       @D149DRP 01130000
PSELCTR  DC    F'0'               TOTAL NUMB. OF PAGE-SELECTIONS        01131000
POICTR   DC    F'0'               NUMBER OF PAGE-FAULT WITH IMM         01132000
*                                 PAGE-OUT BEFORE                       01133000
NULLPOUT DC    F'0'               TOTAL NUMBER OF USELESS PAGE-OUTS     01134000
RECLAIM  DC    F'0'               TOTAL NUMBER OF RECLAIMED PAGES       01135000
NPSELLOW DC    F'0'               NUM. OF TIMES NPSQE <= SWCON          01136000
.NOSTA1  ANOP                                                  @D52VDRP 01137000
.* -----------------------------------------------------------          01138000
         AIF   (NOT &LOLEV).NOSTA10                            @DF02306 01139000
         SPACE 1                                                        01140000
TIME     DC    F'0'               S                                     01141000
SAVELT   DS    F                  S                                     01142000
STSAVE   DS    F                  S                                     01143000
LLSTATSV DS    F                  S    SAVE AREA                        01144000
PFCTRO   DC    F'0'               S                                     01145000
RECLAIMO DC    F'0'               S                                     01146000
         DS     0F                S     LLTAB-ENTRY                     01147000
LLTABE   DC    X'00'              S     DEACT: X'FF',REACT: X'00'       01148000
         DC    X'00'              S     RESERVED                        01149000
LTI      DC    H'0'               S     INDICATOR-BYTES                 01150000
LTS      DC    F'0'               S     # OF SELECTION-POOL-ELEMENTS    01151000
LTTA     DC    H'0'               S     TIME-INT.SINCE LAST DEACT/REACT 01152000
LTTR     DC    H'0'               S     TIME-INT.S.LAST DEACT (REACT)   01153000
LTWT     DC    H'0'               S     SYSTEM-WAIT-TIME                01154000
LTRP     DC    H'0'               S     DEACT: R ,REACT: PIRCTR         01155000
LTDE     DC    H'0'               S     DEACT: D ,REACT: E              01156000
LTRECL   DC    H'0'               S     % OF RECLAIMED PAGES            01157000
LLTABELN EQU   *-LLTABE           S     LENGTH OF LLTABE       @D51GDRP 01158000
         SPACE 3                                                        01159000
**********************   LL-STATISTICS   ****************************** 01160000
         SPACE 3                                                        01161000
DCTR     DC    F'0'               S     # OF TIMES:  D GE A             01162000
RCTR     DC    F'0'               S     # OF TIMES:  R GE B             01163000
DRCTR    DC    F'0'               S     # OF TIMES:  D GE A & R GE B    01164000
DEACTCTR DC    F'0'               S     # OF DEACTIVATIONS              01165000
DEACT1P  DC    F'0'               S     # OF TIMES DEACTIVATION WAS     01166000
*                                 S     NECESSARY,BUT THERE WAS ONLY    01167000
*                                 S     ONE PARTITION                   01168000
ECTR     DC    F'0'               S     # OF TIMES:  E LE C             01169000
REACTNP  DC    F'0'               S     # OF TIMES REACTIVATION WAS     01170000
*                                 S     POSSIBLE,BUT THERE WAS NO       01171000
*                                 S     DEACTIVATED PARTITION           01172000
NREACTUC DC    F'0'               S  # OF UNCOND REACTIVATIONS @DF00881 01173000
NREACTC  DC    F'0'               S  # OF COND REACTIVATIONS   @DF00881 01174000
VBLOCK#  DC    F'0'               MEDIUM # OF USED BUFFER-BLOCKS        01175000
*                                 PER CCW-CHAIN                         01176000
VPGFIX#  DC    F'0'               MEDIUM # OF TFIXES PER CCW-CH.        01177000
VCCW#    DC    F'0'               MEDIUM LENGTH OF CCW-CHAIN            01178000
WCTR     DC    F'0'               TOTAL SYSTEM-WAIT-TIME                01179000
WPCTR    DC    F'0'               TOTAL SYSTEM-WAIT-TIME MINUS          01180000
*                                 THOSE WAIT-TIMES WHERE TASKS          01181000
*                                 WERE WAITING FOR PAGING-I/O           01182000
WTD      DC    F'0'               S     WAIT-TIME DURING DEACT.INT.     01183000
WTR      DC    F'0'               S     WAIT-TIME DURING REACT.INT.     01184000
NLLTABE  DC    A(5120*4/LLTABELN) S     # OF FREE LLTAB-ENTRIES         01185000
LLTABPTR DC    A(LLTAB-LLTABELN)  S     POINTER TO LAST LLTAB-ENTRY     01186000
LLTABCTR DC    F'0'               S     # OF LLTAB-ENTRIES              01187000
.NOSTA10 ANOP                                                  @DF02306 01188000
.* -----------------------------------------------------------          01189000
         SPACE 2                                                        01190000
*     PSEUDO PCB AND TIB'S FOR PAGE-OUT                        @D149DRP 01191000
PGTPCB   DC    F'0'                                            @D14BDRP 01192000
         ORG   PGTPCB+PCBANPCB-PCBADR                          @D51IDRP 01193000
         DC    A(0)               ADDR OF NEXT PCB IN CLASS    @D51IDRP 01194000
         ORG   PGTPCB+PCBID-PCBADR                             @D14BDRP 01195000
         DC    AL2(&NPART+&NCLASS+1) PSEUDO ID FOR PAGEOUT     @D51IDRP 01196000
         ORG   PGTPCB+PCBACPCB-PCBADR                          @D51IDRP 01197000
         DC    A(PGTPCB)          ADDR OF CORRESP. CLASS PCB   @D51IDRP 01198000
         ORG   ,                                               @D51IDRP 01199000
.*------------------------------------------------------------*@D52VDVB 01200000
         SGPGOTB GEN=ADDRLIST     CONTROL INFO BLOCKED PAGE I/O@D52VDVB 01201000
.*------------------------------------------------------------*@D52VDVB 01202000
*                                                                       01203000
*END OF SGPDATA DSECT                                                   01204000
         ORG   SYSS00+X'1000'-(*-PMGMDATA)                     @D64ADOW 01205000
         ORG   ,                                               @D64ADOW 01206000
*                                                                       01207000
&N       SETA  1                                               @D14BDRP 01208000
*     PSEUDO-TIB'S FOR PAGE-OUT REQUESTS                       @D14BDRP 01209000
PGQUO    DS    0F                                              @D14BDRP 01210000
.GENPGOT DC    A(*+TIBPOLNG)      SET CHAIN POINTER            @D52VDRP 01211000
         DC    XL(TIBPOLNG-4)'00' REST OF TIB FOR PAGE-OUT     @D52VDRP 01212000
&N       SETA  &N+1                                            @D14BDRP 01213000
         AIF   (&N LT 23).GENPGOT                              @D51CDRP 01214000
PGQUOE   DC    XL(TIBPOLNG)'00'   LAST PSEUDO TIB              @D52VDRP 01215000
PGQOMAX  EQU   &N                 MAXIMUM NUMBER OF PSEUDO TIBS@D14BDRP 01216000
         SPACE 3                                                        01217000
*      PAGETAB --- TABLE TO STORE REQUESTS VIA PAGEIN MACRO    @D14BDRP 01218000
         SPACE 1                                                        01219000
         DS    0F                                              @D52VDVB 01220000
PAGETAB  DC    (15*L'PGTBLNG)X'00' 15 PAGETAB ENTRIES          @D52VDRP 01221000
EPAGETAB EQU   *                  END OF PAGETAB               @D14BDRP 01222000
         AIF   (NOT &LOLEV).NOSTA23                            @DF02306 01223000
         SPACE 3                                                        01224000
XLLTAB   EQU   (((*-SYSS00+31)/32)*32)+SYSS00                  @D51IDRP 01225000
         ORG   XLLTAB             SET IT ON 32 BYTE BOUNDARY            01226000
LLTAB    DC    5120F'0'           LL-STATISTICS TABLE                   01227000
.NOSTA23 ANOP                                                  @DF02306 01228000
.*------------------------------------------------------------*@D52VDVB 01229000
         SGPGOTB  GEN=PGOTAB   CONTROL TABLES BLOCKED PAGE I/O @D52VDVB 01230000
         AIF   (NOT &SGPDATA).NOPRT20                          @D61NDRP 01231000
         PRINT NOGEN                                           @D21ZDRP 01232000
.NOPRT20 ANOP                                                  @D21ZDRP 01233000
         MEND                                                           01234000
