*%GOTO  MDOCTAB; /* BILINGUAL MAPPING                                   00050001
         MACRO                                                          00100001
         SGDOC  &DSECT=NO                                               00150001
         GBLB   &BGDEBUG                                                00200001
         GBLB   &SGDOC                                                  00250001
         LCLC   &DI                                                     00300001
         LCLC   &CS                                                     00350001
         LCLC   &BL                                                     00400001
.*       IBM DISK OPERATING SYSTEM                                      00450001
**********************************************************************  00500001
*        SUPERVISOR - SGDOC - 5686-066-06                               00550001
*        THIS MACRO IS "RESTRICTED MATERIALS OF IBM"                    00600001
*        5686-066 (C) COPYRIGHT IBM CORP. 1994,2001                     00650001
*        LICENSED MATERIALS-PROPERTY OF IBM                             00700001
*        SEE COPYRIGHT INSTRUCTIONS G120-2083                           00750001
**********************************************************************  00800001
         SPACE 4                                                        00850001
.**** START OF SPECIFICATIONS ****************************************  00900001
.*                                                                      00950001
.*01* MODULE-TYPE = MACRO                                               01000001
.*                                                                      01050001
.*01* DESCRIPTIVE NAME = A) MAPPING OF  DOCTAB, DSECT=YES               01100001
.*                       B) MAPPING AND INLINE CODE OF SGDOC, DSECT=NO  01150001
.*                                                                      01200001
.*  STATUS           =  NEW MACRO - FIRST RELEASE AF 6.1.0              01250001
.*                                                                      01300001
.*  FUNCTION         =  LAYOUT OF DOCTAB AND SUPERVISOR INTERFACE       01333301
.*                      TO SVA CONSOLE MODULES                          01366601
.*  NOTES            =  NONE                                            01400001
.*  DEPENDENCIES     =  NONE                                            01450001
.*  RESTRICTIONS     =  NONE                                            01500001
.*  REGISTER CONVENT.=  SEE INLINE COMMENTS                             01550001
.*  PATCH LABEL      =  NONE                                            01600001
.*  MACRO TYPE       =  BILINGUAL                                       01650001
.*  PROCESSOR        =  ASM AND PLX                                     01700001
.*  MACRO SIZE       =  SEE OUTPUT                                      01750001
.*  ATTRIBUTES       =  MAPPING DSECT AND/OR INLINE CODE                01800001
.*  ENTRY POINT      =  &NAME OR A(DOCTAB)                              01850001
.*  PURPOSE          =  SEE FUNCTION                                    01900001
.*  LINKAGE          =  SEE INPUT                                       01950001
.*  CALLER           =                                                  02000001
.*  INPUT            =  SEE MACRO PARAMETER                             02050001
.*                                                                      02100001
.*  OUTPUT           =  DSECT OR INLINE CODE OF SGDOC                   02150001
.*                                                                      02200001
.*  EXIT NORMAL      =  MACRO EXPANSION                                 02250001
.*                                                                      02300001
.*  EXIT ERROR       =  NONE                                            02350001
.*                                                                      02400001
.*  EXTERNAL REFEREN.=  NONE                                            02450001
.*  ROUTINES         =  NONE                                            02500001
.*  DATA AREAS       =  NONE                                            02550001
.*  CONTROL BLOCKS   =  NONE                                            02600001
.*  TABLES           =  NONE                                            02650001
.*  MACROS           =  NONE                                            02700001
.*  CHANGE ACTIVITIES=  NEW MACRO   FIRST RELEASE AF 6.1.0              02750001
.*  MODIFIED REGISTER=  NONE                                            02800001
.*                                                                      02850001
.*                                                                      02900001
.* CHANGE ACTIVITY=                                                     02950001
.*       - A000000-999999                                      @D61CDFG 03000001
.*    USE LPA                                                  @D62XDMZ 03025002
.*    MORE THAN 255 TASKS                                      @D66ODOW 03026005
.*    HARDWAIT FFF WITH ALE-SEQUENCE EXCEPTION                 @DY45712 03027013
.*                                                                      03050001
.** END OF SPECICATIONS *********************************************** 03100001
.*                                                                      03150001
.PARMOK  ANOP                                                           03200001
         AIF (NOT &SGDOC  OR NOT &BGDEBUG).DOCNOPR                      03250001
         PRINT GEN                                                      03300001
.DOCNOPR ANOP                                                           03350001
         AIF ('&DSECT' EQ 'YES').DSECT  GENERATE SGDOC  TABLE           03400001
         AIF ('&DSECT' EQ 'NO').INLINE  GENERATE SGDOC  INLINE          03450001
         MNOTE 4,'INVALID DSECT OPERAND SPECIFIED, DSECT=YES ASSUMED'   03500001
.DSECT   ANOP                                                           03550001
&DI      SETC  'DSECT'                                                  03600001
         AGO   .MSS1        CONTINUE WITH SGDOC  DSECT                  03650001
.INLINE  ANOP                                                           03700001
&DI      SETC  'CSECT'                                                  03750001
&CS      SETC  'C'                                                      03800001
&BL      SETC  ''                                                       03850001
         DC    CL8'SGDOC '      MACRO NAME                              03900001
         DC    CL8'@DY45712'    LAST APAR FIX                @DY45712   04000013
         DC    CL10'05/08/2001' DATE OF LAST CHANGE          @D66GDHH   04010010
         USING SGDOC,RD                                                 04050001
SGDOC    DS    0F                                                       04100001
DOCTAB   DS    0F                                                       04150001
         AGO   .INL1                                                    04200001
.MSS1    ANOP                                                           04250001
*********************************************************************** 04300001
* SGDOC    - DSECT, DOC TABLE (IN SUPERVISOR)                           04350001
*********************************************************************** 04400001
DOCTAB   DSECT                                                          04450001
&CS      SETC  'S'                                                      04500001
&BL      SETC  ' '                                                      04550001
.INL1    ANOP                                                           04600001
ADOCHCIN D&CS  A&BL.(DOCHCIN)     A(ENTRY FOR HCF INITIALIZE)           04650001
ADOCHCRQ D&CS  A&BL.(DOCHCRQ)     A(ENTRY FOR HCF REQUEST)              04700001
ADOCHCCM D&CS  A&BL.(0)           A(DOC/HCF COMM. AREA)                 04750001
ADOCARIN D&CS  A&BL.(DOCARIN)     A(ENTRY FOR AR INITIALIZE)            04800001
ADOCARRQ D&CS  A&BL.(DOCARRQ)     A(ENTRY FOR AR REQUEST)               04850001
ADOCARCM D&CS  A&BL.(ARDOCCOM)    A(DOC/AR COMMUNICATION AREA)          04900001
AARCANCL D&CS  A&BL.(ATTNRCAN)    A(AR CANCEL ROUTINE)                  04950001
DOCENTRY D&CS  A&BL.(0)           ROUTER ENTRY POINT                    04975001
DOCWORKA D&CS  A&BL.(0)           LOAD ADDRESS OF CONS ROUTER WORK AREA 05000001
DOCWECB  D&CS  F&BL.'0'           WAIT ECB UNTIL SPDT OR CST INIT'D     05050001
DOCNCSAP D&CS  A&BL.(0)           NEW CSA POINTER FOR IPL CONSOLE       05075001
DOCIPLID D&CS  AL2&BL.(BGTID)     TASK TO BE POSTED BY SPT/CST IN IPL   05100001
DOCARTID D&CS  AL2&BL.(ARTID)     TASK ID OF AR TASK                    05150001
DOCSPTID D&CS  AL2&BL.(SPTTID)    TASK IF OF SPT TASK                   05200001
DOCCSTID D&CS  AL2&BL.(CSTTID)    TASK ID OF CST TASK                   05250001
DOCHCTID D&CS  AL2&BL.(HCFTID)    TASK ID OF HCF TASK                   05300001
         D&CS  AL2&BL.(0)         PLACE HOLDER                          05350001
DOCASTFA D&CS  A&BL.(0)           ADDRESS OF FIXED AUTOMATIC STORAGE    05400001
DOCASTSA D&CS  A&BL.(0)           ADDRESS OF STANDARD AUTOMATIC STORAGE 05450001
DOCASTSP D&CS  CL6&BL.'IJBDOC',X'0000'  AUTOMATIC STORAGE SUBPOOL       05500001
DOCAVMCF D&CS  A&BL.(0)           VMCF ENTRY POINT FOR SPT TASK         05515601
DOCAARCR D&CS  A&BL.(ARCOMREG)    ADDRESS OF AR COMREG                  05531201
DOCAVMCR D&CS  A&BL.(0)           VMCF ENTRY POINT FOR ROUTER           05533301
DOCAVEND D&CS  A&BL.(S124DOC)     ADDRESS OF DOC VENDOR EXIT BLOCK      05535401
DOCACSTD D&CS  A&BL.(CSTDATA)     A(CST DATA AREA)                      05537501
         SPACE                                                          05550001
         AIF ('&DI' EQ 'CSECT').NOLEN   LENGTH FOR DSECT ONLY           05600001
DOSGLENQ EQU   *-DOCTAB     EQUATE FOR  DOCTAB LENGTH                   05650001
.NOLEN   ANOP                                                           05700001
*---------------------------------------------------------------------* 05750001
* FUNCTION CODES FOR CONSOLE ROUTER REQUESTS                            05800001
*---------------------------------------------------------------------* 05850001
DOCFWTOR EQU   1                  WTO/WTOR REQUEST                      05900001
DOCFSV32 EQU   2                  OLD WTO/WTOR REQUEST (SVC 32)         05950001
DOCFDOM  EQU   3                  DOM REQUEST                           06000001
DOCFSVC0 EQU   4                  INTERCEPTED SVC 0/15                  06050001
DOCFMGCR EQU   5                  MGCRE REQUEST                         06100001
DOCFSV30 EQU   6                  SVC 30 REQUEST                        06150001
DOCFMCSO EQU   7                  MCSOPER REQUEST                       06200001
DOCFMCSM EQU   8                  MCSOPMSG REQUEST                      06250001
DOCFSVC3 EQU   9                  QUISCE REQUEST (SVC 3)                06300001
DOCFEOT  EQU   10                 EOT CLEAN-UP REQUEST                  06350001
DOCFHCIN EQU   11                 HCF INITIALIZE REQUEST                06400001
DOCFHCRQ EQU   12                 HCF REQUEST                           06450001
DOCFARIN EQU   13                 AR INITIALIZE REQUEST                 06500001
DOCFARGC EQU   14                 AR GET_COMMAND REQUEST                06550001
*---------------------------------------------------------------------* 06600001
* RETURN AND REASON CODES FOR CONSOLE ROUTER REQUESTS                   06650001
*---------------------------------------------------------------------* 06700001
DOCRCOK  EQU   0                  RETURN CODE FOR COMPLETED             06750001
DOCRCWT  EQU   4                  RETURN CODE FOR WAIT                  06800001
DOCRSWAS EQU   0                   WAIT FOR AUTOMATIC STORAGE           06850001
DOCRSWBF EQU   4                   WAIT FOR BUFFERS                     06900001
DOCRSWRP EQU   8                   WAIT FOR TASK REPLY ID               06925001
DOCRCINV EQU   8                  RETURN CODE FOR INVALID               06950001
DOCRSACC EQU   0                   ACCEPT UNRECOVERABLE ERROR           07000001
DOCRSADR EQU   4                   INVALID ADDRESS                      07050001
DOCRSCCW EQU   8                   INVALID CHANNEL PROGRAM              07100001
DOCRSPRM EQU   12                  INVALID PARAMETERS                   07150001
DOCRSUIO EQU   16                  UNRECOVERABLE I/O ERROR              07200001
DOCRCNAV EQU   12                 LOCAL RETURN CODE FOR NOT AVAILABLE   07233301
DOCRCIPL EQU   16                 RE-IPL THE SYSTEM WHEN OPER.REMOTE    07238801
DOCRCOPF EQU   20                 MCSOPER SERVICE FAILURE               07244401
DOCRCOMF EQU   24                 MCSOPMSG SERVICE FAILURE              07255501
DOCRCNAU EQU   100                USER RETURN CODE FOR NOT AVAILABLE    07266601
*---------------------------------------------------------------------* 07300001
* CANCEL CODES FOR CONSOLE ROUTER REQUESTS                              07350001
*---------------------------------------------------------------------* 07400001
DOCCNUIO EQU   X'1A'              UNRECOVERABLE I/O ERROR               07450001
DOCCNCCW EQU   X'39'              INVALID CHANNEL PROGRAM               07500001
*---------------------------------------------------------------------* 07550001
* LAY-OUT OF AUTOMATIC STORAGE HEADER                                   08050001
*---------------------------------------------------------------------* 08075001
DOCASTHD DSECT                                                          08100001
DOCASTHE DS    CL4                EYE CATCHER                           08150001
DOCASTHC DS    A                  CURRENT WORK POINTER                  08200001
DOCASTHH DS    A                  HIGH WATER MARK                       08250001
DOCASTHL DS    A                  ADDRESS OF LAST BYTE                  08300001
LDOCASTH EQU   *-DOCASTHD         LENGTH OF HEADER                      08350001
******** END OF  DOCTAB *********************************************** 08383301
         AIF ('&DI' EQ 'DSECT').END     GENERATE CODE SECT              08416601
&SYSECT  CSECT                                                          08450001
*********************************************************************** 08500001
* AUTOMATIC STORAGE constants and control information                   08505501
*********************************************************************** 08511001
DOCASTSS DC    H'8192'            STANDARD SIZE OF AUTOMATIC STORAGE    08516501
DOCASTMS DC    H'8192'            MAXIMUM ADDITIONAL STORAGE            08522001
DOCASTAS DC    H'0'               ALLOCATED ADDITIONAL STORAGE          08527501
DOCASTFM DC    14H'0'             HIGH WATER MARK PER FUNCTION          08533001
DOCASTEC DC    CL4'CAST'          EYE CATCHER CONSTANT                  08538501
DOCSAVAL EQU   144                SIZE OF PLX SAVE AREA FOR ESA         08544001
         EJECT                                                          08550001
*********************************************************************** 08600001
*      DOC  ROUTINES                                                    08650001
*********************************************************************** 08700001
*      FUNCTIONS:                                                       08750001
*      ENTRY POINTS  SVCWTOR  - ENTRY FOR WTOR REQUESTS                 08800001
*                    SVC32    - ENTRY FOR SVC32 (OLD WTOR) REQUESTS     08850001
*                    SVCDOM   - ENTRY FOR DOM  REQUESTS                 08900001
*                    DOCSVC0  - ENTRY FOR SVC 0/15 REQUESTS             08950001
*                    SVCMGCR  - ENTRY FOR MGCRE REQUESTS                09000001
*                    SVC30    - ENTRY FOR SVC30 REQUESTS                09050001
*                    PCMCSOP  - ENTRY FOR MCSOPER REQUESTS              09100001
*                    PCMCSMG  - ENTRY FOR MCSOPMSG REQUESTS             09150001
*                    DOCSVC3  - ENTRY FOR SVC3 REQUESTS                 09200001
*                    DOCEOT   - ENTRY FOR EOT REQUESTS                  09250001
*                    DOCHCIN  - ENTRY FOR HCF INIT REQUESTS             09300001
*                    DOCHCRQ  - ENTRY FOR HCF GET_CMD REQUESTS          09350001
*                    DOCARIN  - ENTRY FOR AR INIT REQUESTS              09400001
*                    DOCARRQ  - ENTRY FOR AR GET_CMD REQUESTS           09450001
*                    HCFTASK  - ENTRY FOR HCF FIRST TIME ACTIVATION     09500001
*                    CSTTASK  - ENTRY FOR CST FIRST TIME ACTIVATION     09550001
*                    CSTATTN  - ENTRY FOR SYSLOG ATTENTION INTERRUPT    09600001
*********************************************************************** 09650001
         SPACE                                                          09700001
         USING DISP,R6                                                  09750001
*---------------------------------------------------------------------* 09800001
* WTO/WTOR                                                              09850001
*                                                                       09900001
* CALL I/F: SIMSVC FOR MVS SVC 35                                       09950001
* CALLER'S REQUIREMENTS: AMODE ANY                                      10000001
* INPUT:  R1 = ADDRESS OF PARAMETER LIST (IEZWPL)                       10050001
*         R6 = DISP, R8 = TIB POINTER, RA = TCB POINTER                 10100001
* OUTPUT: IN TASK SAVE AREA                                             10150001
*         RF = RETURN CODE, R0 = REASON CODE, R1 = MESSAGE ID           10200001
* AMODE:  24                                                            10250001
*---------------------------------------------------------------------* 10300001
SVCWTOR  DS    0H                                                       10350001
         L     RD,DOCBASE         BASE ADDRESS                          10400001
         LA    R0,DOCFWTOR        FUNCTION CODE FOR WTO/WTOR            10450001
*        SGCOV SGDOC,MC=0                                               10500001
         B     DOCSVC             COMMON SVC HANDLING ROUTINE           10550001
         SPACE                                                          10600001
*---------------------------------------------------------------------* 10650001
* SVC 32 (OLD WTO/WTOR)                                                 10700001
*                                                                       10750001
* CALL I/F: ENTSVC FOR SVC 32                                           10800001
* CALLER'S REQUIREMENTS: AMODE ANY                                      10850001
* INPUT:  R1 = ADDRESS OF OLD PARAMETER LIST                            10900001
*         R6 = DISP, R8 = TIB POINTER, RA = TCB POINTER                 10950001
* OUTPUT: NONE                                                          11000001
* AMODE:  24                                                            11050001
*---------------------------------------------------------------------* 11100001
SVC32    DS    0H                                                       11150001
         L     RD,DOCBASE         BASE ADDRESS                          11200001
         LA    R0,DOCFSV32        FUNCTION CODE FOR SVC 32              11250001
*        SGCOV SGDOC,MC=1                                               11300001
         B     DOCSVC             COMMON SVC HANDLING ROUTINE           11350001
         SPACE                                                          11400001
*---------------------------------------------------------------------* 11450001
* DOM                                                                   11500001
*                                                                       11550001
* CALL I/F: SIMSVC FOR MVS SVC 87                                       11600001
* CALLER'S REQUIREMENTS: AMODE ANY                                      11650001
* INPUT:  R0 IN SAVE AREA = OPTION CODES (MUST BE 0)                    11700001
*         R1 = MESSAGE ID                                               11750001
*         R6 = DISP, R8 = TIB POINTER, RA = TCB POINTER                 11800001
* OUTPUT: NONE                                                          11850001
*---------------------------------------------------------------------* 11900001
SVCDOM   DS    0H                                                       11950001
         L     RD,DOCBASE         BASE ADDRESS                          12000001
         LA    R0,DOCFDOM         FUNCTION CODE FOR DOM                 12050001
*        SGCOV SGDOC,MC=2                                               12100001
         B     DOCSVC             COMMON SVC HANDLING ROUTINE           12150001
         SPACE                                                          12200001
*---------------------------------------------------------------------* 12250001
* SVC 0/15 APPENDAGE                                                    12300001
*                                                                       12350001
* CALL I/F: IOS FOR SVC 0/15 AND LOGICAL UNIT ASSIGNED TO SYSLOG DEVICE 12400001
* INPUT:  R1 = CCB ADDRESS                                              12450001
*         R6 = DISP, R8 = TIB POINTER, RA = TCB POINTER                 12500001
*         RD = BASE ADDRESS, RE = RETURN ADDRESS                        12550001
* OUTPUT: NONE                                                          12600001
* AMODE:  24                                                            12650001
* RETURNS ONLY IF ROUTER NOT ACTIVE (CAUSES SYSERROR HW)                12700001
*---------------------------------------------------------------------* 12750001
* SGLINK DOCSVC0,S,INPUT=(R6,RD,RE),WORK=(R0,R2,R9,RC,RE,RF)            12800001
DOCSVC0  DS    0H                                                       12850001
         LA    R0,DOCFSVC0        FUNCTION CODE FOR SVC 0/15            12900001
         B     DOCSVC             COMMON SVC HANDLING ROUTINE           13000001
         SPACE                                                          13050001
*---------------------------------------------------------------------* 13100001
* MGCRE                                                                 13150001
*                                                                       13200001
* CALL I/F: SIMSVC FOR MVS SVC 34                                       13250001
* CALLER'S REQUIREMENTS: AMODE ANY, SUPERVISOR STATE                    13300001
* INPUT:  R1 = ADDRESS OF PARAMETER LIST (IEZMGCRE)                     13350001
*         R6 = DISP, R8 = TIB POINTER, RA = TCB POINTER                 13400001
*         RB = SAVE AREA ADDRESS                                        13450001
* OUTPUT: IN TASK SAVE AREA                                             13500001
*         RF = RETURN CODE, R0 = REASON CODE                            13550001
* AMODE:  24                                                            13600001
*---------------------------------------------------------------------* 13650001
SVCMGCR  DS    0H                                                       13700001
         L     RD,DOCBASE         BASE ADDRESS                          13750001
         LA    R0,DOCFMGCR        FUNCTION CODE FOR MGCRE               14000001
         B     DOCSVC             COMMON SVC HANDLING ROUTINE           14100001
         SPACE                                                          14150001
*---------------------------------------------------------------------- 14200001
* SVC 30                                                                14250001
*                                                                       14300001
* CALL I/F: ENTSVC FOR SVC 30                                           14350001
* CALLER'S REQUIREMENTS: AMODE ANY                                      14400001
* INPUT:  R0 IN SAVE AREA (MUST BE 0)                                   14450001
*         R1 = ADDRESS OF PARAMETER LIST                                14500001
*         R6 = DISP, R8 = TIB POINTER, RA = TCB POINTER                 14550001
* OUTPUT: USER REGISTERS IN TASK SAVE AREA                              14600001
*         RF = RETURN CODE                                              14650001
* AMODE:  24                                                            14700001
*---------------------------------------------------------------------- 14750001
SVC30    DS    0H                                                       14800001
         L     RD,DOCBASE         BASE ADDRESS                          14850001
         LA    R0,DOCFSV30        FUNCTION CODE FOR SVC 30              14900001
*        SGCOV SGDOC,MC=3                                               14950001
         B     DOCSVC             COMMON SVC HANDLING ROUTINE           15000001
         SPACE                                                          15050001
*---------------------------------------------------------------------* 15100001
* COMMON SVC INVOCATION ROUTINE FOR                                     15150001
* WTO/WTOR, SVC 32, SVC 0/15 APPENDAGE, DOM, MGCRE, SVC 30              15200001
* AMODE:  24                                                            15250001
*---------------------------------------------------------------------- 15300001
DOCSVC   DS    0H                                                       15350001
         LR    R2,R0              SAVE FUNCTION CODE FOR LATER          15400001
DOCSVCCR BAL   RC,DOCCALL         CALL ROUTER PHASE IN SVA              15427701
* SGLINK DOCCALL,INPUT=(R0,R1,R6,RA,RC,RD),OUTPUT=(R0,RF),              15455401
*              WORK=(R5,R7,R9,RE)                                       15483201
         B     DOCSVCR(RF)        HANDLE RETURN CODE                    15500001
DOCSVCR  B     DOCSVCR0           RETURN CODE 0, OK                     15550001
         B     DOCSVCR4           RETURN CODE 4, WAIT                   15600001
         B     DOCSVCR8           RETURN CODE 8, ERROR                  15650001
         B     DOCSVCRC           RETURN CODE 12, NOT AVAILABLE         15700001
         B     DOCREIPL           RETURN CODE 16, RE-IPL                15725001
         SPACE                                                          15750001
DOCSVCR4 LR    R3,R0              GET WAIT REASON CODE                  15767501
         L     R5,ASRQTAB         ADDRESS OF RESOURCE TABLE             15776201
         B     DOCSVCWT(R3)                                             15785001
DOCSVCWT B     DOCSVCWA           WAIT FOR AUTOMATIC STORAGE            15802501
         B     DOCSVCWB           WAIT FOR MESSAGE BUFFERS              15820001
         USING TCBADR,RA                                                15837501
         L     RB,TCBATCBE        POINT TO TCB EXTENSION                15855001
         AMODESW SET,AMODE=31,WR=(RF)  SWITCH TO 31-BIT MODE   @KXA0130 15863701
         USING TCBXADR,RB                                               15872501
         TM    TCSRBMB2,TCSRBMU   STILL NO REPLY ID'S AVAILABLE         15890001
         BO    DOCSVCWR           YES, HAVE TO WAIT                     15907501
         AMODESW SET,AMODE=24,WR=(RF)  SWITCH BACK TO 24-BIT   @KXA0130 15916201
*        SGCOV SGDOC,MC=4                                               15928101
         LR    R0,R2              NO, RESTORE FUNCTION CODE             15940001
         B     DOCSVCCR           AND RETRY                             15955001
DOCSVCWR LA    R5,SRQDOCB-SRQTAB(R5)  RESOURCE QUEUE FOR BUFFERS        15970001
         LA    R1,TCSRBM          WAIT ARGUMENT                         15985001
*        SGCOV SGDOC,MC=5                                               15994701
         B     RESVCX             GO WAIT                               16004501
         DROP  RA,RB                                                    16009001
DOCSVCWA LA    R5,SRQDOCA-SRQTAB(R5)  AUTOMATIC STORAGE QUEUE           16013501
         SR    R1,R1              CLEAR WAIT ARGUMENT                   16018001
*        SGCOV SGDOC,MC=6                                               16022501
         B     RESVCX             GO WAIT                               16027001
DOCSVCWB LA    R5,SRQDOCB-SRQTAB(R5)  RESOURCE QUEUE FOR BUFFERS        16031501
         SR    R1,R1              CLEAR WAIT ARGUMENT                   16036001
*        SGCOV SGDOC,MC=7                                               16040501
         B     RESVCX             GO WAIT                               16045001
         SPACE                                                          16050001
DOCSVCR8 LR    R3,R0              GET CANCEL REASON CODE                16100001
         LR    RF,R6              WHEN EXITING TO ERRGO                 16200001
*        SGCOV SGDOC,MC=8                                               16225001
         B     DOCSVCRS(R3)                                             16250001
DOCSVCRS B     EXIT               ACCEPT UNRECOVERABLE I/O ERROR        16300001
         B     ERR25              INVALID ADDRESS                       16350001
         B     DOCSVCCP           INVALID CHANNEL PROGRAM               16400001
         B     ERR21              INVALID PARAMETERS                    16450001
         LA    RB,DOCCNUIO        UNRECOVERABLE I/O ERROR               16500001
*        SGCOV SGDOC,MC=9                                               16525001
         B     ERRGO                                                    16550001
DOCSVCCP LA    RB,DOCCNCCW        CODE FOR INVALID CHANNEL PROGRAM      16600001
*        SGCOV SGDOC,MC=10                                              16625001
         B     ERRGO                                                    16650001
DOCSVCRC LR    R3,R2              FUNCTION CODE                         16687501
         SLL   R3,2               TIMES 4                               16725001
         B     DOCSVCFC(R3)       BRANCH BY SVC FUNCTION CODE           16762501
DOCSVCFC EQU   *-4                                                      16806201
         B     DOCSVCNA           WTO/WTOR, GIVE RETURN CODE            16850001
         B     DOCSVCNA           OLD WTO/WTOR, GIVE RETURN CODE        16900001
         B     DISPMVS            DOM, JUST EXIT                        16950001
         B     DOCSVCCN           SVC 0/15, RETURN TO IOS               17000001
         B     DOCSVCNA           MGCRE, GIVE RETURN CODE               17050001
         B     DOCSVCNA           SVC 30, GIVE RETURN CODE              17100001
DOCSVCNA L     RA,TCBPTR               *                                17150001
         L     RB,TCBSAVE-TCBADR(RA)   * TEMPORARY                      17200001
         USING SVEARA,RB               * CODE                           17250001
         LA    RF,DOCRCNAU             *                                17275001
         ST    RF,SVER0F               *                                17300001
         DROP  RB                      *                                17350001
         B     DOCSVCRT                *                                17400001
DOCSVCCN BR    RE                 RETURN TO IOS                         17450001
         SPACE                                                          17500001
DOCSVCR0 LR    R3,R2              SAVED FUNCTION CODE                   17550001
         SLL   R3,2                                                     17600001
         B     DOCSVCF0(R3)       BRANCH BY SVC FUNCTION CODE           17650001
DOCSVCF0 EQU   *-4                                                      17700001
         B     DOCSVCJA           WTO/WTOR, UPDATE SIO COUNTER          17750001
         B     DOCSVCJA           OLD WTO/WTOR, UPDATE SIO COUNTER      17800001
         B     DISPMVS            DOM, JUST EXIT                        17850001
         B     DOCSVCJA           SVC 0/15, UPDATE SIO COUNTER          17900001
         B     DISPMVS            MGCRE, JUST EXIT                      17950001
         B     EXIT               SVC 30, JUST EXIT                     18000001
DOCSVCJA L     R5,PIBPTR2                                               18050001
         L     R5,PIBPCB-PIB2ADR(R5)  PCB OF SERVICE OWNER              18100001
         USING PCBADR,R5                                                18150001
         L     R7,PCBTSIO                                               18200001
         AH    R7,H1              UPDATE TOTAL I/O COUNTER              18250001
         ST    R7,PCBTSIO                                               18300001
         TM    SUPVFLAG,JAACT     IS ACCOUNTING ACTIVE ?                18350001
         BZ    DOCSVCRT           NO, SKIP UPDATE OF DETAIL COUNTER     18400001
         TM    SYSFLAG2,IPLBIT    IPL IN PROGRESS ?                     18450001
         BO    DOCSVCRT           YES, SKIP                             18500001
         L     R8,TIBPTR                                                18550001
         USING TIBADR,R8                                                18600001
         TM    TIBFLAG2,OVHIND    TO BE ACCOUNTED AS OVERHEAD ?         18650001
         BO    DOCSVCRT           YES, SKIP                             18700001
         DROP  R8                                                       18750001
*        SGCOV SGDOC,MC=11                                              18775001
         LA    R3,SYSLOG                                                18800001
         AR    R3,R3                                                    18850001
         A     R3,PCEALUB         SYSLOG LUB                            18900001
         SLR   R4,R4              CLEAR FOR INSERT                      18950001
         ICM   R4,2,1(R3)         HIGH ORDER BYTE OF PUB INDEX          19000001
         BNM   DOCSVCJB           IS IT USED ?                          19050001
         SLR   R4,R4              NO, CLEAR AGAIN                       19100001
DOCSVCJB IC    R4,0(R3)           PUB INDEX OF SYSLOG DEVICE            19150001
         SLL   R4,2               OFFSET IN PUX ADDRESS VECTOR          19200001
         L     R8,APBXAREA                                              19250001
         L     R8,0(R4,R8)        PUBX OF SYSLOG DEVICE                 19300001
         USING PBXADR,R8                                                19350001
         L     R8,PBXJAOFF        OFFSET OF SIO COUNTER                 19400001
         DROP  R8                                                       19450001
         A     R8,PCBCNT          ADDRESS OF SIO COUNTER                19500001
         DROP  R5                                                       19550001
         L     R7,0(R8)                                                 19600001
         AH    R7,H1              UPDATE FOR SERVICE OWNER              19650001
         ST    R7,0(R8)                                                 19700001
DOCSVCRT LR    R3,R2              FUNCTION CODE                         19718101
         SLL   R3,2               TIMES 4                               19736201
         B     DOCSVCEX(R3)       BRANCH BY SVC FUNCTION CODE           19754301
DOCSVCEX EQU   *-4                                                      19772401
         B     DISPMVS            NEW WTO/WTOR                          19790501
         B     EXIT               OLD WTO/WTOR                          19808601
         B     DISPMVS            DOM                                   19826701
         B     EXIT               SVC 0/15                              19844801
         B     DISPMVS            MGCRE                                 19862901
         B     EXIT               SVC 30                                19881401
         SPACE                                                          19900001
*---------------------------------------------------------------------- 19950001
* MCSOPER                                                               20000001
*                                                                       20050001
* CALLER: CONSOLE APPLICATION VIA PROGRAM CALL                          20100001
* CALLER'S REQUIREMENTS: AMODE 31, SUPERVISOR STATE                     20150001
* INPUT:  R1 = ADDRESS OF PARAMETER LIST (IEAVG116)                     20200001
*         R4 = BASE ADDRESS (SET BY PROGRAM CALL)                       20250001
* OUTPUT: RF = RETURN CODE, R0 = REASON CODE                            20300001
* AMODE:  24                                                            20350001
*---------------------------------------------------------------------- 20400001
PCMCSOP  DS    0H                                                       20450001
         L     RD,LPPARM-LPA(,R4) BASE ADDR IN RIGHT REGISTER  @D62XDMZ 20500000
         LA    RF,DOCFMCSO        FUNCTION CODE FOR MCSOPER             20550001
         B     DOCPC              COMMON PC HANDLING ROUTINE            20650001
         SPACE                                                          20700001
*---------------------------------------------------------------------- 20750001
* MCSOPMSG                                                              20800001
*                                                                       20850001
* CALLER: CONSOLE APPLICATION VIA PROGRAM CALL                          20900001
* CALLER'S REQUIREMENTS: AMODE 31, SUPERVISOR STATE                     20950001
* INPUT:  R1 = ADDRESS OF PARAMETER LIST (IEAVG116)                     21000001
*         R4 = BASE ADDRESS (SET BY PROGRAM CALL)                       21050001
* OUTPUT: RF = RETURN CODE, R0 = REASON CODE                            21100001
*         R1 = MDB-ADDRESS, AR1 = MDB-ALET (CURRENTLY 0)                21150001
* AMODE:  24                                                            21200001
*---------------------------------------------------------------------- 21250001
PCMCSMG  DS    0H                                                       21300001
         L     RD,LPPARM-LPA(,R4) BASE ADDR IN RIGHT REGISTER  @D62XDMZ 21350000
         LA    RF,DOCFMCSM        FUNCTION CODE FOR MCSOPER             21400001
         B     DOCPC              COMMON PC HANDLING ROUTINE            21500001
         SPACE                                                          21550001
*---------------------------------------------------------------------- 21600001
* COMMON PC INVOCATION ROUTINE                                          21650001
*                                                                       21700001
* CALLER: PCMCSOP, PCMCSMG                                              21750001
* AMODE:  24                                                            21800001
*---------------------------------------------------------------------- 21850001
DOCPC    DS    0H                                                       21900001
         L     R6,ADISPSER                                              21950001
         LA    R0,8               COPY LINKAGE STACK TO SAVE AREA       22000001
         AMODESW CALL,REGS=(R7,R6)                                      22050001
* SGLINK DISPSER8,INPUT=(R0,R6,R7),WORK=(R2,R3,R4)                      22100001
         L     R6,DISPAD          DISPATCHER ADDRESS                    22150001
         L     R8,TIBPTR          TIB OF CURRENT TASK                   22200001
         L     RA,TCBPTR          TCB OF CURRENT TASK                   22250001
         LR    R0,RF              ROUTER FUNCTION CODE                  22750001
         LR    R2,R0              SAVE IT FOR LATER                     22800001
DOCPCALL BAL   RC,DOCCALL         CALL ROUTER PHASE IN SVA              22850001
* SGLINK DOCCALL,INPUT=(R0,R1,R6,RA,RC,RD),OUTPUT=(R0,RF),              22866601
*              WORK=(R5,R7,R9,RE)                                       22883201
         L     RB,TCBSAVE-TCBADR(RA)     AND TASK SAVE AREA             22950001
         USING SVEARA,RB                                                22975001
         B     DOCPCRC(RF)        HANDLE RETURN CODE                    23000001
DOCPCRC  B     DOCPCRC0           RETURN CODE 0, OK                     23050001
         B     DOCPCRC4           RETURN CODE 4, WAIT                   23100001
         B     DOCPCRC8           RETURN CODE 8, NOT EXPECTED           23150001
         B     DOCPCRCC           RETURN CODE 12, NOT AVAILABLE         23200001
         B     DOCREIPL           RETURN CODE 16, RE-IPL                23215201
DOCPCRC4 L     RC,ASRQTAB         ADDRESS OF RESOURCE TABLE             23230501
         LA    R5,SRQDOCA-SRQTAB(RC)                                    23261001
         LTR   R0,R0              WAIT FOR AUTOMATIC STORAGE ?          23291601
         BZ    DOCPCRWT           YES                                   23333201
*        SGCOV SGDOC,MC=12                                              23368601
         LA    R5,SRQDOCB-SRQTAB(RC)  NO, WAIT FOR BUFFERS              23404101
DOCPCRWT SR    R1,R1              ZERO WAIT ARGUMENT                    23433301
         BAL   RC,RWAIT                                                 23466601
* SGLINK RWAIT INPUT=(R5,RC)                                            23500001
         L     R1,SVER01          RESTORE PARMLIST ADDRESS              23600001
         LR    R0,R2              RESTORE FUNCTION CODE                 23700001
         B     DOCPCALL           CALL ROUTER AGAIN                     23750001
         SPACE                                                          23800001
DOCPCRC8 SLR   R0,R0              SERVICE ROUTINE FAILURE               23839501
         ST    R0,SVER00          SET ZERO REASON CODE                  23879001
         LA    RF,DOCRCOPF        MCSOPER SERVICE FAILURE               23918501
         LA    R0,DOCFMCSO        MCSOPER FUNCTION CODE                 23958001
         CR    R2,R0              WAS IT MCSOPER ?                      23997501
         BE    DOCPCRCF           YES                                   24037001
         LA    RF,DOCRCOMF        NO, MCSOPMSG SERVICE FAILURE          24076501
DOCPCRCF ST    RF,SVER0F          RETURN CODE TO SAVE AREA              24116001
         B     DOCPCRC0           RETURN TO CALLER                      24155501
DOCPCRCC LA    RF,DOCRCNAU        USER RC FOR 'NOT AVAILABLE'           24195001
         ST    RF,SVER0F          GIVE BAD RETURN CODE                  24234501
*        SGCOV SGDOC,MC=13                                              24284501
         SPACE                                                          24350001
DOCPCRC0 LM    RF,R1,SVER0F       GET ROUTER RETURN REGISTERS           24450001
         DROP  RB                                                       24500001
         USING TCBADR,RA                                                24520001
         L     R9,TCBARSAV        ACCESS REGISTER SAVE AREA             24540001
         LAM   R1,R1,4(R9)        LOAD ACCESS REGISTER 1 (MDB)          24560001
         DROP  RA                                                       24580001
         STM   RF,R1,ERARF        RESTORED FROM ERA BY PR SERVICE       24615001
         L     R6,ADISPSER                                              24650001
         LA    R0,12              RESTORE USERTID STATUS AND PR         24687501
         SLR   R1,R1                                                    24725001
         AMODESW CALL,REGS=(R7,R6)  DOES NOT RETURN                     24762501
* SGLINK DISPSERC,INPUT=(R0,R1,R6,R7),WORK=(R2,R3)                      24800001
         SPACE                                                          25750001
*---------------------------------------------------------------------* 25800001
* SVC 3 APPENDAGE                                                       25850001
*                                                                       25900001
* CALL I/F: SVC 3 ROUTINE UNCONDITIONALLY                               25950001
* INPUT:  R8 = TIB POINTER, RA = TCB POINTER                            26000001
*         RD = BASE ADDRESS, RE = RETURN ADDRESS                        26050001
* OUTPUT: NONE                                                          26100001
* AMODE:  24                                                            26150001
*---------------------------------------------------------------------* 26200001
* SGLINK DOCSVC3,S,INPUT=(R6,R7,R9,RA,RD,RE),                           26233301
*              WORK=(R0,R1,R3-R5,R8,RC,RF)                              26266601
DOCSVC3  DS    0H                                                       26300001
         MVI   RID+D1,REENTRID    **** TEMPORARY ****                   26325001
         LR    R3,RE              SAVE RETURN ADDRESS                   26350001
         LR    R4,R7              SAVE TERMINATOR RETURN ADDRESS        26383301
         LR    R8,R9              SAVE TERMINATOR BASE ADDRESS          26416601
DOCSVC3C LA    R0,DOCFSVC3        FUNCTION CODE FOR QUIESCE             26450001
         BAL   RC,DOCCALL         CALL ROUTER PHASE IN SVA              26550001
* SGLINK DOCCALL,INPUT=(R0,R1,R6,RA,RC,RD),OUTPUT=(R0,RF),              26566601
*              WORK=(R5,R7,R9,RE)                                       26583201
         B     DOCSVC3R(RF)       HANDLE RETURN CODE                    26600001
DOCSVC3R B     DOCSVC3E           RETURN CODE 0, EXIT                   26650001
         B     DOCSVC34           RETURN CODE 4, WAIT                   26700001
         B     DOCSVC3E           RETURN CODE 8, EXIT (NOT EXPECTED)    26750001
         B     DOCSVC3E           RETURN CODE 12, EXIT (NOT EXPECTED)   26800001
         B     DOCSVC3E           RETURN CODE 16, EXIT (NOT EXPECTED)   26812501
DOCSVC34 L     RC,ASRQTAB         ADDRESS OF RESOURCE TABLE             26825001
         LA    R5,SRQDOCA-SRQTAB(RC)                                    26850001
*        SGCOV SGDOC,MC=14                                              26865001
         LTR   R0,R0              WAIT FOR AUTOMATIC STORAGE ?          26880001
         BZ    DOCSVC3W           YES                                   26885001
         LA    R5,SRQDOCB-SRQTAB(RC)  NO, WAIT FOR BUFFERS              26890001
DOCSVC3W SR    R1,R1              ZERO WAIT ARGUMENT                    26895001
         BAL   RC,RWAIT                                                 26900001
* SGLINK RWAIT INPUT=(R5,RC)                                            26950001
         B     DOCSVC3C           CALL ROUTER AGAIN                     27000001
DOCSVC3E L     R6,DISPAD          RESTORE DISPATCHER ADDRESS            27050001
         L     RD,APBASE          SGAP BASE ADDRESS                     27100001
         L     RC,ASVC03-SGAP(RD) RESTORE SVC03 BASE                    27150001
         LR    R7,R4              RESTORE TERMINATOR RETURN ADDRESS     27183301
         LR    R9,R8              RESTORE TERMINATOR BASE ADDRESS       27216601
         BR    R3                 RETURN TO SVC03                       27250001
         SPACE                                                          27300001
*---------------------------------------------------------------------* 27350001
* EOT APPENDAGE                                                         27400001
*                                                                       27450001
* CALLER: ENDTERM VIA BAL, UNCONDITIONALLY                              27500001
* INPUT:  R8 = TIB POINTER, RA = TCB POINTER                            27550001
*         RD = BASE ADDRESS, RE = RETURN ADDRESS                        27600001
* OUTPUT: NONE                                                          27650001
*---------------------------------------------------------------------* 27700001
* SGLINK DOCEOT,S,INPUT=(R8,RA,RD,RE),WORK=(R0-R5,R7-RF)                27750001
DOCEOT   DS    0H                                                       27800001
         LR    R3,RE              SAVE RETURN ADDRESS                   27850001
DOCEOTC  LA    R0,DOCFEOT         FUNCTION CODE FOR END OF TASK         27900001
         BAL   RC,DOCCALL         CALL ROUTER PHASE IN SVA              28000001
* SGLINK DOCCALL,INPUT=(R0,R6,RA,RC,RD),OUTPUT=(R0,RF),                 28016601
*              WORK=(R5,R7,R9,RE)                                       28033201
         B     DOCEOTRC(RF)       HANDLE RETURN CODE                    28050001
DOCEOTRC B     DOCEOTRT           RETURN CODE 0, EXIT                   28100001
         B     DOCEOTR4           RETURN CODE 4, WAIT                   28150001
         B     DOCEOTRT           RETURN CODE 8, EXIT (NOT EXPECTED)    28200001
         B     DOCEOTRT           RETURN CODE 12, EXIT (NOT EXPECTED)   28250001
         B     DOCREIPL           RETURN CODE 16, RE-IPL                28262501
DOCEOTR4 L     RC,ASRQTAB         ADDRESS OF RESOURCE TABLE             28275001
         LA    R5,SRQDOCA-SRQTAB(RC)  WAIT FOR AUTOMATIC STORAGE        28300001
*        SGCOV SGDOC,MC=15                                              28315001
         LTR   R0,R0              WAIT FOR AUTOMATIC STORAGE ?          28330001
         BZ    DOCEOTWT           YES                                   28335001
         LA    R5,SRQDOCB-SRQTAB(RC)  NO, WAIT FOR BUFFERS              28340001
DOCEOTWT SR    R1,R1              ZERO WAIT ARGUMENT                    28345001
         BAL   RC,RWAIT                                                 28350001
* SGLINK RWAIT INPUT=(R5,RC)                                            28400001
         B     DOCEOTC            CALL ROUTER AGAIN                     28450001
DOCEOTRT L     R6,DISPAD          RESTORE DISPATCHER ADDRESS            28500007
         BR    R3                 RETURN TO EOT                         28550001
         SPACE                                                          28600001
*---------------------------------------------------------------------* 28650001
* RE-IPL ROUTINE                                                        28652501
*                                                                       28655001
* CALLED WHEN ROUTER RETURNS WITH RC 16 (DOCRCIPL) FROM SVC 0, WTOR,    28657501
* MCSOPER OR EOT-APPENDAGE, AFTER DETECTING A PENDING REPLY THAT        28660001
* COULD NOT BE ROUTED TO ANY CONSOLE, WHILE OPERATING MODE IS REMOTE    28662501
*---------------------------------------------------------------------* 28665001
DOCREIPL TM    IJBFLG07,IJBRIPRO+IJBRDACC IS IPL EXPECTED      @D31PDAP 28667501
         BNZ   ERR21              YES, ====================>>> @D31PDAP 28670001
         SLR   R0,R0              CLEAR REGISTER               @D31PDAP 28672501
         L     RC,ADOREIPL        ADDRESS OF REIPL ROUTINE     @D31PDAP 28675001
         LA    R1,DOCUAPL         ADDRESS OF PARAMETER LIST    @D61CDFG 28677501
         BR    RC                 REIPL====================>>> @D31PDAP 28680001
DOCUAPL  DC    A(DOCUAID)                                      @D61CDFG 28682501
         DC    A(DOCUASS)                                      @D31PDAP 28685001
DOCUAID  DC    CL8' '             DUMP IDENTIFICATION          @D61CDFG 28687501
DOCUASS  DC    AL2(L'DOCUACC)     LENGTH OF CHARACTER CONSTANT @D61CDFG 28690001
DOCUACC  DC    C'PIDS/568606606 RIDS/SGDOC AB/UNATREAD'        @D61CDFG 28692501
         SPACE                                                          28695001
*---------------------------------------------------------------------* 28697501
* HCF INITIALIZE                                                        28700001
*                                                                       28750001
* CALL I/F: IJBSHCF VIA AMODESW TO ADDRESS IN ADOCHCIN                  28800001
* INPUT:  RE = RETURN ADDRESS                                           28850001
*         RF = ENTRY ADDRESS                                            28900001
* OUTPUT: RF = RETURN CODE                                              28950001
* AMODE:  24                                                            29000001
*---------------------------------------------------------------------* 29050001
* SGLINK DOCHCIN,S,INPUT=(RE,RF),OUTPUT=RF,WORK=(R0,R1)                 29100001
DOCHCIN  DS    0H                                                       29150001
         L     RD,DOCBASE                                               29200001
         CLC   TID,DOCHCTID       CALLED BY HCF TASK           @D66ODOW 29250005
         BE    DOCHCINC           YES, CONTINUE                         29300001
*        SGCOV SGDOC,MC=16                                              29325001
         LA    RF,DOCRCINV        BAD RETURN CODE                       29350001
         BR    RE                 RETURN TO CALLER                      29450001
DOCHCINC LA    R0,DOCFHCIN        FUNCTION CODE FOR HCF INITIALIZE      29500001
         LA    RF,DOCHCAR                                               29600001
         BAKR  0,RF               SAVE STATUS AND CALL COMMON ROUTINE   29650001
         BR    RE                 RETURN TO CALLER                      29700001
         SPACE                                                          29750001
*---------------------------------------------------------------------* 29800001
* HCF REQUEST                                                           29850001
*                                                                       29900001
* CALL I/F: IJBSHCF VIA AMODESW TO ADDRESS IN ADOCHCRQ                  29950001
* INPUT:  RE = RETURN ADDRESS                                           30000001
*         RF = ENTRY ADDRESS                                            30050001
* OUTPUT: NONE                                                          30100001
* AMODE:  24                                                            30150001
*---------------------------------------------------------------------* 30200001
* SGLINK DOCHCRQ,S,INPUT=(RE,RF),WORK=(RF,R0,R1)                        30250001
DOCHCRQ  DS    0H                                                       30300001
         L     RD,DOCBASE                                               30350001
         CLC   TID,DOCHCTID       CALLED BY HCF TASK           @D66ODOW 30410005
         BE    DOCHCRQC           YES, CONTINUE                         30450001
*        SGCOV SGDOC,MC=17                                              30475001
         LA    RF,DOCRCINV        BAD RETURN CODE                       30500001
         BR    RE                 RETURN TO CALLER                      30600001
DOCHCRQC LA    R0,DOCFHCRQ        FUNCTION CODE FOR HCF INITIALIZE      30650001
         LA    RF,DOCHCAR                                               30750001
         BAKR  0,RF               SAVE STATUS AND CALL COMMON ROUTINE   30800001
         BR    RE                 RETURN TO CALLER                      30850001
         SPACE                                                          30900001
*---------------------------------------------------------------------* 30950001
* AR INITIALIZE                                                         31000001
*                                                                       31050001
* CALL I/F: IJBAR VIA AMODESW TO ADDRESS IN ADOCARIN                    31100001
* INPUT:  R1 = ECB ADDRESS                                              31150001
*         RE = RETURN ADDRESS                                           31200001
*         RF = ENTRY ADDRESS                                            31250001
* OUTPUT: RF = RETURN CODE                                              31300001
* AMODE:  24                                                            31350001
*---------------------------------------------------------------------* 31400001
* SGLINK DOCARIN,S,INPUT=(R1,RE,RF),OUTPUT=RF,WORK=(R0,R1,RD)           31450001
DOCARIN  DS    0H                                                       31500001
         L     RD,DOCBASE                                               31550001
         CLC   TID,ARTIDH         CALLED BY AR TASK            @D66ODOW 31600005
         BE    DOCARINC           YES, CONTINUE                         31650001
*        SGCOV SGDOC,MC=18                                              31675001
         LA    RF,DOCRCINV        BAD RETURN CODE                       31700001
         BR    RE                 RETURN TO CALLER                      31800001
DOCARINC LA    R0,DOCFARIN        FUNCTION CODE FOR AR INITIALIZE       31850001
         LA    RF,DOCHCAR                                               31950001
         BAKR  0,RF               SAVE STATUS AND CALL COMMON ROUTINE   32000001
         BR    RE                 RETURN TO CALLER                      32050001
         SPACE                                                          32100001
*---------------------------------------------------------------------* 32150001
* AR REQUEST                                                            32200001
*                                                                       32250001
* CALL I/F: IJBAR VIA AMODESW TO ADDRESS IN ADOCARRQ                    32300001
* INPUT:  RE = RETURN ADDRESS                                           32350001
*         RF = ENTRY ADDRESS                                            32400001
* OUTPUT: NONE                                                          32450001
* AMODE:  24                                                            32500001
*---------------------------------------------------------------------* 32550001
* SGLINK DOCARRQ,S,INPUT=(RE,RF),OUTPUT=RF,WORK=(R0,R1,RD)              32600001
DOCARRQ  DS    0H                                                       32650001
         L     RD,DOCBASE                                               32700001
         CLC   TID,ARTIDH         CALLED BY AR TASK            @D66ODOW 32710005
         BE    DOCARRQC           YES, CONTINUE                         32800001
*        SGCOV SGDOC,MC=19                                              32825001
         LA    RF,DOCRCINV        BAD RETURN CODE                       32850001
         BR    RE                 RETURN TO CALLER                      32950001
DOCARRQC LA    R0,DOCFARGC        FUNCTION CODE FOR AR INITIALIZE       33000001
         LA    RF,DOCHCAR                                               33100001
         BAKR  0,RF               SAVE STATUS AND CALL COMMON ROUTINE   33150001
         BR    RE                 RETURN TO CALLER                      33200001
         SPACE                                                          33250001
*---------------------------------------------------------------------* 33300001
* COMMON HC/AR SERVICE ROUTINE                                          33350001
*                                                                       33400001
* CALLER: DOCHCIN, DOCHCRQ, DOCARIN, DOCHCRQ                            33450001
* AMODE:  24                                                            33500001
*---------------------------------------------------------------------- 33550001
DOCHCAR  DS    0H                                                       33600001
         LR    RF,R0              SAVE FUNCTION CODE                    33650001
         L     R6,ADISPSER                                              33700001
         LA    R0,8               COPY LINKAGE STACK TO SAVE AREA       33750001
         AMODESW CALL,REGS=(R7,R6)                                      33800001
* SGLINK DISPSER8,INPUT=(R0,R6,R7),WORK=(R2,R3,R4)                      33850001
         LR    R0,RF              ROUTER FUNCTION CODE                  33900001
         LR    R2,R0              SAVE IT FOR LATER                     33950001
         L     R6,DISPAD          DISPATCHER ADDRESS                    33966601
         L     RA,TCBPTR          CURRENT TCB                           33983201
DOCHCARC BAL   RC,DOCCALL         CALL ROUTER PHASE IN SVA              34000001
* SGLINK DOCCALL,INPUT=(R0,R1,R6,RA,RC,RD),OUTPUT=(R0,RF),              34033301
*              WORK=(R5,R7,R9,RE)                                       34066601
         L     RB,TCBSAVE-TCBADR(RA)     GET TASK SAVE AREA             34108301
         B     DOCHCARR(RF)       HANDLE RETURN CODE                    34150001
DOCHCARR B     DOCHCART           00, RETURN CODE FROM SAVE AREA        34200001
         B     DOCHCAR4           04, WAIT                              34250001
         B     DOCHCARP           08, PASS IT TO CALLER                 34300001
         B     DOCHCARP           0C, PASS IT TO CALLER                 34350001
DOCHCAR4 L     RC,ASRQTAB         ADDRESS OF RESOURCE TABLE             34400001
         LA    R5,SRQDOCA-SRQTAB(RC)                                    34450001
*        SGCOV SGDOC,MC=20                                              34491601
         LTR   R0,R0              WAIT FOR AUTOMATIC STORAGE ?          34533301
         BZ    DOCHCARW           YES                                   34541601
         LA    R5,SRQDOCB-SRQTAB(RC)  NO, WAIT FOR BUFFERS              34562401
DOCHCARW SR    R1,R1              ZERO WAIT ARGUMENT                    34583301
         BAL   RC,RWAIT           ROUTER RETURNS WAIT ARGUMENT IN R1    34616601
* SGLINK RWAIT INPUT=(R5,RC)                                            34650001
         USING SVEARA,RB                                                34700001
         L     R1,SVER01          RESTORE PARMLIST ADDRESS              34750001
         DROP  RB                                                       34800001
         LR    R0,R2              RESTORE FUNCTION CODE                 34850001
         B     DOCHCARC           CALL ROUTER AGAIN                     34900001
         USING SVEARA,RB                                                34950001
DOCHCART L     RF,SVER0F          GET ROUTER RETURN CODE                35000001
         DROP  RB                                                       35050001
DOCHCARP LR    R0,R2              RESTORE FUNCTION CODE                 35076601
         STM   RF,R1,ERARF        RESTORED FROM ERA BY PR SERVICE       35103201
         L     R6,ADISPSER                                              35129801
         LA    R0,12              RESTORE USERTID STATUS AND PR         35156401
         SLR   R1,R1                                                    35183201
         AMODESW CALL,REGS=(R7,R6)   DOES NOT RETURN                    35208201
* SGLINK DISPSERC,INPUT=(R0,R1,R6,R7),WORK=(R2,R3)                      35233301
         SPACE                                                          35350001
         DROP  R6                                                       35400001
*---------------------------------------------------------------------* 35450001
* COMMON ROUTER INVOCATION ROUTINE FOR ALL ROUTER FUNCTIONS             35500001
* AMODE:  24                                                            35600001
*---------------------------------------------------------------------- 35650001
* SGLINK DOCCALL,S,INPUT=(R0,R1,R6,RA,RC,RD),OUTPUT=(R0,RF),            35666601
*              WORK=(R5,R7,R9,RE)                                       35683201
DOCCALL  DS    0H                                                       35700001
         USING TCBADR,RA                                                35750001
         TM    TCBFLAG2,NOPAGING  DOES TASK TOLERATE PAGE FAULTS        35800001
         BO    DOCCAL10                                                 35850001
         DROP  RA                                                       35900001
*        SGCOV SGDOC,MC=21                                              35925001
         ICM   R9,15,DOCASTSA     GET ADDRESS OF STANDARD AREA          35950001
         BNZ   DOCCAL20           AVAILABLE, BRANCH                     36000001
*        SGCOV SGDOC,MC=22                                              36025001
DOCCAL10 ICM   R9,15,DOCASTFA     USE FIXED AREA                        36050001
         BNZ   DOCCAL60           AVAILABLE, OK                         36100001
         LA    RF,DOCRCNAV        NOT AVAILABLE                         36150001
         BR    RC                 RETURN TO CALLER                      36250001
DOCCAL20 L     R5,ASRQTAB         ADDRESS OF RESOURCE TABLE             36283301
         LA    R5,SRQDOCA-SRQTAB(R5)  AUTOMATIC STORAGE QUEUE           36316601
         USING RQADR,R5                                                 36350001
         LH    RE,RSCDESC         IS STANDARD AREA IN USE      @D66ODOW 36400005
         N     RE,DOCCAMSK                                     @D66ODOW 36401005
         LTR   RE,RE                                           @D66ODOW 36410005
         BNZ   DOCCAL30           YES, GO FOR ADDITIONAL AREA  @D66ODOW 36450005
         OC    RSCDESC,TID        NO, TAKE IT                  @D66ODOW 36500005
         B     DOCCAL60                                                 36550001
DOCCAMSK DC    A(32767)                                        @D66ODOW 36560005
         DROP  R5                                                       36600001
DOCCAL30 EQU   *                                                        36625001
*        SGCOV SGDOC,MC=23                                              36650001
         CLC   DOCASTAS,DOCASTMS  MAXIMUM ALREADY TAKEN                 36675001
         BL    DOCCAL50           NO, TRY TO GET ONE MORE               36700001
DOCCAL40 LA    RF,DOCRCWT         INDICATE WAIT NEEDED                  36750001
*        SGCOV SGDOC,MC=24                                              36800001
         SLR   R0,R0              FOR AUTOMATIC STORAGE                 36850001
         BR    RC                 RETURN TO CALLER                      36950001
DOCCAL50 LR    R6,R0              SAVE FUNCTION CODE                    37000001
         LR    R7,R1              AND PARM.LIST POINTER, IF ANY         37050001
*        SGCOV SGDOC,MC=25                                              37075001
         LH    R0,DOCASTSS        NEEDED SIZE                           37100001
         LA    R1,DOCASTSP        SUBPOOL                               37150001
         SGETVIS LENGTH=(0),SPID=(1),ADDRESS=(9),LOC=ANY                37200001
         LTR   RF,RF              DID WE GET IT ?                       37250001
         BNZ   DOCCAL40           NO, MUST WAIT                         37300001
*        SGCOV SGDOC,MC=26                                              37325001
         AH    R0,DOCASTAS        INCREMENT TOTAL SIZE                  37350001
         STH   R0,DOCASTAS        AND SAVE IT                           37400001
         LR    R0,R6              RESTORE FUNCTION CODE                 37450001
         LR    R1,R7              AND PARM.LIST POINTER                 37500001
         USING DOCASTHD,R9                                              37550001
DOCCAL60 AMODESW SET,AMODE=31,WR=(RF)  SWITCH TO 31-BIT MODE            37600001
         MVC   DOCASTHE,DOCASTEC  INSERT EYE CATCHER                    37650001
         LH    RF,DOCASTSS        SIZE OF AREA                          37700001
         BCTR  RF,0               MINUS ONE                             37750001
         AR    RF,R9                                                    37800001
         ST    RF,DOCASTHL        INITIALIZE UPPER LIMIT                37850001
         LA    RE,LDOCASTH(R9)    ADDRESS BEYOND HEADER                 37900001
         ST    R9,0(RE)           PASS HEADER POINTER IN SAVE AREA      37950001
         LA    RF,DOCSAVAL(RE)    POINT BEYOND SAVE AREA                38000001
         ST    RF,DOCASTHC        INITIALIZE CURRENT WORK POINTER       38050001
         ST    RF,DOCASTHH        INITIALIZE HIGH WATER MARK            38100001
         DROP  R9                                                       38150001
         ICM   RF,15,DOCENTRY     ROUTER ENTRY POINT                    38250001
         BNZ   DOCCAL65           OK, CALL ROUTER                       38300001
         LA    RF,DOCRCNAV        NOT AVAILABLE                         38350001
         B     DOCCAL66           SKIP ROUTER INVOCATION                38450001
         DROP  RD                                                       38500001
DOCCAL65 LR    RD,RE              SAVE AREA POINTER IN RIGHT REG        38537501
         LR    R6,R0              SAVE FUNCTION CODE                    38575001
         AMODESW CALL,REGS=(RE,RF)                                      38612501
* SGLINK $IJBCSIO,INPUT=(R0,R1,RE,RF),OUTPUT=(R0,R1,RF)                 38650001
         L     RD,DOCBASE         RESTORE BASE REGISTER                 38750001
         USING SGDOC,RD                                                 38800001
         STM   R0,R6,DOCCALSA     SAVE REGISTERS               @DY45712 38810013
         L     R6,ADISPSER        ADDR OF DISPSERV             @DY45712 38820013
         LA    R0,20              RE-ESTABLISH TASK DU-AL      @DY45712 38830013
         BASSM R7,R6                                           @DY45712 38840013
*SGLINK DISPSERV,INPUT=(R0,R6,R7),WORK=(R0,R2,R3)              @DY45712 38850013
         LM    R0,R6,DOCCALSA     RESTORE REGISTERS            @DY45712 38851013
         USING DOCASTHD,R9                                              38894006
DOCCAL66 BCTR  R6,0               FUNCTION CODE MINUS 1                 38900001
         SLL   R6,1               TIMES 2                               38950001
         L     R7,DOCASTHH        GET HIGH WATER MARK                   39000001
         SR    R7,R9              SIZE OF USED STORAGE                  39050001
         CH    R7,DOCASTFM(R6)    LARGER THAN CURRENT MAXIMUM SIZE      39100001
         BNH   DOCCAL70           NO                                    39150001
         STH   R7,DOCASTFM(R6)    YES, STORE NEW MAXIMUM SIZE           39200001
DOCCAL70 AMODESW SET,AMODE=24,WR=(R7)                                   39250001
         L     R6,DISPAD          RESTORE DISPATCHER ADDRESS            39300001
         C     R9,DOCASTFA        DID WE USE FIXED AREA ?               39350001
         BER   RC                 YES, WE ARE DONE                      39400001
         C     R9,DOCASTSA        DID WE USE STANDARD AREA ?            39500001
         BNE   DOCCAL80           NO, NEED TO FREE ADDITIONAL AREA      39550001
         L     R5,ASRQTAB         ADDRESS OF RESOURCE TABLE             39583301
         LA    R5,SRQDOCA-SRQTAB(R5)  POINT TO RESOURCE QUEUE           39616601
         USING RQADR,R5                                                 39650001
         NC    RSCDESC,FREEVAL    RESET OWNER INDICATION       @D66ODOW 39700005
         DROP  R5                                                       39750001
         B     DOCCAL90           GO POST WAITERS                       39800001
DOCCAL80 LR    R5,RF              SAVE RETURN CODE                      39850001
         LR    R6,R0              SAVE CONDITION CODE                   39900001
*        SGCOV SGDOC,MC=27                                              39925001
         LH    R0,DOCASTSS        SIZE TO BE FREED                      39950001
         SFREEVIS LENGTH=(0),ADDRESS=(9)                                40000001
         LH    RF,DOCASTAS        DECREMENT TOTAL SIZE                  40050001
         SR    RF,R0                OF ALLOCATED ADDITIONAL             40100001
         STH   RF,DOCASTAS          AUTOMATIC STORAGE                   40150001
         LR    RF,R5              RESTORE RETURN CODE                   40200001
         LR    R0,R6              RESTORE CONDITION CODE                40250001
         L     R6,DISPAD          RESTORE DISPATCHER ADDRESS            40300001
         USING DISP,R6                                                  40350001
         L     R5,ASRQTAB         ADDRESS OF RESOURCE TABLE             40377701
         LA    R5,SRQDOCA-SRQTAB(R5)  AUTOMATIC STORAGE WAIT QUEUE      40405401
DOCCAL90 LR    R9,RF              SAVE ROUTER RETURN CODE               40433301
         SLR   R1,R1              NO WAIT ARGUMENT FOR AUTOM.STORAGE    40466601
         BAL   RF,RPOST           POST ANY WAITERS                      40500001
*SGLINK  RPOST,INPUT=(R5,R6,RF),WORK=(R5,RE)                            40525001
         LR    RF,R9              RESTORE RETURN CODE                   40575001
         BR    RC                 RETURN TO CALLER                      40600001
         DROP  R6                                                       40650001
DOCCALSA DC    7F'0'              SAVEAREA FOR REGISTERS       @DY45712 40651013
         EJECT                                                          40700001
*********************************************************************** 40750001
* HCF TASK INITIAL ENTRY                                                40800001
*                                                                       40850001
* CALL I/F: DISPATCHER VIA LPSW                                         40900001
* INPUT:  RD = BASE ADDRESS                                             40950001
* OUTPUT: NONE                                                          41000001
* AMODE: 24                                                             41050001
*                                                                       41100001
* HANDLE THE INITIALIZATION OF THE HCF SUPPORT WHICH                    41150001
* IS PERFORMED UNDER CONTROL OF THE HCF SYSTEM TASK.                    41200001
*                                                                       41250001
* THE HCF SYSTEM TASK'S SAVE AREA IS SETUP BY THE                       41300001
* SYSTEM INITIALLY IN ORDER TO INVOKE THE HCF SUPPORT                   41350001
* INITIALIZATION AS SOON AS THE HCF SYSTEM TASK GETS                    41400001
* CONTROL THE FIRST TIME. (POSTED BY SGAP)                              41450001
*                                                                       41500001
* SGSHCF PASSES CONTROL TO $IJBPHCF IN THE SVA IN                       41550001
* ORDER TO CONTINUE WITH/COMPLETE THE INITIALIZATION.                   41600001
*                                                                       41650001
* AT COMPLETION OF THE INITIALIZATION THE HCF                           41900001
* SYSTEM TASK ENTERS WAIT.                                              41950001
*                                                                       42000001
* THE HCF TASK IS POSTED BY THE CONSOLE ROUTER                          42050001
* WHENEVER THERE IS WORK TO DO FOR IT. THIS MACRO                       42100001
* ISSUES THE WAIT AND PASSES CONTROL TO $IJBPHCF                        42150001
*---------------------------------------------------------------------- 42200001
HCFTASK  DS    0H                                                       42250001
         OI    HCFLG1,HCFW4INT     INITIALIZATION IN PROGRESS  @KXA1587 42300001
         L     R2,ASVASVDL         GET ENTRY POINT OF $IJBPHCF          42450001
         USING SVASVDL,R2                                               42475001
         L     RF,AIJBPHCF                                              42500001
         DROP  R2                                              @DCR0360 42525001
         LTR   RF,RF               DID WE GET AN ADDRESS                42550001
         BZ    SHCEOJ              NO, TERMINATE HCF TASK      @KXA1587 42587501
         ST    RF,HCFENTRY         SAVE ADDRESS                         42625001
         LA    R0,SHCOINIT         R0*=OFFSET TO HCF INITIALIZATION     42650001
         LA    R1,SHCFECB          LOAD ADDRESS OF WOE ECB              42700001
         AMODESW CALL,AMODE=31,REGS=(RE,RF)                             42800001
         L     RD,DOCBASE          RESTORE BASE ADDRESS                 42850001
         LTR   RF,RF               INITIALIZED OK ?            @KXA1587 42862501
         BNZ   SHCEOJ              NO, TERMINATE HCF TASK      @KXA1587 42875001
         NI    HCFLG1,XFF-HCFW4INT INITIALIZATION COMPLETE     @KXA1587 42887501
SHCFWAIT WAIT  (R1)                LET HCF TASK WAIT FOR WARK           42900001
         TM    2(R1),SHCTRBIT      STAGE III TRANSITION ?      @DCR0360 42907101
         BZ    SHCFPROC            NO, NORMAL PROCESSING       @DCR0360 42914201
         NI    2(R1),XFF-SHCTRBIT  RESET TRANSITION FLAG       @DCR0360 42921301
         OI    HCFLG1,HCFW4INT     INITIALIZATION IN PROGRESS  @KXA1587 42924801
         L     R2,ASVASVDL         SUPERVISOR SVA DIRECTORY    @DCR0360 42928401
         USING SVASVDL,R2                                      @DCR0360 42935501
         L     RF,AIJBPHCF         GET 31-BIT SVA ENTRY POINT  @DCR0360 42942601
         DROP  R2                                              @DCR0360 42949701
         LTR   RF,RF               DID WE GET AN ADDRESS       @KXA1587 42952001
         BZ    SHCEOJ              NO, TERMINATE HCF TASK      @KXA1587 42954301
         ST    RF,HCFENTRY         SAVE NEW ADDRESS            @DCR0360 42956801
         LA    R0,SHCOINIT         INITIALIZE AGAIN            @DCR0360 42963901
         LA    R1,SHCFECB          LOAD ADDRESS OF WOE ECB     @DCR0360 42971001
         AMODESW CALL,AMODE=31,REGS=(RE,RF)                    @DCR0360 42978101
         L     RD,DOCBASE          RESTORE BASE ADDRESS        @DCR0360 42985201
         LTR   RF,RF               INITIALIZED OK ?            @KXA1587 42986901
         BNZ   SHCEOJ              NO, TERMINATE HCF TASK      @KXA1587 42988601
         NI    HCFLG1,XFF-HCFW4INT INITIALIZATION COMPLETE     @KXA1587 42990301
SHCFPROC XC    SHCFECB,SHCFECB     RESET TRAFFIC BIT           @DCR0360 42992301
         L     RF,HCFENTRY         GET SAVED ENTRY ADDRESS              43000001
         LA    R0,SHCOPROC         REQUEST RETURN TO $IJBPHCF           43100001
         LA    R1,SHCFECB          LOAD ADDRESS OF WOE ECB              43150001
         AMODESW CALL,AMODE=31,REGS=(RE,RF)                             43250001
         L     RD,DOCBASE          RESTORE BASE ADDRESS                 43300001
         LTR   RF,RF               INITIALIZED OK ?            @KXA1587 43316601
         BNZ   SHCEOJ              NO, TERMINATE HCF TASK      @KXA1587 43333201
         B     SHCFWAIT                                                 43350001
         SPACE                                                          43400001
*-----------------------------------------------------------*           43450001
*        THE HCF SYSTEM TASK'S CANCEL EXIT ROUTINE          *  @KXA1587 43500001
*-----------------------------------------------------------*           43550001
HCFERRAD DS    0H                                                       43583301
         USING TIBADR,R8                                       @KXA1587 43591601
         MVI   TIBCNCL,X00         RESET CANCEL CODE           @KXA1587 43599901
         DROP  R8                                              @KXA1587 43608201
         MVI   RID+1,USERTID       LEAVE EXIT ENVIRONMENT      @KXA1587 43616601
         L     RD,DOCBASE          LOAD BASE ADDRESS                    43650001
         TM    HCFLG1,HCFW4INT     INITIALIZING ?              @KXA1587 43662501
         BO    SHCEOJ              YES, TERMINATE              @KXA1587 43675001
         TM    HCFLG1,HCFW4LOG     ENTERED WHILE LOGGING ?     @KXA1587 43687501
         BZ    SHCEXIT2            NO, SKIP                    @KXA1587 43700001
         SLR   R0,R0                                           @KXA1587 43712501
         IC    R0,HCFERTOT         INCREMENT                   @KXA1587 43725001
         A     R0,F1                 NUMBER OF                 @KXA1587 43737501
         STC   R0,HCFERTOT             SEVERE ERRORS           @KXA1587 43750001
         CLI   HCFERTOT,HCFERMAX   NOW ABOVE THRESHOLD ?       @KXA1587 43762501
         BH    SHCEOJ              YES, TERMINATE HCF TASK     @KXA1587 43775001
SHCEXIT2 L     RF,HCFENTRY         NO, GET SAVED ENTRY ADDRESS @KXA1587 43787501
         LA    R0,SHCOEXIT         R0*=OFFS T TO AB EXIT RTN EXTENSION  43800001
         AMODESW CALL,AMODE=31,REGS=(RE,RF)                             43850001
         L     RD,DOCBASE          RESTORE BASE ADDRESS                 43900001
         LTR   RF,RF               WAS RECOVERY SUCCESSFULL ?  @KXA1587 43930001
         BNZ   SHCEOJ              NO, TERMINATE HCF TASK      @KXA1587 43960001
         LA    R1,SHCFECB          LOAD ADDRESS OF WOE ECB     @KXA1587 43990001
         B     SHCFWAIT            GO WAIT FOR WORK            @KXA1587 44020001
         SPACE                                                          44050001
*-----------------------------------------------------------*           44100001
*        TERMINATE THE HC FILE SUPPORT                      *           44150001
*-----------------------------------------------------------*           44200001
SHCEOJ   DS    0H                                                       44250001
         WTO   TEXT=SHCTMSG,ROUTCDE=2,DESC=1                   @KXA1587 44300001
         SPACE 2                                                        44450001
*-----------------------------------------------------------*           44500001
*        SHCFADR - HCF TASK DEACTIVATION ROUTINE            *  @KXA1587 44550001
*-----------------------------------------------------------*           44700001
HCFSTADR DS    0H                                                       44750001
         L     RD,DOCBASE         RESTORE BASE ADDRESS         @KXA1587 44775001
         NI    HCFLG1,XFF-HCFW4BUF RESET WAITING FOR BEFFERS   @KXA1587 44800001
         OI    HCFLG1,HCFW4WRK    INDICATE NORMAL WAIT         @KXA1587 44825001
         LA    R1,SHCFECBD        DUMMY ECB                    @KXA1587 44850001
         WAIT  (R1)               SHOULD NEVER BE POSTED       @KXA1587 44875001
         SPACE 2                                                        44900001
*-----------------------------------------------------------*           44950001
*        SAVED HCF ENTRY ADDRESS IN SVA                     *           44958301
*-----------------------------------------------------------*           44966601
HCFENTRY DC    A(0)               SAVED HCF ENTRY POINT                 44974901
         SPACE 2                                                        44983201
*-----------------------------------------------------------*           44991501
*        AB EXIT SAVE AREA                                  *           45000001
*-----------------------------------------------------------*           45050001
SHCXSAVE DC    18F'0'             SAVE AREA FOR ABEND EXIT              45450001
         SPACE 2                                                        45500001
*-----------------------------------------------------------*           45550001
*        ECB                                                *           45600001
*-----------------------------------------------------------*           45650001
SHCFECB  DC    F'0'                STANDARD HCF ECB                     45700001
SHCFECBD DC    F'0'                DUMMY TERMINATION ECB       @KXA1587 45706201
         SPACE 2                                                        45712401
*-----------------------------------------------------------*           45718601
*        TERMINATION MESSAGE                                *           45724801
*-----------------------------------------------------------*           45731001
SHCTMSG  DC    AL2(L'SHCTMSGT)     LENGTH OF MESSAGE           @KXA1587 45737201
SHCTMSGT DC    C'0D38E HCF TASK HAS TERMINATED'                @KXA1587 45743401
         SPACE 2                                                        45750001
*-----------------------------------------------------------*           45800001
*        OFFSETS TO THE ADDRESSES OF THE VARIOUS EXTENSION  *           45850001
*        ROUTINES CONTAINED IN THE PHASE $IJBPHCF           *           45900001
*-----------------------------------------------------------*           45950001
SHCOINIT EQU   04                 OFFSET TO A(INITALIZATION)            46000001
SHCOEXIT EQU   08                 OFFSET TO A(AB EXIT ROUTINE)          46050001
SHCOPROC EQU   12                 OFFSET TO A(PROCESS ROUTER REQUEST)   46100001
SHCTRBIT EQU   X'40'              STAGE III TRANSITION FLAG    @DCR0360 46125001
*-----------------------------------------------------------*           46150001
         CNOP  0,4                FORCE FULLWORD ALIGNMENT              46162501
CRTTAB   EQU   *                                                        46175001
         CRTGEN ,                 HCF COMMUNICATION AREA                46187501
         EJECT                                                          46200001
*********************************************************************** 46250001
* CST TASK INITIAL ENTRY                                                46300001
*                                                                       46350001
* CALL I/F: DISPATCHER VIA LPSW                                         46400001
* INPUT:  RD = BASE ADDRESS                                             46450001
* OUTPUT: NONE                                                          46500001
* AMODE: 24                                                             46550001
*---------------------------------------------------------------------* 46600001
CSTTASK  DS    0H                                                       46650001
         L     RF,ASVASVDL                                              46700001
         ICM   RF,15,AIJBCRT-SVASVDL(RF)  ENTRY POINT OF CRT MODULE     46750001
         BZ    CSTSTADR           NOT AVAILABLE, DEACTIVATE             46800001
         SLR   R1,R1              RELOCATION OFFSET IS ZERO             46825001
         AMODESW CALL,REGS=(RE,RF)                                      46850001
* SGLINK IJBCST,INPUT=(RE,RF)                                           46900001
         SPACE                                                          46950001
*---------------------------------------------------------------------* 47000001
* CST TASK DEACTIVATION ROUTINE                                         47050001
*                                                                       47100001
*---------------------------------------------------------------------* 47150001
CSTSTADR DS    0H                                                       47200001
         TSTOP                                                          47250001
         SPACE                                                          47275001
*---------------------------------------------------------------------* 47300001
* CST TASK LOAD ROUTINE                                                 47303301
*                                                                       47306601
* CALL I/F: BALR RE,RF FROM CST CODE IN SVA                             47309901
* INPUT:  R0 = ADDRESS OF LOADPOINT                                     47313201
*         R1 = ADDRESS OF PHASE NAME                                    47316501
*         RE = RETURN ADDRESS                                           47319801
* OUTPUT: RF = LOAD RETURN CODE                                         47323101
* AMODE: 31                                                             47326401
*---------------------------------------------------------------------* 47329701
* SGLINK CSTLOAD,S,INPUT=(R0,R1,RE,RF),OUTPUT=(RF),WORK=R1              47333001
CSTLOAD  DS    0H                                                       47336301
         USING *,RF                                                     47337901
         MVC   CSTPHNAM,0(R1)     COPY PHASENAME FROM 31-BIT            47338401
         LA    R1,CSTPHNAM        ADDRESS OF LOCAL COPY                 47338901
         LOAD  (1),(0),RET=YES                                          47339601
         DROP  RF                                                       47341201
         BR    RE                 RETURN TO CALLER                      47342801
CSTPHNAM DC    CL8' '                                                   47344401
*---------------------------------------------------------------------* 47346201
* SYSLOG ATTENTION PROCESSOR                                            47350001
*                                                                       47400001
* CALL I/F: IOS FOR ATTENTION INTERRUPT ON SYSLOG DEVICE                47450001
* INPUT:  RD = BASE ADDRESS                                             47500001
* OUTPUT: NONE                                                          47550001
* AMODE: 24                                                             47600001
*---------------------------------------------------------------------* 47650001
* SGLINK CSTATTN,S,INPUT=(R6,RD,RE),WORK=(R7,R8,RF)                     47700001
CSTATTN  DS    0H                                                       47750001
         OI    CSTAECB+2,TRABIT   POST CST ATTENTION ECB                47756601
         LH    R8,DOCCSTID        TASK ID OF CST SYSTEM TASK            47763201
         LR    R7,RE              SAVE RETURN ADDRESS                   47769801
         USING DISP,R6                                                  47776401
         BAL   RF,IOPOST0         POST CST WHEN I/O BOUND               47783001
* SGLINK IOPOST0,INPUT=(R6,R8,RF),WORK=(R8,RE)                          47789601
         DROP  R6                                                       47796201
         LR    RE,R7              RESTORE RETURN ADDRESS                47802801
         BR    RE                 RETURN TO INTERRUPT HANDLER           47809401
         SPACE                                                          47816601
         SGCSTDAT DSECT=NO                                              47833301
         DROP  RD                                              @DCR0360 47841601
         AIF (NOT &SGDOC  OR NOT &BGDEBUG).DOCPRNT                      47850001
         PRINT NOGEN                                                    47900001
.DOCPRNT ANOP                                                           47950001
         EJECT                                                          48000001
.END     ANOP                                                           48050001
         MEND  ,  */                                                    48100001
*                                                                       48150001
* %MDOCTAB:;                                                            48200001
* DECLARE                                                               48250001
* 1 DOCTAB  BASED  BDY(WORD),                                           48300001
*   2 ADOCHCIN  PTR(31),          /* ENTRY FOR HCF INITIALIZE        */ 48350001
*   2 ADOCHCRQ  PTR(31),          /* ENTRY FOR HCF REQUEST           */ 48400001
*   2 ADOCHCCM  PTR(31),          /* A(DOC/HCF COMM. AREA)           */ 48450001
*   2 ADOCARIN  PTR(31),          /* ENTRY FOR AR INITIALIZE         */ 48500001
*   2 ADOCARRQ  PTR(31),          /* ENTRY FOR AR REQUEST            */ 48550001
*   2 ADOCARCM  PTR(31),          /* A(DOC/AR COMM. AREA)            */ 48600001
*   2 AARCANCL  PTR(31),          /* A(AR CANCEL ROUTINE)            */ 48650001
*   2 DOCENTRY  PTR(31),          /* ROUTER ENTRY POINT              */ 48675001
*   2 DOCWORKA  PTR(31),          /* ADDR.OF ROUTER WORK AREA        */ 48700001
*   2 DOCWECB   BIN(32),          /* ROUTER WAIT ECB                 */ 48750001
*   2 DOCNCSAP  PTR(31),          /* NEW CSA POINTER FOR IPL CONSOLE */ 48775001
*   2 DOCIPLID  BIN(16),          /* TID OF IPL = BG MAINTASK        */ 48800001
*   2 DOCARTID  BIN(16),          /* TID OF AR TASK                  */ 48850001
*   2 DOCSPTID  BIN(16),          /* TID OF SPT TASK                 */ 48900001
*   2 DOCCSTID  BIN(16),          /* TID OF CST TASK                 */ 48950001
*   2 DOCHCTID  BIN(16),          /* TID OF HCF TASK                 */ 49000001
*   2 *         BIN(16),          /* PLACE HOLDER                    */ 49050001
*   2 DOCASTFA  PTR(31),          /* ADDRESS OF FIXED AUTOM.STORAGE  */ 49100001
*   2 DOCASTSA  PTR(31),          /* ADDRESS OF STAND. AUTOM.STORAGE */ 49150001
*   2 DOCASTSP  CHAR(8),          /* AUTOMATIC STORAGE SUBPOOL       */ 49183301
*   2 DOCAVMCF  PTR(31),          /* VMCF ENTRY POINT FOR SPT TASK   */ 49199901
*   2 DOCAARCR  PTR(31),          /* ADDRESS OF AR COMREG            */ 49216601
*   2 DOCAVMCR  PTR(31),          /* VMCF ENTRY POINT FOR ROUTER     */ 49220301
*   2 DOCAVEND  PTR(31),          /* ADDR. OF DOC VENDOR EXIT BLOCK  */ 49224001
*   2 DOCACSTD  PTR(31);          /* ADDRESS OF CST DATA AREA        */ 49227701
*/*------------------------------------------------------------------*/ 49250001
*/* FUNCTION CODES FOR CONSOLE ROUTER REQUESTS                       */ 49300001
*/*------------------------------------------------------------------*/ 49350001
* DECLARE                                                               49400001
*   DOCFWTOR    BIN(8) CONSTANT(1),  /* WTO/WTOR REQUEST             */ 49450001
*   DOCFSV32    BIN(8) CONSTANT(2),  /* OLD WTO/WTOR (SVC 32)        */ 49500001
*   DOCFDOM     BIN(8) CONSTANT(3),  /* DOM REQUEST                  */ 49550001
*   DOCFSVC0    BIN(8) CONSTANT(4),  /* INTERCEPTED SVC 0/15         */ 49600001
*   DOCFMGCR    BIN(8) CONSTANT(5),  /* MGCRE REQUEST                */ 49650001
*   DOCFSV30    BIN(8) CONSTANT(6),  /* SVC 30 REQUEST               */ 49700001
*   DOCFMCSO    BIN(8) CONSTANT(7),  /* MCSOPER REQUEST              */ 49750001
*   DOCFMCSM    BIN(8) CONSTANT(8),  /* MCSOPMSG REQUEST             */ 49800001
*   DOCFSVC3    BIN(8) CONSTANT(9),  /* QUIESCE REQUEST              */ 49850001
*   DOCFEOT     BIN(8) CONSTANT(10), /* EOT CLEAN-UP REQUEST         */ 49900001
*   DOCFHCIN    BIN(8) CONSTANT(11), /* HCF INITIALIZE REQUEST       */ 49950001
*   DOCFHCRQ    BIN(8) CONSTANT(12), /* HCF REQUEST                  */ 50000001
*   DOCFARIN    BIN(8) CONSTANT(13), /* AR INITIALIZE REQUEST        */ 50050001
*   DOCFARGC    BIN(8) CONSTANT(14); /* AR GET_COMMAND REQUEST       */ 50100001
*/*------------------------------------------------------------------*/ 50150001
*/* RETURN AND REASON CODES FOR CONSOLE ROUTER REQUESTS              */ 50200001
*/*------------------------------------------------------------------*/ 50250001
* DECLARE                                                               50300001
*   DOCRCOK     BIN(8) CONSTANT(0),  /* RETURN CODE FOR COMPLETE     */ 50350001
*   DOCRCWT     BIN(8) CONSTANT(4),  /* RETURN CODE FOR WAIT         */ 50400001
*   DOCRSWAS    BIN(8) CONSTANT(0),  /* WAIT FOR AUTOMATIC STORAGE   */ 50450001
*   DOCRSWBF    BIN(8) CONSTANT(4),  /* WAIT FOR BUFFERS             */ 50500001
*   DOCRSWRP    BIN(8) CONSTANT(8),  /* WAIT FOR TASK REPLY ID       */ 50525001
*   DOCRCINV    BIN(8) CONSTANT(8),  /* RETURN CODE FOR CANCEL       */ 50550001
*   DOCRSACC    BIN(8) CONSTANT(0),  /* ACCEPT UNRECOVERABLE ERROR   */ 50600001
*   DOCRSADR    BIN(8) CONSTANT(4),  /* INVALID ADDRESS              */ 50650001
*   DOCRSCCW    BIN(8) CONSTANT(8),  /* INVALID CHANNEL PROGRAM      */ 50700001
*   DOCRSPRM    BIN(8) CONSTANT(12), /* INVALID PARAMETERS           */ 50750001
*   DOCRSUIO    BIN(8) CONSTANT(16), /* UNRECOVERABLE I/O ERROR      */ 50800001
*   DOCRCNAV    BIN(8) CONSTANT(12), /* RETURN CODE FOR NOT AVAILABLE*/ 50837501
*   DOCRCIPL    BIN(8) CONSTANT(16); /* RE-IPL WHEN OPERATING REMOTE */ 50875001
*/*------------------------------------------------------------------*/ 50900001
*/* CANCEL CODES FOR CONSOLE ROUTER REQUESTS                         */ 50950001
*/*------------------------------------------------------------------*/ 51000001
* DECLARE                                                               51050001
*   DOCCNUIO    BIN(8) CONSTANT('1A'X), /* UNRECOVERABLE I/O ERROR   */ 51100001
*   DOCCNCCW    BIN(8) CONSTANT('39'X); /* INVALID CHANNEL PROGRAM   */ 51150001
*/*------------------------------------------------------------------*/ 51152701
*/* LAY-OUT OF AUTOMATIC STORAGE HEADER                              */ 51155401
*/*------------------------------------------------------------------*/ 51158101
* DECLARE                                                               51160801
* 1 DOCASTHD  BASED  BDY(WORD),                                         51163501
*   2 DOCASTHE  CHAR(4),             /* EYE CATCHER                  */ 51166201
*   2 DOCASTHC  PTR(31),             /* CURRENT WORK POINTER         */ 51168901
*   2 DOCASTHH  PTR(31),             /* HIGH WATER MARK              */ 51171601
*   2 DOCASTHL  PTR(31);             /* ADDRESS OF LAST BYTE         */ 51174301
*/*------------------------------------------------------------------*/ 51177001
*/* AUTOMATIC STORAGE CONSTANTS                                      */ 51179701
*/*------------------------------------------------------------------*/ 51182401
* DECLARE                                                               51185101
*   LDOCASTH    BIN(16) CONSTANT(LENGTH(DOCASTHD)), /* LENGTH OF HDR */ 51187801
*   DOCASTSS    BIN(16) CONSTANT('2000'X), /* SIZE OF AUTOM.STORAGE  */ 51190501
*   DOCASTEC    CHAR(4) CONSTANT('CAST'), /* EYE CATCHER             */ 51193201
*   DOCSAVAL    BIN(16) CONSTANT(144); /* SIZE OF PLX ESA SAVE AREA  */ 51195901
*/*--------------- END OF  DOCTAB -----------------------------------*/ 51200001
