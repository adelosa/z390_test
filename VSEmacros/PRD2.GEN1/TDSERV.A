*%GOTO   MTDSERV; /*PLS COMMENT TO AVOID UNMATCHED QUOTE PROBLEMS       00010007
         MACRO                                                          00020007
&NAME    TDSERV &FUNC=,                                                X00030007
               &CPUID=,                                                X00040007
               &PARMLIST=,                                             X00050007
               &TASKID=,                                               X00060007
               &PART=,                                                 X00070007
               &AREA=,                                                 X00080007
               &NEWVAL=,                                               X00090007
               &OUTPUT=                                                 00100007
         GBLB  &IJBSGEN                                                 00110007
         LCLA  &FCODE                                                   00120007
         LCLA  &R0VAL                                                   00130007
         LCLB  &FAST                                                    00140007
         LCLB  &R0GEN                                                   00150007
         SPACE 1                                                        00160007
.***************************************************************        00170007
*        SUPERVISOR - TDSERV  - 5686-066-06                    *        00180017
         AGO   .ZZZ                                            *        00190007
*        LICENSED MATERIALS - PROPERTY OF IBM                  *        00200007
*        "RESTRICTED MATERIALS OF IBM"                         *        00210017
*        5686-066                                              *        00220017
*        (C) COPYRIGHT IBM CORP. 1994,2001                     *        00221017
.ZZZ     ANOP                                                  *        00240007
.* /* START OF SPECIFICATIONS **********************************        00250007
.*01  MODULE TYPE      = INTERNAL SERVICE MACRO                *        00260007
.*01  DESCRIPTIVE NAME = REQUEST MULTI-PROCESSOR SERVICE       *        00270007
.*01                     SERVICE FUNCTIONS                     *        00280007
.*01  NOTES            = CHANGE ACTIVITY                       *        00290007
.*    NEW MACRO IN VSE 2.1                                     *        00300007
.*    FUNCTION 156 - SWSYS                                     @D66ODOW 00310018
.*02  PROCESSOR        = ASSEMBLER                             *        00320007
.*END OF SPECIFICATIONS       **********************************        00330007
.*                                                                      00340007
&FAST    SETB  0                                                        00350007
&R0VAL   SETA  0                                                        00360007
&R0GEN   SETB  0                                                        00370007
         AIF   ('&FUNC' EQ 'DSECT').DSECT                               00380007
         AIF   ('&FUNC' EQ 'RSNCODE').RSNCODE                           00390007
         AIF   ('&FUNC' EQ 'TDIDSECT').TDIDSCT                          00400007
.*                                                                      00410007
         AIF   ('&FUNC' NE 'START').STRT004                             00420007
.*       START ALL CPUS OF A CEC                                        00430007
&FCODE   SETA  0                                                        00440007
         AGO   .FUNCEND                                                 00450007
.STRT004 ANOP                                                           00460007
         AIF   ('&FUNC' NE 'STOP').STRT008                              00470007
.*       REQUEST STOP OF ALL CPU'S IN THE CEC                           00480007
&FCODE   SETA  4                                                        00490007
         AGO   .FUNCEND                                                 00500007
.STRT008 AIF   ('&FUNC' NE 'STOPRQ').STRT012                            00510007
.*       DISPATCHER - STOP ALL INDICATED CPU'S                          00520007
.*                    IF ALL INDICATED CPU'S STOPPED PERFORM            00530007
.*                    RESET (SIGP) ON ALL STOPPED CPU'S                 00540007
&FCODE   SETA  8                                                        00550007
         AGO   .FUNCEND                                                 00560007
.STRT012 AIF   ('&FUNC' NE 'STARTS').STRT016                            00570007
.*       START THE SPECIFIED CPU                                        00580007
&FCODE   SETA  12                                                       00590007
         AGO   .FUNCEND                                                 00600007
.STRT016 AIF   ('&FUNC' NE 'STOPS').STRT020                             00610007
.*       REQUEST STOP OF THE SPECIFIED CPU                              00620007
&FCODE   SETA  16                                                       00630007
         AGO   .FUNCEND                                                 00640007
.STRT020 ANOP                                                           00650007
         AIF   ('&FUNC' NE 'SENSE').STRT024                             00660007
.*       CALLED BY SPT-SYSTEM-TASK : BUILD CPU CONTROL BLOCKS           00670007
&FCODE   SETA  20                                                       00680007
         AGO   .FUNCEND                                                 00690007
.STRT024 ANOP                                                           00700007
         AIF   ('&FUNC' NE 'RESTART').STRT028                  @D63NDOW 00710007
.*       CALLED BY SVC31 - STOP ALL CPU'S BUT IPL-CPU                   00720007
.*                         RESTART IPL CPU IF NOT ACTIVE                00730007
.*                         SET CURRENT TASK TO RESVC                    00740007
&FCODE   SETA  24                                                       00750007
         AGO   .FUNCEND                                                 00760007
.STRT028 ANOP                                                           00761007
         AIF   ('&FUNC' NE 'STOPQS').STRT032                   @D63NDOW 00762007
.*       QUIESCE SPECIFIED CPU                                          00763007
&FCODE   SETA  28                                              @D63NDOW 00764007
         AGO   .FUNCEND                                        @D63NDOW 00765007
.STRT032 ANOP                                                           00766007
         AIF   ('&FUNC' NE 'STOPQ').STRT052                    @D63NDOW 00767007
.*       QUIESCE ALL CPU'S IN CEC BUT IPL CPU                           00768007
&FCODE   SETA  32                                              @D63NDOW 00769007
         AGO   .FUNCEND                                        @D63NDOW 00769107
.STRT052 ANOP                                                           00769207
         AIF   ('&FUNC' NE 'ATTSTASK').STRT056                          00769307
.*       ATTACH A SYSTEM TASK                                           00769407
&FCODE   SETA  52                                                       00769507
         AGO   .FUNCEND                                                 00769607
.STRT056 AIF   ('&FUNC' NE 'TDINFO').STRT060                   @D67BDOW 00769723
.*       RETRIEVE TD INFORMATION                                        00769807
&FCODE   SETA  56                                                       00769907
         AGO   .FUNCEND                                                 00770007
.STRT060 AIF   ('&FUNC' NE 'USERSVC').STRT096                  @D67BDOW 00771023
.*       EXECUTE USER CODE AS A SVC APPENDAGE                           00772021
&FCODE   SETA  60                                              @D67BDOW 00773023
         AGO   .FUNCEND                                        @D67BDOW 00774023
.STRT096 ANOP                                                           00780007
         AIF   ('&FUNC' EQ 'SETNPA').STRT097                            00790007
         AIF   ('&FUNC' NE 'SWITCHNP').STRT100                          00800007
.*       SWITCH FROM PARALLEL TO NON PARALLEL CODE                      00810007
         AGO   .STRT098                                                 00820007
.STRT097 ANOP                                                           00830007
&R0VAL   SETA  1                                                        00840007
.STRT098 ANOP                                                           00850007
&R0GEN   SETB  1                                                        00860007
&FCODE   SETA  96                                                       00870007
&FAST    SETB  1                                                        00880007
         AGO   .FUNCEND                                                 00890007
.STRT100 ANOP                                                           00900007
         AIF   ('&FUNC' EQ 'RESETNPA').STRT101                          00910007
         AIF   ('&FUNC' NE 'SWITCHPU').STRT104                          00920007
.*       SWITCH FROM NON PARALLEL TO PARALLEL CODE                      00930007
         AGO   .STRT102                                                 00940007
.STRT101 ANOP                                                           00950007
&R0VAL   SETA  1                                                        00960007
.STRT102 ANOP                                                           00970007
&R0GEN   SETB  1                                                        00980007
&FCODE   SETA  100                                                      00990007
&FAST    SETB  1                                                        01000007
         AGO   .FUNCEND                                                 01010007
.STRT104 AIF   ('&FUNC' NE 'RESETCNT').STRT108                          01020007
.*       REQUEST CPU COUNTER RESET                                      01030007
&FCODE   SETA  104                                                      01040007
&FAST    SETB  1                                                        01050007
         AGO   .FUNCEND                                                 01060007
.STRT108 AIF   ('&FUNC' NE 'TASKSTOP').STRT112                          01070007
.*       STOP REQUESTED TASK                                            01080007
&FCODE   SETA  108                                                      01090007
&FAST    SETB  1                                                        01100007
         AGO   .FUNCEND                                                 01110007
.STRT112 AIF   ('&FUNC' NE 'TASKSTRT').STRT116                          01120007
.*       RESTART THE REQUESTED TASK                                     01130007
&FCODE   SETA  112                                                      01140007
&FAST    SETB  1                                                        01150007
         AGO   .FUNCEND                                                 01160007
.STRT116 AIF   ('&FUNC' NE 'TASKMOVE').STRT120                          01170007
.*       APPEND CURRENT TASK TO OTHER PARTITION                         01180007
&FCODE   SETA  116                                                      01190007
&FAST    SETB  1                                                        01200007
         AGO   .FUNCEND                                                 01210007
.STRT120 AIF   ('&FUNC' NE 'GETSHARE').STRT124                          01220007
.*       GET CURRENT TIME SHARE OF PARTITION                            01230007
&FCODE   SETA  120                                                      01240007
&FAST    SETB  1                                                        01250007
         AGO   .FUNCEND                                                 01260007
.STRT124 AIF   ('&FUNC' NE 'SETSHARE').STRT128                          01270007
.*       MODIFY TIME SHARE OF PARTITION                                 01280007
&FCODE   SETA  124                                                      01290007
&FAST    SETB  1                                                        01300007
         AGO   .FUNCEND                                                 01310007
.STRT128 AIF   ('&FUNC' NE 'GETPRTY').STRT132                           01320007
.*       RETRIEVE PRTY FIGURES OF A GIVEN TASK                          01330007
&FCODE   SETA  128                                                      01340007
&FAST    SETB  1                                                        01350007
         AGO   .FUNCEND                                                 01360007
.STRT132 AIF   ('&FUNC' NE 'RESETPU').STRT136                           01370007
.*       RESET PARALLEL INDICATION OF ISSUING TASK                      01380007
&FCODE   SETA  132                                                      01390007
&FAST    SETB  1                                                        01400007
         AGO   .FUNCEND                                                 01410007
.STRT136 AIF   ('&FUNC' NE 'SETCR0').STRT140                            01420007
.*       SETS/RESETS CNTRL REG 0 BITS FOR IPL'D CPU                     01430007
.*       (VMCF, IUCV)                                                   01440007
&FCODE   SETA  136                                                      01450007
&FAST    SETB  1                                                        01460007
         AGO   .FUNCEND                                                 01470007
.STRT140 AIF   ('&FUNC' NE 'HARDWAIT').STRT144                          01481008
&FCODE   SETA  140                                                      01484008
&FAST    SETB  1                                                        01485008
         AGO   .FUNCEND                                                 01486008
.STRT144 AIF   ('&FUNC' NE 'SWKEYPU').STRT148                           01486110
.*       SWITCH TO KEY 0 AND CONTINUE IN PARALLEL MODE                  01486210
&FCODE   SETA  144                                                      01486310
&FAST    SETB  1                                                        01486410
         AGO   .FUNCEND                                                 01486510
.STRT148 AIF   ('&FUNC' NE 'SWPROB').STRT152                            01486611
.*       SWITCH TO PARTITION KEY AND CONTINUE IN PARALLEL MODE          01486710
&FCODE   SETA  148                                                      01486810
&FAST    SETB  1                                                        01486910
         AGO   .FUNCEND                                                 01487010
.STRT152 AIF   ('&FUNC' NE 'DEBUG').STRT156                    @D66ODOW 01487116
&FCODE   SETA  152                                             @D66ODOW 01487216
&FAST    SETB  1                                               @D66ODOW 01487316
         AGO   .FUNCEND                                        @D66ODOW 01487416
.STRT156 AIF   ('&FUNC' NE 'SWSYS').STRT160                    @D66ODOW 01487616
.*       SWITCH TO REQUESTED (KEY,STATE) AND CONTINUE IN PARALLEL MODE  01487716
&FCODE   SETA  156                                             @D66ODOW 01487816
&FAST    SETB  1                                               @D66ODOW 01487916
         AGO   .FUNCEND                                        @D66ODOW 01488016
.STRT160 ANOP                                                  @D66ODOW 01489016
         MNOTE 8,'FUNC SPECIFICATION OMITTED OR INVALID'                01490007
         MEXIT                                                          01500007
.FUNCEND ANOP                                                           01510007
.***************************************************************        01520007
.*       CHECK SPECIAL REQUIREMENTS                            *        01530007
.***************************************************************        01540007
         AIF   ('&FUNC'  NE 'STOPRQ').CHKEND                            01550020
         AIF   (&IJBSGEN).CHKEND                                        01570007
         MNOTE 8,'FUNC=''&FUNC'' ONLY ALLOWED WITHIN SUPERVISOR'        01580007
         MEXIT                                                          01590007
.CHKEND  ANOP                                                           01600007
.***************************************************************        01610007
.*       CHECK CPUID SPECIFICATION                             *        01620007
.***************************************************************        01630007
         AIF   ('&FUNC'  EQ 'STARTS').CPUID10                           01640007
         AIF   ('&FUNC'  EQ 'STOPQS').CPUID10                  @D63NDOW 01650007
         AIF   ('&FUNC'  EQ 'STOPS').CPUID10                            01660007
         AIF   (T'&CPUID EQ 'O').CPUEND                                 01670007
         MNOTE 8,'CPUID PARAMETER FOR FUNC=''&FUNC'' NOT ALLOWED'       01680007
         MEXIT                                                          01690007
.CPUID10 ANOP                                                           01700007
         AIF   (T'&CPUID NE 'O').CPUID20                                01710007
         MNOTE 8,'CPUID PARAMETER FOR FUNC=''&FUNC'' REQUIRED'          01720007
         MEXIT                                                          01730007
.CPUID20 ANOP                                                           01740007
         AIF   ('&CPUID'(1,1) EQ '(').CPUEND                            01750007
         MNOTE 8,'ONLY REGISTER NOTATION ALLOWED FOR CPUID PARAMETER'   01760007
         MEXIT                                                          01770007
.CPUEND  ANOP                                                           01780007
.***************************************************************        01790007
.*       CHECK TASKID SPECIFICATION                            *        01800007
.***************************************************************        01810007
         AIF   ('&FUNC'  EQ 'TASKSTOP').TASK010                         01820007
         AIF   ('&FUNC'  EQ 'TASKSTRT').TASK010                         01830007
         AIF   ('&FUNC'  EQ 'DETSTASK').TASK010                         01840007
         AIF   ('&FUNC'  EQ 'GETPRTY').TASK010                          01850007
         AIF   (T'&TASKID EQ 'O').TASKEND                               01860007
         MNOTE 8,'TASKID PARAMETER FOR FUNC=''&FUNC'' NOT ALLOWED'      01870007
         MEXIT                                                          01880007
.TASK010 ANOP                                                           01890007
         AIF   (T'&TASKID NE 'O').TASK020                               01900007
         MNOTE 8,'TASKID PARAMETER FOR FUNC=''&FUNC'' REQUIRED'         01910007
         MEXIT                                                          01920007
.TASK020 ANOP                                                           01930007
         AIF   ('&TASKID'(1,1) EQ '(').TASKEND                          01940007
         MNOTE 8,'ONLY REGISTER NOTATION ALLOWED FOR TASKID PARAMETER'  01950007
         MEXIT                                                          01960007
.TASKEND ANOP                                                           01970007
.***************************************************************        01980007
.*       CHECK PART SPECIFICATION                              *        01990007
.***************************************************************        02000007
         AIF   ('&FUNC'  EQ 'TASKMOVE').PART010                         02010007
         AIF   ('&FUNC'  EQ 'GETSHARE').PART010                         02020007
         AIF   ('&FUNC'  EQ 'SETSHARE').PART010                         02030007
         AIF   (T'&PART EQ 'O').PARTEND                                 02040007
         MNOTE 8,'PART PARAMETER FOR FUNC=''&FUNC'' NOT ALLOWED'        02050007
         MEXIT                                                          02060007
.PART010 ANOP                                                           02070007
         AIF   (T'&PART NE 'O').PART020                                 02080007
         MNOTE 8,'PART PARAMETER FOR FUNC=''&FUNC'' REQUIRED'           02090007
         MEXIT                                                          02100007
.PART020 ANOP                                                           02110007
         AIF   ('&PART'(1,1) EQ '(').PARTEND                            02120007
         MNOTE 8,'ONLY REGISTER NOTATION ALLOWED FOR PART PARAMETER'    02130007
         MEXIT                                                          02140007
.PARTEND ANOP                                                           02150007
.***************************************************************        02160007
.*       CHECK NEWVAL SPECIFICATION                            *        02170007
.***************************************************************        02180007
         AIF   ('&FUNC'  EQ 'SETSHARE').NEWV010                         02190007
         AIF   (T'&NEWVAL EQ 'O').NEWVEND                               02200007
         MNOTE 8,'NEWVAL PARAMETER FOR FUNC=''&FUNC'' NOT ALLOWED'      02210007
         MEXIT                                                          02220007
.NEWV010 ANOP                                                           02230007
         AIF   (T'&NEWVAL NE 'O').NEWV020                               02240007
         MNOTE 8,'NEWVAL PARAMETER FOR FUNC=''&FUNC'' REQUIRED'         02250007
         MEXIT                                                          02260007
.NEWV020 ANOP                                                           02270007
         AIF   ('&NEWVAL'(1,1) EQ '(').NEWVEND                          02280007
         MNOTE 8,'ONLY REGISTER NOTATION ALLOWED FOR NEWVAL PARAMETER'  02290007
         MEXIT                                                          02300007
.NEWVEND ANOP                                                           02310007
.***************************************************************        02320007
.*       CHECK PARMLIST SPECIFICATION                          *        02330007
.***************************************************************        02340007
         AIF   ('&FUNC'  EQ 'ATTSTASK').PARM010                         02350007
         AIF   (T'&PARMLIST EQ 'O').PARMEND                             02360007
         MNOTE 8,'PARMLIST PARAMETER FOR FUNC=''&FUNC'' NOT ALLOWED'    02370007
         MEXIT                                                          02380007
.PARM010 ANOP                                                           02390007
         AIF   (T'&PARMLIST NE 'O').PARMEND                             02400007
         MNOTE 8,'PARMLIST PARAMETER FOR FUNC=''&FUNC'' REQUIRED'       02410007
         MEXIT                                                          02420007
.PARMEND ANOP                                                           02430007
.***************************************************************        02440007
.*       CHECK AREA SPECIFICATION                              *        02450007
.***************************************************************        02460007
         AIF   ('&FUNC'  EQ 'TDINFO').AREA010                           02470007
         AIF   (T'&AREA EQ 'O').AREAEND                                 02480007
         MNOTE 8,'AREA PARAMETER FOR FUNC=''&FUNC'' NOT ALLOWED'        02490007
         MEXIT                                                          02500007
.AREA010 ANOP                                                           02510007
         AIF   (T'&AREA NE 'O').AREAEND                                 02520007
         MNOTE 8,'AREA PARAMETER FOR FUNC=''&FUNC'' REQUIRED'           02530007
         MEXIT                                                          02540007
.AREAEND ANOP                                                           02550007
.***************************************************************        02560007
.*       CHECK OUTPUT SPECIFICATION                            *        02570007
.***************************************************************        02580007
         AIF   ('&FUNC'  EQ 'TDINFO').OUTP010                           02590007
         AIF   (T'&OUTPUT EQ 'O').OUTPEND                               02600007
         MNOTE 8,'OUTPUT PARAMETER FOR FUNC=''&FUNC'' NOT ALLOWED'      02610007
         MEXIT                                                          02620007
.OUTP010 ANOP                                                           02630007
&R0GEN   SETB  1                                                        02640007
         AIF   (T'&OUTPUT EQ 'O' OR '&OUTPUT' EQ 'ALL').OUTPEND         02650007
&R0VAL   SETA  1                                                        02660007
         AIF   ('&OUTPUT' EQ 'COMMON').OUTPEND                          02670007
         MNOTE 8,'INVALID OUTPUT PARAMETER'                             02680007
         MEXIT                                                          02690007
.OUTPEND ANOP                                                           02700007
.***************************************************************        02710007
.*       CREATE CODE                                           *        02720007
.***************************************************************        02730007
&NAME    DS    0H                                                       02740007
         AIF   ('&FUNC'  EQ 'SWSYSU').GENPRV                   @D66ODOW 02750116
         AIF   ('&FUNC'  EQ 'SWKEYPU').GENSWKY                 @D63NDOW 02750214
         AIF   ('&FUNC'  NE 'SWPROB').GEN05                    @D63NDOW 02750314
.GENSWKY ANOP                                                  @D63NDOW 02750414
         SLR   0,0                                             @D63NDOW 02751812
         AGO   .GENPRV                                         @D63NDOW 02751912
.GEN05   ANOP                                                  @D63NDOW 02752012
         AIF   ('&FUNC'  EQ 'RESTART').GENBAL                           02753012
         AIF   ('&FUNC'  EQ 'STOPRQ').GENBAL                            02760007
         AIF   ('&FUNC'  EQ 'SENSE').GENBAL                             02770007
         AIF   (T'&CPUID EQ 'O').GEN10                                  02780007
         AIF   ('&CPUID(1)' EQ '1').GEN10                               02790007
         LR    1,&CPUID(1)                                              02800007
.GEN10   ANOP                                                           02810007
         AIF   (T'&TASKID EQ 'O').GEN20                                 02820007
         AIF   ('&TASKID(1)' EQ '1').GEN20                              02830007
         LR    1,&TASKID(1)                                             02840007
.GEN20   ANOP                                                           02850007
         AIF   (T'&PART EQ 'O').GEN25                                   02860007
         AIF   ('&PART(1)' EQ '1').GEN25                                02870007
         LR    1,&PART(1)                                               02880007
.GEN25   ANOP                                                           02890007
         AIF   (T'&PARMLIST EQ 'O').GEN40                               02900007
         AIF   ('&PARMLIST'(1,1) EQ '(').GEN30                          02910007
         LA    1,&PARMLIST                                              02920007
         AGO   .GEN40                                                   02930007
.GEN30   ANOP                                                           02940007
         AIF   ('&PARMLIST(1)' EQ '1').GEN40                            02950007
         LR    1,&PARMLIST(1)                                           02960007
.GEN40   ANOP                                                           02970007
         AIF   (T'&AREA EQ 'O').GEN60                                   02980007
         AIF   ('&AREA'(1,1) EQ '(').GEN50                              02990007
         LA    1,&AREA                                                  03000007
         AGO   .GEN60                                                   03010007
.GEN50   ANOP                                                           03020007
         AIF   ('&AREA(1)' EQ '1').GEN60                                03030007
         LR    1,&AREA(1)                                               03040007
.GEN60   ANOP                                                           03050007
         AIF   (&R0GEN NE 1).GEN70                                      03060007
         LA    0,&R0VAL                                                 03070007
.GEN70   ANOP                                                           03080007
         AIF   (T'&NEWVAL EQ 'O').GEN80                                 03090007
         AIF   ('&NEWVAL(1)' EQ '0').GEN80                              03100007
         LR    0,&NEWVAL                                                03110007
.GEN80   ANOP                                                           03120007
         AIF   (NOT &IJBSGEN AND &FAST).GENPRV                          03130007
         LA    15,&FCODE                                                03140007
         AIF   (NOT &FAST).GENPP                                        03150007
         O     15,BIT0OMSK                                              03160007
         AGO  .GENPP                                                    03170007
.GENPRV  ANOP                                                           03180007
         L     15,=A(&FCODE+X'80000000')                                03190007
.GENPP   ANOP                                                           03200007
         SVC   117                                                      03210007
         MEXIT                                                          03220007
.GENBAL  ANOP                                                           03230007
         AIF   ('&FUNC'  EQ 'STOPRQ').GENBAL1                           03240007
         STM   0,15,SVCWORK-TCBADR(10)                                  03250007
.GENBAL1 ANOP                                                           03260007
         AIF   (&IJBSGEN).GENBAL2                                       03270007
         L     13,128(,0)                                               03280007
         L     13,IJBSPAVT-SYSCOM(,13)                                  03290007
         L     13,ASVASVDL-SUPAVT(,13)                                  03300007
         AGO   .GENBAL3                                                 03310007
.GENBAL2 ANOP                                                           03320007
         L     13,ASVASVDL                                              03330007
.GENBAL3 ANOP                                                           03340007
         L     13,AIJBTD-SVASVDL(,13)                                   03350007
         LA    15,&FCODE                                                03360007
         BASSM 14,13                                                    03370007
         AIF   ('&FUNC'  EQ 'STOPRQ').GENBAL4                           03380007
         LM    0,15,SVCWORK-TCBADR(10)                                  03390007
         MEXIT                                                          03400007
.GENBAL4 ANOP                                                           03410007
         L     6,DISPAD                                                 03420007
         MEXIT                                                          03430007
.RSNCODE ANOP                                                           03440007
****************************************************************        03450007
*        REASON CODES OF SVC 117                               *        03460007
****************************************************************        03470007
*        REASON CODES, REG 15 CONTAINS RETURN CODE 4                    03480007
TDREAS18 EQU   18    REQUESTED CPU (S) ARE ALREADY ACTIVE               03490007
TDREAS19 EQU   19    REQUESTED CPU IS ALREADY STOPPED                   03500007
*        REASON CODES, REG 15 CONTAINS RETURN CODE 8                    03510007
TDREAS01 EQU   1     CEC IS NOT A MULTIPROCESSOR                        03520007
TDREAS02 EQU   2     NO SYSTEM GETVIS AVAILABLE TO CREATE TABLES        03530007
TDREAS03 EQU   3     START REJECTED BECAUSE STOP ONGOING                03540007
TDREAS04 EQU   4     PHASE IJBTDSRV NOT LOADED IN SVA                   03550007
TDREAS05 EQU   5     STOP NOT PERFORMED BECAUSE ONLY ONE CPU ACTIVE     03560007
TDREAS06 EQU   6     MAX NUMBER OF CPU'S ALREADY DEFINED                03570007
TDREAS07 EQU   7     SPECIFIED CPU IS NOT DEFINED                       03580007
TDREAS08 EQU   8     SPECIFIED CPU IS IN ERROR                          03590007
TDREAS09 EQU   9     ONLY ONE CPU IS ACTIVE                             03600007
TDREAS10 EQU   10    NOT ALL CPU'S STARTED                              03610007
TDREAS11 EQU   11    INVALID FUNCTION CODE                              03620007
TDREAS12 EQU   12    TURBO DISPATCHER NOT LOADED                        03630007
TDREAS13 EQU   13    CALLER NOT IN PRIMARY ASC-MODE                     03640007
TDREAS14 EQU   14    CALLER NOT AUTHORIZED                              03650007
TDREAS16 EQU   16    ITS NOT ALLOWED TO STOP IPL-CPU                    03670007
TDREAS17 EQU   17    IJBTDSRV CURRENTLY NOT AVAILABLE                   03680007
         MEXIT                                                          03690007
.DSECT   ANOP                                                           03700007
&NAME    DSECT                                                          03710007
****************************************************************        03720007
*        ATTACH SYSTEM TASK PARAMETER LIST                     *        03730007
****************************************************************        03740007
VNDBEG   DS    0F                                                       03750007
VNDCANCE DS    A(0)              ADDR(CANCEL EXIT)                      03760007
VNDEOTEX DS    A(0)              ADDR(END-OF-TASK EXIT)                 03770007
VNDENTRY DS    A(0)              ENTRY POINT ADDR                       03780007
VNDFLAG  DS    X'00'             FLAGBYTE                               03790007
VNDENAB   EQU   X'80'            SYSTEM TASK OPERATES ENABLED           03800007
VNDSVNAR  EQU   X'40'            SAVE AREA NAME FIELD AVAILABLE         03810007
         DS    XL3               RESERVED                               03820007
VNDLEN   EQU   *-VNDBEG          LENGTH OF PARAMETER LIST               03830007
VNDSVNAM DS    CL8               SAVEAREA NAME FIELD                    03840007
VNDLENX1 EQU   *-VNDBEG          FIRST EXTENSION                        03850007
         MEXIT                                                          03860007
.TDIDSCT ANOP                                                           03870007
****************************************************************        03880007
*        TURBO DISPACHTCHER INFORMATION DSECT'S                *        03890007
****************************************************************        03900007
         SPACE 1                                                        03910007
TUCOMMON DSECT                  COMMON TO ALL CPUS                      03920007
TUCOMLEN DS    H'0'              TOTAL LENGTH OF TD-INFORMATION AREA    03930007
TUCOMNUM DS    X'00'             NUMBER OF CPUS IN CEC                  03940007
TUCOMACT DS    X'00'             NUMBER OF ACTIVE CPUS                  03950007
TUCOMTIM DS    XL8               CURRENT TOD                            03960007
TUCOMRES DS    XL8               TOD AT LAST CPU-TIME RESET             03970007
TUCOMSVC DS    XL4               NUMBER OF SVCS SINCE LAST RESET        03980007
TUCOMFL1 DS    XL1               FLAG BYTE                              03990007
TUJACACT  EQU   X'80'            JOB ACCOUNTING ACTIVE                  04000007
TUVERSID DS    XL1               VERSION ID                             04010007
TUCOMCQU DS    XL1               NUMBER OF QUIESCED CPU'S      @D63NDOW 04020009
         DS    XL1               RESERVED                               04021009
TUCOMLNE EQU   *-TUCOMMON                                               04030007
         SPACE 2                                                        04040007
TUCPUINF DSECT                  SPECIFIC TO EACH CPU                    04050007
TUCPUID  DS    H'0'              CPU ID                                 04060007
TUCPUFLG DS    X'00'             FLAG BYTE                              04070007
TUCPUFAC  EQU   X'40'            CPU IS ACTIVE                          04080007
TUCPUFQU  EQU   X'02'            CPU IS QUIESCED               @D63ND0W 04090007
         DS    X'00'             RESERVED                               04100007
TUCPUTIM DS    XL8               TOTAL CPU TIM                          04110007
TUCPUNP  DS    XL8               TOTAL NP TIME                          04120007
TUCPUSPN DS    XL8               TOTAL SPIN TIME                        04130007
TUCPUALB DS    XL8               TOTAL ALLBOUND TIME                    04140007
TUCPUDCY DS    XL4               DISPATCHER CYCLES                      04150007
TUINFLEN EQU   *-TUCPUINF                                               04160007
         SPACE 2                                                        04170007
TUM#ENTR EQU   10            MAX # OF CPU'S CURRENTLY SUPPORTED         04180007
.***     --------------->    CHANGE # ONLY IF MAPTDADR IS ALSO CHANGED  04190007
TUINFOLN EQU   TUCOMLNE+TUM#ENTR*TUINFLEN                               04200007
         MEND                                                           04210007
* END OF PLS COMMENT */ %MTDSERV : ;                                    04220007
*                                                                       04230007
* DECLARE TUCPUMAX BIN(16) CONSTANT(10);                                04240007
*                                                                       04250007
* DECLARE TUINFOLN BIN(16) CONSTANT(LENGTH(TUINFO));                    04260007
*                                                                       04270007
* DECLARE                                                               04280007
* 1 TUINFO    BASED,                                                    04290007
*   2 TUCOMMON  ,          /* COMMON INFORMATION FOR ALL CPU'S       */ 04300007
*     3 TUCOMLEN BIN(16),  /* TOTAL LENGTH OF TD-INFORMATION AREA       04310007
*                            (COMMON PART + N*(PART FOR EACH CPU))   */ 04320007
*     3 TUCOMNUM BIN(8),   /* NUMBER OF CPU'S IN CEC                 */ 04330007
*     3 TUCOMACT BIN(8),   /* NUMBER OF ACTIVE CPU'S                 */ 04340007
*     3 TUCOMTIM CHAR(8),  /* CURRENT TOD                            */ 04350007
*     3 TUCOMRES CHAR(8),  /* TOD AT LAST CPU-TIME RESET             */ 04360007
*     3 TUCOMSVC BIN(32),  /* NUMBER OF SVCS SINCE LAST RESET        */ 04370007
*     3 TUCOMFL1 BIN(8),   /* FLAG BYTE                              */ 04380007
*       4 TUJACACT BIT(1), /* JOB ACCOUNTING ACTIVE                  */ 04390007
*       4 *        BIT(7), /* RESERVED                               */ 04400007
*     3 TUVERSID BIN(8),   /* VERSION ID                             */ 04410007
*     3 *        CHAR(2),  /* RESERVED                               */ 04420007
*   2 TUCPUINF(TUCPUMAX),  /* SPECIFIC INFORMATION FOR ONE CPU       */ 04430007
*     3 TUCPUID  BIN(16),  /* CPU-ID                                 */ 04440007
*     3 TUCPUFLG BIT(8),   /* FLAG BYTE                              */ 04450007
*       4 *        BIT(1), /* RESERVED                               */ 04460007
*       4 TUCPUFAC BIT(1), /* CPU IS ACTIVE                          */ 04470007
*       4 *        BIT(4), /* RESERVED                               */ 04480007
*       4 TUCPUFQU BIT(1), /* CPU IS QUIESCED                @D63NDOW*/ 04490007
*       4 *        BIT(1), /* RESERVED                               */ 04500007
*     3 *        BIT(8),   /* RESERVED                               */ 04510007
*     3 TUCPUTIM CHAR(8),  /* TOTAL CPU TIME                         */ 04520007
*     3 TUCPUNP  CHAR(8),  /* TOTAL NP TIME                          */ 04530007
*     3 TUCPUSPN CHAR(8),  /* TOTAL SPIN TIME                        */ 04540007
*     3 TUCPUALB CHAR(8),  /* TOTAL ALLBOUND TIME                    */ 04550007
*     3 TUCPUDCY BIN(32);  /* DISPATCHER CYCLES                      */ 04560007
*                                                                       04570007
* DECLARE TURETC00 BIT(8) CONSTANT ('00'X);                             04580007
* DECLARE TURETC04 BIT(8) CONSTANT ('04'X);                             04590007
* DECLARE TURETC08 BIT(8) CONSTANT ('08'X);                             04600007
* DECLARE TURETC12 BIT(8) CONSTANT ('0C'X);                             04610007
