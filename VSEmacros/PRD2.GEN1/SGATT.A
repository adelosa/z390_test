         MACRO                                                          00001000
         SGATT                                                          00002000
         GBLA  &AG1        NUMBER OF IODEV                     @D62BDAP 00003000
         GBLB  &SGATT                                          @D62BDAP 00005000
         GBLB  &VSE410     RELEASE SWITCH                      @D62BDAP 00005500
***************************************************************@D62BDAP 00006000
*                                                              @D62BDAP 00007000
.*       IBM DISK OPERATING SYSTEM                             @D62BDAP 00008000
*        SUPERVISOR - SGATT - 5686-066-06                      @D62BDAP 00009000
.*                                                             @D62BDAP 00010000
*        THIS MACRO IS "RESTRICTED MATERIALS OF IBM"           @D62BDAP 00011000
*        5686-032 (C) COPYRIGHT IBM CORP. 1985, 2005           @D62BDAP 00012490
*        LICENSED MATERIALS-PROPERTY OF IBM                    @D62BDAP 00013000
*        SEE COPYRIGHT INSTRUCTIONS                            @D62BDAP 00014000
*                                                              @D62BDAP 00015000
***************************************************************@D62BDAP 00016000
.* /* START OF SPECIFICATIONS ****                             @D62BDAP 00017000
.*01  MODULE-TYPE = MACRO                                      @D62BDAP 00018000
.*02    PROCESSOR = ASSEMBLER                                  @D62BDAP 00019000
.*    CHANGES:                                                 @D62BDAP 00020000
.*      MORE DEVICES                                           @D62BDAP 00021000
.**** END OF SPECIFICATIONS ***/                               @D62BDAP 00022000
         AIF   (NOT &SGATT).NPRT010                            @D62BDAP 00023000
         PRINT GEN                                             @D62BDAP 00024000
         EJECT                                                 @D62BDAP 00025000
.NPRT010 ANOP                                                  @D62BDAP 00026000
         DC    CL8'AR-PARM'                                    @D52VDAP 00027490
         MAPSUPAR DSECT=NO                                              00028000
         EJECT ,                                                        00029000
         MAPSUPAR DSECT=YES                                             00030000
&SYSECT  CSECT ,                                                        00031000
         EJECT ,                                               @D62BDAP 00077000
         USING GETPMRSP,RF                  BASE POINTER       @D62BDAP 00078000
GETPMRSP STM   RC,RF,ATTPMRSV               SAVE REGISTER      @D62BDAP 00079000
*        SGSETUP SETSCB,NEXTSCB=R8,OPTION=SAVE,WR1=RC,WR2=RD   @D62BDAP 00080000
         SGSETUP SETSCB,NEXTSCB=R8,OPTION=SAVE,WR1=RC,WR2=RD   @D62BDAP 00081000
         LM    RC,RF,ATTPMRSV               RELOAD REGISTER    @D62BDAP 00082000
         BR    RE                           RETURN TO CALLER   @D62BDAP 00083000
         DROP  RF                           RELEASE BASE       @D62BDAP 00084000
         SPACE 1                                               @D62BDAP 00085000
         USING RELPMRSP,RF                  BASE POINTER       @D62BDAP 00086000
RELPMRSP STM   RC,RF,ATTPMRSV               SAVE REGISTER      @D62BDAP 00087000
*        SGSETUP RESETSCB,WR1=RC,WR2=RD                        @D62BDAP 00088000
         SGSETUP RESETSCB,WR1=RC,WR2=RD                        @D62BDAP 00089000
         LM    RC,RF,ATTPMRSV               RELOAD REGISTER    @D62BDAP 00090000
         BR    RE                           RETURN TO CALLER   @D62BDAP 00091000
         DROP  RF                           RELEASE BASE       @D62BDAP 00092000
ATTPMRSV DC    4F'0'                        SAVE AREA          @D62BDAP 00093000
         EJECT                                                 @D62BDAP 00094000
ATTHWMSG DS    0H'0'              HARD WAIT MESSAGE WRITER     @D62BDAP 00095000
         BALR  RC,0               DET ROUTINE BASE POINTER     @D62BDAP 00096000
         BCTR  RC,0               ADJUST BASE REG              @D62BDAP 00097000
         BCTR  RC,0               ADJUST BASE REG              @D62BDAP 00098000
         USING ATTHWMSG,RC        ATTHWMSG BASE POINTER        @D62BDAP 00099000
         STM   R0,RF,ATTHWSAV     SAVE ALL REGISTERS CONTENTS  @D62BDAP 00100000
         AIF   (NOT &VSE410).N410020                           @D64ADAP 00101090
         LA    RF,4095                                         @D64ADAP 00101180
         USING SYSS00+4095,RF     LOW-CORE SECOND BASE         @D64ADAP 00101270
         MVC   RC*4+ATTHWSAV(4),GRSAVE+8*RC+4 RC LOW-PART      @D64ADAP 00101360
         DROP  RF                 RELEASE LOW-CORE SECOND BASE @D64ADAP 00101450
         AGO   .Y410020                                        @D64ADAP 00101540
.N410020 ANOP                                                  @D64ADAP 00101630
         MVC   RC*4+ATTHWSAV(4),RC*4+X'180' GET RC-LOW         @D64ADAP 00101720
.Y410020 ANOP                                                  @D64ADAP 00101810
         MVI   ATTHWFLG,ZERO      CLEAR PROCESSING FLAG        @D62BDAP 00102000
         LH    R2,SYSOCDEV        GET SYSLOG DEVICE-ID         @D62BDAP 00103000
         L     RF,APBXAREA        ADDRESS OF PUBX AREA         @D62BDAP 00104000
ATTHWA10 ICM   RE,15,0(RF)        GET FIRST PUBX ENTRY         @D62BDAP 00105000
         USING PBXADR,RE          PUBX BASE POINTER            @D62BDAP 00106000
         BM    ATTHWERR           DEVICE NOT FOUND             @D62BDAP 00107000
         LA    RF,4(,RF)          ADVANCE PUBX ADDRESS POINTER @D62BDAP 00108000
         CH    R2,PBXCUU          IS THIS THE SYSOCDEV         @D62BDAP 00109000
         BNE   ATTHWA10           NO,                          @D62BDAP 00110000
         LA    R7,1               CCW COUNT FOR 3277           @D62BDAP 00111000
         CLI   PBXPUBCD,T3277     IS THIS A TERMINAL           @D62BDAP 00112000
         BE    ATTHWA20           YES                          @D62BDAP 00113000
         LA    R7,(ATTCDTAB-ATTCONS)/L'ATTCONS CCW COUNT       @D62BDAP 00114000
         LA    R3,ATTCONS         ADDRESS OF MESSAGE BUFFER    @D62BDAP 00115000
         STCM  R3,7,ATTHWCCW+1    HAVE CCW POINT TO MSG BUFF.  @D62BDAP 00116000
         MVI   ATTHWCCW,X'09'     MAKE COMMAND A WRITE COMMAND @D62BDAP 00117000
         LA    R3,L'ATTCONS       LINE LENGTH                  @D62BDAP 00118000
         STCM  R3,3,ATTHWCCW+6    CORRECT THE MESSAGE LENGTH   @D62BDAP 00119000
ATTHWA20 DS    0H'0'                                           @D62BDAP 00120000
         CLI   2,X'0F'            IS THIS A VALID H/W CODE     @D62BDAP 00121000
         BNE   ATTHWA25           NO,                          @D62BDAP 00122000
         CLI   3,X'E0'            IS THIS A VALID CODE         @D62BDAP 00123000
         BL    ATTHWA25           NO,                          @D62BDAP 00124000
         SLR   R2,R2              CLEAR REGISTER               @D62BDAP 00125000
         IC    R2,3               GET HARD WAIT CODE           @D62BDAP 00126000
         SLL   R2,27              PURGE UNUSED BITS            @D62BDAP 00127000
         SRL   R2,25              OFFSET IN ADDRESS TABLE      @D62BDAP 00128000
         A     R2,AATTCDTA        ADDRESS OF MSG ADDRESS       @D62BDAP 00129000
         L     R2,0(,R2)          ADDRESS OF MESSAGE TEXT      @D62BDAP 00130000
         LH    R3,0(R2)           GET MESSAGE LENGTH           @D62BDAP 00131000
         BCTR  R3,0               ADJUST FOR EXECUTE           @D62BDAP 00132000
         EX    R3,ATTEXMVC        MOVE MESSAGE TEXT TO HEADER  @D62BDAP 00133000
ATTHWA25 SLR   R2,R2              LOCATION 00                  @D62BDAP 00134000
         LA    R3,ATTMSG01        GET BUFFER ADDRESS           @D62BDAP 00135000
         LR    R4,R3              COPY MESSAGE ADDRESS         @D62BDAP 00136000
         LA    R6,2               SET MESSAGE LINE COUNTER     @D62BDAP 00137000
         LA    R5,8               SET FULLWORDS PER LINE       @D62BDAP 00138000
         BAL   R8,ATTPREP         PREPARE PRINT LINE           @D68ADAP 00139000
         LA    R6,1               SET MESSAGE LINE COUNTER     @D68ADAP 00140000
         LA    R5,4               SET FULLWORDS PER LINE       @D68ADAP 00141000
         BAL   R8,ATTPREP         PREPARE PRINT LINE           @D68ADAP 00142000
         LA    R3,18(,R3)         ADVANCE FIELD POINTER        @D68ADAP 00143000
         MVC   0(4,R3),ATTCNTID   MOVE CONSTANT                @D68ADAP 00144000
         LA    R3,4(,R3)          CORRECT PRINT LINE POINTER   @D68ADAP 00145000
         LH    R8,TID             GET TASK-ID                  @D68ADAP 00146000
         ST    R8,ATTWORK4        SAVE STORAGE ADDRESS         @D68ADAP 00147000
         UNPK  0(5,R3),ATTWORK4+2(3) UNPACK TID                @D68ADAP 00148000
         TR    0(4,R3),ATTTRTAB-240 TRANSLATE TO PRINTABLE     @D68ADAP 00149000
         MVI   4(R3),C' '         CLEAR UNUSED BYTE            @D68ADAP 00150000
         LA    R3,5(,R3)          ADVANNCE FIELD POINTER       @D68ADAP 00151000
         MVC   0(4,R3),ATTCNRID   MOVE CONSTANT                @D68ADAP 00152000
         LA    R3,4(,R3)          CORRECT PRINT LINE POINTER   @D68ADAP 00153000
         LH    R8,RID             GET TASK-ID                  @D68ADAP 00154000
         ST    R8,ATTWORK4        SAVE STORAGE ADDRESS         @D68ADAP 00155000
         UNPK  0(5,R3),ATTWORK4+2(3) UNPACK RID                @D68ADAP 00156000
         TR    0(4,R3),ATTTRTAB-240 TRANSLATE TO PRINTABLE     @D68ADAP 00157000
         MVI   4(R3),C' '         CLEAR UNUSED BYTE            @D68ADAP 00158000
         LA    R2,X'80'           LOCATION 80                  @D68ADAP 00159000
         LA    R6,1               SET MESSAGE LINE COUNTER     @D68ADAP 00160000
         LA    R5,5               SET FULLWORDS PER LINE       @D68ADAP 00161000
         BAL   R8,ATTPREP         PREPARE PRINT LINE           @D68ADAP 00162000
         LA    R2,ATTHWSAV        LOCATION GEN-REGS            @D68ADAP 00163490
         LA    R6,4               SET MESSAGE LINE COUNTER     @D68ADAP 00164000
         LA    R5,8               SET FULLWORDS PER LINE       @D68ADAP 00165000
         BAL   R8,ATTPREP         PREPARE PRINT LINE           @D68ADAP 00166000
         L     R2,X'2C'           LOCATION PROGR.CHK.OLD       @D68ADAP 00167000
         LA    R2,15(,R2)         CLEAR HIGH ORDER BIT         @D68ADAP 00168000
         LRA   R2,0(R2)           IS THIS A VALID ADDRESS      @D68ADAP 00169000
         BNZ   ATTHWA40           NO,                                   00170000
         SRL   R2,6               MAKE IT 32-BYTE BOUND        @D68ADAP 00171000
         SLL   R2,6               ADDRESS WHERE TO START       @D68ADAP 00172000
         LA    R6,2               SET MESSAGE LINE COUNTER     @D68ADAP 00173000
         LA    R5,8               SET FULLWORDS PER LINE       @D68ADAP 00174000
         BAL   R8,ATTPREP         PREPARE PRINT LINE           @D68ADAP 00175000
ATTHWA40 ICM   R1,12,H1           GET SUBCHANNEL ID            @D68ADAP 00176000
         ICM   R1,3,PBXSCH        GET SUBCHANNEL NUMBER        @D62BDAP 00177000
         DROP  RE                 RELEASE PUBX BASE POINTER    @D62BDAP 00178000
ATTHWA50 LA    R5,5               SET RETRY COUNTER            @D62BDAP 00179000
         LA    R2,ATTHWORB        GET ORB ADDRESS              @D62BDAP 00180000
         USING ORB,R2             ORB BASE POINTER             @D62BDAP 00181000
         LA    R3,ATTHWSCH        GET SCHIB ADDRESS            @D62BDAP 00182000
         USING SCHIB,R3           SCHIB BASE POINTER           @D62BDAP 00183000
         LA    R4,ATTHWIRB        ADDRESS OF IRB               @D62BDAP 00184000
         USING IRB,R4             IRB BASE POINTER             @D62BDAP 00185000
         MVI   ORBLPM,XFF         ALLOW ALL PATH ACCESS        @D62BDAP 00186000
         LA    RF,ATTHWCCW        GET CCW ADDRESS              @D62BDAP 00187000
         ST    RF,ORBCCW          SET CCW ADDRESS              @D62BDAP 00188000
ATTHWA60 XC    IRBSAVST,IRBSAVST  CLEAR STATUS SAVE FIELD      @D62BDAP 00189000
         STCK  ATTHWCK1           STORE CLOCK1                 @D62BDAP 00190000
         SLR   R0,R0              SET REASON CODE              @D62BDAP 00191000
         SSCH  ORB                START SUBCHANNEL             @D62BDAP 00192000
         BC    8,ATTHWA70         REQUEST WAS STARTED          @D62BDAP 00193000
         BC    1,ATTHWERR         NOT OPERATIONAL              @D62BDAP 00194000
         OI    ATTHWFLG,ATTHWF80  INDICATE STATUS PENDING/BUSY @D62BDAP 00195000
         B     ATTHWA80           GET STATUS CLEARED           @D62BDAP 00196000
ATTHWA70 STSCH SCHIB              GET SUBCHANNEL INFO          @D62BDAP 00197000
         BO    ATTHWERR           NOT OPERATIONAL              @D62BDAP 00198000
         TM    SCHSTB3,SCHSCSP    STATUS PENDING               @D62BDAP 00199000
         BO    ATTHWA80           YES,                         @D62BDAP 00200000
         BAL   RE,ATTHWTIM        PREVENT INFINITE LOOP        @D62BDAP 00201000
         B     ATTHWA70         0 TIME SLICE NOT EXHAUSTED     @D62BDAP 00202000
         LA    R0,4             4 INDICATE TIME-OUT ON STSCH   @D62BDAP 00203000
         B     ATTHWERR           TIME SLICE IS EXHAUSTED      @D62BDAP 00204000
ATTHWA80 TSCH  IRB                CLEAR INTERRUPT              @D62BDAP 00205000
         TM    IRBSTB3,IRBSCPS+IRBSCSS+IRBSCSP+IRBACSA+IRBACDA @D62BDAP 00206000
         BZ    ATTHWA90           SUBCHANNEL IS NOW IDLE       @D62BDAP 00207000
         OC    IRBSAVST(2),IRBFC  ACCUMULATE STATUS            @D62BDAP 00208000
         BAL   RE,ATTHWTIM        PREVENT INFINITE LOOP        @D62BDAP 00209000
         B     ATTHWA80         0 TIME SLICE NOT EXHAUSTED     @D62BDAP 00210000
         LA    R0,8             4 INDICATE TIME-OUT ON TSCH    @D62BDAP 00211000
         B     ATTHWERR           TIME SLICE IS EXHAUSTED      @D62BDAP 00212000
ATTHWA90 TM    ATTHWFLG,ATTHWF80  WAS STATUS PENDING           @D62BDAP 00213000
         BZ    ATTHWAA0           YES, SHOULD BE CLEARED NOW   @D62BDAP 00214000
         NI    ATTHWFLG,XFF-ATTHWF80 RESET STATUS PENDING      @D62BDAP 00215000
         B     ATTHWA60           RETRY THE I/O REQUEST        @D62BDAP 00216000
.*                                                             @D62BDAP 00217000
.*       THIS IS OUR STATUS NOW                                @D62BDAP 00218000
.*                                                             @D62BDAP 00219000
ATTHWAA0 TM    IRBSAVST+1,IRBSCAS IS THIS ALERT STATUS         @D62BDAP 00220000
         BZ    ATTHWCMP           NO, MESSAGE WAS WRITTEN      @D62BDAP 00221000
         LTR   R5,R5              RETRY LIMIT EXHAUSTED        @D62BDAP 00222000
         BZ    ATTHWERR           YES, PERMANENT ERROR         @D62BDAP 00223000
         BCTR  R5,0               DECREMENT LOOP COUNT         @D62BDAP 00224000
         TM    IRBSAVST+1,IRBSCPS+IRBSCSS SOLICITED STATUS     @D62BDAP 00225000
         BZ    ATTHWA60           NO, ASSUME ATTENTION, RETRY  @D62BDAP 00226000
ATTHWCLR SLR   R0,R0              INDICATE NOT OPERATIONAL     @D62BDAP 00227000
         CSCH                     CLEAR SUBCHANNEL             @D62BDAP 00228000
         BO    ATTHWERR           NOT OPERATIONAL              @D62BDAP 00229000
ATTHWC10 STSCH SCHIB              GET SUBCHANNEL INFO          @D62BDAP 00230000
         BO    ATTHWERR           NOT OPERATIONAL              @D62BDAP 00231000
         TM    SCHSTB3,SCHSCSP    STATUS PENDING               @D62BDAP 00232000
         BO    ATTHWC20           YES,                         @D62BDAP 00233000
         BAL   RE,ATTHWTIM        PREVENT INFINITE LOOP        @D62BDAP 00234000
         B     ATTHWC10         0 TIME SLICE NOT EXHAUSTED     @D62BDAP 00235000
         LA    R0,4             4 INDICATE TIME-OUT ON STSCH   @D62BDAP 00236000
         B     ATTHWERR           TIME SLICE IS EXHAUSTED      @D62BDAP 00237000
ATTHWC20 TSCH  IRB                CLEAR INTERRUPT              @D62BDAP 00238000
         TM    ATTHWFLG,ATTHWF80  WAS STATUS PENDING           @D62BDAP 00239000
         BO    ATTHWA60           YES, TRY TO START IT AGAIN   @D62BDAP 00240000
         B     ATTHWM00           NO, CHECK WHAT TO DO         @D62BDAP 00241000
ATTHWC30 SLR   R3,R3              CLEAR REGISTER               @D62BDAP 00242000
         ICM   R3,7,ATTHWCCW+1    GET IOAREA ADDRESS           @D62BDAP 00243000
         LA    R3,L'ATTCONS(,R3)  NEXT MESSAGE LINE            @D62BDAP 00244000
         STCM  R3,7,ATTHWCCW+1    NEW MESSAGE ADDRESS          @D62BDAP 00245000
         B     ATTHWA50           PRINT NEXT LINE              @D62BDAP 00246000
         SPACE 1                                               @D62BDAP 00247000
ATTEXMVC MVC   ATTMSGHD+30(0),2(R2) PUT MSG IN HEADER LINE     @D62BDAP 00248000
ATTCNTID DC    C'TID='                                                  00249000
ATTCNRID DC    C'RID='                                                  00250000
         SPACE 1                                               @D62BDAP 00251000
         DROP  R4                 RELEASE IRB   BASE           @D62BDAP 00252000
         DROP  R3                 RELEASE SCHIB BASE           @D62BDAP 00253000
         DROP  R2                 RELEASE ORB   BASE           @D62BDAP 00254000
ATTHWM00 DS    0H'0'              UNUSUAL CHANNEL STATUS       @D62BDAP 00255000
ATTHWERR DS    0H'0'              ERROR RETURN                 @D62BDAP 00256000
ATTHWCMP DS    0H'0'              I/O COMPLETED SUCCESSFULLY   @D62BDAP 00257000
         BCT   R7,ATTHWC30        MORE LINES TO PRINT          @D62BDAP 00258000
         BAL   RE,ATTHWTIM        LET OPERATOR READ MESSAGE    @D62BDAP 00259000
         B     *-4              0 TIME SLICE NOT EXHAUSTED     @D62BDAP 00260000
         BAL   RE,ATTHWTIM      4 LET OPERATOR READ MESSAGE    @D62BDAP 00261000
         B     *-4              0 TIME SLICE NOT EXHAUSTED     @D62BDAP 00262000
         NOP   0                4                              @D64ADAP 00262100
         AIF   (NOT &VSE410).N410040                           @D64ADAP 00262200
         LM    R0,RF,ATTHWSAV     RESTORE REGISTERS            @D64ADAP 00262300
         DROP  RC                 DROP ATTHWMSG BASE POINTER   @D64ADAP 00262400
         LPSW  DUMMYPSW           ENTER HARD WAIT STATE        @D64ADAP 00262500
         AGO   .Y410040                                        @D64ADAP 00262600
.N410040 ANOP                                                  @D64ADAP 00262700
         MVC   X'100'(8),ATTHWAIT SET HARD WAIT PSW IN LOW CORE@D62BDAP 00263000
         LM    R0,RF,ATTHWSAV     RESTORE REGISTERS            @D62BDAP 00264490
         DROP  RC                 DROP ATTHWMSG BASE POINTER   @D62BDAP 00265000
         LPSW  X'100'             ENTER HARD WAIT STATE        @D62BDAP 00266000
.Y410040 ANOP                                                  @D64ADAP 00266500
         SPACE 3                                                        00267000
*        R2 = STORAGE ADDRESS                                           00268000
*        R3 = FULLWORD IN PRINT LINE POINTER                            00269000
*        R4 = PRINT LINE BEGIN ADDRESS                                  00270000
*        R5 = FULLWORDS/LINE COUNT                                      00271000
*        R6 = LINES TO PRINT COUNT                                      00272000
         USING ATTHWMSG,RC        SUBROUTINE BASE POINTER      @D68ADAP 00273000
ATTPREP  ST    R2,ATTWORK4        SAVE STORAGE ADDRESS         @D68ADAP 00274000
         LR    R3,R4              LINE BEGIN ADDRESS           @D68ADAP 00275000
         UNPK  0(7,R3),ATTWORK4+1(4) UNPACK ADDRESS            @D68ADAP 00276000
         TR    0(6,R3),ATTTRTAB-240 TRANSLATE TO PRINTABLE     @D68ADAP 00277000
         MVI   6(R3),C' '         CLEAR UNUSED BYTE            @D68ADAP 00278000
         LA    R3,7(,R3)          ADVANCE BUFFER POINTER       @D68ADAP 00279000
ATTPRE20 UNPK  0(9,R3),0(5,R2)    UNPAK LOW CORE               @D68ADAP 00280000
         TR    0(8,R3),ATTTRTAB-240 TRANSLATE TO PRINTABLE     @D68ADAP 00281000
         MVI   8(R3),C' '         BLANK UNUSED BYTE            @D68ADAP 00282000
         LA    R3,9(,R3)          ADVANCE BUFFER POINTER       @D68ADAP 00283000
         LA    R2,4(,R2)          ADVANCE STORAGE POINTER      @D68ADAP 00284000
         BCT   R5,ATTPRE20        PROCESS NEXT FULLWORD        @D68ADAP 00285000
         LA    R4,L'ATTCONS(,R4)  ADVANCE LINE POINTER         @D68ADAP 00286000
         LA    R5,8               SET FULLWORDS PER LINE       @D68ADAP 00287000
         BCT   R6,ATTPREP         PROCESS NEXT MESSAGE LINE    @D68ADAP 00288000
         BR    R8                 RETURN TO MAIN PATH          @D68ADAP 00289000
         SPACE 1                                               @D62BDAP 00290000
         USING ATTHWMSG,RC        ROUTINE BASE POINTER         @D62BDAP 00291000
ATTHWTIM STCK  ATTHWCK2           STORE CLOCK2                 @D62BDAP 00292000
         L     R0,ATTHWCK2        LOAD SECOND TIME             @D62BDAP 00293000
         S     R0,ATTHWCK1        SUBTRACT START TIME          @D62BDAP 00294000
         S     R0,ATTHW10S        SUBTRACT CONSTANT            @D62BDAP 00295000
         BP    4(,RE)             TIME EXHAUSTED               @D62BDAP 00296000
         LA    R0,1024            SET LOOP COUNT               @D62BDAP 00297000
         BCT   R0,*               GIVE SUBSYSTEM A CHANCE      @D62BDAP 00298000
         BR    RE                 RETURN                       @D62BDAP 00299000
         DROP  RC                 RELEASE SUBROUTINE BASE      @D62NDAP 00300000
         EJECT ,                                               @D62BDAP 00301000
         DS    0D                 FORCE ALIGNMENT              $D62BDAP 00302000
ATTHWORB DC    XL(ORBLEN)'00'     GENERATE ORB                 @D62BDAP 00303000
         SPACE 2                                               @D62BDAP 00304000
ATTHWSCH DC    XL(SCHLEN)'00'     GENERATE SCHIB               @D62BDAP 00305000
         SPACE 2                                               @D62BDAP 00306000
ATTHWIRB DC    XL(IRBLEN)'00'     GENERATE IRB                 @D62BDAP 00307000
IRBSAVST DC    XL2'00'            IRB ACCUMULATED STATUS       @D62BDAP 00308000
         EJECT ,                                               @D62BDAP 00309000
ATTHWCK1 DC    D'0'               START TIME STAMP             @D62BDAP 00310000
ATTHWCK2 DC    D'0'               LAST TIME THROUGH STAMP      @D62BDAP 00311000
ATTHWCCW CCW   5,ATTSCREN,X'20',L'ATTSCREN+ATTCDTAB-ATTCONS    @D62NDAP 00312000
         CCW   0,0,0,0            SYSLOG CCW                   @D62NDAP 00313000
ATTHWAIT DC    XL8'000A000000001000' HARD WAIT PSW             @D62BDAP 00314000
ATTHWSAV DC    16F'0'             SAVE AREA                    @D62BDAP 00315000
ATTTRTAB DC    C'0123456789ABCDEF'                             @D62BDAP 00316000
ATTWORK4 DC    F'0'               WORK-AREA                    @D62BDAP 00317000
ATTHW10S DC    F'10'              CONSTANT                     @D62BDAP 00318000
AATTCDTA DC    A(ATTCDTAB)        H/W CODE ADDRESS TABLE       @D62BDAP 00319000
ATTHWFLG DC    XL1'00'            COM                          @D62BDAP 00320000
ATTHWF80 EQU   X'80'              SUBCHANNEL STATUS PENDING    @D62BDAP 00321000
         DS    0H'0'                                           @D62BDAP 00322000
.*                                                             @D62BDAP 00323000
.*       SCREEN/CONSOLE MESSAGE BUFFER MUST BE CONTIGUOUS      @D62BDAP 00324000
.*                                                             @D62BDAP 00325000
ATTSCREN DC    XL6'431140401D60'  SCREEN IMAGE                 @D62BDAP 00326000
ATTCONS  DC    13CL80' '          SCREEN IMAGE                 @D62BDAP 00327000
         ORG   ATTCONS                                         @D62BDAP 00328000
ATTMSGHD DC    CL30'SYSTEM ENTERED HARD WAIT <===='            @D62BDAP 00329000
ATTHWREA DC    CL50' '            HARD WAIT REASON CODE        @D62BDAP 00330000
ATTMSG01 DC    CL80' '            LOCATION 000-01F             @D62BDAP 00331000
         DC    CL80' '            LOCATION 020-03F             @D62BDAP 00332000
         DC    CL80' '            LOCATION 040-04F             @D62BDAP 00333000
         DC    CL80' '            LOCATION 080-08F             @D62BDAP 00334000
         DC    CL80' '            LOCATION 180-19F             @D62BDAP 00335000
         DC    CL80' '            LOCATION 1A0-1BF             @D62BDAP 00336000
         DC    CL80' '            LOCATION 1C0-1DF             @D62BDAP 00337000
         DC    CL80' '            LOCATION 1E0-1FF             @D62BDAP 00338000
         DC    CL80' '            PROGRAM CHECK AREA           @D62BDAP 00339000
         DC    CL80' '            PROGRAM CHECK AREA           @D62BDAP 00340000
         DC    CL80' '            PROGRAM CHECK AREA           @D62BDAP 00341000
         DC    CL80' '            PROGRAM CHECK AREA           @D62BDAP 00342000
ATTCDTAB DS    0F'0' '            H/W MESSAGE CODE TABLE       @D62BDAP 00343000
         DC    A(ATTMSFE0)        0FE0 MESSAGE CODE            @D62BDAP 00344000
         DC    A(ATTMSFE1)        0FE1 MESSAGE CODE            @D62BDAP 00345000
         DC    A(ATTMSFE2)        0FE2 MESSAGE CODE            @D62BDAP 00346000
         DC    A(ATTMSFE3)        0FE3 MESSAGE CODE            @D62BDAP 00347000
         DC    A(ATTMSFE4)        0FE4 MESSAGE CODE            @D62BDAP 00348000
         DC    A(ATTMSFE5)        0FE5 MESSAGE CODE            @D62BDAP 00349000
         DC    A(ATTMSFE6)        0FE6 MESSAGE CODE            @D62BDAP 00350000
         DC    A(ATTMSFE7)        0FE7 MESSAGE CODE            @D62BDAP 00351000
         DC    A(ATTMSFE8)        0FE8 MESSAGE CODE            @D62BDAP 00352000
         DC    A(ATTMSFE9)        0FE9 MESSAGE CODE            @D62BDAP 00353000
         DC    A(ATTMSFEA)        0FEA MESSAGE CODE            @D62BDAP 00354000
         DC    A(ATTMSFEB)        0FEB MESSAGE CODE            @D62BDAP 00355000
         DC    A(ATTMSFEC)        0FEC MESSAGE CODE            @D62BDAP 00356000
         DC    A(ATTMSFED)        0FED MESSAGE CODE            @D62BDAP 00357000
         DC    A(ATTMSFEE)        0FEE MESSAGE CODE            @D62BDAP 00358000
         DC    A(ATTMSFEF)        0FEF MESSAGE CODE            @D62BDAP 00359000
         DC    A(ATTMSFF0)        0FF0 MESSAGE CODE            @D62BDAP 00360000
         DC    A(ATTMSFF1)        0FF1 MESSAGE CODE            @D62BDAP 00361000
         DC    A(ATTMSFF2)        0FF2 MESSAGE CODE            @D62BDAP 00362000
         DC    A(ATTMSFF3)        0FF3 MESSAGE CODE            @D62BDAP 00363000
         DC    A(ATTMSFF4)        0FF4 MESSAGE CODE            @D62BDAP 00364000
         DC    A(ATTMSFF5)        0FF5 MESSAGE CODE            @D62BDAP 00365000
         DC    A(ATTMSFF6)        0FF6 MESSAGE CODE            @D62BDAP 00366000
         DC    A(ATTMSFF7)        0FF7 MESSAGE CODE            @D62BDAP 00367000
         DC    A(ATTMSFF8)        0FF8 MESSAGE CODE            @D62BDAP 00368000
         DC    A(ATTMSFF9)        0FF9 MESSAGE CODE            @D62BDAP 00369000
         DC    A(ATTMSFFA)        0FFA MESSAGE CODE            @D62BDAP 00370000
         DC    A(ATTMSFFB)        0FFB MESSAGE CODE            @D62BDAP 00371000
         DC    A(ATTMSFFC)        0FFC MESSAGE CODE            @D62BDAP 00372000
         DC    A(ATTMSFFD)        0FFD MESSAGE CODE            @D62BDAP 00373000
         DC    A(ATTMSFFE)        0FFE MESSAGE CODE            @D62BDAP 00374000
         DC    A(ATTMSFFF)        0FFF MESSAGE CODE            @D62BDAP 00375000
         SPACE 1                                               @D62BDAP 00376000
ATTMSFE0 DC AL2(ATTMSFE1-*-2),C' '        UNUSED               @D62BDAP 00377000
ATTMSFE1 DC AL2(ATTMSFE2-*-2),C' '        UNUSED               @D62BDAP 00378000
ATTMSFE2 DC AL2(ATTMSFE3-*-2),C' '        UNUSED               @D62BDAP 00379000
ATTMSFE3 DC AL2(ATTMSFE4-*-2),C' '        UNUSED               @D62BDAP 00380000
ATTMSFE4 DC AL2(ATTMSFE5-*-2),C' '        UNUSED               @D62BDAP 00381000
ATTMSFE5 DC AL2(ATTMSFE6-*-2),C' '        UNUSED               @D62BDAP 00382000
ATTMSFE6 DC AL2(ATTMSFE7-*-2),C' '        UNUSED               @D62BDAP 00383000
ATTMSFE7 DC AL2(ATTMSFE8-*-2),C' '        UNUSED               @D62BDAP 00384000
ATTMSFE8 DC AL2(ATTMSFE9-*-2),C' '        UNUSED               @D62BDAP 00385000
ATTMSFE9 DC AL2(ATTMSFEA-*-2),C' '        UNUSED               @D62BDAP 00386000
ATTMSFEA DC AL2(ATTMSFEB-*-2),C' '        UNUSED               @D62BDAP 00387000
ATTMSFEB DC AL2(ATTMSFEC-*-2),C' '        UNUSED               @D62BDAP 00388000
ATTMSFEC DC AL2(ATTMSFED-*-2),C'UNEXPECTED SYSTEM-TASK CANCELATION'     00389000
ATTMSFED DC AL2(ATTMSFEE-*-2),C'SYSTEM DETERMINED ERROR'       @D62BDAP 00390000
ATTMSFEE DC AL2(ATTMSFEF-*-2),C' '        UNUSED               @D62BDAP 00391000
ATTMSFEF DC AL2(ATTMSFF0-*-2),C' '        UNUSED               @D62BDAP 00392000
ATTMSFF0 DC AL2(ATTMSFF1-*-2),C' '        UNUSED               @D62BDAP 00393000
ATTMSFF1 DC AL2(ATTMSFF2-*-2),C'ERROR DETECTED BY PAGE-MANAGER'         00394000
ATTMSFF2 DC AL2(ATTMSFF3-*-2),C' '        UNUSED               @D62BDAP 00395000
ATTMSFF3 DC AL2(ATTMSFF4-*-2),C' '        UNUSED               @D62BDAP 00396000
ATTMSFF4 DC AL2(ATTMSFF5-*-2),C' '        UNUSED               @D62BDAP 00397000
ATTMSFF5 DC AL2(ATTMSFF6-*-2),C'TFIX-COUNT OUTSIDE LIMITS'     @D62BDAP 00398000
ATTMSFF6 DC AL2(ATTMSFF7-*-2),C'I/O ERROR DURING UPDATE OF SDL'         00399000
ATTMSFF7 DC AL2(ATTMSFF8-*-2),C'NO MORE COPY-BLOCKS FOR BTAM APPENDAGE' 00400000
ATTMSFF8 DC AL2(ATTMSFF9-*-2),C' '        UNSED                @D62BDAP 00401000
ATTMSFF9 DC AL2(ATTMSFFA-*-2),C'PERMANENT PAGE-DATA-SET I/O ERROR'      00402000
ATTMSFFA DC AL2(ATTMSFFB-*-2),C'TRANSLATION SPECIFICATION EXCEPTION'    00403000
ATTMSFFB DC AL2(ATTMSFFC-*-2),C'PAGE FAULT IN SUPERVISOR (RID=00)'      00404000
ATTMSFFC DC AL2(ATTMSFFD-*-2),C' '        UNUSED               @D62BDAP 00405000
ATTMSFFD DC AL2(ATTMSFFE-*-2),C'ERROR DURING ''RE-IPL'''''     @D62BDAP 00406000
ATTMSFFE DC AL2(ATTMSFFF-*-2),C'PERMANENT FETCH I/O ERROR'     @D62BDAP 00407000
ATTMSFFF DC AL2(ATTMSEND-*-2),C'PROGRAM-CHECK IN SUPERVISOR'   @D62BDAP 00408000
ATTMSEND DS 0H'0'                                              @D62BDAP 00409000
         TITLE 'VSE/ESA     TAPE     INVOKE GETDADR ROUTINE  '          00410000
*        USING I/O-AREA-OFFSET,R0 OFFSET IN I/O AREA                    00411000
         USING ATGETDAD,RF        SUBROUTINE BASE                       00412000
*SGLINK  ATGETDAD INPUT=(R0,R7,R8,R9,RF),OUTPUT=RF                      00413000
ATGETDAD DC    D'0'               DUMMY CCW                             00414000
.*       IJBTAPE WILL ENTER AT ARGETDAD+8                               00415000
         STM   R6,R9,ATGETDSV     SAVE CALLERS REGISTERS                00416000
         L     R6,DISPAD          DISPATCHER BASE ADDRESS               00417000
         USING DISP,R6            DISP     BASE POINTER                 00418000
         LA    R8,ATGETDAD        POINT TO DUMMY CCW                    00419000
         DROP  RF                 RELEASE OLD BASE                      00420000
         BAL   R7,GETDADR         GET VIRTUAL CCW ADDRESS               00421000
         USING *,R7               NEW BASE REGISTER                     00422000
*SGLINK  GETDADR INPUT=(R0,R6,R7,R8),OUTPUT=RF                          00423000
         LM    R6,R9,ATGETDSV     RELOAD REGISTERS                      00424000
         DROP  R7                 RELEASE TEMP BASE                     00425000
         BSM   0,R9               RETURN TO CALLER                      00426000
ATGETDSV DC    4F'0'              SAVE AREA                             00427000
         TITLE 'VSE/ESA     TAPE     MESSAGE WRITER ROUTINE  '          00428000
**************************************************************          00429000
*        WRITE A MESSAGE                                     *          00430000
* INPUT:                                                     *          00431000
*        R1 = ADDRESS OF MESSAGE TEXT                        *          00432000
*        R2 = LENGTH  OF MESSAGE TEXT                        *          00433000
*        RC = ROUTINE BASE REGISTER                          *          00434000
*        RE = RETURN REGISTER                                *          00435000
*        R0 = LENGTH  OF MESSAGE EXTENTION                   *          00436000
*        RF = ADDRESS OF MESSAGE EXTENTION                   *          00437000
* OUTPUT:                                                    *          00438000
*        RF = RETURN CODE                                    *          00439000
**************************************************************          00440000
         SPACE 3                                                        00441000
*SGLINK  ARLOGOUT ENTRY,INPUT=(R1,R2,RC,RE),OUTPUT=RF                   00442000
         USING ARLOGOUT,RC        SUBROUTINE BASE                       00443000
ARLOGOUT B     ARLOGRTN         0 ENTRY POINT FOR SINGLE-LINE           00444000
ARLOG2ND B     ARLOGTWO         4 ENTRY POINT FOR DOUBLE-LINE           00445000
ARLOGRTN DS    0H'0'              ENTRY POINT TO WRITE MESSAGES         00446000
         SLR   RF,RF              SET RETURN CODE TO ZERO               00447000
         ST    R1,AROUTCCW+4      ADDRESS OF MESSAGE IN CCW             00448000
         STCM  R2,3,AROUTCCW+2    LENGTH OF MESSAGE IN CCW              00449000
         LA    R1,AROUTCCB        POINT TO CCB                          00450000
         EXCP  (1)                WRITE MESSAGE                         00451000
         WAIT  (1)                WAIT FOR COMPLETION                   00452000
         MVI   AROUTCCW+1,X'20'   RESTORE TO SINGLE CCW                 00453000
         L     R1,AROUTCCW+4      RESTORE R1                            00454000
         TM    AROUTCCB+2,DISERR  SET CONDITION CODE IF NEEDED          00455000
         BZ    ARLOGRC0           RETURN TO CALLER                      00456000
         LA    RF,8               SET RETURN CODE                       00457000
ARLOGRC0 BSM   0,RE                    ====================>>>          00458000
         SPACE 1                                                        00459000
*SGLINK  ARLOGTWO ENTRY,INPUT=(R0,R1,R2,RC,RE,RF),OUTPUT=RF             00460000
ARLOGTWO OI    AROUTCCW+1,X'40'   ENSURE COMMAND CHAINING               00461000
         STCM  R0,3,AROUTCC1+2    EXTENTION MESSAGE LENGTH              00462000
         ST    RF,AROUTCC1+4      EXTENTION MSG ADDRESS                 00463000
         B     ARLOGRTN           JOIN MAIN ROUTINE                     00464000
         SPACE 1                                                        00465000
         DC    0D'0'              START EXECUTION BASE                  00466000
AROUTCCB CCB   SYSLOG,AROUTCCW,X'0400',CCW=FORMAT1                      00467000
AROUTCCW CCW1  X'09',0,X'20',0000                                       00468000
AROUTCC1 CCW1  X'09',0,X'20',0000                                       00469000
         DROP  RC                 RELEASE SUBROUTINE BASE               00470000
*SGLINK    ATT$SGETV INPUT=(R0,RE,RF),OUTPUT=(R1,RF)                    00471000
           USING ATT$SGETV,RF     SUBROUTINE BASE POINTER               00472000
ATT$SGETV  STM   R9,RE,ATT$SGVSAV SAVE CALLERS REGISTERS                00473000
           LR    RC,RF            SAVE BASE POINTER                     00474000
           DROP  RF               RELEASE INITIAL BASE                  00475000
           USING ATT$SGETV,RC     SUBROUTINE BASE POINTER               00476000
           L     RA,TCBPTR        GET TCB ADDRESS                       00477000
.* NOTE    SGETVIS REQUIRES TCB-ADDRESS IN RA                           00478000
           SGETVIS PFIX=YES,ADDRESS=(1),LENGTH=(0),SPID=ATT$SPNM       X00479000
               LOC=ANY                                                  00480000
           LM    R9,RE,ATT$SGVSAV RESTORE CALLERS REGISTERS             00481000
           DROP  RC               RELEASE SUBROUTINE BASE               00482000
           BSM   0,RE             RETRN======================>          00483000
           SPACE 1                                                      00484000
ATT$SGVSAV DC    6F'0'            SAVE AREA                             00485000
ATT$SPNM   DC    CL6'$ARVIS',XL2'0000' SUBPOOL NAME                     00486000
*HERE                                                          @D62BDAP 00487000
         AGO   .SKIP000                                        @D62BDAP 00488000
         EJECT                                                 @D62BDAP 00489000
         ORG   ATTXCPT            INTERCEPT ROUTINE ADDRESS    @D62BDAP 00490000
         DC    A(ATTINT)                                       @D62BDAP 00491000
         ORG ,                                                 @D62BDAP 00492000
         ORG   SIOXCEPT                                        @D62BDAP 00493000
         DC    A(ATTB500)                                      @D62BDAP 00494000
         ORG   ,                                               @D62BDAP 00495000
         TITLE 'VSE SUPERVISOR     SGATT     ATTENTION PROCESSING     ' 00496000
.*                                                             @D62BDAP 00497000
.*                                                             @D62BDAP 00498000
.*       AN ATTENTION INTERRUPT FOR SYSOCDEV WAS RECEIVED.     @D62BDAP 00499000
.*                                                             @D62BDAP 00500000
.*                                                             @D62BDAP 00501000
.*                                                             @D62BDAP 00502000
         USING DISP,R6 DISPATCHER BASE                         @D62BDAP 00503000
         USING ATTOCRTN,R7        LINK REGISTER                @D62BDAP 00504000
         USING ATTINT,R8          ATTENTION PROCESSOR BASE     @D62BDAP 00505000
         USING INTRTN,R9          IOINTER BASE                 @D62BDAP 00506000
         USING CCBADR,R1 CCB BASE POINTER                      @D62BDAP 00507000
         USING CHNTBL,R2 CCT BASE POINTER                      @D62BDAP 00508000
         USING PUBADR,R3 PUB BASE POINTER                      @D62BDAP 00509000
         USING CHQADR,R4 CHANQ BASE POINTER                    @D62BDAP 00510000
         USING PIBADR,RA           PIB BASE POINTER            @D62BDAP 00511000
         SPACE                                                 @D62BDAP 00512000
         DC    CL8'SGATT'                                      @D52VDAP 00513000
         DC    CL8'AF6.1-08'       CHANGE ACTIVITY             @D52VDAP 00514000
ATTINT   TM    SYSFLAG2,IPLBIT     IS IPL IN PROCESS           @D62BDAP 00515000
         BOR   R7                  YES  ====================>> @D62BDAP 00516000
         TM    SYSFLAG5,X'10'      IS OUR CODE ACTIVE          @D62BDAP 00517000
         BZR   R7                  NO   ====================>> @D62BDAP 00518000
         TM    SNSFLAG,SNSMSGRO    IS SNS-REPLY OUTSTANDING    @D52VDAP 00519000
         BOR   R7                  YES, ====================>> @D52VDAP 00520000
ATTINT05 CLI   PUBCHQPT,ZERO       IS THIS OUR OWN REQUEST     @D62BDAP 00521000
         AIF   (&AG1 LE 254).LOD0000                           @D51ODGL 00522000
         BNE   ATTINT06            NO, ITS NOT                 @D51ODGL 00523000
         CLI   PUBCHQPH,ZERO       REALLY?                     @D51ODGL 00524000
.LOD0000 ANOP                                                  @D51ODGL 00525000
         BE    INITRG              YES  ====================>> @D62BDAP 00526000
ATTINT06 ST    RB,ATTSAVRB         SAVE SAVE AREA POINTER      @D51ODGL 00527000
         TM    IOOPSW+1,WAITBIT    WAS SYSTEM IN ALL-BOUND     @D62BDAP 00528000
         BZ    ATTINT08            NO                          @D62BDAP 00529000
         XC    ATTSAVRB(4),ATTSAVRB INDICATE SAVE AREA INVALID @D62BDAP 00530000
ATTINT08 L     RE,ACHANQ           GET ADDRESS OF OUR ENTRY    @D62BDAP 00531000
         MVC   0(32,RE),ATTCHANQ   MOVE SKELETON TO 1ST ENTRY  @D62BDAP 00532000
         LTR   R4,R4               IS I/O REQUEST ENQUEUED     @D62BDAP 00533000
         BZ    ATTA030             NO,                         @D62BDAP 00534000
         TM    CHQCCSIO,CHQCCACT   HAS I/O REQUEST BEEN STARTED@D62BDAP 00535000
         BZ    ATTA010             NO,                         @D62BDAP 00536000
         CLI   DEVSTA,ATTENT+BUSY  WAS THIS PENDING ATTENTION  @D62BDAP 00537000
         BE    ATTA010             YES,                        @D62BDAP 00538000
         CLI   DEVSTA,ATTENT       IS THIS A CLEAN ATTENTION   @D62BDAP 00539000
         BNE   TSTBUSY             NO, PROCESS INTERRUPT       @D62BDAP 00540000
ATTA010  DS    0H                  MAKE CURRENT = NEXT-IN-CHAIN@D51ODGL 00541000
         MVC   CHQCHNLO-CHQADR(1,RE),PUBCHQPT     LOW BYTE     @D51ODGL 00542000
         AIF   (&AG1 LE 254).LOD0010                           @D51ODGL 00543000
         MVC   CHQCHNHI-CHQADR(1,RE),PUBCHQPH     AND HIGH BYTE@D51ODGL 00544000
.LOD0010 ANOP                                                  @D51ODGL 00545000
         TM    PUBCSFLG,DEVBSY     IS DEVICE SET BUSY          @D62BDAP 00546000
         BZ    ATTA020             NO,                         @D62BDAP 00547000
         OI    CHQFLG1,CHQCSBSY    SAVE BUSY BIT               @D62BDAP 00548000
ATTA020  TM    PUBCSFLG,QEDERR     IS DEVICE QUEUED IN ERROR   @D62BDAP 00549000
         BZ    ATTA030             NO,                         @D62BDAP 00550000
         OI    CHQFLG1,CHQCSQED    SAVE QUEUED IN ERROR BIT    @D62BDAP 00551000
ATTA030  NI    PUBCSFLG,XFF-DEVBSY-QEDERR-OPINTV RESET PUB BITS@D62BDAP 00552000
         LR    R4,RE               SET TO OUR CHANQ ENTRY      @D62BDAP 00553000
         LA    RE,ATTASNS          ADDRESS OF READ CHAIN       @D62BDAP 00554000
         ST    RE,ATTACCB+8        STORE IT IN CCB             @D62BDAP 00555000
         LR    RE,R3               COPY PUB POINTER            @D62BDAP 00556000
         SH    RE,YPUBTAB          OFFSET WITHIN PUB TABLE     @D62BDAP 00557000
         SRL   RE,3                PUB ENTRY NUMBER            @D62BDAP 00558000
         STC   RE,ATTACCB+CCBLNO-CCBADR SET UP PUB ENTRY NO.   @D62BDAP 00559000
         AIF   (&AG1 LE 254).LOD0030                           @D51ODGL 00560000
         STCM  RE,3,CHQPUBHI            ALSO IN CHANQ ENTRY    @D51ODGL 00561000
         NI    ATTACCB+CCBCLS-CCBADR,X'FC'                     @D51ODGL 00562000
         O     RE,ATTACCB+CCBCLS-2-CCBADR                      @D51ODGL 00563000
         STCM  RE,2,ATTACCB+CCBCLS-CCBADR     AND CCBCLS       @D51ODGL 00564000
.LOD0030 AIF   (&AG1 GT 254).LOD0031                           @D51ODGL 00565000
         STC   RE,CHQPUBNO         STORE PUB NO. IN CHANQ      @D62BDAP 00566000
.LOD0031 ANOP                                                  @D51ODGL 00567000
         SLR   RE,RE               CLEAR REGISTER              @D62BDAP 00568000
         STC   RE,PUBCHQPT         SET UP CHANQ POINTER IN PUB @D62BDAP 00569000
         AIF   (&AG1 LE 254).LOD0040                           @D51ODGL 00570000
         STC   RE,PUBCHQPH         ALSO HIGH BYTE              @D51ODGL 00571000
.LOD0040 ANOP                                                  @D51ODGL 00572000
         STCM  R3,7,CHNTPUBN+1     NEXT PUB TO BE STARTED      @D62BDAP 00573000
ATTA040  MVC   ATTAINP(167),ATTACLRC CLEAR TO BINARY ZERO'S    @D62BDAP 00574000
         XC    ATTASNSD,ATTASNSD   CLEAR SENSE BYTES           @D62BDAP 00575000
         CLI   PUBDEVTY,T1050A     IS THIS A CRT DEVICE        @D62BDAP 00576000
         BNE   ATTA050             NO                          @D62BDAP 00577000
         LA    RF,72               SET BYTE COUNT TO 72        @D62BDAP 00578000
         MVI   ATTAREAD,X'0A'      SET CCW TO PK-READ          @D62BDAP 00579000
         B     ATTA060                                         @D62BDAP 00580000
ATTA050  L     RE,ACRTSAV          ADDRESS OF CRT SAVE AREA    @D62BDAP 00581000
         USING CRTSAV,RE           CRTSAV BASE POINTER         @D62BDAP 00582000
         MVC   ATTAWCC+2(2),CADRWRN GET CURSOR ADDRESS         @D62BDAP 00583000
         MVC   ATTAWCCE+2(2),CADRINP GET CURSOR ADDRESS        @D62BDAP 00584000
         MVI   ATTAREAD,X'06'      ENSURE READ MODIFIED        @D62BDAP 00585000
         LH    RF,LREADALL         LENGTH OF INPUT AREA        @D62BDAP 00586000
ATTA060  STH   RF,ATTAREAD+6       UPDATE CCW BYTE COUNT       @D62BDAP 00587000
         STH   RF,ATTAWDEL+6       UPDATE CCW BYTE COUNT       @D62BDAP 00588000
         BAL   R7,CQDSP            SET UP POINTERS ACCORDINGLY @D62BDAP 00589000
*SGLINK  CQDSP,INPUT=(R3,R6,R7),OUTPUT=(R1,R4,RA,WORK=R0       @D62BDAP 00590000
         DROP  R7                  RELEASE LINK REGISTER       @D62BDAP 00591000
         B     INITRG                   ====================>> @D62BDAP 00592000
         DROP  RE                  RELEASE CRTSAV BASE         @D62BDAP 00593000
         DROP  R6                  RELEASE DISPATCHER BASE     @D62BDAP 00594000
         DROP  R8                  RELEASE ATTENTION PROCESS BASE       00595000
         DROP  R9                  RELEASE IOINTER BASE        @D62BDAP 00596000
         DROP  R1                  RELEASE CCB BASE            @D62BDAP 00597000
         DROP  R2                  RELEASE CCT BASE            @D62BDAP 00598000
         DROP  R3                  RELEASE PUB BASE            @D62BDAP 00599000
         DROP  R4                  RELEASE CHANQ BASE          @D62BDAP 00600000
         DROP  RA                  RELEASE PIB BASE POINTER    @D62BDAP 00601000
         EJECT                                                 @D62BDAP 00602000
         DC    0D'0'                                           @D62BDAP 00603000
ATTACCB  CCB   SYSLOG,ATTASNS,X'1500'                          @D62BDAP 00604000
         ORG   ATTACCB+6                                       @D62BDAP 00605000
         DC    X'88'               EXCPREAL + PHYSICAL ADDR.   @D62BDAP 00606000
         ORG   ATTACCB+12                                      @D62BDAP 00607000
         DC    AL1(64),AL3(ATTB000) APPENDAGE ROUTINE ADDR.    @D62BDAP 00608000
         ORG   ,                                               @D62BDAP 00609000
ATTASNS  CCW   X'04',ATTASNSD,X'60',4                          @D62BDAP 00610000
ATTAREAD CCW   X'06',ATTAINP,X'20',0                           @D62BDAP 00611000
ATTASNSE CCW   X'04',ATTASNSD,X'20',4                          @D62BDAP 00612000
ATTAWDEL CCW   X'01',ATTAINP,X'20',0                           @D62BDAP 00613000
ATTAWRIT CCW   X'01',ATTAWCC,X'60',56                          @D62BDAP 00614000
ATTAERAS CCW   X'0F',ATTAWCCE,X'20',7                          @D62BDAP 00615000
         SPACE 3                                               @D62BDAP 00616000
AATTAERR DC    A(ATTASNSE)                                     @D52VDAP 00617000
AATTAERA DC    A(ATTAWDEL)                                     @D52VDAP 00618000
         SPACE 3                                               @D62BDAP 00619000
ATTCHANQ DC    AL1(NOTQUED),AL3(ATTACCB)                       @D62BDAP 00620000
         DC    AL1(0),AL1(CHQPROCF),AL1(04),AL1(SNSTID)        @D62BDAP 00621000
         DC    AL1(0)                                          @D62BDAP 00622000
         DC    AL1(ACCUNRIO+POSTDE+OWNUCRT)                    @D62BDAP 00623000
         DC    AL1(0)                                          @D62BDAP 00624000
         DC    AL1(USENSE+TPAPPEN)                             @D62BDAP 00625000
         DC    AL4(0)                                          @D62BDAP 00626000
         DC    AL1(0)                                          @D51ODGL 00627000
         AIF   (&AG1 LE 254).LOD0045                           @D51ODGL 00628000
         DC    AL1(NOTQUED)           CHQCHNHI ALSO NOTQUED    @D51ODGL 00629000
.LOD0045 AIF   (&AG1 GT 254).LOD0046                           @D51ODGL 00630000
         DC    AL1(0)                                          @D51ODGL 00631000
.LOD0046 ANOP                                                  @D51ODGL 00632000
         DC    AL2(0)                                          @D62BDAP 00633000
         DC    AL1(CHQFSIO1),AL1(0),AL1(CHQCRT),AL1(0)         @D62BDAP 00634000
         DC    AL4(0)                                          @D62BDAP 00635000
         DC    AL4(0)                                          @D62BDAP 00636000
         SPACE 3                                               @D62BDAP 00637000
ATTSAVRB DC    F'0'                INTERRUPTED TASKS SAVE AREA @D62BDAP 00638000
ATTACLRC DC    168X'00'                                        @D62BDAP 00639000
ATTCOUNT DC    H'0'                NO. OF RELEVANT INPUT       @D62BDAP 00640000
ATTAINP  EQU   ATTACLRC+1                                      @D62BDAP 00641000
ATTAINPD EQU   ATTAINP+6                                       @D62BDAP 00642000
ATTASNSD DC    XL4'00'                                         @D62BDAP 00643000
ATTACTL  DC    X'1D4013'                                       @D62BDAP 00644000
ATTAWCCE DC    X'461140401D4013'                               @D62BDAP 00645000
ATTAWCC  DC    X'461140401D60',CL50'0D14I COMMAND IGNORED'     @D62BDAP 00646000
         DC      X'11C1501D60',CL50' '                         @D62BDAP 00647000
ATTALNE3 DC      X'11C2601D60',CL50' '                         @D62BDAP 00648000
ATTALNE4 DC      X'11C3F01D60',CL50' '                         @D62BDAP 00649000
ATTALNE5 DC      X'11C5401D60',CL50' '                         @D62BDAP 00650000
ATTALNE6 DC      X'11C6501D60',CL50' '                         @D62BDAP 00651000
ATTALNE7 DC      X'11C7601D60',CL50' '                         @D62BDAP 00652000
ATTALNE8 DC      X'11C8F01D60',CL50' '                         @D62BDAP 00653000
ATTALNE9 DC      X'114A401D60',CL50' '                         @D62BDAP 00654000
ATTALN10 DC      X'114B501D60',CL50' '                         @D62BDAP 00655000
         DC      X'114C601D60',CL50' '                         @D62BDAP 00656000
ATTALN12 DC      X'114DF01D60',CL25'PRESS ENTER TO CONTINUE   '@D62BDAP 00657000
         DC      X'1D4013'                                     @D62BDAP 00658000
         SPACE                                                 @D62BDAP 00659000
AIDTABLE DC    0F'0'                                           @D62BDAP 00660000
         DC    XL1'7D',AL3(ATTAID7D) ENTER KEY                 @D62BDAP 00661000
         DC    XL1'60',AL3(ATTAID60) UNSOLICITED               @D62BDAP 00662000
         DC    XL1'6C',AL3(ATTAID6C) PA1  KEY                  @D62BDAP 00663000
         DC    XL1'6E',AL3(ATTAID6E) PA2  KEY (CANCEL)         @D62BDAP 00664000
         DC    XL1'6B',AL3(ATTAID6B) PA3  KEY                  @D62BDAP 00665000
         DC    XL1'6D',AL3(ATTAID6D) CLEAR KEY                 @D62BDAP 00666000
         DC    XL1'7E',AL3(ATTAID7E) SELECTOR PEN              @D62BDAP 00667000
         DC    XL1'F1',AL3(ATTAIDF1) PF01 KEY                  @D62BDAP 00668000
         DC    XL1'F2',AL3(ATTAIDF2) PF02 KEY                  @D62BDAP 00669000
         DC    XL1'F3',AL3(ATTAIDF3) PF03 KEY                  @D62BDAP 00670000
         DC    XL1'F4',AL3(ATTAIDF4) PF04 KEY                  @D62BDAP 00671000
         DC    XL1'F5',AL3(ATTAIDF5) PF05 KEY                  @D62BDAP 00672000
         DC    XL1'F6',AL3(ATTAIDF6) PF06 KEY                  @D62BDAP 00673000
         DC    XL1'F7',AL3(ATTAIDF7) PF07 KEY                  @D62BDAP 00674000
         DC    XL1'F8',AL3(ATTAIDF8) PF08 KEY                  @D62BDAP 00675000
         DC    XL1'F9',AL3(ATTAIDF9) PF09 KEY                  @D62BDAP 00676000
         DC    XL1'7A',AL3(ATTAID7A) PF10 KEY                  @D62BDAP 00677000
         DC    XL1'7B',AL3(ATTAID7B) PF11 KEY                  @D62BDAP 00678000
         DC    XL1'7C',AL3(ATTAID7C) PF12 KEY                  @D62BDAP 00679000
         DC    XL1'E6',AL3(ATTAIDE6) CARD READER               @D62BDAP 00680000
         DC    XL1'E8',AL3(ATTAIDE8) PRINTER                   @D62BDAP 00681000
AIDTBLST DC    XL1'00',AL3(ATTAIDF0) ANY OTHER KEY             @D62BDAP 00682000
AIDTBEND EQU   *                                               @D62BDAP 00683000
         TITLE 'VSE SUPERVISOR     SGATT     APPENDAGE PROCESSING     ' 00684000
         USING INTRTN,R9           IOINTER BASE                @D62BDAP 00685000
         USING DISP,R6 DISPATCHER BASE                         @D62BDAP 00686000
         USING ATTB000,R8          APPENDAGE BASE POINTER      @D62BDAP 00687000
         USING CCBADR,R1 CCB BASE POINTER                      @D62BDAP 00688000
         USING CHNTBL,R2 CCT BASE POINTER                      @D62BDAP 00689000
         USING PUBADR,R3 PUB BASE POINTER                      @D62BDAP 00690000
         USING CHQADR,R4 CHANQ BASE POINTER                    @D62BDAP 00691000
         USING PIBADR,RA PIB BASE POINTER                      @D62BDAP 00692000
.*                                                             @D62BDAP 00693000
.*                                                             @D62BDAP 00694000
.*       INTERRUPT APPENDAGE PROCESSING.                       @D62BDAP 00695000
.*                                                             @D62BDAP 00696000
.*                                                             @D62BDAP 00697000
.*                                                             @D62BDAP 00698000
ATTB000  DS    0H'0'               ENTRY POINT FOR APPENDAGE   @D62BDAP 00699000
         L     R8,AATTINT          SGATT BASE ADDRESS          @D62BDAP 00700000
         USING ATTINT,R8           SGATT PERMANENT BASE        @D62BDAP 00701000
         LA    RF,ATTAERAS+8       OUR CCW END ADDRESS         @D62BDAP 00702000
         CLM   RF,7,CSW+1          IS THIS OUR CCW             @D62BDAP 00703000
         BL    ATTB010             NO                          @D62BDAP 00704000
         LA    RF,ATTASNS          OUR CCW BEGIN ADDRESS       @D62BDAP 00705000
         CLM   RF,7,CSW+1          IS THIS OUR CCW             @D62BDAP 00706000
         BNH   ATTB020             YES                         @D62BDAP 00707000
         OC    CSW(4),CSW          IS IT PRIMARY INTERRUPT     @D62BDAP 00708000
         BZ    ATTB020             NO,                         @D62BDAP 00709000
ATTB010  MVC   ATTCSWSV(8),CSW     SAVE CSW FOR LATER USE      @D62BDAP 00710000
         OI    ATTFLAG,ATTFINTR    INDICATE TRAPPED INTERRUPT  @D62BDAP 00711000
         BR    R6                       ====================>>>@D62BDAP 00712000
ATTB020  MVI   RID+1,SYSTEMID      INDICATE SYSTEM IS RUNNING  @D62BDAP 00713000
         TM    PUBCSFLG,DEVBSY     DID OUR REQUEST GET STARTED @D62BDAP 00714000
         BZ    0(R7)               NO,  ====================>> @D62BDAP 00715000
         TM    DEVSTA,UNITCK       DID WE GET A UNIT CHECK     @D62BDAP 00716000
         BO    ATTERRUC            YES, GET SENSE DATA         @D62BDAP 00717000
         TM    CHNSTA,CHDTA+CHCHN+CHNCHK CHAN ERROR            @D62BDAP 00718000
         BNZ   0(R7)               YES, ====================>> @D62BDAP 00719000
         TM    DEVSTA,UNITEXCP     I/O TO BE RETRIED           @D62BDAP 00720000
         BNZ   0(R7)               YES, ====================>> @D62BDAP 00721000
         TM    DEVSTA,DEVEND       IS THIS ENDING STATUS       @D62BDAP 00722000
         BO    ATTB030             YES                         @D62BDAP 00723000
         TM    DEVSTA,CHANEND      IS THIS PRIMARY STATUS      @D62BDAP 00724000
         BO    0(R6)               YES, ===================>>> @D62BDAP 00725000
ATTB030  CLC   ATTACCB+8(4),AATTAERR IS THIS ERROR SENSE       @D62BDAP 00726000
         BE    ATTERR20            YES, CHECK SENSE BYTES      @D62BDAP 00727000
         CLC   ATTACCB+8(4),AATTAERA IS THIS THE ERASE CCW     @D62BDAP 00728000
         BL    ATTC000             NO,  =====================> @D62BDAP 00729000
ATTB040  NI    PUBCSFLG,XFF-DEVBSY-QEDERR RESET GATING BITS    @D62BDAP 00730000
         MVC   PUBCHQPT(1),CHQCHAIN MAKE NEXT REQUEST 1ST      @D62BDAP 00731000
         AIF   (&AG1 LE 254).LOD0050                           @D51ODGL 00732000
         MVC   PUBCHQPH(1),CHQCHNHI                            @D51ODGL 00733000
.LOD0050 ANOP                                                  @D51ODGL 00734000
         SLR   RD,RD               CLEAR REGISTER              @D62BDAP 00735000
         IC    RD,CHQCHAIN         GET CURRENT CHAIN POINTER   @D62BDAP 00736000
         AIF   (&AG1 LE 254).LOD0060                           @D51ODGL 00737000
         ICM   RD,2,CHQCHNHI                                   @D51ODGL 00738000
.LOD0060 ANOP                                                  @D51ODGL 00739000
         MVI   CHQCCSIO,ZERO       RESET ATT-SIO BITS          @D62BDAP 00740000
         CLI   PUBCHQPT,XFF        IS ANOTHER I/O WAITING      @D62BDAP 00741000
         BE    ATTB060             NO,                         @D62BDAP 00742000
         SLL   RD,CHQSLEN          MULTILPY WITH ENTRY-LENGTH  @D62BDAP 00743000
         A     RD,ACHANQ           ADD CHANQ BEGIN ADDRESS     @D62BDAP 00744000
         LA    RD,0(,RD)           SWITCH OFF UPPERMOST BYTE   @D51ODGL 00745000
         DROP  R4                  RELEASE CURRENT CHANQ BASE  @D62BDAP 00746000
         USING CHQADR,RD           NEXT CHANQ BASE             @D62BDAP 00747000
         TM    CHQFLG1,CHQCSBSY    WAS DEVICE BUSY BEFORE      @D62BDAP 00748000
         BZ    ATTB050             NO                          @D62BDAP 00749000
         OI    PUBCSFLG,DEVBSY     KEEP IT BUSY                @D62BDAP 00750000
         NI    CHQFLG1,XFF-CHQCSBSY RESET SAVED BUSY BIT       @D62BDAP 00751000
ATTB050  TM    CHQFLG1,CHQCSQED    WAS DEVICE IN ERROR         @D62BDAP 00752000
         BZ    ATTB060             NO                          @D62BDAP 00753000
         OI    PUBCSFLG,QEDERR     KEEP IT QUEUED IN ERROR     @D62BDAP 00754000
         NI    CHQFLG1,XFF-CHQCSQED RESET QUEUED IN ERROR BIT  @D62BDAP 00755000
         DROP  RD                  RELEASE CURRENTLY FIRST     @D62BDAP 00756000
         USING CHQADR,R4           STANDARD CHANQ BASE         @D62BDAP 00757000
ATTB060  LR    R7,R5               SAVE REGISTER CONTENTS      @D62BDAP 00758000
         L     R5,ASRQTAB          ADDRESS OF RESOURCE QUEUE   @D62BDAP 00759000
         LA    R5,SRQCHQ-SRQTAB(R5) GET RESOURCE POINTER       @D62BDAP 00760000
         BAL   RF,RPOST            POST WAITERS                @D62BDAP 00761000
*SGLINK  RPOST,INPUT=(R5,R6,RF),WORK=(R5,RE)                   @D62BDAP 00762000
         LR    R5,R7               RESTORE REGISTER            @D62BDAP 00763000
         TM    ATTFLAG,ATTFINTR    DID WE TRAP AN INTERRUPT    @D62BDAP 00764000
         BZ    ATTB070             NO,                         @D62BDAP 00765000
         MVC   CSW(8),ATTCSWSV     RESTORE TRAPPED CSW         @D62BDAP 00766000
         NI    ATTFLAG,XFF-ATTFINTR RESET TRAPPED BIT          @D62BDAP 00767000
         BAL   R7,CQDSP            SET UP POINTERS ACCORDINGLY @D62BDAP 00768000
*SGLINK  CQDSP,INPUT=(R3,R6,R7),OUTPUT=(R1,R4,RA,WORK=R0       @D62BDAP 00769000
         B     OLTRET2                  ====================>> @D62BDAP 00770000
ATTB070  TM    ATTFLAG,ATTFACRT    IS CRT TO BE ACTIVATED      @D62BDAP 00771000
         BZ    INITRG              NO,  ====================>> @D62BDAP 00772000
         NI    ATTFLAG,XFF-ATTFACRT RESET TO BE ACTIVATED BIT  @D62BDAP 00773000
         XC    CSW(8),CSW          CLEAR CSW                   @D62BDAP 00774000
         MVI   DEVSTA,ATTENT       SIMULATE ATTENTION          @D62BDAP 00775000
ATTB080  BAL   R7,CQDSP            SET UP POINTERS ACCORDINGLY @D62BDAP 00776000
*SGLINK  CQDSP,INPUT=(R3,R6,R7),OUTPUT=(R1,R4,RA,WORK=R0       @D62BDAP 00777000
         B     ATTOCRTN                 ====================>> @D62BDAP 00778000
*                                                              @D62BDAP 00779000
         SPACE 3                                               @D62BDAP 00780000
ATTERRUC EQU   *                                               @D62BDAP 00781000
         CLC   ATTACCB+8(4),AATTAERR ERROR DURING SENSE        @D62BDAP 00782000
         BE    ATTERR30            YES, CHECK SENSE BYTES      @D62BDAP 00783000
         L     RD,ATTACCB+8        ID AND COMMAND POINTER      @D62BDAP 00784000
         OC    ATTERRSV,ATTERRSV   SAVE AREA FREE              @D62BDAP 00785000
         BNZ   ATTERR10            NO, DONT OVERWRITE          @D62BDAP 00786000
         ST    RD,ATTERRSV         SAVE INFORMATION            @D62BDAP 00787000
ATTERR10 L     RD,AATTAERR         ADDRESS OF SNS CCW          @D62BDAP 00788000
         ST    RD,ATTACCB+8        SET UP SENSE CCW            @D62BDAP 00789000
         B     0(R7)               EXECUTE SENSE COMMAND       @D62BDAP 00790000
ATTERR20 EQU   *                                               @D62BDAP 00791000
         L     RD,ATTERRSV         ID AND COMMAND POINTER      @D62BDAP 00792000
         ST    RD,ATTACCB+8        RESTORE ID AND CMD POINTER  @D62BDAP 00793000
         XC    ATTERRSV,ATTERRSV   CLEAR SAVE AREA             @D62BDAP 00794000
         TM    ATTASNSD,X'40'      IS INTERVENTION REQUIRED    @D62BDAP 00795000
         BZ    ATTERR30            NO                          @D62BDAP 00796000
         LR    R7,R6               FORCE EXIT TO DISPATCHER    @D62BDAP 00797000
         OI    PUBCSFLG,OPINTV     SET INTERVENTION REQUIRED   @D62BDAP 00798000
ATTERR30 MVC   2(2),PUBCHANN       SET UP DEVICE ADDRESS       @D62BDAP 00799000
         B     0(R7)               RETRY WHEN DEVICE IS READY  @D62BDAP 00800000
*                                                              @D62BDAP 00801000
*                                                              @D62BDAP 00802000
ATTERRSV DC    F'0'               SAVE AREA IN CASE OF ERROR   @D62BDAP 00803000
         SPACE 3                                               @D62BDAP 00804000
         DROP  R2                 RELEASE CCT BASE POINTER     @D62BDAP 00805000
         DROP  R4                 RELEASE CHANQ BASE POINTER   @D62BDAP 00806000
         DROP  R8                 RELEASE SGATT BASE POINTER   @D62BDAP 00807000
         TITLE 'CRT SIO INTERCEPT PROCESSING                          ' 00808000
.*                                                             @D62BDAP 00809000
*                                                              @D62BDAP 00810000
*       SYSOCDEV I/O REQUEST IS GOING TO BE STARTED            @D62BDAP 00811000
*                                                              @D62BDAP 00812000
.*                                                             @D62BDAP 00813000
.*       THE REQUEST WHICH IS ABOUT TO BE STARTED IS EITHER    @D62BDAP 00814000
.*                                                             @D62BDAP 00815000
.*             1. CRT REQUEST                                  @D62BDAP 00816000
.*             2. OCCF REQUEST                                 @D62BDAP 00817000
.*             3. SGATT REQUEST PUBCHQPT = ZERO                @D62BDAP 00818000
.*                                                             @D62BDAP 00819000
         USING CRTSAV,RE           CRT SAVE AREA               @D62BDAP 00820000
*        USING CUU,R2              CUU ADDRESS OF CONSOLE      @D62BDAP 00821000
         USING ATTB500,R8          ROUTINE BASE ADDRESS        @D62BDAP 00822000
         USING SGSCHED,RD          SGSCHED BASE POINTER        @D62BDAP 00823000
         USING CHQADR,R4           CHANQ BASE POINTER          @D62BDAP 00824000
ATTB500  EQU   *                                               @D62BDAP 00825000
         TM    SYSFLAG2,IPLBIT     IS IPL IN PROCESS           @D62BDAP 00826000
         BOR   R5                  YES, ======================>>        00827000
         TM    SYSFLAG5,X'10'      IS OUR CODE ACTIVE          @D62BDAP 00828000
         BZR   R5                  NO   ====================>> @D62BDAP 00829000
         L     R8,AATTINT          SGATT BASE ADDRESS          @D62BDAP 00830000
         USING ATTINT,R8           SGATT BASE POINTER          @D62BDAP 00831000
         CLI   PUBCHQPT,ZERO       IS OUR REQUEST ONGOING      @D62BDAP 00832000
         AIF   (&AG1 LE 254).LOD0070                           @D51ODGL 00833000
         BNE   ATTB502             NO..                        @D51ODGL 00834000
         CLI   PUBCHQPH,ZERO       REALLY?                     @D51ODGL 00835000
.LOD0070 ANOP                                                  @D51ODGL 00836000
         BE    ATTB540             YES, OTHERS HAVE TO WAIT    @D62BDAP 00837000
ATTB502  L     R7,CCBCCW           GET CCW ADDRESS             @D51ODGL 00838000
         LA    R7,0(,R7)           CLEAR HIGH ORDER BYTE       @D62BDAP 00839000
         STNSM PSWMASK,XFF-SMDAT   SET OFF DAT BIT             @D62BDAP 00840000
*                                                              @D62BDAP 00841000
*        A T T E N T I O N                                     @D62BDAP 00842000
*        THIS CODE IS  EXECUTING WITH 'DAT' BIT OFF            @D62BDAP 00843000
*                                                              @D62BDAP 00844000
         CLI   0(R7),X'06'         IS THIS A READ COMMAND      @D62BDAP 00845000
         BNE   ATTB520             NO,                         @D62BDAP 00846000
         DROP  RD                  RELEASE SGSCHED BASE        @D62BDAP 00847000
         L     RD,0(R7)            GET I/O AREA ADDRESS        @D62BDAP 00848000
         LA    RD,0(,RD)           CLEAR HIGH ORDER BYTE       @D62BDAP 00849000
         LH    R5,ATTCRTLN         SET TO DEFAULT LENGTH=3     @D62BDAP 00850000
         CH    R5,6(R7)            MORE BYTES REQUESTED        @D62BDAP 00851000
         BNH   ATTB510             YES                         @D62BDAP 00852000
         LH    R5,6(R7)            LIMIT TO USER LENGTH        @D62BDAP 00853000
         STH   R5,ATTCRTLN         ENSURE RESIDUAL COUNT 0     @D62BDAP 00854000
ATTB510  BCTR  R5,0                ADJUST FOR EXECUTE          @D62BDAP 00855000
         EX    R5,ATTEXCRT         MOVE WHAT WE HAVE SAVED     @D62BDAP 00856000
         LA    R5,1(,R5)           GET CORRECT BYTE COUNT      @D62BDAP 00857000
         SH    R5,6(R7)            NEGATIVE RESIDUAL COUNT     @D62BDAP 00858000
         LPR   R5,R5               MAKE VALUE POSITIVE         @D62BDAP 00859000
         STH   R5,CSW+6            SET RESIDUAL COUNT          @D62BDAP 00860000
         STOSM PSWMASK,SMDAT       SET  DAT BIT AGAIN          @D62BDAP 00861000
*                                                              @D62BDAP 00862000
*        A T T E N T I O N                                     @D62BDAP 00863000
*        END OF 'DAT' BIT OFF CODE -- 'DAT' IS NOW ON AGAIN    @D62BDAP 00864000
*                                                              @D62BDAP 00865000
         MVI   ATTCRTLN,ZERO       SET                         @D62BDAP 00866000
         MVI   ATTCRTLN+1,X'03'    INDICATE THREE BYTES READ   @D62BDAP 00867000
         LA    R5,8(,R7)           POINT PAST CCW              @D62BDAP 00868000
         ICM   R5,8,CHQCSW         GET PROTECTION KEY          @D62BDAP 00869000
         ST    R5,CSW              ENDING CCW ADDRESS          @D62BDAP 00870000
         MVI   DEVSTA,X'0C'        POST CHANNEL+DEVICE END     @D62BDAP 00871000
         MVI   CHNSTA,X'00'        POST CHANNEL+DEVICE END     @D62BDAP 00872000
         OI    CHQCCSIO,CHQCCRUN+CHQCCACT DEVICE IS RUNNING    @D62BDAP 00873000
         NI    ATTFLAG,XFF-ATTFDATA-ATTFACRT RESET FLAG BITS   @D62BDAP 00874000
         STH   R2,CHNADR           SET CUU IN LOW CORE         @D62BDAP 00875000
         BAL   R7,CQDSP            SET UP POINTERS ACCORDINGLY @D62BDAP 00876000
*SGLINK  CQDSP,INPUT=(R3,R6,R7),OUTPUT=(R1,R4,RA,WORK=R0       @D62BDAP 00877000
         L     R9,AINTER           PROVIDE IOINTER BASE        @D62BDAP 00878000
         BR    R9                       ====================>> @D62BDAP 00879000
         SPACE 2                                               @D62BDAP 00880000
ATTEXCRT MVC   0(0,RD),ATTCRTD     MOVE DATA TO REQUESTOR      @D62BDAP 00881000
         SPACE 3                                               @D62BDAP 00882000
ATTB520  DS     0H'0'                                          @D62BDAP 00883000
         STOSM PSWMASK,SMDAT       SET  DAT BIT AGAIN          @D62BDAP 00884000
         BR    R5                       ====================>> @D62BDAP 00885000
         SPACE 3                                               @D62BDAP 00886000
         USING SGSCHED,RD          SGSCHED BASE POINTER        @D62BDAP 00887000
ATTB540  LTR   R7,R7               IS THIS CRT OR OCCF REQUEST @D62BDAP 00888000
         BZ    ATTB580             YES,                        @D62BDAP 00889000
         SLR   R7,R7               CLEAR REGISTER              @D62BDAP 00890000
         IC    R7,CHQCHAIN         GET CHAIN POINTER           @D62BDAP 00891000
         AIF   (&AG1 LE 254).LOD0080                           @D51ODGL 00892000
         ICM   R7,2,CHQCHNHI                                   @D51ODGL 00893000
.LOD0080 ANOP                                                  @D51ODGL 00894000
         SLL   R7,CHQSLEN          OFFSET IN CHANQ             @D62BDAP 00895000
         A     R7,ACHANQ           ADDRESS OF CHANQ ENTRY      @D62BDAP 00896000
         LA    R7,0(,R7)           RESET UPPERMOST BYTE        @D51ODGL 00897000
         NI    CHQFLG1-CHQADR(R7),XFF-CHQCSBSY RESET GATE      @D62BDAP 00898000
         BR    R6                       ===================>>> @D62BDAP 00899000
         USING SGSCHED,RD          SGSCHED BASE POINTER        @D62BDAP 00900000
ATTB580  B     SIOXRETN            RETURN TO MAIN PATH         @D62BDAP 00901000
         DROP  RD                  RELEASE SGSCHED BASE        @D62BDAP 00902000
         DROP  RE                  RELEASE CRTSAV              @D62BDAP 00903000
         DROP  R4                  RELEASE CHANQ POINTER       @D62BDAP 00904000
AATTINT  DC    A(ATTINT)           BASE POINTER                @D62BDAP 00905000
AATTPFTB DC    A(ATTPFTAB)         BASE POINTER                @D62BDAP 00906000
ATTPFLEN DC    AL2(ATTPFTEN-ATTPFTLS)  PF TABLE ENTRY LEN      @D52VDAP 00907000
         TITLE 'VSE SUPERVISOR     SGATT    ANALIZE CAUSE OF ATTENTION' 00908000
         USING CHQADR,R4           CHANQ BASE POINTER          @D62BDAP 00909000
         USING ATTINT,R8           SGATT BASE POINTER          @D62BDAP 00910000
ATTC000  LH    R0,CHQCSW+6         GET RESIDUAL COUNT          @D62BDAP 00911000
         STH   R0,ATTACCB          SAVE IT IN CCB              @D62BDAP 00912000
         LCR   R0,R0               MAKE IT NEGATIVE            @D62BDAP 00913000
         AH    R0,ATTAREAD+6       LENGTH OF INPUT AREA        @D62BDAP 00914000
         STH   R0,ATTCOUNT         SAVE INPUT LENGTH           @D62BDAP 00915000
         LA    RE,ATTAINP          ADDRESS OF INPUT            @D62BDAP 00916000
         CLI   PUBDEVTY,T1050A     IS THIS A 1052 DEVICE       @D62BDAP 00917000
         BE    ATTISATT            YES                         @D62BDAP 00918000
         LA    RC,AIDTABLE         PA KEY TABLE ADDRESS        @D62BDAP 00919000
         MVC   AIDTBLST(1),ATTAINP SET UP LOOP END INDICATOR   @D62BDAP 00920000
ATTC020  CLC   0(1,RC),ATTAINP     IS THIS THE CORRECT ENTRY   @D62BDAP 00921000
         BE    ATTC030             YES                         @D62BDAP 00922000
         LA    RC,AIDTBEND-AIDTBLST(,RC) BUMP TO NEXT ENTRY    @D62BDAP 00923000
         B     ATTC020                                         @D62BDAP 00924000
ATTC030  SLR   RF,RF               PASS RF=0 TO ROUTINES       @D62BDAP 00925000
         L     RD,0(RC)            GET ROUTINE ADDRESS         @D62BDAP 00926000
         LA    RD,0(,RD)           CLEAR HIGH ORDER BYTE       @D62BDAP 00927000
         BR    RD                  BRANCH TO APPROPRIATE ROUTINE        00928000
         SPACE 3                                               @D62BDAP 00929000
         TITLE 'VSE SUPERVISOR     SGATT     ENTER KEY PROCESSING     ' 00930000
ATTAID7D LH    RF,ATTCOUNT         GET LENGTH OF INPUT         @D62BDAP 00931000
         SH    RF,H6               SUBTRACT HEADER BYTES       @D62BDAP 00932000
         STH   RF,ATTCOUNT         ACTUAL NUMBER OF DATA BYTES @D62BDAP 00933000
         BNP   ATTISCRT            NO DATA, PASS TO CRT        @D62BDAP 00934000
         LA    RE,ATTAINPD         ADDRESS OF DATA BYTES       @D62BDAP 00935000
         LR    RC,RE               COPY DATA ADDRESS           @D62BDAP 00936000
ATT7D000 CLI   0(RE),C' '          IS THIS A LEADING BLANK     @D62BDAP 00937000
         BNE   ATT7D010            NO, ANALYSE                 @D62BDAP 00938000
         LA    RE,1(,RE)           POINT TO NEXT INPUT BYTE    @D62BDAP 00939000
         BCT   RF,ATT7D000         TEST NEXT CHARACTER         @D62BDAP 00940000
         B     ATT7D110            PASS BLANK LINE ALONG       @D62BDAP 00941000
ATT7D010 STH   RF,ATTCOUNT         ACTUAL NUMBER OF DATA BYTES @D62BDAP 00942000
         BCTR  RF,0                ADJUST FOR EXECUTE          @D62BDAP 00943000
         EX    RF,ATTEXMVC         MOVE DATA TO BEGIN OF BUFFER@D62BDAP 00944000
         SR    RE,RC               NUMBER OF LEADING BLANKS    @D62BDAP 00945000
         BZ    ATT7D020            NO LEADING BLANKS           @D62BDAP 00946000
         BCTR  RE,0                ADJUST FOR EXECUTE          @D62BDAP 00947000
         LA    RC,1(RC,RF)         ADDRESS OF WHERE TO CLEAR   @D62BDAP 00948000
         EX    RE,ATTEXCLR         CLEAR REMNANT IN BUFFER     @D62BDAP 00949000
ATT7D020 LA    RE,ATTAINPD         ADDRESS OF DATA BYTES       @D62BDAP 00950000
         TM    0(RE),C'0'          IS THIS A DIGIT             @D62BDAP 00951000
         BO    ATT7D090            YES, DONT TRANSLATE         @D62BDAP 00952000
         EX    RF,ATTEXTR          TRANSLATE TO UPPER CASE     @D62BDAP 00953000
ATT7D090 LA    RF,1(,RF)           RESTORE INPUT COUNT         @D62BDAP 00954000
         CLI   ATTAINP,X'7D'       WAS THIS THE ENTER KEY      @D62BDAP 00955000
         BE    ATT7D100            YES                         @D62BDAP 00956000
         CLI   ATTAINP,X'60'       WAS THIS THE ENTER KEY      @D62BDAP 00957000
         BNE   ATT7D110            NO, DONT SAVE               @D62BDAP 00958000
ATT7D100 STM   R0,R1,ATTR0R1S      SAVE R0 AND R1              @D62BDAP 00959000
         LA    R0,6(,RF)           ADD HEADER BYTES            @D62BDAP 00960000
         LA    R1,ATTAINP          I/O AREA ADDRESS            @D62BDAP 00961000
         L     RF,ABUFMGNT         BUFFER MANAGEMENT ROUTINE   @D62BDAP 00962000
         USING BUFMGNMT,RF                                     @D62BDAP 00963000
         BAL   RE,BUFMGENT         EXECUTE SUBROUTINE          @D62BDAP 00964000
         DROP  RF                                              @D62BDAP 00965000
         LM    R0,R1,ATTR0R1S      RESTORE R0 AND R1           @D62BDAP 00966000
ATT7D110 LH    RF,ATTCOUNT         RESTORE RF                  @D62BDAP 00967000
         LA    RE,ATTAINPD         RESTORE RE                  @D62BDAP 00968000
         MVI   ATTAINP,X'7D'       INDICATE ATTENTION          @D62BDAP 00969000
         LA    RC,ATTCMDTB         COMMAND TABLE ADDRESS       @D62BDAP 00970000
         MVC   ATTCMDLS(6),0(RE)   SAVE COMMAND                @D62BDAP 00971000
         MVC   ATTCMDT3+3(3),3(RE) MOVE THREE BYTES            @D62BDAP 00972000
         MVC   ATTCMDT2+2(4),2(RE) MOVE FOUR  BYTES            @D62BDAP 00973000
         MVC   ATTCMDT1+1(5),1(RE) MOVE FIVE  BYTES            @D62BDAP 00974000
         CH    RF,H6               ENSURE 6 BYTE COMPARE       @D62BDAP 00975000
         BNH   ATT7D120            LESS BYTES TO COMPARE       @D62BDAP 00976000
         LA    RF,6                COMPARE 6 BYTES ONLY        @D62BDAP 00977000
ATT7D120 BCTR  RF,0                ADJUST FOR EXECUTE          @D62BDAP 00978000
ATT7D130 EX    RF,ATTEXCOM         COMPARE AGAINST TABLE       @D62BDAP 00979000
         BE    ATT7D140            ENTRY FOUND                 @D62BDAP 00980000
         LA    RC,ATTCMDEN-ATTCMDLS(,RC) POINT TO NEXT ENTRY   @D62BDAP 00981000
         B     ATT7D130            LOOP UNTIL FOUND            @D62BDAP 00982000
ATT7D140 L     RD,6(RC)            ADDRESS OF COMMAND EXIT     @D62BDAP 00983000
         BR    RD                  GO AND PROCESS COMMAND      @D62BDAP 00984000
ABUFMGNT DC    A(BUFMGNMT)                                     @D62BDAP 00985000
ATTR0R1S DC    2F'0'               SAVE AREA                   @D62BDAP 00986000
         SPACE 3                                               @D62BDAP 00987000
ATTEXTR  TR    0(0,RE),ATTTRTAB    TRANSLATE/COMPRESS INPUT    @D62BDAP 00988000
ATTEXMVC MVC   0(0,RC),0(RE)       SKIP BLANKS AND X'00'       @D62BDAP 00989000
ATTEXCLR XC    0(0,RC),0(RC)       CLEAR INPUT LINE            @D62BDAP 00990000
ATTEXCOM CLC   0(0,RE),0(RC)       DOES INPUT MATCH TAB-ENTRY  @D62BDAP 00991000
ATTEXSAV MVC   2(0,RC),0(RE)       SAVE JUST INPUTTED INFO     @D62BDAP 00992000
ATTEXSRM MVC   2(0,RC),0(RE)       SAVE REMAINDER OF INPUT     @D62BDAP 00993000
ATTFLAG  DC    XL1'00'             FLAG BYTE                   @D62BDAP 00994000
ATTCSWSV DC    XL8'00'             SAVED CSW INFORMATION       @D62BDAP 00995000
ATTFINTR EQU   X'80'               I/O INTERRUPT WAS SAVED     @D62BDAP 00996000
ATTFACRT EQU   X'40'               CRT MUST BE POSTED          @D62BDAP 00997000
ATTFDATA EQU   X'01'               INPUT DATA AVAILABLE        @D62BDAP 00998000
         SPACE 3                                               @D62BDAP 00999000
ATTTRHEX DC    C'0123456789ABCDEF'                             @D62BDAP 01000000
         SPACE 3                                               @D62BDAP 01001000
ATTCMDTB DS    0H'0'                                           @D62BDAP 01002000
         DC    C'D E   ',AL4(ATTISCRT)                         @D62BDAP 01003000
         DC    C'D L   ',AL4(ATTISCRT)                         @D62BDAP 01004000
         DC    C'D LOCA',AL4(ATTISATT)                         @D62BDAP 01005000
         DC    C'D LST ',AL4(ATTISATT)                         @D62BDAP 01006000
ATTCMDT3 DC    C'D L...',AL4(ATTISCRT)                         @D62BDAP 01007000
ATTCMDT2 DC    C'K ....',AL4(ATTISCRT)                         @D62BDAP 01008000
ATTCMDT1 DC    C'#.....',AL4(ATTISOUR)                         @D62BDAP 01009000
ATTCMDLS DC    C'......',AL4(ATTISATT)                         @D62BDAP 01010000
ATTCMDEN EQU   *                                               @D62BDAP 01011000
         EJECT                                                 @D62BDAP 01012000
ATTISCRT DC    0H'0'               MORE CHECKING REQUIRED      @D62BDAP 01013000
         TM    CRTFLG1,CRTATTH     DID CRT REQUEST READ        @D62BDAP 01014000
         BO    ATTCRT10            YES, CRT IS ALREADY WAITING @D62BDAP 01015000
         OI    CRTFLG2,CRTATTPD    INDICATE COMMAND PENDING    @D62BDAP 01016000
ATTCRT10 TM    ATTFLAG,ATTFDATA    DID WE STACK DATA           @D62BDAP 01017000
         BO    ATTMSG              YES, "COMMAND IGNORED"      @D62BDAP 01018000
         OI    ATTFLAG,ATTFACRT+ATTFDATA SET CRT BITS          @D62BDAP 01019000
         LH    RF,ATTCOUNT         GET INPUT COUNT             @D62BDAP 01020000
         LA    RF,5(,RF)           ADD CONTROL BYTES           @D62BDAP 01021000
         EX    RF,ATTTOCRT         MOVE INFO TO INPUT AREA     @D62BDAP 01022000
         LA    RF,1(,RF)           RE-ADJUST INPUT LENGTH      @D62BDAP 01023000
         STH   RF,ATTCRTLN         SAVE COUNT                  @D62BDAP 01024000
         B     ATTIGNOR            CLEAR AND RESET SCREEN      @D62BDAP 01025000
         SPACE 1                                               @D62BDAP 01026000
ATTTOCRT MVC   ATTCRTD(0),ATTAINP  MOVE DATA TO CRT INPUT      @D62BDAP 01027000
ATTCRTD  DC    XL166'00'           CRT COMMAND SAVE AREA       @D62BDAP 01028000
ATTCRTLN DC    H'3'                CRT DATA BYTES              @D62BDAP 01029000
         TITLE 'VSE SUPERVISOR     SGATT     FIND INTERNAL COMMAND    ' 01030000
ATTISOUR EQU   *                                               @D62BDAP 01031000
         LA    RC,ATTOURTB         ADDRESS OF SPECIAL COMMANDS @D62BDAP 01032000
         LH    RF,ATTCOUNT         GET NO. OF INPUTTED BYTES   @D62BDAP 01033000
         MVC   ATTOURLS(6),1(RE)   SAVE OPERATION FIELD        @D62BDAP 01034000
         CH    RF,H6               MORE THAN 6 BYTES INPUT     @D62BDAP 01035000
         BL    ATTISO10            NO, LESS                    @D62BDAP 01036000
         LA    RF,7                ENSURE 6 BYTE COMPARE       @D62BDAP 01037000
ATTISO10 BCTR  RF,0                ADJUST FOR # CHARACTER      @D62BDAP 01038000
         BCTR  RF,0                ADJUST FOR EXECUTE          @D62BDAP 01039000
         LTR   RF,RF               MORE THAN 1 BYTE ENTERED    @D52VDAP 01040000
         BM    ATTISATT            NO,                         @D52VDAP 01041000
ATTISO20 EX    RF,ATTEXOUR         FIND OPERATION IN TABLE     @D62BDAP 01042000
         BE    ATTISO30            FOUND AN APPROPRIATE ENTRY  @D62BDAP 01043000
         LA    RC,ATTOUREN-ATTOURLS(RC) POINT TO NEXT ENTRY    @D62BDAP 01044000
         B     ATTISO20            SCAN WHOLE TABLE            @D62BDAP 01045000
ATTISO30 L     RD,6(RC)            GET ROUTINE ADDRESS         @D62BDAP 01046000
         BR    RD                  ENTER APPROPRIATE ROUTINE   @D62BDAP 01047000
ATTMSGNA DC    C'NO INFORMATION AVAILABLE'                     @D62BDAP 01048000
         SPACE 1                                               @D62BDAP 01049000
ATTEXOUR CLC   0(0,RC),1(RE)       IS THIS MATCHING COMMAND    @D62BDAP 01050000
         SPACE 1                                               @D62BDAP 01051000
ATTOURTB DC    C'SET PF',AL4(ATTSPFPR)                         @D62BDAP 01052000
         DC    C'D P   ',AL4(ATTPSWPR)                         @D62BDAP 01053000
         DC    C'D G   ',AL4(ATTPSWPR)                         @D62BDAP 01054000
         DC    C'RETRIE',AL4(ATTRETVE)                         @D62BDAP 01055000
ATTOURLS DC    C'......',AL4(ATTISATT)                         @D62BDAP 01056000
ATTOUREN EQU   *                                               @D62BDAP 01057000
         TITLE 'VSE SUPERVISOR     SGATT     SET PROGRAM FUNCTION KEY ' 01058000
ATTSPFPR SLR   R0,R0               CLEAR OFFSET POINTER        @D62BDAP 01059000
         CLI   7(RE),C'0'          IS THIS A VALID DIGIT       @D62BDAP 01060000
         BL    ATTISATT            NO, PASS TO ATTENTION       @D62BDAP 01061000
         CLI   7(RE),C'9'          IS THIS A VALID DIGIT       @D62BDAP 01062000
         BH    ATTISATT            NO, PASS TO ATTENTION       @D62BDAP 01063000
         CLI   8(RE),C' '          IS NEXT CHAR A BLANK        @D62BDAP 01064000
         BNE   ATTSPF10            NO, CHECK NEXT BYTE         @D62BDAP 01065000
         LA    R0,9                OFFSET TO TEXT              @D62BDAP 01066000
         PACK  ATTWRKPF+6(2),7(1,RE) PACKED DECIMAL            @D62BDAP 01067000
         B     ATTSPF20                                        @D62BDAP 01068000
ATTSPF10 CLI   8(RE),C'0'          IS THIS ALSO A DIGIT        @D62BDAP 01069000
         BL    ATTISATT            NO, PASS TO ATTENTION       @D62BDAP 01070000
         CLI   8(RE),C'9'          IS THIS A VALID DIGIT       @D62BDAP 01071000
         BH    ATTISATT            NO, PASS TO ATTENTION       @D62BDAP 01072000
         CLI   9(RE),C' '          IS NEXT CHAR A BLANK        @D62BDAP 01073000
         BNE   ATTISATT            NO, PASS TO ATTENTION       @D62BDAP 01074000
         LA    R0,10               OFFSET TO TEXT              @D62BDAP 01075000
         PACK  ATTWRKPF+6(2),7(2,RE) PACKED DECIMAL            @D62BDAP 01076000
ATTSPF20 CVB   RF,ATTWRKPF         GET BINARY EQUIVALENT       @D62BDAP 01077000
         CH    RF,H12              IS VALUE GREATER 12         @D62BDAP 01078000
         BH    ATTISATT            YES, PASS TO ATTENTION      @D62BDAP 01079000
         MH    RF,ATTPFLEN         MULTIPLY WITH ENTRY LENGTH  @D62BDAP 01080000
         L     RC,AATTPFTB         BEGIN OF PF TABLE           @D62BDAP 01081000
         AR    RC,RF               PROPER TABLE ENTRY ADDRESS  @D62BDAP 01082000
         MVC   4(80,RC),3(RC)      CLEAR OLD PF SETTING        @D62BDAP 01083000
         MVI   0(RC),ZERO          CLEAR FLAG BYTE             @D62BDAP 01084000
         CH    R0,ATTCOUNT         DID USER GIVE ANY DATA      @D52VDAP 01085000
         BH    ATTIGNOR            NO, ALL WORK IS DONE        @D52VDAP 01086000
         LH    RF,ATTCOUNT         GET INPUT COUNT             @D62BDAP 01087000
         SR    RF,R0               SUBTRACT DUMMY BYTES        @D62BDAP 01088000
         AR    RE,R0               POINT TO FIRST TEXT BYTE    @D62BDAP 01089000
         CLC   0(4,RE),ATTCNIMM    IS THIS AN IMMEDIATE REQUEST@D62BDAP 01090000
         BE    ATTSPF30            YES                         @D62BDAP 01091000
         OI    0(RC),X'40'         INDICATE DELAYED REQUEST    @D62BDAP 01092000
         CLC   0(4,RE),ATTCNDEL    DID USER SPECIFY DEL        @D62BDAP 01093000
         BNE   ATTSPF50            NO,                         @D62BDAP 01094000
ATTSPF30 SH    RF,H4               ADJUST TO TEXT LENGTH       @D62BDAP 01095000
         BP    ATTSPF40            WE HAVE VALID DATA          @D52VDAP 01096000
         AH    RF,H4               RESTORE DATA LENGTH         @D52VDAP 01097000
         B     ATTSPF50            TREAT AS COMMAND            @D52VDAP 01098000
ATTSPF40 LA    RE,4(,RE)           POINT TO FIRST TEXT BYTE    @D62BDAP 01099000
ATTSPF50 STH   RF,1(RC)            SAVE TEXT LENGTH            @D62BDAP 01100000
         BCTR  RF,R0               ADJUST FOR EXECUTE          @D62BDAP 01101000
         EX    RF,ATTEXPFM         MOVE TEXT INTO TABLE        @D62BDAP 01102000
         B     ATTIGNOR            CLEAR SCREEN                @D62BDAP 01103000
ATTCNDEL DC    C'DEL '             DELAYED IDENTIFIER          @D62BDAP 01104000
ATTCNIMM DC    C'IMM '             IMMIDIATE IDENTIFIER        @D62BDAP 01105000
         SPACE                                                 @D62BDAP 01106000
ATTEXPFM MVC   4(0,RC),0(RE)       SAVE SETTING INTO TABLE     @D62BDAP 01107000
         SPACE 5                                               @D62BDAP 01108000
ATTWRKPF DC    D'0'                WORK FIELD                  @D62BDAP 01109000
         TITLE 'VSE SUPERVISOR     SGATT    SET UP ATTENTION INTERFACE' 01110000
         USING SVEARA,RF           SAVE AREA BASE POINTER      @D62BDAP 01111000
ATTPSWPR L     RF,ATTSAVRB         ADDRESS OF SAVE AREA        @D62BDAP 01112000
         LTR   RF,RF               WAS SYSTEM IN WAIT STATE    @D62BDAP 01113000
         BNZ   ATTPSW10            NO, ENTER APPROPRIATE ROUTINE        01114000
         MVC   0(L'ATTMSGNA,RE),ATTMSGNA INDICATE NOT AVAILABLE@D62BDAP 01115000
         LA    RF,L'ATTMSGNA       GET MSG LENGTH              @D62BDAP 01116000
         B     ATTRE210            GO AND ACTIVATE ATTENTION   @D62BDAP 01117000
ATTPSW10 LA    RF,1(RF)            SET UP FUNCTION CODE = 2    @D62BDAP 01118000
         MVC   0(6,RE),ATTCHPSW    INDICATE PSW                @D62BDAP 01119000
         UNPK  6(9,RE),SVEPSW(5)   UNPACK PSW INTO BUFFER AREA @D62BDAP 01120000
         UNPK  14(9,RE),SVEPSW2(5) UNPACK REMAINDER OF PSW     @D62BDAP 01121000
         MVI   22(RE),C' '         BLANK UNUSED CHARACTER      @D62BDAP 01122000
         TR    6(16,RE),ATTTRHEX-X'F0' FORCE HEX CHARACTERS    @D62BDAP 01123000
         LA    RF,21               LENGTH OF PRINT MESSAGE     @D62BDAP 01124000
         B     ATTRE210                                        @D62BDAP 01125000
ATTCHPSW DC    C'PSW = '           PREFIX FOR PSW DISPLAY      @D62BDAP 01126000
         TITLE 'VSE SUPERVISOR     SGATT     PROCESS USERS REPLY      ' 01127000
ATTISATT EQU   *                                               @D62BDAP 01128000
         CLI   PUBDEVTY,T1050A     IS THIS A 1052 DEVICE       @D62BDAP 01129000
         BNE   ATTISA20            NO, ITS A CRT DEVICE        @D62BDAP 01130000
         NI    ATTFLAG,XFF-ATTFDATA-ATTFACRT RESET FLAG BITS   @D62BDAP 01131000
         LH    RF,ATTCOUNT         GET LENGTH OF INPUT         @D62BDAP 01132000
         LTR   RF,RF               DID WE READ ANY DATA        @D62BDAP 01133000
         BZ    ATTB040             NO,  ====================>> @D62BDAP 01134000
         LR    RD,RE               COPY I/O AREA POINTER       @D62BDAP 01135000
ATTISA00 TM    0(RE),C'0'          IS THIS A DIGIT             @D62BDAP 01136000
         BO    ATTISA05            YES, DONT TRANSLATE         @D62BDAP 01137000
         BCTR  RF,0                ADJUST FOR EXECUTE          @D62BDAP 01138000
         EX    RF,ATTEXTR          TRANSLATE TO UPPER CASE     @D62BDAP 01139000
ATTISA05 LA    RF,1(,RF)           TRANSLATE TO UPPER CASE     @D62BDAP 01140000
ATTISA10 CLC   0(2,RE),ATTRCBCM    IS THIS REQUEST CANCEL      @D62BDAP 01141000
         BNE   ATTISA20            NO                          @D62BDAP 01142000
         LA    R0,2                INDICATE REQUEST CANCEL     @D62BDAP 01143000
         LR    RD,R8               SAVE BASE POINTER           @D62BDAP 01144000
         L     R8,ATINTADR         BASE OF AR INITIATOR        @DY40195 01145000
         BALR  R8,R8               ACTIVATE REQUEST CANCEL     @DY40195 01146000
*SGLINK  ATTNINT,INPUT=(R0,R6,R8),OUTPUT=R0                    @D62BDAP 01147000
         LR    R8,RD               RESTORE REGISTER            @D62BDAP 01148000
         B     ATTIGNOR                                        @D62BDAP 01149000
ATTISA20 TM    CRTFLG1,CRTATTH     IS CRT WAITING              @D62BDAP 01150000
         BO    ATTISCRT            YES, ALWAYS PASS TO CRT     @D62BDAP 01151000
         B     ATTIS010            NO                          @D62BDAP 01152000
         EJECT ,                                               @D62BDAP 01153000
ATTIS010 LH    RF,ATTCOUNT         LOAD REPLY LENGTH           @D62BDAP 01154000
         ICM   RC,15,IJBOCFCM      IS OCCF ACTIV               @D62BDAP 01155000
         BZ    ATTRE100            NO, BRANCH                  @D62BDAP 01156000
         USING OCFCOM,RC           BASE ADDR. FOR OCCF-COM-BLK @D62BDAP 01157000
         TM    OCFFLAGS,OCFINCOM   IS OCCF INITIALSAT. COMPL.  @D62BDAP 01158000
         BZ    ATTRE100            NO, BRANCH                  @D62BDAP 01159000
         TM    OCFRQFL1,OCFSYSCN   ANY INPUT STILL PENDING     @D62BDAP 01160000
         BO    ATTMSG              YES, IGNORE NEW INPUT       @D62BDAP 01161000
         STH   RF,OCFBUFSL         GIVE MSG-LENGTH TO OCCF     @D62BDAP 01162000
         BCTR  RF,0                PROVIDE FOR EXECUTE         @D62BDAP 01163000
         MVI   OCFBUFS,C' '        CLEAR FIRST BYTE IN BUFFER  @D62BDAP 01164000
         MVC   OCFBUFS+1(L'OCFBUFS-1),OCFBUFS  CLEAR BUFFER    @D62BDAP 01165000
         EX    RF,ATTTOOCF         PASS REPLY TO OCCF          @D62BDAP 01166000
         OI    OCFRQFL1,OCFSYSCN   INDICATE INPUT PENDING      @D62BDAP 01167000
         TS    OCFECB6+2           OCCF TASK ALREADY BUSY      @D62BDAP 01168000
         BO    ATTIGNOR            YES, BRANCH                 @D62BDAP 01169000
         LH    RF,OCFTIDRC         GET OCCF TASK ID            @D62BDAP 01170000
         TREADY TASK=(RF),COND=IO  ACTIVATE OCCF               @D62BDAP 01171000
         B     ATTIGNOR            CLEAR INPUT LINE            @D62BDAP 01172000
         SPACE 2                                               @D62BDAP 01173000
ATTRCBCM DC    C'RC  '             REQUEST CANCEL COMMAND ID   @D62BDAP 01174000
         SPACE 1                                               @D62BDAP 01175000
ATTTOOCF MVC   OCFBUFS(0),0(RE)                                @D62BDAP 01176000
         DROP  RC                  DROP OCCF COMREG BASE       @D62BDAP 01177000
         EJECT                                                 @D62BDAP 01178000
ATTRE100 EQU   *                                               @D62BDAP 01179000
         ICM   RC,7,AASYTAB+1      ASYNOC GENERATED            @D62BDAP 01180000
         BZ    ATTRE200            NO, BRANCH                  @D62BDAP 01181000
         USING ASYTAB,RC           ASYTAB BASE POINTER         @D62BDAP 01182000
         TM    ASYFLG1,ASYREPAV+ASYREQRD IS ASYNOC STILL BUSY  @D62BDAP 01183000
         BNZ   ATTMSG              YES, CANT ACCEPT REPLY      @D62BDAP 01184000
         OI    ASYFLG1,ASYBUSY+ASYREPAV INDICATE REPLY PENDING @D62BDAP 01185000
         STH   RF,ASYLENG          SAVE INPUT LENGTH           @D62BDAP 01186000
         BCTR  RF,0                PROVIDE FOR EXECUTE         @D62BDAP 01187000
         MVC   ASYBUFF,ASYBUFF-1   CLEAR ASYNOC BUFFER         @D62BDAP 01188000
         EX    RF,ATTTOASY         MOVE REPLY TO ASYNOC BUFFER @D62BDAP 01189000
ATTRE110 LR    RD,R8               SAVE BASE POINTER           @D62BDAP 01190000
         L     R8,AASYTIB          ADDRESS OF ASY-TIB          @D62BDAP 01191000
         BAL   RF,POST             POST ASY TASK               @D62BDAP 01192000
*SGLINK  POST,INPUT=(R6,R8,RF),WORK=RE                         @D62BDAP 01193000
         LR    R8,RD               RESTORE BASE POINTER        @D62BDAP 01194000
         B     ATTIGNOR            CONTINUATION ADDRESS        @D62BDAP 01195000
         SPACE 1                                               @D62BDAP 01196000
ATTTOASY MVC   ASYBUFF(0),0(RE)                                @D62BDAP 01197000
         DROP  RC                  RELEASE ASYTAB BASE         @D62BDAP 01198000
         EJECT                                                 @D62BDAP 01199000
ATTRE200 EQU   *                                               @D62BDAP 01200000
         LA    RF,72               GET MAX. INPUT LENGTH       @D62BDAP 01201000
         CH    RF,ATTCOUNT         IS INPUT TO BE TRUNCATED    @D62BDAP 01202000
         BNL   ATTRE210            NO, IT FITS IN BUFFER       @D62BDAP 01203000
         STH   RF,ATTCOUNT         UPDATE INPUT COUNT ACCOR.   @D62BDAP 01204000
ATTRE210 LA    R0,1                INDICATE COMMAND AVAILABLE  @D62BDAP 01205000
         LR    RD,R8               SAVE BASE POINTER           @D62BDAP 01206000
         L     R8,ATINTADR         BASE OF AR INITIATOR        @DY40195 01207000
         BALR  R8,R8               ACTIVATE REQUEST CANCEL     @DY40195 01208000
*SGLINK  ATTNINT INPUT=(R0,R6,R8),OUTPUT=R0                    @D62BDAP 01209000
         LR    R8,RD               RESTORE BASE POINTER        @D62BDAP 01210000
         LTR   R0,R0               PREVIOUS COMMAND PROCESSED  @D62BDAP 01211000
         BNZ   ATTMSG              NO,WRITE MESSAGE            @D62BDAP 01212000
         L     RD,AARBUFAR         ADDRESS OF ATTENTION BUFFER @D62BDAP 01213000
         USING ARBUFFER,RD         ATTENTION BUFFER BASE       @D62BDAP 01214000
         STH   RF,ARCMDLNG         SAVE COMMAND LENGTH         @D62BDAP 01215000
         BCTR  RF,0                SUBTRACT ONE FOR MVC INSTR. @D62BDAP 01216000
         EX    RF,ATTTOATT         COMMAND INTO ATTENTION BUFF @D62BDAP 01217000
         B     ATTIGNOR            TERMINATE                   @D62BDAP 01218000
         SPACE 1                                               @D62BDAP 01219000
ATTTOATT MVC   ARCOMAND(0),0(RE)                               @D62BDAP 01220000
         DROP  RD                  RELEASE ATTENTION BUFFER    @D62BDAP 01221000
         TITLE 'VSE SUPERVISOR     SGATT     FUNCTION KEY PROCESSING  ' 01222000
ATTAID7C LA    RF,1(,RF)           PF 12 KEY                   @D62BDAP 01223000
ATTAID7B LA    RF,1(,RF)           PF 11 KEY                   @D62BDAP 01224000
ATTAID7A LA    RF,1(,RF)           PF 10 KEY                   @D62BDAP 01225000
ATTAIDF9 LA    RF,1(,RF)           PF  9 KEY                   @D62BDAP 01226000
ATTAIDF8 LA    RF,1(,RF)           PF  8 KEY                   @D62BDAP 01227000
ATTAIDF7 LA    RF,1(,RF)           PF  7 KEY                   @D62BDAP 01228000
ATTAIDF6 LA    RF,1(,RF)           PF  6 KEY                   @D62BDAP 01229000
ATTAIDF5 LA    RF,1(,RF)           PF  5 KEY                   @D62BDAP 01230000
ATTAIDF4 LA    RF,1(,RF)           PF  4 KEY                   @D62BDAP 01231000
ATTAIDF3 LA    RF,1(,RF)           PF  3 KEY                   @D62BDAP 01232000
ATTAIDF2 LA    RF,1(,RF)           PF  2 KEY                   @D62BDAP 01233000
ATTAIDF1 LA    RF,1(,RF)           PF  1 KEY                   @D62BDAP 01234000
ATTAIDFP MH    RF,ATTPFLEN         MULTIPLY WITH ENTRY LENGTH  @D62BDAP 01235000
         L     RC,AATTPFTB         ADDRESS OF PF TABLE         @D62BDAP 01236000
         AR    RC,RF               ENTRY ADDRESS               @D62BDAP 01237000
         LH    RF,1(RC)            GET LENGTH OF COMMAND       @D62BDAP 01238000
         LTR   RF,RF               DO WE HAVE INFORMATION      @D62BDAP 01239000
         BZ    ATTIGNOR            NO, IGNORE                  @D62BDAP 01240000
         TM    0(RC),X'40'         IS THIS A DELAYED REQUEST   @D62BDAP 01241000
         BO    ATTPFDEL            YES                         @D62BDAP 01242000
         LA    RE,ATTAINP          GET INPUT BUFFER ADDRESS    @D62BDAP 01243000
         EX    RF,ATTEXPFS         MOVE DATA TO BUFFER         @D62BDAP 01244000
         LA    RF,1+6(,RF)         READJUST TO REAL LENGTH     @D62BDAP 01245000
         STH   RF,ATTCOUNT         SET UP INPUT COUNT          @D62BDAP 01246000
         B     ATTAID7D            SIMULATE AN ENTER-KEY       @D62BDAP 01247000
         SPACE 3                                               @D62BDAP 01248000
ATTPFDEL MVC   ATTAINP(167),ATTACLRC CLEAR TO BINARY ZERO'S    @D62BDAP 01249000
         LA    RE,ATTAINP          GET ADDRESS OF OUTPUT       @D62BDAP 01250000
         MVC   0(6,RE),ATTAWCCE    COPY CONTROL CHARACTERS     @D62BDAP 01251000
         MVI   5(RE),X'C1'         FORCE MTD BIT ON            @D62BDAP 01252000
         BCTR  RF,R0               ADJUST FOR EXECUTE          @D62BDAP 01253000
         EX    RF,ATTEXPFS         MOVE INTO INPUT AREA        @D62BDAP 01254000
         LA    RF,6+1(,RF)         ADJUST FOR SET CURSOR       @D62BDAP 01255000
         AR    RE,RF               POINT BEHIND TEXT           @D62BDAP 01256000
         MVI   0(RE),X'13'         INSERT CURSOR               @D62BDAP 01257000
         B     ATTWRTPF            DISPLAY DELAYED PF SETTING  @D62BDAP 01258000
         SPACE 1                                               @D62BDAP 01259000
ATTEXPFS MVC   6(0,RE),4(RC)       MOVE PF INFO TO BUFFER      @D62BDAP 01260000
         TITLE 'VSE SUPERVISOR     SGATT     REQUEST KEY PROCESSING   ' 01261000
ATTAIDE6 EQU   *                   OPERATOR CARD READER        @D62BDAP 01262000
ATTAID7E EQU   *                   SELECTOR PEN                @D62BDAP 01263000
ATTAID60 EQU   *                   UNSOLICITED INTERRUPT       @D62BDAP 01264000
ATTAIDE8 EQU   *                                               @D62BDAP 01265000
         TITLE 'VSE SUPERVISOR     SGATT     REQUEST KEY PROCESSING   ' 01266000
ATTAID6C EQU   *                   PA 1 KEY (REQUEST)          @D62BDAP 01267000
         ICM   RC,15,IJBOCFCM      IS OCCF SUPPORTED           @D62BDAP 01268000
         BZ    ATT6C010            NO                          @D62BDAP 01269000
         USING OCFCOM,RF           OCFCOM BASE POINTER         @D62BDAP 01270000
         TM    OCFFLAGS,OCFINCOM   OCCF IS INITIALIZED         @D62BDAP 01271000
         BO    ATTIGNOR            YES, NO PROMPTING ALLOWED   @D62BDAP 01272000
ATT6C010 TM    CRTFLG1,CRTATTH     IS CRT WAITING              @D62BDAP 01273000
         BO    ATTISCRT            YES, ALWAYS PASS TO CRT     @D62BDAP 01274000
         SLR   R0,R0               DEFAULT TO PROMPTING MODE   @D62BDAP 01275000
         ICM   RC,7,AASYTAB+1      GET ADDRESS OF ASYNOC TABLE @D62BDAP 01276000
         BZ    ATT6C030            NO ASYNOC SUPPORT           @D62BDAP 01277000
         TM    ASYFLG1,ASYBUSY     IS ASYNOC TASK BUSY         @D62BDAP 01278000
         BO    ATT6C020            YES, REQUEST CANCELATION    @D62BDAP 01279000
         OI    ASYFLG1,ASYBUSY+ASYREQRD INDICATE READ PENDING  @D62BDAP 01280000
         B     ATTRE110                                        @D62BDAP 01281000
ATT6C020 LA    R0,2                INDICATE REQUEST FOR CANCEL @D62BDAP 01282000
*TT6C030 BAL   RD,ATTNINT          ACTIVATE ATTENTION          @D62BDAP 01283000
ATT6C030 LR    RD,R8               SAVE BASE                   @DY40195 01284000
         L     R8,ATINTADR         BASE OF AR INITIATOR        @DY40195 01285000
         BALR  R8,R8               ACTIVATE REQUEST CANCEL     @DY40195 01286000
         LR    R8,RD               RESTORE BASE                @DY40195 01287000
         B     ATTIGNOR                                        @D62BDAP 01288000
         TITLE 'VSE SUPERVISOR     SGATT     CANCEL KEY PROCESSING    ' 01289000
ATTAID6B EQU   *                   PA 3 KEY                    @D62BDAP 01290000
ATTAID6D EQU   *                   CLEAR KEY                   @D62BDAP 01291000
ATTAID6E EQU   *                   PA 2 KEY (CANCEL)           @D62BDAP 01292000
ATTAIDF0 EQU   *                   TEST REQUEST KEY            @D62BDAP 01293000
         B     ATTIGNOR                                        @D62BDAP 01294000
ATTRETVE STM   R0,R1,ATTR0R1S      SAVE R0 AND R1              @D62BDAP 01295000
         L     R1,AATTPFTB         ADDRESS OF PF00             @D62BDAP 01296000
         MVC   4(80,R1),3(R1)      CLEAR OLD INFO              @D62BDAP 01297000
         LA    R1,4(,R1)           SKIP HEADER BYTES           @D62BDAP 01298000
         LA    R0,80               BUFFER LENGTH               @D62BDAP 01299000
         L     RF,ABUFMGNT         ADDRESS OF BUFFER MANAGEMENT@D62BDAP 01300000
         USING BUFMGNMT,RF                                     @D62BDAP 01301000
         BAL   RE,BUFMGRET         EXECUTE SUBROUTINE          @D62BDAP 01302000
         DROP  RF                                              @D62BDAP 01303000
         SH    R1,H4               RE-ADJUST TO BEGIN OF AREA  @D62BDAP 01304000
         STH   R0,1(R1)            SAVE DATA LENGTH            @D62BDAP 01305000
         LTR   RF,R0               SAVE DATA LENGTH            @D62BDAP 01306000
         BZ    AIDF0010            NO,                         @D62BDAP 01307000
         OI    0(R1),X'40'         INDICATE DELAYED REQUEST    @D62BDAP 01308000
AIDF0010 LM    R0,R1,ATTR0R1S      RESTORE REGISTERS           @D62BDAP 01309000
         LTR   RF,RF               DID WE GET BACK ANY DATA    @D62BDAP 01310000
         BZ    ATTIGNOR            NO                          @D62BDAP 01311000
         SLR   RF,RF               CLEAR RF                    @D62BDAP 01312000
         B     ATTAIDFP            PROCEED WITH DELAYED PROCESS@D62BDAP 01313000
         SPACE 1                                               @D62BDAP 01314000
ATTEXPF0 MVC   4(0,RC),8(RE)       SAVE SETTING INTO TABLE     @D62BDAP 01315000
         SPACE 3                                               @D62BDAP 01316000
ATTREQLS DC    A(ATTF0BLS-2)                                   @D62BDAP 01317000
         SPACE 3                                               @D62BDAP 01318000
ATTREQNX DC    A(ATTF0BUF)         ADDRESS OF NEXT BUFFER      @D62BDAP 01319000
ATTF0BUF DC    AL2(0),5CL80' ',AL2(0)                          @D62BDAP 01320000
ATTF0BLS DC    A(*-2)                                          @D62BDAP 01321000
ATTAIDNN EQU   *                                               @D62BDAP 01322000
         TITLE 'VSE SUPERVISOR     SGATT     CLEAR INPUT LINE         ' 01323000
ATTMSG   LA    RD,ATTAWCC          GET IOAREA ADDRESS          @D62BDAP 01324000
         STCM  RD,7,ATTAWRIT+1     SAVE IT IN CCW              @D62BDAP 01325000
         MVI   ATTAWRIT+4,X'60'    RESTORE CHAINING BIT        @D62BDAP 01326000
         LA    RD,56               LENGTH OF MESSAGE TEXT      @D62BDAP 01327000
         STH   RD,ATTAWRIT+6       SAVE COUNT IN CCW           @D62BDAP 01328000
         CLI   PUBDEVTY,T1050A     IS THIS A CRT DEVICE        @D62BDAP 01329000
         BNE   ATTMSG10            YES                         @D62BDAP 01330000
         SH    RD,H6               SUBTRACT CONTROL BYTES      @D62BDAP 01331000
         STH   RD,ATTAWRIT+6       SAVE 1050 COUNT IN CCW      @D62BDAP 01332000
         LA    RD,ATTAWCC          GET IOAREA ADDRESS          @D62BDAP 01333000
         AH    RD,H6               POINT TO FIRST TEXT BYTE    @D62BDAP 01334000
         STCM  RD,7,ATTAWRIT+1     SAVE IT IN CCW              @D62BDAP 01335000
         MVI   ATTAWRIT+4,X'20'    SUPPRESS CHAINING           @D62BDAP 01336000
ATTMSG10 LA    RD,ATTAWRIT         GET ADDRESS OF WRITE CCW    @D62BDAP 01337000
         B     ATTCLEAR                                        @D62BDAP 01338000
ATTWRTPF LA    RD,ATTAWDEL         POINT TO PROPER CCW         @D62BDAP 01339000
         B     ATTCLEAR            IS AS GOOD AS ERASE         @D62BDAP 01340000
ATTIGNOR CLI   PUBDEVTY,T1050A     IS THIS A CRT DEVICE        @D62BDAP 01341000
         BE    ATTB040             NO,  =====================>>@D62BDAP 01342000
         LA    RD,ATTAERAS         ADDRESS OF ERASE CCW        @D62BDAP 01343000
ATTCLEAR ST    RD,ATTACCB+8        UPDATE CCW ADDRESS          @D62BDAP 01344000
         B     0(R7)               TAKE RETRY EXIT             @D62BDAP 01345000
         SPACE 1                                               @D62BDAP 01346000
ATTTRTAB DC    X'000102030405060708090A0B0C0D0E0F'             @D62BDAP 01347000
         DC    X'101112131415161718191A1B1C1D1E1F'             @D62BDAP 01348000
         DC    X'202122232425262728292A2B2C2D2E2F'             @D62BDAP 01349000
         DC    X'303132333435363738393A3B3C3D3E3F'             @D62BDAP 01350000
         DC    X'404142434445464748494A4B4C4D4E4F'             @D62BDAP 01351000
         DC    X'505152535455565758595A5B5C5D5E5F'             @D62BDAP 01352000
         DC    X'606162636465666768696A6B6C6D6E6F'             @D62BDAP 01353000
         DC    X'707172737475767778797A7B7C7D7E7F'             @D62BDAP 01354000
         DC    X'80C1C2C3C4C5C6C7C8C98A8B8C8D8E8F'             @D62BDAP 01355000
         DC    X'90D1D2D3D4D5D6D7D8D99A9B9C9D9E9F'             @D62BDAP 01356000
         DC    X'A0A1E2E3E4E5E6E7E8E9AAABACADAEAF'             @D62BDAP 01357000
         DC    X'B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF'             @D62BDAP 01358000
         DC    X'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF'             @D62BDAP 01359000
         DC    X'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'             @D62BDAP 01360000
         DC    X'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF'             @D62BDAP 01361000
         DC    X'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'             @D62BDAP 01362000
         SPACE 1                                               @D62BDAP 01363000
ATTPFTAB DC    XL3'00',C' ',CL80' '             PF00 SETTING   @D62BDAP 01364000
         DC    XL3'000006',C' ',CL80'STATUS'    PF01 SETTING   @D62BDAP 01365000
         DC    XL3'000003',C' ',CL80'D L'       PF02 SETTING   @D62BDAP 01366000
         DC    XL3'000003',C' ',CL80'D E'       PF03 SETTING   @D62BDAP 01367000
         DC    XL3'00',C' ',CL80' '             PF04 SETTING   @D62BDAP 01368000
         DC    XL3'00',C' ',CL80' '             PF05 SETTING   @D62BDAP 01369000
         DC    XL3'00',C' ',CL80' '             PF06 SETTING   @D62BDAP 01370000
         DC    XL3'000005',C' ',CL80'D L,B'     PF07 SETTING   @D62BDAP 01371000
         DC    XL3'000005',C' ',CL80'D L,F'     PF08 SETTING   @D62BDAP 01372000
         DC    XL3'00',C' ',CL80' '             PF09 SETTING   @D62BDAP 01373000
         DC    XL3'000009',C' ',CL80'#RETRIEVE' PF10 SETTING   @D62BDAP 01374000
         DC    XL3'000003',C' ',CL80'SIR'       PF11 SETTING   @D62BDAP 01375000
ATTPFTLS DC    XL3'000006',C' ',CL80'SIR PF'    PF12 SETTING   @D62BDAP 01376000
ATTPFTEN EQU   *                                               @D62BDAP 01377000
         SPACE 5                                               @D62BDAP 01378000
         DROP  R8                  RELEASE SGATT BASE POINTER  @D62BDAP 01379000
         DROP  R6                  RELEASE DISPATCHER BASE     @D62BDAP 01380000
         DROP  R9                  RELEASE IOINTER BASE        @D62BDAP 01381000
         DROP  RA                  RELEASE PIB BASE            @D62BDAP 01382000
         DROP  R4                  RELEASE CHANQ BASE          @D62BDAP 01383000
         DROP  R3                  RELEASE PUB BASE            @D62BDAP 01384000
         DROP  R1                  RELEASE CCB BASE            @D62BDAP 01385000
         EJECT                                                 @D62BDAP 01386000
         USING BUFMGNMT,RF                                     @D62BDAP 01387000
BUFMGNMT DS    0H'0'                                           @D62BDAP 01388000
BUFMGENT XC    ARETRLST(4),ARETRLST INDICATE NEW DATA AVAILABLE@D62BDAP 01389000
         STM   R0,R7,BUFMSAVE     REGISTER SAVE AREA           @D62BDAP 01390000
         LR    R3,R0              GET BYTE COUNT               @D62BDAP 01391000
         SH    R3,H6              REAL NUMBER OF DATA BYTES    @D62BDAP 01392000
         BCTR  R3,0               ADJUST FOR EX INSTRUCTION    @D62BDAP 01393000
         LA    R2,5(,R3)          NO. OF BYTES WE USE INTERNAL @D62BDAP 01394000
         L     R4,ANEWDATA        ADDRESS OF NEW INPUT         @D62BDAP 01395000
         CH    R2,BUFMPLEN        WAS LAST ENTRY SAME LENGTH   @D62BDAP 01396000
         BNE   BUFM0050           NO, CANT BE THE SAME         @D62BDAP 01397000
         EX    R3,BUFMEX03        WAS IT RETRIEVED VALUE       @D62BDAP 01398000
         BE    BUFMEXIT           YES, NO NEED TO SAVE         @D62BDAP 01399000
BUFM0050 AH    R4,BUFMPLEN        BYTES NOT YET ACCOUNTED      @D62BDAP 01400000
         ST    R4,ANEWDATA        NEXT FREE BYTE IN BUFFER     @D62BDAP 01401000
         LA    R3,RETRBUFE        ADDRESS OF RETRIEVE BUFFER   @D62BDAP 01402000
         SR    R3,R4              FREE BYTES IN BUFFER         @D62BDAP 01403000
         CR    R2,R3              DOES ALL DATA FIT IN BUFFER  @D62BDAP 01404000
         BNH   BUFM0200           YES                          @D62BDAP 01405000
         LA    R5,RETRBUFB        BEGIN OF RETRIEVE BUFFER     @D62BDAP 01406000
BUFM0100 AH    R3,0(R5)           ADD LENGTH TO FREE BYTES     @D62BDAP 01407000
         AH    R5,0(R5)           POINT TO NEXT ENTRY          @D62BDAP 01408000
         CR    R2,R3              DOES DATA NOW FIT            @D62BDAP 01409000
         BH    BUFM0100           NO                           @D62BDAP 01410000
         LA    R4,RETRBUFE        END OF BUFFER ADDRESS        @D62BDAP 01411000
         SR    R4,R5              NUMBER OF BYTES TO MOVE      @D62BDAP 01412000
         BCTR  R4,0               ADJUST FOR EXECUTE           @D62BDAP 01413000
         EX    R4,BUFMEX02        MOVE ALL DATA                @D62BDAP 01414000
         XC    RETRBUFB+2(2),RETRBUFB+2 SET BACKWARD POINTER 0 @D62BDAP 01415000
         LA    R4,RETRBUFE        END OF BUFFER ADDRESS        @D62BDAP 01416000
         SR    R4,R3              ADDRESS OF NEXT DATA         @D62BDAP 01417000
         ST    R4,ANEWDATA        STORE NEW NEWDATA POINTER    @D62BDAP 01418000
BUFM0200 LR    R3,R2              LENGTH OF NEW DATA           @D62BDAP 01419000
         SH    R3,H4              ADJUST FOR DATA MOVE ONLY    @D62BDAP 01420000
         BCTR  R3,0               ADJUST FOR EXECUTE           @D62BDAP 01421000
         STH   R2,0(R4)           SAVE ENTRY LENGTH            @D62BDAP 01422000
         EX    R3,BUFMEX01        MOVE NEW DATA TO BUFFER      @D62BDAP 01423000
         LH    R3,BUFMPLEN        PREVIOUS LENGTH COUNTER      @D62BDAP 01424000
         STCM  R3,3,2(R4)         SET BACKWARD POINTER         @D62BDAP 01425000
         STH   R2,BUFMPLEN        SAVE LENGTH FOR NEXT USE     @D62BDAP 01426000
BUFMEXIT LM    R0,R7,BUFMSAVE     RELOAD REGISTERS             @D62BDAP 01427000
         BR    RE                      =====================>> @D62BDAP 01428000
         EJECT                                                 @D62BDAP 01429000
BUFMGRET STM   R0,R7,BUFMSAVE     REGISTER SAVE AREA           @D62BDAP 01430000
         SLR   R2,R2              CLEAR REGISTER               @D62BDAP 01431000
         ICM   R4,15,ARETRLST     RETRIEVE PROCESS             @D62BDAP 01432000
         BNZ   BUFM1200           YES, KEEP GOING              @D62BDAP 01433000
BUFM1100 L     R4,ANEWDATA        ADDRESS OF NEXT DATA         @D62BDAP 01434000
BUFM1200 ICM   R2,3,0(R4)         GET CURRENT ENTRY LENGTH     @D62BDAP 01435000
         ICM   R3,3,2(R4)         GET BACKWARD ENTRY LENGTH    @D62BDAP 01436000
BUFM1250 SH    R2,H4              SUBTRACT POINTER LENGTH      @D62BDAP 01437000
         CLR   R2,R0              DID USER PROVIDE ENOUGH BYTES@D62BDAP 01438000
         BNH   BUFM1300           YES                          @D62BDAP 01439000
         LTR   R2,R0              DID USER REQUEST 1 BYTE      @D62BDAP 01440000
         BZ    BUFMEXIT           NO                           @D62BDAP 01441000
         LR    R2,R0              MOVE ONLY SPECIFIED BYTES    @D62BDAP 01442000
         ICM   R2,8,*             INDICATE TRUNCATED           @D62BDAP 01443000
BUFM1300 ST    R2,BUFMSAVE        PASS BACK INFORMATION        @D62BDAP 01444000
         LTR   R2,R2              IS ANY DATA PRESENT          @D62BDAP 01445000
         BZ    BUFMEXIT           NO                           @D62BDAP 01446000
         BCTR  R2,0               ADJUST FOR EXECUTE           @D62BDAP 01447000
         EX    R2,BUFMEX04        MOVE DATA TO BUFFER          @D62BDAP 01448000
         LTR   R3,R3              BEGIN OF RETRIEVE BUFFER     @D62BDAP 01449000
         BZ    BUFM1500           YES                          @D62BDAP 01450000
         SR    R4,R3              UPDATE BACKWARD POINTER      @D62BDAP 01451000
BUFM1400 ST    R4,ARETRLST        SAVE NEW POINTER             @D62BDAP 01452000
         B     BUFMEXIT           RETURN TO CALLER             @D62BDAP 01453000
BUFM1500 CH    R3,BUFMPLEN        DID WE SAVE ANYTHING         @D62BDAP 01454000
         BE    BUFMEXIT           YES,  KEEP GOING             @D62BDAP 01455000
         L     R4,ANEWDATA        ADDRESS OF NEXT DATA         @D62BDAP 01456000
         B     BUFM1400           SAVE NEW POINTER             @D62BDAP 01457000
         EJECT                                                 @D62BDAP 01458000
BUFMEX01 MVC   4(0,R4),6(R1)      SAVE DATA FROM BUFFER        @D62BDAP 01459000
BUFMEX02 MVC   RETRBUFB(0),0(R5)  MOVE DATA TO BUFFER BEGIN    @D62BDAP 01460000
BUFMEX03 CLC   6(0,R1),4(R4)                                   @D62BDAP 01461000
BUFMEX04 MVC   0(0,R1),4(R4)                                   @D62BDAP 01462000
         SPACE 3                                               @D62BDAP 01463000
         DC    C'RETRIEVE BUFFER '                             @D62BDAP 01464000
RETRBUFB DC    H'4',H'0',CL252' '                              @D62BDAP 01465000
RETRBUFE EQU   RETRBUFB+256                                    @D62BDAP 01466000
ANEWDATA DC    A(RETRBUFB)                                     @D62BDAP 01467000
ARETRLST DC    A(0)               LAST RETRIEVED DATA ADDRESS  @D62BDAP 01468000
BUFMPLEN DC    H'0'               LAST INPUT LENGTH            @D62BDAP 01469000
BUFMSAVE DC    8F'0'              REGISTER SAVE AREA           @D62BDAP 01470000
         DROP  RF                 RELEASE SUBROUTINE BASE      @D62BDAP 01471000
.SKIP000 ANOP                                                  @D61CDAP 01472000
         AIF   (NOT &SGATT).NPRT020                            @D62BDAP 01473000
         PRINT NOGEN                                           @D62BDAP 01474000
.NPRT020 ANOP                                                  @D62BDAP 01475000
         DC    0H'0'               FORCE ALIGNMENT             @D62BDAP 01476000
         MEND                                                  @D62BDAP 01477000
