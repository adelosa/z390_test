         MACRO                                                          00015161
&NAME    SGTAP &SUBJ,&CODE=,&OUTPUT=,&I=,&O=,&W=,&E0=,&E4=,&E8=,&NR=    00030261
.*/**********************************************************           00045361
.*                                                          *           00060461
.*      IBM VIRTUAL STORAGE EXTENDED  (VSE)                 *           00075561
.*      COMPONENT: 5686-066-06                              *           00090661
.*      LICENSED MATERIALS - PROPERTY OF IBM                *           00120861
.*      "RESTRICTED MATERIALS OF IBM"                       *           00135961
.*      5686-066                                            *           00158051
.*      (C) COPYRIGHT IBM CORP. 1979, 2002                  *           00158051
.*                                                          *           00181261
.************************************************************/          00196361
.*                                                                      00211461
         GBLB  &IJBSGEN         IN SUPERVISOR                  @D66ODOW 00226561
         GBLB  &BGDEBUG         DEBUG OPTION                            00226561
         GBLB  &SGTAP           PRINT CONTROL SWITCH                    00241661
.*                                                                      00256761
         LCLC  &STRING,&TEST                                            00271861
         LCLC  &STRING1,&STRING2,&STRING3 FOR HANDLING OF               00286961
         LCLA  &COUNT1,&ROF,&X,&Y         INTERNAL CALLS.               00302061
         LCLC  &RX,&D,&LABEL,&LABSUF                                    00317161
.*                                                                      00332261
         ACTR  4000             PREVENT ASSEMBLY LOOP                   00347361
.*                                                                      00362461
.**************************************************************#SECURGL 00377561
    AIF  (T'&SUBJ EQ 'O').T000000       IF EXPANSION FOR TEST *#SECURGL 00392661
    AIF  ('&SUBJ'(1,1) NE '''').T000000 OF REGISTER CONVENTION*#SECURGL 00407761
&TEST    SETC   '&SUBJ'(2,K'&SUBJ-2)    TAKE FIRST SUBJECT AND*#SECURGL 00422861
    AGO  .LUCCB                         GOTO FIRST TEST       *#SECURGL 00437961
.T000000 ANOP *************************************************#SECURGL 00453061
 AIF   ('&CODE'   EQ  'YES').TPCOD01                           @D61SDJK 00478151
         AIF   (NOT &SGTAP).TAP0100                                     00498361
         PRINT GEN                                                      00513461
.TAP0100 EJECT                                                          00528561
.*                                                                      00543661
.* /* START OF SPECIFICATIONS ***************************************** 00558761
.*                                                                      00573861
.*01* MODULE TYPE = SYSTEM GENERATION MACRO                             00619161
.*                                                                      00634261
.*01* DESCRIPTIVE NAME = 3480-TYPE AND TPA TAPE ERP                     00650351
.*                                                                      00651341
.*01* AMODE CONSIDERATIONS:                                             00652331
.*    THIS MACRO IS INCLUDED IN TWO PHASES TO SAVE SPACE BELOW THE      00653321
.*    16 MEGABYTE BOUNDARY. THE INVOCATION IN THE SUPERVISOR EXPANDS    00654311
.*    FIVE GLOBAL DATA AREAS >TERGLOB<. THIS WAS REQUIRED TO HAVE       00655301
.*    ALL CCBS AND CCW CHAINS BELOW 16 MB. ALL OTHER DATA ARE ALSO      00656291
.*    CONTAINED IN THIS AREA WHICH FACILITATES DEBUGGING. FURTHER-      00657281
.*    MORE, THE WORK ERROR ENTRIES USED FOR RECORDING PURPOSES AND      00658271
.*    THE ENTRY POINTS FOR SUPERVISOR ROUTINES ARE EXPANDED IN THE      00659261
.*    RESIDENT PART OF THE SUPERVISOR.                                  00660251
.*    THE INVOCATION IN PHASE $IJBTAP EXPANDS THE CODE, THE STACK       00661241
.*    AREA AND A WRAP AROUND DEBUG AREA. THE CODE RUNS IN AMODE 31.     00662231
.*                                                                      00664461
.*01* NOTES = CHANGE ACTIVITY                                           00679561
.*    @ DENOTES CHANGE ACTIVITY FLAG. D IS SYSTEM                       00694661
.*    IDENTIFIER FOR VSE. MEANING OF THE THIRD                          00709761
.*    CHARACTER IS - A = APAR, Y = APAR                                 00724861
.*    OTHER CHARACTERS ARE FOR IBM INTERNAL USE.                        00739961
.*                                                                      00755061
.*01* CHANGE ACTIVITY = AS FOLLOWS                                      00770161
.*    RESIDENT 3480-TYPE TAPE ERP                              @D61NDJK 00785261
.*    MOVE PART OF RESIDENT TAPE ERP INTO 31-BIT SVA           @D61SDJK 00797261
.*    SUPPORT OF TPA TAPE DEVICE                               @D61SDJK 00798261
.*    RECONLY REQUESTS MUST BE MARKED AS UNSOLICITED           @D63HDJK 00798264
.*    MESSAGES FOR SIMS AND MIMS MUST BE HIGHLIGHTED           @D63HDJK 00798266
.*    MORE THAN 255 TASKS                                      @D66ADAP 00800361
.*                                                                              
.*    08/22/95 SWITCH ON RECONLY FOR ASYNCHRONOUS RECORDING    @DA43606 00792261
.*    09/15/95 DON'T SET OPINTV IN PUBCSFLG IN CASE OF         @DA43697 00794261
.*             INTERVENTION REQUIRED ERROR CONDITIONS          @DA43697 00796261
.*    CCB BYTE 8 HOLDS ASCII LABEL INFORMATION FOR USER TASKS  @DA44407 00798262
.*    TAPE LABEL PROCESSING IS INDICATED IN CCB BYTE 12, BIT 4 @DA44407 00798263
.*    3590 UCODE ENHANCEMENTS (UCODE LEVEL 1.8.8.0)            @DA44364 00798264
.*    PREVENT CHANNEL PROGRAM LOOP FOR ERP RETRY FAILURE       @DY45299 00800361
.*    LOCATE BLOCK CANCELLED WITH 0P20I                        @DY45580         
.*    PROVIDE PROPER MESSAGE NUMBER FOR ERA=X'50'              @DY45817 00798266
.*    PREVENT DEVICE CLEANER SIM TO BE HIGHLIGHTED WHEN LM     @DY45817 00798266
.*    ENSURE $IJBTAP RELOCATION BETWEEN TERIOSAV & TERIORET    @DY45909         
.*    MSG 0P20I RECOVY ERROR DURING UNLOADING A 3590 DEVICE    @DY46166         
.*                                                                      00800361
.* ** END OF SPECIFICATIONS **************************************** */ 00815461
.*                                                                      00845661
*********************************************************************** 00860761
*                                                                     * 00875861
*              RESIDENT 3480-TYPE AND TPA TAPE ERP                    * 00897951
*                                                                     * 00906061
* FUNCTION                                                            * 00921161
*                                                                     * 00936261
*    THE FUNCTION OF THE NEW TAPE ERP IS TO RECOVER FROM              * 00961351
*    I/O ERRORS OCCURRING ON 3480-TYPE AND TPA TAPE DEVICES.          * 00971341
*                                                                     * 00981561
* ENTRY POINTS                                                        * 00996661
*                                                                     * 01011761
*      TER0000     - NORMAL ENTRY POINT WHEN A NEW TAPE ERROR IS      * 01026861
*                    PASSED TO TAPE ERP.                              * 01041961
*      TERIO000    - ENTRY POINT IF SGTAP RECOVERY I/O WAS POSTED.    * 01057061
*                                                                     * 01072161
* EXITS                                                               * 01073161
*                                                                     * 01074161
*    WHEN THE ERP TASK HAS NO MORE ERRORS TO PROCESS THE EXIT         * 01075161
*    IS UNPOST (THIS EXIT SHOULD NEVER BE USED SINCE SGERP WOULDN'T   * 01075761
*    PASS CONTROL TO SGTAP IN SUCH A CASE).                           * 01076361
*                                                                     * 01077161
*    WHEN A RECOVERY I/O REQUEST HAS BEEN ISSUED, SGTAP IS LEFT       * 01078161
*    TO ERPINSEL (WHICH IS A LABEL IN SGERP OF THE SUPERVISOR)        * 01079161
*    FOR FURTHER PROCESSING OF OTHER DEVICE ERROR ENTRIES.            * 01080161
*                                                                     * 01081161
*    ONCE AN ERROR HAS BEEN PROCESSED, SGTAP IS LEFT TO TAPEXIT       * 01082166
*    (WHICH IS A LABEL IN SGERP OF THE SUPERVISOR).                   * 01082171
*                                                                     * 01082176
*********************************************************************** 01082181
         EJECT                                                          01082186
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 01082191
*                                                                     * 01082196
*                      SGTAP INITIALIZATION                           * 01082201
*                                                                     * 01082206
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 01082211
*                                                              @D61NDJK 01082216
         DC    CL8'SGTAP   '                                   @D61NDJK 01082221
*#SERVICELEVEL                                                 @D61NDJK 01082226
         DC    CL8'DY46166'       CHANGE ACTIVITY              @DY46166 01082238
         SPACE 1                                               @D61NDJK 01082246
TER0000  DS    0H'0'              ENTRY POINT                  @D61NDJK 01082251
         BALR  RC,0               SET UP BASE ADDRESS          @D61NDJK 01082256
         BCTR  RC,0               ADJUST BASE POINTER          @D61NDJK 01082261
         BCTR  RC,0               ADJUST BASE POINTER          @D61NDJK 01082266
         USING TER0000,RC         MAIN ROUTINE ADDRESSABILITY  @D61NDJK 01082271
*                                                              @D61NDJK 01082276
*------------------------------------------------------------* @D61NDJK 01082281
*                                                              @D61NDJK 01082286
*   FIND A FREE GLOBAL WORK AREA WHERE THE ERROR CONDITION     @D61NDJK 01082291
*   CAN BE PROCESSED. IT SHOULDN'T BE POSSIBLE THAT ALL        @D61NDJK 01082296
*   GLOBAL WORK AREAS ARE USED UP, SINCE SGERP WOULDN'T        @D61NDJK 01082301
*   BRANCH INTO SGTAP THEN.                                    @D61NDJK 01082306
*                                                              @D61NDJK 01082311
*------------------------------------------------------------* @D61NDJK 01082316
*                                                              @D61NDJK 01082321
.*    IF THE NUMBER OF WORK AREAS SHOULD BE INCREASED IN       @D61NDJK 01082326
.*    FUTURE, ECB LIST ERPECBLS IN SUPERVISOR MACRO SGERP      @D61NDJK 01082331
.*    MUST BE EXTENDED ACCORDINGLY.                            @D61NDJK 01082336
.*                                                             @D61NDJK 01082341
         L     RA,TERAGLB1          GLOBAL WORK AREA           @D61NDJK 01082351
         USING TERGLOB,RA         GET ADDRESS OF FIRST..       @D61NDJK 01082346
         LA    R7,TERGLOBN        LOAD NUMBER OF WORK AREAS    @D61NDJK 01082356
TER0050  TM    TERFLG,TERCVGAU    GLOBAL WORK AREA IS IN USE?  @D61NDJK 01082361
         BZ    TER0100            NO, USE THAT WORK AREA       @D61NDJK 01082366
 SGTAP  'SGCOV ERPT610',NR=(00,0) FIRST GLOBAL WORK AREA IN USE    INIT 01082371
         LA    RA,TERGWAL(,RA)    POINT TO NEXT GLOBAL WORK..  @D61NDJK 01082376
         BCT   R7,TER0050           AREA AND CHECK AGAIN       @D61NDJK 01082381
*                                                              @D61NDJK 01082386
         BAL   R5,SYSERROR        ALL WORK AREAS ARE USED !!   @D61NDJK 01082391
TERAGLB1 DC    A(TERGLOB1)        ADDRESS OF 1ST GLOBAL..      @D61NDJK 01082396
*                                   WORK AREA                  @D61NDJK 01082401
*------------------------------------------------------------* @D61NDJK 01082406
*                                                              @D61NDJK 01082411
*   IF THERE IS NO ERROR ENTRY IN THE ERP ERROR CHAIN, THEN    @D61NDJK 01082416
*   DEACTIVATE THE ERP TASK AND EXIT TO THE DISPATCHER.        @D61NDJK 01082421
*                                                              @D61NDJK 01082426
*------------------------------------------------------------* @D61NDJK 01082431
*                                                              @D61NDJK 01082436
.*    THIS SHOULD NEVER OCCUR SINCE SGERP WOULDN'T HAVE        @D61NDJK 01082441
.*    PASSED CONTROL TO SGTAP IN THAT CASE.                    @D61NDJK 01082446
.*                                                             @D61NDJK 01082451
TER0100  L     R5,AERBLOC         ERBLOC BASE ADDRESS          @D61NDJK 01082456
         USING ERBLOC,R5          ERBLOC BASE                  @D61NDJK 01082461
         L     R2,ERPERCHN        GET NEXT ERROR ENTRY ADDRESS @D61NDJK 01082466
         LTR   R2,R2              IS ANY ERROR ENQUEUED        @D61NDJK 01082471
         BNZ   TER0200            YES,                         @D61NDJK 01082476
 SGTAP  'SGCOV ERPT610',NR=(00,1) NO ERROR ENTRY IS QUEUED         INIT 01082486
         L     R6,DISPAD          DISPATCHER BASE ADDRESS      @D61NDJK 01082491
         USING DISP,R6            DISP BASE POINTER            @D61NDJK 01082496
         SGSETUP UNPOST,STASK=ERP,WR1=R2 DEACTIVATE ERP TASK   @D61NDJK 01082501
         BR    R6                 =========================>>> @D61NDJK 01082506
         DROP  R6                 RELEASE DISP BASE            @D61NDJK 01082511
*                                                              @D61NDJK 01082516
*------------------------------------------------------------* @D61NDJK 01082521
*                                                              @D61NDJK 01082526
*   IF THE NEW ERROR ENTRY WAS BUILT FOR AN I/O FAILURE ON     @D61NDJK 01082531
*   A SGTAP I/O REQUEST, THE ENTRY WILL BE DEACTIVATED AND     @D61NDJK 01082536
*   DEQUEUED FROM THE ERP ERROR CHAIN.                         @D61NDJK 01082541
*                                                              @D61NDJK 01082546
*------------------------------------------------------------* @D61NDJK 01082551
*                                                              @D61NDJK 01082556
.*    THIS SHOULDN'T BE POSSIBLE SINCE IOINTER HAS IMPLEMENTED @D61NDJK 01082561
.*    A MECHANISM THAT PREVENTS ENQUEUING OF ERROR ENTRIES     @D61NDJK 01082566
.*    AFTER AN SGTAP I/O FAILURE.                              @D61NDJK 01082571
.*                                                             @D61NDJK 01082576
         USING ERBLKADR,R2        DEVICE-ERROR-ENTRY BASE      @D61NDJK 01082581
TER0200  ICM   R4,15,ERRQCHQA     GET AND TEST CHANQ ADDRESS   @D61NDJK 01082586
         BZ    TER0250            INTERRUPT IS UNSOLICITED     @D61NDJK 01082591
         USING CHQADR,R4          CHANQ BASE POINTER           @D61NDJK 01082596
         CLC   CHQTID,ERPTIDH     IS THIS AN ERP REQUEST       @D66ODOW 01082601
         BNE   TER0250            NO,                          @D61NDJK 01082606
         DROP  R4                                              @D61NDJK 01082611
 SGTAP  'SGCOV ERPT610',NR=(00,2) ERROR ENTRY IS CAUSED BY SGTAP   INIT 01082616
         MVC   ERPERCHN,ERBLKPTR  DEQUEUE AND DEACTIVATE..     @D61NDJK 01082621
         XC    ERBLKPTR,ERBLKPTR    TCB ERROR ENTRY FROM..     @D61SDJK 01082626
         NI    ERBLKFLG,XFF-ERQUEUED-ERACTIVE  ERP ERROR CHAIN @D61NDJK 01082631
         NI    ERBLKFL1,XFF-NEEDERP ERP IS NOT REQUIRED ANYMORE@D61SDJK 01082633
         MVC   CSW(8),ERRQCSW     SET UP PROPER LOW CORE CSW   @D61NDJK 01082636
         NI    CSW+4,XFF-UNITCK   SWITCH OFF UNIT CHECK        @D61NDJK 01082641
         DROP  R2                                              @D61NDJK 01082646
         L     R9,AINTER          LOAD IOINTER BASE REGISTER   @D61NDJK 01082651
         USING INTRTN,R9          DECLARE IOINTER BASE         @D61NDJK 01082656
         L     RF,ERPXAD1         TAKE DISPATCHER EXIT         @D61NDJK 01082661
         DROP  R9                 RELEASE IOINTER BASE         @D61NDJK 01082666
         L     R9,ERPBASE         LOAD SGERP BASE REGISTER     @D61NDJK 01082671
         USING SGERP,R9           DECLARE SGERP BASE           @D61NDJK 01082676
         LA    R5,TAPEXIT         SGERP ENTRY POINT            @D61NDJK 01082681
         BR    R5                 LEAVE SGTAP                  @D61NDJK 01082686
         DROP  R9                 RELEASE ERBLOC               @D61NDJK 01082691
*                                                              @D61NDJK 01082696
*------------------------------------------------------------* @D61NDJK 01082701
*   CLEAR HIGH ORDER BYTES AND SWITCH TO 31 BIT AMODE.         @D61NDJK 01082706
*------------------------------------------------------------* @D61NDJK 01082711
*                                                              @D61NDJK 01082716
TER0250  DS    0H                                              @D61NDJK 01082721
         LA    R2,0(,R2)          TURN OFF..                   @D61NDJK 01082726
         LA    R5,0(,R5)            UPPERMOST BYTE..           @D61NDJK 01082731
         LA    RA,0(,RA)            IN ALL USED..              @D61NDJK 01082736
         LA    RC,0(,RC)            REGISTERS                  @D61NDJK 01082741
*                                                              @D61NDJK 01082746
         AMODESW SET,AMODE=31,WR=(RF) ENTER 31-BIT ADDR. MODE  @D61NDJK 01082751
*                                                              @D61NDJK 01082756
*------------------------------------------------------------* @D61NDJK 01082761
*   RESET ALL DATA IN GLOBAL WORK AREA PART 1 AND OCCUPY       @D61NDJK 01082766
*   FREE GLOBAL WORK AREA.                                     @D61NDJK 01082771
*------------------------------------------------------------* @D61NDJK 01082776
*                                                              @D61NDJK 01082781
         XC    TERGWAP1(256),TERGWAP1                          @D61NDJK 01082786
         XC    TERGWAP1+256(TERGWAL1-256),TERGWAP1+256         @D61NDJK 01082791
         OI    TERFLG,TERCVGAU    OCCUPY THIS GLOBAL WORK AREA @D61NDJK 01082796
*                                                              @D61NDJK 01082801
*------------------------------------------------------------* @D61NDJK 01082806
*   ESTABLISH ADDRESSABILITY OF SGTAP STACK.                   @D61NDJK 01082811
*------------------------------------------------------------* @D61NDJK 01082816
*                                                              @D61NDJK 01082821
         LA    RD,TERTERSV        MAKE STACK ADDRESSABLE       @D61NDJK 01082826
         MVI   TERTERFF,X'FF'     SET END OF STACK INDICATION  @D61NDJK 01082831
*                                                              @D61NDJK 01082836
*------------------------------------------------------------* @D61NDJK 01082841
*                                                              @D61NDJK 01082846
*   THE ERROR ENTRY IS COPIED INTO THE GLOBAL WORK AREA,       @D61NDJK 01082851
*   IS IMMEDIATELY DEACTIVATED AND DEQUEUED FROM THE ERP       @D61NDJK 01082856
*   ERROR CHAIN AND THE ERROR CONDITION THAT IT REPRESENTS     @D61NDJK 01082861
*   HAS TO BE PROCESSED. TO PREVENT A TASK FROM CORRUPTING     @D61NDJK 01082866
*   THE ERP ERROR CHAIN, SGTAP MUST NOT LOSE CONTROL WHILE     @D61NDJK 01082871
*   IT IS REMOVING AN ERROR ENTRY FROM THE ERROR CHAIN.        @D61NDJK 01082876
*                                                              @D61NDJK 01082881
*------------------------------------------------------------* @D61NDJK 01082886
*                                                              @D61NDJK 01082891
         USING ERBLKADR,R2                                     @D61NDJK 01082896
         MVC   ERPERCHN,ERBLKPTR    DEQUEUE ORIGINAL ERROR..   @D61NDJK 01082901
         XC    ERBLKPTR,ERBLKPTR      ENTRY FROM ERP..         @D61NDJK 01082906
         NI    ERBLKFLG,XFF-ERQUEUED  ERROR CHAIN              @D61NDJK 01082911
         NI    ERBLKFL1,XFF-NEEDERP ERP IS NOT REQUIRED ANYMORE@D61SDJK 01082913
*                                   COPY ORIGINAL ERROR ENTRY..@D61NDJK 01082916
         MVC   TERINWRK,0(R2)         INTO WORK ERROR ENTRY    @D61NDJK 01082921
*                                   DEACTIVATE ORIGINAL ERROR..@D61NDJK 01082926
         NI    ERBLKFLG,XFF-ERACTIVE  ENTRY AND POINT TO..     @D61NDJK 01082931
         LA    R2,TERINWRK            THE WORK ERROR ENTRY     @D61NDJK 01082936
         DROP  R5                   RELEASE ERBLOC BASE        @D61NDJK 01082941
*                                                              @D61NDJK 01082946
*------------------------------------------------------------* @D61NDJK 01082951
*   GET ADDRESSABILITY TO THE PUB DEVICE ENTRY.                @D61NDJK 01082956
*------------------------------------------------------------* @D61NDJK 01082961
*                                                              @D61NDJK 01082966
         SLR   R3,R3              GET THE ADDRESS OF THE..     @D61SDJK 01082971
         ICM   R3,B'0011',ERRQPUB   PUB DEVICE ENTRY           @D61NDJK 01082976
         BNZ   TER0300                                         @D61NDJK 01082981
         BAL   R5,SYSERROR                                     @D61NDJK 01082986
*                                                              @D61NDJK 01082991
         USING PUBADR,R3                                       @D61NDJK 01082996
*                                                              @D61NDJK 01083001
*------------------------------------------------------------* @D61NDJK 01083006
*   DETERMINE DEVICE TYPE CODE OF FAILING DEVICE.              @D61NDJK 01083011
*------------------------------------------------------------* @D61NDJK 01083016
*                                                              @D61NDJK 01083021
TER0300  LR    R5,R3              COPY PUB POINTER             @D61NDJK 01083026
         SH    R5,YPUBTAB         GET OFFSET IN PUBTAB         @D61NDJK 01083031
         SRL   R5,1               DIVIDE BY TWO                @D61NDJK 01083036
         A     R5,APBXAREA        ADDRESS OF PUBX ADDRESSES    @D61NDJK 01083041
         L     R5,0(R5)           GET PUBX POINTER             @D61NDJK 01083046
         ST    R5,TERAPUBX        SAVE PUBX POINTER            @D61NDJK 01083051
         USING PBXADR,R5          DECLARE PUBX BASE POINTER    @D61NDJK 01083056
         CLI   PUBDEVTY,TTPA      DEVICE IS A TPA?             @D61SDJK 01083061
         BNE   TER0305            NO                           @D61SDJK 01083066
         MVI   TERDEVTY,TERTPA    INDICATE TPA DEVICE TYPE     @D61SDJK 01083071
 SGTAP  'SGCOV ERPT610',NR=(00,3) IT IS A TPA DEVICE               INIT 01083076
         B     TER0400                                         @D61SDJK 01083086
*                                                              @D61SDJK 01083091
TER0305  CLI   PBXOBR+1,X'0C'     DEVICE IS A 3424?            @D61SDJK 01083096
         BNE   TER0310            NO                           @D61NDJK 01083101
         MVI   TERDEVTY,TER3424   INDICATE 3424 DEVICE TYPE    @D61NDJK 01083106
 SGTAP  'SGCOV ERPT610',NR=(00,4) IT IS A 3424 DEVICE              INIT 01083111
         B     TER0400                                         @D61NDJK 01083116
*                                                              @D61NDJK 01083121
TER0310  CLI   PBXOBR+1,X'0E'     DEVICE IS A 9348?            @D61NDJK 01083126
         BNE   TER0320            NO                           @D61NDJK 01083131
         MVI   TERDEVTY,TER9348   INDICATE 9348 DEVICE TYPE    @D61NDJK 01083136
 SGTAP  'SGCOV ERPT610',NR=(00,5) IT IS A 9348 DEVICE              INIT 01083141
         B     TER0400                                         @D61NDJK 01083146
*                                                              @D61NDJK 01083151
TER0320  MVI   TERDEVTY,TER3480   INDICATE 3480 DEVICE TYPE    @D61NDJK 01083156
         DROP  R5                 DROP PUBX BASE POINTER       @D61NDJK 01083161
*                                                              @D61NDJK 01083171
*------------------------------------------------------------* @D61NDJK 01083176
*   DETERMINE IF LIOCS WAS WORKING ON AN OPEN FILE WHEN        @D61NDJK 01083181
*   THE ORIGINAL ERROR CONDITION OCCURRED.                     @D61NDJK 01083186
*------------------------------------------------------------* @D61NDJK 01083191
*                                                              @D61NDJK 01083196
TER0400  LR    R5,R3              COPY PUB POINTER             @D61NDJK 01083201
         SH    R5,YPUBTAB         GET OFFSET IN PUBTAB         @D61NDJK 01083206
         SRL   R5,PUBSLEN-2       ADJUST FOR PUB2 INDEX        @D61NDJK 01083211
         A     R5,APB2AREA        GET PUB2 INDEX FROM TABLE    @D61NDJK 01083216
         L     R5,0(,R5)          GET ADDRESS OF PUB2          @D61NDJK 01083221
         ST    R5,TERAPUB2        SAVE PUB2 POINTER            @D61SDJK 01083226
         USING PUB2ADR,R5         DECLARE PUB2 BASE            @D61NDJK 01083231
         TM    P2FLAGS,P2OPEN     FILE WAS OPEN?               @D61NDJK 01083236
         BZ    TER0500            NO                           @D61NDJK 01083241
         OI    TEROEFLG,TEROEFOP  INDICATE OPEN FILE           @D61NDJK 01083246
 SGTAP  'SGCOV ERPT610',NR=(00,6) P2OPEN IS SET                    INIT 01083251
         DROP  R5                 RELEASE PUB2 BASE            @D61NDJK 01083261
*                                                              @D61NDJK 01083266
*------------------------------------------------------------* @D61NDJK 01083271
*   DETERMINE IF ERP IS PROCESSING AT THE MINIMAL ERP LAYER.   @D61NDJK 01083276
*------------------------------------------------------------* @D61NDJK 01083281
*                                                              @D61NDJK 01083286
.*    THE MEANING OF THE RECONLY BIT IS: "THE USER HAS BEEN    @D61NDJK 01083291
.*    POSTED ALREADY". THIS IMPLIES THAT HIS DATA CAN NOT      @D61NDJK 01083296
.*    BE ACCESSED ANYMORE. THE BIT MAY NEVER BE SET OFF BY     @D61NDJK 01083301
.*    SGTAP, WHEN SGTAP IS ENTERED AND RECONLY IS SET,         @D61NDJK 01083306
.*    SOME RECORDING MAY BE DONE, IF APPROPRIATE, BUT USER     @D61NDJK 01083311
.*    DATA LIKE CCB OR CCW MUST NOT BE TOUCHED.                @D61NDJK 01083316
.*                                                             @D61NDJK 01083321
TER0500  TM    ERRQFLG,RECONLY    MINIMAL ERP LAYER?           @D61NDJK 01083326
         BNO   TER0600            NO                           @D61NDJK 01083331
 SGTAP  'SGCOV ERPT610',NR=(00,7) RECORDING ONLY REQUEST           INIT 01083336
         OI    TEROEFLG,TEROEMEL  INDICATE MINIMAL ERP LAYER   @D61NDJK 01083341
*                                                              @D61NDJK 01083346
*------------------------------------------------------------* @D61NDJK 01083351
*   REMEMBER THE I/O REQUESTOR FROM THE CHANQ WHEN IT IS       @D61NDJK 01083356
*   AVAILABLE.                                                 @D61NDJK 01083361
*------------------------------------------------------------* @D61NDJK 01083366
*                                                              @D61NDJK 01083371
TER0600  ICM   R4,15,ERRQCHQA     GET AND TEST CHANQ ADDRESS   @D61NDJK 01083376
         BZ    TER0650            INTERRUPT IS UNSOLICITED     @D61NDJK 01083381
         USING CHQADR,R4                                       @D61NDJK 01083386
         TM    TEROEFLG,TEROEMEL  IT IS A RECONLY REQUEST?     @D61NDJK 01083391
         BO    TER0750            YES                          @D61NDJK 01083396
         OC    ERRQCCB+1(3),ERRQCCB+1 TASK IS STILL EXISTING?  @D61NDJK 01083401
         BZ    TER0720            NO                           @D61SDJK 01083406
         B     TER0700            YES                          @D61NDJK 01083411
*                                                              @D61NDJK 01083416
TER0650  OI    TEROEFLG,TEROEUIC  INDICATE UNSOLICITED INTERR. @D61NDJK 01083421
 SGTAP  'SGCOV ERPT610',NR=(01,0) INTERRUPT IS UNSOLICITED         INIT 01083426
         B     TER0750                                         @D61NDJK 01083431
*                                                              @D61NDJK 01083436
*------------------------------------------------------------* @D61NDJK 01083441
*   SET ERP'S SERVICE OWNER TO ERP TASK WHEN PROCCESSING IS    @D61NDJK 01083446
*   AT MINIMAL ERP LAYER OR WHEN THE SERVICE OWNER ID IS NOT   @D61NDJK 01083451
*   AVAILABLE. OTHERWISE SET ERP'S SERVICE OWNER TO THE        @D61NDJK 01083456
*   APPROPRIATE TASK ID.                                       @D61NDJK 01083461
*------------------------------------------------------------* @D61NDJK 01083466
*                                                              @D61NDJK 01083471
TER0700  MVC   TERCHQID,CHQTID    REMEMBER THE REQUESTOR       @D66ODOW 01083476
         B     TER0770                                         @D61NDJK 01083481
*                                                              @D61SDJK 01083486
TER0720  OI    TEROEFLG,TEROEPST  USER CCB IS ALREADY POSTED   @D61SDJK 01083491
TER0750  SLR   R4,R4              PROCESS AS UNSOLICITED       @D61NDJK 01083501
         MVC   TERCHQID,ERPTIDH   ERP TASK IS SERVICE OWNER    @D66ODOW 01083506
*                                                              @D61NDJK 01083511
TER0770  DS    0H                                              @D66ODOW 01083516
         LH    RF,TERCHQID        GET THE REQUESTOR TID        @D66ODOW 01083521
         SGSETUP SWOWNER,STASK=ERP,WR1=RF,WR2=R7,OPTION=SETOWNER        01083526
*                                                              @D61NDJK 01083531
*------------------------------------------------------------* @D61NDJK 01083536
*   SET UP FAILING JOB NAME, THAT MAY BE RECORDED LATER IN     @D61NDJK 01083541
*   AN OBR. IN CASE OF UNSOLICITED INTERRUPTS OR SYSTEM TASK   @D61NDJK 01083546
*   I/O REQUESTS, THE FAILING JOB NAME IS SET TO 'NO NAME '.   @D61NDJK 01083551
*------------------------------------------------------------* @D61NDJK 01083556
*                                                              @D61NDJK 01083561
         MVC   TERFJOBN,TERNONAM  DEFAULT TO NO NAME           @D61NDJK 01083566
         CLC   TERCHQID,ARTIDH    SYSTEM I/O REQUEST?          @D66ODOW 01083571
         BNH   TER0800            YES, LEAVE DEFAULT NAME      @D61NDJK 01083576
         L     R5,CRADDR          GET COMREG ADDRESS           @D61NDJK 01083581
         USING COMREG,R5          COMREG BASE POINTER          @D61NDJK 01083586
         MVC   TERFJOBN(8),COMNAME  SET FAILING JOB NAME       @D61NDJK 01083591
         DROP  R5                 RELEASE COMREG BASE POINTER  @D61NDJK 01083596
 SGTAP  'SGCOV ERPT610',NR=(01,1) USER TASK I/O REQUEST            INIT 01083601
*                                                              @D61NDJK 01083606
*------------------------------------------------------------* @D61NDJK 01083611
*   SAVE PATH FAILURE INFO AND LENGTH OF SENSE DATA THAT IS    @D61SDJK 01083616
*   ALWAYS UPDATED AFTER AN UNSUCCESSFUL RECOVERY I/O REQUEST. @D61SDJK 01083621
*------------------------------------------------------------* @D61NDJK 01083626
*                                                              @D61NDJK 01083631
TER0800  MVC   TERCURPI(1),ERRQPATH  CURRENT PATH FAILURE INFO @D61NDJK 01083636
         MVC   TERCURSL(1),ERRQLSNS  CURRENT SENSE DATA LENGTH @D61SDJK 01083641
*                                                              @D61NDJK 01083646
*------------------------------------------------------------* @D61SDJK 01083651
*   SET UP LINKAGE POINTER BETWEEN HIGH SVA AND SUPERVISOR     @D61SDJK 01083656
*   PART OF SGTAP.                                             @D61SDJK 01083661
*------------------------------------------------------------* @D61SDJK 01083666
*                                                              @D61SDJK 01083671
         L     R0,=A(TERLNKG)                                  @D61SDJK 01083676
         ST    R0,TERLINK                                      @D61SDJK 01083681
*                                                              @D61SDJK 01083686
*------------------------------------------------------------* @D61SDJK 01083691
*                                                              @D61SDJK 01083696
*   IF SVA LOAD IS COMPLETE, $IJBTAP IS LOCATED IN THE 31-BIT  @D61SDJK 01083701
*   SVA. IN THE OTHER CASE, $IJBTAP HAS BEEN LOADED INTO THE   @D61SDJK 01083706
*   SHARED AREA BELOW THE 2MB BOUNDARY.                        @D61SDJK 01083711
*                                                              @D61SDJK 01083716
*------------------------------------------------------------* @D61SDJK 01083721
*                                                              @D61SDJK 01083726
         L     R9,ASVASVDL        PROVIDE GENERAL IJBTAP..     @D61SDJK 01083731
         L     R9,AIJBTAP-SVASVDL(,R9)            ENTRY POINT  @D61SDJK 01083736
         LTR   R9,R9              IJBTAP CODE IS LOADED?       @D61SDJK 01083741
         BNZ   TER0850            YES                          @D61SDJK 01083746
*                                                              @D61SDJK 01083751
         BAL   R5,SYSERROR        THERE IS NO TAPE ERP LOADED! @D61SDJK 01083756
*                                                              @D61SDJK 01083761
*------------------------------------------------------------* @D61SDJK 01083766
*                                                              @D61SDJK 01083771
*   BRANCH INTO $IJBTAP.                                       @D61SDJK 01083776
*                                                              @D61SDJK 01083781
*------------------------------------------------------------* @D61SDJK 01083786
*                                                              @D61SDJK 01083791
TER0850  LA    R7,4               TAKE OFFSET FOR LABEL TERSVA @D61SDJK 01083796
         LR    RC,R9              RELOAD IJBTAP ENTRY POINTER  @D61SDJK 01083801
         DROP  RC                                              @D61SDJK 01083811
*                                                              @D61SDJK 01083816
.*  FOLLOWING REGISTERS ARE SET UP:                            @D61SDJK 01083821
.*    - R2 CONTAINS THE ADDRESS OF THE ERROR ENTRY             @D61SDJK 01083826
.*    - R3 CONTAINS THE ADDRESS OF THE PUB DEVICE ENTRY        @D61SDJK 01083831
.*    - R4 CONTAINS THE ADDRESS OF THE CHANNEL QUEUE ENTRY     @D61SDJK 01083836
.*    - R7 CONTAINS THE IJBTAP ENTRY POINT TABLE OFFSET        @D61SDJK 01083841
.*    - RA CONTAINS THE ADDRESS OF A GLOBAL WORK AREA          @D61SDJK 01083846
.*    - RC CONTAINS THE ADDRESS OF IJBTAP ENTRY POINT IJBTER   @D61SDJK 01083851
.*    - RD CONTAINS THE ADDRESS OF A STACK AREA                @D61SDJK 01083856
.*                                                             @D61SDJK 01083861
         AMODESW CALL,REGS=(RE,RC)  =======================>>> @D61SDJK 01083866
*                                                              @D61SDJK 01083871
         BAL   R5,SYSERROR        INVALID IJBTAP ENTRY..       @D61SDJK 01083876
*                                   POINT TABLE OFFSET         @D61SDJK 01083881
*------------------------------------------------------------* @D61NDJK 01083886
*                                                              @D61NDJK 01083891
*   SET UP RETURN CODE FOR TAPEXIT IN RF.                      @D61NDJK 01083896
*                                                              @D61NDJK 01083901
*------------------------------------------------------------* @D61NDJK 01083906
*                                                              @D61NDJK 01083911
TERLEAVE BALR  RC,0               CALCULATE THE..              @D61NDJK 01083916
         BCTR  RC,0                 BASE ADDRESS OF..          @D61NDJK 01083921
         BCTR  RC,0                 SGTAP ROUTINE              @D61NDJK 01083926
         USING TERLEAVE,RC        MAIN ROUTINE ADDRESSABILITY  @D61NDJK 01083931
         L     R9,AINTER          ESTABLISH..                  @D61SDJK 01083936
         USING INTRTN,R9            ADDRESSABILITY TO IOINTER  @D61NDJK 01083941
*                                                              @D61NDJK 01083951
         L     RF,ERPXAD5         TAKE CANCEL EXIT             @D61NDJK 01083956
         CLI   TEREXITC,TEREXCAN  CANCEL EXIT IS WANTED?       @D61NDJK 01083961
         BE    TER25000           YES                          @D61SDJK 01083966
*                                                              @D61NDJK 01083971
         L     RF,ERPXAD4         TAKE IGNORE EXIT             @D61NDJK 01083976
         CLI   TEREXITC,TEREXIGN  IGNORE EXIT IS WANTED?       @D61NDJK 01083981
         BE    TER25000           YES                          @D61SDJK 01083986
*                                                              @D61NDJK 01083991
         L     RF,ERPXAD2         TAKE RETRY EXIT              @D61NDJK 01083996
         CLI   TEREXITC,TEREXRTY  RETRY EXIT IS WANTED?        @D61NDJK 01084001
         BE    TER25000           YES                          @D61SDJK 01084006
*                                                              @D61NDJK 01084011
         L     RF,ERPXAD1         TAKE DISPATCHER EXIT         @D61NDJK 01084016
         CLI   TEREXITC,TEREXDSP  DISPATCHER EXIT IS WANTED?   @D61NDJK 01084021
         BE    TER25000           YES                          @D61SDJK 01084026
*                                                              @D61NDJK 01084031
         L     RF,ERPXRDLY        TAKE LONG BUSY EXIT          @D61SDJK 01084036
         CLI   TEREXITC,TEREXLBY  LONG BUSY EXIT IS WANTED?    @D61SDJK 01084046
         BE    TER25000           YES                          @D61SDJK 01084051
*                                                              @D61SDJK 01084056
*------------------------------------------------------------* @D61NDJK 01084061
*  THIS CODE SHOULD NEVER EXECUTE. CASES ABOVE ARE EXHAUSTIVE. @D61NDJK 01084066
*------------------------------------------------------------* @D61NDJK 01084071
*                                                              @D61NDJK 01084076
         BAL   R5,SYSERROR                                     @D61NDJK 01084081
         DROP  R9                                              @D61NDJK 01084086
*                                                              @D61NDJK 01084091
*-------------------------------------------------------------*@D61NDJK 01084096
*                                                              @D61NDJK 01084101
*   SET UP FINAL STATE OF THE CSW AS IF THIS STATE HAD BEEN    @D61NDJK 01084106
*   GIVEN BY THE DEVICE ITSELF.                                @D61NDJK 01084111
*                                                              @D61NDJK 01084116
*-------------------------------------------------------------*@D61NDJK 01084121
*                                                              @D61NDJK 01084126
TER25000 MVC   CSW(8),TERWKCSW    SET UP PROPER LOW CORE CSW   @D61SDJK 01084131
*                                                              @D61NDJK 01084136
*-------------------------------------------------------------*@D61NDJK 01084141
*                                                              @D61NDJK 01084146
*   EXIT TO TAPEXIT.                                           @D61NDJK 01084151
*                                                              @D61NDJK 01084156
*-------------------------------------------------------------*@D61NDJK 01084161
*                                                              @D61NDJK 01084166
.*  FOLLOWING REGISTERS ARE SET UP:                            @D61SDJK 01084171
.*    - RF CONTAINS THE RETURN CODE                            @D61NDJK 01084176
.*    - R2 CONTAINS THE ADDRESS OF THE ERROR ENTRY             @D61NDJK 01084181
.*    - R3 CONTAINS THE ADDRESS OF THE PUB DEVICE ENTRY        @D61NDJK 01084186
.*                                                             @D61NDJK 01084191
         L     R9,ERPBASE         LOAD SGERP BASE REGISTER     @D61SDJK 01084196
         USING SGERP,R9           DECLARE SGERP BASE           @D61NDJK 01084201
         LA    R5,TAPEXIT         SGERP ENTRY POINT            @D61NDJK 01084206
         BR    R5                 LEAVE SGTAP  ============>>> @D61SDJK 01084211
*                                                              @D61NDJK 01084216
         SGTAP 'DROPALL        ','*'                           @D61NDJK 01084221
*                                                              @D61NDJK 01084226
*------------------------------------------------------------* @D61SDJK 01084231
*                                                              @D61SDJK 01084236
*   LOCAL VARIABLES USED IN SGTAP INITIALIZATION ROUTINE.      @D61SDJK 01084241
*                                                              @D61SDJK 01084246
*------------------------------------------------------------* @D61SDJK 01084251
*                                                              @D61SDJK 01084256
TERNONAM DC   CL8'NO NAME '       DEFAULT JOB NAME "NO NAME"   @D61NDJK 01084261
*                                                              @D61SDJK 01084266
         LTORG                                                 @D61NDJK 01084271
         EJECT                                                 @D61NDJK 01084276
*                                                              @D61SDJK 01084281
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 01084286
*                                                                     * 01084291
*                 SGTAP RECOVERY SUSPENSION                           * 01084296
*                                                                     * 01084301
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 01084306
*                                                              @D61NDJK 01084311
TERAIO00 DC    A(TERIO000)        ADDRESS OF 2ND ENTRY POINT   @D61NDJK 01084316
*                                                              @D61NDJK 01084321
*-------------------------------------------------------------*@D61NDJK 01084326
*                                                              @D61NDJK 01084331
*   EXIT TO ERPINSEL WHILE RECOVERY I/O IS ONGOING.            @D61SDJK 01084336
*                                                              @D61NDJK 01084341
*-------------------------------------------------------------*@D61NDJK 01084346
*                                                              @D61NDJK 01084351
         USING TERGLOB,RA         GLOBAL WORK AREA BASE        @D61SDJK 01084356
TERIOSAV STM   R2,R0,TERTERSV     SAVE ALL REGISTERS           @D61NDJK 01084361
*                                                              @D61NDJK 01084366
         L     R5,AERBLOC         LOAD ERBLOC BASE POINTER     @D61NDJK 01084376
         L     R6,DISPAD          LOAD DISP BASE POINTER       @D61NDJK 01084381
         L     RB,APTA            LOAD PTA BASE POINTER        @D61NDJK 01084386
         L     RD,ERPBASE         LOAD SGERP BASE POINTER      @D61NDJK 01084391
         USING SGERP,RD           DECLARE SGERP BASE           @D61NDJK 01084396
         LA    RF,ERPINSEL        EXIT TO ERPINSEL             @D61NDJK 01084401
         BR    RF                 LEAVE SGTAP  ============>>> @D61SDJK 01084406
*                                                              @D61NDJK 01084411
         DROP  RD                                              @D61SDJK 01084416
*                                                              @D61NDJK 01084421
*------------------------------------------------------------* @D61NDJK 01084426
*                                                              @D61NDJK 01084431
*   ENTRY POINT IN SGTAP:                                      @D61NDJK 01084436
*                                                              @D61NDJK 01084441
*   WHEN A TERCCB HAS BEEN POSTED, RECOVERY CAN BE RESUMED     @D61NDJK 01084446
*   FOR THE ASSOCIATED ERROR CONDITION.                        @D61NDJK 01084451
*                                                              @D61NDJK 01084456
*------------------------------------------------------------* @D61NDJK 01084461
*                                                              @D61SDJK 01084466
.*  FOLLOWING REGISTERS ARE SET UP:                            @D61SDJK 01084471
.*    - R1 CONTAINS THE POINTER TO THE POSTED TERCCB           @D61SDJK 01084476
.*                                                             @D61SDJK 01084481
*------------------------------------------------------------* @D61SDJK 01084486
*   RESTORE WORK ENVIRONMENT.                                  @D61SDJK 01084491
*------------------------------------------------------------* @D61SDJK 01084496
*                                                              @D61NDJK 01084501
TERIO000 LR    RA,R1              REESTABLISH..                @D61NDJK 01084506
         LA    RC,(TERCCB-TERGLOB)  ADDRESSABILITY..           @D61NDJK 01084511
         SR    RA,RC                OF GLOBAL..                @D61NDJK 01084516
         USING TERGLOB,RA           WORK AREA                  @D61NDJK 01084521
         LM    R2,R0,TERTERSV     RESTORE ALL REGISTERS..      @D61NDJK 01084531
*                                   EXCEPT INPUT REGISTER      @D61SDJK 01084536
         USING TERIOSAV,RF        ESTABLISH ADDRESSABILITY     @DY45909         
         TM    TERTERSV+12*4,X7F  RETURN TO HIGH-SVA?          @DY45909         
         BNZ   TERIO010           YES, ALREADY RELOCATED       @DY45909         
         L     R5,ASVASVDL        PROVIDE GENERAL IJBTAP..     @DY45909         
         L     R5,AIJBTAP-SVASVDL(,R5)            ENTRY POINT  @DY45909         
         L     RC,16(,R5)         ACTIVE TERIO LOCATION        @DY45909         
         L     R5,12(,R5)         TAKE OFFSET FOR LABEL TERTAB @DY45909         
         L     RE,8(,R5)          SETUP RELOCATED A(TERIORET)  @DY45909         
TERIO010 DS    0H                                              @DY45909         
         DROP  RF                                              @DY45909         
*------------------------------------------------------------* @D61NDJK 01084541
*   RESET ERP'S SERVICE OWNER TO ERP TASK WHEN PROCCESSING IS  @D61NDJK 01084546
*   AT MINIMAL ERP LAYER OR WHEN THE SERVICE OWNER ID IS NOT   @D61NDJK 01084551
*   AVAILABLE. OTHERWISE SET ERP'S SERVICE OWNER TO THE        @D61NDJK 01084556
*   APPROPRIATE TASK ID.                                       @D61NDJK 01084561
*------------------------------------------------------------* @D61NDJK 01084566
*                                                              @D61NDJK 01084571
         LH    RF,TERCHQID        GET THE REQUESTOR TID        @D66ODOW 01084581
*                                                              @D61NDJK 01084586
         SGSETUP SWOWNER,STASK=ERP,WR1=RF,WR2=R7,OPTION=SETOWNER        01084591
*                                                              @D61NDJK 01084596
*------------------------------------------------------------* @D61SDJK 01084601
*   RETURN TO HIGH SVA PART OF SGTAP AT LABEL TERIORET.        @D61SDJK 01084606
*------------------------------------------------------------* @D61SDJK 01084611
*                                                              @D61SDJK 01084616
         AMODESW RETURN,AMODE=31,REG=(RE)  ================>>> @D61SDJK 01084621
*                                                              @D61SDJK 01084626
         SGTAP 'DROPALL        ','*'                           @D61SDJK 01084631
         LTORG                                                 @D61SDJK 01084636
         EJECT                                                 @D61SDJK 01084641
*                                                              @D61SDJK 01084646
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 01084651
*                                                                     * 01084656
*               SGTAP SUPERVISOR ROUTINE CALLER                       * 01084661
*                                                                     * 01084666
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 01084671
*                                                              @D61SDJK 01084676
*-------------------------------------------------------------*@D61SDJK 01084681
*   SWITCH TO 24-BIT ADDRESS MODE AND BRANCH TO ANY SUPERVISOR @D61SDJK 01084686
*   ROUTINE.                                                   @D61SDJK 01084691
*-------------------------------------------------------------*@D61SDJK 01084696
*                                                              @D61SDJK 01084701
.*  FOLLOWING REGISTERS ARE SET UP:                            @D61SDJK 01084706
.*    - R9 CONTAINS THE POINTER TO A SUPERVISOR ROUTINE        @D61SDJK 01084711
.*    - RE CONTAINS THE RETURN ADDRESS TO THE HIGH SVA         @D61SDJK 01084716
.*                                                             @D61SDJK 01084721
         USING TERGLOB,RA         GLOBAL WORK AREA BASE        @D61SDJK 01084726
TERCALRT STM   R0,RE,TERTERSV     SAVE REGISTERS               @D61SDJK 01084731
         BALR  RC,0               ESTABLISH BASE..             @D61SDJK 01084736
         USING *,RC                 ADDRESSABILITY..           @D61SDJK 01084741
         ST    RA,TERCALSV        SAVE GLOBAL WORK AREA BASE   @D61SDJK 01084751
         L     R6,DISPAD          GET ADDRESSABILITY..         @D61SDJK 01084756
         USING DISP,R6              TO THE DISPATCHER          @D61SDJK 01084761
*                                                              @D61SDJK 01084766
         AMODESW SET,AMODE=24,WR=(R7) ENTER 24-BIT ADDR. MODE  @D61SDJK 01084771
*                                                              @D61SDJK 01084776
         BALR  R7,R9              BRANCH TO GIVEN ROUTINE      @D61SDJK 01084781
*                                                              @D61SDJK 01084786
*------------------------------------------------------------* @D61SDJK 01084791
*   SWITCH BACK TO 31-BIT ADDRESS MODE AND RESTORE WORK        @D61SDJK 01084796
*   ENVIRONMENT.                                               @D61SDJK 01084801
*------------------------------------------------------------* @D61SDJK 01084806
*                                                              @D61SDJK 01084811
         DROP  R6,RC              REESTABLISH..                @D61SDJK 01084816
         BALR  RC,0                 BASE..                     @D61SDJK 01084821
         USING *,RC                 ADDRESSABILITY..           @D61SDJK 01084826
         ICM   RC,8,=X'00'          FOR AMODE SWITCH           @D61SDJK 01084831
*                                                              @D61SDJK 01084836
         AMODESW SET,AMODE=31,WR=(R7) ENTER 31-BIT ADDR. MODE  @D61SDJK 01084841
*                                                              @D61SDJK 01084846
         L     RA,TERCALSV        RESTORE GLOBAL WORK AREA BASE@D61SDJK 01084851
         LM    R0,RE,TERTERSV     RESTORE REGISTERS            @D61SDJK 01084856
         BR    RE                 RETURN TO HIGH SVA SGTAP     @D61SDJK 01084866
*                                                              @D61SDJK 01084871
         SGTAP 'DROPALL        ','*'                           @D61SDJK 01084876
*                                                              @D61SDJK 01084881
*------------------------------------------------------------* @D61SDJK 01084886
*                                                              @D61SDJK 01084891
*   LOCAL SAVE AREA USED IN TERCALRT                           @D61SDJK 01084896
*                                                              @D61SDJK 01084901
*------------------------------------------------------------* @D61SDJK 01084906
*                                                              @D61SDJK 01084911
         DS    0F                 SAVE AREA FOR..              @D61SDJK 01084916
TERCALSV DC    XL4'00'              GLOBAL WORK AREA POINTER   @D61SDJK 01084921
*                                                              @D61SDJK 01084926
         LTORG                                                 @D61SDJK 01084931
         EJECT                                                 @D61SDJK 01084936
*                                                              @D61SDJK 01084941
         AGO   .TPNOC01                                        @D61SDJK 01084946
.TPCOD01 ANOP                                                  @D61SDJK 01084951
*********************************************************************** 01084956
*                                                                     * 01084961
*          31-BIT SVA PART OF 3480-TYPE AND TPA TAPE ERP              * 01084966
*                                                                     * 01084971
* FUNCTION                                                            * 01084976
*                                                                     * 01084981
*    THE FUNCTION OF THE NEW TAPE ERP IS TO RECOVER FROM              * 01084986
*    I/O ERRORS OCCURRING ON 3480-TYPE AND TPA TAPE DEVICES.          * 01084991
*                                                                     * 01084996
* ENTRY POINTS                                                        * 01085001
*                                                                     * 01085006
*      TERSVA      - NORMAL ENTRY POINT WHEN A NEW TAPE ERROR IS      * 01085011
*                    PASSED TO HIGH SVA PART OF SGTAP.                * 01085016
*      TERIORET    - ENTRY POINT IF SGTAP RECOVERY I/O HAS BEEN       * 01085021
*                    POSTED AND CONTROL IS PASSED BACK TO HIGH SVA    * 01085026
*                    PART OF SGTAP.                                   * 01085031
*      TERFAST     - ENTRY POINT FOR FAST SENSE DATA EVALUATION       * 01085036
*                    ROUTINE.                                         * 01085041
*                                                                     * 01085046
* EXITS                                                               * 01085051
*                                                                     * 01085056
*    WHEN A RECOVERY I/O REQUEST HAS BEEN ISSUED, HIGH SVA PART OF    * 01085061
*    SGTAP IS LEFT TO TERIOSAV WHICH IS A LABEL IN THE SUPERVISOR     * 01085066
*    RESIDENT PART OF SGTAP.                                          * 01085071
*                                                                     * 01085076
*    ONCE AN ERROR HAS BEEN PROCESSED, HIGH SVA TAPE ERP IS LEFT      * 01085081
*    TO TERLEAVE WHICH IS A LABEL IN THE SUPERVISOR RESIDENT PART     * 01085086
*    OF SGTAP.                                                        * 01085091
*                                                                     * 01085161
* EXTERNAL REFERENCES                                                 * 01087261
*                                                                     * 01102361
*    THE FOLLOWING SUPERVISOR ROUTINES, NOT GENERATED BY SGTAP,       * 01117461
*    ARE USED TO ASSIST IN PROVIDING TAPE ERP. A BRIEF DESCRIPTION    * 01132561
*    OF WHAT FUNCTION EACH ROUTINE PROVIDES ACCOMPANIES ITS NAME.     * 01147661
*                                                                     * 01162761
*      INTEQPST    - USED TO QUEUE AN ERROR ENTRY FOR ASYNCHRONOUS    * 01177861
*                    PROCCESSING BY THE ERP TASK.                     * 01192961
*      GETDADR     - USED TO GET THE VIRTUAL ADDRESS OF A BYTE OF     * 01208061
*                    DATA ASSOCIATED WITH A CCW.                      * 01223161
*      VIRTAD      - USED TO VALIDATE AND/OR VIRTUALIZE A GIVEN       * 01238261
*                    ADDRESS.                                         * 01253361
*      SGETVIS     - USED TO ALLOCATE A BLOCK OF VIRTUAL STORAGE      * 01255861
*                    FROM THE SYSTEM GETVIS AREA.                     * 01258361
*      SFREEVIS    - USED TO RELEASE A PREVIOUSLY ALLOCATED BLOCK     * 01260861
*                    OF SYSTEM GETVIS STORAGE.                        * 01263361
*      EMSGERRE    - USED TO WRITE AN ERP CONSOLE MESSAGE.            * 01265861
*                                                                     * 01268461
*    THE FOLLOWING SUPERVISOR SERVICES, NOT GENERATED BY SGTAP,       * 01283561
*    ARE USED TO ASSIST IN PROVIDING TAPE ERP. A BRIEF DESCRIPTION    * 01298661
*    OF WHAT EACH SERVICE IS USED FOR ACCOMPANIES ITS NAME.           * 01313761
*                                                                     * 01328861
*      REALAD      - USED TO CONVERT A VIRTUAL ADDRESS TO A REAL      * 01343961
*                    ADDRESS.  THIS SERVICE IS ACCESSED THROUGH       * 01359061
*                    THE REALAD MACRO.                                * 01374161
*      SVC 15      - USED TO EXECUTE A CHANNEL PROGRAM PRIOR TO       * 01400561
*                    NORMAL SVC 0 REQUESTS, ALREADY ENQUEUED FOR      * 01426961
*                    THE SAME DEVICE BUT NOT YET STARTED.             * 01453361
*                                                                     * 01479861
* CODING CONVENTIONS AND REGISTER ASSIGNMENTS                         * 01494961
*                                                                     * 01510061
*    SGTAP IS WORKING WITH A STACK AND HEAP CONCEPT FOR DATA.         * 01525161
*    ALL THE DATA THAT ARE ACCESSED IN READ/WRITE MODE BY THE         * 01540261
*    CODE OF SGTAP ARE CONTAINED IN MULTIPLE DATA AREAS CALLED        * 01555361
*    TERGLOBX. EACH TERGLOB CONTAINS A HEAP AND A STACK AREA          * 01603051
*    AND IS LOCATED IN THE SUPERVISOR RESIDENT PART OF SGTAP.         * 01613041
*                                                                     * 01630861
*    REGISTER CONVENTION FOR THE ENTIRE CODE AND STACK MACHINE:       * 01645961
*    A NUMBER OF REGISTERS SHOULD NOT BE USED FOR PROCESSING.         * 01661061
*                                                                     * 01668561
*    RA  = HEAP POINTER. THE STACK ALSO IS A PART OF THE HEAP.        * 01676161
*    RC  = BASE REGISTER FOR ALL SUBROUTINES.                         * 01691261
*    RD  = STACK POINTER. POINTS TO THE LAST USED SAVE AREA FOR       * 01706361
*          REGISTERS.                                                 * 01721461
*    RE  = RETURN REGISTER.                                           * 01743551
*                                                                     * 01751661
*    THE USINGS FOR RA AND RC ARE GENERATED BY EACH SUBROUTINE        * 01766761
*    HEADING.                                                         * 01781861
*                                                                     * 01796961
*    ANOTHER SET OF REGISTERS IS USED BY CONVENTION FOR THE           * 01812061
*    FOLLOWING PURPOSES, BUT MAY ALSO VARY IN USAGE.                  * 01827161
*                                                                     * 01842261
*    R1  = CCB POINTER. NORMALLY POINTS TO TERCCB IN GLOBAL AREA      * 01857361
*    R2  = DEVICE ERROR ENTRY POINTER. USUALLY POINTS TO TERINWRK     * 01872461
*          IN A GLOBAL WORK AREA TERGLOBX.                            * 01887561
*    R3  = PUB POINTER                                                * 01902661
*    R4  = CHANNEL QUEUE POINTER                                      * 01917761
*    R8  = IN MOST CASES THE POINTER TO THE CCW JUST LOOKED AT        * 01932861
*    RB  = USER CCB. SHOULD REALLY NOT BE VARIED                      * 01947961
*    RF  = RETURN CODE, IF ANY                                        * 01963061
*                                                                     * 01978161
*    R5,R6,R7,R9  ARE NOT ASSIGNED ANY SPECIFIC VALUE.                * 02008361
*                                                                     * 02159361
* PROCESSING                                                          * 02174461
*                                                                     * 02189561
*    SGTAP IS PROCESSING ON A CHAIN OF DEVICE ERROR ENTRIES.          * 02204661
*    THESE DEVICE ERROR ENTRIES (MAPPED BY ERBLKADR DSECT)            * 02219761
*    MAY EITHER BELONG TO A PUBX (PBXERBLK) OR TO A TCB OF            * 02234861
*    A SYSTEM TASK (TCBERBLK).                                        * 02256951
*    THE  CHAIN IS CHAINED FROM THE ERROR BLOCK AND CONTAINS          * 02265061
*    ONE OR MORE ENTRIES FOR ONE OR MORE DEVICES.                     * 02280161
*    FIVE GLOBAL WORK AREAS IN SGTAP ALLOW PARALLEL PROCESSING        * 02285161
*    OF UP TO FIVE ERROR ENTRIES FROM DIFFERENT DEVICES.              * 02290161
*    SGTAP ALWAYS TAKES AN ERROR ENTRY OUT OF THE CHAIN AND           * 02295261
*    COPIES THE ERROR ENTRY INTO A PART OF ITS NEXT FREE GLOBAL       * 02310361
*    WORK AREA, CALLED TERINWRK. FURTHERMORE THE ORIGINAL ERROR       * 02327961
*    ENTRY IS DEACTIVATED AND CAN NOW BE USED WHEN A NEW ERROR        * 02345561
*    CONDITION OCCURS DURING SGTAP I/O.                               * 02363161
*    AT THE END OF PROCESSING, THE CURRENT GLOBAL WORK AREA IS        * 02380761
*    FREED AND SGTAP IS LEFT WITH TERINWORK.                          * 02398361
*    PROCESSING OF A DEVICE ERROR ENTRY IS DONE IN A BIG LOOP         * 02416061
*    WHICH IN ALL CONTAINS THE FOLLOWING LOGIC:                       * 02431161
*                                                                     * 02446261
*          1.) DETERMINE A MAIN ERROR CLASSIFICATION CODE.            * 02456561
*          2.) IF A NEW ERROR CONDITION IS PRESENTED, THE OLD         * 02466861
*              ERROR IS CONSIDERED OVERCOME AND THE NEW ERROR         * 02477161
*              IS PROCESSED FROM NOW ON AS IF IT HAD BEEN THE         * 02487461
*              ORIGINAL ONE.                                          * 02497761
*          3.) ASSIGN RECOVERY ATTRIBUTES.                            * 02508061
*          4.) START THE RECOVERY ACTION. WHEN RECOVERY I/O IS        * 02518361
*              DONE, SGTAP IS NOT WAITING FOR I/O COMPLETION,         * 02528661
*              BUT INITIATES MESSAGING AND IS THEN LEFT TO            * 02538961
*              ERPINSEL FOR FURTHER PROCESSING OF NEW DEVICE          * 02549261
*              ERROR ENTRIES.                                         * 02559561
*          5.) WHEN THE RECOVERY I/O REQUEST HAS BEEN POSTED,         * 02569861
*              SGTAP IS ENTERED AFTER THAT POINT WHERE IT WAS         * 02580161
*              LEFT IN 4.).                                           * 02590461
*          6.) INITIATE MESSAGING AND RECORDING, IF APPLICABLE.       * 02600761
*          7.) IF RECOVERY IS COMPLETE, LEAVE LOOP.                   * 02611061
*          8.) OBTAIN SENSE DATA (USER OWN SENSE IS SET) AND          * 02621361
*              GOTO 1.).                                              * 02631961
*                                                                     * 02642561
*    EVENTUALLY THE RECOVERY WILL BE COMPLETE AND SGTAP LEAVES        * 02657661
*    THE LOOP. NOW A NUMBER OF STEPS IS STILL TAKEN TO DO             * 02672761
*    SOME FINAL PROCESSING. FURTHERMORE THE EXIT IS DETERMINED        * 02687861
*    AND SGTAP IS LEFT.                                               * 02702961
*                                                                     * 02718061
*********************************************************************** 02733161
         EJECT                                                          02748261
&SYSECT  CSECT                                                          02763361
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 02778461
*                                                                     * 02793561
*     HIGH SVA PART OF SGTAP.                                         * 02815651
*                                                                     * 02823761
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 02838861
*                                                              @D61SDJK 03053951
TERSVA   DS    0H                 ESTABLISH..                  @D61SDJK 03253941
         USING TERSVA,RC            ADDRESSABILITY..           @D61SDJK 03453931
         USING TERGLOB,RA           OF..                       @D61SDJK 03653921
         USING ERBLKADR,R2          WORK..                     @D61SDJK 03853911
         USING PUBADR,R3            ENVIRONMENT                @D61SDJK 04053901
         USING CHQADR,R4                                       @D61SDJK 04253891
         ST    RE,TERRETSV        SAVE RETURN ADDRESS          @D61SDJK 04453881
*                                                              @D61SDJK 04853861
*------------------------------------------------------------* @D61NDJK 05330361
*   TELL DEBUG WE ARE DEALING WITH A NEW I/O.                  @D61NDJK 05345461
*------------------------------------------------------------* @D61NDJK 05360561
*                                                              @D61NDJK 05375661
 SGTAP  'CALL  TERTRACE         ','CALL FOR DEBUG ENTRY',      @D61NDJKX05390761
               NR='0               NEW ACTUAL I/O NUMBER'      @D61NDJK 05405861
*                                                              @D61NDJK 07560861
*------------------------------------------------------------* @D61NDJK 07562661
*   OBTAIN USER CCB ADDRESS.                                   @D61NDJK 07565161
*------------------------------------------------------------* @D61NDJK 07580261
*                                                              @D61NDJK 07595361
         DS    0H                                              @D61NDJK 07610461
 SGTAP  'CALL  TERUCCB         ','GET USER CCB PTR ',          @D61NDJKX07625561
               I='2                 ON RETURN',                @D61NDJKX07640661
               O='B                 RB=PTR TO USER CCB'        @D61NDJK 07655761
*                                                              @D61NDJK 07685961
*------------------------------------------------------------* @D61NDJK 07701061
*   SET UP THE CCB THAT SGTAP IS USING TO REQUEST I/O.         @D61NDJK 07716161
*------------------------------------------------------------* @D61NDJK 07731261
*                                                              @D61NDJK 07746361
         LA    R1,TERCCB          GET ADDRESS OF SGTAP CCB     @D61NDJK 07761461
         USING CCBADR,R1          MAKE TERCCB ADDRESSABLE      @D61NDJK 07776561
*                                                              @D61NDJK 07788561
         MVI   CCBCOM1,ACCUNRIO+POSTDE+OWNUCRT SET UP CCB..    @D61NDJK 07800561
         MVI   CCBCOM2,CHNBIT                   COMMUNICATION..@D61NDJK 07812561
         MVI   CCBBY3,ERRTIN+USENSE             BYTES          @D61NDJK 07824561
*                                                              @D61NDJK 07836961
         XC    CCBCSWW,CCBCSWW    PURGE CSW CCW ADDRESS        @D61NDJK 07852061
         XC    CCBSTA,CCBSTA      PURGE STATUS BYTES           @D61NDJK 07867161
         XC    CCBCNT,CCBCNT      PURGE RESIDUAL COUNT         @D61NDJK 07882261
         LTR   R4,R4              CHANQ. ENTRY IS PRESENT?     @D61NDJK 07897361
         BZ    TER0900            NO                           @D61NDJK 07912461
         MVC   CCBCSWW,CHQCSW+1   COPY USERS CSWCCW ADDRESS    @D61NDJK 07927561
         MVC   CCBSTA,CHQCSW+4    COPY USERS STATUS BYTES      @D61NDJK 07942661
         MVC   CCBCNT,CHQCSW+6    COPY USERS RESIDUAL COUNT    @D61NDJK 07957761
*                                                              @D61NDJK 07972861
TER0900  COMRG REG=(R7)           GET COMREG ADDRESS           @D61SDJK 07992951
         USING COMREG,R7          MAKE COMREG ADDRESSABLE      @D61SDJK 07997941
         LR    R5,R3              CALCULATE A 10 BIT           @D61NDJK 08002931
         SH    R5,PUBPT           PUB OFFSET IN PUBTAB         @D61NDJK 08007921
         SRL   R5,3               PUB INDEX                    @D61NDJK 08018161
         STH   R5,CCBCLS          SET CCBLNO FIELD             @D61NDJK 08033261
         DROP  R7                 RELEASE COMREG BASE          @D61SDJK 08012911
         OI    CCBCLS,XCPR+CCBPHYAD EXCP REAL AND PHYSICAL..   @D61NDJK 08048361
*                                     ADDRESSING IS WANTED     @D61NDJK 08063461
         XC    CCBCCW31(4),CCBCCW31 CLEAR ADDRESS OF CHANNEL.. @D66ADAP 08078561
*                                   PROGRAM AND PATH MASK      @D61NDJK 08093661
         TM    TEROEFLG,TEROEUCU  USER CCB IS AVAILABLE?       @D61NDJK 08108761
         BO    TER0950            NO                           @D61NDJK 08123861
 SGTAP  'SGCOV ERPT610',NR=(01,2) USER CCB IS AVAILABLE            INIT 08148951
         MVC   CCBCCW31+1(3),CCBCCW31+1-CCBADR(RB) TAKE ADDR.  @D66ADAP 08158941
*                                   OF USER CHANNEL PROGRAM    @D61SDJK 08168931
TER0950  MVI   CCBSENS,X'04'      SET UP OWN..                 @D61NDJK 08184261
         LA    R5,TERSNS            SENSE CCW. SENSE..         @D61NDJK 08199361
         STCM  R5,7,CCBSENS+1       DATA CAN LATER..           @D61NDJK 08214461
         LA    R5,32                BE RETRIEVED..             @D61NDJK 08229561
         ST    R5,CCBSENS+4         FROM TERSNS                @D61NDJK 08244661
*                                                              @D61NDJK 08259761
*------------------------------------------------------------* @D61NDJK 08274861
*                                                              @D61NDJK 08289961
*   WRITE A DEBUG ENTRY TYPE 1.                                @D61NDJK 08305061
*                                                              @D61NDJK 08320161
*------------------------------------------------------------* @D61NDJK 08335261
*                                                              @D61NDJK 08350361
 SGTAP  'CALL  TERTRACE        ','CALL FOR DEBUG ENTRY',       @D61NDJKX08365461
               NR='1              TYPE 1'                      @D61NDJK 08380561
*                                                              @D61NDJK 08395661
         B     TER10000                                        @D61NDJK 08410761
*                                                              @D61NDJK 08425861
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 08456061
*                                                                     * 08501361
*                    START OF RECOVERY LOOP                           * 08516461
*                                                                     * 08531561
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 08546661
*                                                              @D61NDJK 08561761
*------------------------------------------------------------* @D61NDJK 08576861
*   RESET ALL DATA IN GLOBAL WORK AREA PART 2 AND SOME FLAGS   @D61SDJK 08596951
*   IN GLOBAL WORK AREA PART 1.                                @D61SDJK 08601941
*------------------------------------------------------------* @D61NDJK 08607061
*                                                              @D61NDJK 08622161
TER10000 XC    TERGWAP2(TERGWAL2),TERGWAP2                     @D61SDJK 08643251
*                                                              @D61SDJK 08649241
         NI    TERFLG,XFF-TERCVPRF-TERCVREW-TERCVOIR-TERCVHIG  @D63HDJK 08655231
*                                                              @D61NDJK 08667461
*------------------------------------------------------------* @D61NDJK 08682561
*                                                              @D61NDJK 08697661
*   OBTAIN THE FAILING CCW FROM THE CSW IN TERCCB.             @D61NDJK 08712761
*                                                              @D61NDJK 08727861
*------------------------------------------------------------* @D61NDJK 08742961
*                                                              @D61NDJK 08758061
         TM    TEROEFLG,TEROEUCU  USER CCB IS STILL AVAILABLE? @D61NDJK 08773161
         BO    TER12000           NO                           @D61NDJK 08788261
*                                                              @D61NDJK 08803361
         SLR   R9,R9              PLEASE FIND FAILING CCW      @D61NDJK 08818461
 SGTAP  'CALL  TERSCAN         ','SUPPLY FAILING CCW ADDR',    @D61NDJKX08833561
               I='1,9               ON RETURN',                @D61NDJKX08848661
               O='5,6               VALUES ARE SET',           @D61SDJKX08870751
               E0='TER11000       FAILING CCW NOT FOUND'       @D61NDJK 08878861
*                                                              @D61NDJK 08893961
         B     TER12000                                        @D61NDJK 08909061
*                                                              @D61NDJK 08924161
TER11000 SLR   R8,R8              INDICATE THAT..              @D61NDJK 08944261
         ST    R8,TERFCCWV          FAILING..                  @D61NDJK 08964361
         ST    R8,TERCCCWV          CCW COULD..                @D61NDJK 08986951
         ST    R8,TERCCCWR          NOT BE..                   @D61NDJK 08996941
         STC   R8,TERCCCWO          FOUND                      @D61NDJK 09014761
*                                                              @D61NDJK 09029861
*------------------------------------------------------------* @D61NDJK 09044961
*                                                              @D61NDJK 09060061
*   DETERMINE MAIN ERROR CLASSIFICATION CODE.                  @D61NDJK 09075161
*                                                              @D61NDJK 09090261
*------------------------------------------------------------* @D61NDJK 09105361
*                                                              @D61NDJK 09120461
TER12000 DS    0H                                              @D61NDJK 09135561
 SGTAP  'CALL  TEREVAL         ','CLASSIFY ERROR CONDITION',   @D61NDJKX09150661
               I='1,2,3,B           ON RETURN',                @D61SDJKX09172751
               O='NONE              VALUE IS SET'              @D61NDJK 09180861
*                                                              @D61NDJK 09195961
*------------------------------------------------------------* @D61NDJK 09211061
*                                                              @D61NDJK 09226161
*   SEE, IF THE ERROR HAS CHANGED TO A DIFFERENT TYPE          @D61NDJK 09241261
*   DURING RECOVERY I/O OR IF WE STILL HAVE THE ORIGINAL       @D61NDJK 09256361
*   ERROR CONDITION.                                           @D61NDJK 09271461
*                                                              @D61NDJK 09286561
*------------------------------------------------------------* @D61NDJK 09301661
*                                                              @D61NDJK 09316761
         XC    TERTERSV(6),TERTERSV                            @D61SDJK 09323761
         MVC   TERTERSV(1),TERMECC                             @D61NDJK 09331861
         MVC   TERTERSV+1(3),CCBCSWW                           @D61NDJK 09346961
         CLI   TERDEVTY,TERTPA    IT IS A TPA DEVICE           @D61SDJK 09349961
         BNL   TER12400           YES                          @DY45580         
         CLI   ERRQSNS+3,X'48'    TERA48                       @DY45580         
         BNE   TER12500           NO                           @DY45580         
         MVC   TERTERSV+1(3),ERRQSNS+4 SAVE BLKID INSTEAD      @DY45580         
*                                 TAPE MOVED -> NEW ERROR      @DY45580         
         B     TER12500                                        @DY45580         
TER12400 MVC   TERTERSV+4(2),ERRQSNS+4                         @DY45580         
*                                 THE ERROR LOOKS SIMILAR..    @D61NDJK 09362061
TER12500 CLC   TERLSTER,TERTERSV  SAME ERROR AS LAST TIME      @D61NDJK 09384151
         BE    TER14000           YES                          @D61NDJK 09392261
*                                                              @D61NDJK 09407361
 SGTAP  'SGCOV ERPT610',NR=(01,3) KIND OF ERROR CHANGED            MAIN 09427651
         MVC   TERLSTER,TERTERSV  SET THIS AS NEW LAST ERROR   @D61NDJK 09437561
         XC    TERRTCNT,TERRTCNT  PURGE RETRY COUNT            @D61NDJK 09452661
*                                                              @D61NDJK 09467761
*------------------------------------------------------------* @D61NDJK 09497961
*                                                              @D61NDJK 09513061
*   ASSIGN RECOVERY ATTRIBUTES.                                @D61NDJK 09528161
*                                                              @D61NDJK 09543261
*------------------------------------------------------------* @D61NDJK 09558361
*                                                              @D61NDJK 09573461
*------------------------------------------------------------* @D61NDJK 09588561
*   GET RECOVERY ATTRIBUTES FROM RECOVERY ACTION TABLE.        @D61NDJK 09603661
*------------------------------------------------------------* @D61NDJK 09618761
*                                                              @D61NDJK 09633861
TER14000 SLR   R5,R5              CONVERT THE MAIN ERROR..     @D61NDJK 09648961
         IC    R5,TERMECC           CLASSIFICATION CODE..      @D61NDJK 09664061
         MH    R5,=AL2(TERRATBL)    INTO AN INDEX              @D61NDJK 09679161
*                                                              @D61NDJK 09694261
         A     R5,=A(TERRATB)     ACCESS RECOVERY ACTION TABLE @D61NDJK 09709361
         OC    TERRCVSR(TERRATBL),0(R5)  SET RECOVERY ATTRIB.  @D61NDJK 09724461
*                                                              @D61NDJK 09739561
*------------------------------------------------------------* @D61NDJK 09754661
*                                                              @D61NDJK 09769761
*   WRITE A DEBUG ENTRY TYPE 2.                                @D61NDJK 09784861
*                                                              @D61NDJK 09799961
*------------------------------------------------------------* @D61NDJK 09815061
*                                                              @D61NDJK 09830161
 SGTAP  'CALL  TERTRACE        ','CALL FOR DEBUG ENTRY',       @D61NDJKX09845261
               NR='2              TYPE 2'                      @D61NDJK 09860361
*                                                              @D61NDJK 09875461
*------------------------------------------------------------* @D61NDJK 09890561
*                                                              @D61NDJK 09905661
*   PERFORM RECOVERY ACTION.                                   @D61NDJK 09920761
*                                                              @D61NDJK 09935861
*------------------------------------------------------------* @D61NDJK 09950961
*                                                              @D61NDJK 09966061
 SGTAP  'CALL  TERDOREC        ','ATTEMPT TO RECOVER',         @D61NDJKX09981161
               I='1,2,3,B           FROM THE ERROR  ',         @D61NDJKX09996261
               O='F                 CONDITION       '          @D61NDJK 10011361
*                                                              @D61NDJK 10026461
         STC   RF,TERRCVCC        SAVE RECOVERY COMPLETION CODE@D61NDJK 10041561
*                                                              @D61NDJK 10056661
*------------------------------------------------------------* @D61NDJK 10071761
*                                                              @D61NDJK 10086861
*   DO RECORDING, IF APPROPRIATE.                              @D61NDJK 10252961
*                                                              @D61NDJK 10268061
*------------------------------------------------------------* @D61NDJK 10283161
*                                                              @D61NDJK 10298261
 SGTAP  'CALL  TERLOG          ','ON RETURN RECORDING',        @D61NDJKX10313361
               I='1,2,3,F           IS DONE IF IT WAS',        @D61NDJKX10328461
               O='NONE              DESIRABLE'                 @D61NDJK 10329761
*                                                              @D61NDJK 10331061
*------------------------------------------------------------* @D61NDJK 10332361
*                                                              @D61NDJK 10333661
*   DO MESSAGING, IF APPROPRIATE.                              @D61NDJK 10334961
*                                                              @D61NDJK 10336261
*------------------------------------------------------------* @D61NDJK 10337561
*                                                              @D61NDJK 10338861
 SGTAP  'CALL  TERMSG          ','ON RETURN MESSAGING',        @D61NDJKX10340161
               I='1,2,3,B,F         IS DONE IF IT WAS',        @D61NDJKX10341461
               O='NONE              DESIRABLE'                 @D61NDJK 10343561
*                                                              @D61NDJK 10358661
*------------------------------------------------------------* @D61NDJK 10373761
*                                                              @D61NDJK 10388861
*   WRITE A DEBUG ENTRY TYPE 3.                                @D61NDJK 10403961
*                                                              @D61NDJK 10419061
*------------------------------------------------------------* @D61NDJK 10434161
*                                                              @D61NDJK 10449261
 SGTAP  'CALL  TERTRACE        ','CALL FOR DEBUG ENTRY',       @D61NDJKX10464361
               NR='3              TYPE 3'                      @D61NDJK 10479461
*                                                              @D61NDJK 10494561
*------------------------------------------------------------* @D61NDJK 10509661
*                                                              @D61NDJK 10524761
*   IF ANOTHER ERROR CONDITION OCCURRED DURING RECOVERY        @D61NDJK 10539861
*   I/O, IT WILL BE PROCESSED IN A FRESH RUN THROUGH THE       @D61NDJK 10554961
*   RECOVERY LOOP.                                             @D61NDJK 10570061
*                                                              @D61NDJK 10585161
*------------------------------------------------------------* @D61NDJK 10600261
*                                                              @D61NDJK 10615361
         LA    R5,TERERAEC        TAKE THAT COMPLETION CODE    @D61NDJK 10630461
         CR    RF,R5              ANOTHER ERROR OCCURRED?      @D61NDJK 10645561
         BNE   TER20000           NO, LEAVE RECOVERY LOOP      @D61NDJK 10660661
*                                                              @D61NDJK 10675761
*------------------------------------------------------------* @D61NDJK 10690861
*  UPDATE THE ORIGINAL ERROR ENTRY WITH NEW ERROR INFORMATION. @D61NDJK 10705961
*------------------------------------------------------------* @D61NDJK 10721061
*                                                              @D61NDJK 10736161
 SGTAP  'SGCOV ERPT610',NR=(01,4) ANOTHER ERROR OCCURRED           MAIN 10774951
*                                                              @D61NDJK 10796561
         MVC   ERRQSNS-ERBLKADR(32,R2),TERSNS UPDATE SENSE DATA@D61NDJK 10816661
         XC    TERSNS,TERSNS      CLEAR SENSE BYTES            @D61NDJK 10836761
*                                                              @D61NDJK 10856961
         XC    ERRQMSG,ERRQMSG      RESET MESSAGE ID           @D61NDJK 10906961
         MVC   ERRQPATH(1),TERCURPI UPDATE PATH FAILURE INFO   @D61NDJK 10956961
         MVC   ERRQLSNS(1),TERCURSL UPDATE SENSE DATA LENGTH   @D61SDJK 10964961
         MVC   TERRTLOG(1),TERRTCNT UPDATE OBR RETRY COUNTER   @D61NDJK 10982461
*                                   UPDATE CSW IN ERROR ENTRY: @D61NDJK 11007961
         MVC   ERRQCSW+1(3),CCBCSWW FAILING CCW ADDRESS        @D61NDJK 11023061
         MVC   ERRQCSW+4(2),CCBSTA  STATUS BYTES               @D61NDJK 11038161
         MVC   ERRQCSW+6(2),CCBCNT  RESIDUAL COUNT             @D61NDJK 11053261
         OI    TERFLG,TERCVCSW    CSW IN TERCCB MUST BE..      @D61NDJK 11068361
*                                   PROVIDED IN LOW CORE       @D61NDJK 11083461
         B     TER10000           DO RECOVERY LOOP ONCE MORE   @D61NDJK 11098561
*                                                              @D61NDJK 11113661
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 11158961
*                                                                     * 11174061
*                      END OF RECOVERY LOOP                           * 11189161
*                                                                     * 11204261
*                   END OF SGTAP MAIN ROUTINE                         * 11219361
*                                                                     * 11234461
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 11249561
*                                                                       11264661
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 11279761
*                                                                     * 11294861
*                      FINAL PROCESSING                               * 11309961
*                                                                     * 11325061
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 11340161
*                                                              @D61NDJK 11355261
*------------------------------------------------------------* @D61NDJK 11370361
*                                                              @D61NDJK 11385461
*   POST USER CCB, IF IT IS STILL AVAILABLE.                   @D61NDJK 11400561
*                                                              @D61NDJK 11415661
*------------------------------------------------------------* @D61NDJK 11430761
*                                                              @D61NDJK 11445861
TER20000 TM    TEROEFLG,TEROEUCU  USER CCB IS STILL AVAILABLE? @D61NDJK 11460961
         BO    TER21000           NO                           @D61NDJK 11476061
*                                                              @D61NDJK 11491161
*------------------------------------------------------------* @D61NDJK 11506261
*  INITIALIZE CCB COMMUNICATION BYTES.                         @D61NDJK 11521361
*------------------------------------------------------------* @D61NDJK 11536461
*                                                              @D61NDJK 11551561
         NI    CCBCOM1-CCBADR(RB),XFF-DISERR  RESET FLAGS IN.. @D61SDJK 11581651
         NI    CCBCOM2-CCBADR(RB),NRFRETRY-CHNBIT   USER CCB   @D61SDJK 11591641
*                                                              @D61NDJK 11611961
*------------------------------------------------------------* @D61NDJK 11627061
*  SET READ DATA CHECK INDICATION IF REQUIRED.                 @D61NDJK 11642161
*------------------------------------------------------------* @D61NDJK 11657261
*                                                              @D61NDJK 11672361
         CLI   TERRCVCC,TERERUNS  RECOVERY FAILED AND..        @D61NDJK 11687461
         BNE   TER20100             READ DATA CHECKS..         @D61NDJK 11702561
         TM    TERFLGPS,TERPSRDC    SHALL BE POSTED?           @D61NDJK 11717661
         BZ    TER20100           NO                           @D61NDJK 11732761
*                                 INDICATE A READ..            @D61SDJK 11755851
         OI    CCBCOM2-CCBADR(RB),X'10'      DATA CHECK        @D61SDJK 11763841
 SGTAP  'SGCOV ERPT610',NR=(02,0) READ DATA CHECK POSTED          FINAL 11774261
*                                                              @D61NDJK 11793161
*------------------------------------------------------------* @D61NDJK 11808261
*  SET IRRECOVERABLE I/O ERROR INDICATION IF REQUIRED.         @D61NDJK 11823361
*------------------------------------------------------------* @D61NDJK 11838461
*                                                              @D61NDJK 11853561
TER20100 CLI   TERRCVCC,TERERUNS  RECOVERY FAILED?             @D61NDJK 11868661
         BNE   TER21000           NO                           @D61NDJK 11883761
*                                 INDICATE IRRECOVERABLE..     @D61SDJK 11906851
         OI    CCBCOM1-CCBADR(RB),DISERR   I/O ERROR           @D61SDJK 11914841
 SGTAP  'SGCOV ERPT610',NR=(02,1) DISASTER ERROR POSTED           FINAL 11925261
*                                                              @D61NDJK 11944161
*------------------------------------------------------------* @D61NDJK 11959261
*                                                              @D61NDJK 11974361
*   SET UP TERWKCSW WHICH IS USED TO UPDATE THE LOW CORE CSW.  @D61NDJK 11989461
*                                                              @D61NDJK 12004561
*------------------------------------------------------------* @D61NDJK 12019661
*                                                              @D61NDJK 12034761
.*  SGTAP IS HAVING A NUMBER OF DIFFERENT PLACES FOR CSWS.     @D61NDJK 12049861
.*  THERE IS A WORK CSW IN TERWKCSW, WHICH IS ASSEMBLED        @D61NDJK 12064961
.*  AFTER THE RECOVERY LOOP WAS RUN THRU AND THEN COPIED       @D61NDJK 12080061
.*  INTO LOW CORE CSW                                          @D61NDJK 12095161
.*  SECOND THERE IS THE FIELDS IN THE CCB, WHICH ALTOGETHER    @D61NDJK 12110261
.*  MAKE UP A COMPLETE CSW TOO. IT IS THE WORKING CSW,         @D61NDJK 12125361
.*  WHICH CHANGES EVERY TIME A RECOVERY ACTION IS DONE.        @D61NDJK 12140461
.*  THIRD THERE IS THE ERQCSW, WHICH IS PROVIDED BY THE        @D61NDJK 12155561
.*  SUPERVISOR IN THE DEVICE ERROR ENTRY. IT ALWAYS            @D61NDJK 12170661
.*  REPRESENTS THE CURRENT ERROR STATUS, WHICH IS TO BE        @D61NDJK 12185761
.*  INCLUDED IN MESSAGES TO THE CONSOLE FOR EXAMPLE.           @D61NDJK 12200861
.*  IT IS NOT AN ACCUMULATED STATUS ORIGINALLY. EVERY TIME     @D61NDJK 12215961
.*  SGTAP ENCOUNTERS A NEW ERROR, THE ERRQCSW IS SET TO        @D61NDJK 12231061
.*  THIS NEW ERROR STATUS AGAIN.                               @D61NDJK 12246161
.*  THE LAST CSW IS THE CSW OF THE CHANNEL QUEUE ENTRY FOR     @D61NDJK 12261261
.*  THE ORIGINAL ERROR. THIS ONE CONTAINS AN ACCUMULATED       @D61NDJK 12276361
.*  STATUS.                                                    @D61NDJK 12291461
.*  WHEN SGTAP LEAVES TO TAPEXIT, THE STATUS PUT INTO LOW      @D61NDJK 12306561
.*  CORE CSW WILL BE MOVED INTO THE CHANNEL QUEUE CSW OF       @D61NDJK 12321661
.*  THE USER ENTRY. THE SUPERVISOR REALLY WORKS WITH THE       @D61NDJK 12336761
.*  LOW CORE CSW. ALL DECISIONS WHAT TO DO IN THE INTERRUPT    @D61NDJK 12351861
.*  HANDLER ARE BASED ON THE LOW CORE CSW. ONLY THE            @D61NDJK 12366961
.*  INFORMATION FOR POSTING THE USER CCB EVENTUALLY IS         @D61NDJK 12382061
.*  TAKEN FROM THE ACCUMULATED STATUS IN THE CHANNEL QUEUE     @D61NDJK 12397161
.*  ENTRY.                                                     @D61NDJK 12412261
.*                                                             @D61NDJK 12427361
.*  THE CURRENT LOGIC IS DOING THE FOLLOWING:                  @D61NDJK 12699161
.*  THE CSW RELEVANT VALUES OF THE CCB ARE SET UP WITH THE     @D61NDJK 12714261
.*  ACCUMULATED CHANNEL QUEUE ENTRY CSW. IT WOULD ALWAYS       @D61NDJK 12729361
.*  CONTAIN AN ENDING ADDRESS, EITHER FROM PRIMARY OR          @D61NDJK 12744461
.*  SECONDARY STATUS (IF THERE WAS ONE OF COURSE).             @D61NDJK 12759561
.*  THEN WE DO THE RECOVERY ACTIONS. THE RECOVERY ACTIONS      @D61NDJK 12774661
.*  WILL NORMALLY DO IO AND HENCE REPLACE THE STATUS IN THE    @D61NDJK 12789761
.*  CCB. THIS STATUS ALWAYS IS AN ACCUMULATED STATUS, SINCE    @D61NDJK 12804861
.*  SGTAP ISSUES THE SYSIO WITH POST AT DEVICE END ON.         @D61NDJK 12819961
.*                                                             @D61NDJK 12835061
.*  WHEN THIS POINT IS REACHED, THERE ARE THREE CASES          @D61NDJK 12850161
.*  POSSIBLE:                                                  @D61NDJK 12865261
.*  1) SGTAP JUST GAVE UP. IN THIS CASE THE ACCUMULATED        @D61NDJK 12880361
.*     STATUS IN THE CHANNEL QUEUE CSW WILL BE LEFT AS IT      @D61NDJK 12895461
.*     IS AND THE ONLY WAY TO DO THAT IS TO MOVE IT DOWN       @D61NDJK 12910561
.*     INTO LOW CORE CSW.                                      @D61NDJK 12925661
.*  2) SGTAP JUST GAVE UP, BUT NO CHANNEL QUEUE ENTRY IS       @D61NDJK 12940761
.*     AVAILABLE. NOW THERE STILL IS A NEED TO PUT SOMETHING   @D61NDJK 12955861
.*     DOWN INTO LOW CORE, WHICH WILL BE THE ERRQCSW.          @D61NDJK 12970961
.*  3) SOME KIND OF RECOVERY ACTION WAS DONE AND COMPLETED     @D61NDJK 12986061
.*     SUCCESSFULLY. THEN THE VALUES ACCUMULATED IN TERCCB     @D61NDJK 13001161
.*     ARE USED TO SET UP THE LOW CORE CSW.                    @D61NDJK 13016261
.*                                                             @D61NDJK 13031361
*------------------------------------------------------------* @D61NDJK 13061561
*   SET UP TERWKCSW USING CSW INFORMATION IN CHANNEL QUEUE.    @D61NDJK 13076661
*------------------------------------------------------------* @D61NDJK 13091761
*                                                              @D61NDJK 13106861
TER21000 TM    TERFLG,TERCVCSW    CSW IN TERCCB SHALL BE..     @D61NDJK 13121961
         BO    TER21200             PROVIDED IN LOW CORE?      @D61NDJK 13152161
*                                                              @D61NDJK 13182361
         TM    TEROEFLG,TEROEUCU  USER CCB IS STILL AVAILABLE? @D61NDJK 13197461
         BO    TER21100           NO                           @D61NDJK 13212561
*                                                              @D61NDJK 13216261
         CLI   TERRCVCC,TERERSUC  RECOVERY WAS SUCCESSFUL?     @D61NDJK 13219961
         BE    TER21200           YES                          @D61NDJK 13223661
*                                                              @D61NDJK 13227661
 SGTAP  'SGCOV ERPT610',NR=(02,2) TAKE CHQCSW FOR LOW CORE        FINAL 13238961
         MVC   TERWKCSW+1(7),CHQCSW+1  TAKE STATUS FROM..      @D61NDJK 13257861
         B     TER21300                  CHANNEL QUEUE ENTRY   @D61NDJK 13272961
*                                                              @D61NDJK 13288061
*------------------------------------------------------------* @D61NDJK 13303161
*   SET UP TERWKCSW USING CSW INFORMATION IN ERROR ENTRY.      @D61NDJK 13318261
*------------------------------------------------------------* @D61NDJK 13333361
*                                                              @D61NDJK 13348461
TER21100 DS    0H                                              @D61NDJK 13363561
 SGTAP  'SGCOV ERPT610',NR=(02,3) TAKE ERRQCSW FOR LOW CORE       FINAL 13374861
         MVC   TERWKCSW+1(7),ERRQCSW+1 TAKE STATUS FROM..      @D61NDJK 13393761
         B     TER21300                  DEVICE ERROR ENTRY    @D61NDJK 13408861
*                                                              @D61NDJK 13423961
*------------------------------------------------------------* @D61NDJK 13439061
*   SET UP TERWKCSW USING CSW INFORMATION IN TERCCB.           @D61NDJK 13454161
*------------------------------------------------------------* @D61NDJK 13469261
*                                                              @D61NDJK 13484361
TER21200 MVC   TERWKCSW+1(3),CCBCSWW   TAKE STATUS..           @D61NDJK 13499461
         MVC   TERWKCSW+4(2),CCBSTA      FROM..                @D61NDJK 13514561
         MVC   TERWKCSW+6(2),CCBCNT      TERCCB                @D61NDJK 13529661
 SGTAP  'SGCOV ERPT610',NR=(02,4) TAKE TERCCB CSW FOR LOW CORE    FINAL 13540961
*                                                              @D61NDJK 13559861
*------------------------------------------------------------* @D61NDJK 13574961
*   SWITCH OFF UNIT CHECK, IF REQUIRED.                        @D61NDJK 13590061
*------------------------------------------------------------* @D61NDJK 13605161
*                                                              @D61NDJK 13620261
TER21300 CLI   TERRCVCC,TERERSUC  RECOVERY WAS SUCCESSFUL?     @D61NDJK 13626261
         BNE   TER21400           NO                           @D61NDJK 13632261
*                                                              @D61NDJK 13638261
         TM    TERFLGPS,TERPSUC   UNIT CHECK HAS TO BE SET OFF?@D61NDJK 13644261
         BZ    TER21400           NO                           @D61NDJK 13650461
*                                                              @D61NDJK 13665561
         NI    TERWKCSW+4,XFF-UNITCK   SWITCH OFF UNIT CHECK   @D61NDJK 13680661
 SGTAP  'SGCOV ERPT610',NR=(02,5) SWITCH OFF UNIT CHECK IN CSW    FINAL 13691961
*                                                              @D61NDJK 13710861
*------------------------------------------------------------* @D61NDJK 13725961
*   SWITCH ON UNIT EXCEPTION, IF REQUIRED.                     @D61NDJK 13741061
*------------------------------------------------------------* @D61NDJK 13756161
*                                                              @D61NDJK 13771261
TER21400 TM    TERFLGPS,TERPSUE   UNIT EXCP. HAS TO BE SET ON? @D61NDJK 13786361
         BZ    TER21500           NO                           @D61NDJK 13801461
*                                                              @D61NDJK 13816561
         OI    TERWKCSW+4,UNITEXCP     SWITCH ON UNIT EXCEPTION@D61NDJK 13831661
 SGTAP  'SGCOV ERPT610',NR=(02,6) SWITCH ON UNIT EXCEPTION IN CSW FINAL 13842961
*                                                              @D61NDJK 13854361
*------------------------------------------------------------* @D61NDJK 13854461
*   INCREMENT PUB2 ERROR COUNTERS, IF REQUIRED.                @D61NDJK 13854561
*------------------------------------------------------------* @D61NDJK 13854661
*                                                              @D61NDJK 13854761
TER21500 TM    TERFLGPS,TERPSCNT  PUB2 COUNTER MUST BE UPDATED?@D61NDJK 13854861
         BZ    TER21600           NO                           @D61NDJK 13854961
*                                                              @D61NDJK 13855061
         L     R5,TERAPUB2        GET PUB2 POINTER             @D61SDJK 13855351
         USING PUB2ADR,R5         DECLARE PUB2 BASE            @D61NDJK 13855661
*                                                              @D61NDJK 13855761
         LA    R9,P2TEMPR         ASSUME A TEMPORARY READ ERROR@D61NDJK 13855861
 SGTAP  'SGCOV ERPT610',NR=(02,7) ASSUME TEMPORARY READ ERROR     FINAL 13855961
         LA    R7,TERERSUC        TAKE RECOVERY COMPLETION CODE@D61NDJK 13856161
         CR    RF,R7              RECOVERY WAS SUCCESSFUL?     @D61NDJK 13856261
         BE    TER21550           YES                          @D61NDJK 13856361
*                                                              @D61NDJK 13856461
         LA    R9,P2PRD           ASSUME A PERMANENT READ ERROR@D61NDJK 13856561
 SGTAP  'SGCOV ERPT610',NR=(03,0) ASSUME PERMANENT READ ERROR     FINAL 13856661
         TM    TERCCCWO,X'01'     FAILING CCW IS A WRITE CCW?  @D61NDJK 13856861
         BZ    TER21570           NO                           @D61NDJK 13856961
*                                                              @D61NDJK 13857061
         LA    R9,P2PWT           IT IS A PERMANENT WRITE ERROR@D61NDJK 13857161
 SGTAP  'SGCOV ERPT610',NR=(03,1) ASSUME PERMANENT WRITE ERROR    FINAL 13857261
         B     TER21570                                        @D61NDJK 13857461
*                                                              @D61NDJK 13857561
TER21550 TM    TERCCCWO,X'01'     FAILING CCW IS A WRITE CCW?  @D61NDJK 13857661
         BZ    TER21570           NO                           @D61NDJK 13857761
*                                                              @D61NDJK 13857861
         LA    R9,P2TEMPW         IT IS A TEMPORARY WRITE ERROR@D61NDJK 13857961
 SGTAP  'SGCOV ERPT610',NR=(03,2) ASSUME TEMPORARY WRITE ERROR    FINAL 13858061
*                                                              @D61NDJK 13858261
TER21570 CLI   0(R9),255          THRESHOLD IS REACHED?        @D61NDJK 13858361
         BE    TER21600           YES, LEAVE COUNTER UNCHANGED @D61NDJK 13858461
*                                                              @D61NDJK 13858561
         IC    R7,0(R9)           GET PUB2 ERROR COUNTER       @D61NDJK 13858661
         LA    R7,1(R7)           INCREMENT COUNTER            @D61NDJK 13858761
         STC   R7,0(R9)           RESTORE PUB2 ERROR COUNTER   @D61NDJK 13858861
 SGTAP  'SGCOV ERPT610',NR=(03,3) PUB2 ERROR COUNTER IS UPDATED   FINAL 13858961
         DROP  R5                 RELEASE PUB2 BASE            @D61NDJK 13859161
*                                                              @D61NDJK 13859261
*------------------------------------------------------------* @D61NDJK 13859361
*   CLEAR PUB2 ERROR COUNTERS, IF REQUIRED.                    @D61NDJK 13859461
*------------------------------------------------------------* @D61NDJK 13859561
*                                                              @D61NDJK 13859661
TER21600 TM    TERFLGPS,TERPSCLR  PUB2 COUNTER MUST BE CLEARED?@D61NDJK 13859761
         BZ    TER22000           NO                           @D61NDJK 13859861
*                                                              @D61NDJK 13859961
         L     R5,TERAPUB2        GET PUB2 POINTER             @D61SDJK 13860241
         USING PUB2ADR,R5         DECLARE PUB2 BASE            @D61NDJK 13860561
*                                                              @D61NDJK 13860661
         XC    P2TEMPR,P2TEMPR    CLEAR..                      @D61NDJK 13860761
         XC    P2TEMPW,P2TEMPW      ALL USED..                 @D61NDJK 13860861
         XC    P2PRD,P2PRD          ERROR COUNTERS..           @D61NDJK 13860961
         XC    P2PWT,P2PWT          IN PUB2                    @D61NDJK 13861061
 SGTAP  'SGCOV ERPT610',NR=(03,4) PUB2 ERROR COUNTER ARE CLEARED  FINAL 13861161
         DROP  R5                 RELEASE PUB2 BASE            @D61NDJK 13861361
*                                                              @D61NDJK 13861861
*------------------------------------------------------------* @D61NDJK 13876961
*                                                              @D61NDJK 13892061
*   DETERMINE WHAT RETURN CODE SHOULD BE PASSED TO TAPEXIT.    @D61NDJK 13907161
*                                                              @D61NDJK 13922261
*------------------------------------------------------------* @D61NDJK 13937361
*                                                              @D61NDJK 13952461
*------------------------------------------------------------* @D61NDJK 13967561
*   NORMALLY USE THE IGNORE RETURN CODE.                       @D61NDJK 13982661
*------------------------------------------------------------* @D61NDJK 13997761
*                                                              @D61NDJK 14012861
.*  TEREXIGN IS THE DEFAULT VALUE.                             @D61NDJK 14035461
.*                                                             @D61NDJK 14058161
TER22000 MVI   TEREXITC,TEREXIGN  TAKE IGNORE RETURN CODE      @D61NDJK 14073261
*                                                              @D61NDJK 14074161
*------------------------------------------------------------* @D61NDJK 14075061
*   IN SOME CASES THE DISPATCHER RETURN CODE HAS TO BE USED.   @D61NDJK 14075961
*------------------------------------------------------------* @D61NDJK 14076861
*                                                              @D61NDJK 14077761
.*  TEREXDSP IS USED IN CASE OF A RECONLY REQUEST WHEN THE     @D61NDJK 14078361
.*  USER HAS ALREADY BEEN POSTED AND THE CHANNEL QUEUE ENTRY   @D61NDJK 14078961
.*  IS FREED.                                                  @D61NDJK 14079561
.*                                                             @D61NDJK 14080461
         TM    TEROEFLG,TEROEMEL  IT IS A RECONLY REQUEST?     @D61NDJK 14081361
         BZ    TER22050           NO                           @D61NDJK 14082261
*                                                              @D61NDJK 14083161
         MVI   TEREXITC,TEREXDSP  TAKE DISPATCHER RETURN CODE  @D61NDJK 14084061
 SGTAP  'SGCOV ERPT610',NR=(03,5) DISPATCHER RETURN CODE SELECTED FINAL 14085851
         B     TER23000                                        @D61NDJK 14086761
*                                                              @D61NDJK 14087161
TER22050 TM    TEROEFLG,TEROEUCU  USER CCB IS AVAILABLE?       @D61NDJK 14087561
         BO    TER23000           NO, TAKE IGNORE RETURN CODE  @D61NDJK 14087961
*                                                              @D61NDJK 14088361
*------------------------------------------------------------* @D61NDJK 14103461
*   IN SOME CASES THE CANCEL RETURN CODE HAS TO BE USED.       @D61NDJK 14118561
*------------------------------------------------------------* @D61NDJK 14133661
*                                                              @D61NDJK 14148761
.*  TEREXCAN IS USED FOR UNSUCCESSFUL RECOVERY AND IF THE      @D61NDJK 14163861
.*  USER DOES NOT REQUEST KNOWLEDGE ABOUT ALL UNSUCCESSFUL     @D61NDJK 14178961
.*  I/O REQUESTS.                                              @D61NDJK 14194061
.*                                                             @D61NDJK 14209161
TER22100 LA    R5,TERERUNS        TAKE RECOVERY COMPLETION CODE@D61NDJK 14239361
         CR    RF,R5              RECOVERY FAILED?             @D61NDJK 14269561
         BNE   TER22300           NO                           @D61NDJK 14284661
*                                 USER ACCEPTS IRRECOVERABLE.. @D61SDJK 14304751
         TM    CCBCOM1-CCBADR(RB),ACCUNRIO     I/O ERROR?      @D61SDJK 14309741
         BO    TER23000           YES                          @D61NDJK 14314861
*                                                              @D61NDJK 14329961
         TM    TERFLGPS,TERPSRDC  IT IS A READ DATA CHECK?     @D61NDJK 14345061
         BZ    TER22200           NO                           @D61NDJK 14360161
         TM    CCBCOM1-CCBADR(RB),X'02'     RETURN DATA CHECK? @D61SDJK 14382251
         BO    TER23000           YES, TAKE IGNORE RETURN CODE @D61NDJK 14390361
*                                                              @D61NDJK 14405461
TER22200 MVI   TEREXITC,TEREXCAN  TAKE CANCEL RETURN CODE      @D61NDJK 14413261
 SGTAP  'SGCOV ERPT610',NR=(03,6) CANCEL RETURN CODE SELECTED     FINAL 14421061
         B     TER23000                                        @D61NDJK 14436661
*                                                              @D61NDJK 14437661
*------------------------------------------------------------* @D61NDJK 14438661
*   IN SOME CASES THE RETRY RETURN CODE HAS TO BE USED.        @D61NDJK 14439661
*------------------------------------------------------------* @D61NDJK 14440661
*                                                              @D61NDJK 14441661
.*  TEREXRTY IS USED WHEN THE WHOLE USER CHANNEL PROGRAM MUST  @D61NDJK 14442061
.*  BE RETRIED, BUT SGTAP CANNOT PERFORM THAT RETRY IN CASE OF @D61NDJK 14442461
.*  INTERVENTION REQUIRED CONDITIONS OR IF VOLUME RECOGNITION  @D61NDJK 14442861
.*  HAS TO BE DONE FIRST.                                      @D61NDJK 14443261
.*                                                             @D61NDJK 14443661
TER22300 LA    R5,TERERRTY        TAKE RECOVERY COMPLETION CODE@D61NDJK 14444661
         CR    RF,R5              USER RETRY IS REQUESTED?     @D61NDJK 14445661
         BNE   TER22400           NO                           @D61SDJK 14447151
*                                                              @D61NDJK 14447661
         MVI   TEREXITC,TEREXRTY  TAKE RETRY RETURN CODE       @D61NDJK 14448661
 SGTAP  'SGCOV ERPT610',NR=(03,7) RETRY RETURN CODE SELECTED      FINAL 14449361
*                                                              @D61NDJK 14450761
         B     TER23000                                        @D61SDJK 14485851
*                                                              @D61SDJK 14505841
*------------------------------------------------------------* @D61SDJK 14525831
*   IN SOME CASES THE LONG BUSY RETURN CODE HAS TO BE USED.    @D61SDJK 14545821
*------------------------------------------------------------* @D61SDJK 14565811
*                                                              @D61SDJK 14585801
.*  TEREXED IS USED WHEN A LONG BUSY ERROR CONDITION WAS       @D61SDJK 14605791
.*  RECOGNIZED AND HAS TO BE PASSED TO THE I/O SUPERVISOR.     @D61SDJK 14625781
.*                                                             @D61SDJK 14645771
TER22400 LA    R5,TERERLBY        TAKE RECOVERY COMPLETION CODE@D61SDJK 14665761
         CR    RF,R5              LONG BUSY RECOVERY IS NEEDED?@D61SDJK 14685751
         BNE   TER23000           NO                           @D61SDJK 14705741
*                                                              @D61SDJK 14725731
         MVI   TEREXITC,TEREXLBY  TAKE LONG BUSY RETURN CODE   @D61SDJK 14745721
 SGTAP  'SGCOV ERPT610',NR=(04,0) LONG BUSY RETURN CODE SELECTED  FINAL 14765711
*                                                              @D61SDJK 14805691
*-------------------------------------------------------------*@D61NDJK 14979261
*                                                              @D61NDJK 14994361
*   ENSURE VOLUME RECOGNITION BY SERVICE TASK IF REQUIRED.     @D61NDJK 15009461
*                                                              @D61NDJK 15024561
*-------------------------------------------------------------*@D61NDJK 15039661
*                                                              @D61NDJK 15054761
TER23000 TM    TERFLGPS,TERPSAVR  VOLUME RECOGN. IS REQUIRED?  @D61SDJK 15079851
         BZ    TER24000           NO                           @D61SDJK 15089841
*                                                              @D61NDJK 15100061
         L     R5,TERAPUBX        GET PUBX POINTER             @D61NDJK 15145361
         USING PBXADR,R5          DECLARE PUBX BASE POINTER    @D61NDJK 15190661
         OI    PBXFLAG2,PBXNOVOL  ENSURE VOLUME RECOGNITION    @D61NDJK 15205761
 SGTAP  'SGCOV ERPT610',NR=(04,1) VOLUME RECOGNITION ENSURED      FINAL 15225751
         DROP  R5                 DROP PUBX BASE POINTER       @D61NDJK 15235961
*                                                              @D61NDJK 15251061
*------------------------------------------------------------* @D61NDJK 15266161
*                                                              @D61NDJK 15281261
*   WRITE A DEBUG ENTRY TYPE 4.                                @D61NDJK 15296361
*                                                              @D61NDJK 15311461
*------------------------------------------------------------* @D61NDJK 15326561
*                                                              @D61NDJK 15341661
TER24000 DS    0H                                              @D61SDJK 15363751
 SGTAP  'CALL  TERTRACE        ','CALL FOR DEBUG ENTRY',       @D61NDJKX15371861
               NR='4              TYPE 4'                      @D61NDJK 15386961
*                                                              @D61NDJK 15402061
*------------------------------------------------------------* @D61NDJK 15417161
*                                                              @D61NDJK 15432261
*   DEACTIVATE COPIED ERROR ENTRY, FREE GLOBAL WORK AREA AND   @D61NDJK 15447361
*   APPROPRIATE TERCCB.                                        @D61NDJK 15462461
*                                                              @D61NDJK 15477561
*------------------------------------------------------------* @D61NDJK 15492661
*                                                              @D61NDJK 15553061
         NI    ERBLKFLG,XFF-ERACTIVE  DEACTIVATE ERROR ENTRY   @D61NDJK 15573161
         NI    CCBCOM1,XFF-TRABIT     FREE CURRENT TERCCB      @D61NDJK 15593261
         NI    TERFLG,XFF-TERCVGAU    FREE GLOBAL WORK AREA    @D61NDJK 15613461
*                                                              @D61NDJK 15628561
*-------------------------------------------------------------*@D61SDJK 15774451
*                                                              @D61SDJK 15784441
*   RETURN TO SUPERVISOR RESIDENT PART OF SGTAP AT LABEL       @D61SDJK 15794431
*   TERLEAVE.                                                  @D61SDJK 15804421
*                                                              @D61SDJK 15814411
*-------------------------------------------------------------*@D61SDJK 15824401
*                                                              @D61SDJK 15834391
         L     RE,TERRETSV        RESTORE RETURN ADDRESS..     @D61SDJK 15844381
         LA    RE,4(RE)             OF SGTAP SUPERVISOR PART   @D61SDJK 15854371
*                                                              @D61SDJK 15874351
         AMODESW RETURN,AMODE=24,REG=(RE)  ================>>> @D61SDJK 15884341
*                                                              @D61SDJK 15894331
         SGTAP 'DROPALL        ','*'                           @D61NDJK 15990961
*                                                              @D61NDJK 16036261
*------------------------------------------------------------* @D61SDJK 16451351
*                                                              @D61SDJK 16851341
*   LOCAL VARIABLES USED IN SGTAP MAIN ROUTINE.                @D61SDJK 17251331
*                                                              @D61SDJK 17651321
*------------------------------------------------------------* @D61SDJK 18051311
*                                                              @D61SDJK 18451301
         DS    0F                 SAVE AREA FOR..              @D61SDJK 18851291
TERRETSV DC   A(0)                  SUPERVISOR RETURN ADDRESS  @D61SDJK 19251281
*                                                              @D61SDJK 19651271
         LTORG                                                 @D61NDJK 20354861
         EJECT                                                 @D61SDJK 20379951
*                                                              @D61SDJK 20389941
***************************************************************         20400161
*  FUNCTION                                                    @D61NDJK 20415261
*    OBTAIN THE ADDRESS OF THE USER'S CCB.                     @D61NDJK 20430361
*                                                              @D61NDJK 20445461
*  INPUT                                                       @D61NDJK 20460561
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 20475661
*                                                              @D61NDJK 20490761
*  OUTPUT                                                      @D61NDJK 20505861
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61NDJK 20520961
*      IF ONE OF THE FOLLOWING IS TRUE, RB IS SET TO ZERO:     @D61NDJK 20536061
*        A) ERP IS PROCCESING AT MINIMAL ERP LAYER             @D61NDJK 20551161
*        B) ERP IS PROCESSING AN UNSOLICITED INTERRUPT         @D61NDJK 20566261
*        C) THE USER CCB IDENTIFIED BY THE INPUT ERROR         @D61NDJK 20581361
*           ENTRY IS NOT ACCESSIBLE                            @D61NDJK 20596461
*                                                              @D61NDJK 20611561
*                                                              @D61NDJK 20626661
***************************************************************         20641761
 AGO  .GUCCB                                                  *#SECURGL 20656861
.LUCCB   AIF ('&TEST'(1,14) NE 'CALL  TERUCCB ').LSCAN        *#SECURGL 20671961
 AIF   ('&I'(2,2)  NE '2 '                     ).DSINVC       *#SECURGL 20687061
 AIF   ('&O'(2,2)  EQ 'B '                     ).DSHEAD       *#SECURGL 20702161
 AGO  .DSINVC                                                 *#SECURGL 20717261
.GUCCB    ANOP                                                *#SECURGL 20732361
.**************************************************************         20747461
TERUCCB  SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 20762561
         USING ERBLKADR,R2                                     @D61NDJK 20777661
 SGTAP  'SGCOV ERPT610',NR=(05,0) TERUCCB ENTERED               TERUCCB 20792761
*                                                              @D61NDJK 20807861
*------------------------------------------------------------* @D61NDJK 20822961
*   RB WILL BE SET TO ZERO, IF WE ARE PROCESSING AN            @D61NDJK 20838061
*   UNSOLICITED INTERRUPT OR AT MINIMAL ERP LAYER.             @D61NDJK 20853161
*------------------------------------------------------------* @D61NDJK 20868261
*                                                              @D61NDJK 20883361
         SLR  RB,RB               ASSUME CCB NOT ACCESSIBLE    @D61NDJK 20898461
         OI   TEROEFLG,TEROEUCU   ASSUME IT ALSO IN FLAGBITS   @D61NDJK 20913561
*                                 MINIMAL ERP LAYER OR UN-..   @D61NDJK 20928661
         TM   TEROEFLG,TEROEMEL+TEROEUIC  SOLICITED INTERRUPT? @D61NDJK 20943761
         BNZ  TERUCEX             YES                          @D61NDJK 20958861
*                                                              @D61NDJK 20973961
*------------------------------------------------------------* @D61NDJK 20989061
*   OBTAIN THE ADDRESS OF THE USER'S CCB FROM THE INPUT        @D61NDJK 21004161
*   ERROR ENTRY AND CHECK IF THE USER CCB IS ACCESSIBLE.       @D61NDJK 21019261
*------------------------------------------------------------* @D61NDJK 21034361
*                                                              @D61NDJK 21049461
 SGTAP  'SGCOV ERPT610',NR=(05,1) START USER CCB VALIDATION     TERUCCB 21064561
         SLR  R8,R8               GET THE USER'S CCB..         @D61NDJK 21079661
         ICM  R8,B'0111',ERRQCCB+1  ADDRESS                    @D61NDJK 21094761
         BZ   TERUCEX             BRANCH IF USER IS POSTED     @D61NDJK 21109861
*                                                              @D61NDJK 21124961
*------------------------------------------------------------* @D61NDJK 21140061
*                                                              @D61NDJK 21155161
*   CHECK ADDRESSABILITY OF USER'S CCB.                        @D61NDJK 21170261
*                                                              @D61NDJK 21185361
*------------------------------------------------------------* @D61NDJK 21200461
*                                                              @D61NDJK 21215561
*------------------------------------------------------------* @D61NDJK 21230661
*   CHECK IF FIRST BYTE OF USER CCB CAN BE ADDRESSED.          @D61NDJK 21245761
*------------------------------------------------------------* @D61NDJK 21260861
*                                                              @D61NDJK 21275961
 SGTAP  'SGCOV ERPT610',NR=(05,2) ERRQCCB ADDR IS NOT ZERO      TERUCCB 21291061
 SGTAP  'CALL  TERCVTVR        ','CONVERT VIRTUAL TO REAL',    @D61NDJKX21306161
               I='8                 ON RETURN',                @D61NDJKX21321261
               O='F                 RF IS REAL OR 0 '          @D61NDJK 21336361
         LTR   RF,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 21351461
         BZ    TERUCEX            YES, EXIT WITH RB SET TO ZERO@D61NDJK 21366561
 SGTAP  'SGCOV ERPT610',NR=(05,3) 1.BYTE OF CCB IS ADDRESSABLE  TERUCCB 21381661
*                                                              @D61NDJK 21396761
*------------------------------------------------------------* @D61NDJK 21411861
*   CHECK IF LAST BYTE OF USER CCB CAN BE ADDRESSED.           @D61NDJK 21426961
*------------------------------------------------------------* @D61NDJK 21442061
*                                                              @D61NDJK 21457161
         LR    R1,R8              COULD THE OTHER..            @D61NDJK 21472261
         LA    RF,15(,R8)           PART OF THE CCB BE..       @D66ADAP 21487361
         N     RF,=A(-4096)         ON ANOTHER..               @D61NDJK 21512451
         N     R1,=A(-4096)         REAL PAGE..                @D61NDJK 21522441
         CR    RF,R1                IN MEMORY??                @D61NDJK 21532661
         BE    TERUC100           NO                           @D61NDJK 21547761
*                                                              @D61NDJK 21562861
 SGTAP  'SGCOV ERPT610',NR=(05,4) REST OF CCB IN ANOTHER PAGE   TERUCCB 21577961
         LA    R8,15(,R8)         POINT TO LAST BYTE OF CCB    @D66ADAP 21593061
 SGTAP  'CALL  TERCVTVR        ','CONVERT VIRTUAL TO REAL',    @D61NDJKX21608161
               I='8                 ON RETURN',                @D61NDJKX21623261
               O='F                 RF IS REAL OR 0 '          @D61NDJK 21638361
         LTR   RF,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 21653461
         BZ    TERUCEX            YES, EXIT WITH RB SET TO ZERO@D61NDJK 21668561
*                                                              @D61NDJK 21683661
*------------------------------------------------------------* @D61NDJK 21698761
*   USER CCB ADDRESS WAS VERIFIED SUCCESSFULLY AND CAN BE      @D61NDJK 21713861
*   PROVIDED IN OUTPUT REGISTER RB. BEFORE LEAVING TERUCCB,    @D61NDJK 21728961
*   SOME PROPERTIES OF THE USER CCB ARE PRESERVED.             @D61NDJK 21744061
*------------------------------------------------------------* @D61NDJK 21759161
*                                                              @D61NDJK 21774261
TERUC100 ICM   RB,B'0111',ERRQCCB+1                            @D61NDJK 21789361
         NI    TEROEFLG,XFF-TEROEUCU                           @D61NDJK 21804461
 SGTAP  'SGCOV ERPT610',NR=(05,5)          CCB IS ADDRESSABLE   TERUCCB 21819561
         TM    CCBBY3-CCBADR(RB),USENSE  IN SOME CASES,..      @D61SDJK 21821561
         BZ    TERUCEX                     RECOVERY BUT NO..   @D61SDJK 21823561
         OI    TEROEFLG,TEROESNS           MESSAGING MUST BE.. @D61SDJK 21825561
*                                          DONE (SVT TASK)     @D61SDJK 21827561
 SGTAP  'SGCOV ERPT610',NR=(05,6)        USER OWN SENSE IS SET  TERUCCB 21829561
*                                                              @D61NDJK 21834661
*------------------------------------------------------------* @D61NDJK 21849761
*   EXIT HANDLING.                                             @D61NDJK 21864861
*------------------------------------------------------------* @D61NDJK 21879961
*                                                              @D61NDJK 21895061
TERUCEX  SGTAP 'RETURN         ','RETURN TO CALLER         ',  @D61NDJKX21910161
               OUTPUT=(RB)                                     @D61NDJK 21925261
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 21940361
         LTORG                                                 @D61NDJK 21955461
         EJECT                                                 @D61NDJK 21970561
*                                                              @D61NDJK 21985661
***************************************************************         22000761
*  FUNCTION                                                    @D61NDJK 22015861
*    THIS ROUTINE SERVES TWO PURPOSES:                         @D61NDJK 22030961
*                                                              @D61NDJK 22046061
*      A) SCAN THE USER'S CHANNEL PROGRAM FOR THE LAST         @D61NDJK 22061161
*         OCCURRENCE OF A CERTAIN OPCODE BEFORE THE CCW        @D61NDJK 22076261
*         INDICATED AS THE FAILING CCW IN THE CSW.             @D61NDJK 22091361
*                                                              @D61NDJK 22106461
*         INPUT                                                @D61NDJK 22121561
*         - R1 CONTAINS THE ADDRESS OF A CCB.                  @D61NDJK 22136661
*         - R9 CONTAINS THE OPCODE WE ARE LOOKING FOR.         @D61NDJK 22151761
*                                                              @D61NDJK 22166861
*         OUTPUT ON RETURN TO RETURN+0                         @D61NDJK 22181961
*         - NONE. CHAIN WAS AMBIGUOUS OR OPCODE COULN'T BE     @D61NDJK 22197061
*           FOUND.                                             @D61NDJK 22212161
*                                                              @D61NDJK 22227261
*         OUTPUT ON RETURN TO RETURN+4                         @D61NDJK 22242361
*         - R5 CONTAINS THE ADDRESS OF THE CCW WE LOOKED FOR.  @D61NDJK 22257461
*              SEARCH WAS DONE UNTIL FAILING CCW HAS BEEN      @D61SDJK 22260461
*              REACHED.                                        @D61SDJK 22263461
*         - R6 CONTAINS THE ADDRESS OF THE CCW WE LOOKED FOR.  @D61SDJK 22266461
*              SEARCH WAS STOPPED IN FRONT OF THE FAILING CCW. @D61SDJK 22269461
*                                                              @D61NDJK 22272561
*      B) OBTAIN THE VIRTUAL FAILING CCW ADDRESS, THE VIRTUAL  @D61NDJK 22287661
*         AND REAL FAILING COMMAND CCW ADRESS AND THE OPCODE   @D61NDJK 22302761
*         OF THE FAILING COMMAND CCW.                          @D61NDJK 22317861
*                                                              @D61NDJK 22332961
*         INPUT                                                @D61NDJK 22348061
*         - R1 CONTAINS THE ADDRESS OF A CCB.                  @D61NDJK 22363161
*         - R9 SET TO ZERO.                                    @D61NDJK 22378261
*                                                              @D61NDJK 22393361
*         OUTPUT ON RETURN TO RETURN+0                         @D61NDJK 22408461
*         - NONE. CHAIN WAS AMBIGUOUS OR FAILING CCW           @D61NDJK 22423561
*           COULDN'T BE FOUND.                                 @D61NDJK 22438661
*                                                              @D61NDJK 22453761
*         OUTPUT ON RETURN TO RETURN+4                         @D61NDJK 22468861
*         - TERFCCWV CONTAINS THE VIRTUAL ADDRESS OF THE       @D61NDJK 22483961
*           FAILING CCW.                                       @D61NDJK 22499061
*         - TERCCCWV CONTAINS THE VIRTUAL ADDRESS OF THE       @D61NDJK 22544361
*           FAILING COMMAND CCW.                               @D61NDJK 22559461
*         - TERCCCWR CONTAINS THE REAL ADDRESS OF THE          @D61NDJK 22574561
*           FAILING COMMAND CCW.                               @D61NDJK 22589661
*         - TERCCCWO CONTAINS THE OPCODE OF THE FAILING        @D61NDJK 22604761
*           COMMAND CCW.                                       @D61NDJK 22619861
*                                                              @D61NDJK 22634961
***************************************************************         22650061
 AGO  .GSCAN                                                  *#SECURGL 22665161
.LSCAN   AIF ('&TEST'(1,14) NE 'CALL  TERSCAN ').LBUMP        *#SECURGL 22680261
 AIF   ('&I'(2,4)  NE '1,9 '                   ).DSINVC       *#SECURGL 22695361
 AIF   ('&O'(2,4)  NE '5,6 '                   ).DSINVC       *#SECURGL 22717451
 AIF   (T'&E0      NE 'O'                      ).DSHEAD       *#SECURGL 22725561
 AGO  .DSINVC                                                 *#SECURGL 22740661
.GSCAN    ANOP                                                *#SECURGL 22755761
.**************************************************************         22770861
TERSCAN  SGTAP 'HEADING         ','START OF CODEBLOCK'         @D61NDJK 22785961
         USING CCBADR,R1                                       @D61NDJK 22801061
 SGTAP  'SGCOV ERPT610',NR=(06,0) TERSCAN ENTERED               TERSCAN 22816161
*                                                              @D61NDJK 22831261
*------------------------------------------------------------* @D61NDJK 22846361
*                                                              @D61NDJK 22861461
*   DETERMINE RANGE IN USER'S CHANNEL PROGRAM WHERE SCANNING   @D61NDJK 22876561
*   SHOULD TAKE PLACE.                                         @D61NDJK 22891661
*                                                              @D61NDJK 22906761
*------------------------------------------------------------* @D61NDJK 22921861
*                                                              @D61NDJK 22936961
*------------------------------------------------------------* @D61NDJK 22952061
*   GET ENDING CCW ADDRESS FROM CSW AND VERIFY ADDRESSABILITY  @D61NDJK 22967161
*   OF FAILING CCW.                                            @D61NDJK 22982261
*------------------------------------------------------------* @D61NDJK 22997361
*                                                              @D61NDJK 23012461
         SLR   R8,R8              TAKE CSW CCW ADDRESS..       @D61NDJK 23027561
         ICM   R8,B'0111',CCBCSWW   FROM USER CCB              @D61NDJK 23042661
         BZ    TERSCEX0           TAKE ERROR EXIT..            @D61NDJK 23057761
*                                   IF NO ENDING CSW           @D61NDJK 23072861
 SGTAP  'SGCOV ERPT610',NR=(06,1) ENDING CCW IS AVAILABLE       TERSCAN 23087961
         S     R8,=F'8'           POINT TO FAILING CCW         @D61NDJK 23103061
 SGTAP  'CALL  TERCVTRV        ','CONVERT REAL TO VIRTUAL ',   @D61NDJKX23118161
               I='8                 ON RETURN',                @D61NDJKX23133261
               O='F                 RF =0 OR VIRTUAL ADDRESS'  @D61NDJK 23148361
         LTR   R7,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 23163461
         BZ    TERSCEX0           YES, TAKE ERROR EXIT         @D61NDJK 23178561
 SGTAP  'SGCOV ERPT610',NR=(06,2) FAILING CCW IS ADDRESSABLE    TERSCAN 23193661
*                                                              @D61NDJK 23208761
*------------------------------------------------------------* @D61NDJK 23223861
*   IF ROUTINE IS CALLED TO FIND ONLY THE FAILING CCW, SAVE    @D61NDJK 23238961
*   REAL AND VIRTUAL ADDRESS OF FAILING CCW.                   @D61NDJK 23254061
*------------------------------------------------------------* @D61NDJK 23269161
*                                                              @D61NDJK 23284261
         LTR   R9,R9              FAILING CCW HAS TO BE FOUND? @D61NDJK 23299361
         BNZ   TERSC100           NO                           @D61NDJK 23314461
         ST    R7,TERFCCWV        SAVE VIRT. FAILING CCW ADDR. @D61NDJK 23329561
*                                                              @D61NDJK 23359761
*------------------------------------------------------------* @D61NDJK 23374861
*   GET START ADDRESS OF USER CHANNEL PROGRAM FROM USER CCB    @D61NDJK 23389961
*   AND VERIFY ADDRESSABILITY.                                 @D61NDJK 23405061
*------------------------------------------------------------* @D61NDJK 23420161
*                                                              @D61NDJK 23435261
TERSC100 SLR   R8,R8              TAKE START OF CHANNEL..      @D61NDJK 23450361
         ICM   R8,B'0111',CCBCCW31+1 PROGRAM FROM USER CCB     @D66ADAP 23465461
 SGTAP  'CALL  TERCVTRV        ','CONVERT REAL TO VIRTUAL ',   @D61NDJKX23480561
               I='8                 ON RETURN',                @D61NDJKX23495661
               O='F                 RF =0 OR VIRTUAL ADDRESS'  @D61NDJK 23510761
         LTR   R8,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 23525861
         BZ    TERSCEX0           YES, TAKE ERROR EXIT         @D61NDJK 23540961
 SGTAP  'SGCOV ERPT610',NR=(06,3) FIRST USER CCW IS ADDRESSABLE TERSCAN 23556061
*                                                              @D61NDJK 23571161
*------------------------------------------------------------* @D61NDJK 23586261
*                                                              @D61NDJK 23601361
*   SCAN THE USER'S CHANNEL PROGRAM IN A LOOP.                 @D61NDJK 23616461
*                                                              @D61NDJK 23631561
*------------------------------------------------------------* @D61NDJK 23646661
*                                                              @D61NDJK 23661761
*------------------------------------------------------------* @D61NDJK 23676861
*   PREPARE WORK REGISTERS.                                    @D61NDJK 23691961
*------------------------------------------------------------* @D61NDJK 23707061
*                                                              @D61NDJK 23722161
.*  R8 POINTS TO THE ACTUAL CCW THAT IS ANALYZED NOW.          @D61NDJK 23737261
.*  R4 POINTS TO THE CCW THAT PRECEDES THE ACTUAL CCW.         @D61NDJK 23752361
.*  R5 POINTS TO THE LAST CCW THAT HAD THE OPCODE SPECIFIED    @D61NDJK 23767461
.*     IN R9 (SEARCH IS DONE UNTIL THE FAILING CCW IS REACHED).@D61SDJK 23788551
.*  R6 POINTS TO THE LAST CCW THAT HAD THE OPCODE SPECIFIED    @D61SDJK 23794541
.*     IN R9 (SEARCH IS STOPPED IN FRONT OF THE FAILING CCW).  @D61SDJK 23800531
.*  RB CONTAINS A LOOP COUNTER. IF RB HAS BEEN COUNTED DOWN    @D61SDJK 23806521
.*     TO ZERO, SCANNING WILL BE TERMINATED.                   @D61NDJK 23812761
.*                                                             @D61NDJK 23827861
         USING CCWADR,R8          POINT TO ACTUAL CCW          @D61NDJK 23842961
         SLR   R5,R5              CLEAR POINTERS TO..          @D61SDJK 23863051
         SLR   R6,R6                PRECEDING CCWS             @D61SDJK 23868041
         LA    R4,=XL8'00'        POINT TO DUMMY CCW W/O DC ON @D61NDJK 23873161
         LA    RB,4095            SET LIMIT FOR INFINITE LOOP  @D61SDJK 23895251
         B     TERSC300           BEGIN WITH LOOP              @D61NDJK 23903361
*                                                              @D61NDJK 23918461
*------------------------------------------------------------* @D61NDJK 23933561
*   BUMP TO THE NEXT CCW IN THE CHANNEL PROGRAM.               @D61NDJK 23948661
*------------------------------------------------------------* @D61NDJK 23963761
*                                                              @D61NDJK 23978861
TERSC200 LR    R4,R8              PRESERVE CURRENT CCW POINTER @D61NDJK 23993961
*                                                              @D61NDJK 24009061
 SGTAP  'CALL  TERBUMP         ','BUMP TO NEXT CCW ',          @D61NDJKX24024161
               I='8                 ON RETURN TO +12',         @D61NDJKX24039261
               O='8                 R8 POINTS TO NEXT CCW',    @D61NDJKX24054361
               E0='TERSCEX0         ERROR: NOT ADDRESSABLE',   @D61NDJKX24069461
               E4='TERSC250         ERROR: CHAIN ENDED',       @D61NDJKX24084561
               E8='TERSC230         ERROR: TWO TICS'           @D61NDJK 24099661
*                                                              @D61NDJK 24114761
 SGTAP  'SGCOV ERPT610',NR=(06,4) BUMP TO NEXT CCW SUCCESSFUL   TERSCAN 24129861
         B     TERSC300                                        @D61NDJK 24144961
*                                                              @D61NDJK 24146461
*------------------------------------------------------------* @D61NDJK 24147961
*   WE FOUND TWO CONSECUTIVE TICS AND THE FAILING CCW ADDRESS  @D61NDJK 24149461
*   HAS NOT BEEN REACHED.                                      @D61NDJK 24150961
*------------------------------------------------------------* @D61NDJK 24152461
*                                                              @D61NDJK 24153961
TERSC230 LTR   R9,R9              FAILING CCW HAS TO BE FOUND? @D61NDJK 24155461
         BNZ   TERSCEX0           NO, TAKE ERROR EXIT          @D61NDJK 24156961
         B     TERSC320           YES, SAVE CCW INFORMATION    @D61NDJK 24158461
*                                                              @D61NDJK 24160061
*------------------------------------------------------------* @D61NDJK 24175161
*   WE RAN OUT OF CHANNEL PROGRAM BUT THE FAILING CCW ADDRESS  @D61NDJK 24190261
*   HAS NOT BEEN REACHED.                                      @D61NDJK 24212861
*------------------------------------------------------------* @D61NDJK 24235561
*                                                              @D61NDJK 24250661
TERSC250 LTR   R9,R9              FAILING CCW HAS TO BE FOUND? @D61NDJK 24265761
         BNZ   TERSCEX0           NO, TAKE ERROR EXIT          @D61NDJK 24280861
*                                                              @D61NDJK 24295961
*------------------------------------------------------------* @D61NDJK 24296661
*   IF IT IS POSSIBLE TO FIND THE BEGINNING OF THE CHANNEL     @D61NDJK 24297361
*   PROGRAM BY SCANNING THE CCW CHAIN STARTING WITH THE        @D61NDJK 24298061
*   FAILING CCW, THE FAILING CCW IS A PREFIX CCW.              @D61NDJK 24298761
*------------------------------------------------------------* @D61NDJK 24299461
*                                                              @D61NDJK 24300161
 SGTAP  'SGCOV ERPT610',NR=(06,5) TRY TO FIND THE 1ST USER CCW  TERSCAN 24300861
         LA    RB,5               SET LIMIT FOR INFINITE LOOP  @D61SDJK 24301851
         L     R8,TERFCCWV        TAKE FAILING CCW ADDRESS     @D61NDJK 24302261
*                                                              @D61NDJK 24302961
TERSC260 DS    0H                                              @D61NDJK 24303661
 SGTAP  'CALL  TERBUMP         ','BUMP TO NEXT CCW ',          @D61NDJKX24304361
               I='8                 ON RETURN TO +12',         @D61NDJKX24305061
               O='8                 R8 POINTS TO NEXT CCW',    @D61NDJKX24305761
               E0='TERSCEX0         ERROR: NOT ADDRESSABLE',   @D61NDJKX24306461
               E4='TERSC290         ERROR: CHAIN ENDED',       @D61NDJKX24307161
               E8='TERSCEX0         ERROR: TWO TICS'           @D61NDJK 24307861
*                                                              @D61NDJK 24308561
 SGTAP  'SGCOV ERPT610',NR=(06,6) BUMP TO NEXT CCW SUCCESSFUL   TERSCAN 24309261
 SGTAP  'CALL  TERCVTVR        ','CONVERT VIRTUAL TO REAL',    @D61NDJKX24309961
               I='8                 ON RETURN',                @D61NDJKX24310661
               O='F                 RF IS REAL OR 0 '          @D61NDJK 24311361
         LTR   RF,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 24312061
         BZ    TERSCEX0           YES                          @D61NDJK 24312761
*                                                              @D61NDJK 24313461
         CLM   RF,7,CCBCCW31+1    IT IS 1ST CCW IN CCW CHAIN?  @D66ADAP 24314861
         BE    TERSC280           YES                          @D61NDJK 24315561
*                                                              @D61NDJK 24316261
 SGTAP  'SGCOV ERPT610',NR=(06,7) NO PUBX PREFIX CCWS           TERSCAN 24316961
         BCT   RB,TERSC260        BUMP TO THE NEXT CCW         @D61SDJK 24318041
 SGTAP  'SGCOV ERPT610',NR=(07,0) FAILING CCW IS NO PREFIX CCW  TERSCAN 24318361
         B     TERSCEX0           FAILING CCW IS NO PREFIX CCW @D61NDJK 24319061
*                                                              @D61NDJK 24319761
TERSC280 OI    TERFLG,TERCVPRF    FAILING CCW IS A PREFIX CCW  @D61NDJK 24320461
         MVC   TERCCCWV,TERFCCWV  SAVE VIRTUAL ADDRESS..       @D61NDJK 24326161
         L     R8,TERFCCWV          AND OPCODE OF..            @D61NDJK 24341261
         MVC   TERCCCWO,CCWCODE     FAILING COMMAND CCW        @D61NDJK 24356361
 SGTAP  'SGCOV ERPT610',NR=(07,1) FAILING CCW IS A PREFIX CCW   TERSCAN 24357461
         B     TERSCEX4           TAKE REGULAR EXIT            @D61NDJK 24358561
*                                                              @D61NDJK 24359661
*------------------------------------------------------------* @D61NDJK 24360761
*   IF THE FAILING CCW ISN'T FOUND YET, THERE IS STILL ONE     @D61NDJK 24361861
*   POSSIBILTY: WHEN A OPERATOR HAS ISSUED THE AR COMMAND      @D61NDJK 24362961
*   TAPE UNL=REW, A REWIND UNLOAD CCW IS NOT EXECUTED, BUT     @D61NDJK 24364061
*   INSTEAD A SINGLE PUBX REWIND CCW IS STARTED BY IOS.        @D61NDJK 24365161
*------------------------------------------------------------* @D61NDJK 24366261
*                                                              @D61NDJK 24367361
TERSC290 CLI   0(R8),REWIND       FAILING CCW IS A REWIND CCW? @D61NDJK 24368461
         BNE   TERSCEX0           NO, TAKE ERROR EXIT          @D61NDJK 24369561
*                                                              @D61NDJK 24370661
         L     R5,TERAPUBX        GET PUBX POINTER             @D61NDJK 24371761
         USING PBXADR,R5          DECLARE PUBX BASE POINTER    @D61NDJK 24372861
*                                                              @D61NDJK 24373961
         C     R8,PBXCCW          IT IS REWIND CCW FROM PUBX?  @D61NDJK 24375061
         BNE   TERSCEX0           NO                           @D61NDJK 24376161
         DROP  R5                 RELEASE PUBX BASE            @D61NDJK 24377261
*                                                              @D61NDJK 24378361
 SGTAP  'SGCOV ERPT610',NR=(07,2) FAILING CCW IS PUBX REW CCW   TERSCAN 24379461
         OI    TERFLG,TERCVPRF+TERCVREW FAILING CCW IS A..     @D61NDJK 24380561
*                                         PREFIXED REWIND CCW  @D61NDJK 24381661
         MVC   TERCCCWV,TERFCCWV  SAVE VIRTUAL ADDRESS AND..   @D61NDJK 24382761
         MVI   TERCCCWO,REWIND      OPCODE OF FAILING CMD CCW  @D61NDJK 24383861
         B     TERSCEX4           TAKE REGULAR EXIT            @D61NDJK 24386561
*                                                              @D61NDJK 24401661
*------------------------------------------------------------* @D61NDJK 24416761
*   IF ROUTINE IS CALLED TO FIND ONLY THE FAILING CCW, IT      @D61NDJK 24431861
*   MIGHT BE NECESSARY TO SAVE THE POTENTIAL VIRTUAL ADDRESS   @D61NDJK 24446961
*   OF THE FAILING COMMAND CCW.                                @D61NDJK 24462061
*------------------------------------------------------------* @D61NDJK 24477161
*                                                              @D61NDJK 24492261
TERSC300 TM    CCWCHAIN-CCWADR(R4),DC  PRECEDING CCW HAS DC ON?@D61NDJK 24507361
         BO    TERSC400                YES                     @D61NDJK 24522461
         LTR   R9,R9              FAILING CCW HAS TO BE FOUND? @D61NDJK 24537561
         BNZ   TERSC350           NO                           @D61NDJK 24552661
*                                                              @D61NDJK 24567761
TERSC320 ST    R8,TERCCCWV        SAVE VIRTUAL CMD. CCW ADDR.  @D61NDJK 24582861
         MVC   TERCCCWO,0(R8)     SAVE OPCODE OF COMMAND CCW   @D61NDJK 24597961
 SGTAP  'SGCOV ERPT610',NR=(07,3) A COMMAND CCW WAS FOUND       TERSCAN 24613061
         B     TERSC400                                        @D61NDJK 24628161
*                                                              @D61NDJK 24643261
*------------------------------------------------------------* @D61NDJK 24658361
*   IF ROUTINE IS CALLED TO FIND A CCW THAT HAS THE OPCODE     @D61NDJK 24673461
*   SPECIFIED IN R9, IT MIGHT BE NECESSARY TO SAVE A NEW       @D61NDJK 24688561
*   ADDRESS OF A COMMAND CCW WITH THAT OPCODE.                 @D61NDJK 24703661
*------------------------------------------------------------* @D61NDJK 24718761
*                                                              @D61NDJK 24733861
TERSC350 CLM   R9,1,CCWCODE       ACTUAL CCW HAS SPEC. OPCODE? @D61NDJK 24748961
         BNE   TERSC400           NO                           @D61NDJK 24764061
*                                 ACTUAL CCW POINTER REACHED.. @D61SDJK 24785141
         CR    R8,R7                ADDRESS GIVEN IN CSW?      @D61SDJK 24788131
         BE    TERSC380           YES                          @D61SDJK 24791121
         LR    R6,R8              SAVE POINTER TO ACTUAL CCW   @D61SDJK 24797101
TERSC380 LR    R5,R8              SAVE POINTER TO ACTUAL CCW   @D61SDJK 24800091
 SGTAP  'SGCOV ERPT610',NR=(07,4) SEARCHED OPCODE FOUND         TERSCAN 24809361
*                                                              @D61NDJK 24824461
*------------------------------------------------------------* @D61NDJK 24839561
*   DO LOOP WHILE THE FAILING CCW ADDRESS INDICATED IN THE     @D61NDJK 24854661
*   CSW IS NOT REACHED AND THE LOOP COUNTER IS NOT EXHAUSTED.  @D61NDJK 24869761
*------------------------------------------------------------* @D61NDJK 24884861
*                                 ACTUAL CCW POINTER REACHED.. @D61NDJK 24899961
TERSC400 CR    R8,R7                ADDRESS GIVEN IN CSW?      @D61NDJK 24915061
         BE    TERSCEX            YES                          @D61NDJK 24930161
         BCT   RB,TERSC200        DO LOOP ONCE MORE IF LOOP..  @D61SDJK 24955241
*                                   COUNTER IS NOT EXHAUSTED   @D61NDJK 24960361
 SGTAP  'SGCOV ERPT610',NR=(07,5) LOOP COUNTER IS EXHAUSTED     TERSCAN 24975461
*                                                              @D61NDJK 24990561
*------------------------------------------------------------* @D61NDJK 25005661
*                                                              @D61NDJK 25020761
*   EXIT HANDLING.                                             @D61NDJK 25035861
*                                                              @D61NDJK 25050961
*------------------------------------------------------------* @D61NDJK 25066061
*                                                              @D61NDJK 25081161
*------------------------------------------------------------* @D61NDJK 25096261
*   ERROR EXIT.                                                @D61NDJK 25111361
*------------------------------------------------------------* @D61NDJK 25126461
*                                                              @D61NDJK 25141561
TERSCEX0 DS    0H                                              @D61NDJK 25156661
 SGTAP  'SGCOV ERPT610',NR=(07,6) ERROR EXIT SELECTED           TERSCAN 25171761
         SGTAP 'RETURN         ','RETURN BUT COULDNT FIND IT.' @D61NDJK 25186861
*                                                              @D61NDJK 25201961
*------------------------------------------------------------* @D61NDJK 25217061
*   SELECT APPROPRIATE EXIT.                                   @D61NDJK 25232161
*------------------------------------------------------------* @D61NDJK 25247261
*                                                              @D61NDJK 25262361
TERSCEX  LTR   R9,R9              FAILING CCW HAS TO BE FOUND? @D61NDJK 25277461
         BZ    TERSCEX4           YES, TAKE REGULAR EXIT       @D61NDJK 25292561
         LTR   R5,R5              CCW WITH SPEC. OPCODE FOUND? @D61NDJK 25307661
         BZ    TERSCEX0           NO, TAKE ERROR EXIT          @D61NDJK 25322761
*                                                              @D61NDJK 25337861
*------------------------------------------------------------* @D61NDJK 25352961
*   NORMAL EXIT, IF LAST ADDRESS CONVERSION DOES NOT FAIL.     @D61NDJK 25368061
*------------------------------------------------------------* @D61NDJK 25383161
*                                                              @D61NDJK 25398261
TERSCEX4 L     R8,TERCCCWV          COMMAND CCW ADDRESS        @D61NDJK 25413361
 SGTAP  'CALL  TERCVTVR        ','CONVERT VIRTUAL TO REAL ',   @D61NDJKX25428461
               I='8                 ON RETURN',                @D61NDJKX25443561
               O='F                 RF =0 OR REAL ADDRESS'     @D61NDJK 25458661
         LTR   R8,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 25473761
         BZ    TERSCEX0           YES                          @D61NDJK 25488861
*                                 SAVE REAL FAILING..          @D61NDJK 25503961
         ST    R8,TERCCCWR          COMMAND CCW ADDRESS        @D61NDJK 25534161
 SGTAP  'SGCOV ERPT610',NR=(07,7) FAIL. CMD. CCW IS ADDRESSABLE TERSCAN 25541161
         SGTAP 'RETURN4        ','RETURN AND COULD FIND IT',   @D61NDJKX25549261
               OUTPUT=(R5,R6)                                  @D61NDJK 25571351
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 25579461
         LTORG                                                 @D61NDJK 25594561
         EJECT                                                 @D61NDJK 25609661
*                                                              @D61NDJK 25624761
***************************************************************         25639861
*  FUNCTION                                                    @D61NDJK 25654961
*    BUMP TO THE NEXT CCW, SKIPPING TICS.                      @D61NDJK 25670061
*                                                              @D61NDJK 25685161
*  INPUT                                                       @D61NDJK 25700261
*    - R8 CONTAINS A VIRTUAL CCW ADDRESS.                      @D61NDJK 25715361
*                                                              @D61NDJK 25730461
*  OUTPUT ON RETURN TO RETURN+0                                @D61NDJK 25745561
*    - NONE. THE FOLLOWING CCW IS NOT ADDRESSABLE.             @D61NDJK 25760661
*                                                              @D61NDJK 25775761
*  OUTPUT ON RETURN TO RETURN+4                                @D61NDJK 25790861
*    - NONE. INPUT CCW IS LAST CCW IN CHANNEL PROGRAM.         @D61NDJK 25805961
*                                                              @D61NDJK 25821061
*  OUTPUT ON RETURN TO RETURN+8                                @D61NDJK 25836161
*    - THE NEXT TWO FOLLOWING CCWS ARE BOTH TICS.              @D61NDJK 25851261
*      R8 CONTAINS THE VIRTUAL ADDRESS OF THE SECOND TIC CCW.  @D61NDJK 25866361
*                                                              @D61NDJK 25881461
*  OUTPUT ON RETURN TO RETURN+12                               @D61NDJK 25896561
*    - R8 CONTAINS THE VIRTUAL ADDRESS OF THE FOLLOWING CCW.   @D61NDJK 25911661
*                                                              @D61NDJK 25926761
***************************************************************         25941861
 AGO  .GBUMP                                                  *#SECURGL 25956961
.LBUMP   AIF ('&TEST'(1,14) NE 'CALL  TERBUMP ').LEVAL        *#SECURGL 25972061
 AIF   ('&I'(2,2)  NE '8 '                     ).DSINVC       *#SECURGL 25987161
 AIF   ('&O'(2,2)  NE '8 '                     ).DSINVC       *#SECURGL 26002261
 AIF   (T'&E0      EQ 'O'                      ).DSINVC       *#SECURGL 26017361
 AIF   (T'&E4      EQ 'O'                      ).DSINVC       *#SECURGL 26032461
 AIF   (T'&E8      NE 'O'                      ).DSHEAD       *#SECURGL 26047561
 AGO  .DSINVC                                                 *#SECURGL 26062661
.GBUMP    ANOP                                                *#SECURGL 26077761
.**************************************************************         26092861
TERBUMP  SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 26107961
*                                                              @D61NDJK 26123061
 SGTAP  'SGCOV ERPT610',NR=(08,0) TERBUMP ENTERED               TERBUMP 26138161
*                                                              @D61NDJK 26153261
*------------------------------------------------------------* @D61NDJK 26168361
*   IF CURRENT CCW IS NO TIC, BUMP TO NEXT CCW AND VERIFY      @D61NDJK 26183461
*   ITS ADDRESSABILITY.                                        @D61NDJK 26198561
*------------------------------------------------------------* @D61NDJK 26213661
*                                                              @D61NDJK 26228761
         LR    R5,R8              SAVE CURRENT..               @D61NDJK 26243861
         LR    R7,R8                CCW ADDRESS                @D61NDJK 26258961
         TM    0(R5),X'0F'-TIC    CURRENT CCW CAN BE A TIC?    @D61NDJK 26274061
         BNZ   TERBU100           NO                           @D61NDJK 26289161
         TM    0(R5),TIC          IT IS A TIC FOR SURE?        @D61NDJK 26304261
         BO    TERBU300           YES                          @D61NDJK 26319361
*                                                              @D61NDJK 26334461
TERBU100 LA    R8,8(,R8)          BUMP TO NEXT VIRTUAL CCW     @D61NDJK 26349561
         TM    CCWCHAIN-CCWADR(R5),CC+DC  THERE IS A NEXT ONE? @D61NDJK 26364661
         BZ    TERBUEX4                   NO, END OF CCW CHAIN @D61NDJK 26379761
 SGTAP  'SGCOV ERPT610',NR=(08,1) BUMPED TO NEXT CCW IN VIRTUAL TERBUMP 26394861
*                                                              @D61NDJK 26409961
         LR    R6,R8              COULD THE NEXT..             @D61NDJK 26425061
         N     R5,=A(-4096)         CCW BE ON..                @D61NDJK 26450151
         N     R6,=A(-4096)         ANOTHER REAL..             @D61NDJK 26460141
         CR    R5,R6                PAGE IN MEMORY?            @D61NDJK 26470361
         BE    TERBU200           NO                           @D61NDJK 26492451
*                                                              @D61NDJK 26500561
*------------------------------------------------------------* @D61NDJK 26515661
*   THE NEXT CCW IS ON ANOTHER REAL PAGE IN MEMORY. TRY TO     @D61NDJK 26530761
*   FOLLOW THE CHAIN IN REAL STORAGE.                          @D61NDJK 26545861
*------------------------------------------------------------* @D61NDJK 26560961
*                                                              @D61NDJK 26576061
 SGTAP  'SGCOV ERPT610',NR=(08,2) NEXT CCW IS ON ANOTHER PAGE   TERBUMP 26591161
         LR    R8,R7              RESTORE OLD CURRENT CCW ADDR.@D61NDJK 26606261
 SGTAP  'CALL  TERCVTVR        ','CONVERT VIRTUAL TO REAL',    @D61NDJKX26621361
               I='8                 ON RETURN',                @D61NDJKX26636461
               O='F                 RF =0 OR REAL ADDRESS'     @D61NDJK 26651561
         LTR   R8,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 26666661
         BZ    TERBUEX0           YES, TAKE ERROR EXIT         @D61NDJK 26681761
*                                                              @D61NDJK 26696861
         LA    R8,8(,R8)          BUMP TO NEXT CCW IN REAL     @D61NDJK 26711961
 SGTAP  'SGCOV ERPT610',NR=(08,3) BUMPED TO NEXT CCW IN REAL    TERBUMP 26727061
 SGTAP  'CALL  TERCVTRV        ','CONVERT REAL TO VIRTUAL ',   @D61NDJKX26752151
               I='8                 ON RETURN',                @D61NDJKX26762141
               O='F                 RF =0 OR VIRTUAL ADDRESS'  @D61NDJK 26772361
         LTR   R8,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 26787461
         BZ    TERBUEX0           YES, TAKE ERROR EXIT         @D61NDJK 26802561
*                                                              @D61NDJK 26817661
*------------------------------------------------------------* @D61NDJK 26832761
*   IF NEW CURRENT CCW IS NO TIC, A VALID CCW ADDRESS CAN      @D61NDJK 26847861
*   BE RETURNED.                                               @D61NDJK 26862961
*------------------------------------------------------------* @D61NDJK 26878061
*                                                              @D61NDJK 26893161
TERBU200 TM    0(R8),X'0F'-TIC    NEW CURRENT CCW CAN BE A TIC?@D61NDJK 26908261
         BNZ   TERBUEXC           NO, TAKE REGULAR EXIT        @D61NDJK 26923361
         TM    0(R8),TIC          IT IS A TIC FOR SURE?        @D61NDJK 26938461
         BNO   TERBUEXC           NO, TAKE REGULAR EXIT        @D61NDJK 26953561
*                                                              @D61NDJK 26968661
*------------------------------------------------------------* @D61NDJK 26983761
*   IF CURRENT CCW IS A TIC, WE MUST FOLLOW THE CCW CHAIN      @D61NDJK 26998861
*   TO THE NEXT CCW AND VERIFY ITS ADDRESSABILITY.             @D61NDJK 27013961
*------------------------------------------------------------* @D61NDJK 27029061
*                                 TAKE TIC TARGET ADDRESS..    @D61NDJK 27044161
TERBU300 ICM   R8,B'0111',CCWBUF+1-CCWADR(R8)  AS NEW CCW..    @D61NDJK 27059261
         ICM   R8,B'1000',=X'00'               ADDRESS         @D61NDJK 27074361
 SGTAP  'SGCOV ERPT610',NR=(08,4) FOLLOW TIC                    TERBUMP 27089461
 SGTAP  'CALL  TERCVTRV        ','CONVERT REAL TO VIRTUAL',    @D61NDJKX27104561
               I='8                 ON RETURN',                @D61NDJKX27119661
               O='F                 RF =0 OR VIRTUAL ADDRESS'  @D61NDJK 27134761
         LTR   R8,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 27149861
         BZ    TERBUEX0           YES, TAKE ERROR EXIT         @D61NDJK 27164961
*                                                              @D61NDJK 27180061
         TM    0(R8),X'0F'-TIC    NEW CURRENT CCW CAN BE A TIC?@D61NDJK 27195161
         BNZ   TERBUEXC           NO, TAKE REGULAR EXIT        @D61NDJK 27210261
         TM    0(R8),TIC          IT IS A TIC FOR SURE?        @D61NDJK 27225361
         BNO   TERBUEXC           NO, TAKE REGULAR EXIT        @D61NDJK 27240461
         B     TERBUEX8           TAKE ERROR EXIT              @D61NDJK 27255561
*                                                              @D61NDJK 27270661
*------------------------------------------------------------* @D61NDJK 27285761
*                                                              @D61NDJK 27300861
*   EXIT HANDLING.                                             @D61NDJK 27315961
*                                                              @D61NDJK 27331061
*------------------------------------------------------------* @D61NDJK 27346161
*                                                              @D61NDJK 27361261
*------------------------------------------------------------* @D61NDJK 27376361
*   ERROR EXITS.                                               @D61NDJK 27391461
*------------------------------------------------------------* @D61NDJK 27406561
*                                                              @D61NDJK 27421661
TERBUEX0 DS    0H                                              @D61NDJK 27436761
 SGTAP  'SGCOV ERPT610',NR=(08,5) ERROR EXIT - ADDRESSABILITY   TERBUMP 27451861
         SGTAP 'RETURN         ','RETURN NOT ADDRESSABLE   '   @D61NDJK 27466961
*                                                              @D61NDJK 27482061
TERBUEX4 DS    0H                                              @D61NDJK 27497161
 SGTAP  'SGCOV ERPT610',NR=(08,6) ERROR EXIT - END OF CCW CHAIN TERBUMP 27512261
         SGTAP 'RETURN4        ','RETURN END OF CHAIN REACHED' @D61NDJK 27527361
*                                                              @D61NDJK 27542461
TERBUEX8 DS    0H                                              @D61NDJK 27557561
 SGTAP  'SGCOV ERPT610',NR=(08,7) ERROR EXIT - TWO CONSEC. TICS TERBUMP 27572661
         SGTAP 'RETURN8        ','RETURN 2 CONSECUTIVE TICS',  @D61NDJKX27587761
               OUTPUT=(R8)                                     @D61NDJK 27602861
*                                                              @D61NDJK 27617961
*------------------------------------------------------------* @D61NDJK 27633061
*   NORMAL EXIT.                                               @D61NDJK 27648161
*------------------------------------------------------------* @D61NDJK 27663261
*                                                              @D61NDJK 27678361
TERBUEXC SGTAP 'RETURN12       ','RETURN NORMAL            ',  @D61NDJKX27693461
               OUTPUT=(R8)                                     @D61NDJK 27708561
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 27733651
         LTORG                                                 @D61NDJK 27743641
         EJECT                                                 @D61NDJK 27753861
*                                                              @D61NDJK 27768961
***************************************************************         27784061
*  FUNCTION                                                    @D61NDJK 27799161
*    EVALUATE SENSE DATA AND ERROR CSW AND DETERMINE           @D61NDJK 27814261
*    A MAIN ERROR CLASSIFICATION CODE.                         @D61NDJK 27829361
*                                                              @D61NDJK 27844461
*    SUBROUTINE TEREVAL IS CALLING ANOTHER SUBROUTINE          @D61NDJK 27859561
*    THAT IS SOMEWHAT EXTERNAL TO SGTAP. IT IS THE TERFAST     @D61NDJK 27874661
*    ROUTINE, WHICH MAY ALSO BE ENTERED BY THE SENSE TASK      @D61SDJK 27895951
*    IMMEDIATELY AFTER IT RETRIEVED THE SENSE DATA.            @D61SDJK 27905941
*                                                              @D61NDJK 27919961
*  INPUT                                                       @D61NDJK 27935061
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61SDJK 27942061
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 27950161
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61SDJK 27955161
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61SDJK 27960161
*                                                              @D61NDJK 27965261
*  OUTPUT                                                      @D61NDJK 27980361
*    - TERMECC IS SET WITH A MAIN ERROR CLASSIFICATION CODE.   @D61NDJK 27995461
*                                                              @D61NDJK 28010561
***************************************************************         28025661
 AGO  .GEVAL                                                  *#SECURGL 28040761
.LEVAL   AIF ('&TEST'(1,14) NE 'CALL  TEREVAL ').LNEWT        *#SECURGL 28065851
 AIF   ('&I'(2,8)  NE '1,2,3,B '               ).DSINVC       *#SECURGL 28075841
 AIF   ('&O'(2,4)  EQ 'NONE'                   ).DSHEAD       *#SECURGL 28086061
 AGO  .DSINVC                                                 *#SECURGL 28101161
.GEVAL    ANOP                                                *#SECURGL 28116261
.**************************************************************         28131361
TEREVAL  SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 28146461
         USING CCBADR,R1                                       @D61SDJK 28164551
         USING ERBLKADR,R2                                     @D61SDJK 28167541
         USING PUBADR,R3                                       @D61SDJK 28170531
 SGTAP  'SGCOV ERPT610',NR=(09,0) TEREVAL ENTERED               TEREVAL 28176661
*                                                              @D61NDJK 28191761
*------------------------------------------------------------* @D61NDJK 28206861
*                                                              @D61NDJK 28221961
*   EVALUATE ERROR CSW                                         @D61NDJK 28237061
*                                                              @D61NDJK 28252161
*------------------------------------------------------------* @D61NDJK 28267261
*                                                              @D61NDJK 28282361
         LA    R5,TERIMPEC        ASSUME MECC "IMPOSS. ERROR"  @D61NDJK 28297461
*                                                              @D61NDJK 28312561
*------------------------------------------------------------* @D61NDJK 28327661
*   ERROR CONDITION IS DEVICE NOT OPERATIONAL.                 @D61NDJK 28342761
*------------------------------------------------------------* @D61NDJK 28357861
*                                                              @D61NDJK 28372961
         CLI   ERRQCSW+5,X'FE'    DEVICE NOT OPERATIONAL?      @D61NDJK 28388061
         BNE   TEREV010           NO                           @D61NDJK 28403161
 SGTAP  'SGCOV ERPT610',NR=(09,1) MECC IS TERNOTOP              TEREVAL 28418261
         LA    R5,TERNOTOP        SET MECC TO "DEVICE NOT..    @D61NDJK 28433361
         B     TEREVEX              OPERATIONAL"               @D61NDJK 28448461
*                                                              @D61NDJK 28463561
*------------------------------------------------------------* @D61NDJK 28478661
*   ERROR CONDITION IS CHANNEL DATA CHECK WITHOUT              @D61NDJK 28493761
*   ACCOMPANYING UNIT CHECK (3480-TYPE TAPE DEVICES ONLY).     @D61SDJK 28513851
*   CHANNEL DATA CHECKS ON TPA DEVICES ARE HANDLED BY RAS.     @D61SDJK 28518841
*------------------------------------------------------------* @D61NDJK 28523961
*                                                              @D61NDJK 28539061
TEREV010 TM    ERRQCSW+5,X'08'    CHANNEL DATA CHECK?          @D61NDJK 28554161
         BZ    TEREV020           NO                           @D61NDJK 28569261
         CLI   TERDEVTY,TERTPA    IT IS A TPA DEVICE?          @D61SDJK 28573261
         BNL   TEREVEX            YES, LEAVE MECC SET TO       @D61SDJK 28575261
*                                 "IMPOSSIBLE ERROR CONDITION" @D61SDJK 28577261
         TM    ERRQCSW+4,UNITCK   UNIT CHECK?                  @D61NDJK 28584361
         BO    TEREV020           YES                          @D61NDJK 28599461
 SGTAP  'SGCOV ERPT610',NR=(09,2) MECC IS TERCDCHK              TEREVAL 28614561
         LA    R5,TERCDCHK        SET MECC TO "CHANNEL DATA..  @D61NDJK 28629661
         B     TEREVEX              CHECK W/O UNIT CHECK"      @D61NDJK 28644761
*                                                              @D61NDJK 28659861
*------------------------------------------------------------* @D61NDJK 28674961
*   ERROR CONDITION IS CHAINING CHECK WITHOUT ACCOMPANYING     @D61NDJK 28690061
*   UNIT CHECK (3480-TYPE TAPE DEVICES ONLY). CHANNEL          @D61SDJK 28710151
*   CHAINING CHECKS ON TPA DEVICES ARE HANDLED BY RAS.         @D61SDJK 28715141
*------------------------------------------------------------* @D61NDJK 28720261
*                                                              @D61NDJK 28735361
TEREV020 TM    ERRQCSW+5,X'01'    CHAINING CHECK?              @D61NDJK 28750461
         BZ    TEREV030           NO                           @D61NDJK 28765561
         CLI   TERDEVTY,TERTPA    IT IS A TPA DEVICE?          @D61SDJK 28769561
         BNL   TEREVEX            YES, LEAVE MECC SET TO       @D61SDJK 28771561
*                                 "IMPOSSIBLE ERROR CONDITION" @D61SDJK 28773561
         TM    ERRQCSW+4,UNITCK   UNIT CHECK?                  @D61NDJK 28780661
         BO    TEREV030           YES                          @D61NDJK 28795761
 SGTAP  'SGCOV ERPT610',NR=(09,3) MECC IS TERCCHK               TEREVAL 28810861
         LA    R5,TERCCHK         SET MECC TO "CHAINING..      @D61NDJK 28825961
         B     TEREVEX              CHECK W/O UNIT CHECK"      @D61NDJK 28841061
*                                                              @D61NDJK 28856161
*------------------------------------------------------------* @D61NDJK 28871261
*   ERROR CONDITION IS CHANNEL PROGRAM CHECK.                  @D61NDJK 28886361
*------------------------------------------------------------* @D61NDJK 28901461
*                                                              @D61NDJK 28916561
TEREV030 TM    ERRQCSW+5,X'20'    PROGRAM CHECK?               @D61NDJK 28931661
         BZ    TEREV040           NO                           @D61NDJK 28946761
 SGTAP  'SGCOV ERPT610',NR=(09,4) MECC IS TERPGCHK              TEREVAL 28961861
         LA    R5,TERPGCHK        SET MECC TO "CHANNEL..       @D61NDJK 28976961
         B     TEREVEX              PROGRAM CHECK"             @D61NDJK 28992061
*                                                              @D61NDJK 29007161
*------------------------------------------------------------* @D61NDJK 29022261
*   ERROR CONDITION IS CHANNEL PROTECTION CHECK.               @D61NDJK 29037361
*------------------------------------------------------------* @D61NDJK 29052461
*                                                              @D61NDJK 29067561
TEREV040 TM    ERRQCSW+5,X'10'    PROTECTION CHECK?            @D61NDJK 29082661
         BZ    TEREV050           NO                           @D61NDJK 29097761
 SGTAP  'SGCOV ERPT610',NR=(09,5) MECC IS TERPTCHK              TEREVAL 29112861
         LA    R5,TERPTCHK        SET MECC TO "CHANNEL..       @D61NDJK 29127961
         B     TEREVEX              PROTECTION CHECK"          @D61NDJK 29143061
*                                                              @D61NDJK 29158161
*------------------------------------------------------------* @D61NDJK 29173261
*   ERROR CONDITION IS INVALID SENSE DATA.                     @D61NDJK 29188361
*------------------------------------------------------------* @D61NDJK 29203461
*                                                              @D61NDJK 29218561
.*  IF ERRQMSG IS SET TO X'20', SENSE TASK FAILED TO GET US    @D61NDJK 29233661
.*  SENSE DATA                                                 @D61NDJK 29248761
.*                                                             @D61NDJK 29263861
TEREV050 TM    ERRQCSW+4,UNITCK   UNIT CHECK?                  @D61NDJK 29278961
         BZ    TEREVEX            NO, LEAVE MECC SET TO..      @D61NDJK 29294061
*                                 "IMPOSSIBLE ERROR CONDITION" @D61NDJK 29309161
         CLI   ERRQMSG,RCVMSG     INVALID SENSE DATA?          @D61NDJK 29324261
         BNE   TEREV080           NO                           @D61SDJK 29346351
 SGTAP  'SGCOV ERPT610',NR=(09,6) MECC IS TERINVSD              TEREVAL 29354461
         LA    R5,TERINVSD        SET MECC TO "INVALID SENSE.. @D61NDJK 29369561
         B     TEREVEX              DATA"                      @D61NDJK 29384661
*                                                              @D61NDJK 29385161
*------------------------------------------------------------* @D61SDJK 29385661
*                                                              @D61SDJK 29386161
*   ERROR CONDITION IS ACCOMPANIED BY A UNIT CHECK. SENSE      @D61SDJK 29386661
*   DATA EVALUATION IS EITHER DONE IN TEREVAL FOR 3480-TYPE    @D61SDJK 29387161
*   TAPE DEVICES OR IN SUBROUTINE TERNEWT FOR TPA DEVICES.     @D61SDJK 29387661
*                                                              @D61SDJK 29388161
*------------------------------------------------------------* @D61SDJK 29388661
*                                                              @D61SDJK 29389161
TEREV080 CLI   TERDEVTY,TERTPA    IT IS A TPA DEVICE?          @D61SDJK 29389661
         BL    TEREV100           NO                           @D61SDJK 29390161
*                                                              @D61SDJK 29390661
 SGTAP  'SGCOV ERPT610',NR=(09,7) TPA-TYPE SENSE IS EXPECTED    TEREVAL 29391661
 SGTAP  'CALL  TERNEWT         ','EVALUATE TPA-TYPE SENSE',    @D61SDJKX29392161
               I='1,2,3,B           DATA. ON RETURN RECOVERY', @D61SDJKX29392661
               O='F                 ATTRIBUTES ARE SET IN RF'  @D61SDJK 29393161
*                                                              @D61SDJK 29393661
         LA    R5,TERNWTAP        SET MECC TO "ERROR..         @D61SDJK 29394161
         LR    R9,R5                CONDITION ON TPA..         @D61SDJK 29394661
         MH    R9,=AL2(TERRATBL)    DEVICE" AND SET..          @D61SDJK 29395161
         LA    R9,TERRATB(R9)       RECOVERY ATTRIBUTES..      @D61SDJK 29395661
         ST    RF,0(R9)             IN RECOVERY ACTION..       @D61SDJK 29396161
         B     TEREVEX              TABLE ACCORDINGLY          @D61SDJK 29396661
*                                                              @D61SDJK 29397161
*------------------------------------------------------------* @D61NDJK 29399761
*                                                              @D61NDJK 29414861
*   ERROR CONDITION OCCURRED ON A 3480-TYPE TAPE DEVICE.       @D61NDJK 29439951
*                                                              @D61NDJK 29460161
*------------------------------------------------------------* @D61NDJK 29475261
*                                                              @D61NDJK 29482261
TEREV100 SLR   R6,R6              GET ERA CODE FROM SENSE..    @D61NDJK 29490361
         ICM   R6,1,ERRQSNS+3       BYTE 3                     @D61NDJK 29505461
*                                                              @D61NDJK 29520561
*------------------------------------------------------------* @D61NDJK 29535661
*   ERROR CONDITION IS UNKNOWN ERA CODE.                       @D61NDJK 29550761
*------------------------------------------------------------* @D61NDJK 29565861
*                                                              @D61NDJK 29580961
         LA    R5,X'20'           LOAD MINIMAL ERA CODE        @D61NDJK 29596061
         CR    R6,R5              ERA CODE BELOW MINIMUM?      @D61NDJK 29611161
         BL    TEREV105           YES                          @D61NDJK 29626261
         LA    R5,X'5E'           LOAD MAXIMAL ERA CODE        @D61NDJK 29641361
         CR    R6,R5              ERA CODE ABOVE MAXIMUM?      @D61NDJK 29656461
         BNH   TEREV110           NO                           @D61NDJK 29671561
TEREV105 DS    0H                                              @D61NDJK 29686051
 SGTAP  'SGCOV ERPT610',NR=(10,0) MECC IS TERUNKEC              TEREVAL 29693041
         LA    R5,TERUNKEC        SET MECC TO "UNKNOWN ERA..   @D61NDJK 29701761
         B     TEREVEX              CODE"                      @D61NDJK 29716861
*                                                              @D61NDJK 29731961
*------------------------------------------------------------* @D61NDJK 29747061
*   ERROR CONDITION IS ENVIRONMENTAL DATA PRESENT, THAT        @D61NDJK 29762161
*   MAY INVOLVE FURTHER ERROR CONDITIONS.                      @D61NDJK 29777261
*   THEY DEPEND UPON SARS DATA (STATISTICAL ANALYSIS AND       @D61NDJK 29792361
*   REPORTING SYSTEM) IN SENSE BYTE 26 AND ARE DEFINED AS      @D61NDJK 29807461
*   FOLLOWING:                                                 @D61NDJK 29822561
*   A) UNLOAD COMPLETE - CLEANING REQUIRED                     @D61NDJK 29837661
*   B) UNLOAD COMPLETE - REWRITING REQUIRED                    @D61NDJK 29852761
*   C) UNLOAD COMPLETE - REPLACING REQUIRED                    @D61NDJK 29867861
*   D) UNLOAD COMPLETE - REPAIR REQUIRED                       @D61NDJK 29882961
*                                                              @D61NDJK 29898061
.*  WE MIGHT HAVE DORMANT CODE HERE, SINCE 3480/3490           @D61NDJK 29913161
.*  SPECIFICATIONS (TUC 0013-16) STATE ON PAGE 478, THAT       @D61NDJK 29928261
.*  ERA CODE 2B IS EITHER REPORTED IN FORMAT X'21' OR X'30'.   @D61NDJK 29943361
.*  FURTHERMORE, IT IS MENTIONED ON PAGES 300 AND 456 THAT     @D61NDJK 29958461
.*  SENSE FORMAT 22 IS ONLY REPORTED WITH ERA CODE 52,         @D61NDJK 29973561
.*  END OF VOLUME COMPLETE.                                    @D61NDJK 29988661
.*                                                             @D61NDJK 30003761
*------------------------------------------------------------* @D61NDJK 30018861
*                                                              @D61NDJK 30033961
TEREV110 LA    R5,X'2B'           LOAD ERA CODE X'2B'          @D61NDJK 30049061
         CR    R6,R5              ERROR IS UNLOAD COMPLETE?    @D61NDJK 30064161
         BNE   TEREV200           NO                           @D61NDJK 30079261
         CLI   ERRQSNS+7,X'22'    SENSE FORMAT IS X'22'?       @D61NDJK 30094361
         BE    TEREV120           YES                          @D61NDJK 30109461
 SGTAP  'SGCOV ERPT610',NR=(10,1) SENSE FORMAT IS NOT 22        TEREVAL 30131551
         CLI   TERDEVTY,TER3424   DEVICE IS A 3424?            @D61NDJK 30139661
         BNE   TEREVEX            NO                           @D61NDJK 30154761
 SGTAP  'SGCOV ERPT610',NR=(10,2) DEVICE TYPE IS 3424           TEREVAL 30176851
*                                                              @D61NDJK 30184961
TEREV120 TM    ERRQSNS+26,X'80'   CLEANER ACTION REQUIRED?     @D61NDJK 30200061
         BZ    TEREV130           NO                           @D61NDJK 30215161
 SGTAP  'SGCOV ERPT610',NR=(10,3) MECC IS TER2BCLN              TEREVAL 30237251
         LA    R5,TER2BCLN        SET MECC TO "UNLOAD..        @D61NDJK 30245361
*                                 COMPLETE - CLEANING REQUIRED"@D61NDJK 30260461
TEREV130 TM    ERRQSNS+26,X'01'   REWRITE OR REPLACE REQUIRED? @D61NDJK 30275561
         BZ    TEREV150           NO                           @D61NDJK 30290661
         TM    ERRQSNS+26,X'02'   REPLACE REQUIRED?            @D61NDJK 30305761
         BO    TEREV140           YES                          @D61NDJK 30320861
 SGTAP  'SGCOV ERPT610',NR=(10,4) MECC IS TER2BRWR              TEREVAL 30342951
         LA    R5,TER2BRWR        SET MECC TO "UNLOAD..        @D61NDJK 30351061
         B     TEREV150           COMPLETE - REWRITE REQUIRED" @D61NDJK 30366161
TEREV140 LA    R5,TER2BRPL        SET MECC TO "UNLOAD..        @D61NDJK 30381261
*                                 COMPLETE - REPLACE REQUIRED" @D61NDJK 30396361
 SGTAP  'SGCOV ERPT610',NR=(10,5) MECC IS TER2BRPL              TEREVAL 30418451
TEREV150 TM    ERRQSNS+26,X'04'   REPAIR REQUIRED?             @D61NDJK 30426561
         BZ    TEREVEX            NO                           @D61NDJK 30441661
 SGTAP  'SGCOV ERPT610',NR=(10,6) MECC IS TER2BRPR              TEREVAL 30463751
         LA    R5,TER2BRPR        SET MECC TO "UNLOAD..        @D61NDJK 30471861
         B     TEREVEX            COMPLETE - REPAIR REQUIRED"  @D61NDJK 30486961
*                                                              @D61NDJK 30502061
*------------------------------------------------------------* @D61NDJK 30517161
*   ERROR CONDITION IS BACKWARD INTO LOADPOINT.                @D61NDJK 30532261
*   IF WE WEREN'T AT BEGINNING OF TAPE, WE SHOULDN'T HAVE      @D61NDJK 30547361
*   HIT LOAD POINT, SO IT IS A DIFFERENT ERROR.                @D61NDJK 30562461
*------------------------------------------------------------* @D61NDJK 30577561
*                                                              @D61NDJK 30592661
TEREV200 LA    R5,X'39'           LOAD ERA CODE X'39'          @D61NDJK 30607761
         CR    R6,R5              ERROR IS BWD INTO LOADPOINT? @D61NDJK 30622861
         BNE   TEREV350           NO                           @D61NDJK 30637961
         SLR   R7,R7              GET CHANNEL BLOCK ID FROM..  @D61NDJK 30653061
         ICM   R7,7,ERRQSNS+4       SENSE BYTE 4-6             @D61NDJK 30668161
         N     R7,TEREVMSK        LOGICAL BLOCK NUMBER IS ZERO?@D61NDJK 30683261
         BZ    TEREV220           YES                          @D61NDJK 30698361
 SGTAP  'SGCOV ERPT610',NR=(10,7) MECC IS TER39NBT              TEREVAL 30720451
         LA    R5,TER39NBT        SET MECC TO "BACKWARD INTO.. @D61NDJK 30728561
         B     TEREVEX              LOADPOINT - NOT BOT"       @D61NDJK 30743661
TEREV220 CLI   TERCCCWO,READB     COMMAND CCW IS READ BACKWARD?@D61NDJK 30758761
         BNE   TEREV350           NO                           @D61NDJK 30773861
 SGTAP  'SGCOV ERPT610',NR=(11,0) MECC IS TER39RBB              TEREVAL 30795951
         LA    R5,TER39RBB        SET MECC TO "READ BACKWARD.. @D61NDJK 30804061
         B     TEREVEX              INTO LOADPOINT - BOT"      @D61NDJK 30819161
*                                                              @D61NDJK 30834261
*------------------------------------------------------------* @D61NDJK 31302361
*   ERROR CONDITION IS TAPE LENGTH INCOMPATIBLE.               @D61NDJK 31317461
*   IF ERROR IS REPORTED AS TYPE 2 DEFERRED UNIT CHECK,        @D61NDJK 31332561
*   WE SHOULD ONLY WARN THE USER FROM FURTHER TAPE USAGE.      @D61NDJK 31347661
*------------------------------------------------------------* @D61NDJK 31362761
*                                                              @D61NDJK 31377861
TEREV350 LA    R5,X'5A'           LOAD ERA CODE X'5A'          @D61NDJK 31392961
         CR    R6,R5              ERROR IS LENGTH INCOMPATIBLE?@D61NDJK 31408061
         BNE   TEREV400           NO                           @D61NDJK 31423161
         TM    ERRQSNS,X'02'      DEFERRED UNIT CHECK?         @D61NDJK 31438261
         BZ    TEREV400           NO                           @D61NDJK 31453361
 SGTAP  'SGCOV ERPT610',NR=(11,1) MECC IS TER5ADUC              TEREVAL 31475451
         LA    R5,TER5ADUC        SET MECC TO "TAPE LENGTH..   @D61NDJK 31483561
         B     TEREVEX              INCOMPATIBLE - WARNING"    @D61NDJK 31498661
*                                                              @D61NDJK 31513761
*------------------------------------------------------------* @D61NDJK 31528861
*   ERROR CONDITION IS TAPE LENGTH VIOLATION.                  @D61NDJK 31543961
*   IF ERROR IS REPORTED AS TYPE 2 DEFERRED UNIT CHECK,        @D61NDJK 31559061
*   WE SHOULD ONLY WARN THE USER FROM FURTHER TAPE USAGE.      @D61NDJK 31574161
*------------------------------------------------------------* @D61NDJK 31589261
*                                                              @D61NDJK 31604361
TEREV400 LA    R5,X'5D'           LOAD ERA CODE X'5D'          @D61NDJK 31619461
         CR    R6,R5              ERROR IS LENGTH VIOLATION?   @D61NDJK 31634561
         BNE   TEREV450           NO                           @D61NDJK 31649661
         TM    ERRQSNS,X'02'      DEFERRED UNIT CHECK?         @D61NDJK 31664761
         BZ    TEREV450           NO                           @D61NDJK 31679861
 SGTAP  'SGCOV ERPT610',NR=(11,2) MECC IS TER5DDUC              TEREVAL 31701951
         LA    R5,TER5DDUC        SET MECC TO "TAPE LENGTH..   @D61NDJK 31710061
         B     TEREVEX              VIOLATION - WARNING"       @D61NDJK 31725161
*                                                              @D61NDJK 31726061
*------------------------------------------------------------* @D61NDJK 31726961
*   ERROR CONDITION IS PERMANENT CHANNEL INTERFACE RECOVERY.   @D61NDJK 31727861
*   THE ERROR CONDITION MAY BE REPORTED WITH A BUSOUT CHECK    @D61NDJK 31728761
*   OR OVERRUN INDICATION IN SENSE BYTE ZERO.                  @D61NDJK 31729661
*------------------------------------------------------------* @D61NDJK 31730561
*                                                              @D61NDJK 31731461
TEREV450 LA    R5,X'55'           LOAD ERA CODE X'55'          @D61NDJK 31732361
         CR    R6,R5              ERROR IS LENGTH VIOLATION?   @D61NDJK 31733261
         BNE   TEREV500           NO                           @DA44364 31734161
         TM    ERRQSNS,X'04'      IT IS AN OVERRUN ERROR?      @D61NDJK 31735061
         BZ    TEREV500           NO                           @DA44364 31735961
 SGTAP  'SGCOV ERPT610',NR=(11,3) MECC IS TER55OVR              TEREVAL 31737251
         LA    R5,TER55OVR        SET MECC TO "PERM. CHANNEL.. @D61NDJK 31737761
         B     TEREVEX              INTERFACE RCVY - OVERRUN"  @D61NDJK 31738661
*                                                              @D61NDJK 31740261
*------------------------------------------------------------* @D61NDJK 32208361
*   ERROR CONDITION IS MANUAL REWIND OR MANUAL REWIND UNLOAD.  @D61NDJK 32223461
*   IF THE TAPE FILE WAS NOT OPEN AND WRITE DATA WAS NOT       @D61NDJK 32238561
*   BUFFERED, WHEN THE MANUAL REWIND OR REWIND UNLOAD TOOK     @D61NDJK 32253661
*   PLACE, THE ERROR CONDITION IS NOTHING SPECIAL.             @D61NDJK 32268761
*   BUT FOLLOWING FURTHER ERROR CONDITIONS ARE POSSIBLE:       @D61NDJK 32283861
*   A) FILE WAS OPEN                                           @D61NDJK 32298961
*   B) FILE WAS NOT OPEN, BUT THERE WAS BUFFERED WRITE DATA    @D61NDJK 32314061
*                                                              @D61NDJK 32329161
*   ERA CODE 3C IS GENERATED FOR 3590 IN 3490E EMULATION       @DA44364 0000000 
*   MODE. THE ONLY DIFFERENCE TO ERA CODE 3B GENERATED         @DA44364 0000000 
*   BY A REGULAR 3490E TAPE DEVICE IS THAT ALTHOUGH SENSE      @DA44364 0000000 
*   BYTE 31 DOES NOT INDICATE BUFFERED WRITE DATA THERE        @DA44364 0000000 
*   MIGHT BE DATA IN THE CONTROL UNIT BUFFER.                  @DA44364 0000000 
*                                                              @DA44364 0000000 
.*  NOTE THAT PB2OPEN BIT ONLY TELLS IF A FILE IS OPEN *NOW*,  @D61NDJK 32344261
.*  NOT WHEN MANUAL REWIND/UNLOAD ACTUALLY HAPPENED, BUT       @D61NDJK 32359361
.*  LIOCS SYNCHRONIZES THE BIT WITH ITS I/O IN SUCH A WAY      @D61NDJK 32374461
.*  THAT THE FILE IS OPEN AT THE TIME THE REWIND/UNLOAD        @D61NDJK 32389561
.*  GETS REPORTED IF AND ONLY IF IT WAS OPEN WHEN THE          @D61NDJK 32404661
.*  REWIND/UNLOAD HAPPENED.                                    @D61NDJK 32419761
.*                                                             @D61NDJK 32434861
*------------------------------------------------------------* @D61NDJK 32449961
*                                                              @D61NDJK 32465061
TEREV500 LA    R5,X'3C'           LOAD ERA CODE X'3C'          @DA44364 0000000 
         CR    R6,R5              ERROR IS MANUAL REW OR UNL?  @DA44364 0000000 
         BNE   TEREV550           NO                           @DA44364 0000000 
         TM    TEROEFLG,TEROEFOP  FILE WAS OPEN?               @DA44364 0000000 
         BZ    TEREV550           NO                           @DA44364 0000000 
 SGTAP  'SGCOV ERPT610',NR=(11,4) MECC IS TER3COPN              TEREVAL 32562651
         LA    R5,TER3COPN        SET MECC TO "MANUAL REWIND.. @DA44364 0000000 
         B     TEREVEX              OR UNLOAD - FILE WAS OPEN" @DA44364 0000000 
*                                                              @DA44364 0000000 
TEREV550 LA    R5,X'3B'           LOAD ERA CODE X'3B'          @D61NDJK 32480161
         CR    R6,R5              ERROR IS MANUAL REW OR UNL?  @D61NDJK 32495261
         BNE   TEREV600           NO                           @D61NDJK 32510361
         TM    TEROEFLG,TEROEFOP  FILE WAS OPEN?               @D61NDJK 32525461
         BZ    TEREV560           NO                           @D61NDJK 32540561
 SGTAP  'SGCOV ERPT610',NR=(11,5) MECC IS TER3BOPN              TEREVAL 32562651
         LA    R5,TER3BOPN        SET MECC TO "MANUAL REWIND.. @D61NDJK 32570761
         B     TEREVEX              OR UNLOAD - FILE WAS OPEN" @D61NDJK 32585861
*                                                              @D61NDJK 32600961
TEREV560 CLI   ERRQSNS+31,X'00'   BUFFERED DATA AVAILABLE?     @D61NDJK 32616061
         BE    TEREV600           NO                           @D61NDJK 32631161
 SGTAP  'SGCOV ERPT610',NR=(11,6) MECC IS TER3BBUF              TEREVAL 32653251
         LA    R5,TER3BBUF        SET MECC TO "MANUAL REWIND.. @D61NDJK 32661361
         B     TEREVEX              OR UNLOAD - BUFFERED DATA" @D61NDJK 32676461
*                                                              @D61NDJK 32691561
*------------------------------------------------------------* @D61NDJK 32706661
*   ERROR CONDITION IS READ OPPOSITE.                          @D61NDJK 32721761
*   THIS COULD EITHER BE A SIMPLE DATA CHECK OR A FURTHER      @D61NDJK 32736861
*   ERROR CONDITION WHERE A USER PROGRAM TRIED TO READ         @D61NDJK 32751961
*   BACKWARD AN XF FORMAT BLOCK.                               @D61NDJK 32767061
*------------------------------------------------------------* @D61NDJK 32782161
*                                                              @D61NDJK 32797261
TEREV600 LA    R5,X'26'           LOAD ERA CODE X'26'          @D61NDJK 32812361
         CR    R6,R5              ERROR IS READ OPPOSITE?      @D61NDJK 32827461
         BNE   TEREV650           NO                           @D61NDJK 32842561
         TM    ERRQSNS+4,X'C0'    FORMAT IS SIMPLE 3480 MODE?  @D61NDJK 32857661
         BZ    TEREV650           YES                          @D61NDJK 32872761
 SGTAP  'SGCOV ERPT610',NR=(11,7) MECC IS TER26NCA              TEREVAL 32894851
         LA    R5,TER26NCA        SET MECC TO "READ OPPOSITE.. @D61NDJK 32902961
         B     TEREVEX              - NOT CAPABLE READ BWD"    @D61NDJK 32918061
*                                                              @D61NDJK 32933161
*------------------------------------------------------------* @D61NDJK 32948261
*   ERROR CONDITION IS FUNCTION INCOMPATIBLE.                  @D61NDJK 32963361
*   NORMALLY THE USER HAS SPECIFIED DATA COMPACTION FUNCTION   @D61NDJK 32978461
*   IN A MODE SET COMMAND AND THE IDRC FEATURE IS NOT          @D61NDJK 32993561
*   INSTALLED. BUT THE ERROR CONDITION IS ALSO PRESENTED,      @D61NDJK 33008661
*   IF A PERFORM SUBSYSTEM FUNCTION COMMAND WAS ISSUED WHICH   @D61NDJK 33023761
*   SPECIFIED A PIN ORDER AND THE DESIGNATED CU IS OFFLINE.    @D61NDJK 33038861
*------------------------------------------------------------* @D61NDJK 33053961
*                                                              @D61NDJK 33069061
TEREV650 LA    R5,X'29'           LOAD ERA CODE X'29'          @D61NDJK 33084161
         CR    R6,R5              ERROR IS FUNCTION INCOMP.?   @D61NDJK 33099261
         BNE   TEREV700           NO                           @D61NDJK 33114361
         CLI   TERCCCWO,X'DB'     COMMAND CCW IS SET MODE?     @D61NDJK 33129461
         BE    TEREV700           YES                          @D61NDJK 33144561
 SGTAP  'SGCOV ERPT610',NR=(12,0) MECC IS TER29PIN              TEREVAL 33166651
         LA    R5,TER29PIN        SET MECC TO "FUNCTION..      @D61NDJK 33174761
         B     TEREVEX            INCOMPATIBLE - PSF PIN ORDER'@D61NDJK 33189861
*                                                              @D61NDJK 33204961
*------------------------------------------------------------* @D61NDJK 33220061
*   ERROR CONDITION IS BUSOUT CHECK.                           @D61NDJK 33235161
*   THE TYPE OF A BUSOUT UNIT CHECK DEPENDS UPON THE CHANNEL   @D61NDJK 33250261
*   STATUS. ACCOMPANYING STATUS MAY BE:                        @D61NDJK 33265361
*   A) CHANNEL DATA CHECK                                      @D61NDJK 33280461
*   B) CHANNEL CHAINING CHECK                                  @D61NDJK 33295561
*------------------------------------------------------------* @D61NDJK 33310661
*                                                              @D61NDJK 33325761
TEREV700 LA    R5,X'49'           LOAD ERA CODE X'49'          @D61NDJK 33340861
         CR    R6,R5              ERROR IS BUSOUT CHECK?       @D61NDJK 33355961
         BNE   TEREV750           NO                           @D61NDJK 33371061
         TM    ERRQCSW+5,X'08'    ACCOMP. CHANNEL DATA CHECK?  @D61NDJK 33386161
         BZ    TEREV710           NO                           @D61NDJK 33401261
 SGTAP  'SGCOV ERPT610',NR=(12,1) MECC IS TER49CDC              TEREVAL 33423351
         LA    R5,TER49CDC        SET MECC TO "BUSOUT CHECK    @D61NDJK 33431461
         B     TEREVEX            WITH CHANNEL DATA CHECK"     @D61NDJK 33446561
*                                                              @D61NDJK 33461661
TEREV710 TM    ERRQCSW+5,X'01'    ACCOMP. CHANNEL CHAIN. CHECK?@D61NDJK 33476761
         BZ    TEREV750           NO                           @D61NDJK 33491861
 SGTAP  'SGCOV ERPT610',NR=(12,2) MECC IS TER49CCC              TEREVAL 33513951
         LA    R5,TER49CCC        SET MECC TO "BUSOUT CHECK..  @D61NDJK 33522061
         B     TEREVEX            WITH CHANNEL CHAINING CHECK" @D61NDJK 33537161
*                                                              @D61NDJK 33552261
*------------------------------------------------------------* @D61NDJK 33567361
*   ERROR CONDITION IS DRIVE SWITCHED TO NOT READY.            @D61NDJK 33944861
*   IF THE TAPE FILE WAS NOT OPEN, THE ERROR CONDITION IS      @D61NDJK 33959961
*   NOTHING SPECIAL, BUT IN CASE OF AN OPEN FILE, THIS IS      @D61NDJK 33975061
*   AN UNEXPECTED INTERVENTION REQUIRED CONDITION.             @D61NDJK 33990161
*------------------------------------------------------------* @D61NDJK 34005261
*                                                              @D61NDJK 34020361
TEREV750 LA    R5,X'3A'           LOAD ERA CODE X'3A'          @D61NDJK 34035461
         CR    R6,R5              ERROR IS DRIVE SWITCHED NR?  @D61NDJK 34050561
         BNE   TEREV800           NO                           @D61NDJK 34065661
         TM    TEROEFLG,TEROEFOP  FILE WAS OPEN?               @D61NDJK 34080761
         BZ    TEREV800           NO                           @D61NDJK 34095861
 SGTAP  'SGCOV ERPT610',NR=(12,3) MECC IS TER3AOPN              TEREVAL 34117951
         LA    R5,TER3AOPN        SET MECC TO "DRIVE SWITCHED..@D61NDJK 34126061
         B     TEREVEX            TO NOT READY - FILE WAS OPEN"@D61NDJK 34141161
*                                                              @D61NDJK 34141861
*------------------------------------------------------------* @D61NDJK 34142561
*   ERROR CONDITION IS GLOBAL STATUS INTERCEPT.                @D61NDJK 34143261
*   IF THE STATUS CONDITION IS PRESENTED IN ABSENCE OF I/O     @D61NDJK 34143961
*   ACTIVITY, THE ERROR CONDITION SHOULD BE IGNORED. IN ALL    @D61NDJK 34144661
*   OTHER CASES THE UNIT CHECK IS PRESENTED IN INITIAL STATUS  @D61NDJK 34145361
*   TO THE CCW CHAIN'S FIRST COMMAND WHICH CAN BE RETRIED.     @D61NDJK 34146061
*------------------------------------------------------------* @D61NDJK 34146761
*                                                              @D61NDJK 34147461
TEREV800 LA    R5,X'57'           LOAD ERA CODE X'57'          @D61NDJK 34148161
         CR    R6,R5              ERROR IS STATUS INTERCEPT?   @D61NDJK 34148861
         BNE   TEREV850           NO                           @D61NDJK 34149561
         OC    TERCCCWV,TERCCCWV  THERE IS A FAILING CCW?      @D61NDJK 34150261
         BNZ   TEREV850           YES                          @D61NDJK 34150961
 SGTAP  'SGCOV ERPT610',NR=(12,4) MECC IS TER57UIC              TEREVAL 34151951
         LA    R5,TER57UIC        SET MECC TO "GLOBAL STATUS.. @D61NDJK 34152361
         B     TEREVEX              INTERCEPT - UNSOLICITED"   @D61SDJK 34153351
*                                                              @D61NDJK 34153761
*------------------------------------------------------------* @D61NDJK 34156261
*                                                              @D61NDJK 34171361
*   IF ERROR CONDITION COULDN'T BE DETERMINED YET,             @D61NDJK 34186461
*   SUBROUTINE TERFAST WILL BE CALLED. TERFAST TAKES           @D61NDJK 34201561
*   ERA CODE IN SENSE BYTE 3 AS MAIN ERROR CLASSIFICATION      @D61NDJK 34216661
*   CODE.                                                      @D61NDJK 34231761
*                                                              @D61NDJK 34246861
*------------------------------------------------------------* @D61NDJK 34261961
*                                                              @D61NDJK 34269461
TEREV850 L     RF,=A(TERFAST)     SET MECC TO ERA CODE FROM    @D61NDJK 34277061
*                                 SENSE BYTE 3                 @D61NDJK 34292161
         BALR  RE,RF              INPUT IS R2, RE AND RF       @D61NDJK 34307261
         NOP   0                  ON RETURN,..                 @D61NDJK 34315261
         NOP   0                    RF CONTAINS..              @D61NDJK 34323261
         NOP   0                    MAIN ERROR..               @D61NDJK 34331261
         NOP   0                    CLASSIFICATION CODE        @D61NDJK 34343261
         LR    R5,RF              LOAD MECC INTO R5            @D61NDJK 34355261
 SGTAP  'SGCOV ERPT610',NR=(12,5) MECC IS TERXX                 TEREVAL 34370651
*                                                              @D61NDJK 34375161
*------------------------------------------------------------* @D61NDJK 34382761
*                                                              @D61NDJK 34397861
*   EXIT HANDLING                                              @D61NDJK 34412961
*                                                              @D61NDJK 34428061
*------------------------------------------------------------* @D61NDJK 34443161
*                                                              @D61NDJK 34450661
TEREVEX  STC   R5,TERMECC         SAVE MECC                    @D61NDJK 34458261
*                                                              @D61NDJK 34473361
         SGTAP 'RETURN         ','RETURN TO CALLER'            @D61NDJK 34488461
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 34503561
*                                                              @D61NDJK 34518661
*------------------------------------------------------------* @D61NDJK 34533761
*                                                              @D61NDJK 34548861
*   LOCAL VARIABLES USED IN TEREVAL                            @D61NDJK 34563961
*                                                              @D61NDJK 34579061
*------------------------------------------------------------* @D61NDJK 34594161
*                                                              @D61NDJK 34609261
         DS    0F                                              @D61NDJK 34616761
TEREVMSK DC    XL4'003FFFFF'      MASK FOR CHANNEL BLOCK ID..  @D61NDJK 34624361
*                                   IN SENSE BYTES 4-6         @D61NDJK 34639461
*------------------------------------------------------------* @D61NDJK 34654561
*   RECOVERY ACTION TABLE.                                     @D61NDJK 34669661
*------------------------------------------------------------* @D61NDJK 34684761
*                                                              @D61NDJK 34699861
TERRATB  DS    0F                                              @D61NDJK 34714961
*                                                              @D61NDJK 34730061
*   IMPOSSIBLE ERROR CONDITION                             X00 @D61NDJK 34745161
TERIMPEC EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 34760261
         DC AL1(TERRSURR,TERMSG20,TERMRCM,0)                   @D61NDJK 34775361
*                                                              @D61NDJK 34790461
*   DEVICE NOT OPERATIONAL                                 X01 @D61NDJK 34805561
TERNOTOP EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 34820661
         DC AL1(TERRIRQ,TERMSG31,TERMRIM,0)                    @D61NDJK 34835761
*                                                              @D61NDJK 34850861
*   CHANNEL DATA CHECK W/O ACCOMPANYING UNIT CHECK         X02 @D61NDJK 34865961
TERCDCHK EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 34881061
         DC AL1(TERRCHKR,TERMSG28,TERMRCM,0)                   @D61NDJK 34896161
*                                                              @D61NDJK 34911261
*   CHAINING CHECK W/O ACCOMPANYING UNIT CHECK             X03 @D61NDJK 34926361
TERCCHK  EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 34941461
         DC AL1(TERRCHKR,TERMSG24,TERMRCM,0)                   @D61NDJK 34956561
*                                                              @D61NDJK 34971661
*   CHANNEL PROGRAM CHECK                                  X04 @D61NDJK 34986761
TERPGCHK EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35001861
         DC AL1(TERRSURR,TERMSG24,TERMRPO+TERMRCM,0)           @D61NDJK 35016961
*                                                              @D61NDJK 35032061
*   CHANNEL PROTECTION CHECK                               X05 @D61NDJK 35047161
TERPTCHK EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35062261
         DC AL1(TERRSURR,TERMSG25,TERMRPO+TERMRCM,0)           @D61NDJK 35077361
*                                                              @D61NDJK 35092461
*   INVALID SENSE DATA                                     X06 @D61NDJK 35107561
TERINVSD EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35122661
         DC AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)           @D61NDJK 35137761
*                                                              @D61NDJK 35152861
*   UNLOAD COMPLETE - CLEANING REQUIRED                    X07 @D61NDJK 35167961
TER2BCLN EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35183061
         DC AL1(TERREOV,TERMSG05,TERMR90M+TERMRIM,TERPSUC+TERPSCLR)     35198161
*                                                              @D61NDJK 35213261
*   UNLOAD COMPLETE - MEDIA NEEDS REWRITING                X08 @D61NDJK 35228361
TER2BRWR EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35243461
         DC AL1(TERREOV,TERMSG65,TERMR90M+TERMRIM,TERPSUC+TERPSCLR)     35258561
*                                                              @D61NDJK 35273661
*   UNLOAD COMPLETE - MEDIA NEEDS REPLACING                X09 @D61NDJK 35288761
TER2BRPL EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35303861
         DC AL1(TERREOV,TERMSG65,TERMR90M+TERMRIM,TERPSUC+TERPSCLR)     35318961
*                                                              @D61NDJK 35334061
*   UNLOAD COMPLETE - MEDIA NEEDS REPAIR                   X0A @D61NDJK 35349161
TER2BRPR EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35364261
         DC AL1(TERREOV,TERMSG64,TERMR90M+TERMRIM,TERPSUC+TERPSCLR)     35379361
*                                                              @D61NDJK 35394461
*   READ BACKWARD INTO LOADPOINT - BEGINNING OF TAPE       X0B @D61NDJK 35409561
TER39RBB EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35424661
         DC AL1(TERRIGN,TERMSG20,TERMRCM,TERPSUC+TERPSUE)      @D61NDJK 35439761
*                                                              @D61NDJK 35454861
*   BACKWARD INTO LOAD POINT - NOT BEGINNING OF TAPE       X0C @D61NDJK 35469961
TER39NBT EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35485061
         DC AL1(TERRSURR,TERMSG10,TERMRPO+TERMRCM,0)           @D61NDJK 35500161
*                                                              @D61NDJK 35515261
*   GLOBAL STATUS INTERCEPT - UNSOLICITED                  X0D @D61NDJK 35516561
TER57UIC EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35517861
         DC AL1(TERRIGN,TERMSG18,TERMRCM,TERPSUC+TERPSAVR)     @D61NDJK 35519161
*                                                              @D61NDJK 35520661
*   PERMANENT CHANNEL INTERFACE RECOVERY - OVERRUN         X0E @D61NDJK 35521961
TER55OVR EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35523261
         DC AL1(TERRSURR,TERMSG14,TERMRPO+TERMRCM,0)           @D61NDJK 35524561
*                                                              @D61NDJK 35526061
*   TAPE LENGTH INCOMPATIBLE - WARNING                     X0F @D61NDJK 35651161
TER5ADUC EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35666261
         DC AL1(TERRRTY,TERMSG32,TERMRPO+TERMRIM,0)            @D61NDJK 35681361
*                                                              @D61NDJK 35696461
*   TAPE LENGTH VIOLATION - WARNING                        X10 @D61NDJK 35711561
TER5DDUC EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35726661
         DC AL1(TERRRTY,TERMSG32,TERMRPO+TERMRIM,0)            @D61NDJK 35741761
*                                                              @D61NDJK 35756861
*   NOT USED                                               X11 @D61NDJK 35758661
         DC AL1(0,0,0,0)                                       @D61NDJK 35760461
*                                                              @D61NDJK 35762261
*   MANUAL REWIND OR REWIND UNLOAD - FILE WAS OPEN (3590)  X12 @DA44364 0000000 
TER3COPN EQU   (*-TERRATB)/TERRATBL                            @DA44364 0000000 
         DC AL1(TERRSURR,TERMSG43,TERMR90M+TERMRCM)            @DA44364 0000000 
         DC AL1(TERPSAVR+TERPSCLR+TERPSRBL)                    @DA44364 0000000 
*                                                              @DA44364 0000000 
*   MANUAL REWIND OR REWIND UNLOAD - FILE WAS OPEN         X13 @D61NDJK 35892761
TER3BOPN EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35907861
         DC AL1(TERRSURR,TERMSG43,TERMR90M+TERMRCM)            @D61SDJK 35923851
         DC AL1(TERPSAVR+TERPSCLR+TERPSRBL)                    @D61SDJK 35929841
*                                                              @D61NDJK 35938061
*   MANUAL REWIND OR REWIND UNLOAD - BUFFERED WRITE DATA   X14 @D61NDJK 35953161
TER3BBUF EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 35968261
         DC AL1(TERRURTY,TERMSG47,TERMR90M+TERMRIM)            @D61SDJK 35984251
         DC AL1(TERPSAVR+TERPSCLR+TERPSRBL)                    @D61SDJK 35990241
*                                                              @D61NDJK 35998461
*   READ OPPOSITE RECOVERY - NOT CAPABLE OF READ BACKWARD  X15 @D61NDJK 36013561
TER26NCA EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 36028661
         DC AL1(TERRROR,TERMSG11,TERMRPO+TERMRCR+TERMRCM,0)    @D61NDJK 36043761
*                                                              @D61NDJK 36058861
*   FUNCTION INCOMPATIBLE  - PSF PIN ORDER SPECIFIED       X16 @D61NDJK 36073961
TER29PIN EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 36089061
         DC AL1(TERRSURR,TERMSG49,TERMRCM,0)                   @D61NDJK 36104161
*                                                              @D61NDJK 36119261
*   BUSOUT CHECK WITH ACCOMPANYING CHANNEL DATA CHECK      X17 @D61NDJK 36134361
TER49CDC EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 36149461
         DC AL1(TERRCHKR,TERMSG28,TERMRPO+TERMRCR+TERMRCM,0)   @D61NDJK 36164561
*                                                              @D61NDJK 36179661
*   BUSOUT CHECK WITH ACCOMPANYING CHANNEL CHAINING CHECK  X18 @D61NDJK 36194761
TER49CCC EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 36209861
         DC AL1(TERRCHKR,TERMSG24,TERMRPO+TERMRCR+TERMRCM,0)   @D61NDJK 36224961
*                                                              @D61NDJK 36240061
*   DRIVE SWITCHED TO NOT READY - FILE WAS OPEN            X19 @D61NDJK 36285361
TER3AOPN EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 36330661
         DC AL1(TERRIRQ,TERMSG47,TERMRIM,0)                    @D61NDJK 36345761
*                                                              @D61NDJK 36349461
*   NOT USED                                               X1A @D61NDJK 36353161
         DC AL1(0,0,0,0)                                       @D61NDJK 36356861
*                                                              @D61NDJK 36360861
*   NOT USED                                               X1B @D61NDJK 36375961
         DC AL1(0,0,0,0)                                       @D61NDJK 36391061
*                                                              @D61NDJK 36406161
*   NOT USED                                               X1C @D61NDJK 36421261
         DC AL1(0,0,0,0)                                       @D61NDJK 36436361
*                                                              @D61NDJK 36451461
*   NOT USED                                               X1D @D61NDJK 36466561
         DC AL1(0,0,0,0)                                       @D61NDJK 36481661
*                                                              @D61NDJK 36496761
*   NOT USED                                               X1E @D61NDJK 36511861
         DC AL1(0,0,0,0)                                       @D61NDJK 36526961
*                                                              @D61NDJK 36542061
*   ERROR CONDITION ON A TPA DEVICE                        X1F @D61SDJK 36566151
TERNWTAP EQU   (*-TERRATB)/TERRATBL                            @D61SDJK 36575141
         DC AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)           @D61SDJK 36584131
*                                                              @D61SDJK 36593121
*   UNKNOWN ERA CODE                                       X20 @D61NDJK 36602461
TERUNKEC EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 36617561
         DC AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)           @D61NDJK 36632661
*                                                              @D61NDJK 36647761
*   DATA STREAMING NOT OPERATIONAL                         X21 @D61NDJK 36662861
TER21    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 36677961
         DC AL1(TERRRTY,TERMSG05,TERMRTO+TERMRIM,0)            @D61NDJK 36693061
*                                                              @D61NDJK 36708161
*   PATH EQUIPMENT CHECK                                   X22 @D61NDJK 36723261
TER22    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 36738361
         DC AL1(TERRSURR,TERMSG10,TERMRPO+TERMRCM,0)           @D61NDJK 36753461
*                                                              @D61NDJK 36768561
*   READ DATA CHECK                                        X23 @D61NDJK 36783661
TER23    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 36798761
         DC AL1(TERRSURR,TERMSG11,TERMRPO+TERMRCM,TERPSRDC+TERPSCNT)    36813861
*                                                              @D61NDJK 36828961
*   LOAD DISPLAY CHECK                                     X24 @D61NDJK 36844061
TER24    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 36859161
         DC AL1(TERRSURR,TERMSG23,TERMRCM,0)                   @D61NDJK 36874261
*                                                              @D61NDJK 36889361
*   WRITE DATA CHECK                                       X25 @D61NDJK 36904461
TER25    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 36919561
         DC AL1(TERRSURR,TERMSG11,TERMRPO+TERMRCM,TERPSCNT)    @D61NDJK 36934661
*                                                              @D61NDJK 36949761
*   READ OPPOSITE - DATA CHECK                             X26 @D61NDJK 36964861
TER26    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 36979961
         DC AL1(TERRROR,TERMSG11,TERMRPO+TERMRCR+TERMRCM)      @D61NDJK 36989961
         DC AL1(TERPSRDC+TERPSCNT)                             @D61NDJK 36999961
*                                                              @D61NDJK 37010161
*   COMMAND REJECT                                         X27 @D61NDJK 37025261
TER27    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37040361
         DC AL1(TERRSURR,TERMSG18,TERMRCM,0)                   @D61NDJK 37055461
*                                                              @D61NDJK 37070561
*   WRITE ID MARK CHECK                                    X28 @D61NDJK 37085661
TER28    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37100761
         DC AL1(TERRSURR,TERMSG11,TERMRPO+TERMRCM,TERPSCNT)    @D61NDJK 37115861
*                                                              @D61NDJK 37130961
*   FUNCTION INCOMPATIBLE - IDRC NOT INSTALLED             X29 @D61NDJK 37146061
TER29    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37161161
         DC AL1(TERRSURR,TERMSG18,TERMRCM,0)                   @D61NDJK 37176261
*                                                              @D61NDJK 37191361
*   UNSOLICITED ENVIRONMENTAL DATA                         X2A @D61NDJK 37206461
TER2A    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37221561
         DC AL1(TERRRTY,TERMSG20,TERMR91M+TERMRCM,0)           @D61NDJK 37236661
*                                                              @D61NDJK 37251761
*   ENVIRONMENTAL DATA PRESENT                             X2B @D61NDJK 37266861
TER2B    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37281961
         DC AL1(TERREOV,TERMSG20,TERMR90M+TERMRCM,TERPSUC+TERPSCLR)     37297061
*                                                              @D61NDJK 37312161
*   PERMANENT EQUIPMENT CHECK                              X2C @D61NDJK 37327261
TER2C    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37342361
         DC AL1(TERRSURR,TERMSG10,TERMRPO+TERMRCM,0)           @D61NDJK 37357461
*                                                              @D61NDJK 37372561
*   DATA SECURITY ERASE FAILURE                            X2D @D61NDJK 37387661
TER2D    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37402761
         DC AL1(TERRSURR,TERMSG42,TERMRPO+TERMRCM,0)           @D61NDJK 37417861
*                                                              @D61NDJK 37432961
*   NOT CAPABLE                                            X2E @D61NDJK 37448061
TER2E    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37463161
         DC AL1(TERRSURR,TERMSG32,TERMRCM,0)                   @D61NDJK 37478261
*                                                              @D61NDJK 37493361
*   RESERVED                                               X2F @D61NDJK 37508461
TER2F    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37523561
         DC AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)           @D61NDJK 37538661
*                                                              @D61NDJK 37553761
*   WRITE PROTECTED                                        X30 @D61NDJK 37568861
TER30    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37583961
         DC AL1(TERRSURR,TERMSG17,TERMRCM,0)                   @D61NDJK 37599061
*                                                              @D61NDJK 37614161
*   TAPE VOID                                              X31 @D61NDJK 37629261
TER31    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37644361
         DC AL1(TERRSURR,TERMSG36,TERMRPO+TERMRCM,0)           @D61NDJK 37659461
*                                                              @D61NDJK 37674561
*   TENSION LOSS                                           X32 @D61NDJK 37689661
TER32    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37704761
         DC AL1(TERRSURR,TERMSG10,TERMRPO+TERMRCM,0)           @D61NDJK 37719861
*                                                              @D61NDJK 37734961
*   LOAD FAILURE                                           X33 @D61NDJK 37750061
TER33    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37765161
         DC AL1(TERRIRQ,TERMSG08,TERMRTO+TERMRIM,0)            @D61NDJK 37780261
*                                                              @D61NDJK 37795361
*   UNLOAD FAILURE                                         X34 @D61NDJK 37810461
TER34    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37825561
         DC AL1(TERRIRQ,TERMSG08,TERMRTO+TERMRIM,0)            @D61NDJK 37840661
*                                                              @D61NDJK 37855761
*   DRIVE EQUIPMENT CHECK                                  X35 @D61NDJK 37870861
TER35    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37885961
         DC AL1(TERRSURR,TERMSG10,TERMRPO+TERMRCM,0)           @D61NDJK 37901061
*                                                              @D61NDJK 37916161
*   END OF DATA                                            X36 @D61NDJK 37931261
TER36    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 37946361
         DC AL1(TERRSURR,TERMSG36,TERMRCM,0)                   @D61NDJK 37961461
*                                                              @D61NDJK 37976561
*   TAPE LENGTH ERROR                                      X37 @D61NDJK 37991661
TER37    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38006761
         DC AL1(TERRRTY,TERMSG65,TERMRPO+TERMRIM,0)            @D61NDJK 38021861
*                                                              @D61NDJK 38036961
*   PHYSICAL END OF VOLUME                                 X38 @D61NDJK 38052061
TER38    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38067161
         DC AL1(TERRSURR,TERMSG13,TERMRCM,0)                   @D61NDJK 38082261
*                                                              @D61NDJK 38097361
*   BACKWARD INTO LOADPOINT - BEGINNING OF TAPE            X39 @D61NDJK 38112461
TER39    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38127561
         DC AL1(TERRSURR,TERMSG29,TERMRCM,0)                   @D61NDJK 38142661
*                                                              @D61NDJK 38157761
*   DRIVE SWITCHED TO NOT READY - FILE WAS NOT OPEN        X3A @D61NDJK 38172861
TER3A    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38187961
         DC AL1(TERRIRQ,TERMSG08,TERMRIM,0)                    @D61NDJK 38203061
*                                                              @D61NDJK 38218161
*   MANUAL REWIND OR REWIND UNLOAD - NO BUFFERED DATA      X3B @D61NDJK 38233261
TER3B    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38248361
         DC AL1(TERRURTY,TERMSG20,TERMR90M+TERMRCM)            @D61SDJK 38264351
         DC AL1(TERPSAVR+TERPSCLR+TERPSRBL)                    @D61SDJK 38270341
*                                                              @D61NDJK 38278561
*   MANUAL REWIND OR REWIND UNLOAD - BUFFERED DATA (3590)  X3C @DA44364 0000000 
TER3C    EQU   (*-TERRATB)/TERRATBL                            @DA44364 0000000 
         DC AL1(TERRURTY,TERMSG47,TERMR90M+TERMRIM)            @DA44364 0000000 
         DC AL1(TERPSAVR+TERPSCLR+TERPSRBL)                    @DA44364 0000000 
*                                                              @DA44364 0000000 
*   RESERVED                                               X3D @D61NDJK 38354061
TER3D    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38369161
         DC AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)           @D61NDJK 38384261
*                                                              @D61NDJK 38399361
*   RESERVED                                               X3E @D61NDJK 38414461
TER3E    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38429561
         DC AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)           @D61NDJK 38444661
*                                                              @D61NDJK 38459761
*   RESERVED                                               X3F @D61NDJK 38474861
TER3F    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38489961
         DC AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)           @D61NDJK 38505061
*                                                              @D61NDJK 38520161
*   OVERRUN                                                X40 @D61NDJK 38535261
TER40    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38550361
         DC AL1(TERRSURR,TERMSG14,TERMRPO+TERMRCM,0)           @D61NDJK 38565461
*                                                              @D61NDJK 38580561
*   RECORD SEQUENCE ERROR                                  X41 @D61NDJK 38595661
TER41    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38610761
         DC AL1(TERRSURR,TERMSG11,TERMRPO+TERMRCM,TERPSCNT)    @D61NDJK 38625861
*                                                              @D61NDJK 38640961
*   DEGRADED MODE                                          X42 @D61NDJK 38656061
TER42    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38671161
         DC AL1(TERRRTY,TERMSG64,TERMRPO+TERMRIM,0)            @D61NDJK 38686261
*                                                              @D61NDJK 38701361
*   DRIVE NOT READY - NO RUN COMMAND                       X43 @D61NDJK 38716461
TER43    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38731561
         DC AL1(TERRIRQ,TERMSG08,TERMRIM,0)                    @D61NDJK 38746661
*                                                              @D61NDJK 38761761
*   LOCATE BLOCK UNSUCCESSFUL                              X44 @D61NDJK 38776861
TER44    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38791961
         DC AL1(TERRSURR,TERMSG36,TERMRCM,0)                   @D61NDJK 38807061
*                                                              @D61NDJK 38822161
*   DRIVE ASSIGNED ELSEWHERE                               X45 @D61NDJK 38837261
TER45    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38852361
         DC AL1(TERRSURR,TERMSG03,TERMRCM,0)                   @D61NDJK 38867461
*                                                              @D61NDJK 38882561
*   DRIVE NOT ONLINE                                       X46 @D61NDJK 38897661
TER46    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38912761
         DC AL1(TERRIRQ,TERMSG31,TERMRIM,0)                    @D61NDJK 38927861
*                                                              @D61NDJK 38942961
*   VOLUME FENCED                                          X47 @D61NDJK 38958061
TER47    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 38973161
         DC AL1(TERRSURR,TERMSG49,TERMRPO+TERMRCM,0)           @D61NDJK 38988261
*                                                              @D61NDJK 39003361
*   UNSOLICITED INFORMATIONAL DATA                         X48 @D61NDJK 39018461
TER48    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39033561
         DC AL1(TERRRTY,TERMSG20,TERMRTO+TERMRCM,0)            @D61NDJK 39048661
*                                                              @D61NDJK 39063761
*   BUSOUT CHECK - SIMPLE                                  X49 @D61NDJK 39078861
TER49    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39093961
         DC AL1(TERRSURR,TERMSG09,TERMRPO+TERMRCM,0)           @D61NDJK 39109061
*                                                              @D61NDJK 39124161
*   CONTROL UNIT ERP FAILED                                X4A @D61NDJK 39139261
TER4A    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39154361
         DC AL1(TERRSURR,TERMSG10,TERMRPO+TERMRCM,0)           @D61NDJK 39169461
*                                                              @D61NDJK 39184561
*   CONTROL UNIT AND DRIVE INCOMPATIBLE                    X4B @D61NDJK 39199661
TER4B    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39214761
         DC AL1(TERRSURR,TERMSG64,TERMRPO+TERMRCM,0)           @D61NDJK 39229861
*                                                              @D61NDJK 39244961
*   RECOVERED CHECK-ONE FAILURE                            X4C @D61NDJK 39260061
TER4C    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39275161
         DC AL1(TERRRTY,TERMSG05,TERMRPO+TERMRIM,0)            @D61NDJK 39290261
*                                                              @D61NDJK 39305361
*   RESETTING EVENT                                        X4D @D61NDJK 39320461
TER4D    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39335561
         DC AL1(TERRRTY,TERMSG20,TERMRCM,0)                    @D61NDJK 39350661
*                                                              @D61NDJK 39365761
*   MAXIMUM BLOCK SIZE EXCEEDED                            X4E @D61NDJK 39380861
TER4E    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39395961
         DC AL1(TERRSURR,TERMSG59,TERMRCM,0)                   @D61NDJK 39411061
*                                                              @D61NDJK 39426161
*   RESERVED                                               X4F @D61NDJK 39441261
TER4F    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39456361
         DC AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)           @D61NDJK 39471461
*                                                              @D61NDJK 39486561
*   READ BUFFERED LOG OVERFLOW                             X50 @D61NDJK 39501661
TER50    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39516761
         DC AL1(TERRRTY,TERMSG64,TERMR91M+TERMRCM,TERPSRBL)    @DY45817 39538851
*                                                              @D61NDJK 39546961
*   READ BUFFERED LOG EOV                                  X51 @D61NDJK 39562061
TER51    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39577161
         DC AL1(TERRRTY,TERMSG20,TERMR90M+TERMRCM,TERPSRBL)    @D61SDJK 39599251
*                                                              @D61NDJK 39607361
*   END OF VOLUME COMPLETE                                 X52 @D61NDJK 39622461
TER52    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39637561
         DC AL1(TERREOV,TERMSG20,TERMRCM,TERPSUC+TERPSCLR)     @D61NDJK 39652661
*                                                              @D61NDJK 39667761
*   GLOBAL COMMAND INTERCEPT                               X53 @D61NDJK 39682861
TER53    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39697961
         DC AL1(TERRRTY,TERMSG18,TERMRCM,0)                    @D61NDJK 39713061
*                                                              @D61NDJK 39728161
*   TEMPORARY CHANNEL INTERFACE RECOVERY                   X54 @D61NDJK 39743261
TER54    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39758361
         DC AL1(TERRRTY,TERMSG20,TERMRTO+TERMRCM,0)            @D61NDJK 39773461
*                                                              @D61NDJK 39788561
*   PERMANENT CHANNEL INTERFACE RECOVERY - BUSOUT CHECK    X55 @D61NDJK 39803661
TER55    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39818761
         DC AL1(TERRSURR,TERMSG09,TERMRPO+TERMRCM,0)           @D61NDJK 39833861
*                                                              @D61NDJK 39848961
*   CHANNEL PROTOCOL ERROR                                 X56 @D61NDJK 39864061
TER56    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39879161
         DC AL1(TERRSURR,TERMSG09,TERMRPO+TERMRCM,0)           @D61NDJK 39894261
*                                                              @D61NDJK 39909361
*   GLOBAL STATUS INTERCEPT - SOLICITED                    X57 @D61NDJK 39924461
TER57    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39939561
         DC AL1(TERRRTY,TERMSG18,TERMRCM,TERPSAVR)             @D61NDJK 39954661
*                                                              @D61NDJK 39969761
*   RESERVED                                               X58 @D61NDJK 39984861
TER58    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 39999961
         DC AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)           @D61NDJK 40015061
*                                                              @D61NDJK 40030161
*   RESERVED                                               X59 @D61NDJK 40045261
TER59    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 40060361
         DC AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)           @D61NDJK 40075461
*                                                              @D61NDJK 40090561
*   TAPE LENGTH INCOMPATIBLE - POSSIBLE TAPE DAMAGE        X5A @D61NDJK 40105661
TER5A    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 40120761
         DC AL1(TERRSURR,TERMSG32,TERMRCM,0)                   @D61NDJK 40135861
*                                                              @D61NDJK 40150961
*   FORMAT 3480 XF INCOMPATIBLE                            X5B @D61NDJK 40166061
TER5B    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 40181161
         DC AL1(TERRSURR,TERMSG32,TERMRCM,0)                   @D61NDJK 40196261
*                                                              @D61NDJK 40211361
*   FORMAT 3480-2 XF INCOMPATIBLE                          X5C @D61NDJK 40226461
TER5C    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 40241561
         DC AL1(TERRSURR,TERMSG32,TERMRCM,0)                   @D61NDJK 40256661
*                                                              @D61NDJK 40271761
*   TAPE LENGTH VIOLATION - POSSIBLE TAPE DAMAGE           X5D @D61NDJK 40286861
TER5D    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 40301961
         DC AL1(TERRSURR,TERMSG32,TERMRCM,0)                   @D61NDJK 40317061
*                                                              @D61NDJK 40332161
*   COMPACTION ALGORYTHM INCOMPATIBLE                      X5E @D61NDJK 40347261
TER5E    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 40362361
         DC AL1(TERRSURR,TERMSG32,TERMRPO+TERMRCM,0)           @D61NDJK 40377461
*                                                              @D61NDJK 40392561
*   RESERVED                                               X5F @D61NDJK 40407661
TER5F    EQU   (*-TERRATB)/TERRATBL                            @D61NDJK 40422761
         DC AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)           @D61NDJK 40437861
TERRATBN EQU   (*-TERRATB)/TERRATBL      # OF ENTRIES IN TABLE @D61NDJK 40452961
*                                                              @D61NDJK 40468061
TERMSG03 EQU   3                                               @D61NDJK 40483161
TERMSG04 EQU   4                                               @D61SDJK 40490161
TERMSG05 EQU   5                                               @D61NDJK 40498261
TERMSG08 EQU   8                                               @D61NDJK 40513361
TERMSG09 EQU   9                                               @D61NDJK 40528461
TERMSG10 EQU   16                                              @D61NDJK 40543561
TERMSG11 EQU   17                                              @D61NDJK 40558661
TERMSG13 EQU   19                                              @D61NDJK 40573761
TERMSG14 EQU   20                                              @D61NDJK 40588861
TERMSG17 EQU   23                                              @D61NDJK 40603961
TERMSG18 EQU   24                                              @D61NDJK 40619061
TERMSG19 EQU   25                                              @D61NDJK 40634161
TERMSG20 EQU   32                                              @D61NDJK 40649261
TERMSG23 EQU   35                                              @D61NDJK 40664361
TERMSG24 EQU   36                                              @D61NDJK 40679461
TERMSG25 EQU   37                                              @D61NDJK 40694561
TERMSG28 EQU   40                                              @D61NDJK 40709661
TERMSG29 EQU   41                                              @D61NDJK 40724761
TERMSG31 EQU   49                                              @D61NDJK 40739861
TERMSG32 EQU   50                                              @D61NDJK 40754961
TERMSG36 EQU   54                                              @D61NDJK 40770061
TERMSG42 EQU   66                                              @D61NDJK 40785161
TERMSG43 EQU   67                                              @D61NDJK 40800261
TERMSG46 EQU   70                                              @D61SDJK 40807261
TERMSG47 EQU   71                                              @D61NDJK 40815361
TERMSG49 EQU   73                                              @D61NDJK 40830461
TERMSG52 EQU   82                                              @D61SDJK 40837461
TERMSG59 EQU   89                                              @D61NDJK 40845561
TERMSG64 EQU   100                                             @D61NDJK 40860661
TERMSG65 EQU   101                                             @D61NDJK 40875761
TERMSG66 EQU   102                                             @D61SDJK 40882761
*                                                              @D61NDJK 40890861
         LTORG                                                 @D61NDJK 40905961
         EJECT                                                 @D61NDJK 40921061
*                                                              @D61NDJK 40936161
***************************************************************         40936181
*  FUNCTION                                                    @D61SDJK 40936201
*    ASSIGN RECOVERY ATTRIBUTES FOR A TPA-TYPE ERROR           @D61SDJK 40936221
*    CONDITION BY EVALUATING SENSE DATA.                       @D61SDJK 40936241
*                                                              @D61SDJK 40936261
*  INPUT                                                       @D61SDJK 40936281
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61SDJK 40936301
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61SDJK 40936321
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61SDJK 40936341
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61SDJK 40936361
*                                                              @D61SDJK 40936381
*  OUTPUT                                                      @D61SDJK 40936401
*    - RF CONTAINS THE ASSIGNED RECOVERY ATTRIBUTES.           @D61SDJK 40936421
*                                                              @D61SDJK 40936441
***************************************************************         40936461
 AGO  .GNEWT                                                  *#SECURGL 40936481
.LNEWT   AIF ('&TEST'(1,14) NE 'CALL  TERNEWT ').LDOREC       *#SECURGL 40936511
 AIF   ('&I'(2,8)  NE '1,2,3,B '               ).DSINVC       *#SECURGL 40936521
 AIF   ('&O'(2,2)  EQ 'F '                     ).DSHEAD       *#SECURGL 40936541
 AGO  .DSINVC                                                 *#SECURGL 40936561
.GNEWT    ANOP                                                *#SECURGL 40936581
.**************************************************************         40936601
TERNEWT  SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61SDJK 40936621
         USING CCBADR,R1                                       @D61SDJK 40936641
         USING ERBLKADR,R2                                     @D61SDJK 40936661
         USING PUBADR,R3                                       @D61SDJK 40936681
 SGTAP  'SGCOV ERPT610',NR=(13,0) TERNEWT ENTERED               TERNEWT 40936701
*                                                              @D61SDJK 40936741
*------------------------------------------------------------* @D61SDJK 40936761
*                                                              @D61SDJK 40936781
*   VERIFY FORMAT OF SENSE DATA IN SENSE BYTE 7.               @D61SDJK 40936801
*                                                              @D61SDJK 40936821
*------------------------------------------------------------* @D61SDJK 40936841
*                                                              @D61SDJK 40936861
         SLR   RF,RF              INITIALIZE OUTPUT REGISTER   @D61SDJK 40936881
*                                                              @D61SDJK 40936901
         LA    R7,TERNESDF        BEGIN ADDRESS OF FMT. TABLE  @D61SDJK 40936921
         LA    R8,L'TERNESDF      LENGTH OF FMT. TABLE ENTRY   @D61SDJK 40936941
         LA    R9,TERNESFE        END ADDRESS OF FMT. TABLE    @D61SDJK 40936961
TERNE100 CLC   0(1,R7),ERRQSNS+7  IT IS A KNOWN FORMAT?        @D61SDJK 40936981
         BE    TERNE200           YES                          @D61SDJK 40937016
         BXLE  R7,R8,TERNE100     PROCESS NEXT TABLE ENTRY     @D61SDJK 40937021
*                                                              @D61SDJK 40937041
 SGTAP  'SGCOV ERPT610',NR=(13,1) INVALID SENSE DATA FORMAT     TERNEWT 40937081
         L     RF,=AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)    @D61SDJK 40937101
         B     TERNEEX            "INVALID SENSE DATA FORMAT"  @D61SDJK 40937121
*                                                              @D61SDJK 40937141
*------------------------------------------------------------* @D61SDJK 40937161
*                                                              @D61SDJK 40937421
*   HANDLE SOME EXCEPTIONAL ERROR CONDITIONS IDENTIFIED BY     @D61SDJK 40937441
*   REASON AND REASON QUALIFIER CODE IN SENSE BYTES 4 AND 5.   @D61SDJK 40937461
*                                                              @D61SDJK 40937481
*------------------------------------------------------------* @D61SDJK 40937501
*                                                              @D61SDJK 40937502
*------------------------------------------------------------* @D61SDJK 40937503
*   ERROR CONDITION IS ANY KIND OF LIBRARY ATTENTION IN        @D61SDJK 40937504
*   LIBRARY SENSE DATA FORMAT. THESE ERROR CONDITIONS MUST     @D61SDJK 40937505
*   BE IGNORED.                                                @D61SDJK 40937506
*------------------------------------------------------------* @D61SDJK 40937507
*                                                              @D61SDJK 40937508
TERNE200 CLI   ERRQSNS+7,X'23'    IT IS LIBRARY SENSE FORMAT?  @D61SDJK 40937509
         BNE   TERNE300           NO                           @D61SDJK 40937510
         L     RF,=AL1(TERRSURR,TERMSG19,TERMRCM,0)            @D61SDJK 40937511
         CLI   ERRQSNS+4,X'12'    ERROR IS LIBRARY ATTENTION?  @D61SDJK 40937512
         BNE   TERNEEX            NO                           @D61SDJK 40937513
*                                                              @D61SDJK 40937514
 SGTAP  'SGCOV ERPT610',NR=(13,2) LIBRARY ATTENTION SENSE       TERNEWT 40937515
         L     RF,=AL1(TERRRTY,TERMSG20,TERMRCM,0)             @D61SDJK 40937516
         B     TERNEEX            "LIBRARY ATTENTION SENSE"    @D61SDJK 40937517
*                                                              @D61SDJK 40937521
*------------------------------------------------------------* @D61SDJK 40937541
*   ERROR CONDITION IS BACKWARD AT BEGINNING OF VOLUME OR      @D61SDJK 40937561
*   FORWARD AT END OF VOLUME. IF THE FAILING CCW IS A DATA     @D61SDJK 40937581
*   TRANSFER OR MEDIUM FORMAT COMMAND, THE ERROR IS POSTED     @D61SDJK 40937601
*   WITH A UNIT EXCEPTION.                                     @D61SDJK 40937621
*------------------------------------------------------------* @D61SDJK 40937641
*                                                              @D61SDJK 40937661
TERNE300 CLI   ERRQSNS+4,X'30'    ERROR IS BOUNDARY EXCEPTION? @D61SDJK 40937681
         BNE   TERNE310           NO                           @D61SDJK 40937701
         CLI   ERRQSNS+5,X'10'    ERROR IS BACKWARD AT BOV/BOP?@D61SDJK 40937721
         BNE   TERNE305           NO                           @D61SDJK 40937741
         CLI   TERCCCWO,READB     COMMAND CCW IS READ BACKWARD?@D61SDJK 40937761
         BE    TERNE308           YES                          @D61SDJK 40937781
         CLI   TERCCCWO,RDP       COMMAND CCW IS READ PREVIOUS?@D61SDJK 40937801
         BE    TERNE308           YES                          @D61SDJK 40937821
         B     TERNE309                                        @DA44364 40937841
*                                                              @D61SDJK 40937861
TERNE305 CLI   ERRQSNS+5,X'12'    ERROR IS FORWARD AT EOV/EOP? @D61SDJK 40937881
         BNE   TERNE310           NO                           @D61SDJK 40937901
         CLI   TERCCCWO,RDCOM     COMMAND CCW IS IPL READ?     @D61SDJK 40937921
         BE    TERNE308           YES                          @D61SDJK 40937941
         CLI   TERCCCWO,RDF       COMMAND CCW IS READ FORWARD? @D61SDJK 40937961
         BE    TERNE308           YES                          @D61SDJK 40937981
         CLI   TERCCCWO,WRITE     COMMAND CCW IS WRITE?        @D61SDJK 40938001
         BE    TERNE308           YES                          @D61SDJK 40938021
         CLI   TERCCCWO,WTM       COMMAND CCW IS WRITE TM?     @D61SDJK 40938041
         BE    TERNE308           YES                          @D61SDJK 40938061
         CLI   TERCCCWO,DSE       COMMAND CCW IS DSE?          @D61SDJK 40938081
         BE    TERNE308           YES                          @D61SDJK 40938101
         CLI   TERCCCWO,ERG       COMMAND CCW IS ERASE GAP?    @D61SDJK 40938121
         BE    TERNE308           YES                          @D61SDJK 40938141
         CLI   TERCCCWO,WMRK      COMMAND CCW IS WRITE MARK?   @D61SDJK 40938161
         BNE   TERNE310           NO                           @D61SDJK 40938181
*                                                              @D61SDJK 40938201
TERNE308 L     RF,=AL1(TERRIGN,TERMSG20,TERMRCM,TERPSUC+TERPSUE)        40938221
 SGTAP  'SGCOV ERPT610',NR=(13,3) READ/WRITE INTO EOV OR BOV    TERNEWT 40938261
         B     TERNEEX            "READ/WRITE INTO EOV OR BOV" @D61SDJK 40938281
*                                                              @D61SDJK 40938301
TERNE309 L     RF,=AL1(TERRSURR,TERMSG29,TERMRCM,0)            @DA44364 0000000 
 SGTAP  'SGCOV ERPT610',NR=(13,4) BACKWARD AT BOV               TERNEWT 40938261
         B     TERNEEX            "BACKWARD AT BOV"            @DA44364 0000000 
*                                                              @DA44364 0000000 
*------------------------------------------------------------* @D61SDJK 40938321
*   ERROR CONDITION IS MANUAL REWIND OR MANUAL REWIND UNLOAD.  @D61SDJK 40938349
*   THIS ERROR CONDITION IS PRESENTED WITH UNIT CHECK          @D61SDJK 40938357
*   INDICATING UNIT ATTENTION - MEDIUM REMOVED SENSE DATA.     @D61SDJK 40938365
*   WHILE THE ENABLE-MANUAL-REWIND-ASSOCIATION  OR ENABLE-     @D61SDJK 40938373
*   MANUAL-UNLOAD-ASSOCIATION CONTROL IS SET TO ZERO.          @D61SDJK 40938381
*   OTHERWISE THE ERROR CONDITION IS PRESENTED WITH UNIT       @D61SDJK 40938389
*   CHECK INDICATING MEDIUM CHECK - MEDIUM REMOVED SENSE DATA. @D61SDJK 40938397
*   EITHER WAY, FOLLOWING DIFFERENTIATIONS HAVE TO BE DONE:    @D61SDJK 40938405
*   A) FILE WAS OPEN                                           @D61SDJK 40938421
*   B) FILE WAS NOT OPEN, BUT THERE WAS BUFFERED WRITE DATA    @D61SDJK 40938441
*   C) FILE WAS NOT OPEN AND THERE WAS NO BUFFERED WRITE DATA  @D61SDJK 40938461
*                                                              @D61SDJK 40938481
.*  NOTE THAT PB2OPEN BIT ONLY TELLS IF A FILE IS OPEN *NOW*,  @D61SDJK 40938501
.*  NOT WHEN MANUAL REWIND/UNLOAD ACTUALLY HAPPENED, BUT       @D61SDJK 40938521
.*  LIOCS SYNCHRONIZES THE BIT WITH ITS I/O IN SUCH A WAY      @D61SDJK 40938541
.*  THAT THE FILE IS OPEN AT THE TIME THE REWIND/UNLOAD        @D61SDJK 40938561
.*  GETS REPORTED IF AND ONLY IF IT WAS OPEN WHEN THE          @D61SDJK 40938581
.*  REWIND/UNLOAD HAPPENED.                                    @D61SDJK 40938601
.*                                                             @D61SDJK 40938621
*------------------------------------------------------------* @D61SDJK 40938641
*                                                              @D61SDJK 40938661
TERNE310 CLI   ERRQSNS+4,X'11'    ERROR IS UNIT ATTENTION?     @D61SDJK 40938681
         BNE   TERNE311           NO                           @D61SDJK 40938684
         CLI   ERRQSNS+5,X'20'    ERROR IS MEDIUM REMOVED?     @D61SDJK 40938687
         BE    TERNE312           YES                          @D61SDJK 40938690
*                                                              @D61SDJK 40938693
TERNE311 CLI   ERRQSNS+4,X'51'    ERROR IS MEDIUM CHECK?       @D61SDJK 40938696
         BNE   TERNE320           NO                           @D61SDJK 40938701
         CLI   ERRQSNS+5,X'20'    ERROR IS MEDIUM REMOVED?     @D61SDJK 40938721
         BNE   TERNE320           NO                           @D61SDJK 40938741
*                                                              @D61SDJK 40938767
TERNE312 ICM   RF,1,=AL1(TERPSAVR+TERPSCLR+TERPSRBL+TERPSMSG)  @D61SDJK 40938773
 SGTAP  'SGCOV ERPT610',NR=(13,5) ERROR IS MEDIUM REMOVED       TERNEWT 40938801
         TM    TEROEFLG,TEROEFOP  FILE WAS OPEN?               @D61SDJK 40938821
         BO    TERNE315           YES                          @D61SDJK 40938841
*                                 THERE MIGHT BE..             @D61SDJK 40938891
         TM    ERRQSNS+1,X'04'      BUFFERED WRITE DATA?       @D61SDJK 40938921
         BZ    TERNE318           NO                           @D61SDJK 40938951
*                                                              @D61SDJK 40939021
TERNE313 ICM   RF,14,=AL1(TERRURTY,TERMSG47,TERMR90M+TERMRIM)  @D61SDJK 40939041
 SGTAP  'SGCOV ERPT610',NR=(13,6) MANUAL REW/UNL- BUFF. DATA   TERNEWT  40939081
         B     TERNEEX            "MANUAL REW/UNL- BUFF. DATA" @D61SDJK 40939101
*                                                              @D61SDJK 40939121
TERNE315 ICM   RF,14,=AL1(TERRSURR,TERMSG43,TERMR90M+TERMRIM)  @D61SDJK 40939141
 SGTAP  'SGCOV ERPT610',NR=(13,7) MANUAL REW/UNL- VOLUME OPEN  TERNEWT  40939181
         B     TERNEEX            "MANUAL REW/UNL- VOLUME OPEN"@D61SDJK 40939201
*                                                              @D61SDJK 40939221
TERNE318 ICM   RF,14,=AL1(TERRURTY,TERMSG20,TERMR90M+TERMRCM)  @D61SDJK 40939241
         ICM   RF,1,=AL1(TERPSAVR+TERPSCLR+TERPSRBL)           @D61SDJK 40939251
 SGTAP  'SGCOV ERPT610',NR=(14,0) MANUAL REW/UNL W/O BUFF. DATA TERNEWT 40939281
         B     TERNEEX            "MANUAL REW/UNL W/O BUFF.DATA"D61SDJK 40939301
*                                                              @D61SDJK 40939321
*------------------------------------------------------------* @D61SDJK 40939341
*   ERROR CONDITION IS GLOBAL STATUS INTERCEPT.                @D61SDJK 40939361
*   IF THE STATUS CONDITION IS PRESENTED IN ABSENCE OF I/O     @D61SDJK 40939381
*   ACTIVITY, THE ERROR CONDITION SHOULD BE IGNORED. IN ALL    @D61SDJK 40939401
*   OTHER CASES THE UNIT CHECK IS PRESENTED IN INITIAL STATUS  @D61SDJK 40939421
*   TO THE CCW CHAIN'S FIRST COMMAND WHICH CAN BE RETRIED.     @D61SDJK 40939441
*------------------------------------------------------------* @D61SDJK 40939461
*                                                              @D61SDJK 40939481
TERNE320 CLI   ERRQSNS+4,X'22'    ERROR IS PROTECTION EXCEPTION@D61SDJK 40939501
         BNE   TERNE330           NO                           @D61SDJK 40939521
         CLI   ERRQSNS+5,X'31'    ERROR IS GLOBAL STATUS?      @D61SDJK 40939541
         BNE   TERNE330           NO                           @D61SDJK 40939561
         OC    TERCCCWV,TERCCCWV  THERE IS A FAILING CCW?      @D61SDJK 40939581
         BNZ   TERNE325           YES                          @D61SDJK 40939601
*                                                              @D61SDJK 40939621
 SGTAP  'SGCOV ERPT610',NR=(14,1) GLOBAL STATUS - UNSOLICITED   TERNEWT 40939661
         L     RF,=AL1(TERRIGN,TERMSG20,TERMRCM,TERPSUC+TERPSAVR)       40939681
         B     TERNEEX            "GLOBAL STATUS - UNSOLICITED"@D61SDJK 40939701
*                                                              @D61SDJK 40939721
TERNE325 L     RF,=AL1(TERRRTY,TERMSG20,TERMRCM,TERPSAVR)      @D61SDJK 40939741
 SGTAP  'SGCOV ERPT610',NR=(14,2) GLOBAL STATUS - SOLICITED     TERNEWT 40939781
         B     TERNEEX            "GLOBAL STATUS - SOLICITED"  @D61SDJK 40939801
*                                                              @D61SDJK 40939821
*------------------------------------------------------------* @D61SDJK 40939841
*   ERROR CONDITION IS REWIND UNLOAD INITIATED OR REWIND       @D61SDJK 40939861
*   UNLOAD COMPLETE, WHERE END OF VOLUME PROCESSING HAS TO     @D61SDJK 40939881
*   BE DONE.                                                   @D61SDJK 40939901
*------------------------------------------------------------* @D61SDJK 40939921
*                                                              @D61SDJK 40939941
TERNE330 CLI   ERRQSNS+4,X'31'    ERROR IS EXECUTION EXCEPTION?@D61SDJK 40939961
         BNE   TERNE400           NO                           @D61SDJK 40939981
         CLI   ERRQSNS+5,X'22'    ERROR IS RUN INITIATED?      @D61SDJK 40940001
         BE    TERNE335           YES                          @D61SDJK 40940021
         CLI   ERRQSNS+5,X'23'    ERROR IS RUN COMPLETED?      @D61SDJK 40940041
         BNE   TERNE400           NO                           @D61SDJK 40940061
*                                                              @D61SDJK 40940081
TERNE335 L     RF,=AL1(TERREOV,TERMSG20,TERMRCM,TERPSUC+TERPSCLR)       40940101
 SGTAP  'SGCOV ERPT610',NR=(14,3) RUN INITIATED OR COMPLETED    TERNEWT 40940121
         B     TERNEEX            "RUN INITIATED OR COMPLETED" @D61SDJK 40940161
*                                                              @D61SDJK 40940181
*------------------------------------------------------------* @D61SDJK 40940201
*                                                              @D61SDJK 40940221
*   EVALUATE RECOVERY ACTION CODE IN SENSE BYTE 3.             @D61SDJK 40940241
*                                                              @D61SDJK 40940261
*------------------------------------------------------------* @D61SDJK 40940281
*                                                              @D61SDJK 40940301
TERNE400 CLI   ERRQSNS+3,X'C0'    BASIC RECOVERY..             @D61SDJK 40940321
         BE    TERNE410             ACTION SHOULD..            @D61SDJK 40940341
         CLI   ERRQSNS+3,X'D0'      BE SELECTED?               @D61SDJK 40940361
         BNE   TERNE450           NO                           @D61SDJK 40940381
*                                                              @D61SDJK 40940401
TERNE410 TM    ERRQSNS+2,X'C0'    BRA CODE IS DEFERRED REISSUE?@D61SDJK 40940421
         BNO   TERNE420           NO                           @D61SDJK 40940441
 SGTAP  'SGCOV ERPT610',NR=(14,4) BRAC IS INTERVENTION REQUIRED TERNEWT 40940481
         ICM   RF,8,=AL1(TERRIRQ) GET INTERVENTION REQUIRED..  @D61SDJK 40940501
         B     TERNE500             RECOVERY SUBROUTINE INDEX  @D61SDJK 40940521
*                                                              @D61SDJK 40940541
TERNE420 TM    ERRQSNS+2,X'80'    BRA CODE IS REISSUE?         @D61SDJK 40940561
         BZ    TERNE430           NO                           @D61SDJK 40940581
 SGTAP  'SGCOV ERPT610',NR=(14,5) BRAC IS RETRY                 TERNEWT 40940621
         ICM   RF,8,=AL1(TERRRTY) GET RETRY RECOVERY..         @D61SDJK 40940641
         B     TERNE500             SUBROUTINE INDEX           @D61SDJK 40940661
*                                                              @D61SDJK 40940681
TERNE430 TM    ERRQSNS+2,X'40'    BRA CODE IS CONTINUE?        @D61SDJK 40940701
         BZ    TERNE450           NO                           @D61SDJK 40940721
 SGTAP  'SGCOV ERPT610',NR=(14,6) BRAC IS CONTINUE              TERNEWT 40940761
         ICM   RF,8,=AL1(TERRRES) GET RESUME RECOVERY..        @D61SDJK 40940781
         B     TERNE500             SUBROUTINE INDEX           @D61SDJK 40940801
*                                                              @D61SDJK 40940821
TERNE450 LA    R7,TERNERAC        BEGIN ADDRESS OF RAC TABLE   @D61SDJK 40940841
         LA    R8,TERNERAL        LENGTH OF RAC TABLE ENTRY    @D61SDJK 40940861
         LA    R9,TERNERAE        END ADDRESS OF RAC TABLE     @D61SDJK 40940881
TERNE460 CLC   0(1,R7),ERRQSNS+3  IT IS A KNOWN RAC?           @D61SDJK 40940901
         BE    TERNE470           YES                          @D61SDJK 40940921
         BXLE  R7,R8,TERNE460     PROCESS NEXT TABLE ENTRY     @D61SDJK 40940941
*                                                              @D61SDJK 40940961
         L     RF,=AL1(TERRSURR,TERMSG19,TERMRPO+TERMRCM,0)    @D61SDJK 40940981
 SGTAP  'SGCOV ERPT610',NR=(14,7) UNKNOWN RECOVERY ACTION CODE  TERNEWT 40941021
         B     TERNEEX            UNKNOWN RECOVERY ACTION CODE @D61SDJK 40941041
*                                                              @D61SDJK 40941061
TERNE470 ICM   RF,8,1(R7)         GET RECOV. SUBROUTINE INDEX  @D61SDJK 40941081
*                                                              @D61SDJK 40941101
*------------------------------------------------------------* @D61SDJK 40941121
*                                                              @D61SDJK 40941141
*   EVALUATE MESSAGE CODE IN SENSE BYTE 6.                     @D61SDJK 40941161
*                                                              @D61SDJK 40941181
*------------------------------------------------------------* @D61SDJK 40941201
*                                                              @D61SDJK 40941221
TERNE500 CLI   ERRQSNS+4,X'31'    ERROR IS EXECUTION EXCEPTION?@D61SDJK 40941241
         BNE   TERNE530           NO                           @D61SDJK 40941261
         CLI   ERRQSNS+5,X'40'    ERROR IS LOADER CELL EMPTY?  @D61SDJK 40941281
         BE    TERNE510           YES                          @D61SDJK 40941301
         CLI   ERRQSNS+5,X'41'    ERROR IS LOADER CELL FULL?   @D61SDJK 40941321
         BNE   TERNE520           NO                           @D61SDJK 40941341
*                                                              @D61SDJK 40941361
TERNE510 ICM   RF,6,=AL1(TERMSG08,TERMRCM) TAKE INTERVENTION.. @D61SDJK 40941381
         B     TERNE600                      REQUIRED MESSAGE  @D61SDJK 40941401
*                                                              @D61SDJK 40941421
TERNE520 CLI   ERRQSNS+5,X'30'    ERROR IS MSG. DISPLAY IN USE?@D61SDJK 40941441
         BNE   TERNE530           NO                           @D61SDJK 40941461
*                                                              @D61SDJK 40941481
         ICM   RF,6,=AL1(TERMSG23,TERMRCM) TAKE UNSUPPORTED..  @D61SDJK 40941501
         B     TERNE600                      FUNCTION MESSAGE  @D61SDJK 40941521
*                                 MESSAGING ONLY IN CASE OF..  @D61SDJK 40941541
TERNE530 ICM   RF,6,=AL1(TERMSG20,TERMRCM)  UNSUCC. RECOVERY   @D61SDJK 40941561
         CLI   ERRQSNS+6,X'00'    A MESSAGE IS REQUESTED?      @D61SDJK 40941581
         BE    TERNE600           NO, MESSAGING IS NO NEED     @D61SDJK 40941601
*                                                              @D61SDJK 40941621
         CLI   ERRQSNS+3,X'D2'    RAC IS READ ALT. RECOVERY?   @D61SDJK 40941641
         BE    TERNE550           YES                          @D61SDJK 40941661
         CLI   ERRQSNS+3,X'26'    RAC IS READ OPP. RECOVERY?   @D61SDJK 40941681
         BE    TERNE550           YES                          @D61SDJK 40941701
*                                                              @D61SDJK 40941721
TERNE540 ICM   RF,2,=AL1(TERMRIM) DO ALWAYS MESSAGING          @D61SDJK 40941741
 SGTAP  'SGCOV ERPT610',NR=(15,0) DO UNCONDITIONAL MESSAGING    TERNEWT 40941761
*                                                              @D61SDJK 40941781
TERNE550 LA    R7,TERNEMSG        BEGIN ADDRESS OF MSG. TABLE  @D61SDJK 40941801
         LA    R8,TERNEMSL        LENGTH OF MSG. TABLE ENTRY   @D61SDJK 40941821
         LA    R9,TERNEMSE        END ADDRESS OF MSG. TABLE    @D61SDJK 40941841
TERNE560 CLC   0(1,R7),ERRQSNS+6  IT IS A KNOWN MESSAGE CODE?  @D61SDJK 40941861
         BE    TERNE570           YES                          @D61SDJK 40941881
         BXLE  R7,R8,TERNE560     PROCESS NEXT TABLE ENTRY     @D61SDJK 40941901
*                                                              @D61SDJK 40941921
         ICM   RF,4,=AL1(TERMSG19)                             @D61SDJK 40941941
 SGTAP  'SGCOV ERPT610',NR=(15,1) UNKNOWN MESSAGE CODE          TERNEWT 40941961
         B     TERNE600           UNKNOWN MESSAGE CODE         @D61SDJK 40942001
*                                                              @D61SDJK 40942021
TERNE570 ICM   RF,4,1(R7)         GET ERP MESSAGE NUMBER       @D61SDJK 40942041
*                                                              @D61SDJK 40942061
*------------------------------------------------------------* @D61SDJK 40942081
*                                                              @D61SDJK 40942101
*   EVALUATE LOGGING CODE IN SENSE BYTE 2 AND HANDLE SOME      @D61SDJK 40942121
*   ERROR CONDITIONS WHERE NO RECORDING SHOULD BE DONE.        @D61SDJK 40942141
*                                                              @D61SDJK 40942161
*------------------------------------------------------------* @D61SDJK 40942181
*                                                              @D61SDJK 40942201
TERNE600 CLI   ERRQSNS+4,X'50'    IT IS A DATA CHECK?          @D61SDJK 40942221
         BNE   TERNE605           NO                           @D61SDJK 40942241
         CLI   ERRQSNS+5,X'20'    TAPE FORMAT IS SUPPORTED?    @D61SDJK 40942261
         BE    TERNE700           NO                           @D61SDJK 40942281
         CLI   ERRQSNS+5,X'50'    FORMAT AT BOV IS FOUND?      @D61SDJK 40942301
         BE    TERNE700           NO                           @D61SDJK 40942321
         CLI   ERRQSNS+5,X'51'    FORMAT BEYOND BOV IS FOUND?  @D61SDJK 40942341
         BE    TERNE700           NO                           @D61SDJK 40942361
*                                                              @D61SDJK 40942381
TERNE605 CLI   ERRQSNS+4,X'51'    IT IS A MEDIUM CHECK?        @D61SDJK 40942401
         BNE   TERNE610           NO                           @D61SDJK 40942421
         CLI   ERRQSNS+5,X'10'    MEDIUM IS SUPPORTED?         @D61SDJK 40942441
         BE    TERNE700           NO                           @D61SDJK 40942461
*                                                              @D61SDJK 40942481
TERNE610 CLI   ERRQSNS+3,X'4D'    RAC IS RESETTING EVENT?      @D61SDJK 40942501
         BE    TERNE700           YES                          @D61SDJK 40942521
*                                                              @D61SDJK 40942541
TERNE615 CLI   ERRQSNS+3,X'50'    RAC IS READ DEVICE LOG?      @D61SDJK 40942561
         BNE   TERNE620           NO                           @D61SDJK 40942581
*                                 DO RECORDING OF BUFFERED..   @D61SDJK 40942601
         O     RF,=AL1(0,0,TERMR91M,TERPSRBL)     LOG DATA     @D61SDJK 40942621
 SGTAP  'SGCOV ERPT610',NR=(15,2) RECORDING OF BUFFERED LOG     TERNEWT 40942641
         B     TERNE625                                        @DA44364 0000000 
*                                                              @D61SDJK 0000000 
TERNE620 CLI   ERRQSNS+3,X'51'    RAC IS READ DEVICE LOG EOV?  @DA44364 0000000 
         BNE   TERNE625           NO                           @DA44364 0000000 
*                                 DO RECORDING OF BUFFERED..   @DA44364 0000000 
         O     RF,=AL1(0,0,TERMR90M,TERPSRBL)     LOG DATA     @DA44364 0000000 
 SGTAP  'SGCOV ERPT610',NR=(15,3) RECORDING OF BUFFERED LOG EOV TERNEWT 0000000 
*                                                              @DA44364 0000000 
TERNE625 SLR   R9,R9              TEMPORARY OBR OR..           @DA44364 0000000 
         TM    ERRQSNS+2,X'08'      A3 IS TO BE RECORDED?      @D61SDJK 40942721
         BZ    TERNE630           NO                           @D61SDJK 40942741
*                                                              @D61SDJK 40942761
         TM    ERRQSNS+2,X'10'    A3 IS TO BE RECORDED?        @D61SDJK 40942781
         BZ    TERNE640           NO, IT IS A TEMPORARY OBR    @D61SDJK 40942801
*                                                              @D61SDJK 40942821
 SGTAP  'SGCOV ERPT610',NR=(15,4) LOG AN A3 RECORD              TERNEWT 40942841
         ICM   R9,2,=AL1(TERMRA3) LOG AN A3 RECORD             @D61SDJK 40942881
         B     TERNE650                                        @D61SDJK 40942901
*                                                              @D61SDJK 40942921
TERNE630 TM    ERRQSNS+2,X'10'    PERM. OBR IS TO BE RECORDED? @D61SDJK 40942941
         BZ    TERNE700           NO, NOTHING IS TO BE RECORDED@D61SDJK 40942961
*                                                              @D61SDJK 40942981
 SGTAP  'SGCOV ERPT610',NR=(15,5) LOG A PERMANENT OBR RECORD    TERNEWT 40943021
         ICM   R9,2,=AL1(TERMRPO) LOG A PERMANENT OBR RECORD   @D61SDJK 40943041
         B     TERNE650                                        @D61SDJK 40943061
*                                                              @D61SDJK 40943081
TERNE640 ICM   R9,2,=AL1(TERMRTO) LOG A TEMPORARY OBR RECORD   @D61SDJK 40943101
 SGTAP  'SGCOV ERPT610',NR=(15,6) LOG A TEMPORARY OBR RECORD    TERNEWT 40943141
*                                                              @D61SDJK 40943161
TERNE650 OR    RF,R9              COPY RECORDING ATTRIBUTES    @D61SDJK 40943181
*                                                              @D61SDJK 40943201
*------------------------------------------------------------* @D61SDJK 40943221
*                                                              @D61SDJK 40943241
*   ASSIGN POSTING ATTRIBUTES FOR SOME ERROR CONDITIONS.       @D61SDJK 40943261
*                                                              @D61SDJK 40943281
*------------------------------------------------------------* @D61SDJK 40943301
*                                                              @D61SDJK 40943321
TERNE700 SLR   R9,R9              CLEAR WORK REGISTER          @D61SDJK 40943341
         CLI   ERRQSNS+4,X'50'    IT IS A DATA CHECK?          @D61SDJK 40943361
         BNE   TERNE750           NO                           @D61SDJK 40943381
*                                                              @D61SDJK 40943401
         CLI   ERRQSNS+5,X'20'    IT IS UNSUPP. FORMAT?        @D61SDJK 40943421
         BE    TERNE750           YES                          @D61SDJK 40943441
         CLI   ERRQSNS+5,X'21'    IT IS UNSUPP. READ LENGTH?   @D61SDJK 40943461
         BE    TERNE750           YES                          @D61SDJK 40943481
         CLI   ERRQSNS+5,X'22'    IT IS UNSUPP. COMP.ALGORITHM?@D61SDJK 40943501
         BE    TERNE750           YES                          @D61SDJK 40943521
         CLI   ERRQSNS+5,X'50'    IT IS NO FORMAT AT BOV?      @D61SDJK 40943541
         BE    TERNE750           YES                          @D61SDJK 40943561
         CLI   ERRQSNS+5,X'51'    IT IS NO FORMAT BEYOND BOV?  @D61SDJK 40943581
         BE    TERNE750           YES                          @D61SDJK 40943601
*                                                              @D61SDJK 40943621
 SGTAP  'SGCOV ERPT610',NR=(15,7) INCREMENT PUB2 COUNTERS       TERNEWT 40943661
         IC    R9,=AL1(TERPSCNT)  INCREMENT PUB2 COUNTERS      @D61SDJK 40943681
*                                                              @D61SDJK 40943701
TERNE730 CLI   ERRQSNS+5,X'10'    IT IS A READ DATA CHECK?     @D61SDJK 40943721
         BE    TERNE740           YES                          @D61SDJK 40943741
         CLI   ERRQSNS+5,X'11'    IT IS A TAPE VOID ERROR?     @D61SDJK 40943761
         BE    TERNE740           YES                          @D61SDJK 40943781
         CLI   ERRQSNS+5,X'12'    IT IS A BLOCK SEQUENCE ERROR?@D61SDJK 40943801
         BNE   TERNE750           NO                           @D61SDJK 40943821
 SGTAP  'SGCOV ERPT610',NR=(16,0) UPDATE PUB2 AND POST READ DC. TERNEWT 40943861
*                                 INCREMENT PUB2 COUNTERS..    @D61SDJK 40943881
TERNE740 IC    R9,=AL1(TERPSRDC+TERPSCNT)   AND POST READ..    @D61SDJK 40943901
         B     TERNE780                     DATA CHECK         @D61SDJK 40943931
*                                                              @D61SDJK 40943941
TERNE750 CLI   ERRQSNS+4,X'11'    IT IS A UNIT ATTENTION       @D61SDJK 40943962
         BNE   TERNE755           NO                           @D61SDJK 40943964
         CLI   ERRQSNS+5,X'00'    IT IS A MIM?                 @D61SDJK 40943965
         BE    TERNE760           YES                          @D61SDJK 40943966
         CLI   ERRQSNS+5,X'01'    IT IS A SUBSYSTEM SIM?       @D61SDJK 40943967
         BE    TERNE760           YES                          @D61SDJK 40943968
         CLI   ERRQSNS+5,X'02'    IT IS A DEVICE SIM?          @D61SDJK 40943969
         BE    TERNE760           YES                          @D61SDJK 40943970
*                                                              @D61SDJK 40943971
TERNE755 CLI   ERRQSNS+4,X'12'    IT IS A LIBRARY ATTENTION?   @D61SDJK 40943972
         BNE   TERNE780           NO                           @D61SDJK 40943973
         CLI   ERRQSNS+5,X'00'    IT IS A LIBRARY SIM?         @D61SDJK 40943974
         BNE   TERNE780           NO                           @D61SDJK 40943975
*                                 MESSAGE MUST BE ISSUED..     @D61SDJK 40943976
TERNE760 IC    R9,=AL1(TERPSMSG)    EVEN FOR A SYSTEM TASK     @D61SDJK 40943977
         TM    ERRQSNS+9,X'C0'    REQUEST FOR SERVICE          @DY45817         
         BZ    TERNE780           YES, NO NEED TO HIGHLIGHT    @DY45817         
         OI    TERFLG,TERCVHIG    MESSAGE HIGHLIGHTING         @D63HDJK 40943978
 SGTAP  'SGCOV ERPT610',NR=(16,1) ISSUE MESSAGE FOR SVT TASK    TERNEWT 40943979
*                                                              @D61SDJK 40943980
TERNE780 OR    RF,R9              COPY POSTING ATTRIBUTES      @D61SDJK 40943981
*                                                              @D61SDJK 40943982
*------------------------------------------------------------* @D61SDJK 40944001
*                                                              @D61SDJK 40944021
*   EXIT HANDLING                                              @D61SDJK 40944041
*                                                              @D61SDJK 40944061
*------------------------------------------------------------* @D61SDJK 40944081
*                                                              @D61SDJK 40944101
TERNEEX  SGTAP 'RETURN         ','RETURN TO CALLER',           @D61SDJKX40944121
               OUTPUT=(RF)                                     @D61SDJK 40944141
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61SDJK 40944161
*                                                              @D61SDJK 40944181
*------------------------------------------------------------* @D61SDJK 40944201
*                                                              @D61SDJK 40944221
*   LOCAL VARIABLES USED IN TERNEWT                            @D61SDJK 40944241
*                                                              @D61SDJK 40944261
*------------------------------------------------------------* @D61SDJK 40944281
*                                                              @D61SDJK 40944301
*------------------------------------------------------------* @D61SDJK 40944321
*   TPA SENSE DATA FORMAT TABLE                                @D61SDJK 40944341
*------------------------------------------------------------* @D61SDJK 40944361
*                               THE SENSE DATA FORMAT..        @D61SDJK 40944381
*                                 TABLE CONTAINS ALL..         @D61SDJK 40944401
*                                 SENSE DATA FORMATS..         @D61SDJK 40944421
         DS    0H                 VALID FOR A TPA DEVICE       @D61SDJK 40944441
TERNESDF DC    AL1(X'23')           LIBRARY SENSE              @D61SDJK 40944467
         DC    AL1(X'40')           UNSOLICITED SENSE          @D61SDJK 40944473
         DC    AL1(X'41')           COMMAND REJECT SENSE       @D61SDJK 40944481
         DC    AL1(X'50')           COMMAND EXECUTION SENSE 0  @D61SDJK 40944501
         DC    AL1(X'51')           COMMAND EXECUTION SENSE 1  @D61SDJK 40944521
         DC    AL1(X'60')           EVENT SENSE 0              @D61SDJK 40944541
         DC    AL1(X'61')           EVENT SENSE 1              @D61SDJK 40944561
         DC    AL1(X'70')           MIM SENSE                  @D61SDJK 40944581
TERNESFE DC    AL1(X'71')           SIM SENSE                  @D61SDJK 40944601
*                                                              @D61SDJK 40944621
*------------------------------------------------------------* @D61SDJK 40944641
*   TPA RECOVERY ACTION CODE TABLE                             @D61SDJK 40944661
*------------------------------------------------------------* @D61SDJK 40944681
*                               THE RAC TABLE CONTAINS..       @D61SDJK 40944701
*                                 A RECOVERY SUBROUTINE..      @D61SDJK 40944721
*                                 INDEX FOR ALL DEFINED..      @D61SDJK 40944741
         DS    0H                 RECOVERY ACTION CODES        @D61SDJK 40944761
TERNERAC DC    AL1(X'26',TERRROR)   READ OPPOSITE              @D61SDJK 40944781
         DC    AL1(X'27',TERRSURR)  PERMANENT ERROR            @D61SDJK 40944801
         DC    AL1(X'29',TERRSURR)  PERMANENT ERROR            @D61SDJK 40944821
         DC    AL1(X'45',TERRSURR)  ASSIGNED ELSEWHERE         @D61SDJK 40944841
         DC    AL1(X'4D',TERRRTY)   RESETTING EVENT            @D61SDJK 40944861
         DC    AL1(X'50',TERRRTY)   READ DEVICE LOG            @D61SDJK 40944881
         DC    AL1(X'51',TERRRTY)   READ DEVICE LOG EOV        @DA44364 40944881
         DC    AL1(X'53',TERRRTY)   SPECIAL INTERCEPT          @D61SDJK 40944901
         DC    AL1(X'C0',TERRSURR)  BASIC RECOVERY ACTION      @D61SDJK 40944921
         DC    AL1(X'C1',TERRFDEV)  FENCE DEVICE               @D61SDJK 40944941
         DC    AL1(X'C2',TERRFPAT)  FENCE DEVICE PATH          @D61SDJK 40944961
         DC    AL1(X'C6',TERRLBY)   LONG BUSY                  @D61SDJK 40944981
         DC    AL1(X'D0',TERRSURR)  SWAP DEVICE (DDR)          @D61SDJK 40945001
TERNERAE DC    AL1(X'D2',TERRRAR)   READ ALTERNATE             @D61SDJK 40945021
TERNERAL EQU   *-TERNERAE                                      @D61SDJK 40945041
*                                                              @D61SDJK 40945061
*------------------------------------------------------------* @D61SDJK 40945081
*   TPA MESSAGE TABLE                                          @D61SDJK 40945101
*------------------------------------------------------------* @D61SDJK 40945121
*                               THE MESSAGE TABLE..            @D61SDJK 40945141
*                                 CONTAINS A MESSAGE FOR..     @D61SDJK 40945161
         DS    0H                 ALL DEFINED MESSAGE CODES    @D61SDJK 40945181
TERNEMSG DC    AL1(X'00',TERMSG20)  RECOVY ERR                 @D61SDJK 40945201
         DC    AL1(X'10',TERMSG20)  RECOVY ERR                 @D61SDJK 40945221
         DC    AL1(X'11',TERMSG03)  DEV IN USE                 @D61SDJK 40945241
         DC    AL1(X'12',TERMSG23)  UNSUP FUNC                 @D61SDJK 40945261
         DC    AL1(X'20',TERMSG18)  COMM REJCT                 @D61SDJK 40945281
         DC    AL1(X'21',TERMSG10)  EQUIP CHK                  @D61SDJK 40945301
         DC    AL1(X'22',TERMSG17)  FILE PROT                  @D61SDJK 40945321
         DC    AL1(X'23',TERMSG17)  FILE PROT                  @D61SDJK 40945341
         DC    AL1(X'24',TERMSG32)  NON COMPAT                 @D61SDJK 40945361
         DC    AL1(X'25',TERMSG32)  NON COMPAT                 @D61SDJK 40945381
         DC    AL1(X'26',TERMSG17)  WORM OVERWRITE ATTEMPT     @D28DR06 40945381
         DC    AL1(X'31',TERMSG29)  AT LOADPT                  @D61SDJK 40945401
         DC    AL1(X'33',TERMSG13)  END OF VOL                 @D61SDJK 40945421
         DC    AL1(X'34',TERMSG36)  NO REC FND                 @D61SDJK 40945441
         DC    AL1(X'35',TERMSG36)  NO REC FND                 @D61SDJK 40945461
         DC    AL1(X'36',TERMSG36)  NO REC FND                 @D28DR06 40945461
         DC    AL1(X'37',TERMSG36)  NO REC FND                 @D28DR06 40945461
         DC    AL1(X'38',TERMSG36)  NO REC FND                 @D28DR06 40945461
         DC    AL1(X'40',TERMSG08)  INTERV REQ                 @D61SDJK 40945481
         DC    AL1(X'41',TERMSG08)  INTERV REQ                 @D61SDJK 40945501
         DC    AL1(X'42',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40945521
         DC    AL1(X'50',TERMSG11)  DATA CHECK                 @D61SDJK 40945541
         DC    AL1(X'51',TERMSG11)  DATA CHECK                 @D61SDJK 40945561
         DC    AL1(X'52',TERMSG11)  DATA CHECK                 @D61SDJK 40945581
         DC    AL1(X'53',TERMSG11)  DATA CHECK                 @D61SDJK 40945601
         DC    AL1(X'54',TERMSG32)  NON COMPAT                 @D61SDJK 40945621
         DC    AL1(X'55',TERMSG32)  NON COMPAT                 @D61SDJK 40945641
         DC    AL1(X'56',TERMSG46)  LOST POS'G                 @D61SDJK 40945661
         DC    AL1(X'57',TERMSG32)  NON COMPAT                 @D61SDJK 40945681
         DC    AL1(X'59',TERMSG19)  WORM UNWRITTEN DEFERRED TM @D28DR06 40945681
         DC    AL1(X'60',TERMSG32)  NON COMPAT                 @D61SDJK 40945701
         DC    AL1(X'61',TERMSG32)  NON COMPAT                 @D61SDJK 40945721
         DC    AL1(X'62',TERMSG43)  TAPEVOL CH                 @D61SDJK 40945741
         DC    AL1(X'64',TERMSG08)  INTERV REQ                 @D61SDJK 40945761
         DC    AL1(X'65',TERMSG08)  INTERV REQ                 @D61SDJK 40945781
         DC    AL1(X'70',TERMSG10)  EQUIP CHK                  @D61SDJK 40945801
         DC    AL1(X'71',TERMSG09)  BUSOUT CHK                 @D61SDJK 40945821
         DC    AL1(X'72',TERMSG09)  BUSOUT CHK                 @D61SDJK 40945841
         DC    AL1(X'73',TERMSG10)  EQUIP CHK                  @D61SDJK 40945861
         DC    AL1(X'74',TERMSG14)  OVERRUN                    @D61SDJK 40945881
         DC    AL1(X'75',TERMSG10)  EQUIP CHK                  @D61SDJK 40945901
         DC    AL1(X'90',TERMSG49)  PERM ERROR                 @D61SDJK 40945921
         DC    AL1(X'91',TERMSG04)  PATH FENCE                 @D61SDJK 40945941
         DC    AL1(X'A0',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40945961
         DC    AL1(X'A1',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40945981
         DC    AL1(X'A2',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946001
         DC    AL1(X'A3',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946021
         DC    AL1(X'A4',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946041
         DC    AL1(X'A5',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946061
         DC    AL1(X'A6',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946081
         DC    AL1(X'A7',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946101
         DC    AL1(X'A8',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946121
         DC    AL1(X'A9',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946141
         DC    AL1(X'AA',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946161
         DC    AL1(X'AB',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946181
         DC    AL1(X'AC',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946201
         DC    AL1(X'AD',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946221
         DC    AL1(X'AE',TERMSG19)  UNDET ERR - TAPE LIBRARY   @D61SDJK 40946241
         DC    AL1(X'F0',TERMSG65)  MEDIA ERR                  @D61SDJK 40946261
         DC    AL1(X'F1',TERMSG66)  SUBSYS INF                 @D61SDJK 40946281
         DC    AL1(X'F2',TERMSG64)  MAINT REQD                 @D61SDJK 40946301
TERNEMSE DC    AL1(X'F3',TERMSG64)  MAINT REQD                 @D61SDJK 40946331
TERNEMSL EQU   *-TERNEMSE                                      @D61SDJK 40946341
*                                                              @D61SDJK 40946361
         LTORG                                                 @D61SDJK 40948241
         EJECT                                                 @D61SDJK 40948261
*                                                              @D61SDJK 40948281
***************************************************************         40951261
*  FUNCTION                                                    @D61NDJK 40966361
*    PERFORM THE ASSIGNED RECOVERY ACTION.                     @D61NDJK 40981461
*                                                              @D61NDJK 40996561
*  INPUT                                                       @D61NDJK 41011661
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61NDJK 41026761
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 41041861
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61NDJK 41056961
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61NDJK 41064461
*                                                              @D61NDJK 41072061
*  OUTPUT                                                      @D61NDJK 41087161
*    - RF CONTAINS AN ERROR RECOVERY COMPLETION CODE, THAT     @D61NDJK 41102261
*         WILL INDICATE IF ANY RECOVERY ACTION WAS PERFORMED   @D61NDJK 41117361
*         AND WHETHER THE RECOVERY WAS SUCCESSFUL OR NOT.      @D61NDJK 41132461
*         POSSIBLE COMPLETION CODES ARE:                       @D61NDJK 41147561
*         TERERSUC  -  SUCCESSFUL RECOVERY                     @D61NDJK 41162661
*         TERERUNS  -  RECOVERY EXHAUSTED OR UNSUCCESSFUL      @D61NDJK 41177761
*         TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED        @D61NDJK 41192861
*                                                              @D61NDJK 41207961
***************************************************************         41223061
 AGO  .GDOREC                                                 *#SECURGL 41238161
.LDOREC  AIF ('&TEST'(1,14) NE 'CALL  TERDOREC').LRBL         *#SECURGL 41253261
 AIF   ('&I'(2,8)  NE '1,2,3,B '               ).DSINVC       *#SECURGL 41268361
 AIF   ('&O'(2,2)  EQ 'F '                     ).DSHEAD       *#SECURGL 41283461
 AGO  .DSINVC                                                 *#SECURGL 41298561
.GDOREC   ANOP                                                *#SECURGL 41313661
.**************************************************************         41328761
TERDOREC SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 41343861
         USING CCBADR,R1                                       @D61NDJK 41358961
         USING ERBLKADR,R2                                     @D61NDJK 41374061
         USING PUBADR,R3                                       @D61NDJK 41389161
*                                                              @D61NDJK 41404261
*------------------------------------------------------------* @D61NDJK 41419361
*   PERFORM READ BUFFERD LOG RECOVERY, IF APPROPRIATE.         @D61NDJK 41434461
*------------------------------------------------------------* @D61NDJK 41449561
*                                                              @D61NDJK 41464661
         TM    TERFLGPS,TERPSRBL  READ BUFFERED LOG RECOVERY?  @D61SDJK 41486751
         BZ    TERDO200           NO                           @D61NDJK 41494861
*                                                              @D61NDJK 41509961
 SGTAP  'CALL  TERRBL          ','PERFORM READ    ',           @D61NDJKX41525061
               I='1,2,3,B           BUFFERED',                 @D61NDJKX41540161
               O='NONE              LOG RECOVERY',             @D61NDJKX41555261
               E0='TERDO100       ERROR: RBL UNSUCCESSFUL'     @D61NDJK 41570361
*                                                              @D61NDJK 41585461
         B     TERDO200           RBL RECOVERY WAS SUCCESSFUL  @D61NDJK 41600561
*                                                              @D61NDJK 41615661
*------------------------------------------------------------* @D61NDJK 41630761
*   IF READ BUFFERED LOG RECOVERY WAS UNSUCCESSFUL, OR         @D61SDJK 41652851
*   LOG DATA INDICATES THAT RECORDING IS NOT REASONABLE, NO    @D61SDJK 41659841
*   MDR RECORD WILL BE WRITTEN.                                @D61SDJK 41666831
*------------------------------------------------------------* @D61NDJK 41676061
*                                                              @D61NDJK 41691161
TERDO100 NI    TERFLGMR,XFF-TERMRMDR                           @D61NDJK 41706261
*                                                              @D61NDJK 41721361
*------------------------------------------------------------* @D61NDJK 41736461
*   IF IT IS A RECORDING ONLY REQUEST, WE MUST NOT PERFORM     @D61NDJK 41751561
*   ANY RECOVERY ACTION.                                       @D61NDJK 41766661
*------------------------------------------------------------* @D61NDJK 41781761
*                                                              @D61NDJK 41796861
TERDO200 TM    TEROEFLG,TEROEMEL  RECOVERY ACTION MUST BE DONE?@D61NDJK 41811961
         BZ    TERDO300           YES, SELECT RECOVERY ACTION  @D61NDJK 41827061
*                                                              @D61NDJK 41842161
         LA    RF,TERERUNS        INDICATE UNSUCCESSFUL..      @D61NDJK 41857261
         B     TERDOEX              RECOVERY AND LEAVE TERDOREC@D61NDJK 41872361
*                                                              @D61NDJK 41887461
*------------------------------------------------------------* @D61NDJK 41902561
*   EXECUTE WHAT IS GIVEN AS SUBROUTINE IN THE RECOVERY        @D61NDJK 41917661
*   ATTRIBUTE FOR THIS KIND OF ERROR CONDITION.                @D61NDJK 41932761
*------------------------------------------------------------* @D61NDJK 41947861
*                                                              @D61NDJK 41962961
TERDO300 SLR   R5,R5              GET RECOVERY SUBROUTINE..    @D61NDJK 41978061
         IC    R5,TERRCVSR          INDEX AND BRANCH TO..      @D61NDJK 41993161
         B     TERSRTAB(R5)         SELECTED SUBROUTINE        @D61NDJK 42008261
*                                                              @D61NDJK 42023361
TERSRTAB DS    0H                 RECOVERY SUBROUTINE TABLE    @D61NDJK 42038461
*                                                              @D61NDJK 42053561
TERRIGN  EQU   (*-TERSRTAB)       IGNORE                       @D61NDJK 42068661
         B     TERDOIGN                                        @D61NDJK 42083761
TERRSURR EQU   (*-TERSRTAB)       UNCONDITIONAL SURRENDER      @D61NDJK 42098861
         B     TERDOSUR                                        @D61NDJK 42113961
TERRRTY  EQU   (*-TERSRTAB)       RETRY FAILING CCW            @D61NDJK 42129061
         B     TERDORTY                                        @D61NDJK 42144161
TERRROR  EQU   (*-TERSRTAB)       READ OPPOSITE RECOVERY       @D61NDJK 42159261
         B     TERDOROR                                        @D61NDJK 42174361
TERRIRQ  EQU   (*-TERSRTAB)       INTERVENTION REQUIRED..      @D61NDJK 42189461
         B     TERDOIRQ             RECOVERY                   @D61NDJK 42204561
TERRCHKR EQU   (*-TERSRTAB)       CHANNEL DATA CHECK /CHANNEL..@D61NDJK 42249861
         B     TERDOCHK             CHAINING CHECK RECOVERY    @D61NDJK 42264961
TERREOV  EQU   (*-TERSRTAB)       END OF VOLUME PROCESSING     @D61NDJK 42280061
         B     TERDOEOV                                        @D61NDJK 42295161
TERRURTY EQU   (*-TERSRTAB)       USER RETRY RECOVERY          @D61NDJK 42297661
         B     TERDOURT                                        @D61NDJK 42300161
TERRRES  EQU   (*-TERSRTAB)       RESUME AFTER FAILING CCW     @D61SDJK 42300361
         B     TERDORES                                        @D61SDJK 42300561
TERRRAR  EQU   (*-TERSRTAB)       READ ALTERNATE RECOVERY      @D61SDJK 42300761
         B     TERDORAR                                        @D61SDJK 42300961
TERRLBY  EQU   (*-TERSRTAB)       LONG BUSY RECOVERY           @D61SDJK 42301161
         B     TERDOLBY                                        @D61SDJK 42301361
TERRFDEV EQU   (*-TERSRTAB)       FENCE DEVICE                 @D61SDJK 42301561
         B     TERDOFDV                                        @D61SDJK 42301761
TERRFPAT EQU   (*-TERSRTAB)       FENCE DEVICE PATH            @D61SDJK 42301961
         B     TERDOFPT                                        @D61SDJK 42302161
         AGO   .NOUNL40                                        @D61NDJK 42302661
TERRUNLR EQU   (*-TERSRTAB)       REWIND UNLOAD RECOVERY WITH..@D61NDJK 42310261
         B     TERDOUNL             RETRY OF FAILING CCW       @D61NDJK 42321561
.NOUNL40 ANOP                                                  @D61NDJK 42332861
*                                                              @D61NDJK 42340461
*------------------------------------------------------------* @D61NDJK 42355561
*                                                              @D61NDJK 42370661
*  FUNCTION                                                    @D61NDJK 42385761
*    IGNORE THE ERROR CONDITION.                               @D61NDJK 42400861
*                                                              @D61NDJK 42415961
*  POSSIBLE COMPLETION CODES ARE:                              @D61NDJK 42431061
*    TERERSUC  -  SUCCESSFUL RECOVERY                          @D61NDJK 42446161
*                                                              @D61NDJK 42461261
*------------------------------------------------------------* @D61NDJK 42476361
*                                                              @D61NDJK 42491461
TERDOIGN LA    RF,TERERSUC        RECOVERY WAS SUCCESSFUL      @D61NDJK 42506561
 SGTAP  'SGCOV ERPT610',NR=(17,0) RECOVERY ACTION IS IGNORE    TERDOREC 42528651
         B     TERDOEX            TAKE COMPLETION CODE         @D61NDJK 42536761
*                                                              @D61NDJK 42551861
*------------------------------------------------------------* @D61NDJK 42566961
*                                                              @D61NDJK 42582061
*  FUNCTION                                                    @D61NDJK 42597161
*    RECOGNIZE IRRECOVERABLE ERROR CONDITION.                  @D61NDJK 42612261
*                                                              @D61NDJK 42627361
*  POSSIBLE COMPLETION CODES ARE:                              @D61NDJK 42642461
*    TERERUNS  -  RECOVERY EXHAUSTED OR UNSUCCESSFUL           @D61NDJK 42657561
*                                                              @D61NDJK 42672661
*------------------------------------------------------------* @D61NDJK 42687761
*                                                              @D61NDJK 42702861
TERDOSUR LA    RF,TERERUNS        RECOVERY WAS UNSUCCESSFUL    @D61NDJK 42717961
 SGTAP  'SGCOV ERPT610',NR=(17,1) RECOVERY ACTION IS SURRENDER TERDOREC 42740051
         B     TERDOEX            RETURN COMPLETION CODE       @D61NDJK 42748161
*                                                              @D61NDJK 42763261
*------------------------------------------------------------* @D61NDJK 42778361
*                                                              @D61NDJK 42793461
*  FUNCTION                                                    @D61NDJK 42808561
*    RETRY THE FAILING CCW.                                    @D61NDJK 42823661
*                                                              @D61NDJK 42838761
*  POSSIBLE COMPLETION CODES ARE:                              @D61NDJK 42853861
*    TERERSUC  -  SUCCESSFUL RECOVERY                          @D61NDJK 42868961
*    TERERUNS  -  RECOVERY EXHAUSTED OR UNSUCCESSFUL           @D61NDJK 42884061
*    TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED             @D61NDJK 42899161
*                                                              @D61NDJK 42914261
*------------------------------------------------------------* @D61NDJK 42929361
*                                                              @D61NDJK 42944461
TERDORTY DS    0H                                              @D61NDJK 42959561
 SGTAP  'SGCOV ERPT610',NR=(17,2) RECOVERY ACTION IS RETRY CCW TERDOREC 42981651
*                                                              @D61NDJK 42989761
 SGTAP  'CALL  TERRTY          ','RETRY FAILING CCW',          @D61NDJKX43004861
               I='1,2,3,B           ON RETURN',                @D61NDJKX43019961
               O='F                 RF IS RETURN CODE'         @D61NDJK 43035061
*                                                              @D61NDJK 43050161
         B     TERDOEX            RETURN COMPLETION CODE       @D61NDJK 43065261
*                                                              @D61NDJK 43080361
*------------------------------------------------------------* @D61NDJK 43095461
*                                                              @D61NDJK 43110561
*  FUNCTION                                                    @D61NDJK 43125661
*    DO READ OPPOSITE RECOVERY.                                @D61NDJK 43140761
*                                                              @D61NDJK 43155861
*  POSSIBLE COMPLETION CODES ARE:                              @D61NDJK 43158361
*    TERERSUC  -  SUCCESSFUL RECOVERY                          @D61NDJK 43160861
*    TERERUNS  -  RECOVERY EXHAUSTED OR UNSUCCESSFUL           @D61NDJK 43163361
*    TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED             @D61NDJK 43165861
*                                                              @D61NDJK 43168361
*------------------------------------------------------------* @D61NDJK 43170961
*                                                              @D61NDJK 43186061
TERDOROR DS    0H                                              @D61NDJK 43201161
 SGTAP  'SGCOV ERPT610',NR=(17,3) READ OPPOSITE RECOVERY       TERDOREC 43223251
*                                                              @D61NDJK 43231361
 SGTAP  'CALL  TERROR          ','READ OPPOSITE RECOVERY',     @D61NDJKX43246461
               I='1,2,3,B           ON RETURN',                @D61NDJKX43261561
               O='F                 RF IS RETURN CODE'         @D61NDJK 43276661
*                                                              @D61NDJK 43291761
*------------------------------------------------------------* @D61NDJK 43306861
*   WRITE A DEBUG ENTRY TYPE 5.                                @D61NDJK 43321961
*------------------------------------------------------------* @D61NDJK 43337061
*                                                              @D61NDJK 43352161
 SGTAP  'CALL  TERTRACE        ','CALL FOR DEBUG ENTRY',       @D61NDJKX43367261
               NR='5              TYPE 5'                      @D61NDJK 43382361
*                                                              @D61NDJK 43397461
         B     TERDOEX            RETURN COMPLETION CODE       @D61NDJK 43412561
*                                                              @D61NDJK 43427661
*------------------------------------------------------------* @D61NDJK 43442761
*                                                              @D61NDJK 43457861
*  FUNCTION                                                    @D61NDJK 43472961
*    DO INTERVENTION REQUIRED ERROR RECOVERY.                  @D61NDJK 43488061
*                                                              @D61NDJK 43503161
*  POSSIBLE COMPLETION CODES ARE:                              @D61NDJK 43506161
*    TERERUNS  -  RECOVERY IS NOT POSSIBLE                     @D61NDJK 43509161
*    TERERRTY  -  REQUEST USER RETRY                           @D61NDJK 43512161
*                                                              @D61NDJK 43515161
*------------------------------------------------------------* @D61NDJK 43518261
*                                                              @D61NDJK 43533361
TERDOIRQ LA    RF,TERERUNS        ASSUME UNSUCCESSFUL RECOVERY @D61SDJK 43557451
 SGTAP  'SGCOV ERPT610',NR=(17,4) INTERV. REQUIRED RECOVERY    TERDOREC 43566441
         CLC   TERCHQID,=AL2(SVTTID) SERVICE TASK REQUEST      @D66ODOW         
         BNE   TERDOIR5           NO                           @D61SDJK 43586401
         TM    TEROEFLG,TEROESNS  USER DECLINES MESSAGING?     @D61SDJK 43587391
         BO    TERDOEX            YES                          @D61SDJK 43588381
*                                                              @D61SDJK 43589371
TERDOIR5 OC    TERCCCWV,TERCCCWV  THERE IS A FAILING CCW?      @D61SDJK 43590361
         BZ    TERDOEX            NO, RETURN COMPLETION CODE   @D61SDJK 43593411
*                                                              @D61SDJK 43611391
 SGTAP  'CALL  TERURTY         ','USER RETRY RECOVERY',        @D61SDJKX43620381
               I='2,B               ON RETURN',                @D61SDJKX43629371
               O='NONE              ERRQ1CCW IS SET'           @D61SDJK 43638361
*                                                              @D61SDJK 43647351
.* SGTAP RELIES ON ERP MESSAGE WRITER SETTING ON BIT OPINTV    @D61SDJK 43656341
.* IN PUBCSFLG. THEREFORE THIS SUBROUTINE MUST NOT BE          @D61SDJK 43665331
.* ENTERED W/O HAVING SET TERFLGMR.TERMRIM AS RECOVERY         @D61SDJK 43674321
.* ATTRIBUTE.                                                  @D61SDJK 43683311
.*                                                             @D61SDJK 43692301
         OI    TERFLG,TERCVOIR    INDICATE INTERV. REQUIRED    @DA43697 43701291
         LA    RF,TERERRTY        REQUEST USER RETRY           @D61SDJK 43710281
         B     TERDOEX            RETURN COMPLETION CODE       @D61NDJK 43729661
*                                                              @D61NDJK 43744761
*------------------------------------------------------------* @D61NDJK 43759861
*                                                              @D61NDJK 43774961
*  FUNCTION                                                    @D61NDJK 43790061
*    DO RECOVERY FOR CHANNEL DATA AND CHANNEL CHAINING         @D61NDJK 44061861
*    CHECKS.                                                   @D61NDJK 44076961
*                                                              @D61NDJK 44079461
*  POSSIBLE COMPLETION CODES ARE:                              @D61NDJK 44081961
*    TERERSUC  -  SUCCESSFUL RECOVERY                          @D61NDJK 44084461
*    TERERUNS  -  RECOVERY EXHAUSTED OR UNSUCCESSFUL           @D61NDJK 44086961
*    TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED             @D61NDJK 44089461
*                                                              @D61NDJK 44092061
*------------------------------------------------------------* @D61NDJK 44107161
*                                                              @D61NDJK 44122261
TERDOCHK DS    0H                                              @D61NDJK 44137361
 SGTAP  'SGCOV ERPT610',NR=(17,5) CHANNEL CHECK RECOVERY       TERDOREC 44159451
*                                                              @D61NDJK 44167561
 SGTAP  'CALL  TERCHKR         ','CHANNEL CHECK RECOVERY',     @D61NDJKX44182661
               I='1,2,3,B           ON RETURN',                @D61NDJKX44197761
               O='F                 RF IS RETURN CODE'         @D61NDJK 44212861
*                                                              @D61NDJK 44227961
         B     TERDOEX            RETURN COMPLETION CODE       @D61NDJK 44243061
*                                                              @D61NDJK 44258161
*------------------------------------------------------------* @D61NDJK 44273261
*                                                              @D61NDJK 44288361
*  FUNCTION                                                    @D61NDJK 44303461
*    DO END OF VOLUME PROCESSING.                              @D61NDJK 44318561
*                                                              @D61NDJK 44333661
*  POSSIBLE COMPLETION CODES ARE:                              @D61NDJK 44336661
*    TERERSUC  -  SUCCESSFUL RECOVERY                          @D61NDJK 44339661
*    TERERUNS  -  RECOVERY EXHAUSTED OR UNSUCCESSFUL           @D61NDJK 44342661
*                                                              @D61NDJK 44345661
*------------------------------------------------------------* @D61NDJK 44348761
*                                                              @D61NDJK 44363861
TERDOEOV LA    RF,TERERSUC        ASSUME SUCCESSFUL RECOVERY   @D61NDJK 44378961
 SGTAP  'SGCOV ERPT610',NR=(17,6) END OF VOLUME RECOVERY       TERDOREC 44401051
*                                                              @D61NDJK 44409161
         OC    TERCCCWV,TERCCCWV  FAILING CCW IS AVAILABLE?    @D61NDJK 44409461
         BZ    TERDOEX            NO, EXIT WITH COMPLETION CODE@D61NDJK 44409761
         CLI   TERCCCWO,REWUNL    FAILING CCW IS A RUN CCW?    @D61NDJK 44410161
         BNE   TEREO100           NO                           @D61NDJK 44411461
*                                                              @D61NDJK 44412761
 SGTAP  'SGCOV ERPT610',NR=(17,7) FAILING CCW IS A RUN CCW     TERDOREC 44414651
         L     R8,TERCCCWV        THERE IS A FURTHER..         @D61NDJK 44415161
         TM    CCWCHAIN-CCWADR(R8),CC+DC     CCW CHAINED?      @D61NDJK 44416161
         BZ    TERDOEX            NO, EXIT WITH COMPLETION CODE@D61NDJK 44417161
*                                                              @D61NDJK 44418161
 SGTAP  'SGCOV ERPT610',NR=(18,0) THERE IS ANOTHER CCW CHAINED TERDOREC 44419651
         NI    TERFLGPS,XFF-TERPSUC   UNIT CHECK IS PASSED     @D61NDJK 44420161
         B     TERDOEX            EXIT WITH COMPLETION CODE    @D61NDJK 44421161
*                                                              @D61NDJK 44421361
TEREO100 LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 44421561
         B     TERDOEX              "UNSUCCESSFUL RECOVERY"    @D61NDJK 44421761
*                                                              @D61NDJK 44422161
*------------------------------------------------------------* @D61NDJK 44423161
*                                                              @D61NDJK 44424161
*  FUNCTION                                                    @D61NDJK 44425161
*    DO USER RETRY RECOVERY.                                   @D61NDJK 44426161
*                                                              @D61NDJK 44427161
*  POSSIBLE COMPLETION CODES ARE:                              @D61NDJK 44428161
*    TERERUNS  -  RECOVERY CANNOT BE DONE                      @D61NDJK 44429161
*    TERERRTY  -  USER RETRY REQUEST                           @D61NDJK 44430161
*                                                              @D61NDJK 44431161
*------------------------------------------------------------* @D61NDJK 44432161
*                                                              @D61NDJK 44433161
TERDOURT LA    RF,TERERUNS        ASSUME UNSUCCESSFUL RECOVERY @D61NDJK 44434161
 SGTAP  'SGCOV ERPT610',NR=(18,1) USER RETRY RECOVERY          TERDOREC 44435751
         OC    TERCCCWV,TERCCCWV  USER CHAIN CAN BE RETRIED?   @D61NDJK 44437161
         BZ    TERDOEX            NO, RETURN COMPLETION CODE   @D61NDJK 44439361
*                                                              @D61SDJK 44443361
 SGTAP  'CALL  TERURTY         ','USER RETRY RECOVERY',        @D61SDJKX44445361
               I='2,B               ON RETURN',                @D61SDJKX44447361
               O='NONE              ERRQ1CCW IS SET'           @D61SDJK 44449361
*                                                              @D61NDJK 44454461
         LA    RF,TERERRTY        EXIT WITH COMPLETION CODE..  @D61NDJK 44507261
         B     TERDOEX              "USER RETRY REQUEST"       @D61NDJK 44533661
*                                                              @D61NDJK 44560161
*------------------------------------------------------------* @D61SDJK 44560211
*                                                              @D61SDJK 44560261
*  FUNCTION                                                    @D61SDJK 44560311
*    RESUME FAILING CHANNEL PROGRAM AFTER FAILING CCW.         @D61SDJK 44560361
*                                                              @D61SDJK 44560411
*  POSSIBLE COMPLETION CODES ARE:                              @D61SDJK 44560461
*    TERERSUC  -  SUCCESSFUL RECOVERY                          @D61SDJK 44560511
*    TERERUNS  -  RECOVERY EXHAUSTED OR UNSUCCESSFUL           @D61SDJK 44560561
*    TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED             @D61SDJK 44560611
*                                                              @D61SDJK 44560661
*------------------------------------------------------------* @D61SDJK 44560711
*                                                              @D61SDJK 44560761
TERDORES LA    RF,TERERSUC        ASSUME SUCCESSFUL RECOVERY   @D61SDJK 44560811
         OI    TERFLGPS,TERPSUC   DO NOT PASS UNIT CHECK       @D61SDJK 44560861
         TM    TEROEFLG,TEROEPST  USER CCB IS ALREADY POSTED?  @D61SDJK 44560911
         BO    TERDOEX            YES, RETURN COMPLETION CODE  @D61SDJK 44560961
*                                                              @D61SDJK 44561011
 SGTAP  'SGCOV ERPT610',NR=(18,2) RESUME RECOVERY              TERDOREC 44561111
         NI    TERFLGPS,XFF-TERPSUC      PASS UNIT CHECK       @D61SDJK 44561161
*                                                              @D61SDJK 44561211
 SGTAP  'CALL  TERRESUM        ','RESUME USER CCW CHAIN',      @D61SDJKX44561261
               I='1,2,3,B           ON RETURN ',               @D61SDJKX44561311
               O='F                 RF IS COMPLETION CODE'     @D61SDJK 44561361
*                                                              @D61SDJK 44561411
         B     TERDOEX            RETURN COMPLETION CODE       @D61SDJK 44561461
*                                                              @D61SDJK 44561511
*------------------------------------------------------------* @D61SDJK 44561561
*                                                              @D61SDJK 44561611
*  FUNCTION                                                    @D61SDJK 44561661
*    DO READ ALTERNATE RECOVERY.                               @D61SDJK 44561711
*                                                              @D61SDJK 44561761
*  POSSIBLE COMPLETION CODES ARE:                              @D61SDJK 44561811
*    TERERSUC  -  SUCCESSFUL RECOVERY                          @D61SDJK 44561861
*    TERERUNS  -  RECOVERY EXHAUSTED OR UNSUCCESSFUL           @D61SDJK 44561911
*    TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED             @D61SDJK 44561961
*                                                              @D61SDJK 44562011
*------------------------------------------------------------* @D61SDJK 44562061
*                                                              @D61SDJK 44562111
TERDORAR DS    0H                                              @D61SDJK 44562161
 SGTAP  'SGCOV ERPT610',NR=(18,3) READ ALTERNATE RECOVERY      TERDOREC 44562211
*                                                              @D61SDJK 44562311
 SGTAP  'CALL  TERRAR          ','READ ALTERNATE RECOVERY',    @D61SDJKX44562361
               I='1,2,3,B           ON RETURN',                @D61SDJKX44562411
               O='F                 RF IS RETURN CODE'         @D61SDJK 44562461
*                                                              @D61SDJK 44562511
*------------------------------------------------------------* @D61SDJK 44562561
*   WRITE A DEBUG ENTRY TYPE 5.                                @D61SDJK 44562611
*------------------------------------------------------------* @D61SDJK 44562661
*                                                              @D61SDJK 44562711
 SGTAP  'CALL  TERTRACE        ','CALL FOR DEBUG ENTRY',       @D61SDJKX44562761
               NR='5              TYPE 5'                      @D61SDJK 44562811
*                                                              @D61SDJK 44562861
         B     TERDOEX            RETURN COMPLETION CODE       @D61SDJK 44562911
*                                                              @D61SDJK 44562961
*------------------------------------------------------------* @D61SDJK 44563011
*                                                              @D61SDJK 44563061
*  FUNCTION                                                    @D61SDJK 44563111
*    RECOGNIZE LONG BUSY ERROR CONDITION.                      @D61SDJK 44563161
*                                                              @D61SDJK 44563211
*  POSSIBLE COMPLETION CODES ARE:                              @D61SDJK 44563261
*    TERERLBY  -  LONG BUSY RECOVERY IS REQUIRED               @D61SDJK 44563311
*    TERERUNS  -  RECOVERY CANNOT BE DONE                      @D61SDJK 44563361
*                                                              @D61SDJK 44563411
*------------------------------------------------------------* @D61SDJK 44563461
*                                                              @D61SDJK 44563511
TERDOLBY LA    RF,TERERUNS        ASSUME UNSUCCESSFUL RECOVERY @D61SDJK 44563561
 SGTAP  'SGCOV ERPT610',NR=(18,4) LONG BUSY RECOVERY           TERDOREC 44563611
         OC    TERCCCWV,TERCCCWV  THERE IS A FAILING CCW?      @D61SDJK 44563711
         BZ    TERDOEX            NO, RETURN COMPLETION CODE   @D61SDJK 44563761
*                                                              @D61SDJK 44563861
 SGTAP  'CALL  TERURTY         ','USER RETRY RECOVERY',        @D61SDJKX44563911
               I='2,B               ON RETURN',                @D61SDJKX44563961
               O='NONE              ERRQ1CCW IS SET'           @D61SDJK 44564011
*                                                              @D61SDJK 44564061
         LA    RF,TERERLBY        REQUEST LONG BUSY RECOVERY   @D61SDJK 44564111
         B     TERDOEX            RETURN COMPLETION CODE       @D61SDJK 44564161
*                                                              @D61SDJK 44564211
*------------------------------------------------------------* @D61SDJK 44564261
*                                                              @D61SDJK 44564311
*  FUNCTION                                                    @D61SDJK 44564361
*    MAKE DEVICE INELIGIBLE FOR SUBSEQUENT ALLOCATIONS.        @D61SDJK 44564411
*                                                              @D61SDJK 44564461
*  POSSIBLE COMPLETION CODES ARE:                              @D61SDJK 44564511
*    TERERUNS  -  RECOVERY EXHAUSTED OR UNSUCCESSFUL           @D61SDJK 44564561
*                                                              @D61SDJK 44564611
*------------------------------------------------------------* @D61SDJK 44564661
*                                                              @D61SDJK 44564711
TERDOFDV L     R5,TERAPUBX        GET PUBX POINTER             @D61SDJK 44564761
         USING PBXADR,R5          DECLARE PUBX BASE POINTER    @D61SDJK 44564811
 SGTAP  'SGCOV ERPT610',NR=(18,5) FENCE DEVICE RECOVERY        TERDOREC 44564861
         MVC   PBXNOERP(1),PBXPIM SET DEVICE..                 @D61SDJK 44564911
         MVI   PBXLPM,X'00'         INTO..                     @D61SDJK 44564961
         OI    PUBJCFLG,PUBPPD      INACCESSIBLE STATE         @D61SDJK 44565011
         DROP  R5                 DROP PUBX BASE POINTER       @D61SDJK 44565061
         LA    RF,TERERUNS        RECOVERY WAS UNSUCCESSFUL    @D61SDJK 44565111
         B     TERDOEX            RETURN COMPLETION CODE       @D61SDJK 44565211
*                                                              @D61SDJK 44565261
*------------------------------------------------------------* @D61SDJK 44565311
*                                                              @D61SDJK 44565361
*  FUNCTION                                                    @D61SDJK 44565411
*    DISCONTINUE USE OF CHANNEL PATH FOR THE SELECTED DEVICE.  @D61SDJK 44565461
*                                                              @D61SDJK 44565511
*  POSSIBLE COMPLETION CODES ARE:                              @D61SDJK 44565561
*    TERERSUC  -  SUCCESSFUL RECOVERY                          @D61SDJK 44565611
*    TERERUNS  -  RECOVERY EXHAUSTED OR UNSUCCESSFUL           @D61SDJK 44565661
*    TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED             @D61SDJK 44565711
*                                                              @D61SDJK 44565761
*------------------------------------------------------------* @D61SDJK 44565811
*                                                              @D61SDJK 44565861
TERDOFPT L     R5,TERAPUBX        GET PUBX POINTER             @D61SDJK 44565911
         USING PBXADR,R5          DECLARE PUBX BASE POINTER    @D61SDJK 44565961
 SGTAP  'SGCOV ERPT610',NR=(18,6) FENCE DEVICE PATH RECOVERY   TERDOREC 44566061
         SLR   R9,R9              TAKE THE CHPID..             @D61SDJK 44566111
         IC    R9,ERRQPATH          THAT THE ERROR CAME IN ON  @D61SDJK 44566161
         SLR   R7,R7              CLEAR PATH MASK              @D61SDJK 44566211
 SGTAP  'CALL  TERPATH         ','GET ASSOCIATED PATH MASK',   @D61SDJKX44566261
               I='5,7,9             ON RETURN+4',              @D61SDJKX44566311
               O='7,9               PATH MASK IS SET',         @D61SDJKX44566361
               E0='TERFP100       PATH MASK COULD NOT BE BUILT'@D61SDJK 44566411
*                                                              @D61SDJK 44566461
 SGTAP  'SGCOV ERPT610',NR=(18,7) FENCE AFFECTED DEVICE PATH   TERDOREC 44566511
         IC    R9,PBXNOERP        TAKE ALL INACCESSIBLE..      @D61SDJK 44566611
         OR    R9,R7                PATHES AND INCORPORATE..   @D61SDJK 44566661
         STC   R9,PBXNOERP          THE FAILING PATH           @D61SDJK 44566711
         X     R7,PBXLPM-3        REMOVE THE FAILING..         @D61SDJK 44566761
         N     R7,PBXLPM-3          PATH FROM THE..            @D61SDJK 44566811
         STC   R7,PBXLPM            LOGICAL PATH MASK          @D61SDJK 44566861
         CLI   PBXLPM,X'00'       THE LAST PATH WAS SET DOWN?  @D61SDJK 44566911
         BNE   TERFP100           NO                           @D61SDJK 44566961
         DROP  R5                                              @D61SDJK 44567011
*                                 SET DEVICE INTO..            @D61SDJK 44567061
         OI    PUBJCFLG,PUBPPD      INACCESSIBLE STATE         @D61SDJK 44567111
         LA    RF,TERERUNS        RECOVERY WAS UNSUCCESSFUL    @D61SDJK 44567161
         B     TERDOEX            RETURN COMPLETION CODE       @D61SDJK 44567211
*                                                              @D61SDJK 44567261
TERFP100 DS    0H                                              @D61SDJK 44567311
 SGTAP  'CALL  TERRTY          ','RETRY FAILING CCW',          @D61SDJKX44567361
               I='1,2,3,B           ON RETURN',                @D61SDJKX44567411
               O='F                 RF IS RETURN CODE'         @D61SDJK 44567461
*                                                              @D61SDJK 44567511
         B     TERDOEX            RETURN COMPLETION CODE       @D61SDJK 44567561
*                                                              @D61SDJK 44567611
         AGO   .NOUNL50                                        @D61NDJK 44567661
*------------------------------------------------------------* @D61NDJK 44575261
*                                                              @D61NDJK 44590361
*  FUNCTION                                                    @D61NDJK 44605461
*    DO REWIND UNLOAD RECOVERY AND RETRY THE FAILING CCW.      @D61NDJK 44620561
*                                                              @D61NDJK 44635661
*  POSSIBLE COMPLETION CODES ARE:                              @D61NDJK 44638161
*    TERERSUC  -  SUCCESSFUL RECOVERY                          @D61NDJK 44640661
*    TERERUNS  -  RECOVERY EXHAUSTED OR UNSUCCESSFUL           @D61NDJK 44643161
*    TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED             @D61NDJK 44645661
*                                                              @D61NDJK 44648161
*------------------------------------------------------------* @D61NDJK 44650761
*                                                              @D61NDJK 44665861
TERDOUNL DS    0H                                              @D61NDJK 44688461
*                                                              @D61NDJK 44711161
 SGTAP  'CALL  TERUNL          ','REWIND UNLOAD RECOVERY',     @D61NDJKX44726261
               I='1,2,3,B           ON RETURN',                @D61NDJKX44741361
               O='F                 RF IS RETURN CODE'         @D61NDJK 44756461
*                                                              @D61NDJK 44771561
         LA    R5,TERERUNS        RECOVERY COMPLETION CODE..   @D61NDJK 44786661
         CR    RF,R5                IS "UNSUCCESSFUL RECOVERY"?@D61NDJK 44801761
         BE    TERDOEX            YES                          @D61NDJK 44816861
*                                                              @D61NDJK 44831961
 SGTAP  'CALL  TERRTY          ','RETRY FAILING CCW',          @D61NDJKX44862161
               I='1,2,3,B           ON RETURN',                @D61NDJKX44877261
               O='F                 RF IS RETURN CODE'         @D61NDJK 44892361
*                                                              @D61NDJK 44907461
.NOUNL50 ANOP                                                  @D61NDJK 44914961
*------------------------------------------------------------* @D61NDJK 44922561
*                                                              @D61NDJK 44937661
*   EXIT HANDLING. RETURN COMPLETION CODE.                     @D61NDJK 44952761
*                                                              @D61NDJK 44967861
*------------------------------------------------------------* @D61NDJK 44982961
*                                                              @D61NDJK 44998061
TERDOEX  SGTAP 'RETURN         ','RETURN TO CALLER         ',  @D61NDJKX45013161
               OUTPUT=(RF)                                     @D61NDJK 45028261
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 45043361
         LTORG                                                 @D61NDJK 45058461
         EJECT                                                 @D61NDJK 45073561
*                                                              @D61NDJK 45088661
***************************************************************         45103761
*  FUNCTION                                                    @D61NDJK 45118861
*    ISSUE READ BUFFERED LOG RECOVERY.                         @D61NDJK 45133961
*                                                              @D61NDJK 45149061
*  INPUT                                                       @D61NDJK 45164161
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61NDJK 45179261
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 45194361
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61NDJK 45209461
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61NDJK 45216961
*                                                              @D61NDJK 45224561
*  OUTPUT ON RETURN TO RETURN+0                                @D61NDJK 45239661
*    - NONE. READ BUFFERED LOG FAILED.                         @D61NDJK 45254761
*                                                              @D61NDJK 45269861
*  OUTPUT ON RETURN TO RETURN+4                                @D61NDJK 45284961
*    - TERRBLDA CONTAINS BUFFERED LOG DATA THAT WAS READ.      @D61NDJK 45300061
*    - TERRBLLN CONTAINS LENGTH OF BUFFERED LOG DATA.          @D61NDJK 45315161
*                                                              @D61NDJK 45330261
***************************************************************         45345361
 AGO  .GRBL                                                   *#SECURGL 45360461
.LRBL    AIF ('&TEST'(1,12) NE 'CALL  TERRBL'  ).LRTY         *#SECURGL 45375561
 AIF   ('&I'(2,8)  NE '1,2,3,B '               ).DSINVC       *#SECURGL 45390661
 AIF   ('&O'(2,4)  NE 'NONE'                   ).DSINVC       *#SECURGL 45405761
 AIF   (T'&E0      NE 'O'                      ).DSHEAD       *#SECURGL 45420861
 AGO  .DSINVC                                                 *#SECURGL 45435961
.GRBL     ANOP                                                *#SECURGL 45451061
.**************************************************************         45466161
TERRBL   SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 45481261
         USING CCBADR,R1                                       @D61NDJK 45496361
         USING ERBLKADR,R2                                     @D61NDJK 45511461
         USING PUBADR,R3                                       @D61NDJK 45526561
 SGTAP  'SGCOV ERPT610',NR=(19,0) TERRBL ENTERED                 TERRBL 45544051
*                                                              @D61NDJK 45556761
*------------------------------------------------------------* @D61NDJK 45571861
*   PREPARE CCB AND READ BUFFERED LOG CCW.                     @D61NDJK 45586961
*------------------------------------------------------------* @D61NDJK 45602061
*                                                              @D61NDJK 45617161
         MVC   TERSVCCB,TERCCB    PRESERVE CCB                 @D61NDJK 45632261
*                                                              @D61NDJK 45647361
         LA    R8,TERCCWRB        SET UP CCB FOR RBL I/O:      @D61NDJK 45662461
         STCM  R8,7,CCBCCW31+1      START OF CHANNEL PROGRAM   @D66ADAP 45677561
*                                                              @D61NDJK 45692661
         L     R9,TERLINK         ESTABLISH LINKAGE TO..       @D61SDJK 45695661
         USING TERLNKG,R9           SUPERVISOR PART OF..       @D61SDJK 45698661
         LA    R6,TERRBLDA          SGTAP AND POINT TO READ..  @D61SDJK 45701661
*                                   BUFFERED LOG DATA AREA     @D61SDJK 45704661
         USING CCWADR,R8                                       @D61NDJK 45707761
         XC    CCWTOT,CCWTOT      SET UP CCW FOR RBL I/O:      @D61NDJK 45722861
         MVI   CCWCODE,TERRBLOP     RBL OPCODE                 @D61NDJK 45737961
         STCM  R6,7,CCWBUF+1                                   @D61NDJK 45768161
         MVI   CCWCHAIN,SLI         FLAG BYTE                  @D61NDJK 45783261
         LA    R6,TERRBLBC          BYTE COUNT                 @D61SDJK 45801351
         STCM  R6,3,CCWLNG                                     @D61SDJK 45804341
*                                                              @D61NDJK 45813461
*------------------------------------------------------------* @D61NDJK 45828561
*   ISSUE READ BUFFERED LOG I/O.                               @D61NDJK 45843661
*------------------------------------------------------------* @D61NDJK 45858761
*                                                              @D61NDJK 45904061
 SGTAP  'CALL  TERIO           ','ISSUE I/O REQUEST',          @D61NDJKX45919161
               I='1,2,3,B           ON RETURN ',               @D61NDJKX45934261
               O='F                 RF IS COMPLETION CODE'     @D61NDJK 45949361
*                                                              @D61NDJK 46070161
*------------------------------------------------------------* @D61NDJK 46085261
*   DETERMINE NUMBER OF AVAILABLE LOG DATA BYTES.              @D61NDJK 46100361
*------------------------------------------------------------* @D61NDJK 46115461
*                                                              @D61NDJK 46130561
         SLR   R5,R5              TAKE RESIDUAL..              @D61NDJK 46143061
         ICM   R5,3,CCBCNT          COUNT OF RBL I/O           @D61NDJK 46155561
         LA    R6,TERRBLBC        SUBTRACT RES. COUNT FROM..   @D61NDJK 46168261
         SR    R6,R5                BYTE COUNT OF RBL CCW TO.. @D61NDJK 46190861
         STH   R6,TERRBLLN          HAVE LENGTH OF LOG DATA    @D61NDJK 46213461
*                                                              @D61NDJK 46216861
*------------------------------------------------------------* @D61NDJK 46220261
*   VERIFY SUCCESSFUL COMPLETION OF READ BUFFERED LOG I/O.     @D61NDJK 46223661
*------------------------------------------------------------* @D61NDJK 46227061
*                                                              @D61NDJK 46230461
.* UNIT EXCEPTION WOULD INDICATE THAT THERE IS NO BUFFERED     @D61SDJK 46231261
.* LOG DATA AVAILABLE                                          @D61SDJK 46232061
.*                                                             @D61NDJK 46232861
         TM    CCBSTA1,XFF-CHANEND-DEVEND UNUSUAL UNIT STATUS? @D61NDJK 46233861
         BNZ   TERRBEX0                   YES                  @D61NDJK 46237261
 SGTAP  'SGCOV ERPT610',NR=(19,1) CSW UNIT STATUS IS NOT UNUSUAL TERRBL 46241651
         TM    CCBSTA2,XFF-IL     UNUSUAL CHANNEL STATUS?      @D61NDJK 46244061
         BNZ   TERRBEX0           YES                          @D61SDJK 46248451
*                                                              @D61NDJK 46251361
*------------------------------------------------------------* @D61SDJK 46252361
*   EVALUATE LOGGING CODE IN BYTE 2 FOR TPA LOG DATA.          @D61SDJK 46253361
*------------------------------------------------------------* @D61SDJK 46254361
*                                                              @D61SDJK 46255361
         CLI   TERDEVTY,TERTPA    IT IS A TPA DEVICE?          @D61SDJK 46256361
         BL    TERRBEX4           NO, TAKE NORMAL EXIT         @D61SDJK 46257361
         CLI   TERRBLDA+7,X'C0'   FORMAT IDENTIFIES VOLUME LOG?@D61SDJK 46258361
         BNE   TERRBEX0           NO, TAKE ERROR EXIT          @D61SDJK 46259361
 SGTAP  'SGCOV ERPT610',NR=(19,2) FORMAT IDENTIFIES VOLUME LOG   TERRBL 46261361
         TM    TERRBLDA+2,X'08'   MDR RECORD SHOULD BE WRITTEN?@D61SDJK 46262361
         BO    TERRBEX4           YES, TAKE NORMAL EXIT        @D61SDJK 46263361
*                                                              @D61SDJK 46264361
*------------------------------------------------------------* @D61NDJK 46266461
*                                                              @D61NDJK 46281561
*    EXIT HANDLING.                                            @D61NDJK 46296661
*                                                              @D61NDJK 46311761
*------------------------------------------------------------* @D61NDJK 46326861
*                                                              @D61NDJK 46341961
*------------------------------------------------------------* @D61NDJK 46357061
*   ERROR EXIT.                                                @D61NDJK 46372161
*------------------------------------------------------------* @D61NDJK 46387261
*                                                              @D61NDJK 46402361
TERRBEX0 MVC   TERCCB(L'TERSVCCB),TERSVCCB   RESTORE SAVED CCB @D61NDJK 46417461
 SGTAP  'SGCOV ERPT610',NR=(19,3) RBL I/O WAS UNSUCCESSFUL       TERRBL 46442541
         SGTAP 'RETURN         ','RETURN W/O LOG DATA.'        @D61NDJK 46447661
*                                                              @D61NDJK 46462761
*------------------------------------------------------------* @D61NDJK 46477861
*   NORMAL EXIT.                                               @D61NDJK 46492961
*------------------------------------------------------------* @D61NDJK 46508061
*                                                              @D61NDJK 46523161
TERRBEX4 MVC   TERCCB(L'TERSVCCB),TERSVCCB   RESTORE SAVED CCB @D61NDJK 46533161
         SGTAP 'RETURN4        ','RETURN WITH LOG DATA.'       @D61NDJK 46543161
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 46553361
         LTORG                                                 @D61NDJK 46568461
         EJECT                                                 @D61NDJK 46583561
*                                                              @D61NDJK 46598661
***************************************************************         46613761
*  FUNCTION                                                    @D61NDJK 46628861
*    RESTART USER'S CHANNEL PROGRAM BEGINNING WITH THE         @D61NDJK 46643961
*    FAILING CCW.                                              @D61NDJK 46659061
*                                                              @D61NDJK 46674161
*  INPUT                                                       @D61NDJK 46689261
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61NDJK 46704361
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 46719461
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61NDJK 46734561
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61NDJK 46742061
*                                                              @D61NDJK 46749661
*  OUTPUT                                                      @D61NDJK 46764761
*    - RF CONTAINS A RETRY COMPLETION CODE. POSSIBLE           @D61NDJK 46779861
*         COMPLETION CODES ARE:                                @D61NDJK 46794961
*           TERERSUC  -  RETRY WAS DONE SUCCESSFULLY           @D61NDJK 46810061
*           TERERUNS  -  RETRY COUNTER EXHAUSTED OR RETRY      @D61NDJK 46825161
*                        NOT POSSIBLE                          @D61NDJK 46840261
*           TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED      @D61NDJK 46855361
*                        DURING RETRY                          @D61NDJK 46870461
*                                                              @D61NDJK 46885561
***************************************************************         46900661
 AGO  .GRTY                                                   *#SECURGL 46915761
.LRTY    AIF ('&TEST'(1,12) NE 'CALL  TERRTY'  ).LROR         *#SECURGL 46930861
 AIF   ('&I'(2,8)  NE '1,2,3,B '               ).DSINVC       *#SECURGL 46945961
 AIF   ('&O'(2,2)  EQ 'F '                     ).DSHEAD       *#SECURGL 46961061
 AGO  .DSINVC                                                 *#SECURGL 46976161
.GRTY     ANOP                                                *#SECURGL 46991261
.**************************************************************         47006361
TERRTY   SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 47021461
         USING CCBADR,R1                                       @D61NDJK 47036561
         USING ERBLKADR,R2                                     @D61NDJK 47051661
         USING PUBADR,R3                                       @D61NDJK 47066761
 SGTAP  'SGCOV ERPT610',NR=(20,0) TERRTY ENTERED                 TERRTY 47081251
*                                                              @D61NDJK 47096961
*------------------------------------------------------------* @D61NDJK 47112061
*                                                              @D61NDJK 47119561
*   IF NO FAILING CCW IS AVAILABLE, NO RETRY CAN BE DONE.      @D61NDJK 47127161
*                                                              @D61NDJK 47134661
*------------------------------------------------------------* @D61NDJK 47142261
*                                                              @D61NDJK 47157361
         OC    TERCCCWV,TERCCCWV  RETRY IS POSSIBLE?           @D61NDJK 47172461
         BNZ   TERRT100           YES                          @D61NDJK 47187561
*                                                              @D61NDJK 47202661
 SGTAP  'SGCOV ERPT610',NR=(20,1) RETRY W/O FAILING CCW IMPOSS.  TERRTY 47224751
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 47232861
         B     TERRTEX              "RETRY NOT POSSIBLE"       @D61NDJK 47247961
*                                                              @D61NDJK 47263061
*------------------------------------------------------------* @D61NDJK 47278161
*                                                              @D61NDJK 47293261
*   IF THE FAILING CCW IS A PREFIX CCW AND A REWIND CCW,       @D61NDJK 47383861
*   THE REWIND PREFIX RESULTED FROM AR COMMAND TAPE UNL=REW.   @D61NDJK 47396361
*   IN THIS CASE A SINGLE REWIND CCW MUST BE STARTED.          @D61NDJK 47408861
*                                                              @D61NDJK 47421561
*------------------------------------------------------------* @D61NDJK 47429161
*                                                              @D61NDJK 47444261
TERRT100 TM    TERFLG,TERCVPRF    FAILING CCW IS A PREFIX CCW? @D61NDJK 47459361
         BZ    TERRT200           NO                           @D61NDJK 47474461
         TM    TERFLG,TERCVREW    FAILING CCW IS PUBX REW CCW? @D61NDJK 47489561
         BZ    TERRT200           NO                           @D61SDJK 47511651
*                                                              @D61NDJK 47519761
         LA    R8,TERCCW00        SET UP REWIND..              @D61NDJK 47534861
         USING CCWADR,R8            CCW FOR RETRY I/O:         @D61NDJK 47549961
         XC    CCWTOT,CCWTOT        CLEAR DATA ADDRESS         @D61NDJK 47565061
         MVI   CCWCODE,REWIND       REWIND OPCODE              @D61NDJK 47580161
         MVI   CCWCHAIN,SLI         FLAG BYTE                  @D61NDJK 47595261
         MVI   CCWLNG+1,1           BYTE COUNT                 @D61NDJK 47610361
 SGTAP  'SGCOV ERPT610',NR=(20,2) REWIND PREFIX DUE TO UNL=REW   TERRTY 47628451
         LR    R4,R8              PREFIX 0 CCW MUST BE STARTED @D61SDJK 47634431
         B     TERRT500           RETRY I/O CAN BE ISSUED      @D61SDJK 47637421
*                                                              @D61NDJK 47642661
*------------------------------------------------------------* @D61NDJK 47644761
*                                                              @D61NDJK 47646861
*   BUILD PREFIX CCWS FOR THE RETRY I/O REQUEST.               @D61NDJK 47648961
*   PREFIX 0 CCW: SYSTEM MODE SET/OVERRIDE CCW.                @D61SDJK 47649661
*   PREFIX 1 CCW: USER OWN MODE SET/OVERRIDE CCW, NO-OP CCW,   @D61SDJK 47650551
*                 OR SUSPEND MULTIPATH RECONNECT CCW.          @D61SDJK 47650741
*                                                              @D61NDJK 47651061
*------------------------------------------------------------* @D61NDJK 47653161
*                                                              @D61NDJK 47655661
*------------------------------------------------------------* @D61SDJK 47656061
*   FIND OUT WHETHER THE ORIGINAL I/O REQUEST HAS BEEN         @D61SDJK 47656461
*   PREFIXED BY THE I/O SUPERVISOR. IF SO, THE RETRY           @D61SDJK 47656861
*   REQUEST MUST BE PREFIXED BY A PREFIX 0 CCW.                @D61SDJK 47657261
*------------------------------------------------------------* @D61SDJK 47657661
*                                 ASSUME THAT PREFIX 0..       @D61SDJK 47658061
TERRT200 LA    R4,TERCCW01          CCW WILL NOT BE STARTED    @D61SDJK 47658461
         LA    R8,TERCCW00        SET UP..                     @D61SDJK 47658861
         USING CCWADR,R8            PREFIX 0 CCW               @D61SDJK 47659261
         XC    CCWTOT,CCWTOT                                   @D61SDJK 47659661
*                                 USER WANTED TO HAVE..        @D61SDJK 47660061
         TM    CCBBY3-CCBADR(RB),X'08' CCW CHAIN PREFIXED?     @DA44407 47660651
         BO    TERRT300           NO                           @D61SDJK 47660861
         ASYSCOM (R7)             ESTABLISH..                  @D61SDJK 47661261
         USING SYSCOM,R7            ADDRESSABILITY OF SYSCOM   @D61SDJK 47661661
         CLC   TERCHQID,IJBHSTID    SYSTEM TASK REQUEST?       @D66ODOW 47662061
         BL    TERRT300                YES                     @D61SDJK 47662461
         DROP  R7                                              @D61SDJK 47662861
*                                                              @D61SDJK 47663261
 SGTAP  'SGCOV ERPT610',NR=(20,3) USER CCW CHAIN WAS PREFIXED    TERRTY 47663851
         MVI   CCWCODE,MDO        MODE SET/OVERRIDE OPCODE     @D61SDJK 47664461
         L     R5,TERAPUBX        GET PUBX POINTER             @D61SDJK 47664861
         USING PBXADR,R5          DECLARE PUBX BASE POINTER    @D61SDJK 47665261
         LA    R6,PBXABYT         GET SYSTEM MODE BYTE POINTER @D61SDJK 47665661
         DROP  R5                                              @D61SDJK 47666061
         STCM  R6,7,CCWBUF+1                                   @D61SDJK 47666461
         MVI   CCWCHAIN,SLI+CC      FLAG BYTE                  @D61SDJK 47666861
         MVI   CCWLNG+1,1           BYTE COUNT                 @D61SDJK 47667261
         LA    R4,TERCCW00        PREFIX 0 CCW MUST BE STARTED @D61SDJK 47667661
*                                                              @D61SDJK 47668061
*------------------------------------------------------------* @D61NDJK 47670761
*   IF THE USER CHANNEL PROGRAM HAS SPECFIFIED OWN 3480-TYPE   @D61SDJK 47694851
*   MODE SET OR TPA-TYPE MODE OVERRIDE CCWS, THE PREFIX 1      @D61SDJK 47703841
*   CCW MUST BE THE LAST USER MODE SET OR MODE OVERRIDE CCW    @D61SDJK 47712831
*   IN FRONT OF THE FAILING CCW.                               @D61SDJK 47721821
*------------------------------------------------------------* @D61NDJK 47731161
*                                                              @D61NDJK 47746261
TERRT300 LA    R9,MDO             TAKE MODE SET/OVERRIDE OPCODE@D61SDJK 47768351
 SGTAP  'CALL  TERSCAN         ','FIND LAST TIME ITS USED',    @D61NDJKX47776461
               I='1,9               ON RETURN+4',              @D61NDJKX47791561
               O='5,6               R5,R6 POINT TO FOUND CCW', @D61SDJKX47811651
               E0='TERRT400         ERROR: NO SUCH OPCODE'     @D61SDJK 47816641
*                                 THERE IS ONE IN FRONT..      @D61SDJK 47821631
         LTR   R6,R6                OF THE FAILING CCW?        @D61SDJK 47826621
         BZ    TERRT400           NO                           @D61SDJK 47831611
 SGTAP  'SGCOV ERPT610',NR=(20,4) MODE SET/OVERRIDE CCW FOUND    TERRTY 47846581
*                                 PROVIDE USER MODE..          @D61NDJK 47851961
         LR    R8,R6                SET/OVERRIDE CCW POINTER,..@D61SDJK 47874051
         LA    R5,1                 NUMBER OF BYTES TO MOVE,.. @D61NDJK 47882161
         SLR   R6,R6                OFFSET OF 1ST DATA BYTE,.. @D61NDJK 47897261
         LA    R7,TERMODE           AND POINTER TO AREA WHERE..@D61NDJK 47912361
*                                   THE DATA SHALL BE MOVED TO @D61NDJK 47927461
 SGTAP  'CALL  TERGETDT        ','GET USER MODE DATA BYTE',    @D61SDJKX47949551
               I='5,6,7,8           ON RETURN+4',              @D61NDJKX47957661
               O='NONE              DATA ARE MOVED TO AREA',   @D61NDJKX47972761
               E0='TERRT350         ERROR: DATA NOT ADDR.'     @D61SDJK 47994851
*                                                              @D61NDJK 48002961
         B     TERRT450                                        @D61SDJK 48292931
*                                                              @D61NDJK 48410661
*------------------------------------------------------------* @D61SDJK 48411061
*   IF THE USER MODE SET OR MODE OVERRIDE DATA BYTE COULD      @D61SDJK 48411461
*   NOT BE OBTAINED, NO RETRY WILL BE DONE.                    @D61SDJK 48411861
*------------------------------------------------------------* @D61SDJK 48412261
*                                                              @D61SDJK 48412661
TERRT350 DS    0H                                              @D61SDJK 48413061
 SGTAP  'SGCOV ERPT610',NR=(20,5) USER MODE BYTE NOT OBTAINED    TERRTY 48413861
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61SDJK 48414261
         B     TERRTEX              "RETRY NOT POSSIBLE"       @D61SDJK 48414661
*                                                              @D61SDJK 48415061
*------------------------------------------------------------* @D61SDJK 48415461
*   IF THE USER CHANNEL PROGRAM CONTAINS NO 3480-TYPE MODE     @D61SDJK 48415861
*   SET AND NO TPA-TYPE MODE OVERRIDE CCWS, THE PREFIX 1 CCW   @D61SDJK 48416261
*   MUST BE A NO-OP OR A SUSPEND MULTIPATH RECONNECT CCW.      @D61SDJK 48416851
*------------------------------------------------------------* @D61SDJK 48417061
*                                                              @D61SDJK 48417461
TERRT400 LA    R8,TERCCW01        SET UP PREFIX 1 CCW          @D61SDJK 48418051
         XC    CCWTOT,CCWTOT                                   @D61SDJK 48418261
         MVI   CCWCODE,NOOP         NO-OP OPCODE               @D61SDJK 48418661
         CLI   TERDEVTY,TERTPA      IT IS A TPA DEVICE?        @D61SDJK 48419151
         BL    TERRT480             NO                         @D61SDJK 48419241
         LA    R7,TERCCW00          TERCCW00 IS FIRST..        @D61SDJK 48419331
         CR    R4,R7                  CCW IN RETRY CHAIN?      @D61SDJK 48419421
         BE    TERRT480             YES                        @D61SDJK 48419511
         MVI   CCWCODE,X'5B'        SUSPEND MULTIPATH..        @D61SDJK 48419601
         B     TERRT480               RECONNECT CCW            @D61SDJK 48419691
*                                                              @D61SDJK 48419861
TERRT450 LA    R8,TERCCW01        SET UP PREFIX 1 CCW..        @D61SDJK 48420261
         XC    CCWTOT,CCWTOT        FOR RETRY I/O:             @D61SDJK 48420661
         MVI   CCWCODE,MDO          MODE SET/OVERRIDE OPCODE   @D61SDJK 48421061
         LA    R6,TERMODE           DATA ADDRESS               @D61SDJK 48421461
         STCM  R6,7,CCWBUF+1                                   @D61SDJK 48421861
TERRT480 MVI   CCWCHAIN,SLI+CC      FLAG BYTE                  @D61SDJK 48422261
         MVI   CCWLNG+1,1           BYTE COUNT                 @D61SDJK 48422661
*                                                              @D61SDJK 48423061
*------------------------------------------------------------* @D61NDJK 48425761
*   BUILD TIC CCW THAT WILL TRANSFER BACK TO THE USER'S        @D61NDJK 48455961
*   CHANNEL PROGRAM.                                           @D61NDJK 48471061
*------------------------------------------------------------* @D61NDJK 48501261
*                                                              @D61NDJK 48516361
         LA    R8,TERCCW02        SET UP TIC CCW TO TRANSFER.. @D61SDJK 48538451
         MVI   CCWCODE,TIC        MAKE IT A TIC CCW            @DY45299 48561661
         LA    R7,TERCCW00        ADDRESS OF ERP CCW           @DY45299 0000000 
         L     R6,TERCCCWR        GET FAILING CCW ADDRESS      @D61SDJK 48677351
         CLR   R6,R7              IS FAILING CCW AN ERP RETRY  @DY45299 0000000 
         BE    TERRT500           YES, LEAVE CHAIN AS IT IS    @DY45299 0000000 
         BL    TERRT485           NO, ITS A USER CCW           @DY45299 0000000 
         LA    R7,TERCCW02        ADDRESS OF ERP CCW           @DY45299 0000000 
         CLR   R6,R7              IS FAILING CCW AN ERP RETRY  @DY45299 0000000 
         BNH   TERRT500           YES, LEAVE CHAIN AS IT IS    @DY45299 0000000 
TERRT485 TM    TERFLG,TERCVPRF    FAILING CCW IS A PREFIX CCW  @DY45299 48687341
         BZ    TERRT490           NO                           @D61SDJK 48697331
         L     R6,CCBCCW31-CCBADR(RB) GET 1ST USER CCW ADDRESS @D66ADAP 48707321
TERRT490 STCM  R6,7,CCWBUF+1      PASS CONTROL TO RIGHT CCW    @D61SDJK 48717311
*                                                              @D61NDJK 48773061
*------------------------------------------------------------* @D61NDJK 48788161
*                                                              @D61NDJK 48803261
*   ISSUE RETRY I/O, IF THE RETRY COUNTER IS NOT EXHAUSTED.    @D61NDJK 48818361
*                                                              @D61NDJK 48833461
*------------------------------------------------------------* @D61NDJK 48848561
*                                                              @D61NDJK 48863661
TERRT500 CLI   TERRTCNT,TERRTLIM  RETRY COUNTER IS EXHAUSTED   @D61SDJK 48888751
         BNH   TERRT550           NO, DO RETRY                 @D61SDJK 48898741
*                                                              @D61NDJK 48908961
 SGTAP  'SGCOV ERPT610',NR=(20,6) RETRY COUNTER IS EXHAUSTED     TERRTY 48934041
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 48939161
         B     TERRTEX              "RETRY COUNTER EXHAUSTED"  @D61NDJK 48954261
*                                 SET UP CCB FOR RETRY I/O:    @D61NDJK 48974361
TERRT550 MVI   CCBCCW31,X'00'               PATH MASK          @D66ADAP 48974362
         CLC   TERCHQID,=AL2(ARTID)   USER I/O REQUEST         @D66ODOW 48974363
         BH    TERRT570                     YES, ASCII INFO    @DA44407 48974364
         MVC   CCBCCW31(1),CCBCCW31-CCBADR(RB) USER PATH MASK  @D66ADAP 48974365
TERRT570 STCM  R4,7,CCBCCW31+1              CCW ADDRESS        @D66ADAP 48974366
*                                 ALLOW MESSAGING WHILE..      @D61NDJK 49014661
         OI    TERFLG,TERCVMSG      WAITING FOR I/O COMPLETION @D61NDJK 49029761
*                                                              @D61NDJK 49044861
 SGTAP  'CALL  TERIO           ','ISSUE I/O REQUEST',          @D61NDJKX49059961
               I='1,2,3,B           ON RETURN ',               @D61NDJKX49075061
               O='F                 RF IS COMPLETION CODE'     @D61NDJK 49090161
*                                                              @D61NDJK 49105261
         MVI   CCBCCW31,X'00'     RESET PATH MASK              @D66ADAP 49112261
         NI    TERFLG,XFF-TERCVMSG  PREVENT MESSAGING IN TERIO.@D61NDJK 49120361
*                                     FOR FURTHER I/O REQUESTS @D61NDJK 49135461
 SGTAP  'SGCOV ERPT610',NR=(20,7) RETRY I/O COULD BE ISSUED      TERRTY 49160541
         SLR   R5,R5              INCREMENT..                  @D61NDJK 49165661
         IC    R5,TERRTCNT        THE..                        @D61NDJK 49180761
         LA    R5,1(,R5)            RETRY..                    @D61NDJK 49195861
         STC   R5,TERRTCNT          COUNTER                    @D61NDJK 49210961
*                                                              @D61NDJK 49226061
*------------------------------------------------------------* @D61NDJK 49241161
*                                                              @D61NDJK 49256261
*   EXIT HANDLING.                                             @D61NDJK 49271361
*                                                              @D61NDJK 49286461
*------------------------------------------------------------* @D61NDJK 49301561
*                                                              @D61NDJK 49316661
TERRTEX  SGTAP 'RETURN         ','RETURN TO CALLER         ',  @D61NDJKX49331761
               OUTPUT=(RF)                                     @D61NDJK 49346861
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 49361961
         LTORG                                                 @D61NDJK 49377061
         EJECT                                                 @D61NDJK 49392161
*                                                              @D61NDJK 49407261
***************************************************************         49422361
*  FUNCTION                                                    @D61NDJK 49437461
*    PERFORM READ OPPOSITE RECOVERY IN FOLLOWING STEPS:        @D61NDJK 49452561
*    - ALLOCATE ROR WORK AREA IN SYSTEM GETVIS AREA            @D61NDJK 49467661
*    - ISSUE READ OPPOSITE I/O REQUEST                         @D61NDJK 49482761
*    - SIMULATE READ OPERATION                                 @D61NDJK 49497861
*    - REPOSITION TAPE, IF NECESSARY                           @D61NDJK 49512961
*    - RESUME USER'S CHANNEL PROGRAM, IF APPLICABLE            @D61NDJK 49528061
*    - FREE ALLOCATED GETVIS AREA                              @D61NDJK 49543161
*                                                              @D61NDJK 49558261
*  INPUT                                                       @D61NDJK 49573361
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61NDJK 49588461
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 49603561
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61NDJK 49618661
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61NDJK 49626161
*                                                              @D61NDJK 49633761
*  OUTPUT                                                      @D61NDJK 49648861
*    - RF CONTAINS A RECOVERY COMPLETION CODE. POSSIBLE        @D61NDJK 49663961
*         COMPLETION CODES ARE:                                @D61NDJK 49679061
*           TERERSUC  -  RECOVERY WAS DONE SUCCESSFULLY        @D61NDJK 49694161
*           TERERUNS  -  RECOVERY FAILED                       @D61NDJK 49709261
*           TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED      @D61NDJK 49724361
*                        DURING RECOVERY I/O.                  @D61NDJK 49739461
*                                                              @D61NDJK 49754561
***************************************************************         49769661
 AGO  .GROR                                                   *#SECURGL 49784761
.LROR    AIF ('&TEST'(1,12) NE 'CALL  TERROR'  ).LURTY        *#SECURGL 49806851
 AIF   ('&I'(2,8)  NE '1,2,3,B '               ).DSINVC       *#SECURGL 49814961
 AIF   ('&O'(2,2)  EQ 'F '                     ).DSHEAD       *#SECURGL 49830061
 AGO  .DSINVC                                                 *#SECURGL 49845161
.GROR     ANOP                                                *#SECURGL 49860261
.**************************************************************         49875361
TERROR   SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 49890461
         USING CCBADR,R1                                       @D61NDJK 49905561
         USING ERBLKADR,R2                                     @D61NDJK 49920661
         USING PUBADR,R3                                       @D61NDJK 49935761
 SGTAP  'SGCOV ERPT610',NR=(21,0) TERROR ENTERED                 TERROR 49950251
*                                                              @D61NDJK 49965961
*------------------------------------------------------------* @D61NDJK 49981061
*   IF NO FAILING CCW IS AVAILABLE OR THE FAILING CCW IS       @D61NDJK 49996161
*   NEITHER A READ FORWARD, READ BACKWARD CCW, READ IPL,       @D61SDJK 50021251
*   NOR A READ PREVIOUS CCW, RECOVERY CAN'T BE DONE.           @D61SDJK 50031241
*------------------------------------------------------------* @D61NDJK 50041461
*                                                              @D61NDJK 50056561
         OC    TERCCCWV,TERCCCWV  RECOVERY IS POSSIBLE?        @D61NDJK 50071661
         BZ    TERRO050           NO                           @D61NDJK 50086761
         CLI   TERCCCWO,RDCOM     FAILING CCW..                @D61NDJK 50101861
         BE    TERRO100             IS A..                     @D61SDJK 50120951
         CLI   TERCCCWO,RDF         READ IPL,..                @D61SDJK 50124941
         BE    TERRO100             READ FORWARD,..            @D61SDJK 50128931
         CLI   TERCCCWO,RDP         READ PREVIOUS,..           @D61SDJK 50132921
         BE    TERRO100             OR READ..                  @D61SDJK 50136911
         CLI   TERCCCWO,READB       BACKWARD CCW?              @D61SDJK 50140901
         BE    TERRO100           YES                          @D61NDJK 50147161
*                                                              @D61NDJK 50162261
TERRO050 LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 50169761
 SGTAP  'SGCOV ERPT610',NR=(21,1) FAILING CCW INHIBITS ROR       TERROR 50187351
         B     TERROEX              "ROR NOT POSSIBLE"         @D61NDJK 50207561
*                                                              @D61NDJK 50222661
*------------------------------------------------------------* @D61NDJK 50237761
*                                                              @D61NDJK 50252861
*   ALLOCATE ROR WORK AREA IN SYSTEM GETVIS AREA.              @D61NDJK 50267961
*                                                              @D61NDJK 50283061
*------------------------------------------------------------* @D61NDJK 50298161
*                                                              @D61NDJK 50313261
*------------------------------------------------------------* @D61NDJK 50328361
*   PROVIDE GETVIS INPUT PARAMETERS.                           @D61NDJK 50343461
*------------------------------------------------------------* @D61NDJK 50358561
*                                                              @D61NDJK 50373661
TERRO100 CLI   TERDEVTY,TERTPA    IT IS A TPA DEVICE?          @D61SDJK 50374661
         BL    TERRO200           NO                           @D61SDJK 50375661
*                                                              @D61SDJK 50376661
.*  THE LENGTH OF THE TPA ROR WORK AREA IS NOT INDICATED IN    @D61SDJK 50377661
.*  TPA SENSE DATA.                                            @D61SDJK 50378661
.*                                                             @D61SDJK 50379661
 SGTAP  'SGCOV ERPT610',NR=(21,2) IT IS A TPA DEVICE             TERROR 50381661
         L     R0,=A(TERROMAX)    TAKE MAXIMAL LENGTH          @D61SDJK 50382661
         B     TERRO250                                        @D61SDJK 50383661
*                                                              @D61SDJK 50384661
.*  SENSE BYTE 31 CAN BE USED AS UPPER LIMIT OF THE AMOUNT     @D61NDJK 50388761
.*  OF MEMORY SPACE REQUIRED FOR 3480 READ OPPOSITE RECOVERY.  @D61SDJK 50410851
.*                                                             @D61NDJK 50418961
TERRO200 DS    0H                                              @D61SDJK 50437051
 SGTAP  'SGCOV ERPT610',NR=(21,3) IT IS A 3480-TYPE DEVICE       TERROR 50443031
         SLR   R0,R0              MULTIPLY AMOUNT OF BUFFERED..@D61SDJK 50446021
         ICM   R0,1,ERRQSNS+31      DATA IN MULTIPLES OF 4096..@D61NDJK 50449161
         SLA   R0,12                BYTES FROM SENSE BYTE 31.. @D61NDJK 50464261
*                                   BY 4096 TO GET REQUIRED..  @D61NDJK 50479361
*                                   LENGTH OF ROR WORK AREA    @D61NDJK 50494461
         L     R6,=A(TERROMAX)    LENGTH OF WORK AREA..        @D61NDJK 50509561
         CR    R6,R0                EXCEEDS MAXIMUM LENGTH?    @D61NDJK 50524661
         BH    TERRO250           NO                           @D61SDJK 50546751
*                                                              @D61NDJK 50554861
 SGTAP  'SGCOV ERPT610',NR=(21,4) NO OF BYTES IN BUFFER >= 64K-1 TERROR 50579941
         LR    R0,R6              TAKE MAXIMAL LENGTH          @D61NDJK 50585061
*                                                              @D61NDJK 50600161
TERRO250 ST    R0,TERROWAL        SAVE LENGTH OF ROR WORK AREA @D61SDJK 50622251
*                                                              @D61NDJK 50630361
*------------------------------------------------------------* @D61NDJK 50645461
*   ISSUE GETVIS REQUEST AND RESTORE WORK ENVIRONMENT.         @D61NDJK 50660561
*------------------------------------------------------------* @D61NDJK 50675661
*                                                              @D61NDJK 50690761
         MVC   TERROSID(4),TERROPFX  SET UP..                  @D61NDJK 50705861
         STH   R3,TERROSID+4           GETVIS SUBPOOL ID       @D61NDJK 50720961
*                                                              @D61NDJK 50736061
         LR    R7,R1              SAVE CCB POINTER             @D61NDJK 50741061
         LR    R5,RA              SAVE WORK AREA POINTER       @D61NDJK 50746061
         DROP  RA                 RELEASE OLD WORK AREA POINTER@D61NDJK 50749361
         USING TERGLOB,R5         TAKE NEW WORK AREA POINTER   @D61NDJK 50752661
         SLR   R0,R0              ESTABLISH..                  @D61SDJK 50753661
         USING SYSS00,R0            LOW CORE ADDRESSABILITY    @D61SDJK 50754661
         L     RA,TCBPTR          PROVIDE SGETVIS SAVE AREA    @D61NDJK 50756061
         DROP  R0                                              @D61SDJK 50761061
*                                                              @D61NDJK 50766261
         SGETVIS LENGTH=TERROWAL,SPID=TERROSID,PFIX=YES,       @D61NDJKX50781361
               ADDRESS=TERROWAA,PAGE=YES                       @D61NDJK 50796461
*                                                              @D61NDJK 50811561
         LR    RA,R5              RESTORE WORK AREA POINTER    @D61NDJK 50826661
         DROP  R5                 RELEASE OLD WORK AREA POINTER@D61NDJK 50831661
         USING TERGLOB,RA         TAKE NEW WORK AREA POINTER   @D61NDJK 50836661
         LR    R1,R7              RESTORE CCB POINTER          @D61NDJK 50839161
*                                                              @D61NDJK 50841761
 SGTAP  'SGCOV ERPT610',NR=(21,5) GETVIS REQUEST ISSUED          TERROR 50866841
*                                                              @D61NDJK 50871961
         LTR   RF,RF              ROR WORK AREA IS ALLOCATED?  @D61NDJK 50887061
         BZ    TERRO300           YES                          @D61SDJK 50909151
*                                                              @D61NDJK 50917261
 SGTAP  'SGCOV ERPT610',NR=(21,6) GETVIS REQUEST FAILED          TERROR 50942341
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 50947461
         B     TERROEX              "ROR FAILED"               @D61NDJK 50962561
*                                                              @D61NDJK 50977661
*------------------------------------------------------------* @D61SDJK 51092751
*                                                              @D61SDJK 51192741
*   SET UP ROR CCW AND ISSUE READ OPPOSITE I/O REQUEST.        @D61SDJK 51292731
*                                                              @D61SDJK 51392721
*------------------------------------------------------------* @D61SDJK 51492711
*                                                              @D61SDJK 51592701
TERRO300 LA    R4,TERCCWRO        POINT TO ROR CCW             @D61SDJK 51692691
 SGTAP  'CALL  TERRDOA         ','ISSUE ROR I/O REQUEST.',     @D61SDJKX51792681
               I='1,2,3,4,B         ON RETURN+4',              @D61SDJKX51892671
               O='7                 ROR I/O IS DONE',          @D61SDJKX51992661
               E0='TERRO930       ERROR: ROR I/O IS NOT DONE'  @D61SDJK 52092651
*                                                              @D61SDJK 52192641
*------------------------------------------------------------* @D61NDJK 52759461
*                                                              @D61NDJK 52774561
*   CHECK OUTCOME OF READ OPPOSITE I/O.                        @D61NDJK 52789661
*                                                              @D61NDJK 52804761
*------------------------------------------------------------* @D61NDJK 52819861
*                                                              @D61NDJK 52834961
*------------------------------------------------------------* @D61NDJK 52850061
*   IF READ OPPOSITE I/O MOVED THE TAPE, IT MUST BE            @D61NDJK 52865161
*   REPOSITIONED LATER.                                        @D61NDJK 52880261
*------------------------------------------------------------* @D61NDJK 52895361
*                                 TAPE WAS MOVED IN READ..     @D61NDJK 52910461
         TM    CCBSTA1,DEVEND       OPPOSITE DIRECTION?        @D61NDJK 52925561
         BZ    TERRO400           NO                           @D61NDJK 52940661
*                                                              @D61NDJK 52955761
 SGTAP  'SGCOV ERPT610',NR=(21,7) REPOSITIONING MUST BE DONE     TERROR 52980841
         OI    TERROFLG,TERROREP  REPOSITIONING MUST BE DONE   @D61NDJK 52985961
*                                                              @D61NDJK 53001061
*------------------------------------------------------------* @D61NDJK 53016161
*   IF READ OPPOSITE I/O FAILED, READ OPPOSITE RECOVERY MUST   @D61NDJK 53031261
*   BE DECLARED AS FAILED.                                     @D61NDJK 53046361
*------------------------------------------------------------* @D61NDJK 53061461
*                                                              @D61NDJK 53076561
TERRO400 TM    CCBSTA1,XFF-CHANEND-DEVEND UNUSUAL UNIT STATUS? @D61NDJK 53084061
         BNZ   TERRO420                   YES                  @D61NDJK 53091561
         TM    CCBSTA2,XFF-IL     UNUSUAL CHANNEL STATUS?      @D61NDJK 53099061
         BZ    TERRO450           NO                           @D61NDJK 53106761
*                                                              @D61NDJK 53121861
TERRO420 MVC   TERCCB(L'TERSVCCB),TERSVCCB   RESTORE SAVED CCB @D61NDJK 53144461
         OI    TERROFLG,TERRONOR  DO NOT RESUME USER CCW CHAIN @D61NDJK 53167161
 SGTAP  'SGCOV ERPT610',NR=(22,0) ROR I/O FAILED FOR ANY REASON  TERROR 53178641
         B     TERRO700                                        @D61NDJK 53182261
*                                                              @D61NDJK 53197361
*------------------------------------------------------------* @D61NDJK 53212461
*   IF THE SIZE OF THE RECORD IS GREATER THAN THE BYTE COUNT   @D61NDJK 53227561
*   OF THE READ OPPOSITE CCW, READ OPPOSITE RECOVERY MUST BE   @D61NDJK 53242661
*   DECLARED AS FAILED.                                        @D61NDJK 53257761
*------------------------------------------------------------* @D61NDJK 53272861
*                                                              @D61NDJK 53287961
TERRO450 SLR   R5,R5              RECORD SIZE IS SMALLER..     @D61NDJK 53303061
         ICM   R5,3,CCBCNT          THAN ROR CCW BYTE COUNT?   @D61NDJK 53318161
         BNZ   TERRO480           YES                          @D61NDJK 53333261
 SGTAP  'SGCOV ERPT610',NR=(22,1) RESIDUAL COUNT OF ROR I/O IS 0 TERROR 53358341
*                                 RECORD SIZE IS EQUAL..       @D61NDJK 53363461
         TM    CCBSTA2,IL           TO THE ROR CCW BYTE COUNT? @D61NDJK 53378561
         BZ    TERRO480           YES                          @D61NDJK 53393661
*                                                              @D61NDJK 53408761
 SGTAP  'SGCOV ERPT610',NR=(22,2) RECSIZE GREATER THAN EXPECTED  TERROR 53433841
         MVC   TERCCB(L'TERSVCCB),TERSVCCB   RESTORE SAVED CCB @D61NDJK 53438961
         OI    TERROFLG,TERRONOR  DO NOT RESUME USER CCW CHAIN @D61NDJK 53454061
         B     TERRO700                                        @D61NDJK 53469161
*                                                              @D61NDJK 53484261
TERRO480 MVC   TERCCB(L'TERSVCCB),TERSVCCB   RESTORE SAVED CCB @D61NDJK 53499361
*                                                              @D61NDJK 53529561
*------------------------------------------------------------* @D61NDJK 53544661
*                                                              @D61NDJK 53559761
*   SIMULATE THE READ OPERATION.                               @D61NDJK 53574861
*                                                              @D61NDJK 53650361
*------------------------------------------------------------* @D61NDJK 53665461
*                                                              @D61NDJK 53680561
*------------------------------------------------------------* @D61NDJK 53695661
*   PREPARE PARAMETERS FOR READ SIMULATION.                    @D61NDJK 53710761
*------------------------------------------------------------* @D61NDJK 53725861
*                                                              @D61NDJK 53740961
.*  R5: CONTAINS THE POSITION OF THE SIMULATED TAPE HEAD       @D61NDJK 53756061
.*  R7: CONTAINS THE LENGTH OF THE RECORD READ FROM TAPE       @D61NDJK 53771161
.*  R8: CONTAINS VIRTUAL ADDRESS OF CURRENT CCW IN DATA CHAIN  @D61NDJK 53786261
.*  R9: POINTS TO THE BEGIN OF THE RECORD IN THE ROR WORK AREA @D61NDJK 53801361
.*                                                             @D61NDJK 53816461
*                                 TAKE LENGTH OF RECORD..      @D61NDJK 53831561
         SLR   R7,R5                THAT WAS READ BY ROR I/O   @D61NDJK 53846661
*                                 POINT TO VIRTUAL ADDRESS OF..@D61SDJK 53871751
         L     R8,TERCCCWV          CURRENT CCW IN DATA CHAIN  @D61SDJK 53881741
*                                 FAILING CCW IS..             @D61NDJK 53907061
         CLI   TERCCCWO,READB       A READ BACKWARD CCW?       @D61NDJK 53922161
         BE    TERRO500           YES                          @D61NDJK 53937261
*                                 FAILING CCW IS..             @D61SDJK 53955351
         CLI   TERCCCWO,RDP         A READ PREVIOUS CCW?       @D61SDJK 53958341
         BE    TERRO520           YES                          @D61SDJK 53961331
*                                                              @D61SDJK 53964321
         L     R9,TERROWAA        PREPARE START ADDRESS..      @D61NDJK 53967461
         AL    R9,TERROWAL          OF THE RECORD IN..         @D61NDJK 53982561
         SLR   R9,R7                THE ROR WORK AREA          @D61NDJK 53997661
*                                 PREPARE POSITION OF..        @D61NDJK 54012761
         SLR   R5,R5                SIMULATED TAPE HEAD        @D61NDJK 54027861
         B     TERRO550                                        @D61NDJK 54042961
*                                 PREPARE RECORD START..       @D61NDJK 54058061
TERRO500 L     R9,TERROWAA          ADDRESS IN ROR WORK AREA   @D61NDJK 54073161
*                                                              @D61NDJK 54088261
         LR    R5,R7              PREPARE POSITION OF..        @D61NDJK 54103361
         BCTR  R5,0                 SIMULATED TAPE HEAD        @D61NDJK 54118461
         B     TERRO550                                        @D61SDJK 54233551
*                                 PREPARE RECORD START..       @D61SDJK 54333541
TERRO520 L     R9,TERROWAA          ADDRESS IN ROR WORK AREA   @D61SDJK 54433531
*                                 PREPARE POSITION OF..        @D61SDJK 54533521
         SLR   R5,R5                SIMULATED TAPE HEAD        @D61SDJK 54633511
*                                                              @D61SDJK 54733501
TERRO550 DS    0H                                              @D61SDJK 54833491
 SGTAP  'CALL  TERSIMRD        ','PERFORM READ SIMULATION',    @D61SDJKX54933481
               I='1,5,7,8,9         ON RETURN ',               @D61SDJKX55033471
               O='NONE              SIMULATION IS DONE'        @D61SDJK 55133461
*                                                              @D61SDJK 55233451
*------------------------------------------------------------* @D61NDJK 55462361
*                                                              @D61NDJK 55477461
*   REPOSITION TAPE, IF NECESSARY.                             @D61NDJK 55492561
*                                                              @D61NDJK 55507661
*------------------------------------------------------------* @D61NDJK 55522761
*                                                              @D61NDJK 55537861
*------------------------------------------------------------* @D61NDJK 55552961
*   SET UP REPOSITIONING CCW.                                  @D61NDJK 55568061
*------------------------------------------------------------* @D61NDJK 55583161
*                                                              @D61NDJK 55598261
TERRO700 TM    TERROFLG,TERROREP  REPOSITIONING IS REQUIRED?   @D61NDJK 55613361
         BZ    TERRO930           NO                           @D61NDJK 55628461
*                                                              @D61NDJK 55643561
         LA    R4,TERCCWRP        INITIALIZE..                 @D61NDJK 55658661
         USING CCWADR,R4            REPOSITIONING..            @D61NDJK 55673761
         XC    CCWTOT,CCWTOT        CCW:                       @D61NDJK 55688861
         MVI   CCWCHAIN,SLI         FLAG BYTE                  @D61NDJK 55703961
         MVI   CCWLNG+1,1           BYTE COUNT                 @D61NDJK 55719061
*                                                              @D61SDJK 55741151
         CLI   TERCCCWO,RDCOM     FAILING CCW IS..             @D61SDJK 55748141
         BE    TERRO750             A READ FORWARD..           @D61SDJK 55755131
         CLI   TERCCCWO,RDF         OR READ IPL CCW?           @D61SDJK 55762121
         BE    TERRO750           YES                          @D61SDJK 55769111
*                                                              @D61NDJK 55779461
         MVI   CCWCODE,TERBSBOP   ISSUE A BACKSPACE BLOCK CCW  @D61NDJK 55794561
         B     TERRO800                                        @D61NDJK 55809661
*                                                              @D61NDJK 55824761
TERRO750 MVI   CCWCODE,TERFSBOP   ISSUE A FWD SPACE BLOCK CCW  @D61NDJK 55839861
*                                                              @D61NDJK 55854961
*------------------------------------------------------------* @D61NDJK 55870061
*   ISSUE REPOSITIONING I/O.                                   @D61NDJK 55885161
*------------------------------------------------------------* @D61NDJK 55900261
*                                                              @D61NDJK 55915361
TERRO800 MVC   TERSVCCB,TERCCB    PRESERVE CCB                 @D61NDJK 55930461
*                                 SET UP CCB FOR ROR I/O:      @D61NDJK 55945561
         STCM  R4,7,CCBCCW31+1      START OF CHANNEL PROGRAM   @D66ADAP 55960661
*                                                              @D61NDJK 55975761
 SGTAP  'CALL  TERIO           ','ISSUE I/O REQUEST',          @D61NDJKX55990861
               I='1,2,3,B           ON RETURN ',               @D61NDJKX56005961
               O='F                 RF IS COMPLETION CODE'     @D61NDJK 56021061
*                                                              @D61NDJK 56036161
 SGTAP  'SGCOV ERPT610',NR=(22,3) REPOSITIONING I/O ISSUED       TERROR 56072341
*                                               UNUSUAL..      @D61NDJK 56075761
         TM    CCBSTA1,XFF-CHANEND-DEVEND-CUEND   UNIT STATUS? @D61NDJK 56085161
         BNZ   TERRO850                   YES                  @D61NDJK 56094561
         TM    CCBSTA2,XFF-IL     UNUSUAL CHANNEL STATUS?      @D61NDJK 56103961
         BZ    TERRO870           NO                           @D61NDJK 56113361
*                                                                       56122761
TERRO850 OI    TERROFLG,TERRONOR  DO NOT RESUME USER CCW CHAIN @D61NDJK 56132161
 SGTAP  'SGCOV ERPT610',NR=(22,4) REPOSITIONING I/O FAILED       TERROR 56151841
TERRO870 MVC   TERCCB(L'TERSVCCB),TERSVCCB  RESTORE SAVED CCB  @D61NDJK 56156961
*                                                              @D61NDJK 56172061
*------------------------------------------------------------* @D61NDJK 56187161
*                                                              @D61NDJK 56202261
*   RESUME USER'S CHANNEL PROGRAM, IF APPLICABLE.              @D61NDJK 56217361
*                                                              @D61NDJK 56232461
*------------------------------------------------------------* @D61NDJK 56247561
*                                                              @D61NDJK 56262661
*------------------------------------------------------------* @D61NDJK 56277761
*   IF AN ERROR OCCURRED DURING READ SIMULATION, THE           @D61NDJK 56292861
*   USER'S CHANNEL PROGRAM WON'T BE RESUMED.                   @D61NDJK 56307961
*------------------------------------------------------------* @D61NDJK 56323061
*                                 USER CCW CHAIN SHOULD BE..   @D61NDJK 56338161
TERRO900 TM    TERROFLG,TERRONOR    RESUMED, IF POSSIBLE?      @D61NDJK 56353261
         BO    TERRO930             NO                         @D61NDJK 56368361
*                                 ERROR OCCURRED DURING..      @D61NDJK 56383461
         TM    CCBSTA2,PGMC+PCK+IL      READ SIMULATION?       @D61NDJK 56398561
         BNZ   TERRO910           YES                          @D61NDJK 56413661
*                                                              @D61NDJK 56428761
 SGTAP  'CALL  TERRESUM        ','RESUME USER CCW CHAIN',      @D61NDJKX56443861
               I='1,2,3,B           ON RETURN ',               @D61NDJKX56458961
               O='F                 RF IS COMPLETION CODE'     @D61NDJK 56474061
*                                                              @D61NDJK 56489161
         B     TERRO950           EXIT WITH PASSED COMPL. CODE @D61NDJK 56504261
*                                                              @D61NDJK 56519361
TERRO910 TM    CCBSTA2,IL         INCORR. LENGTH IS SET IN CSW?@D61NDJK 56534461
         BO    TERRO920           YES                          @D61NDJK 56549561
*                                                              @D61NDJK 56564661
         LA    RF,TERERAEC        EXIT WITH COMPLETION CODE..  @D61NDJK 56579761
*                                   "ANOTHER ERROR OCCURRED"   @D61NDJK 56594861
 SGTAP  'SGCOV ERPT610',NR=(22,5) EXIT WITH COMPL. CODE TERERAEC TERROR 56619941
         B     TERRO950           EXIT WITH PASSED COMPL. CODE @D61NDJK 56625061
*                                                              @D61NDJK 56640161
TERRO920 LA    RF,TERERSUC        EXIT WITH COMPLETION CODE..  @D61NDJK 56655261
*                                   "ROR SUCCESSFUL"           @D61NDJK 56670361
 SGTAP  'SGCOV ERPT610',NR=(22,6) EXIT WITH COMPL. CODE TERERSUC TERROR 56695441
         B     TERRO950           EXIT WITH PASSED COMPL. CODE @D61NDJK 56700561
*                                                              @D61NDJK 56715661
TERRO930 LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 56730761
*                                   "ROR UNSUCCESSFUL"         @D61NDJK 56745861
 SGTAP  'SGCOV ERPT610',NR=(22,7) EXIT WITH COMPL. CODE TERERUNS TERROR 56770941
*                                                              @D61NDJK 56776061
*------------------------------------------------------------* @D61NDJK 56791161
*                                                              @D61NDJK 56806261
*   FREE ALLOCATED GETVIS AREA.                                @D61NDJK 56821361
*                                                              @D61NDJK 56836461
*------------------------------------------------------------* @D61NDJK 56851561
*                                                              @D61NDJK 56866661
*------------------------------------------------------------* @D61NDJK 56881761
*   ISSUE FREEVIS REQUEST AND RESTORE WORK ENVIRONMENT.        @D61NDJK 56896861
*------------------------------------------------------------* @D61NDJK 56911961
*                                                              @D61NDJK 56927061
TERRO950 LR    R5,RA              SAVE WORK AREA POINTER       @D61NDJK 56937061
         DROP  RA                 RELEASE OLD WORK AREA POINTER@D61NDJK 56940361
         USING TERGLOB,R5         TAKE NEW WORK AREA POINTER   @D61NDJK 56943661
         LR    R6,RF              SAVE COMPLETION CODE         @D61NDJK 56945361
         SLR   R0,R0              ESTABLISH..                  @D61SDJK 56945861
         USING SYSS00,R0            LOW CORE ADDRESSABILITY    @D61SDJK 56946361
         L     RA,TCBPTR          PROVIDE SFREEVIS SAVE AREA   @D61NDJK 56947061
         DROP  R0                                              @D61SDJK 56952061
*                                                              @D61NDJK 56957261
         SFREEVIS SPID=TERROSID                                @D61NDJK 56972361
*                                                              @D61NDJK 56987461
         LR    RA,R5              RESTORE WORK AREA POINTER    @D61NDJK 57002561
         DROP  R5                 RELEASE OLD WORK AREA POINTER@D61NDJK 57007561
         USING TERGLOB,RA         TAKE NEW WORK AREA POINTER   @D61NDJK 57012561
         LR    RF,R6              RESTORE COMPLETION CODE      @D61NDJK 57015061
*                                                              @D61NDJK 57017661
 SGTAP  'SGCOV ERPT610',NR=(23,0) FREEVIS REQUEST ISSUED         TERROR 57042741
*                                                              @D61NDJK 57047861
*------------------------------------------------------------* @D61NDJK 57062961
*                                                              @D61NDJK 57078061
*   EXIT HANDLING.                                             @D61NDJK 57093161
*                                                              @D61NDJK 57108261
*------------------------------------------------------------* @D61NDJK 57123361
*                                                              @D61NDJK 57138461
TERROEX  SGTAP 'RETURN         ','RETURN TO CALLER         ',  @D61NDJKX57153561
               OUTPUT=(RF)                                     @D61NDJK 57168661
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 57183761
*                                                              @D61NDJK 57198861
*------------------------------------------------------------* @D61NDJK 57213961
*                                                              @D61NDJK 57229061
*   LOCAL VARIABLES USED IN TERROR                             @D61NDJK 57244161
*                                                              @D61NDJK 57259261
*------------------------------------------------------------* @D61NDJK 57274361
*                                                              @D61NDJK 57289461
TERROPFX DC   C'IROR'             FIRST 4 CHARACTERS OF READ   @D61NDJK 57364961
*                                 OPPOSITE RECOVERY SUBPOOL ID @D61NDJK 57380061
         LTORG                                                 @D61NDJK 57395161
         EJECT                                                 @D61NDJK 57410261
*                                                              @D61NDJK 57425361
***************************************************************         57425461
*  FUNCTION                                                    @D61SDJK 57425651
*    PREPARE USER RETRY RECOVERY.                              @D61SDJK 57425741
*                                                              @D61SDJK 57425831
*  INPUT                                                       @D61SDJK 57425921
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61SDJK 57426011
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61SDJK 57426101
*                                                              @D61SDJK 57426191
*  OUTPUT                                                      @D61SDJK 57426281
*    - ERRQ1CCW MAY CONTAIN A RETRY CCW ADDRESS.               @D61SDJK 57426371
*                                                              @D61SDJK 57426461
***************************************************************         57426861
 AGO  .GURTY                                                  *#SECURGL 57427031
.LURTY   AIF ('&TEST'(1,13) NE 'CALL  TERURTY' ).LUNL         *#SECURGL 57427101
 AIF   ('&I'(2,4)  NE '2,B '                   ).DSINVC       *#SECURGL 57427171
 AIF   ('&O'(2,4)  EQ 'NONE'                   ).DSHEAD       *#SECURGL 57427241
 AGO  .DSINVC                                                 *#SECURGL 57427361
.GURTY    ANOP                                                *#SECURGL 57427501
.**************************************************************         57427561
TERURTY  SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61SDJK 57427951
         USING ERBLKADR,R2                                     @D61SDJK 57428241
 SGTAP  'SGCOV ERPT610',NR=(24,0) USER RETRY RECOVERY           TERURTY 57428531
*                                                              @D61SDJK 57429111
*------------------------------------------------------------* @D61SDJK 57429401
*                                                              @D61SDJK 57429691
*   IF THE FAILING CCW IS THE FIRST CCW IN THE USER'S CHANNEL  @D61SDJK 57429981
*   PROGRAM OR IT IS A PREFIX CCW, THE WHOLE USER CHANNEL      @D61SDJK 57430271
*   PROGRAM CAN BE RETRIED. OTHERWISE, THE ADDRESS OF THE      @D61SDJK 57430561
*   FIRST CCW TO BE RETRIED HAS TO BE PROVIDED IN THE ERROR    @D61SDJK 57430851
*   ENTRY THAT WILL BE PASSED TO THE I/O SUPERVISOR.           @D61SDJK 57431141
*                                                              @D61SDJK 57431431
*------------------------------------------------------------* @D61SDJK 57431721
*                                                              @D61SDJK 57432011
         XC    ERRQ1CCW,ERRQ1CCW  DO NOT PROVIDE RETRY CCW     @D61SDJK 57432301
         TM    TERFLG,TERCVPRF    FAILING CCW IS A PREFIX CCW? @D61SDJK 57432591
         BO    TERUREX            YES                          @D61SDJK 57432881
*                                                              @D61SDJK 57433171
 SGTAP  'SGCOV ERPT610',NR=(24,1) FAILING CCW IS NO PREFIX CCW  TERURTY 57433461
         L     R8,TERCCCWR        FAILING COMMAND CCW IS THE.. @D61SDJK 57434041
         CLM   R8,7,CCBCCW31+1-CCBADR(RB) 1ST CCW IN USER CHAIN@D66ADAP 57434331
         BE    TERUREX            YES                          @D61SDJK 57434621
*                                                              @D61SDJK 57434911
 SGTAP  'SGCOV ERPT610',NR=(24,2) RETRY CCW HAS TO BE PROVIDED  TERURTY 57435201
         ST    R8,ERRQ1CCW        PROVIDE RETRY CCW ADDRESS    @D61SDJK 57435781
*                                                              @D61SDJK 57436071
*------------------------------------------------------------* @D61SDJK 57436361
*                                                              @D61SDJK 57436651
*   EXIT HANDLING.                                             @D61SDJK 57436941
*                                                              @D61SDJK 57437231
*------------------------------------------------------------* @D61SDJK 57437521
*                                                              @D61SDJK 57437811
TERUREX  SGTAP 'RETURN         ','RETURN TO CALLER'            @D61SDJK 57438101
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61SDJK 57438391
         LTORG                                                 @D61SDJK 57438681
         EJECT                                                 @D61SDJK 57438971
*                                                              @D61SDJK 57439261
         AGO   .NOUNL10                                        @D61SDJK 57439551
***************************************************************         57440461
*  FUNCTION                                                    @D61NDJK 57455561
*    PERFORM REWIND UNLOAD RECOVERY.                           @D61NDJK 57470661
*                                                              @D61NDJK 57485761
*  INPUT                                                       @D61NDJK 57500861
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61NDJK 57515961
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 57531061
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61NDJK 57546161
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61NDJK 57553661
*                                                              @D61NDJK 57561261
*  OUTPUT                                                      @D61NDJK 57576361
*    - RF CONTAINS A RECOVERY COMPLETION CODE. POSSIBLE        @D61NDJK 57591461
*         COMPLETION CODES ARE:                                @D61NDJK 57606561
*           TERERSUC  -  REWIND UNLOAD REQUEST COMPLETED       @D61NDJK 57621661
*                        SUCCESSFULLY                          @D61NDJK 57636761
*           TERERUNS  -  REWIND UNLOAD REQUEST COULDN'T        @D61NDJK 57651861
*                        BE PERFORMED SUCCESSFULLY             @D61NDJK 57666961
*                                                              @D61NDJK 57682061
***************************************************************         57697161
 AGO  .GUNL                                                   *#SECURGL 57712261
.LUNL    AIF ('&TEST'(1,12) NE 'CALL  TERUNL'  ).LCHKR        *#SECURGL 57727361
 AIF   ('&I'(2,8)  NE '1,2,3,B '               ).DSINVC       *#SECURGL 57742461
 AIF   ('&O'(2,2)  EQ 'F '                     ).DSHEAD       *#SECURGL 57757561
 AGO  .DSINVC                                                 *#SECURGL 57772661
.GUNL     ANOP                                                *#SECURGL 57787761
.**************************************************************         57802861
TERUNL   SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 57817961
         USING CCBADR,R1                                       @D61NDJK 57833061
         USING ERBLKADR,R2                                     @D61NDJK 57848161
         USING PUBADR,R3                                       @D61NDJK 57863261
         USING PUBADR,RB                                       @D61NDJK 57878361
*                                                              @D61NDJK 57893461
*------------------------------------------------------------* @D61NDJK 57908561
*                                                              @D61NDJK 57923661
*   PREPARE CCB AND REWIND UNLOAD CCW.                         @D61NDJK 57938761
*                                                              @D61NDJK 57953861
*------------------------------------------------------------* @D61NDJK 57968961
*                                                              @D61NDJK 57984061
         MVC   TERS2CCB,TERCCB    PRESERVE CCB                 @D61NDJK 57999161
*                                                              @D61NDJK 58014261
         LA    R8,TERCCWRU        SET UP CCB FOR RUN I/O:      @D61NDJK 58029361
         STCM  R8,7,CCBCCW31+1      START OF CHANNEL PROGRAM   @D66ADAP 58044461
*                                                              @D61NDJK 58059561
         USING CCWADR,R8                                       @D61NDJK 58074661
         XC    CCWTOT,CCWTOT      SET UP CCW FOR RUN I/O:      @D61NDJK 58089761
         MVI   CCWCODE,REWUNL       RUN OPCODE                 @D61NDJK 58104861
         MVI   CCWCHAIN,SLI         FLAG BYTE                  @D61NDJK 58119961
         MVI   CCWLNG+1,1           BYTE COUNT                 @D61NDJK 58135061
*                                                              @D61NDJK 58150161
*------------------------------------------------------------* @D61NDJK 58165261
*                                                              @D61NDJK 58180361
*   ATTEMPT REWIND UNLOAD I/O.                                 @D61NDJK 58195461
*                                                              @D61NDJK 58210561
*------------------------------------------------------------* @D61NDJK 58225661
*                                                              @D61NDJK 58240761
*------------------------------------------------------------* @D61NDJK 58255861
*   IF THE I/O REQUEST COMPLETES W/O ANOTHER UNIT CHECK,       @D61NDJK 58270961
*   IT CAN BE ASSUMED THAT THE REWIND UNLOAD I/O WAS NOT       @D61NDJK 58286061
*   DONE. IF ANOTHER UNIT CHECK IS REPORTED, SENSE DATA        @D61NDJK 58301161
*   MUST BE ANALYZED IN ORDER TO DETERMINE THE COMPLETION      @D61NDJK 58316261
*   CODE.                                                      @D61NDJK 58331361
*------------------------------------------------------------* @D61NDJK 58346461
*                                                              @D61NDJK 58361561
         SLR   R5,R5              INITIALIZE RUN I/O COUNTER   @D61NDJK 58376661
TERUN100 LA    R5,1(R5)           INCREMENT RUN I/O COUNTER    @D61NDJK 58391761
*                                                              @D61NDJK 58406861
 SGTAP  'CALL  TERIO           ','ISSUE I/O REQUEST',          @D61NDJKX58421961
               I='1,2,3,B           ON RETURN ',               @D61NDJKX58437061
               O='F                 RF IS COMPLETION CODE'     @D61NDJK 58452161
*                                                              @D61NDJK 58467261
         LTR   RF,RF              ANOTHER ERROR OCCURRED?      @D61NDJK 58482361
         BZ    TERUN150           NO                           @D61NDJK 58497461
         TM    CCBSTA1,UNITCK     A UNIT CHECK IS REPORTED?    @D61NDJK 58527661
         BO    TERUN200           YES                          @D61NDJK 58542761
*                                                              @D61NDJK 58572961
TERUN150 CLI   R5,TERRTLIM        RUN I/O COUNTER IS EXHAUSTED?@D61NDJK 58588061
         BNH   TERUN100           NO                           @D61NDJK 58603161
*                                                              @D61NDJK 58618261
         MVC   TERCCB(L'TERS2CCB),TERS2CCB  RESTORE SAVED CCB  @D61NDJK 58648461
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 58663561
         B     TERUNEX              "RUN I/O UNSUCCESSFUL"     @D61NDJK 58678661
*                                                              @D61NDJK 58693761
*------------------------------------------------------------* @D61NDJK 58708861
*                                                              @D61NDJK 58723961
*   DETERMINE WHETHER THE TAPE IS UNLOADED OR NOT.             @D61NDJK 58739061
*                                                              @D61NDJK 58754161
*------------------------------------------------------------* @D61NDJK 58769261
*                                                              @D61NDJK 58784361
*------------------------------------------------------------* @D61NDJK 58799461
*   ANALYZE ERA CODE IN SENSE BYTE 3.                          @D61NDJK 58814561
*------------------------------------------------------------* @D61NDJK 58829661
*                                                              @D61NDJK 58844761
.*  ERA CODES THAT INDICATE AN UNLOADED TAPE AND DO NOT        @D61NDJK 58859861
.*  REQUIRE RECORDING:  ERA 43 AND ERA 52                      @D61NDJK 58874961
.*  ERA CODES THAT INDICATE AN UNLOADED TAPE BUT REQUIRE       @D61NDJK 58890061
.*  RECORDING:  ERA 2B                                         @D61NDJK 58905161
.*  ERA CODES THAT REQUIRE RECORDING BUT INDICATE THAT THE     @D61NDJK 58920261
.*  TAPE HAS NOT BEEN UNLOADED:  ERA 2A, ERA 50 AND ERA 51     @D61NDJK 58935361
.*  ALL OTHER ERA CODES INDICATE A STILL LOADED TAPE AND       @D61NDJK 58950461
.*  ARE JUST IGNORED.                                          @D61NDJK 58965561
.*                                                             @D61NDJK 58980661
TERUN200 SLR   R5,R5              GET ERA CODE FROM SENSE..    @D61NDJK 58995761
         ICM   R5,1,TERSNS+3        BYTE 3                     @D61NDJK 59010861
         XC    TERSNS,TERSNS      CLEAR SENSE BYTES            @D61NDJK 59033461
*                                                              @D61NDJK 59056161
         CLI   R5,X'2B'           TAPE..                       @D61NDJK 59071261
         BE    TERUN220             UNIT..                     @D61NDJK 59086361
         CLI   R5,X'43'             HAS..                      @D61NDJK 59101461
         BE    TERUN220             BEEN..                     @D61NDJK 59116561
         CLI   R5,X'52'             UNLOADED?                  @D61NDJK 59131661
         BNE   TERUN250           NO                           @D61NDJK 59146761
*                                                              @D61NDJK 59161861
TERUN220 LA    RF,TERERSUC        ERA CODE WAS 2B, 43 OR 52    @D61NDJK 59176961
         B     TERUN300                                        @D61NDJK 59192061
*                                                              @D61NDJK 59207161
TERUN250 CLI   R5,X'2A'           NEW..                        @D61NDJK 59222261
         BE    TERUN270             ERROR..                    @D61NDJK 59237361
         CLI   R5,X'50'             CONDITION..                @D61NDJK 59252461
         BE    TERUN270             SHALL BE..                 @D61NDJK 59267561
         CLI   R5,X'51'             IGNORED?                   @D61NDJK 59282661
         BNE   TERUN150           YES                          @D61NDJK 59297761
*                                                              @D61NDJK 59312861
TERUN270 LA    RF,TERERUNS        TAKE THAT COMPLETION CODE    @D61NDJK 59327961
*                                                              @D61NDJK 59358161
*------------------------------------------------------------* @D61NDJK 59373261
*                                                              @D61NDJK 59388361
*   PERFORM RECORDING FOR NEW ERROR CONDITION, IF APPLICABLE.  @D61NDJK 59403461
*                                                              @D61NDJK 59418561
*------------------------------------------------------------* @D61NDJK 59433661
*                                                              @D61NDJK 59448761
*------------------------------------------------------------* @D61NDJK 59463861
*   GET NEW RECOVERY ATTRIBUTES FROM RECOVERY ACTION TABLE.    @D61NDJK 59478961
*------------------------------------------------------------* @D61NDJK 59494061
*                                                              @D61NDJK 59509161
TERUN300 LR    R9,RF              SAVE COMPLETION CODE AND..   @D61NDJK 59524261
         MVC   TERSAVSR(TERRATBL),TERRCVSR RECOVERY ATTRIBUTES @D61NDJK 59539361
*                                                              @D61NDJK 59554461
         MH    R5,=AL2(TERRATBL)  CONSIDER ERA CODE AS MECC    @D61NDJK 59569561
*                                                              @D61NDJK 59584661
         A     R5,=A(TERRATB)     ACCESS RECOVERY ACTION..     @D61NDJK 59599761
         MVC   TERRCVSR(TERRATBL),0(R5)  TABLE AND SET NEW..   @D61NDJK 59614861
*                                        RECOVERY ATTRIBUTES   @D61NDJK 59629961
*------------------------------------------------------------* @D61NDJK 59645061
*   PERFORM READ BUFFERED LOG RECOVERY, IF REQUIRED.           @D61NDJK 59660161
*------------------------------------------------------------* @D61NDJK 59675261
*                                                              @D61NDJK 59690361
         TM    TERFLGPS,TERPSRBL  READ BUFFERED LOG REQUIRED?  @D61SDJK 59712451
         BZ    TERUN400           NO                           @D61NDJK 59720561
*                                                              @D61NDJK 59735661
 SGTAP  'CALL  TERRBL          ','PERFORM READ    ',           @D61NDJKX59765861
               I='1,2,3,B           BUFFERED',                 @D61NDJKX59780961
               O='NONE              LOG RECOVERY',             @D61NDJKX59796061
               E0='TERUN500       ERROR: RBL UNSUCCESSFUL'     @D61NDJK 59811161
*                                                              @D61NDJK 59841361
*------------------------------------------------------------* @D61NDJK 59856461
*  PERFORM RECORDING, IF NECESSARY.                            @D61NDJK 59871561
*------------------------------------------------------------* @D61NDJK 59886661
*                                                              @D61NDJK 59901761
TERUN400 LA    RF,TERERSUC        PREVENT CONDITIONAL RECORDING@D61NDJK 59916861
*                                                              @D61NDJK 59931961
 SGTAP  'CALL  TERLOG          ','ON RETURN RECORDING',        @D61NDJKX59947061
               I='1,2,3,F           IS DONE IF IT WAS',        @D61NDJKX59962161
               O='NONE              DESIRABLE'                 @D61NDJK 59977261
*                                                              @D61NDJK 59992361
*                                                              @D61NDJK 60022561
*------------------------------------------------------------* @D61NDJK 60037661
*                                                              @D61NDJK 60052761
*   SET UP REWIND UNLOAD RECOVERY COMPLETION CODE.             @D61NDJK 60067861
*                                                              @D61NDJK 60082961
*------------------------------------------------------------* @D61NDJK 60098061
*                                                              @D61NDJK 60113161
TERUN500 LR    RF,R9              RESTORE COMPLETION CODE AND..@D61NDJK 60128261
         MVC   TERRCVSR(TERRATBL),TERSAVSR RECOVERY ATTRIBUTES @D61NDJK 60143361
*                                                              @D61NDJK 60158461
         LA    R9,TERERSUC        TAPE HAS BEEN..              @D61NDJK 60173561
         CR    RF,R9                UNLOADED SUCCESSFULLY?     @D61NDJK 60188661
         BNE   TERUN150           NO                           @D61NDJK 60203761
*                                                              @D61NDJK 60218861
         MVC   TERCCB(L'TERS2CCB),TERS2CCB   RESTORE SAVED CCB @D61NDJK 60249061
*                                                              @D61NDJK 60264161
*------------------------------------------------------------* @D61NDJK 60279261
*                                                              @D61NDJK 60294361
*   EXIT HANDLING.                                             @D61NDJK 60309461
*                                                              @D61NDJK 60324561
*------------------------------------------------------------* @D61NDJK 60339661
*                                                              @D61NDJK 60354761
TERUNEX  SGTAP 'RETURN         ','RETURN TO CALLER         ',  @D61NDJKX60369861
               OUTPUT=(RF)                                     @D61NDJK 60384961
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 60400061
         LTORG                                                 @D61NDJK 60415161
         EJECT                                                 @D61NDJK 60430261
*                                                              @D61NDJK 60445361
.NOUNL10 ANOP                                                  @D61NDJK 60452861
***************************************************************         60460461
*  FUNCTION                                                    @D61NDJK 60475561
*    PERFORM CHANNEL DATA CHECK AND CHANNEL CHAINING CHECK     @D61NDJK 60490661
*    RECOVERY.                                                 @D61NDJK 60505761
*                                                              @D61NDJK 60520861
*  INPUT                                                       @D61NDJK 60535961
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61NDJK 60551061
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 60566161
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61NDJK 60581261
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61NDJK 60588761
*                                                              @D61NDJK 60596361
*  OUTPUT                                                      @D61NDJK 60611461
*    - RF CONTAINS A RECOVERY COMPLETION CODE. POSSIBLE        @D61NDJK 60626561
*         COMPLETION CODES ARE:                                @D61NDJK 60641661
*           TERERSUC  -  RECOVERY COMPLETED SUCCESSFULLY       @D61NDJK 60656761
*           TERERUNS  -  RECOVERY WAS NOT POSSIBLE OR FAILED   @D61NDJK 60671861
*           TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED      @D61NDJK 60686961
*                        DURING RECOVERY I/O                   @D61NDJK 60702061
*                                                              @D61NDJK 60717161
***************************************************************         60732261
 AGO  .GCHKR                                                  *#SECURGL 60747361
.LCHKR   AIF ('&TEST'(1,14) NE 'CALL  TERCHKR ').LRESUM       *#SECURGL 60762461
 AIF   ('&I'(2,8)  NE '1,2,3,B '               ).DSINVC       *#SECURGL 60777561
 AIF   ('&O'(2,2)  EQ 'F '                     ).DSHEAD       *#SECURGL 60792661
 AGO  .DSINVC                                                 *#SECURGL 60807761
.GCHKR    ANOP                                                *#SECURGL 60822861
.**************************************************************         60837961
TERCHKR  SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 60853061
         USING CCBADR,R1                                       @D61NDJK 60868161
         USING ERBLKADR,R2                                     @D61NDJK 60883261
         USING PUBADR,R3                                       @D61NDJK 60898361
 SGTAP  'SGCOV ERPT610',NR=(25,0) TERCHKR ENTERED               TERCHKR 60915851
*                                                              @D61NDJK 60928561
*------------------------------------------------------------* @D61NDJK 60943661
*                                                              @D61NDJK 60958761
*   THE ERROR CONDITION IS NOT RECOVERABLE, IF THE FAILING     @D61NDJK 60973861
*   CCW IS A READ BUFFER CCW OR HAS SET COMMAND CHAINING       @D61NDJK 60988961
*   TOGETHER WITH DATA CHAINING IN ITS FLAG.                   @D61NDJK 61004061
*                                                              @D61NDJK 61019161
*------------------------------------------------------------* @D61NDJK 61034261
*                                                              @D61NDJK 61049361
         L     R8,TERFCCWV        MAKE FAILING CCW..           @D61NDJK 61064461
         USING CCWADR,R8            ADDRESSABLE                @D61NDJK 61079561
*                                                              @D61NDJK 61094661
         OC    TERCCCWV,TERCCCWV  RETRY IS POSSIBLE?           @D61NDJK 61109761
         BZ    TERCH100           NO                           @D61NDJK 61124861
         CLI   TERCCCWO,TERRBOP   THE ERROR..                  @D61NDJK 61139961
         BE    TERCH100             CONDITION..                @D61NDJK 61155061
         TM    CCWCHAIN,DC+CC       IS RECOVERABLE?            @D61NDJK 61170161
         BNO   TERCH200           YES                          @D61NDJK 61185261
*                                                              @D61NDJK 61200361
TERCH100 DS    0H                                              @D61NDJK 61215461
 SGTAP  'SGCOV ERPT610',NR=(25,1) ERROR IS NOT RECOVERABLE      TERCHKR 61237551
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 61245661
         B     TERCHEX              "RECOVERY NOT POSSIBLE"    @D61NDJK 61260761
*                                                              @D61NDJK 61275861
*------------------------------------------------------------* @D61NDJK 61290961
*                                                              @D61NDJK 61306061
*   THE ERROR CONDITION IS RECOVERABLE, IF A UNIT CHECK        @D61NDJK 61321161
*   WITH ASSOCIATED SENSE DATA INDICATING ERA CODE 49          @D61NDJK 61336261
*   IS ACCOMPAGNYING THE CHANNEL CHECK.                        @D61NDJK 61351361
*                                                              @D61NDJK 61366461
*------------------------------------------------------------* @D61NDJK 61381561
*                                                              @D61NDJK 61396661
.*  CHECKING ERA CODE 49 IS ONLY DONE FOR ROBUSTNESS, SINCE    @D61NDJK 61411761
.*  CHANNEL CHECK RECOVERY SHOULDN'T BE CALLED IF ANOTHER      @D61NDJK 61426861
.*  ERA CODE IS INDICATED IN SENSE DATA.                       @D61NDJK 61441961
.*                                                             @D61NDJK 61457061
TERCH200 TM    CCBSTA1,UNITCK     A UNIT CHECK IS REPORTED?    @D61NDJK 61472161
         BZ    TERCH300           NO                           @D61NDJK 61487261
         CLI   ERRQSNS+3,X'49'    IT IS A BUSOUT CHECK?        @D61NDJK 61502361
         BNE   TERCH250           NO                           @D61NDJK 61517461
*                                                              @D61NDJK 61532561
 SGTAP  'CALL  TERRTY          ','RETRY FAILING CCW',          @D61NDJKX61547661
               I='1,2,3,B           ON RETURN',                @D61NDJKX61562761
               O='F                 RF IS RETURN CODE'         @D61NDJK 61577861
*                                                              @D61NDJK 61592961
 SGTAP  'SGCOV ERPT610',NR=(25,2) FAILING CCW HAS BEEN RETRIED  TERCHKR 61615051
         B     TERCHEX            PASS COMPLETION CODE         @D61NDJK 61623161
*                                                              @D61NDJK 61638261
TERCH250 DS    0H                                              @D61NDJK 61653361
 SGTAP  'SGCOV ERPT610',NR=(25,3) IT IS A UC BUT NOT ERA 49     TERCHKR 61675451
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 61683561
         B     TERCHEX              "RECOVERY NOT POSSIBLE"    @D61NDJK 61698661
*                                                              @D61NDJK 61713761
*------------------------------------------------------------* @D61NDJK 61728861
*                                                              @D61NDJK 61743961
*   THE ERROR CONDITION IS ALSO RECOVERABLE, IF THE FAILING    @D61NDJK 61759061
*   CCW IS A DATA TRANSFER CCW. BEFORE THE RETRY REQUEST       @D61NDJK 61774161
*   CAN BE ISSUED, THE TAPE MUST BE PROPERLY POSITIONED.       @D61NDJK 61789261
*                                                              @D61NDJK 61804361
*------------------------------------------------------------* @D61NDJK 61819461
*                                                              @D61NDJK 61834561
TERCH300 CLI   TERCCCWO,WRITE     FAILING..                    @D61NDJK 61849661
         BE    TERCH400             CCW IS..                   @D61NDJK 61864761
         CLI   TERCCCWO,RDCOM       A DATA..                   @D61NDJK 61879861
         BE    TERCH400             TRANSFER..                 @D61NDJK 61894961
         CLI   TERCCCWO,READB       CCW?                       @D61NDJK 61910061
         BE    TERCH400           YES                          @D61NDJK 61925161
*                                                              @D61NDJK 61940261
 SGTAP  'SGCOV ERPT610',NR=(25,4) FAIL. CCW IS NO DATA XFER CCW TERCHKR 61962351
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 61970461
         B     TERCHEX              "RECOVERY NOT POSSIBLE"    @D61NDJK 61985561
*                                                              @D61NDJK 62000661
*------------------------------------------------------------* @D61NDJK 62015761
*   PREPARE CCB AND REPOSITIONING CCW.                         @D61NDJK 62030861
*------------------------------------------------------------* @D61NDJK 62045961
*                                                              @D61NDJK 62061061
TERCH400 MVC   TERSVCCB,TERCCB    PRESERVE CCB                 @D61NDJK 62076161
*                                                              @D61NDJK 62091261
         LA    R8,TERCCWCH        SET UP CCB FOR RUN I/O:      @D61NDJK 62106361
         STCM  R8,7,CCBCCW31+1      START OF CHANNEL PROGRAM   @D66ADAP 62121461
*                                                              @D61NDJK 62136561
         USING CCWADR,R8          SET UP CCW FOR..             @D61NDJK 62151661
         XC    CCWTOT,CCWTOT        REPOSITIONING I/O:         @D61NDJK 62166761
         CLI   TERCCCWO,READB       IF FAILING CCW IS..        @D61NDJK 62181861
         BE    TERCH410               A READ BACKWARD,,        @D61NDJK 62196961
*                                     CCW, TAKE FORWARD..      @D61NDJK 62212061
         MVI   CCWCODE,TERBSBOP       SPACE BLOCK..            @D61NDJK 62227161
         B     TERCH420               OPCODE, ELSE..           @D61NDJK 62242261
*                                     TAKE BACKSPACE..         @D61NDJK 62257361
TERCH410 MVI   CCWCODE,TERFSBOP       BLOCK OPCODE             @D61NDJK 62272461
 SGTAP  'SGCOV ERPT610',NR=(25,5) OPCODE OF REP CCW IS FSB      TERCHKR 62294551
*                                                              @D61NDJK 62302661
TERCH420 MVI   CCWCHAIN,SLI         FLAG BYTE                  @D61NDJK 62317761
         MVI   CCWLNG+1,1           BYTE COUNT                 @D61NDJK 62332861
*                                                              @D61NDJK 62347961
*------------------------------------------------------------* @D61NDJK 62363061
*   ISSUE REPOSITIONING I/O.                                   @D61NDJK 62378161
*------------------------------------------------------------* @D61NDJK 62393261
*                                                              @D61NDJK 62408361
 SGTAP  'CALL  TERIO           ','ISSUE I/O REQUEST',          @D61NDJKX62423461
               I='1,2,3,B           ON RETURN ',               @D61NDJKX62438561
               O='F                 RF IS COMPLETION CODE'     @D61NDJK 62453661
*                                                              @D61NDJK 62468761
         TM    CCBSTA1,XFF-CHANEND-DEVEND UNUSUAL UNIT STATUS? @D61NDJK 62474761
         BNZ   TERCH450                   YES                  @D61NDJK 62480761
         TM    CCBSTA2,XFF-IL     UNUSUAL CHANNEL STATUS?      @D61NDJK 62486761
         BNZ   TERCH450           YES                          @D61NDJK 62492761
*                                                              @D61NDJK 62498961
         MVC   TERCCB(L'TERSVCCB),TERSVCCB  RESTORE SAVED CCB  @D61NDJK 62514061
         B     TERCH500                                        @D61NDJK 62529161
*                                                              @D61NDJK 62544261
TERCH450 MVC   TERCCB(L'TERSVCCB),TERSVCCB  RESTORE SAVED CCB  @D61NDJK 62551761
 SGTAP  'SGCOV ERPT610',NR=(25,6) REPOSITIONING I/O FAILED      TERCHKR 62566351
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 62574461
         B     TERCHEX              "RECOVERY NOT POSSIBLE"    @D61NDJK 62589561
*                                                              @D61NDJK 62604661
*------------------------------------------------------------* @D61NDJK 62619761
*   RESTART FAILING CCW.                                       @D61NDJK 62634861
*------------------------------------------------------------* @D61NDJK 62649961
*                                                              @D61NDJK 62665061
TERCH500 DS    0H                                              @D61NDJK 62680161
 SGTAP  'CALL  TERRTY          ','RETRY FAILING CCW',          @D61NDJKX62695261
               I='1,2,3,B           ON RETURN',                @D61NDJKX62710361
               O='F                 RF IS RETURN CODE'         @D61NDJK 62725461
*                                                              @D61NDJK 62740561
 SGTAP  'SGCOV ERPT610',NR=(25,7) FAILING CCW HAS BEEN RETRIED  TERCHKR 62762651
*                                                              @D61NDJK 62770761
*------------------------------------------------------------* @D61NDJK 62785861
*                                                              @D61NDJK 62800961
*   EXIT HANDLING.                                             @D61NDJK 62816061
*                                                              @D61NDJK 62831161
*------------------------------------------------------------* @D61NDJK 62846261
*                                                              @D61NDJK 62861361
TERCHEX  SGTAP 'RETURN         ','RETURN TO CALLER         ',  @D61NDJKX62876461
               OUTPUT=(RF)                                     @D61NDJK 62891561
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 62906661
         LTORG                                                 @D61NDJK 62921761
         EJECT                                                 @D61NDJK 62936861
*                                                              @D61NDJK 62951961
***************************************************************         62967061
*  FUNCTION                                                    @D61NDJK 62982161
*    RESUME USER'S CHANNEL PROGRAM AFTER THE FAILING CCW.      @D61NDJK 62997261
*                                                              @D61NDJK 63012361
*  INPUT                                                       @D61NDJK 63027461
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61NDJK 63042561
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 63057661
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61NDJK 63072761
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61NDJK 63080261
*                                                              @D61NDJK 63087861
*  OUTPUT                                                      @D61NDJK 63102961
*    - RF CONTAINS A RESUME COMPLETION CODE. POSSIBLE          @D61NDJK 63125051
*         COMPLETION CODES ARE:                                @D61NDJK 63133161
*           TERERSUC  -  USER CCW CHAIN COULD BE RESUMED       @D61NDJK 63148261
*                        SUCCESSFULLY OR RESUMING WAS NOT      @D61NDJK 63163361
*                        NECESSARY                             @D61NDJK 63178461
*           TERERUNS  -  USER CCW CHAIN COULDN'T BE RESUMED    @D61NDJK 63193561
*           TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED      @D61NDJK 63208661
*                        AFTER THE USER CCW CHAIN HAS BEEN     @D61NDJK 63223761
*                        RESUMED                               @D61NDJK 63238861
*                                                              @D61NDJK 63253961
***************************************************************         63269061
 AGO  .GRESUM                                                 *#SECURGL 63284161
.LRESUM  AIF ('&TEST'(1,14) NE 'CALL  TERRESUM').LRAR         *#SECURGL 63306251
 AIF   ('&I'(2,8)  NE '1,2,3,B '               ).DSINVC       *#SECURGL 63314361
 AIF   ('&O'(2,2)  EQ 'F '                     ).DSHEAD       *#SECURGL 63329461
 AGO  .DSINVC                                                 *#SECURGL 63344561
.GRESUM   ANOP                                                *#SECURGL 63359661
.**************************************************************         63374761
TERRESUM SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 63389861
         USING CCBADR,R1                                       @D61NDJK 63404961
         USING ERBLKADR,R2                                     @D61NDJK 63420061
         USING PUBADR,R3                                       @D61NDJK 63435161
 SGTAP  'SGCOV ERPT610',NR=(26,0) TERRESUM ENTERED             TERRESUM 63449651
*                                                              @D61NDJK 63465361
*------------------------------------------------------------* @D61NDJK 63480461
*   IF NO FAILING CCW IS AVAILABLE, USER CCW CHAIN CAN'T       @D61NDJK 63495561
*   BE RESUMED.                                                @D61NDJK 63510661
*------------------------------------------------------------* @D61NDJK 63525761
*                                                              @D61NDJK 63540861
         OC    TERCCCWV,TERCCCWV  RESUMING IS POSSIBLE?        @D61NDJK 63555961
         BNZ   TERRE100           YES                          @D61NDJK 63571061
*                                                              @D61NDJK 63586161
 SGTAP  'SGCOV ERPT610',NR=(26,1) RESUME W/O FAIL. CCW IMPOSS. TERRESUM 63608251
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 63616361
         B     TERREEX              "RESUME NOT POSSIBLE"      @D61NDJK 63631461
*                                                              @D61NDJK 63646561
*------------------------------------------------------------* @D61NDJK 63661661
*   IF THE FAILING CCW IS A PREFIX CCW, THE WHOLE USER         @D61NDJK 63767361
*   CHANNEL PROGRAM CAN BE RETRIED.                            @D61NDJK 63782461
*------------------------------------------------------------* @D61NDJK 63797561
*                                                              @D61NDJK 63812661
TERRE100 TM    TERFLG,TERCVPRF    FAILING CCW IS A PREFIX CCW? @D61NDJK 63827761
         BZ    TERRE200           NO                           @D61NDJK 63842861
*                                                              @D61NDJK 63857961
*                                                              @D61NDJK 63873061
 SGTAP  'CALL  TERRTY          ','RETRY FAILING CCW',          @D61NDJKX63888161
               I='1,2,3,B           ON RETURN',                @D61NDJKX63903261
               O='F                 RF IS RETURN CODE'         @D61NDJK 63918361
*                                                              @D61NDJK 63933461
 SGTAP  'SGCOV ERPT610',NR=(26,2) FAILING CCW IS A PREFIX CCW  TERRESUM 63953551
         B     TERREEX            EXIT WITH PASSED COMPL. CODE @D61NDJK 63963661
*                                                              @D61NDJK 63978761
*------------------------------------------------------------* @D61NDJK 63993861
*                                                              @D61NDJK 64018951
*   BUILD PREFIX CCWS FOR RESUMING THE USER CHANNEL PROGRAM.   @D61SDJK 64028941
*   PREFIX 0 CCW: SYSTEM MODE SET/OVERRIDE CCW.                @D61SDJK 64038931
*   PREFIX 1 CCW: USER OWN MODE SET/OVERRIDE CCW OR NO-OP CCW. @D61SDJK 64048921
*                                                              @D61NDJK 64069361
*------------------------------------------------------------* @D61NDJK 64084751
*                                                              @D61NDJK 64085041
*------------------------------------------------------------* @D61SDJK 64085331
*   FIND OUT WHETHER THE ORIGINAL I/O REQUEST HAS BEEN         @D61SDJK 64085621
*   PREFIXED BY THE I/O SUPERVISOR. IF SO, THE RESUME          @D61SDJK 64085911
*   REQUEST MUST BE PREFIXED BY A PREFIX 0 CCW.                @D61SDJK 64086201
*------------------------------------------------------------* @D61SDJK 64086491
*                                 ASSUME THAT PREFIX 0..       @D61SDJK 64086781
TERRE200 LA    R4,TERCCW01          CCW WILL NOT BE STARTED    @D61SDJK 64087071
         LA    R8,TERCCW00        SET UP..                     @D61SDJK 64087361
         USING CCWADR,R8            PREFIX 0 CCW               @D61SDJK 64087651
         XC    CCWTOT,CCWTOT                                   @D61SDJK 64087941
*                                 USER WANTED TO HAVE..        @D61SDJK 64088231
         TM    CCBBY3-CCBADR(RB),X'08' CCW CHAIN PREFIXED?     @D61SDJK 64088521
         BO    TERRE300           NO                           @D61SDJK 64088811
         ASYSCOM (R7)             ESTABLISH..                  @D61SDJK 64089101
         USING SYSCOM,R7            ADDRESSABILITY OF SYSCOM   @D61SDJK 64089391
         CLC   TERCHQID,IJBHSTID    SYSTEM TASK REQUEST?       @D66ODOW 64089681
         BL    TERRE300                YES                     @D61SDJK 64089971
         DROP  R7                                              @D61SDJK 64090261
*                                                              @D61SDJK 64090551
 SGTAP  'SGCOV ERPT610',NR=(26,3) USER CCW CHAIN WAS PREFIXED  TERRESUM 64090841
         MVI   CCWCODE,MDO        MODE SET/OVERRIDE OPCODE     @D61SDJK 64091421
         L     R5,TERAPUBX        GET PUBX POINTER             @D61SDJK 64091711
         USING PBXADR,R5          DECLARE PUBX BASE POINTER    @D61SDJK 64092001
         LA    R6,PBXABYT         GET SYSTEM MODE BYTE POINTER @D61SDJK 64092291
         DROP  R5                                              @D61SDJK 64092581
         STCM  R6,7,CCWBUF+1                                   @D61SDJK 64092871
         MVI   CCWCHAIN,SLI+CC      FLAG BYTE                  @D61SDJK 64093161
         MVI   CCWLNG+1,1           BYTE COUNT                 @D61SDJK 64093451
         LA    R4,TERCCW00        PREFIX 0 CCW MUST BE STARTED @D61SDJK 64093741
*                                                              @D61SDJK 64094031
*------------------------------------------------------------* @D61SDJK 64094321
*   IF THE USER CHANNEL PROGRAM HAS SPECFIFIED OWN 3480-TYPE   @D61SDJK 64094611
*   MODE SET OR TPA-TYPE MODE OVERRIDE CCWS, THE PREFIX 1      @D61SDJK 64094901
*   CCW MUST BE THE LAST USER MODE SET OR MODE OVERRIDE        @D61SDJK 64095191
*   CCW IN FRONT OF THE CCW TO BE RESUMED.                     @D61SDJK 64095481
*------------------------------------------------------------* @D61SDJK 64095771
*                                                              @D61NDJK 64096061
TERRE300 LA    R9,MDO             TAKE MODE SET/OVERRIDE OPCODE@D61SDJK 64096351
 SGTAP  'CALL  TERSCAN         ','FIND LAST TIME ITS USED',    @D61NDJKX64099561
               I='1,9               ON RETURN+4',              @D61NDJKX64114661
               O='5,6               R5,R6 POINT TO FOUND CCW', @D61SDJKX64138751
               E0='TERRE400         ERROR: NO SUCH OPCODE'     @D61SDJK 64147741
 SGTAP  'SGCOV ERPT610',NR=(26,4) MODE SET/OVERRIDE CCW FOUND  TERRESUM 64165721
*                                 PROVIDE USER MODE..          @D61NDJK 64175061
         LR    R8,R5                SET/OVERRIDE CCW POINTER   @D61SDJK 64197151
         LA    R5,1                 NUMBER OF BYTES TO MOVE,.. @D61NDJK 64205261
         SLR   R6,R6                OFFSET OF 1ST DATA BYTE,.. @D61NDJK 64220361
         LA    R7,TERMODE           AND POINTER TO AREA WHERE..@D61NDJK 64235461
*                                   THE DATA SHALL BE MOVED TO @D61NDJK 64250561
 SGTAP  'CALL  TERGETDT        ','GET USER MODE DATA BYTE',    @D61SDJKX64272651
               I='5,6,7,8           ON RETURN+4',              @D61NDJKX64280761
               O='NONE              DATA ARE MOVED TO AREA',   @D61NDJKX64295861
               E0='TERRE350         ERROR: DATA NOT ADDR.'     @D61SDJK 64317951
*                                                              @D61NDJK 64326061
 SGTAP  'SGCOV ERPT610',NR=(26,5) TAKE USER MODE DATA BYTE     TERRESUM 64355141
         B     TERRE450                                        @D61SDJK 64362131
*                                                              @D61NDJK 64371361
*------------------------------------------------------------* @D61SDJK 64396451
*   IF THE USER MODE SET OR MODE OVERRIDE DATA BYTE COULD      @D61SDJK 64406441
*   NOT BE OBTAINED, NO RESUME WILL BE DONE.                   @D61SDJK 64416431
*------------------------------------------------------------* @D61SDJK 64426421
*                                                              @D61SDJK 64436411
TERRE350 DS    0H                                              @D61SDJK 64446401
 SGTAP  'SGCOV ERPT610',NR=(26,6) USER MODE BYTE NOT OBTAINED  TERRESUM 64466381
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61SDJK 64476371
         B     TERREEX              "RESUME NOT POSSIBLE"      @D61SDJK 64486361
*                                                              @D61SDJK 64496351
*------------------------------------------------------------* @D61SDJK 64506341
*   IF THE USER CHANNEL PROGRAM CONTAINS NO MODE SET AND NO    @D61SDJK 64516331
*   MODE OVERRIDE CCW, THE PREFIX 1 CCW MUST BE A NO-OP CCW.   @D61SDJK 64526321
*------------------------------------------------------------* @D61SDJK 64536311
*                                                              @D61SDJK 64546301
TERRE400 LA    R8,TERCCW01        SET UP NO-OP CCW             @D61SDJK 64556291
         XC    CCWTOT,CCWTOT                                   @D61SDJK 64566281
         MVI   CCWCODE,NOOP         NO-OP OPCODE               @D61SDJK 64576271
 SGTAP  'SGCOV ERPT610',NR=(26,7) PREFIX 1 CCW IS A NO-OP CCW  TERRESUM 64596251
         B     TERRE480                                        @D61SDJK 64606241
*                                                              @D61SDJK 64616231
TERRE450 LA    R8,TERCCW01        SET UP PREFIX 1 CCW..        @D61SDJK 64626221
         XC    CCWTOT,CCWTOT        FOR RESUME I/O:            @D61SDJK 64636211
         MVI   CCWCODE,MDO          MODE SET/OVERRIDE OPCODE   @D61NDJK 64646201
         LA    R6,TERMODE           DATA ADDRESS               @D61NDJK 64673361
         STCM  R6,7,CCWBUF+1                                   @D61NDJK 64688461
TERRE480 MVI   CCWCHAIN,SLI+CC      FLAG BYTE                  @D61SDJK 64710551
         MVI   CCWLNG+1,1           BYTE COUNT                 @D61NDJK 64718661
*                                                              @D61NDJK 64733761
*------------------------------------------------------------* @D61NDJK 64748861
*                                                              @D61NDJK 64763961
*   BUILD TIC CCW THAT WILL TRANSFER BACK TO THE USER'S        @D61NDJK 64779061
*   CHANNEL PROGRAM.                                           @D61NDJK 64794161
*                                                              @D61NDJK 64809261
*------------------------------------------------------------* @D61NDJK 64824361
*                                                              @D61NDJK 64839461
*------------------------------------------------------------* @D61NDJK 64854561
*   DETERMINE IF THE USER CHANNEL PROGRAM HAS TO BE RESUMED.   @D61NDJK 64869661
*------------------------------------------------------------* @D61NDJK 64884761
*                                                              @D61NDJK 64899861
         L     R8,TERFCCWV        POINT TO FAILING CCW         @D61NDJK 64914961
*                                                              @D61NDJK 64930061
TERRE500 LR    R9,R8              SAVE CURRENT CCW             @D61SDJK 64952151
*                                                              @D61NDJK 64960261
 SGTAP  'CALL  TERBUMP         ','BUMP TO NEXT CCW ',          @D61NDJKX64975361
               I='8                 ON RETURN TO +12',         @D61NDJKX64990461
               O='8                 R8 POINTS TO NEXT CCW',    @D61NDJKX65005561
               E0='TERRE550         ERROR: NOT ADDRESSABLE',   @D61SDJKX65030651
               E4='TERRE560         ERROR: CHAIN ENDED',       @D61SDJKX65040641
               E8='TERRE600         ERROR: TWO TICS'           @D61SDJK 65050631
*                                 NEW CURRENT CCW IS..         @D61NDJK 65065961
         TM    CCWCHAIN-CCWADR(R9),DC         IN A DATA CHAIN? @D61NDJK 65081061
         BZ    TERRE600           NO                           @D61SDJK 65106151
 SGTAP  'SGCOV ERPT610',NR=(27,0) FAIL. CCW IS IN A DATA CHAIN TERRESUM 65116141
         B     TERRE500           BUMP TO NEXT DATA CHAINED CCW@D61SDJK 65126131
*                                                              @D61NDJK 65141461
TERRE550 DS    0H                                              @D61SDJK 65166551
 SGTAP  'SGCOV ERPT610',NR=(27,1) ADDRESS CONVERSION FAILED    TERRESUM 65176541
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61NDJK 65186761
         B     TERREEX              "RESUME NOT POSSIBLE"      @D61NDJK 65201861
*                                                              @D61NDJK 65216961
TERRE560 OI    TERFLGPS,TERPSUC   DO NOT PASS UNIT CHECK       @D61SDJK 65239051
 SGTAP  'SGCOV ERPT610',NR=(27,2) RESUME IS NOT NECESSARY      TERRESUM 65253031
         LA    RF,TERERSUC        EXIT WITH COMPLETION CODE..  @D61NDJK 65262261
         B     TERREEX              "RESUME NOT NECESSARY"     @D61NDJK 65277361
*                                                              @D61NDJK 65292461
*------------------------------------------------------------* @D61NDJK 65307561
*   BUILD TIC CCW.                                             @D61NDJK 65322661
*------------------------------------------------------------* @D61NDJK 65337761
*                                                              @D61NDJK 65352861
.*  R8 CONTAINS THE ADDRESS OF THE CCW THAT SHOULD GET CONTROL.@D61NDJK 65367961
.*                                                             @D61NDJK 65383061
TERRE600 DS    0H                                              @D61SDJK 65405151
 SGTAP  'CALL  TERCVTVR        ','CONVERT VIRTUAL TO REAL',    @D61NDJKX65413261
               I='8                 ON RETURN',                @D61NDJKX65428361
               O='F                 RF IS REAL OR 0 '          @D61NDJK 65443461
*                                                              @D61NDJK 65458561
         LA    R8,TERCCW02        SET UP TIC CCW TO TRANSFER.. @D61SDJK 65480651
         XC    CCWTOT,CCWTOT        BACK TO USER CCW CHAIN:    @D61NDJK 65488761
         MVI   CCWCODE,TIC          TIC OPCODE                 @D61NDJK 65503861
         STCM  RF,7,CCWBUF+1        DATA ADDRESS               @D61NDJK 65518961
         MVI   CCWCHAIN,SLI         FLAG BYTE                  @D61NDJK 65534061
         MVI   CCWLNG+1,1           BYTE COUNT                 @D61NDJK 65549161
 SGTAP  'SGCOV ERPT610',NR=(27,3) TIC CCW COULD BE BUILT       TERRESUM 65574251
*                                                              @D61NDJK 65594461
*------------------------------------------------------------* @D61NDJK 65609561
*                                                              @D61NDJK 65624661
*   ISSUE I/O REQUEST THAT WILL RESUME THE USER CHANNEL        @D61NDJK 65639761
*   PROGRAM.                                                   @D61NDJK 65654861
*                                                              @D61NDJK 65669961
*------------------------------------------------------------* @D61NDJK 65685061
*                                 SET UP CCB FOR RESUME I/O:   @D61SDJK 65710151
         STCM  R4,7,CCBCCW31+1              CCW ADDRESS        @D66ADAP 65720141
         MVI   CCBCCW31,X'00'               PATH MASK          @D66ADAP 65720142
         CLC   TERCHQID,=AL2(ARTID)   USER I/O REQUEST         @D66ODOW 65720143
         BH    TERRE650                     YES, ASCII INFO    @DA44407 65720144
         MVC   CCBCCW31(1),CCBCCW31-CCBADR(RB) USER PATH MASK  @D66ADAP 65720145
TERRE650 DS    0H                                              @DA44407 65720146
*                                                              @D61NDJK 65745461
 SGTAP  'CALL  TERIO           ','ISSUE I/O REQUEST',          @D61NDJKX65760561
               I='1,2,3,B           ON RETURN ',               @D61NDJKX65775661
               O='F                 RF IS COMPLETION CODE'     @D61NDJK 65790761
*                                                              @D61NDJK 65805861
 SGTAP  'SGCOV ERPT610',NR=(27,4) RESUME I/O WAS ISSUED        TERRESUM 65826941
         MVI   CCBCCW31,X'00'     RESET PATH MASK              @D66ADAP 65829931
*                                                              @D61NDJK 65836061
*------------------------------------------------------------* @D61NDJK 65851161
*                                                              @D61NDJK 65866261
*   EXIT HANDLING.                                             @D61NDJK 65881361
*                                                              @D61NDJK 65896461
*------------------------------------------------------------* @D61NDJK 65911561
*                                                              @D61NDJK 65926661
TERREEX  SGTAP 'RETURN         ','RETURN TO CALLER         ',  @D61NDJKX65941761
               OUTPUT=(RF)                                     @D61NDJK 65956861
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 65971961
         LTORG                                                 @D61NDJK 65987061
         EJECT                                                 @D61NDJK 66002161
*                                                              @D61NDJK 66017261
***************************************************************         66017291
*  FUNCTION                                                    @D61SDJK 66017321
*    PERFORM READ ALTERNATE RECOVERY IN FOLLOWING STEPS:       @D61SDJK 66017351
*    - ALLOCATE RAR WORK AREA IN SYSTEM GETVIS AREA            @D61SDJK 66017381
*    - ISSUE READ ALTERNATE I/O REQUEST                        @D61SDJK 66017411
*    - SIMULATE READ OPERATION                                 @D61SDJK 66017441
*    - RESUME USER'S CHANNEL PROGRAM, IF APPLICABLE            @D61SDJK 66017471
*    - FREE ALLOCATED GETVIS AREA                              @D61SDJK 66017501
*                                                              @D61SDJK 66017531
*  INPUT                                                       @D61SDJK 66017561
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61SDJK 66017591
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61SDJK 66017621
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61SDJK 66017651
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61SDJK 66017681
*                                                              @D61SDJK 66017711
*  OUTPUT                                                      @D61SDJK 66017741
*    - RF CONTAINS A RECOVERY COMPLETION CODE. POSSIBLE        @D61SDJK 66017771
*         COMPLETION CODES ARE:                                @D61SDJK 66017801
*           TERERSUC  -  RECOVERY WAS DONE SUCCESSFULLY        @D61SDJK 66017831
*           TERERUNS  -  RECOVERY FAILED                       @D61SDJK 66017861
*           TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED      @D61SDJK 66017891
*                        DURING RECOVERY I/O.                  @D61SDJK 66017921
*                                                              @D61SDJK 66017951
***************************************************************         66017981
 AGO  .GRAR                                                   *#SECURGL 66018011
.LRAR    AIF ('&TEST'(1,12) NE 'CALL  TERRAR'  ).LPATH        *#SECURGL 66018041
 AIF   ('&I'(2,8)  NE '1,2,3,B '               ).DSINVC       *#SECURGL 66018071
 AIF   ('&O'(2,2)  EQ 'F '                     ).DSHEAD       *#SECURGL 66018101
 AGO  .DSINVC                                                 *#SECURGL 66018131
.GRAR     ANOP                                                *#SECURGL 66018161
.**************************************************************         66018191
TERRAR   SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61SDJK 66018221
         USING CCBADR,R1                                       @D61SDJK 66018251
         USING ERBLKADR,R2                                     @D61SDJK 66018281
         USING PUBADR,R3                                       @D61SDJK 66018311
 SGTAP  'SGCOV ERPT610',NR=(28,0) TERRAR ENTERED                 TERRAR 66018341
*                                                              @D61SDJK 66018401
*------------------------------------------------------------* @D61SDJK 66018431
*   IF NO FAILING CCW IS AVAILABLE OR THE FAILING CCW IS       @D61SDJK 66018461
*   NEITHER A READ BACKWARD NOR A READ PREVIOUS CCW, RECOVERY  @D61SDJK 66018491
*   CAN'T BE DONE.                                             @D61SDJK 66018521
*------------------------------------------------------------* @D61SDJK 66018551
*                                                              @D61SDJK 66018581
         OI    TERROFLG,TERRORAR  INDICATE READ ALT. RECOVERY  @D61SDJK 66018611
         OC    TERCCCWV,TERCCCWV  RECOVERY IS POSSIBLE?        @D61SDJK 66018641
         BZ    TERRA050           NO                           @D61SDJK 66018671
         CLI   TERCCCWO,RDP       FAILING CCW..                @D61SDJK 66018701
         BE    TERRA100             IS A READ PREVIOUS..       @D61SDJK 66018731
         CLI   TERCCCWO,READB       OR A READ BACKWARD CCW?    @D61SDJK 66018761
         BE    TERRA100           YES                          @D61SDJK 66018791
*                                                              @D61SDJK 66018821
TERRA050 LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61SDJK 66018851
 SGTAP  'SGCOV ERPT610',NR=(28,1) FAILING CCW INHIBITS RAR       TERRAR 66018911
         B     TERRAEX              "RAR NOT POSSIBLE"         @D61SDJK 66018941
*                                                              @D61SDJK 66018971
*------------------------------------------------------------* @D61SDJK 66019001
*                                                              @D61SDJK 66019031
*   ALLOCATE RAR WORK AREA IN SYSTEM GETVIS AREA.              @D61SDJK 66019061
*                                                              @D61SDJK 66019091
*------------------------------------------------------------* @D61SDJK 66019121
*                                                              @D61SDJK 66019151
*------------------------------------------------------------* @D61SDJK 66019181
*   PROVIDE GETVIS INPUT PARAMETERS.                           @D61SDJK 66019211
*------------------------------------------------------------* @D61SDJK 66019241
*                                                              @D61SDJK 66019271
.*  THE LENGTH OF THE RAR WORK AREA IS NOT INDICATED IN        @D61SDJK 66019301
.*  TPA SENSE DATA.                                            @D61SDJK 66019331
.*                                                             @D61SDJK 66019361
TERRA100 L     R0,=A(TERROMAX)    TAKE MAXIMAL LENGTH          @D61SDJK 66019391
         ST    R0,TERROWAL                                     @D61SDJK 66019451
*                                                              @D61SDJK 66019481
*------------------------------------------------------------* @D61SDJK 66019511
*   ISSUE GETVIS REQUEST AND RESTORE WORK ENVIRONMENT.         @D61SDJK 66019541
*------------------------------------------------------------* @D61SDJK 66019571
*                                                              @D61SDJK 66019601
         MVC   TERROSID(4),TERRAPFX  SET UP..                  @D61SDJK 66019631
         STH   R3,TERROSID+4           GETVIS SUBPOOL ID       @D61SDJK 66019661
*                                                              @D61SDJK 66019691
         LR    R7,R1              SAVE CCB POINTER             @D61SDJK 66019721
         LR    R5,RA              SAVE WORK AREA POINTER       @D61SDJK 66019751
         DROP  RA                 RELEASE OLD WORK AREA POINTER@D61SDJK 66019781
         USING TERGLOB,R5         TAKE NEW WORK AREA POINTER   @D61SDJK 66019811
         SLR   R0,R0              ESTABLISH..                  @D61SDJK 66019841
         USING SYSS00,R0            LOW CORE ADDRESSABILITY    @D61SDJK 66019871
         L     RA,TCBPTR          PROVIDE SGETVIS SAVE AREA    @D61SDJK 66019901
         DROP  R0                                              @D61SDJK 66019931
*                                                              @D61SDJK 66019961
         SGETVIS LENGTH=TERROWAL,SPID=TERROSID,PFIX=YES,       @D61SDJKX66019991
               ADDRESS=TERROWAA,PAGE=YES                       @D61SDJK 66020021
*                                                              @D61SDJK 66020051
         LR    RA,R5              RESTORE WORK AREA POINTER    @D61SDJK 66020081
         DROP  R5                 RELEASE OLD WORK AREA POINTER@D61SDJK 66020111
         USING TERGLOB,RA         TAKE NEW WORK AREA POINTER   @D61SDJK 66020141
         LR    R1,R7              RESTORE CCB POINTER          @D61SDJK 66020171
 SGTAP  'SGCOV ERPT610',NR=(28,2) GETVIS REQUEST ISSUED          TERRAR 66020231
*                                                              @D61SDJK 66020261
         LTR   RF,RF              RAR WORK AREA IS ALLOCATED?  @D61SDJK 66020291
         BZ    TERRA200           YES                          @D61SDJK 66020321
*                                                              @D61SDJK 66020351
 SGTAP  'SGCOV ERPT610',NR=(28,3) GETVIS REQUEST FAILED          TERRAR 66020411
         LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61SDJK 66020441
         B     TERRAEX              "RAR FAILED"               @D61SDJK 66020471
*                                                              @D61SDJK 66020501
*------------------------------------------------------------* @D61SDJK 66020531
*                                                              @D61SDJK 66020561
*   SET UP RAR CCW AND ISSUE READ ALTERNATE I/O REQUEST.       @D61SDJK 66020591
*                                                              @D61SDJK 66020621
*------------------------------------------------------------* @D61SDJK 66020651
*                                                              @D61SDJK 66020681
TERRA200 LA    R4,TERCCWRA        POINT TO RAR CCW             @D61SDJK 66020711
 SGTAP  'CALL  TERRDOA         ','ISSUE RAR I/O REQUEST.',     @D61SDJKX66020741
               I='1,2,3,4,B         ON RETURN+4',              @D61SDJKX66020771
               O='7                 RAR I/O IS DONE',          @D61SDJKX66020801
               E0='TERRA930       ERROR: RAR I/O IS NOT DONE'  @D61SDJK 66020831
*                                                              @D61SDJK 66020861
*------------------------------------------------------------* @D61SDJK 66020891
*                                                              @D61SDJK 66020921
*   CHECK OUTCOME OF READ ALTERNATE I/O.                       @D61SDJK 66020951
*                                                              @D61SDJK 66020981
*------------------------------------------------------------* @D61SDJK 66021011
*                                                              @D61SDJK 66021041
*------------------------------------------------------------* @D61SDJK 66021071
*   IF READ ALTERNATE I/O FAILED, READ ALTERNATE RECOVERY      @D61SDJK 66021101
*   MUST BE DECLARED AS FAILED.                                @D61SDJK 66021131
*   IN CASE OF A UNIT EXCEPTION, THE ORIGINAL ERROR CONDITION  @D61SDJK 66021138
*   OCCURRED WHEN READING A TAPE MARK IN BACKWARD DIRECTION    @D61SDJK 66021145
*   AND UNIT EXCEPTION MUST BE POSTED IN THE USER CCB.         @D61SDJK 66021152
*------------------------------------------------------------* @D61SDJK 66021161
*                                                              @D61SDJK 66021191
         TM    CCBSTA2,XFF-IL     UNUSUAL CHANNEL STATUS?      @D61SDJK 66021311
         BNZ   TERRA500           YES                          @D61SDJK 66021321
         TM    CCBSTA1,XFF-CHANEND-DEVEND UNUSUAL UNIT STATUS? @D61SDJK 66021331
         BZ    TERRA550           NO                           @D61SDJK 66021341
*                                                              @D61SDJK 66021343
         TM    CCBSTA1,UNITEXCP   TAPE MARK IS INDICATED?      @D61SDJK 66021345
         BZ    TERRA500           NO                           @D61SDJK 66021347
 SGTAP  'SGCOV ERPT610',NR=(28,4) UNIT EXCEPTION ON RAR I/O      TERRAR 66021349
         CLI   TERCCCWO,READB     FAILING CCW IS READ BACKWARD?@D61SDJK 66021351
         BNE   TERRA500           NO                           @D61SDJK 66021353
         MVC   TERCCB(L'TERSVCCB),TERSVCCB   RESTORE SAVED CCB @D61SDJK 66021355
         OI    CCBSTA1,UNITEXCP   USER CCB MUST BE NOTIFIED..  @D61SDJK 66021357
         NI    CCBSTA1,XFF-UNITCK   ABOUT THE READ TAPE MARK   @D61SDJK 66021359
         B     TERRA950                                        @D61SDJK 66021363
*                                                              @D61SDJK 66021371
TERRA500 MVC   TERCCB(L'TERSVCCB),TERSVCCB   RESTORE SAVED CCB @D61SDJK 66021401
         OI    TERROFLG,TERRONOR  DO NOT RESUME USER CCW CHAIN @D61SDJK 66021431
 SGTAP  'SGCOV ERPT610',NR=(28,5) RAR I/O FAILED FOR ANY REASON  TERRAR 66021501
         B     TERRA900                                        @D61SDJK 66021521
*                                                              @D61SDJK 66021551
TERRA550 SLR   R5,R5              PRESERVE RESIDUAL..          @D61SDJK 66021581
         ICM   R5,3,CCBCNT          COUNT FROM RAR I/O         @D61SDJK 66021611
         MVC   TERCCB(L'TERSVCCB),TERSVCCB   RESTORE SAVED CCB @D61SDJK 66021641
*                                                              @D61SDJK 66021671
*------------------------------------------------------------* @D61SDJK 66021701
*                                                              @D61SDJK 66021731
*   SIMULATE THE READ OPERATION.                               @D61SDJK 66021761
*                                                              @D61SDJK 66021791
*   SIMULATE A TAPE DEVICE. THE RECORD IN THE RAR WORK AREA,   @D61SDJK 66021821
*   WHICH WAS PREVIOUSLY READ FROM THE REAL DEVICE, REPRESENTS @D61SDJK 66021851
*   A RECORD ON THE SIMULATED TAPE.                            @D61SDJK 66021881
*                                                              @D61SDJK 66021911
*------------------------------------------------------------* @D61SDJK 66021941
*                                                              @D61SDJK 66021971
*------------------------------------------------------------* @D61SDJK 66022001
*   PREPARE PARAMETERS FOR READ SIMULATION.                    @D61SDJK 66022031
*------------------------------------------------------------* @D61SDJK 66022061
*                                                              @D61SDJK 66022091
.*  R5: CONTAINS THE POSITION OF THE SIMULATED TAPE HEAD       @D61SDJK 66022121
.*  R7: CONTAINS THE LENGTH OF THE RECORD READ FROM TAPE       @D61SDJK 66022151
.*  R8: CONTAINS VIRTUAL ADDRESS OF CURRENT CCW IN DATA CHAIN  @D61SDJK 66022181
.*  R9: POINTS TO THE BEGIN OF THE RECORD IN THE RAR WORK AREA @D61SDJK 66022211
.*                                                             @D61SDJK 66022241
*                                 TAKE LENGTH OF RECORD..      @D61SDJK 66022271
         SLR   R7,R5                THAT WAS READ BY RAR I/O   @D61SDJK 66022301
*                                                              @D61SDJK 66022331
         L     R8,TERCCCWV        POINT TO VIRTUAL ADDRESS OF..@D61SDJK 66022361
         USING CCWADR,R8            CURRENT CCW IN DATA CHAIN  @D61SDJK 66022391
*                                 FAILING CCW IS..             @D61SDJK 66022421
         CLI   TERCCCWO,READB       A READ BACKWARD CCW?       @D61SDJK 66022451
         BE    TERRA600           YES                          @D61SDJK 66022481
*                                                              @D61SDJK 66022511
         L     R9,TERROWAA        PREPARE START ADDRESS..      @D61SDJK 66022541
         AL    R9,TERROWAL          OF THE RECORD IN..         @D61SDJK 66022571
         SLR   R9,R7                THE RAR WORK AREA          @D61SDJK 66022601
*                                 PREPARE POSITION OF..        @D61SDJK 66022631
         SLR   R5,R5                SIMULATED TAPE HEAD        @D61SDJK 66022661
         B     TERRA650                                        @D61SDJK 66022691
*                                 PREPARE RECORD START..       @D61SDJK 66022721
TERRA600 L     R9,TERROWAA          ADDRESS IN RAR WORK AREA   @D61SDJK 66022751
*                                                              @D61SDJK 66022781
         LR    R5,R7              PREPARE POSITION OF..        @D61SDJK 66022811
         BCTR  R5,0                 SIMULATED TAPE HEAD        @D61SDJK 66022841
*                                                              @D61SDJK 66022871
TERRA650 DS    0H                                              @D61SDJK 66022901
 SGTAP  'CALL  TERSIMRD        ','PERFORM READ SIMULATION',    @D61SDJKX66022931
               I='1,5,7,8,9         ON RETURN ',               @D61SDJKX66022961
               O='NONE              SIMULATION IS DONE'        @D61SDJK 66022991
*                                                              @D61SDJK 66023021
*------------------------------------------------------------* @D61SDJK 66023051
*                                                              @D61SDJK 66023081
*   RESUME USER'S CHANNEL PROGRAM, IF APPLICABLE.              @D61SDJK 66023111
*                                                              @D61SDJK 66023141
*------------------------------------------------------------* @D61SDJK 66023171
*                                                              @D61SDJK 66023201
*------------------------------------------------------------* @D61SDJK 66023231
*   IF AN ERROR OCCURRED DURING READ SIMULATION, THE           @D61SDJK 66023261
*   USER'S CHANNEL PROGRAM WON'T BE RESUMED.                   @D61SDJK 66023291
*------------------------------------------------------------* @D61SDJK 66023321
*                                 USER CCW CHAIN SHOULD BE..   @D61SDJK 66023351
TERRA900 TM    TERROFLG,TERRONOR    RESUMED, IF POSSIBLE?      @D61SDJK 66023381
         BO    TERRA930             NO                         @D61SDJK 66023411
*                                 ERROR OCCURRED DURING..      @D61SDJK 66023441
         TM    CCBSTA2,PGMC+PCK+IL      READ SIMULATION?       @D61SDJK 66023471
         BNZ   TERRA910           YES                          @D61SDJK 66023501
*                                                              @D61SDJK 66023531
 SGTAP  'CALL  TERRESUM        ','RESUME USER CCW CHAIN',      @D61SDJKX66023561
               I='1,2,3,B           ON RETURN ',               @D61SDJKX66023591
               O='F                 RF IS COMPLETION CODE'     @D61SDJK 66023621
*                                                              @D61SDJK 66023651
         B     TERRA950           EXIT WITH PASSED COMPL. CODE @D61SDJK 66023681
*                                                              @D61SDJK 66023711
TERRA910 TM    CCBSTA2,IL         INCORR. LENGTH IS SET IN CSW?@D61SDJK 66023741
         BO    TERRA920           YES                          @D61SDJK 66023771
*                                                              @D61SDJK 66023801
         LA    RF,TERERAEC        EXIT WITH COMPLETION CODE..  @D61SDJK 66023831
*                                   "ANOTHER ERROR OCCURRED"   @D61SDJK 66023861
 SGTAP  'SGCOV ERPT610',NR=(28,6) EXIT WITH COMPL. CODE TERERAEC TERRAR 66023931
         B     TERRA950           EXIT WITH PASSED COMPL. CODE @D61SDJK 66023951
*                                                              @D61SDJK 66023981
TERRA920 LA    RF,TERERSUC        EXIT WITH COMPLETION CODE..  @D61SDJK 66024011
*                                   "RAR SUCCESSFUL"           @D61SDJK 66024041
 SGTAP  'SGCOV ERPT610',NR=(28,7) EXIT WITH COMPL. CODE TERERSUC TERRAR 66024111
         B     TERRA950           EXIT WITH PASSED COMPL. CODE @D61SDJK 66024131
*                                                              @D61SDJK 66024161
TERRA930 LA    RF,TERERUNS        EXIT WITH COMPLETION CODE..  @D61SDJK 66024191
*                                   "RAR UNSUCCESSFUL"         @D61SDJK 66024221
 SGTAP  'SGCOV ERPT610',NR=(29,0) EXIT WITH COMPL. CODE TERERUNS TERRAR 66024291
*                                                              @D61SDJK 66024311
*------------------------------------------------------------* @D61SDJK 66024341
*                                                              @D61SDJK 66024371
*   FREE ALLOCATED GETVIS AREA.                                @D61SDJK 66024401
*                                                              @D61SDJK 66024431
*------------------------------------------------------------* @D61SDJK 66024461
*                                                              @D61SDJK 66024491
*------------------------------------------------------------* @D61SDJK 66024521
*   ISSUE FREEVIS REQUEST AND RESTORE WORK ENVIRONMENT.        @D61SDJK 66024551
*------------------------------------------------------------* @D61SDJK 66024581
*                                                              @D61SDJK 66024611
TERRA950 LR    R5,RA              SAVE WORK AREA POINTER       @D61SDJK 66024641
         DROP  RA                 RELEASE OLD WORK AREA POINTER@D61SDJK 66024671
         USING TERGLOB,R5         TAKE NEW WORK AREA POINTER   @D61SDJK 66024701
         LR    R6,RF              SAVE COMPLETION CODE         @D61SDJK 66024731
         SLR   R0,R0              ESTABLISH..                  @D61SDJK 66024761
         USING SYSS00,R0            LOW CORE ADDRESSABILITY    @D61SDJK 66024791
         L     RA,TCBPTR          PROVIDE SFREEVIS SAVE AREA   @D61SDJK 66024821
         DROP  R0                                              @D61SDJK 66024851
*                                                              @D61SDJK 66024881
         SFREEVIS SPID=TERROSID                                @D61SDJK 66024911
*                                                              @D61SDJK 66024941
         LR    RA,R5              RESTORE WORK AREA POINTER    @D61SDJK 66024971
         DROP  R5                 RELEASE OLD WORK AREA POINTER@D61SDJK 66025001
         USING TERGLOB,RA         TAKE NEW WORK AREA POINTER   @D61SDJK 66025031
         LR    RF,R6              RESTORE COMPLETION CODE      @D61SDJK 66025061
 SGTAP  'SGCOV ERPT610',NR=(29,1) FREEVIS REQUEST ISSUED         TERRAR 66025101
*                                                              @D61SDJK 66025151
*------------------------------------------------------------* @D61SDJK 66025181
*                                                              @D61SDJK 66025211
*   EXIT HANDLING.                                             @D61SDJK 66025241
*                                                              @D61SDJK 66025271
*------------------------------------------------------------* @D61SDJK 66025301
*                                                              @D61SDJK 66025331
TERRAEX  SGTAP 'RETURN         ','RETURN TO CALLER         ',  @D61SDJKX66025361
               OUTPUT=(RF)                                     @D61SDJK 66025391
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61SDJK 66025421
*                                                              @D61SDJK 66025451
*------------------------------------------------------------* @D61SDJK 66025481
*                                                              @D61SDJK 66025511
*   LOCAL VARIABLES USED IN TERRAR                             @D61SDJK 66025541
*                                                              @D61SDJK 66025571
*------------------------------------------------------------* @D61SDJK 66025601
*                                                              @D61SDJK 66025631
TERRAPFX DC   C'IRAR'             FIRST 4 CHARACTERS OF READ   @D61SDJK 66025661
*                                 ALTERNATE RECOVERY SUBPOOL ID@D61SDJK 66025691
         LTORG                                                 @D61SDJK 66025721
         EJECT                                                 @D61SDJK 66025751
*                                                              @D61SDJK 66025781
***************************************************************         66025811
*  FUNCTION                                                    @D61SDJK 66025841
*    DETERMINE THE PATH MASK OR THE CHANNEL PATH ID ON WHICH   @D61SDJK 66025871
*    THE ERROR CONDITION HAD OCCURRED.                         @D61SDJK 66025901
*    A) IF A PATH MASK IS GIVEN AS INPUT, THE ASSOCIATED       @D61SDJK 66025931
*       CHANNEL PATH ID MUST BE FOUND.                         @D61SDJK 66025961
*    B) IF A CHANNEL PATH ID IS PROVIDED, THE PATH MASK        @D61SDJK 66025991
*       DESCRIBING THIS PATH ID HAS TO BE BUILT.               @D61SDJK 66026021
*    C) IF NEITHER A PATH MASK NOR A CHANNEL PATH ID IS        @D61SDJK 66026051
*       PROVIDED, THE LAST PATH USED MASK FROM THE CURRENT     @D61SDJK 66026081
*       SCHIB IS USED AND THE ASSOCIATED CHANNEL PATH ID IS    @D61SDJK 66026111
*       BUILT.                                                 @D61SDJK 66026141
*                                                              @D61SDJK 66026171
*  INPUT                                                       @D61SDJK 66026201
*    - R5 CONTAINS THE ADDRESS OF A PUBX DEVICE ENTRY          @D61SDJK 66026231
*    - R7 CONTAINS A PATH MASK OR ZERO.                        @D61SDJK 66026261
*    - R9 CONTAINS A CHANNEL PATH ID OR ZERO.                  @D61SDJK 66026291
*                                                              @D61SDJK 66026321
*  OUTPUT ON RETURN TO RETURN+0                                @D61SDJK 66026351
*    - NONE. CHANNEL PATH ID OR PATH MASK COULD NOT BE BUILT.  @D61SDJK 66026381
*                                                              @D61SDJK 66026411
*  OUTPUT ON RETURN TO RETURN+4                                @D61SDJK 66026441
*    - R7 CONTAINS A PATH MASK DESCRIBING A CHANNEL PATH ID.   @D61SDJK 66026471
*    - R9 CONTAINS A CHANNEL PATH ID.                          @D61SDJK 66026501
*                                                              @D61SDJK 66026531
***************************************************************         66026561
 AGO  .GPATH                                                  *#SECURGL 66026591
.LPATH   AIF ('&TEST'(1,14) NE 'CALL  TERPATH ').LIO          *#SECURGL 66026621
 AIF   ('&I'(2,6)  NE '5,7,9 '                 ).DSINVC       *#SECURGL 66026651
 AIF   ('&O'(2,4)  NE '7,9 '                   ).DSINVC       *#SECURGL 66026681
 AIF   (T'&E0      NE 'O'                      ).DSHEAD       *#SECURGL 66026711
 AGO  .DSINVC                                                 *#SECURGL 66026741
.GPATH    ANOP                                                *#SECURGL 66026771
.**************************************************************         66026801
TERPATH  SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61SDJK 66026831
         USING PBXADR,R5          MAKE PUBX ADDRESSABLE        @D61SDJK 66026861
 SGTAP  'SGCOV ERPT610',NR=(30,0) TERPATH ENTERED               TERPATH 66026891
*                                                              @D61SDJK 66026951
*------------------------------------------------------------* @D61SDJK 66026981
*   GET CURRENT SUBCHANNEL INFORMATION.                        @D61SDJK 66027011
*------------------------------------------------------------* @D61SDJK 66027041
*                                                              @D61SDJK 66027071
         SLR   R0,R0              ESTABLISH..                  @D61SDJK 66027101
         USING SYSS00,R0            LOW CORE ADDRESSABILITY    @D61SDJK 66027131
         L     R4,SCHIB$          TAKE POINTER TO SCHIB        @D61SDJK 66027161
         DROP  R0                                              @D61SDJK 66027191
         ICM   R1,12,TERPAH1      TAKE SUBCHANNEL NUMBER AND.. @D61SDJK 66027221
         ICM   R1,3,PBXSCH          X0001 INTO REGISTER        @D61SDJK 66027251
         STSCH 0(R4)              STORE SCHIB INTO SCHIB       @D61SDJK 66027281
*                                                              @D61SDJK 66027311
*------------------------------------------------------------* @D61SDJK 66027341
*   FIND OUT WHAT IS PROVIDED BY THE CALLING ROUTINE.          @D61SDJK 66027371
*------------------------------------------------------------* @D61SDJK 66027401
*                                                              @D61SDJK 66027431
         LTR   R7,R7              PATH MASK IS PROVIDED?       @D61SDJK 66027461
         BNZ   TERPA100           YES                          @D61SDJK 66027491
         LTR   R9,R9              CHANNEL PATH ID IS PROVIDED? @D61SDJK 66027521
         BNZ   TERPA200           YES                          @D61SDJK 66027551
*                                                              @D61SDJK 66027581
*------------------------------------------------------------* @D61SDJK 66027611
*   TAKE LAST PATH USED MASK FROM CURRENT SCHIB.               @D61SDJK 66027641
*------------------------------------------------------------* @D61SDJK 66027671
*                                                              @D61SDJK 66027701
 SGTAP  'SGCOV ERPT610',NR=(30,1) LPUM FROM SCHIB IS TAKEN      TERPATH 66027761
         SLR   R7,R7              GET LAST PATH USED MASK..    @D61SDJK 66027791
         IC    R7,SCHLPUM-SCHIB(,R4)  INTO WORK REGISTER       @D61SDJK 66027821
*                                                              @D61SDJK 66027851
*------------------------------------------------------------* @D61SDJK 66027881
*   CONVERT PATH MASK INTO A CHANNEL PATH ID.                  @D61SDJK 66027911
*------------------------------------------------------------* @D61SDJK 66027941
*                                                              @D61SDJK 66027971
TERPA100 LTR   R9,R9              CHPID IS ALSO PROVIDED?      @D61SDJK 66028001
         BNZ   TERPAEX0           YES, SELECT ERROR EXIT       @D61SDJK 66028031
*                                                              @D61SDJK 66028061
 SGTAP  'SGCOV ERPT610',NR=(30,2) CHPID MUST BE FOUND           TERPATH 66028121
         LA    R4,SCHCPID0-SCHIB(,R4)  POINT TO LIST OF CHPIDS @D61SDJK 66028151
         LR    R6,R7              PRESERVE PATH MASK           @D61SDJK 66028181
         SLA   R6,23              ADJUST PATH MASK             @D61SDJK 66028211
TERPA150 SLL   R6,1               BUMP TO NEXT BIT IN PATHMASK @D61SDJK 66028241
         LTR   R6,R6              CHPID IS FOUND?              @D61SDJK 66028271
         BM    TERPA180           YES                          @D61SDJK 66028301
         BZ    TERPAEX0           PATH MASK IS INVALID         @D61SDJK 66028331
*                                                              @D61SDJK 66028361
         LA    R4,1(,R4)          BUMP TO NEXT CHPID           @D61SDJK 66028391
         B     TERPA150           BUMP TO NEXT BIT IN PATHMASK @D61SDJK 66028421
*                                                              @D61SDJK 66028451
TERPA180 IC    R9,0(R4)           GET CHPID                    @D61SDJK 66028481
         B     TERPAEX4                                        @D61SDJK 66028511
*                                                              @D61SDJK 66028541
*------------------------------------------------------------* @D61SDJK 66028571
*   CONVERT CHANNEL PATH ID INTO A PATH MASK.                  @D61SDJK 66028601
*------------------------------------------------------------* @D61SDJK 66028631
*                                                              @D61SDJK 66028661
TERPA200 LA    R8,SCHCPID0-SCHIB(,R4)   POINT TO CHPIDS        @D61SDJK 66028691
 SGTAP  'SGCOV ERPT610',NR=(30,3) PATH MASK MUST BE FOUND       TERPATH 66028751
         LA    R7,X'80'           START WITH FIRST PATH        @D61SDJK 66028781
TERPA250 CLM   R9,1,0(R8)         IT IS THE ASSOCIATED CHPID?  @D61SDJK 66028811
         BNE   TERPA280           NO                           @D61SDJK 66028841
         EX    R7,TERPATM         PATH IS CONTAINED IN PIM?    @D61SDJK 66028871
         BO    TERPAEX4           YES                          @D61SDJK 66028901
*                                                              @D61SDJK 66028931
TERPA280 LA    R8,1(,R8)          BUMP TO NEXT CHPID           @D61SDJK 66028961
         SRL   R7,1               BUMP TO NEXT BIT IN PATHMASK @D61SDJK 66028991
         LTR   R7,R7              THERE IS NO MORE PATH LEFT?  @D61SDJK 66029021
         BZ    TERPAEX0           YES, SELECT ERROR EXIT       @D61SDJK 66029051
         B     TERPA250           PROCESS NEXT CHPID           @D61SDJK 66029081
*                                                              @D61SDJK 66029111
TERPATM  TM    SCHPIM-SCHIB(R4),*-*                            @D61SDJK 66029141
*                                                              @D61SDJK 66029171
*------------------------------------------------------------* @D61SDJK 66029201
*                                                              @D61SDJK 66029231
*   EXIT HANDLING.                                             @D61SDJK 66029261
*                                                              @D61SDJK 66029291
*------------------------------------------------------------* @D61SDJK 66029321
*                                                              @D61SDJK 66029351
*------------------------------------------------------------* @D61SDJK 66029381
*   ERROR EXIT.                                                @D61SDJK 66029411
*------------------------------------------------------------* @D61SDJK 66029441
*                                                              @D61SDJK 66029471
TERPAEX0 DS    0H                                              @D61SDJK 66029501
 SGTAP  'SGCOV ERPT610',NR=(30,4) ERROR EXIT IS SELECTED        TERPATH 66029561
         SGTAP 'RETURN         ','RETURN W/O VALID DATA.'      @D61SDJK 66029591
*                                                              @D61SDJK 66029621
*------------------------------------------------------------* @D61SDJK 66029651
*   NORMAL EXIT.                                               @D61SDJK 66029681
*------------------------------------------------------------* @D61SDJK 66029711
*                                                              @D61SDJK 66029741
TERPAEX4 SGTAP 'RETURN4        ','RETURN WITH VALID DATA',     @D61SDJKX66029771
               OUTPUT=(R7,R9)                                  @D61SDJK 66029801
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61SDJK 66029831
*                                                              @D61SDJK 66029861
*------------------------------------------------------------* @D61SDJK 66029891
*                                                              @D61SDJK 66029921
*   LOCAL VARIABLES USED IN TERPATH                            @D61SDJK 66029951
*                                                              @D61SDJK 66029981
*------------------------------------------------------------* @D61SDJK 66030011
*                                                              @D61SDJK 66030041
TERPAH1  DC    H'1'               CONSTANT                     @D61SDJK 66030071
*                                                              @D61SDJK 66030101
         LTORG                                                 @D61SDJK 66030131
         EJECT                                                 @D61SDJK 66030161
*                                                              @D61SDJK 66030191
***************************************************************         66032361
*  FUNCTION                                                    @D61NDJK 66047461
*     PERFORM HEADQUEUE I/O USING A GIVEN CCB.                 @D61NDJK 66062561
*                                                              @D61NDJK 66077661
*  INPUT                                                       @D61NDJK 66092761
*    - R1 CONTAINS THE ADDRESS OF THE GIVEN CCB                @D61NDJK 66107861
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 66122961
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61NDJK 66138061
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61NDJK 66145561
*                                                              @D61NDJK 66153161
*  OUTPUT                                                      @D61NDJK 66168261
*    - RF CONTAINS AN I/O COMPLETION CODE. POSSIBLE            @D61NDJK 66183361
*         COMPLETION CODES ARE:                                @D61NDJK 66198461
*           TERERSUC  -  I/O COMPLETED SUCCESSFULLY            @D61NDJK 66213561
*           TERERAEC  -  ANOTHER ERROR CONDITION OCCURRED      @D61NDJK 66228661
*                        DURING I/O                            @D61NDJK 66243761
*                                                              @D61NDJK 66258861
***************************************************************         66273961
 AGO  .GIO                                                    *#SECURGL 66289061
.LIO     AIF ('&TEST'(1,14) NE 'CALL  TERIO   ').LGETDT       *#SECURGL 66304161
 AIF   ('&I'(2,8)  NE '1,2,3,B '               ).DSINVC       *#SECURGL 66319261
 AIF   ('&O'(2,2)  EQ 'F '                     ).DSHEAD       *#SECURGL 66334361
 AGO  .DSINVC                                                 *#SECURGL 66349461
.GIO      ANOP                                                *#SECURGL 66364561
.**************************************************************         66379661
TERIO    SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 66394761
         USING CCBADR,R1                                       @D61NDJK 66409861
         USING ERBLKADR,R2                                     @D61NDJK 66424961
         USING PUBADR,R3                                       @D61NDJK 66440061
 SGTAP  'SGCOV ERPT610',NR=(31,0) TERIO ENTERED                   TERIO 66457551
*                                                              @D61NDJK 66470261
*------------------------------------------------------------* @D61NDJK 66485361
*                                                              @D61NDJK 66500461
*   ISSUE SVC 15.                                              @D61NDJK 66515561
*                                                              @D61NDJK 66530661
*------------------------------------------------------------* @D61NDJK 66545761
*                                                              @D61NDJK 66591061
         SVC   15                 PERFORM HEADQUEUE IO W/O WAIT@D61NDJK 66606161
*                                                              @D61NDJK 66621261
         LA    RF,TERERSUC        DO ONLY UNCOND. M&R          @D61NDJK 66636361
         TM    TERFLG,TERCVMSG    MESSAGING IS RESTRICTED?     @D61NDJK 66651461
         BZ    TERIOSUP           YES                          @D61SDJK 66673551
*                                                              @D61NDJK 66681661
 SGTAP  'CALL  TERMSG          ','ON RETURN MESSAGING',        @D61NDJKX66696761
               I='1,2,3,B,F         IS DONE IF IT WAS',        @D61NDJKX66711861
               O='NONE              DESIRABLE'                 @D61NDJK 66726961
 SGTAP  'SGCOV ERPT610',NR=(31,1) MESSAGING WAS DONE AFTER SYSIO  TERIO 66749051
*                                                              @D61NDJK 66757161
*-------------------------------------------------------------*@D61SDJK 67048951
*                                                              @D61SDJK 67068941
*   LEAVE TO SUPERVISOR RESIDENT PART OF SGTAP.                @D61SDJK 67088931
*                                                              @D61SDJK 67108921
*-------------------------------------------------------------*@D61SDJK 67128911
*                                                              @D61SDJK 67148901
TERIOSUP L     RF,TERLINK         ESTABLISH LINKAGE TO..       @D61SDJK 67168891
         USING TERLNKG,RF           SUPERVISOR PART OF..       @D61SDJK 67188881
         L     RF,TERIOLVE          SGTAP AND RETURN IN..      @D61SDJK 67208871
         DROP  RF                   ORDER TO DO OTHER WORK     @D61SDJK 67228861
         AMODESW CALL,AMODE=24,REGS=(RE,RF)   =============>>> @D61SDJK 67248851
*                                                              @D61SDJK 67268841
*-------------------------------------------------------------*@D61SDJK 67288831
*                                                              @D61SDJK 67308821
*   RECOVERY I/O HAS BEEN POSTED AND RECOVERY CAN BE RESUMED.  @D61SDJK 67328811
*                                                              @D61SDJK 67348801
*-------------------------------------------------------------*@D61SDJK 67368791
*                                                              @D61SDJK 67388781
         USING TERGLOB,RA         REESTABLISH..                @D61SDJK 67408771
         USING TERIO,RC             ADDRESSABILITY OF..        @D61SDJK 67428761
TERIORET DS    0H                   WORK ENVIRONMENT           @D61SDJK 67448751
*                                                              @D61SDJK 67468741
*------------------------------------------------------------* @D61NDJK 67602761
*                                                              @D61NDJK 67617861
*   CHECK IF A NEW I/O ERROR ENCOUNTERED.                      @D61NDJK 67632961
*                                                              @D61NDJK 67648061
*------------------------------------------------------------* @D61NDJK 67663161
*                                                              @D61NDJK 67678261
         TM    CCBCOM1,DISERR     I/O ERROR ENCOUNTERED?       @D61NDJK 67693361
         BO    TERIO100           YES                          @D61NDJK 67708461
*                                                              @D61NDJK 67723561
         LA    RF,TERERSUC        TAKE COMPLETION CODE..       @D61NDJK 67738661
         B     TERIOEX              "I/O WAS DONE SUCCESSFULLY"@D61NDJK 67753761
*                                                              @D61NDJK 67768861
TERIO100 MVI   TERCURSL,X'20'     ASSUME SENSE DATA LENGTH 32  @D61SDJK 67788951
         TM    CCBSTA1,UNITCK     I/O ERROR IS A UNIT CHECK?   @D61SDJK 67793941
         BO    TERIO150           YES                          @D61NDJK 67799061
*                                                              @D61NDJK 67814161
 SGTAP  'SGCOV ERPT610',NR=(31,2) NO UNIT CHECK ENCOUNTERED       TERIO 67836251
         XC    TERSNS,TERSNS      CLEAR SENSE BYTES            @D61NDJK 67844361
         MVI   TERCURSL,X'00'     SENSE DATA LENGTH IS 0       @D61SDJK 67849361
*                                                              @D61NDJK 67859461
TERIO150 LA    RF,TERERAEC        TAKE COMPLETION CODE..       @D61NDJK 67874561
*                                   "ANOTHER ERROR OCCURRED"   @D61NDJK 67889661
 SGTAP  'SGCOV ERPT610',NR=(31,3) AN I/O ERROR ENCOUNTERED        TERIO 67909751
*                                                              @D61NDJK 67919861
*------------------------------------------------------------* @D61NDJK 67934961
*                                                              @D61NDJK 67950061
*   UPDATE CURRENT PATH FAILURE INFORMATION.                   @D61NDJK 67987761
*                                                              @D61NDJK 68025561
*------------------------------------------------------------* @D61NDJK 68040661
*                                                              @D61SDJK 68105751
         L     R5,TERAPUBX        GET PUBX POINTER             @D61SDJK 68155741
         SLR   R7,R7              LPUM MUST SERVE AS PATH MASK @D61SDJK 68205731
         SLR   R9,R9              CLEAR CHANNEL PATH ID        @D61SDJK 68255721
 SGTAP  'CALL  TERPATH         ','GET ASSOCIATED CHPID',       @D61SDJKX68305711
               I='5,7,9             ON RETURN+4',              @D61SDJKX68355701
               O='7,9               CHPID IS SET',             @D61SDJKX68405691
               E0='TERIO200       CHPID COULD NOT BE BUILT'    @D61SDJK 68455681
*                                                              @D61SDJK 68505671
         STCM  R9,1,TERCURPI      UPDATE PATH FAILURE INFO     @D61SDJK 68555661
 SGTAP  'SGCOV ERPT610',NR=(31,4) LAST PATH USED IS FOUND         TERIO 68605651
         B     TERIOEX                                         @D61SDJK 68705631
*                                                              @D61SDJK 68755621
TERIO200 MVC   TERCURPI(1),ERRQPATH TAKE OLD PATH FAILURE INFO @D61SDJK 68805611
 SGTAP  'SGCOV ERPT610',NR=(31,5) LAST PATH USED IS NOT FOUND     TERIO 68855601
*                                                              @D61SDJK 68955581
*------------------------------------------------------------* @D61NDJK 69052361
*                                                              @D61NDJK 69067461
*   EXIT HANDLING.                                             @D61NDJK 69082561
*                                                              @D61NDJK 69097661
*------------------------------------------------------------* @D61NDJK 69112761
*                                                              @D61NDJK 69127861
TERIOEX  SGTAP 'RETURN         ','RETURN TO CALLER         ',  @D61NDJKX69142961
               OUTPUT=(RF)                                     @D61NDJK 69158061
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 69173161
         LTORG                                                 @D61NDJK 69188261
         EJECT                                                 @D61NDJK 69203361
*                                                              @D61NDJK 69225451
***************************************************************         69233561
*  FUNCTION                                                    @D61NDJK 69248661
*    MOVE A NUMBER OF DATA FROM A CCW DATA AREA TO A           @D61NDJK 69263761
*    SPECIFIED LOCATION.                                       @D61NDJK 69278861
*                                                              @D61NDJK 69293961
*  INPUT                                                       @D61NDJK 69309061
*    - R5 CONTAINS THE LENGTH OF DATA TO BE MOVED.             @D61NDJK 69324161
*    - R6 CONTAINS THE OFFSET OF THE FIRST DATA BYTE.          @D61NDJK 69339261
*    - R7 CONTAINS THE ADDRESS OF THE AREA WHERE THE           @D61NDJK 69354361
*         DATA SHALL BE MOVED TO.                              @D61NDJK 69369461
*    - R8 CONTAINS A CCW ADDRESS.                              @D61NDJK 69384561
*                                                              @D61NDJK 69399661
*  OUTPUT ON RETURN TO RETURN+0                                @D61NDJK 69414761
*    - NONE. SOME OF THE DATA WERE NOT ADDRESSABLE.            @D61NDJK 69429861
*                                                              @D61NDJK 69444961
*  OUTPUT ON RETURN TO RETURN+4                                @D61NDJK 69460061
*    - ALL DATA WERE MOVED TO AREA GIVEN BY R7.                @D61NDJK 69475161
*                                                              @D61NDJK 69490261
***************************************************************         69505361
 AGO  .GGETDT                                                 *#SECURGL 69520461
.LGETDT  AIF ('&TEST'(1,14) NE 'CALL  TERGETDT').LRDOA        *#SECURGL 69542551
 AIF   ('&I'(2,8)  NE '5,6,7,8 '               ).DSINVC       *#SECURGL 69550661
 AIF   ('&O'(2,4)  NE 'NONE'                   ).DSINVC       *#SECURGL 69565761
 AIF   (T'&E0      NE 'O'                      ).DSHEAD       *#SECURGL 69590851
 AGO  .DSINVC                                                 *#SECURGL 69611061
.GGETDT   ANOP                                                *#SECURGL 69626161
.**************************************************************         69641261
TERGETDT SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 69656361
         USING CCWADR,R8                                       @D61NDJK 69671461
 SGTAP  'SGCOV ERPT610',NR=(32,0) TERGETDT ENTERED             TERGETDT 69693551
*                                                              @D61NDJK 69701661
*------------------------------------------------------------* @D61NDJK 69716761
*                                                              @D61NDJK 69731861
*   TRANSFER ALL CCW DATA BYTES IN A LOOP STARTING WITH        @D61NDJK 69746961
*   THE LAST ONE.                                              @D61NDJK 69762061
*                                                              @D61NDJK 69777161
*------------------------------------------------------------* @D61NDJK 69792261
*                                                              @D61NDJK 69807361
TERGE100 LA    R0,0(R5,R6)        TAKE OFFSET OF NEXT..        @D61NDJK 69822461
         BCTR  R0,0                 DATA BYTE TO MOVE          @D61SDJK 69844551
*                                                              @D61NDJK 69852661
*------------------------------------------------------------* @D61SDJK 69877751
*   BRANCH INTO SUPERVISOR PART OF SGTAP IN ORDER TO CALL      @D61SDJK 69887741
*   GETDADR ROUTINE.                                           @D61SDJK 69897731
*------------------------------------------------------------* @D61SDJK 69907721
*                                                              @D61SDJK 69917711
.*  GETDADR RETURNS THE VIRTUAL ADDRESS OF A DATA BYTE         @D61NDJK 69943261
.*  WITHIN AN I/O AREA OF THE CCW POINTED TO BY R8. THE        @D61NDJK 69958361
.*  OFFSET IN THE I/O AREA IS SPECIFIED IN R0.                 @D61NDJK 69973461
.*                                                             @D61NDJK 69988561
         L     RF,TERLINK         ESTABLISH LINKAGE TO..       @D61SDJK 70063641
         USING TERLNKG,RF           SUPERVISOR PART OF..       @D61SDJK 70093631
         L     R9,TERGETDA          SGTAP AND RETURN IN..      @D61SDJK 70123621
         L     RF,TERCALL           ORDER TO GET THE..         @D61SDJK 70153611
         DROP  RF                   CCW DATA ADDRESS           @D61SDJK 70183601
         BALR  RE,RF              =========================>>> @D61SDJK 70213591
*                                                              @D61SDJK 70273571
*------------------------------------------------------------* @D61NDJK 70350961
*   TRANSFER ONE DATA BYTE, IF POSSIBLE.                       @D61NDJK 70366061
*------------------------------------------------------------* @D61NDJK 70381161
*                                                              @D61NDJK 70396261
         LTR   RF,RF              GETDADR CALL FAILED?         @D61NDJK 70411361
         BZ    TERGEEX0           YES                          @D61NDJK 70426461
*                                                              @D61NDJK 70441561
         LA    R4,0(R5,R7)        TAKE TARGET ADDRESS WHERE..  @D61NDJK 70456661
         BCTR  R4,0                 DATA BYTE SHALL BE MOVED TO@D61NDJK 70471761
*                                                              @D61NDJK 70486861
         MVC   0(1,R4),0(RF)      TRANSFER ONE BYTE            @D61NDJK 70501961
*                                                              @D61NDJK 70517061
         BCT   R5,TERGE100        REPEAT UNTIL ALL..           @D61NDJK 70532161
         B     TERGEEX4             BYTES ARE MOVED            @D61NDJK 70547261
*                                                              @D61NDJK 70562361
*------------------------------------------------------------* @D61NDJK 70577461
*                                                              @D61NDJK 70592561
*   EXIT HANDLING.                                             @D61NDJK 70607661
*                                                              @D61NDJK 70622761
*------------------------------------------------------------* @D61NDJK 70637861
*                                                              @D61NDJK 70652961
*------------------------------------------------------------* @D61NDJK 70668061
*   ERROR EXIT.                                                @D61NDJK 70683161
*------------------------------------------------------------* @D61NDJK 70698261
*                                                              @D61NDJK 70713361
TERGEEX0 DS    0H                                              @D61NDJK 70728461
 SGTAP  'SGCOV ERPT610',NR=(32,1) GETDADR FAILED               TERGETDT 70750551
         SGTAP 'RETURN         ','ERROR EXIT               '   @D61NDJK 70758661
*                                                              @D61NDJK 70773761
*------------------------------------------------------------* @D61NDJK 70788861
*   NORMAL EXIT.                                               @D61NDJK 70803961
*------------------------------------------------------------* @D61NDJK 70819061
*                                                              @D61NDJK 70834161
TERGEEX4 SGTAP 'RETURN4        ','RETURN TO CALLER         '   @D61NDJK 70849261
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 70864361
         LTORG                                                 @D61NDJK 70879461
         EJECT                                                 @D61NDJK 70894561
*                                                              @D61NDJK 70909661
***************************************************************         70909701
*  FUNCTION                                                    @D61SDJK 70909741
*                                                              @D61SDJK 70909781
*    SET UP READ OPPOSITE OR READ ALTERNATE CCW AND ISSUE      @D61SDJK 70909821
*    RECOVERY I/O REQUEST.                                     @D61SDJK 70909861
*                                                              @D61SDJK 70909901
*  INPUT                                                       @D61SDJK 70909941
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61SDJK 70909981
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61SDJK 70910021
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61SDJK 70910061
*    - R4 CONTAINS THE POINTER TO A CCW.                       @D61SDJK 70910101
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61SDJK 70910141
*                                                              @D61SDJK 70910181
*  OUTPUT ON RETURN TO RETURN+0                                @D61SDJK 70910221
*    - NONE. RECOVERY I/O COULDN'T BE DONE.                    @D61SDJK 70910261
*                                                              @D61SDJK 70910301
*  OUTPUT ON RETURN TO RETURN+4                                @D61SDJK 70910341
*    - R7 CONTAINS THE BYTE COUNT OF THE ROR/RAR CCW           @D61SDJK 70910381
*                                                              @D61SDJK 70910421
***************************************************************         70910461
 AGO  .GRDOA                                                  *#SECURGL 70910501
.LRDOA   AIF ('&TEST'(1,14) NE 'CALL  TERRDOA ').LSIMRD       *#SECURGL 70910541
 AIF   ('&I'(2,10) NE '1,2,3,4,B '             ).DSINVC       *#SECURGL 70910581
 AIF   ('&O'(2,2)  NE '7 '                     ).DSINVC       *#SECURGL 70910621
 AIF   (T'&E0      NE 'O'                      ).DSHEAD       *#SECURGL 70910661
 AGO  .DSINVC                                                 *#SECURGL 70910701
.GRDOA    ANOP                                                *#SECURGL 70910741
.**************************************************************         70910781
TERRDOA  SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61SDJK 70910821
         USING CCBADR,R1                                       @D61SDJK 70910861
         USING ERBLKADR,R2                                     @D61SDJK 70910901
         USING PUBADR,R3                                       @D61SDJK 70910941
         USING CCWADR,R4                                       @D61SDJK 70910981
 SGTAP  'SGCOV ERPT610',NR=(33,0) TERRDOA ENTERED               TERRDOA 70911021
*                                                              @D61SDJK 70911101
*------------------------------------------------------------* @D61NDJK 70911141
*   PREPARE READ OPPOSITE OR READ ALTERNATE CCW DEPENDENT      @D61SDJK 70911181
*   ON THE OPCODE OF THE FAILING CCW.                          @D61SDJK 70911221
*------------------------------------------------------------* @D61NDJK 70911261
*                                                              @D61NDJK 70911301
         XC    CCWTOT,CCWTOT      INITIALIZE RECOVERY CCW      @D61NDJK 70911341
*                                 FAILING CCW IS..             @D61SDJK 70911381
         CLI   TERCCCWO,RDP         A READ PREVIOUS CCW?       @D61SDJK 70911421
         BE    TERRD070           YES                          @D61SDJK 70911461
*                                 FAILING CCW IS..             @D61NDJK 70911501
         CLI   TERCCCWO,READB       A READ BACKWARD CCW?       @D61NDJK 70911541
         BE    TERRD100           YES                          @D61SDJK 70911581
*                                                              @D61NDJK 70911621
TERRD050 MVI   CCWCODE,READB      READ BACKWARD MUST BE DONE   @D61NDJK 70911661
 SGTAP  'SGCOV ERPT610',NR=(33,1) FAILING CCW IS A READ FWD CCW TERRDOA 70911741
         L     R7,TERROWAA        POINT TO..                   @D61NDJK 70911781
         AL    R7,TERROWAL          LAST BYTE IN..             @D61NDJK 70911821
         BCTR  R7,0                 RAR/ROR WORK AREA          @D61NDJK 70911861
         B     TERRD200                                        @D61SDJK 70911901
*                                                              @D61SDJK 70911941
TERRD070 TM    TERROFLG,TERRORAR  RAR MUST BE DONE?            @D61SDJK 70911981
         BO    TERRD050           YES                          @D61SDJK 70912021
*                                 POINT TO..                   @D61SDJK 70912061
         L     R7,TERROWAA          FIRST BYTE IN WORK AREA    @D61SDJK 70912101
         MVI   CCWCODE,RDF        TAKE TPA READ FORWARD COMMAND@D61SDJK 70912141
         B     TERRD200                                        @D61SDJK 70912181
*                                                              @D61SDJK 70912221
TERRD100 L     R7,TERROWAA          FIRST BYTE IN WORK AREA    @D61SDJK 70912261
 SGTAP  'SGCOV ERPT610',NR=(33,2) FAILING CCW IS READ BWD/PREV. TERRDOA 70912341
         MVI   CCWCODE,RDF        ASSUME THAT ROR IS TO BE DONE@D61SDJK 70912381
         CLI   TERDEVTY,TERTPA    IT IS A TPA DEVICE?          @D61SDJK 70912421
         BNL   TERRD150           YES                          @D61SDJK 70912461
         MVI   CCWCODE,RDCOM      TAKE 3480-TYPE READ COMMAND  @D61SDJK 70912501
TERRD150 TM    TERROFLG,TERRORAR  ROR MUST BE DONE?            @D61SDJK 70912541
         BZ    TERRD200           YES                          @D61SDJK 70912581
*                                                              @D61SDJK 70912621
         MVI   CCWCODE,RDP        RAR MUST BE DONE             @D61SDJK 70912661
*                                                              @D61SDJK 70912701
*------------------------------------------------------------* @D61NDJK 70912741
*   BUILD DATA ADDRESS FOR ROR/RAR CCW.                        @D61SDJK 70912781
*------------------------------------------------------------* @D61NDJK 70912821
*                                                              @D61NDJK 70912861
TERRD200 LA    RF,TERROIDA        POINT TO IDA LIST            @D61SDJK 70912901
         STCM  RF,7,CCWBUF+1      STORE IDAL POINTER AS..      @D61NDJK 70912941
*                                   RAR CCW DATA ADDRESS       @D61NDJK 70912981
*------------------------------------------------------------* @D61NDJK 70913021
*   BUILD IDAWS FOR ROR/RAR CCW.                               @D61SDJK 70913061
*------------------------------------------------------------* @D61NDJK 70913101
*                                                              @D61NDJK 70913141
.*  THIS IDAL BUILDING ONLY WORKS BECAUSE OUR I/O BUFFER       @D61NDJK 70913181
.*  BEGINS AND ENDS ON 2K BOUNDARIES.                          @D61NDJK 70913221
.*                                                             @D61NDJK 70913261
.*  R9 CONTAINS THE CURRENT OFFSET IN THE IDAL AND HELPS       @D61NDJK 70913301
.*     TO ADDRESS THE CURRENT IDAW.                            @D61NDJK 70913341
.*  R5 COUNTS THE DATA BYTES THAT ARE ALREADY ADDRESSED        @D61NDJK 70913381
.*     IN THE IDA LIST.                                        @D61NDJK 70913421
.*  R7 CONTAINS THE CURRENT VIRTUAL IDAW ADDRESS.              @D61NDJK 70913461
.*  RF CONTAINS THE CURRENT REAL IDAW ADDRESS.                 @D61NDJK 70913501
.*                                                             @D61NDJK 70913541
         SLR   R9,R9              INITIALIZE INDEX TO IDAWS    @D61NDJK 70913581
         SLR   R5,R5              INITIALIZE DATA BYTE COUNTER @D61NDJK 70913621
TERRD300 AL    R5,TERRDMAD        UPDATE DATA BYTE POINTER     @D61SDJK 70913661
         C     R5,TERROWAL        ONE MORE IDAW MUST BE BUILT? @D61NDJK 70913701
         BH    TERRD400           NO, LEAVE LOOP               @D61SDJK 70913741
*                                                              @D61NDJK 70913781
         LR    R8,R7              GET CURRENT WORK AREA POINTER@D61NDJK 70913821
 SGTAP  'CALL  TERCVTVR        ','CONVERT VIRTUAL TO REAL',    @D61NDJKX70913861
               I='8                 ON RETURN',                @D61NDJKX70913901
               O='F                 RF IS REAL OR 0 '          @D61NDJK 70913941
         LTR   RF,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 70913981
         BZ    TERRDEX0           YES                          @D61SDJK 70914021
*                                                              @D61SDJK 70914061
 SGTAP  'SGCOV ERPT610',NR=(33,3) AT LEAST ONE IDAW WAS BUILT   TERRDOA 70914141
         ST    RF,TERROIDA(R9)    STORE NEXT IDAW IN IDA LIST  @D61SDJK 70914181
         LA    R9,4(R9)           NEXT IDAW CAN BE INDEXED     @D61NDJK 70914221
*                                 ROR/RAR OPCODE..             @D61SDJK 70914261
         CLI   CCWCODE,READB        IS READ BACKWARD?          @D61SDJK 70914301
         BE    TERRD350           YES                          @D61SDJK 70914341
*                                                              @D61NDJK 70914381
         AL    R7,TERRDMAD        ADJUST WORK AREA POINTER     @D61NDJK 70914421
         B     TERRD300           START NEXT RUN THRU LOOP     @D61SDJK 70914461
*                                                              @D61NDJK 70914501
TERRD350 SL    R7,TERRDMAD        ADJUST WORK AREA POINTER     @D61SDJK 70914541
         B     TERRD300           START NEXT RUN THRU LOOP     @D61SDJK 70914581
*                                                              @D61NDJK 70914621
*------------------------------------------------------------* @D61NDJK 70914661
*   SET UP FLAG BYTE AND BYTE COUNT OF ROR/RAR CCW.            @D61SDJK 70914701
*------------------------------------------------------------* @D61NDJK 70914741
*                                                              @D61NDJK 70914781
TERRD400 OI    CCWCHAIN,IDAL      SWITCH ON IDA BIT            @D61SDJK 70914821
.*                                                             @D61SDJK 70914861
.* IN OLDER RELEASES THE SKIP BIT WAS SET HERE IF THE FAILING  @D61SDJK 70914901
.* COMMAND CCW HAD SET THE SKIP BIT. THIS CAUSED PROBLEMS IN   @D61SDJK 70914941
.* DATA CHAINS WHERE THE SKIP BIT IS SET IN THE COMMAND CCW    @D61SDJK 70914981
.* BUT NOT IN AT LEAST ONE OF THE OTHER DATA CHAINED CCWS.     @D61SDJK 70915021
*                                                              @D61NDJK 70915061
         L     R7,TERROWAL        TAKE LENGTH OF WORK AREA     @D61SDJK 70915101
*                                 LENGTH OF WORK AREA IS..     @D61SDJK 70915141
         CL    R7,=A(TERROMAX)      GREATER THAN X'FFFF'       @D61NDJK 70915181
         BL    TERRD450           NO                           @D61SDJK 70915221
*                                                              @D61NDJK 70915261
 SGTAP  'SGCOV ERPT610',NR=(33,4) WORK AREA GREATER THAN 64K-1  TERRDOA 70915341
         L     R7,=XL4'0000FFFF'  MAXIMAL BYTE COUNT ALLOWED   @D61NDJK 70915381
TERRD450 STH   R7,CCWLNG          SET BYTE COUNT OF CCW        @D61SDJK 70915421
*                                                              @D61NDJK 70915461
*------------------------------------------------------------* @D61NDJK 70915501
*   ISSUE READ OPPOSITE/ALTERNATE I/O REQUEST.                 @D61SDJK 70915541
*------------------------------------------------------------* @D61NDJK 70915581
*                                                              @D61NDJK 70915621
         MVC   TERSVCCB,TERCCB    PRESERVE CCB                 @D61NDJK 70915661
*                                 SET UP CCB FOR RAR/ROR I/O:  @D61SDJK 70915701
         STCM  R4,7,CCBCCW31+1      START OF CHANNEL PROGRAM   @D66ADAP 70915741
*                                                              @D61NDJK 70915781
 SGTAP  'CALL  TERIO           ','ISSUE I/O REQUEST',          @D61NDJKX70915821
               I='1,2,3,B           ON RETURN ',               @D61NDJKX70915861
               O='F                 RF IS COMPLETION CODE'     @D61NDJK 70915901
*                                                              @D61NDJK 70915941
         B     TERRDEX4                                        @D61SDJK 70915981
*                                                              @D61SDJK 70916021
*------------------------------------------------------------* @D61SDJK 70916061
*                                                              @D61SDJK 70916101
*   EXIT HANDLING.                                             @D61SDJK 70916141
*                                                              @D61SDJK 70916181
*------------------------------------------------------------* @D61SDJK 70916221
*                                                              @D61SDJK 70916261
*------------------------------------------------------------* @D61SDJK 70916301
*   ERROR EXIT.                                                @D61SDJK 70916341
*------------------------------------------------------------* @D61SDJK 70916381
*                                                              @D61SDJK 70916421
TERRDEX0 DS    0H                                          '   @D61SDJK 70916461
 SGTAP  'SGCOV ERPT610',NR=(33,5) ERROR EXIT IS SELECTED        TERRDOA 70916541
         SGTAP 'RETURN         ','ERROR EXIT               '   @D61SDJK 70916581
*                                                              @D61SDJK 70916621
*------------------------------------------------------------* @D61SDJK 70916661
*   NORMAL EXIT.                                               @D61SDJK 70916701
*------------------------------------------------------------* @D61SDJK 70916741
*                                                              @D61SDJK 70916781
TERRDEX4 SGTAP 'RETURN4        ','RETURN TO CALLER         ',  @D61SDJKX70916821
               OUTPUT=(R7)                                     @D61SDJK 70916861
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61SDJK 70916901
*                                                              @D61SDJK 70916941
*------------------------------------------------------------* @D61SDJK 70916981
*                                                              @D61SDJK 70917021
*   LOCAL VARIABLES USED IN TERRDOA                            @D61SDJK 70917061
*                                                              @D61SDJK 70917101
*------------------------------------------------------------* @D61SDJK 70917141
*                                                              @D61SDJK 70917181
TERRDMAD DC    F'2048'            MAXIMUM AMOUNT OF DATA THAT  @D61SDJK 70917221
*                                 CAN BE TRANSFERRED WITH ONE  @D61SDJK 70917261
*                                 IDAW.                        @D61SDJK 70917301
         LTORG                                                 @D61SDJK 70917341
         EJECT                                                 @D61SDJK 70917381
*                                                              @D61SDJK 70917421
***************************************************************         70917461
*  FUNCTION                                                    @D61SDJK 70917501
*                                                              @D61SDJK 70917541
*    SIMULATE THE READ OPERATION.                              @D61SDJK 70917581
*                                                              @D61SDJK 70917621
*    SIMULATE A TAPE DEVICE. THE RECORD IN THE RAR WORK        @D61SDJK 70917661
*    AREA, WHICH WAS PREVIOUSLY READ FROM THE REAL DEVICE,     @D61SDJK 70917701
*    REPRESENTS A RECORD ON THE SIMULATED TAPE.                @D61SDJK 70917741
*                                                              @D61SDJK 70917781
*  INPUT                                                       @D61SDJK 70917821
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61SDJK 70917861
*    - R5 CONTAINS THE POSITION OF THE SIMULATED TAPE HEAD.    @D61SDJK 70917901
*    - R7 CONTAINS THE LENGTH OF THE RECORD READ FROM TAPE.    @D61SDJK 70917941
*    - R8 CONTAINS VIRTUAL ADDRESS OF CURRENT CCW IN DATA      @D61SDJK 70917981
*         CHAIN.                                               @D61SDJK 70918021
*    - R9 POINTS TO THE BEGIN OF THE RECORD IN THE ROR OR      @D61SDJK 70918061
*         RAR WORK AREA.                                       @D61SDJK 70918101
*                                                              @D61SDJK 70918141
*  OUTPUT                                                      @D61SDJK 70918181
*    - NONE. READ SIMULATION IS DONE.                          @D61SDJK 70918221
*                                                              @D61SDJK 70918261
***************************************************************         70918301
 AGO  .GSIMRD                                                 *#SECURGL 70918341
.LSIMRD  AIF ('&TEST'(1,14) NE 'CALL  TERSIMRD').LCCWDO       *#SECURGL 70918381
 AIF   ('&I'(2,10) NE '1,5,7,8,9 '             ).DSINVC       *#SECURGL 70918421
 AIF   ('&O'(2,4)  EQ 'NONE'                   ).DSHEAD       *#SECURGL 70918461
 AGO  .DSINVC                                                 *#SECURGL 70918501
.GSIMRD   ANOP                                                *#SECURGL 70918541
.**************************************************************         70918581
TERSIMRD SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61SDJK 70918621
         USING CCBADR,R1                                       @D61SDJK 70918661
         USING CCWADR,R8                                       @D61SDJK 70918701
 SGTAP  'SGCOV ERPT610',NR=(34,0) TERSIMRD ENTERED             TERSIMRD 70918781
*                                                              @D61SDJK 70918821
*------------------------------------------------------------* @D61NDJK 70918861
*   PERFORM READ SIMULATION FOR ALL CCWS IN A POSSIBLE DATA    @D61NDJK 70918901
*   CHAIN IN A LOOP STARTING WITH THE FAILING COMMAND CCW.     @D61NDJK 70918941
*------------------------------------------------------------* @D61NDJK 70918981
*                                                              @D61NDJK 70919021
TERSI100 DS    0H                                              @D61SDJK 70919061
 SGTAP  'CALL  TERCCWDO        ','XFER DATA FOR ONE CCW',      @D61NDJKX70919141
               I='2,5,7,8,9         ON RETURN ',               @D61NDJKX70919181
               O='5,F               VALUES ARE SET',           @D61NDJKX70919221
               E0='TERSI200       ERROR: LEAVE LOOP'           @D61SDJK 70919261
*                                                              @D61NDJK 70919301
         SLR   R6,R6              EVEN THOUGH ALL BYTES ARE..  @D61NDJK 70919341
         ICM   R6,3,CCWLNG          XFERRED, THE USER CCW BYTE @D61NDJK 70919381
         AL    R6,TERROACC          COUNT MIGHT BE TOO SMALL   @D61NDJK 70919421
         ST    R6,TERROACC        SAVE ACCUMULATED BYTE COUNT  @D61NDJK 70919461
*                                                              @D61NDJK 70919501
         LTR   RF,RF              ALL NEEDED BYTES ARE XFERRED?@D61NDJK 70919541
         BNZ   TERSI120           NO                           @D61SDJK 70919581
*                                 CURRENT CCW IS THE..         @D61NDJK 70919621
         TM    CCWCHAIN,DC          LAST CCW IN DATA CHAIN?    @D61NDJK 70919661
         BO    TERSI150           NO, BUMP TO THE NEXT CCW     @D61SDJK 70919701
*                                                              @D61NDJK 70919741
         CR    R6,R7              INCORRECT LENGTH CONDITION?  @D61NDJK 70919781
         BE    TERSI200           NO                           @D61SDJK 70919821
*                                                              @D61NDJK 70919861
TERSI120 TM    CCWCHAIN,DC        EVENTUAL SLI CAN BE IGNORED? @D61SDJK 70919901
         BO    TERSI130           YES                          @D61SDJK 70919941
 SGTAP  'SGCOV ERPT610',NR=(34,1) LAST CCW IN DC IS PROCESSED  TERSIMRD 70920021
         TM    CCWCHAIN,SLI       CURRENT CCW HAS SLI BIT SET? @D61NDJK 70920061
         BO    TERSI200           YES                          @D61SDJK 70920101
*                                                              @D61NDJK 70920141
TERSI130 OI    TERROFLG,TERROIL   INDICATE INCORRECT LENGTH    @D61SDJK 70920181
         B     TERSI200           LEAVE LOOP                   @D61SDJK 70920221
*                                                              @D61NDJK 70920261
TERSI150 DS    0H                                              @D61SDJK 70920301
 SGTAP  'SGCOV ERPT610',NR=(34,2) IT IS A DATA CHAIN FOR SURE  TERSIMRD 70920381
*                                                              @D61NDJK 70920421
 SGTAP  'CALL  TERBUMP         ','BUMP TO NEXT CCW ',          @D61NDJKX70920461
               I='8                 ON RETURN TO +12',         @D61NDJKX70920501
               O='8                 R8 POINTS TO NEXT CCW',    @D61NDJKX70920541
               E0='TERSI170         ERROR: NOT ADDRESSABLE',   @D61SDJKX70920581
               E4='TERSI170         ERROR: CHAIN ENDED',       @D61SDJKX70920621
               E8='TERSI180         ERROR: TWO TICS'           @D61SDJK 70920661
*                                                              @D61NDJK 70920701
         B     TERSI100           PROCESS NEXT CCW             @D61SDJK 70920741
*                                                              @D61NDJK 70920781
TERSI170 OI    TERROFLG,TERRONOR  DO NOT RESUME USER CCW CHAIN @D61SDJK 70920821
 SGTAP  'SGCOV ERPT610',NR=(34,3) DO NOT RESUME USER CCW CHAIN TERSIMRD 70920901
         B     TERSIEX                                         @D61SDJK 70920941
*                                                              @D61NDJK 70920981
TERSI180 OI    TERROFLG,TERROPGC  INDICATE PROGRAM CHECK       @D61SDJK 70921021
*                                                              @D61NDJK 70921061
*------------------------------------------------------------* @D61NDJK 70921101
*   SIMULATE A CHANNEL. IF ANY ERRORS ARE FOUND THAT A         @D61NDJK 70921141
*   CHANNEL WOULD FIND, THEY MUST BE INDICATED IN THE          @D61NDJK 70921181
*   ORIGINAL ERROR CSW.                                        @D61NDJK 70921221
*------------------------------------------------------------* @D61NDJK 70921261
*                                                              @D61NDJK 70921301
TERSI200 MVI   CCBSTA1,X'0C'      INDICATE CE/DE IN UNIT STATUS@D61SDJK 70921341
         MVI   CCBSTA2,X'00'      CLEAR CHANNEL STATUS         @D61NDJK 70921381
*                                                              @D61NDJK 70921421
         TM    TERROFLG,TERROERR  ANY ERROR OCCURRED?          @D61NDJK 70921461
         BZ    TERSI250           NO                           @D61SDJK 70921501
*                                                              @D61NDJK 70921541
         TM    TERROFLG,TERROPGC  A PROGRAM CHECK OCCURRED?    @D61NDJK 70921581
         BZ    TERSI210           NO                           @D61SDJK 70921621
*                                                              @D61NDJK 70921661
 SGTAP  'SGCOV ERPT610',NR=(34,4) PROGRAM CHECK IN SIMULATION  TERSIMRD 70921741
         OI    CCBSTA2,PGMC       SET PROGRAM CHECK IN CSW     @D61NDJK 70921781
*                                                              @D61NDJK 70921821
TERSI210 TM    TERROFLG,TERROPTC  A PROTECTION CHECK OCCURRED? @D61SDJK 70921861
         BZ    TERSI220           NO                           @D61SDJK 70921901
*                                                              @D61NDJK 70921941
 SGTAP  'SGCOV ERPT610',NR=(34,5) PROT. CHECK IN SIMULATION    TERSIMRD 70922021
         OI    CCBSTA2,PCK        SET PROTECTION CHECK IN CSW  @D61NDJK 70922061
*                                                              @D61NDJK 70922101
TERSI220 TM    TERROFLG,TERROIL   INCORRECT LENGTH WAS FOUND?  @D61SDJK 70922141
         BZ    TERSI250           NO                           @D61SDJK 70922181
*                                                              @D61NDJK 70922221
 SGTAP  'SGCOV ERPT610',NR=(34,6) INCORR. LENGTH IN SIMULATION TERSIMRD 70922301
         OI    CCBSTA2,IL         SET INCORRECT LENGTH IN CSW  @D61NDJK 70922341
*                                                              @D61NDJK 70922381
TERSI250 STH   RF,CCBCNT          SET UP RESIDUAL COUNT IN CSW @D61SDJK 70922421
*                                                              @D61NDJK 70922461
 SGTAP  'CALL  TERCVTVR        ','CONVERT VIRTUAL TO REAL',    @D61NDJKX70922501
               I='8                 ON RETURN',                @D61NDJKX70922541
               O='F                 RF IS REAL OR 0 '          @D61NDJK 70922581
         LTR   RF,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 70922621
         BZ    TERSI270           YES                          @D61SDJK 70922661
         LA    RF,8(RF)           SET UP CSW CCW ADDRESS..     @D61NDJK 70922701
         STCM  RF,7,CCBCSWW         IN ORIGINAL ERROR CSW      @D61NDJK 70922741
         B     TERSIEX                                         @D61SDJK 70922781
*                                                              @D61NDJK 70922821
TERSI270 OI    TERROFLG,TERRONOR  DO NOT RESUME USER CCW CHAIN @D61SDJK 70922861
 SGTAP  'SGCOV ERPT610',NR=(34,7) ADDRESS CONVERSION FAILED    TERSIMRD 70922901
*                                                              @D61NDJK 70922981
*------------------------------------------------------------* @D61SDJK 70923021
*                                                              @D61SDJK 70923061
*   EXIT HANDLING.                                             @D61SDJK 70923101
*                                                              @D61SDJK 70923141
*------------------------------------------------------------* @D61SDJK 70923181
*                                                              @D61SDJK 70923221
*------------------------------------------------------------* @D61SDJK 70923261
*   NORMAL EXIT.                                               @D61SDJK 70923301
*------------------------------------------------------------* @D61SDJK 70923341
*                                                              @D61SDJK 70923381
TERSIEX  SGTAP 'RETURN         ','RETURN TO CALLER         '   @D61SDJK 70923421
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61SDJK 70923461
         LTORG                                                 @D61SDJK 70923501
         EJECT                                                 @D61SDJK 70923541
*                                                              @D61SDJK 70923581
***************************************************************         70924761
*  FUNCTION                                                    @D61NDJK 70939861
*    TRANSFER ALL DATA BYTES FOR ONE CCW, FORWARDS OR          @D61NDJK 70954961
*    BACKWARDS, FROM A WORK AREA INTO THE CCW I/O AREA.        @D61NDJK 70970061
*                                                              @D61NDJK 70985161
*  INPUT                                                       @D61NDJK 71000261
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 71015361
*    - R5 CONTAINS THE OFFSET IN THE RECORD THAT HAS TO BE     @D61NDJK 71030461
*         TRANSFERRED.                                         @D61NDJK 71045561
*    - R7 CONTAINS THE LENGTH OF THE RECORD THAT HAS TO BE     @D61NDJK 71060661
*         TRANSFERRED.                                         @D61NDJK 71075761
*    - R8 CONTAINS THE VIRTUAL ADDRESS OF THE CCW, WHOSE       @D61NDJK 71090861
*         I/O AREA MUST BE FILLED WITH DATA BYTES.             @D61NDJK 71105961
*    - R9 CONTAINS THE START ADDRESS OF THE RECORD THAT HAS    @D61NDJK 71121061
*         TO BE TRANSFERRED.                                   @D61NDJK 71136161
*                                                              @D61NDJK 71151261
*  OUTPUT ON RETURN TO RETURN+0                                @D61NDJK 71166361
*    - INVALID DATA ADDRESS OR STORAGE PROTECTION VIOLATION.   @D61NDJK 71177661
*      RF NUMBER OF BYTES THAT HAVE NOT BEEN TRANSFERRED       @D61NDJK 71188961
*         FOR THAT CCW.                                        @D61NDJK 71200261
*                                                              @D61NDJK 71211661
*  OUTPUT ON RETURN TO RETURN+4                                @D61NDJK 71226761
*    - R5 NEW OFFSET OF THE RECORD THAT HAS TO BE MOVED.       @D61NDJK 71241861
*    - RF NUMBER OF BYTES THAT HAVE NOT BEEN TRANSFERRED       @D61NDJK 71256961
*         FOR THAT CCW.                                        @D61NDJK 71272061
*                                                              @D61NDJK 71287161
***************************************************************         71302261
 AGO  .GCCWDO                                                 *#SECURGL 71317361
.LCCWDO  AIF ('&TEST'(1,14) NE 'CALL  TERCCWDO').LXFER        *#SECURGL 71332461
 AIF   ('&I'(2,10) NE '2,5,7,8,9 '             ).DSINVC       *#SECURGL 71347561
 AIF   ('&O'(2,4)  NE '5,F '                   ).DSINVC       *#SECURGL 71362661
 AIF   (T'&E0      NE 'O'                      ).DSHEAD       *#SECURGL 71377761
 AGO  .DSINVC                                                 *#SECURGL 71392861
.GCCWDO   ANOP                                                *#SECURGL 71407961
.**************************************************************         71423061
TERCCWDO SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 71438161
         USING ERBLKADR,R2                                     @D61NDJK 71453261
         LR    R4,R8              USE REGISTER 4 AS CCW POINTER@D61NDJK 71468361
         USING CCWADR,R4                                       @D61NDJK 71483461
 SGTAP  'SGCOV ERPT610',NR=(35,0) TERCCWDO ENTERED             TERCCWDO 71505551
*                                                              @D61NDJK 71513661
*------------------------------------------------------------* @D61NDJK 71528761
*                                                              @D61NDJK 71543861
*   TRANSFER ALL CCW DATA BYTES IN A LOOP.                     @D61NDJK 71558961
*                                                              @D61NDJK 71574061
*------------------------------------------------------------* @D61NDJK 71589161
*                                                              @D61NDJK 71604261
*------------------------------------------------------------* @D61NDJK 71619361
*   DETERMINE REAL TARGET ADDRESS, WHERE FIRST DATA BYTE HAS   @D61NDJK 71634461
*   TO BE MOVED TO.                                            @D61NDJK 71649561
*------------------------------------------------------------* @D61NDJK 71664661
*                                                              @D61NDJK 71679761
         SLR   R8,R8              TAKE CCW DATA ADDRESS..      @D61NDJK 71694861
         ICM   R8,7,CCWBUF+1        AS REAL TARGET ADDRESS     @D61NDJK 71709961
*                                                              @D61NDJK 71725061
         TM    CCWCHAIN,IDAL      CCW HAS SET THE IDA BIT?     @D61NDJK 71740161
         BZ    TERCC200           NO                           @D61NDJK 71755261
*                                                              @D61NDJK 71770361
 SGTAP  'SGCOV ERPT610',NR=(35,1) CCW HAS SPECIFIED AN IDAL    TERCCWDO 71792451
         ST    R8,TERROPTR        SAVE POINTER TO CURRENT IDAW @D61NDJK 71800561
*                                                              @D61NDJK 71815661
 SGTAP  'CALL  TERCVTRV        ','CONVERT REAL TO VIRTUAL ',   @D61NDJKX71830761
               I='8                 ON RETURN',                @D61NDJKX71845861
               O='F                 RF =0 OR VIRTUAL ADDRESS'  @D61NDJK 71860961
*                                                              @D61NDJK 71876061
         LTR   RF,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 71891161
         BZ    TERCC100           YES                          @D61NDJK 71906261
*                                                              @D61NDJK 71921361
         L     R8,0(RF)           TAKE FIRST IDAW..            @D61NDJK 71936461
         B     TERCC200             AS REAL TARGET ADDRESS     @D61NDJK 71951561
*                                                              @D61NDJK 71966661
TERCC100 OI    TERROFLG,TERROPGC  INDICATE A PROGRAM CHECK     @D61NDJK 71981761
 SGTAP  'SGCOV ERPT610',NR=(35,2) ADDRESS CONVERSION FAILED    TERCCWDO 71999851
         ICM   RF,3,CCWLNG        RETURN BYTE COUNT AS RES.CNT.@D61NDJK 72004361
         B     TERCCEX0           SELECT ERROR EXIT            @D61NDJK 72011961
*                                                              @D61NDJK 72027061
*------------------------------------------------------------* @D61NDJK 72042161
*   DETERMINE RESIDUAL COUNT FOR TAPE READ SIMULATION.         @D61NDJK 72057261
*------------------------------------------------------------* @D61NDJK 72072361
*                                 TAKE CCW BYTE COUNT AS..     @D61NDJK 72087461
TERCC200 SLR   RF,RF                RESIDUAL COUNT FOR THE..   @D61NDJK 72102561
         ICM   RF,3,CCWLNG          SIMULATED READ OPERATION   @D61NDJK 72117661
         LTR   RF,RF              CCW BYTE COUNT IS ZERO?      @D61NDJK 72132761
         BNZ   TERCC300           NO                           @D61NDJK 72147861
*                                                              @D61NDJK 72162961
 SGTAP  'SGCOV ERPT610',NR=(35,3) CCW HAS A ZERO BYTE COUNT    TERCCWDO 72185051
         OI    TERROFLG,TERROPGC  INDICATE A PROGRAM CHECK..   @D61NDJK 72193161
         B     TERCCEX0             AND SELECT ERROR EXIT      @D61NDJK 72208261
*                                                              @D61NDJK 72223361
*------------------------------------------------------------* @D61NDJK 72238461
*   TRANSFER DATA BYTES FOR A READ BACKWARD CCW IN A LOOP.     @D61NDJK 72253561
*------------------------------------------------------------* @D61NDJK 72268661
*                                 FAILING CCW..                @D61NDJK 72283761
TERCC300 CLI   TERCCCWO,READB       IS A READ BACKWARD CCW?    @D61SDJK 72308851
         BNE   TERCC400           NO                           @D61SDJK 72318841
*                                                              @D61NDJK 72329061
         LR    R6,R5              SET UP REGISTER R6           @D61NDJK 72344161
         LA    R6,1(R6)           THERE IS AT LEAST ONE..      @D61NDJK 72359261
         LTR   R6,R6                MORE DATA BYTE AVAILABLE?  @D61NDJK 72374361
         BZ    TERCCEX4           NO, SELECT NORMAL EXIT       @D61NDJK 72389461
*                                 CCW REQUESTED AT LEAST..     @D61NDJK 72404561
         LTR   RF,RF                ONE MORE BYTE TO TRANSFER? @D61NDJK 72419661
         BZ    TERCCEX4           NO, SELECT NORMAL EXIT       @D61NDJK 72434761
*                                                              @D61NDJK 72449861
 SGTAP  'SGCOV ERPT610',NR=(35,4) READ BACKWARD LOOP ENTERED   TERCCWDO 72471951
         TM    CCWCHAIN,SKIP      CCW HAS SET THE SKIP BIT?    @D61NDJK 72480061
         BO    TERCC350           YES                          @D61NDJK 72495161
*                                                              @D61NDJK 72510261
 SGTAP  'CALL  TERXFER         ','TRANSFER ONE BYTE OF DATA',  @D61NDJKX72525361
               I='2,5,8,9           ON RETURN',                @D61NDJKX72540461
               O='NONE              BYTE IS MOVED TO AREA',    @D61NDJKX72555561
               E0='TERCCEX0         ERROR: PRG OR PROT CHECK'  @D61NDJK 72570661
*                                                              @D61NDJK 72585761
TERCC350 BCTR  R5,0               UPDATE PARAMETERS..          @D61NDJK 72600861
         BCTR  RF,0                 FOR THE NEXT..             @D61NDJK 72615961
         BCTR  R8,0                 RUN THROUGH LOOP           @D61NDJK 72631061
*                                                              @D61NDJK 72646161
         TM    CCWCHAIN,IDAL      CCW HAS SET THE IDA BIT?     @D61NDJK 72661261
         BZ    TERCC300           NO                           @D61NDJK 72676361
*                                                              @D61NDJK 72691461
         LR    R0,R8              NEW TARGET ADDRESS..         @D61NDJK 72706561
         N     R0,TERCCIDA          POINTS OUTSIDE THE..       @D61NDJK 72721661
         CL    R0,TERCCIDA          CURRENT 2K IDA BLOCK?      @D61NDJK 72736761
         BNE   TERCC300           NO                           @D61NDJK 72751861
*                                                              @D61NDJK 72766961
 SGTAP  'SGCOV ERPT610',NR=(35,5) END OF 2K IDA BLOCK REACHED  TERCCWDO 72789051
         L     R8,TERROPTR        PROVIDE IDAW POINTER         @D61NDJK 72797161
*                                                              @D61NDJK 72812261
 SGTAP  'CALL  TERBPIDA        ','BUMP TO THE NEXT IDAW',      @D61NDJKX72827361
               I='8                 ON RETURN',                @D61NDJKX72842461
               O='8                 R8 CONTAINS NEW POINTER',  @D61NDJKX72857561
               E0='TERCCEX0         ERROR: PROGRAM CHECK'      @D61NDJK 72872661
*                                                              @D61NDJK 72887761
         B     TERCC300                                        @D61NDJK 72902861
*                                                              @D61NDJK 72917961
*------------------------------------------------------------* @D61NDJK 72933061
*   TRANSFER DATA BYTES FOR A READ FORWARD OR READ PREVIOUS    @D61SDJK 72953151
*   CCW IN A LOOP.                                             @D61SDJK 72958141
*------------------------------------------------------------* @D61NDJK 72963261
*                                 THERE IS AT LEAST ONE..      @D61NDJK 72978361
TERCC400 CR    R7,R5                MORE DATA BYTE AVAILABLE?  @D61NDJK 72993461
         BNH   TERCCEX4           NO, SELECT NORMAL EXIT       @D61NDJK 73008561
*                                 CCW REQUESTED AT LEAST..     @D61NDJK 73023661
         LTR   RF,RF                ONE MORE BYTE TO TRANSFER? @D61NDJK 73038761
         BZ    TERCCEX4           NO, SELECT NORMAL EXIT       @D61NDJK 73053861
*                                                              @D61NDJK 73068961
 SGTAP  'SGCOV ERPT610',NR=(35,6) READ FORWARD LOOP ENTERED    TERCCWDO 73091051
         TM    CCWCHAIN,SKIP      CCW HAS SET THE SKIP BIT?    @D61NDJK 73099161
         BO    TERCC450           YES                          @D61NDJK 73114261
*                                                              @D61NDJK 73129361
 SGTAP  'CALL  TERXFER         ','TRANSFER ONE BYTE OF DATA',  @D61NDJKX73144461
               I='2,5,8,9           ON RETURN',                @D61NDJKX73159561
               O='NONE              BYTE IS MOVED TO AREA',    @D61NDJKX73174661
               E0='TERCCEX0         ERROR: PRG OR PROT CHECK'  @D61NDJK 73189761
*                                                              @D61NDJK 73204861
TERCC450 LA    R5,1(R5)           UPDATE PARAMETERS..          @D61NDJK 73219961
         BCTR  RF,0                 FOR THE NEXT..             @D61NDJK 73235061
         LA    R8,1(R8)             RUN THROUGH LOOP           @D61NDJK 73250161
*                                                              @D61NDJK 73265261
         TM    CCWCHAIN,IDAL      CCW HAS SET THE IDA BIT?     @D61NDJK 73280361
         BZ    TERCC400           NO                           @D61NDJK 73295461
*                                                              @D61NDJK 73310561
         LR    R0,R8              NEW TARGET ADDRESS..         @D61NDJK 73325661
         N     R0,TERCCIDA          POINTS OUTSIDE THE..       @D61NDJK 73340761
         LTR   R0,R0                CURRENT 2K IDA BLOCK?      @D61NDJK 73355861
         BNZ   TERCC400           NO                           @D61NDJK 73370961
*                                                              @D61NDJK 73386061
 SGTAP  'SGCOV ERPT610',NR=(35,7) END OF 2K IDA BLOCK REACHED  TERCCWDO 73408151
         L     R8,TERROPTR        PROVIDE IDAW POINTER         @D61NDJK 73416261
*                                                              @D61NDJK 73431361
 SGTAP  'CALL  TERBPIDA        ','BUMP TO THE NEXT IDAW',      @D61NDJKX73446461
               I='8                 ON RETURN',                @D61NDJKX73461561
               O='8                 R8 CONTAINS NEW POINTER',  @D61NDJKX73476661
               E0='TERCCEX0         ERROR: PROGRAM CHECK'      @D61NDJK 73491761
*                                                              @D61NDJK 73506861
         B     TERCC400                                        @D61NDJK 73521961
*                                                              @D61NDJK 73537061
*------------------------------------------------------------* @D61NDJK 73552161
*                                                              @D61NDJK 73567261
*   EXIT HANDLING.                                             @D61NDJK 73582361
*                                                              @D61NDJK 73597461
*------------------------------------------------------------* @D61NDJK 73612561
*                                                              @D61NDJK 73627661
*------------------------------------------------------------* @D61NDJK 73642761
*   ERROR EXIT.                                                @D61NDJK 73657861
*------------------------------------------------------------* @D61NDJK 73672961
*                                                              @D61NDJK 73688061
TERCCEX0 DS    0H                                              @D61NDJK 73703161
 SGTAP  'SGCOV ERPT610',NR=(36,0) ERROR EXIT SELECTED          TERCCWDO 73723251
         SGTAP 'RETURN         ','ERROR EXIT               ',  @D61NDJKX73728261
               OUTPUT=(RF)                                     @D61NDJK 73738261
*                                                              @D61NDJK 73748461
*------------------------------------------------------------* @D61NDJK 73763561
*   NORMAL EXIT.                                               @D61NDJK 73778661
*------------------------------------------------------------* @D61NDJK 73793761
*                                                              @D61NDJK 73808861
TERCCEX4 SGTAP 'RETURN4        ','RETURN TO CALLER         ',  @D61NDJKX73823961
               OUTPUT=(R5,RF)                                  @D61NDJK 73839061
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 73854161
*                                                              @D61NDJK 73869261
*------------------------------------------------------------* @D61NDJK 73884361
*                                                              @D61NDJK 73899461
*   LOCAL VARIABLES USED IN TERCCWDO                           @D61NDJK 73914561
*                                                              @D61NDJK 73929661
*------------------------------------------------------------* @D61NDJK 73944761
*                                                              @D61NDJK 73959861
TERCCIDA DC    F'2047'            MAXIMUM AMOUNT OF DATA THAT..@D61NDJK 73974961
*                                   CAN BE ADDRESSED BY AN IDAW@D61NDJK 73990061
         LTORG                                                 @D61NDJK 74005161
         EJECT                                                 @D61NDJK 74020261
*                                                              @D61NDJK 74035361
***************************************************************         74050461
*  FUNCTION                                                    @D61NDJK 74065561
*    TRANSFER 1 BYTE FROM ONE INTO ANOTHER STORAGE LOCATION.   @D61NDJK 74080661
*                                                              @D61NDJK 74095761
*  INPUT                                                       @D61NDJK 74110861
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 74125961
*    - R5 CONTAINS THE DISPLACEMENT.                           @D61NDJK 74141061
*    - R8 CONTAINS THE TARGET ADDRESS.                         @D61NDJK 74156161
*    - R9 CONTAINS THE SOURCE ADDRESS W/O DISPLACEMENT.        @D61NDJK 74171261
*                                                              @D61NDJK 74186361
*  OUTPUT ON RETURN TO RETURN+0                                @D61NDJK 74201461
*    - NONE. PROGRAM CHECK OR STORAGE PROTECTION VIOLATION.    @D61NDJK 74216561
*                                                              @D61NDJK 74231661
*  OUTPUT ON RETURN TO RETURN+4                                @D61NDJK 74246761
*    - NONE. THE BYTE HAS BEEN TRANSFERRED.                    @D61NDJK 74261861
*                                                              @D61NDJK 74276961
***************************************************************         74292061
 AGO  .GXFER                                                  *#SECURGL 74307161
.LXFER   AIF ('&TEST'(1,14) NE 'CALL  TERXFER ').LBPIDA       *#SECURGL 74322261
 AIF   ('&I'(2,8)  NE '2,5,8,9 '               ).DSINVC       *#SECURGL 74337361
 AIF   ('&O'(2,4)  NE 'NONE'                   ).DSINVC       *#SECURGL 74352461
 AIF   (T'&E0      NE 'O'                      ).DSHEAD       *#SECURGL 74367561
 AGO  .DSINVC                                                 *#SECURGL 74382661
.GXFER    ANOP                                                *#SECURGL 74397761
.**************************************************************         74412861
TERXFER  SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 74427961
         USING ERBLKADR,R2                                     @D61NDJK 74443061
 SGTAP  'SGCOV ERPT610',NR=(37,0) TERXFER ENTERED               TERXFER 74465151
*                                                              @D61NDJK 74473261
*------------------------------------------------------------* @D61NDJK 74488361
*                                                              @D61NDJK 74503461
*   CONVERT THE REAL TARGET ADDRESS INTO A VIRTUAL ONE         @D61NDJK 74518561
*   USING THE GETDADR MACRO.                                   @D61NDJK 74533661
*                                                              @D61NDJK 74548761
*------------------------------------------------------------* @D61NDJK 74563861
*                                                              @D61NDJK 74578961
*------------------------------------------------------------* @D61NDJK 74594061
*   SET UP THE DATA ADDRESS OF A FAKE CCW WITH THE TARGET      @D61NDJK 74609161
*   ADDRESS GIVEN IN R8.                                       @D61NDJK 74624261
*------------------------------------------------------------* @D61NDJK 74639361
*                                                              @D61NDJK 74654461
         ST    R8,TERROCVT        SET UP FAKE CCW IDAL         @D61NDJK 74669561
*                                                              @D61NDJK 74684661
         LA    R8,TERCCWFK        PROVIDE POINTER TO FAKE..    @D61NDJK 74699761
         USING CCWADR,R8            CCW AND MAKE IT ADDRESSABLE@D61NDJK 74714861
         XC    CCWTOT,CCWTOT      SET UP FAKE CCW:             @D61NDJK 74729961
         LA    R6,TERROCVT          OPCODE AND BYTE..          @D61NDJK 74745061
         STCM  R6,7,CCWBUF+1        COUNT ARE NOT..            @D61NDJK 74760161
         MVI   CCWCHAIN,X'04'       RELEVANT FOR GETDADR       @D61NDJK 74775261
*                                                              @D61NDJK 74790361
         LA    R0,0               PROVIDE OFFSET ZERO          @D61NDJK 74805461
*                                                              @D61NDJK 74820561
*------------------------------------------------------------* @D61SDJK 74845651
*   BRANCH INTO SUPERVISOR PART OF SGTAP IN ORDER TO CALL      @D61SDJK 74855641
*   GETDADR ROUTINE.                                           @D61SDJK 74865631
*------------------------------------------------------------* @D61SDJK 74875621
*                                                              @D61SDJK 74885611
.*  GETDADR RETURNS THE VIRTUAL ADDRESS OF A DATA BYTE         @D61NDJK 74911161
.*  WITHIN AN I/O AREA OF THE CCW POINTED TO BY R8. THE        @D61NDJK 74926261
.*  OFFSET IN THE I/O AREA IS SPECIFIED IN R0.                 @D61NDJK 74941361
.*                                                             @D61NDJK 74956461
         LR    R6,R9              PRESERVE SOURCE ADDRESS      @D61SDJK 75011541
         L     RF,TERLINK         ESTABLISH LINKAGE TO..       @D61SDJK 75031531
         USING TERLNKG,RF           SUPERVISOR PART OF..       @D61SDJK 75051521
         L     R9,TERGETDA          SGTAP AND RETURN IN..      @D61SDJK 75071511
         L     RF,TERCALL           ORDER TO GET THE..         @D61SDJK 75091501
         DROP  RF                   CCW DATA ADDRESS           @D61SDJK 75111491
         BALR  RE,RF              =========================>>> @D61SDJK 75131481
         LR    R9,R6              RESTORE SOURCE ADDRESS       @D61SDJK 75151471
*                                                              @D61SDJK 75191451
*------------------------------------------------------------* @D61NDJK 75318861
*   VERIFY OUTCOME OF ADDRESS CONVERSION.                      @D61NDJK 75333961
*------------------------------------------------------------* @D61NDJK 75349061
*                                                              @D61NDJK 75364161
         LTR   RF,RF              GETDADR CALL FAILED?         @D61NDJK 75379261
         BNZ   TERXF100           NO                           @D61NDJK 75394361
*                                                              @D61NDJK 75409461
 SGTAP  'SGCOV ERPT610',NR=(37,1) GETDADR FAILED                TERXFER 75431551
         OI    TERROFLG,TERROPGC  INDICATE A PROGRAM CHECK     @D61NDJK 75439661
         B     TERXFEX0           SELECT ERROR EXIT            @D61NDJK 75454761
*                                                              @D61NDJK 75469861
*------------------------------------------------------------* @D61NDJK 75484961
*                                                              @D61NDJK 75500061
*   TRANSFER DATA BYTE, IF POSSIBLE.                           @D61NDJK 75515161
*                                                              @D61NDJK 75530261
*------------------------------------------------------------* @D61NDJK 75545361
*                                                              @D61NDJK 75560461
*------------------------------------------------------------* @D61NDJK 75575561
*   VERIFY AUTHORIZATION OF USER.                              @D61NDJK 75590661
*------------------------------------------------------------* @D61NDJK 75605761
*                                                              @D61NDJK 75620861
TERXF100 L     R7,TERROCVT        ALIGN REAL TARGET..          @D61NDJK 75635961
         LR    R6,R7                ADDRESS ON FULWORD..       @D61NDJK 75651061
         N     R6,TERXFFWB          BOUNDARY AND GET..         @D61NDJK 75666161
         SLR   R7,R6                STORAGE KEY OF..           @D61NDJK 75681261
         ISKE  R0,R7                TARGET ADDRESS             @D61NDJK 75696361
*                                                              @D61NDJK 75711461
         N     R0,TERXFSTK        MASK OUT IRRELEVANT BITS     @D61NDJK 75726561
*                                                              @D61NDJK 75741661
         SLR   R7,R7              SET UP STORAGE..             @D61NDJK 75756761
         ICM   R7,1,ERRQCSW         KEY OF USERS..             @D61NDJK 75771861
         N     R7,TERXFSTK          CHANNEL PROGRAM            @D61NDJK 75786961
*                                                              @D61NDJK 75802061
         CR    R0,R7              USERS CHANNEL PROGRAM IS..   @D61NDJK 75817161
         BE    TERXF200             AUTHORIZED TO STORE..      @D61NDJK 75832261
         LTR   R7,R7                DATA ON THAT ADDRESS?      @D61NDJK 75847361
         BZ    TERXF200           YES                          @D61NDJK 75862461
*                                                              @D61NDJK 75877561
 SGTAP  'SGCOV ERPT610',NR=(37,2) PROTECTION CHECK OCCURRED     TERXFER 75899651
         OI    TERROFLG,TERROPTC  INDICATE A PROTECTION CHECK  @D61NDJK 75907761
         B     TERXFEX0                                        @D61NDJK 75922861
*                                                              @D61NDJK 75937961
*------------------------------------------------------------* @D61NDJK 75953061
*   TRANSFER DATA BYTE.                                        @D61NDJK 75968161
*------------------------------------------------------------* @D61NDJK 75983261
*                                                              @D61NDJK 75998361
TERXF200 ALR   R9,R5              SET UP THE SOURCE ADDRESS..  @D61NDJK 76013461
         MVC   0(1,RF),0(R9)        AND MOVE ONE BYTE TO..     @D61NDJK 76028561
 SGTAP  'SGCOV ERPT610',NR=(37,3) DATA BYTE WAS MOVED           TERXFER 76050651
         B     TERXFEX4             THE TARGET ADDRESS         @D61NDJK 76058761
*                                                              @D61NDJK 76073861
*------------------------------------------------------------* @D61NDJK 76088961
*                                                              @D61NDJK 76104061
*   EXIT HANDLING.                                             @D61NDJK 76119161
*                                                              @D61NDJK 76134261
*------------------------------------------------------------* @D61NDJK 76149361
*                                                              @D61NDJK 76164461
*------------------------------------------------------------* @D61NDJK 76179561
*   ERROR EXIT.                                                @D61NDJK 76194661
*------------------------------------------------------------* @D61NDJK 76209761
*                                                              @D61NDJK 76224861
TERXFEX0 SGTAP 'RETURN         ','ERROR EXIT               '   @D61NDJK 76239961
*                                                              @D61NDJK 76255061
*------------------------------------------------------------* @D61NDJK 76270161
*   NORMAL EXIT.                                               @D61NDJK 76285261
*------------------------------------------------------------* @D61NDJK 76300361
*                                                              @D61NDJK 76315461
TERXFEX4 SGTAP 'RETURN4        ','RETURN TO CALLER         '   @D61NDJK 76330561
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 76345661
*                                                              @D61NDJK 76360761
*------------------------------------------------------------* @D61NDJK 76375861
*                                                              @D61NDJK 76390961
*   LOCAL VARIABLES USED IN TERXFER                            @D61NDJK 76406061
*                                                              @D61NDJK 76421161
*------------------------------------------------------------* @D61NDJK 76436261
*                                                              @D61NDJK 76451361
TERXFFWB DC    F'15'              MASK FOR FULWORD..           @D61NDJK 76466461
*                                   BOUNDARY ALIGNMENT         @D61NDJK 76481561
TERXFSTK DC    F'240'             MASK FOR STORAGE KEY INQUIRY @D61NDJK 76496661
*                                                              @D61NDJK 76511761
         LTORG                                                 @D61NDJK 76526861
         EJECT                                                 @D61NDJK 76541961
*                                                              @D61NDJK 76557061
***************************************************************         76572161
*  FUNCTION                                                    @D61NDJK 76587261
*    BUMP TO THE NEXT IDAW IN A CCW IDAL.                      @D61NDJK 76602361
*                                                              @D61NDJK 76617461
*  INPUT                                                       @D61NDJK 76632561
*    - R8 CONTAINS THE REAL ADDRESS OF AN IDAW.                @D61NDJK 76647661
*                                                              @D61NDJK 76662761
*  OUTPUT ON RETURN TO RETURN+0                                @D61NDJK 76677861
*    - NONE. AN ADDRESS CONVERSION FAILED.                     @D61NDJK 76692961
*                                                              @D61NDJK 76708061
*  OUTPUT ON RETURN TO RETURN+4                                @D61NDJK 76723161
*    - R8 CONTAINS THE REAL ADDRESS OF THE NEXT IDAW.          @D61NDJK 76738261
*                                                              @D61NDJK 76753361
***************************************************************         76768461
 AGO  .GBPIDA                                                 *#SECURGL 76783561
.LBPIDA  AIF ('&TEST'(1,14) NE 'CALL  TERBPIDA').LCVTRV       *#SECURGL 76798661
 AIF   ('&I'(2,2)  NE '8 '                     ).DSINVC       *#SECURGL 76813761
 AIF   ('&O'(2,2)  NE '8 '                     ).DSINVC       *#SECURGL 76828861
 AIF   (T'&E0      NE 'O'                      ).DSHEAD       *#SECURGL 76843961
 AGO  .DSINVC                                                 *#SECURGL 76859061
.GBPIDA   ANOP                                                *#SECURGL 76874161
.**************************************************************         76889261
TERBPIDA SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 76904361
 SGTAP  'SGCOV ERPT610',NR=(38,0) TERBPIDA ENTERD              TERBPIDA 76926451
*                                                              @D61NDJK 76934561
*------------------------------------------------------------* @D61NDJK 76949661
*                                                              @D61NDJK 76964761
*   BUMP TO THE NEXT IDAW.                                     @D61NDJK 76979861
*                                                              @D61NDJK 76994961
*------------------------------------------------------------* @D61NDJK 77010061
*                                                              @D61NDJK 77025161
         LA    R8,4(R8)           INCREMENT IDAW POINTER BY 4  @D61NDJK 77040261
         ST    R8,TERROPTR        UPDATE REAL IDAW POINTER     @D61NDJK 77047761
*                                                              @D61NDJK 77055361
 SGTAP  'CALL  TERCVTRV        ','CONVERT REAL TO VIRTUAL ',   @D61NDJKX77070461
               I='8                 ON RETURN',                @D61NDJKX77085561
               O='F                 RF =0 OR VIRTUAL ADDRESS'  @D61NDJK 77100661
*                                                              @D61NDJK 77115761
         LTR   RF,RF              ADDRESS CONVERSION FAILED?   @D61NDJK 77130861
         BZ    TERBP100           YES                          @D61NDJK 77145961
*                                                              @D61NDJK 77161061
         L     R8,0(RF)           POINT TO THE NEW IDAW        @D61NDJK 77176161
         B     TERBPEX4                                        @D61NDJK 77191261
*                                                              @D61NDJK 77206361
TERBP100 OI    TERROFLG,TERROPGC  INDICATE A PROGRAM CHECK     @D61NDJK 77221461
 SGTAP  'SGCOV ERPT610',NR=(38,1) ADDRESS CONVERSION FAILED    TERBPIDA 77243551
*                                                              @D61NDJK 77251661
*------------------------------------------------------------* @D61NDJK 77266761
*                                                              @D61NDJK 77281861
*   EXIT HANDLING.                                             @D61NDJK 77296961
*                                                              @D61NDJK 77312061
*------------------------------------------------------------* @D61NDJK 77327161
*                                                              @D61NDJK 77342261
*------------------------------------------------------------* @D61NDJK 77357361
*   ERROR EXIT.                                                @D61NDJK 77372461
*------------------------------------------------------------* @D61NDJK 77387561
*                                                              @D61NDJK 77402661
TERBPEX0 SGTAP 'RETURN         ','ERROR EXIT               '   @D61NDJK 77417761
*                                                              @D61NDJK 77432861
*------------------------------------------------------------* @D61NDJK 77447961
*   NORMAL EXIT.                                               @D61NDJK 77463061
*------------------------------------------------------------* @D61NDJK 77478161
*                                                              @D61NDJK 77493261
TERBPEX4 SGTAP 'RETURN4        ','RETURN TO CALLER         ',  @D61NDJKX77508361
               OUTPUT=(R8)                                     @D61NDJK 77523461
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 77538561
         LTORG                                                 @D61NDJK 77553661
         EJECT                                                 @D61NDJK 77568761
*                                                              @D61NDJK 77583861
***************************************************************         77598961
*  FUNCTION                                                    @D61NDJK 77614061
*    CONVERT A REAL ADDRESS TO THE CORRESPONDING VIRTUAL       @D61NDJK 77629161
*    ADDRESS.                                                  @D61NDJK 77644261
*                                                              @D61NDJK 77659361
*    THE VIRTAD PROCEDURE IS CALLED TO CONVERT THE REAL        @D61NDJK 77674461
*    ADDRESS TO A VIRTUAL ADDRESS.                             @D61NDJK 77689561
*                                                              @D61NDJK 77704661
*  INPUT                                                       @D61NDJK 77719761
*    - R8 CONTAINS A REAL ADDRESS.                             @D61NDJK 77734861
*                                                              @D61NDJK 77749961
*  OUTPUT                                                      @D61NDJK 77765061
*    - RF CONTAINS A VIRTUAL ADDRESS. RF IS ZERO WHEN THE      @D61NDJK 77780161
*      REAL ADDRESS DOES NOT HAVE A CORRESPONDING VIRTUAL      @D61NDJK 77795261
*      ADDRESS.                                                @D61NDJK 77810361
*                                                              @D61NDJK 77825461
***************************************************************         77840561
 AGO  .GCVTRV                                                 *#SECURGL 77855661
.LCVTRV  AIF ('&TEST'(1,14) NE 'CALL  TERCVTRV').LCVTVR       *#SECURGL 77870761
 AIF   ('&I'(2,2)  NE '8 '                     ).DSINVC       *#SECURGL 77885861
 AIF   ('&O'(2,2)  EQ 'F '                     ).DSHEAD       *#SECURGL 77900961
 AGO  .DSINVC                                                 *#SECURGL 77916061
.GCVTRV   ANOP                                                *#SECURGL 77931161
.**************************************************************         77946261
TERCVTRV SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 77961361
*                                                              @D61NDJK 77976461
         ASYSCOM (R7)             ESTABLISH..                  @D61SDJK 77994551
         USING SYSCOM,R7            ADDRESSABILITY OF SYSCOM   @D61SDJK 77997541
         L     R1,IJBSMCOM        MAKE STORAGE MANAGEMENT..    @D61NDJK 78000531
         USING SMCOM,R1             AREA ADDRESSABLE           @D61NDJK 78006661
         LR    RF,R8              VIRTUAL INPUT ADDRESS IS..   @D61NDJK 78031751
         CL    RF,SMCSUPND          INSIDE SUPERVISOR?         @D61NDJK 78041741
         BL    TERRVEX            YES, RETURN V=R ADDRESS..    @D61NDJK 78051731
         DROP  R1                   IN OUTPUT REGISTER RF      @D61NDJK 78061721
*                                                              @D61NDJK 78082161
         STM   R0,RE,TERTERSV     SAVE REGISTERS               @D61NDJK 78102251
         LR    R9,R8              PASS REAL ADDRESS TO VIRTAD  @D61NDJK 78107241
         L     R5,TERLINK         ESTABLISH LINKAGE TO..       @D61SDJK 78112231
         USING TERLNKG,R5           SUPERVISOR ROUTINE..       @D61SDJK 78117221
         L     R5,TERVIRTA          VIRTAD IN ORDER TO..       @D61SDJK 78122211
         DROP  R5                   CONVERT REAL ADDRESS       @D61SDJK 78127201
         AMODESW CALL,ADDRESS=(R5),REGS=R6   ==============>>> @D61SDJK 78132191
*                                                              @D61NDJK 78142561
         LM    R0,RE,TERTERSV     RESTORE REGISTERS EXCEPT..   @D61NDJK 78164651
*                                   VIRTAD ANSWER REGISTER     @D61NDJK 78172761
TERRVEX  SGTAP 'RETURN         ','RETURN TO CALLER         ',  @D61NDJKX78187861
               OUTPUT=(RF)                                     @D61NDJK 78202961
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 78218061
         LTORG                                                 @D61NDJK 78233161
         EJECT                                                 @D61NDJK 78248261
*                                                              @D61NDJK 78263361
***************************************************************         78278461
*  FUNCTION                                                    @D61NDJK 78293561
*    CONVERT A VIRTUAL ADDRESS TO THE CORRESPONDING REAL       @D61NDJK 78308661
*    ADDRESS.                                                  @D61NDJK 78323761
*                                                              @D61NDJK 78338861
*    THE REALAD MACRO SERVICE IS USED TO CONVERT THE VIRTUAL   @D61NDJK 78353961
*    ADDRESS TO A REAL ADDRESS.                                @D61NDJK 78369061
*                                                              @D61NDJK 78384161
*  INPUT                                                       @D61NDJK 78399261
*    - R8 CONTAINS A VIRTUAL ADDRESS.                          @D61NDJK 78414361
*                                                              @D61NDJK 78429461
*  OUTPUT                                                      @D61NDJK 78444561
*    - RF CONTAINS A REAL ADDRESS. RF IS ZERO WHEN THE         @D61NDJK 78459661
*      VIRTUAL ADDRESS DOES NOT HAVE A CORRESPONDING           @D61NDJK 78474761
*      REAL ADDRESS.                                           @D61NDJK 78489861
*                                                              @D61NDJK 78504961
***************************************************************         78520061
 AGO  .GCVTVR                                                 *#SECURGL 78535161
.LCVTVR  AIF ('&TEST'(1,14) NE 'CALL  TERCVTVR').LMSG         *#SECURGL 78550261
 AIF   ('&I'(2,2)  NE '8 '                     ).DSINVC       *#SECURGL 78565361
 AIF   ('&O'(2,2)  EQ 'F '                     ).DSHEAD       *#SECURGL 78580461
 AGO  .DSINVC                                                 *#SECURGL 78595561
.GCVTVR   ANOP                                                *#SECURGL 78610661
.**************************************************************         78625761
TERCVTVR SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 78640861
*                                                              @D61NDJK 78655961
         ASYSCOM (R7)             ESTABLISH..                  @D61SDJK 78674051
         USING SYSCOM,R7            ADDRESSABILITY OF SYSCOM   @D61SDJK 78677041
         L     R1,IJBSMCOM        MAKE STORAGE MANAGEMENT..    @D61NDJK 78680031
         USING SMCOM,R1             AREA ADDRESSABLE           @D61NDJK 78686161
         LR    RF,R8              VIRTUAL INPUT ADDRESS IS..   @D61NDJK 78711251
         CL    RF,SMCSUPND          INSIDE SUPERVISOR?         @D61NDJK 78721241
         BL    TERVREX            YES, RETURN V=R ADDRESS..    @D61NDJK 78731231
         DROP  R1                   IN OUTPUT REGISTER RF      @D61NDJK 78741221
         LR    R1,R8              PASS THE VIRTUAL ADDRESS..   @D61NDJK 78751211
         REALAD (1)                 TO REALAD SERVICE          @D61NDJK 78776761
         LR    RF,R0              LOAD RESULT OF CONVERSION..  @D61NDJK 78798851
*                                   INTO OUTPUT REGISTER RF    @D61NDJK 78806961
TERVREX  SGTAP 'RETURN         ','RETURN TO CALLER         ',  @D61NDJKX78822061
               OUTPUT=(RF)                                     @D61NDJK 78837161
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 78852261
         LTORG                                                 @D61NDJK 78867361
         EJECT                                                 @D61NDJK 78882461
*                                                              @D61NDJK 78897561
***************************************************************         78912661
*  FUNCTION                                                    @D61NDJK 78927761
*    PERFORM MESSAGING, IF APPROPRIATE.                        @D61NDJK 78942861
*                                                              @D61NDJK 78957961
*    THERE ARE THREE DIFFERENT KINDS OF MESSAGING              @D61NDJK 78973061
*    NECESSITIES. EITHER MESSAGING HAS TO BE DONE              @D61NDJK 78988161
*    - NEVER                                                   @D61NDJK 79003261
*    - UNCONDITIONAL                                           @D61NDJK 79018361
*    - ONLY IF RECOVERY IS NOT SUCCESSFUL                      @D61NDJK 79033461
*    MESSAGING IS EITHER DONE WHILE WAITING FOR COMPLETION     @D61NDJK 79043461
*    OF RECOVERY I/O OR WHEN RECOVERY HAS BEEN COMPLETED BUT   @D61NDJK 79053461
*    ALWAYS BEFORE THE TERINWRK WITH THE NEW SENSE DATA        @D61NDJK 79063661
*    FOR THE NEW FAILURE IS SET UP.                            @D61NDJK 79078761
*    MESSAGING REQUESTS ARE PASSED TO RESIDENT MESSAGE WRITER  @D61NDJK 79093861
*    SGEMSG THAT ISSUES A WTO REQUEST TO ONE OR MORE CONSOLES  @D61NDJK 79108961
*    AFTER HAVING BUILT THE APPROPRIATE ERROR MESSAGE.         @D61NDJK 79124061
*                                                              @D61NDJK 79139161
*  INPUT                                                       @D61NDJK 79154261
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61NDJK 79169361
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 79184461
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61NDJK 79199561
*    - RB CONTAINS THE ADDRESS OF THE USER'S CCB.              @D61NDJK 79207061
*    - RF CONTAINS THE RECOVERY COMPLETION CODE.               @D61NDJK 79214661
*                                                              @D61NDJK 79229761
*  OUTPUT                                                      @D61NDJK 79244861
*    - NONE. TERFLGMR INDICATES WHAT KIND OF MESSAGING AND     @D61NDJK 79259961
*      RECORDING STILL HAS TO BE DONE.                         @D61NDJK 79275061
*                                                              @D61NDJK 79290161
***************************************************************         79305261
 AGO  .GMSG                                                   *#SECURGL 79320361
.LMSG    AIF ('&TEST'(1,12) NE 'CALL  TERMSG'  ).LLOG         *#SECURGL 79335461
 AIF   ('&I'(2,10) NE '1,2,3,B,F '             ).DSINVC       *#SECURGL 79350561
 AIF   ('&O'(2,4)  EQ 'NONE'                   ).DSHEAD       *#SECURGL 79365661
 AGO  .DSINVC                                                 *#SECURGL 79380761
.GMSG     ANOP                                                *#SECURGL 79395861
.**************************************************************         79410961
TERMSG   SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 79426061
         USING CCBADR,R1                                       @D61NDJK 79441161
         USING ERBLKADR,R2                                     @D61NDJK 79456261
         USING PUBADR,R3                                       @D61NDJK 79471361
 SGTAP  'SGCOV ERPT610',NR=(39,0) TERMSG  ENTERED                TERMSG 79488851
*                                                              @D61NDJK 79501561
*------------------------------------------------------------* @D61NDJK 79516661
*                                                              @D61NDJK 79531761
*   SET UP MESSAGING PARAMETERS IN DEVICE ERROR ENTRY.         @D61NDJK 79546861
*                                                              @D61NDJK 79561961
*------------------------------------------------------------* @D61NDJK 79577061
*                                                              @D61NDJK 79592161
         MVC   ERRQMSG(1),TERMSGID     SET MESSAGE ID          @D61NDJK 79607261
         MVC   ERRQCOMM+2(1),TERCCCWO  SET FAILING COMMAND CODE@D61NDJK 79622361
*                                      MESSAGE MUST..          @D63HDJK 79622362
         TM    TERFLG,TERCVHIG           BE HIGHLIGHTED?       @D63HDJK 79622363
         BZ    TERMS050                NO                      @D63HDJK 79622364
         OI    ERRQPRFL,ERRQHIGH       MESSAGE HIGHLIGHTING    @D63HDJK 79622365
*                                                              @D61NDJK 79637461
*------------------------------------------------------------* @D61NDJK 79667661
*   SET UP 0P..I_C MESSAGE.                                    @D61NDJK 79682761
*------------------------------------------------------------* @D61NDJK 79697861
*                                                              @D61NDJK 79712961
TERMS050 NI    ERRQFLG,XFF-PASSBK-RTYERR-X'40'-IGNERR-SUCCESS  @D63HDJK 79735051
*                                                              @D61NDJK 79743161
*------------------------------------------------------------* @D61NDJK 79758261
*   SET UP 0P..I_I MESSAGE.                                    @D61NDJK 79773361
*------------------------------------------------------------* @D61NDJK 79788461
*                                                              @D61NDJK 79803561
         TM    TEROEFLG,TEROEUCU  USER IS ALREADY POSTED?      @D61NDJK 79833761
         BZ    TERMS100           NO                           @D61NDJK 79848861
*                                                              @D61NDJK 79863961
 SGTAP  'SGCOV ERPT610',NR=(39,1) SET UP 0P..I_I MESSAGE         TERMSG 79886051
         OI    ERRQFLG,IGNERR+SUCCESS  SET UP 0P..I_I MESSAGE  @D61NDJK 79894161
         B     TERMS400                                        @D61NDJK 79909261
*                                                              @D61NDJK 79924361
*------------------------------------------------------------* @D61NDJK 79939461
*   SET UP 0P..I_R MESSAGE.                                    @D61NDJK 79954561
*------------------------------------------------------------* @D61NDJK 79969661
*                                                              @D61NDJK 79984761
TERMS100 LA    R5,TERERUNS        TAKE RECOVERY COMPLETION CODE@D61NDJK 79999861
         CR    RF,R5              RECOVERY FAILED?             @D61NDJK 80014961
         BE    TERMS300           YES                          @D61NDJK 80030061
*                                                              @D61NDJK 80039061
         TM    TERFLG,TERCVOIR    INTERV. REQUIRED CONDITION?  @DA43697 80057151
         BO    TERMS200           YES                          @D61NDJK 80063261
*                                                              @D61NDJK 80075361
 SGTAP  'SGCOV ERPT610',NR=(39,2) SET UP 0P..I_R MESSAGE         TERMSG 80097451
         OI    ERRQFLG,RTYERR+SUCCESS  SET UP 0P..I_R MESSAGE  @D61NDJK 80105561
         B     TERMS400                                        @D61NDJK 80120661
*                                                              @D61NDJK 80135761
*------------------------------------------------------------* @D61NDJK 80150861
*   SET UP 0P..A MESSAGE.                                      @D61NDJK 80165961
*------------------------------------------------------------* @D61NDJK 80181061
*                                                              @D61NDJK 80196161
TERMS200 OI    ERRQFLG,RTYERR+X'40'    SET UP 0P..A MESSAGE    @D61NDJK 80221251
 SGTAP  'SGCOV ERPT610',NR=(39,3) SET UP 0P..A MESSAGE           TERMSG 80231241
         B     TERMS400                                        @D61NDJK 80241461
*                                                              @D61NDJK 80256561
*------------------------------------------------------------* @D61NDJK 80271661
*   SET UP 0P..I_P MESSAGE.                                    @D61NDJK 80286761
*------------------------------------------------------------* @D61NDJK 80301861
*                                 USER ACCEPTS IRRECOVERABLE.. @D61SDJK 80326951
TERMS300 TM    CCBCOM1-CCBADR(RB),ACCUNRIO     I/O ERROR?      @D61SDJK 80336941
         BO    TERMS350           YES                          @D61NDJK 80347161
 SGTAP  'SGCOV ERPT610',NR=(39,4) USER HAS NOT SET ACCUNRIO      TERMSG 80369251
         TM    TERFLGPS,TERPSRDC  IT IS A READ DATA            @D61NDJK 80377361
         BZ    TERMS400             CHECK THAT SHALL..         @D61SDJK 80402451
         TM    CCBCOM1-CCBADR(RB),X'02'   BE RETURNED?         @D61SDJK 80412441
         BZ    TERMS400           NO, TAKE 0P..I_C MESSAGE     @D61NDJK 80422661
*                                                              @D61NDJK 80437761
TERMS350 OI    ERRQFLG,IGNERR+PASSBK   SET UP 0P..I_P MESSAGE  @D61NDJK 80452861
 SGTAP  'SGCOV ERPT610',NR=(39,5) SET UP 0P..I_P MESSAGE         TERMSG 80474951
*                                                              @D61NDJK 80483061
*------------------------------------------------------------* @D61NDJK 80498161
*                                                              @D61NDJK 80513261
*   CHECK IF MESSAGING IS REQUIRED.                            @D61NDJK 80528361
*                                                              @D61NDJK 80543461
*------------------------------------------------------------* @D61NDJK 80558561
*                                                              @D61NDJK 80573661
TERMS400 TM    TEROEFLG,TEROEMEL  IT IS A REC. ONLY REQUEST?   @D61NDJK 80588761
         BO    TERMSEX            YES                          @D61NDJK 80603861
*                                                              @D61SDJK 80604861
         CLC   TERCHQID,=AL2(SVTTID) SERVICE TASK REQUEST      @D66ODOW 80605861
         BNE   TERMS450           NO                           @D61SDJK 80606861
         TM    TEROEFLG,TEROESNS  USER DECLINES MESSAGING?     @D61SDJK 80607861
         BZ    TERMS450           NO                           @D61SDJK 80608861
         TM    TERFLGPS,TERPSMSG  MESSAGE MUST BE ISSUED?      @D61SDJK 80609861
         BZ    TERMSEX            NO                           @D61SDJK 80610861
*                                 UNCONDITIONAL..              @D61NDJK 80618961
TERMS450 TM    TERFLGMR,TERMRIM     MESSAGING IS REQUIRED?     @D61SDJK 80641051
         BO    TERMS500           YES                          @D61NDJK 80649161
 SGTAP  'SGCOV ERPT610',NR=(39,6) NO UNCOND. MESSAGING REQUIRED  TERMSG 80671251
         TM    TERFLGMR,TERMRCM   COND. MESSAGING IS REQUIRED? @D61NDJK 80679361
         BZ    TERMSEX            NO                           @D61NDJK 80694461
         LA    R5,TERERUNS        TAKE RECOVERY COMPLETION CODE@D61NDJK 80709561
         CR    RF,R5              MESSAGING IS REQUIRED?       @D61NDJK 80724661
         BNE   TERMSEX            NO                           @D61NDJK 80739761
*                                                              @D61NDJK 80754861
*------------------------------------------------------------* @D61NDJK 80769961
*                                                              @D61NDJK 80785061
*   CALL SGEMSG FOR MESSAGING AND RESTORE WORK ENVIRONMENT.    @D61NDJK 80800161
*                                                              @D61NDJK 80815261
*------------------------------------------------------------* @D61NDJK 80830361
*                                                              @D61NDJK 80845461
TERMS500 STM   R0,RF,TERTERSV     SAVE ALL REGISTERS           @D61NDJK 80860561
         ST    RA,TERSVGLB        SAVE ACTUAL WORK AREA ADDRESS@D61NDJK 80875661
*                                                              @D61NDJK 80890761
*------------------------------------------------------------* @D61NDJK 80909561
*   TRANSFER CONTROL TO SGEMSG.                                @D61NDJK 80980261
*------------------------------------------------------------* @D61NDJK 80983761
*                                                              @D61NDJK 80987261
         LR    R5,R2              PROVIDE ERROR ENTRY POINTER  @D61NDJK 80990761
         L     RF,TERLINK         ESTABLISH LINKAGE TO..       @D61SDJK 80996251
         USING TERLNKG,RF           SUPERVISOR PART OF..       @D61SDJK 80998241
         L     RB,TERMSERB          SGTAP AND RETURN IN..      @D61SDJK 81000231
         L     RF,TERMSEMS          ORDER TO WRITE A MESSAGE   @D61SDJK 81002221
         AMODESW CALL,AMODE=24,REGS=(RE,RF)  ==============>>> @D61SDJK 81004211
         DROP  RA,RC,RF                                        @D61SDJK 81006201
*                                                              @D61NDJK 81008261
*------------------------------------------------------------* @D61NDJK 81011761
*   RESTORE WORK ENVIRONMENT.                                  @D61NDJK 81015261
*------------------------------------------------------------* @D61NDJK 81018761
*                                                              @D61NDJK 81022261
         USING *,RE               REESTABLISH..                @D61NDJK 81025761
         L     RA,TERSVGLB          ADDRESSABILITY..           @D61SDJK 81033251
         DROP  RE                   OF GLOBAL..                @D61NDJK 81037241
         USING TERGLOB,RA           WORK AREA                  @D61NDJK 81041761
         LM    R0,RF,TERTERSV     RESTORE ALL REGISTERS        @D61NDJK 81056861
         USING TERMSG,RC                                       @D61NDJK 81071961
*                                                              @D61NDJK 81132361
*------------------------------------------------------------* @D61NDJK 81147461
*                                                              @D61NDJK 81162561
*   EXIT HANDLING.                                             @D61NDJK 81177661
*                                                              @D61NDJK 81192761
*------------------------------------------------------------* @D61NDJK 81207861
*                                                              @D61NDJK 81211561
         NI    TERFLGMR,XFF-TERMRIM-TERMRCM  MESSAGING IS DONE @D61NDJK 81215261
 SGTAP  'SGCOV ERPT610',NR=(39,7) MESSAGING WAS DONE             TERMSG 81220951
*                                                              @D61NDJK 81222961
TERMSEX  SGTAP 'RETURN         ','RETURN TO CALLER         '   @D61NDJK 81238061
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 81253161
*                                                              @D61NDJK 81268261
*------------------------------------------------------------* @D61NDJK 81283361
*                                                              @D61NDJK 81298461
*   LOCAL VARIABLES USED IN TERMSG                             @D61NDJK 81313561
*                                                              @D61NDJK 81328661
*------------------------------------------------------------* @D61NDJK 81343761
*                                                              @D61NDJK 81358861
TERSVGLB DC   A(0)                SAVE AREA FOR..              @D61SDJK 81380951
*                                   ACTUAL GLOBAL WORK AREA    @D61NDJK 81389061
         LTORG                                                 @D61NDJK 81404161
         EJECT                                                 @D61NDJK 81419261
*                                                              @D61NDJK 81434361
***************************************************************         81449461
*  FUNCTION                                                    @D61NDJK 81464561
*    PERFORM RECORDING, IF APPROPRIATE.                        @D61NDJK 81479661
*                                                              @D61NDJK 81494761
*    THERE ARE THREE DIFFERENT KINDS OF RECORDING              @D61NDJK 81509861
*    NECESSITIES. EITHER RECORDING HAS TO BE DONE              @D61NDJK 81524961
*    - NEVER                                                   @D61NDJK 81540061
*    - UNCONDITIONAL                                           @D61NDJK 81555161
*    - ONLY IF RECOVERY IS NOT SUCCESSFUL                      @D61NDJK 81570261
*    RECORDING IS ONLY DONE WHEN RECOVERY HAS BEEN COMPLETED   @D61NDJK 81585361
*    BUT ALWAYS BEFORE THE TERINWRK WITH THE NEW SENSE DATA    @D61NDJK 81600461
*    FOR THE NEW FAILURE IS SET UP.                            @D61NDJK 81615561
*    IF WE WANT TO HAVE SOME RECORDING DONE, SGTAP ALLOCATES   @D61NDJK 81630661
*    A FREE WORK ERROR ENTRY. IF NO WORK ERROR ENTRY COULD BE  @D61NDJK 81645761
*    ALLOCATED, RECORDING IS SKIPPED. IF THE ALLOCATION WAS    @D61NDJK 81660861
*    SUCCESSFUL, THE ORIGINAL DEVICE ERROR ENTRY IS COPIED     @D61NDJK 81675961
*    INTO THE WORK ERROR ENTRY AND IS QUEUED TO THE ERP        @D61NDJK 81691061
*    ERROR CHAIN FOR LATER ASYNCHRONOUS PROCESSING.            @D61NDJK 81706161
*                                                              @D61NDJK 81721261
*  INPUT                                                       @D61NDJK 81736361
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61NDJK 81751461
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 81766561
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61NDJK 81781661
*    - RF CONTAINS THE RECOVERY COMPLETION CODE.               @D61NDJK 81796761
*                                                              @D61NDJK 81811861
*  OUTPUT                                                      @D61NDJK 81826961
*    - NONE. TERFLGMR INDICATES WHAT KIND OF MESSAGING AND     @D61NDJK 81842061
*      RECORDING STILL HAS TO BE DONE.                         @D61NDJK 81857161
*                                                              @D61NDJK 81872261
***************************************************************         81887361
 AGO  .GLOG                                                   *#SECURGL 81902461
.LLOG    AIF ('&TEST'(1,12) NE 'CALL  TERLOG'  ).LALLOC       *#SECURGL 81917561
 AIF   ('&I'(2,8)  NE '1,2,3,F '               ).DSINVC       *#SECURGL 81932661
 AIF   ('&O'(2,4)  EQ 'NONE'                   ).DSHEAD       *#SECURGL 81947761
 AGO  .DSINVC                                                 *#SECURGL 81962861
.GLOG     ANOP                                                *#SECURGL 81977961
.**************************************************************         81993061
TERLOG   SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 82008161
         USING CCBADR,R1                                       @D61NDJK 82023261
         USING ERBLKADR,R2                                     @D61NDJK 82038361
         USING PUBADR,R3                                       @D61NDJK 82053461
 SGTAP  'SGCOV ERPT610',NR=(40,0) TERLOG  ENTERED                TERLOG 82075551
*------------------------------------------------------------* @D61NDJK 82083661
*                                                              @D61NDJK 82098761
*   DO RECORDING, IF REQUIRED.                                 @D61NDJK 82113861
*                                                              @D61NDJK 82128961
*------------------------------------------------------------* @D61NDJK 82144061
*                                                              @D61NDJK 82159161
*------------------------------------------------------------* @D61NDJK 82174261
*  OBTAIN A FREE WORK ERROR ENTRY, IF RECORDING IS REQUIRED    @D61NDJK 82184261
*  AND IS MEANINGFUL.                                          @D61NDJK 82194261
*------------------------------------------------------------* @D61NDJK 82204461
*                                                              @D61NDJK 82219561
         ASYSCOM (R7)             ESTABLISH..                  @D61SDJK 82229041
         USING SYSCOM,R7            ADDRESSABILITY OF SYSCOM   @D61SDJK 82230031
         TM    IJBFLG08,IJBSAENV  SA ENVIRONMENT               @D61NDJK 82231021
         BO    TERLOEX            YES                          @D61NDJK 82234561
         DROP  R7                 RESTORE ORIGINAL ERROR..     @D61SDJK 82242851
TERLO100 L     R2,2*4(RD)           ENTRY ADDRESS AND..        @D61SDJK 82243641
         L     RF,15*4(RD)          RECOVERY COMPLETION CODE   @D61SDJK 82244431
         TM    TERFLGMR,TERMRA3   A3 RECORDING IS REQUIRED?    @D61SDJK 82246011
         BNZ   TERLO150           YES                          @D61SDJK 82246801
         TM    TERFLGMR,TERMRMDR  MDR RECORDING IS REQUIRED?   @D61SDJK 82248381
         BNZ   TERLO150           YES                          @D61NDJK 82249761
 SGTAP  'SGCOV ERPT610',NR=(40,1) NO MDR RECORDING IS REQUIRED   TERLOG 82271851
         TM    TERFLGMR,TERMROBR  RECORDING MIGHT BE REQUIRED? @D61NDJK 82279961
         BZ    TERLOEX            NO, EXIT W/O RECORDING       @D61NDJK 82295061
 SGTAP  'SGCOV ERPT610',NR=(40,2) OBR RECORDING MAY BE REQUIRED  TERLOG 82317151
         TM    TERFLGMR,TERMRCR   COND. RECORDING IS REQUIRED? @D61NDJK 82325261
         BZ    TERLO150           NO                           @D61NDJK 82340361
         LA    R5,TERERUNS        TAKE RECOVERY COMPLETION CODE@D61NDJK 82355461
         CR    RF,R5              RECORDING IS REQUIRED?       @D61NDJK 82370561
         BNE   TERLOEX            NO                           @D61NDJK 82385661
 SGTAP  'SGCOV ERPT610',NR=(40,3) OBR RECORDING IS REQUIRED      TERLOG 82407751
*                                                              @D61NDJK 82415861
TERLO150 DS    0H                                              @D61NDJK 82430961
 SGTAP  'CALL  TERALLOC        ','ALLOCATE WORK ERROR ENTRY',  @D61NDJKX82446061
               I='NONE              ON RETURN+4',              @D61NDJKX82461161
               O='F                 RF POINTS TO ENTRY',       @D61NDJKX82476261
               E0='TERLOEX          ERROR:NO ENTRY AVAILABLE'  @D61NDJK 82491361
*                                                              @D61NDJK 82506461
 SGTAP  'SGCOV ERPT610',NR=(40,4) WORK ERROR ENTRY IS ALLOCATED  TERLOG 82528551
         MVC   0(L'TERINWRK,RF),0(R2)  PREPARE WORK ERROR..    @D61NDJK 82536661
         LR    R2,RF                     ENTRY FOR PROCESSING  @D61NDJK 82551761
*                                                              @D61SDJK 82552761
         MVI   ERRQCCB,X'FF'      RECORDING REQUESTS..         @D63HDJK 82554761
         XC    ERRQCHQA(4),ERRQCHQA MUST BE PROCESSED..        @DA43606 82557761
         OI    ERRQFLG,RECONLY      ASYNCHRONOUSLY             @DA43606 82560761
*                                                              @D61SDJK 82561761
         NI    ERRQERPF,XFF-ERRQPSIR   CLEAR RECORDING FLAGS   @D61SDJK 82562761
         NI    ERRQERPF,XFF-ERRQPMDR-ERRQPT91                  @D61SDJK 82563761
         NI    ERRQERPF,XFF-ERRQPOBR-ERRQPPER-ERRQPTEM         @D61SDJK 82564761
*                                                              @D61NDJK 82566861
*------------------------------------------------------------* @D61NDJK 82581961
*  PREPARE RECORDING OF AN A3, OBR, OR MDR, RESPECTIVELY.      @D61SDJK 82604051
*------------------------------------------------------------* @D61NDJK 82612161
*                                                              @D61NDJK 82627261
         TM    TERFLGMR,TERMRMDR  RECORD TO BE LOGGED IS A MDR?@D61NDJK 82642361
         BNZ   TERLO200           YES                          @D61NDJK 82657461
         TM    TERFLGMR,TERMRA3   RECORD TO BE LOGGED IS AN A3?@D61SDJK 82662461
         BNZ   TERLO250           YES                          @D61SDJK 82667461
*                                                              @D61NDJK 82672561
 SGTAP  'CALL  TEROBR          ','PREPARE OBR RECORD',         @D61NDJKX82687661
               I='1,2,3             ON RETURN+4',              @D61NDJKX82702761
               O='NONE              OBR RECORD IS PREPARED',   @D61NDJKX82717861
               E0='TERLO400         ERROR: NO RECORD PREPARED' @D61NDJK 82732961
*                                                              @D61NDJK 82748061
 SGTAP  'SGCOV ERPT610',NR=(40,5) OBR RECORD IS PREPARED         TERLOG 82770151
         B     TERLO300                                        @D61NDJK 82778261
*                                                              @D61NDJK 82793361
TERLO200 DS    0H                                              @D61NDJK 82808461
 SGTAP  'CALL  TERMDR          ','PREPARE MDR RECORD',         @D61NDJKX82823561
               I='2,3               ON RETURN+4',              @D61NDJKX82838661
               O='NONE              MDR RECORD IS PREPARED',   @D61NDJKX82853761
               E0='TERLO400         ERROR: NO RECORD PREPARED' @D61NDJK 82868861
*                                                              @D61NDJK 82883961
 SGTAP  'SGCOV ERPT610',NR=(40,6) MDR RECORD IS PREPARED         TERLOG 82902051
         B     TERLO300                                        @D61SDJK 82905041
*                                                              @D61SDJK 82908031
TERLO250 DS    0H                                              @D61SDJK 82911021
 SGTAP  'CALL  TERA3           ','PREPARE A3 RECORD',          @D61SDJKX82914011
               I='1,2,3             ON RETURN+4',              @D61SDJKX82917001
               O='NONE              A3 RECORD IS PREPARED',    @D61SDJKX82919991
               E0='TERLO400         ERROR: NO RECORD PREPARED' @D61SDJK 82922981
*                                                              @D61SDJK 82925971
*------------------------------------------------------------* @D61NDJK 82929261
*  ENQUEUE WORK ERROR ENTRY INTO ERP ERROR CHAIN.              @D61NDJK 82944361
*------------------------------------------------------------* @D61NDJK 82959461
*                                                              @D61NDJK 82974561
TERLO300 DS    0H                                              @D61NDJK 82989661
 SGTAP  'CALL  TERERP          ','ON RETURN WORK ERROR',       @D61NDJKX83004761
               I='2                 ENTRY IS ENQUEUED',        @D61NDJKX83019861
               O='NONE              IN ERP ERROR CHAIN'        @D61NDJK 83034961
*                                                              @D61NDJK 83065161
         B     TERLO100           DO FURTHER RECORDING         @D61NDJK 83080261
*                                                              @D61NDJK 83081861
*------------------------------------------------------------* @D61NDJK 83083461
*  DEACTIVATE WORK ERROR ENTRY IF RECORD COULDN'T BE PREPARED. @D61NDJK 83085061
*------------------------------------------------------------* @D61NDJK 83086661
*                                                              @D61NDJK 83088261
TERLO400 XC    ERBLKPTR,ERBLKPTR  DEQUEUE AND DEACTIVATE..     @D61NDJK 83089861
         NI    ERBLKFLG,XFF-ERQUEUED-ERACTIVE WORK ERROR ENTRY @D61NDJK 83091461
         NI    ERBLKFL1,XFF-NEEDERP ERP IS NOT REQUIRED ANYMORE@D61SDJK 83092461
 SGTAP  'SGCOV ERPT610',NR=(40,7) WORK ERROR ENTRY IS FREED      TERLOG 83094051
*                                                              @D61NDJK 83095361
*------------------------------------------------------------* @D61NDJK 83110461
*                                                              @D61NDJK 83125561
*   EXIT HANDLING.                                             @D61NDJK 83140661
*                                                              @D61NDJK 83155761
*------------------------------------------------------------* @D61NDJK 83170861
*                                                              @D61NDJK 83185961
TERLOEX  SGTAP 'RETURN         ','RETURN TO CALLER         '   @D61NDJK 83201061
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 83216161
         LTORG                                                 @D61NDJK 83231261
         EJECT                                                 @D61NDJK 83246361
*                                                              @D61NDJK 83261461
***************************************************************         83276561
* FUNCTION                                                     @D61NDJK 83291661
*    OBTAIN AN ERROR ENTRY FROM A NUMBER OF WORK ERROR         @D61NDJK 83306761
*    ENTRIES. THESE ERROR ENTRIES ARE USED FOR ASYNCHRONOUS    @D61NDJK 83321861
*    RECORDING.                                                @D61NDJK 83336961
*                                                              @D61NDJK 83352061
* INPUT                                                        @D61NDJK 83367161
*    - NONE                                                    @D61NDJK 83382261
*                                                              @D61NDJK 83397361
* OUTPUT ON RETURN TO RETURN+0                                 @D61NDJK 83412461
*    - NONE. NO WORK ERROR ENTRY AVAILABLE.                    @D61NDJK 83427561
*                                                              @D61NDJK 83442661
* OUTPUT ON RETURN TO RETURN+4                                 @D61NDJK 83457761
*    - RF CONTAINS AN ADDRESS OF A FREE WORK ERROR ENTRY.      @D61NDJK 83472861
*                                                              @D61NDJK 83487961
***************************************************************         83503061
 AGO  .GALLOC                                                 *#SECURGL 83518161
.LALLOC  AIF ('&TEST'(1,14) NE 'CALL  TERALLOC').LMDR         *#SECURGL 83533261
 AIF   ('&I'(2,4)  NE 'NONE'                   ).DSINVC       *#SECURGL 83548361
 AIF   ('&O'(2,2)  NE 'F '                     ).DSINVC       *#SECURGL 83563461
 AIF   (T'&E0      NE 'O'                      ).DSHEAD       *#SECURGL 83578561
 AGO  .DSINVC                                                 *#SECURGL 83593661
.GALLOC   ANOP                                                *#SECURGL 83608761
.**************************************************************         83623861
TERALLOC SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 83638961
 SGTAP  'SGCOV ERPT610',NR=(41,0) TERALLOC ENTERED             TERALLOC 83661051
*                                                              @D61NDJK 83669161
*------------------------------------------------------------* @D61NDJK 83684261
*                                                              @D61NDJK 83699361
*   ATTEMPT TO ACQUIRE A WORK ERROR ENTRY FOR ASYNCHRONOUS     @D61NDJK 83714461
*   RECORDING.                                                 @D61NDJK 83729561
*                                                              @D61NDJK 83744661
*------------------------------------------------------------* @D61NDJK 83759761
*                                                              @D61NDJK 83774861
         L     RF,TERLINK         ESTABLISH LINKAGE TO..       @D61SDJK 83795951
         USING TERLNKG,RF           SUPERVISOR PART OF..       @D61SDJK 83801941
         LA    R5,TERAEB            SGTAP AND POINT TO..       @D61SDJK 83807931
         USING ERBLKADR,R5          FIRST WORK ERROR ENTRY     @D61SDJK 83813921
         LA    R8,ERBLKHDL+L'ERRQ TAKE LENGTH OF AN ERROR ENTRY@D61NDJK 83820161
         LA    R9,TERAEBE         POINT TO LAST ERROR ENTRY    @D61NDJK 83835261
         DROP  RF                                              @D61SDJK 83842261
*                                                              @D61NDJK 83850361
TERAL100 TM    ERBLKFLG,ERACTIVE  CURRENT ENTRY IS INACTIVE?   @D61NDJK 83865461
         BNO   TERAL150           YES                          @D61NDJK 83880561
*                                 POINT TO NEXT ERROR ENTRY..  @D61NDJK 83895661
         BXLE  R5,R8,TERAL100       IF LAST ONE IS NOT REACHED @D61NDJK 83910761
*                                                              @D61NDJK 83925861
         B     TERALEX0           NO ERROR ENTRY IS AVAIALBLE  @D61NDJK 83940961
*                                                              @D61NDJK 83956061
TERAL150 LR    RF,R5              RETURN ADDRESS OF..          @D61NDJK 83971161
         B     TERALEX4             FREE WORK ERROR ENTRY      @D61NDJK 83986261
*                                                              @D61NDJK 84001361
*------------------------------------------------------------* @D61NDJK 84016461
*                                                              @D61NDJK 84031561
*   EXIT HANDLING.                                             @D61NDJK 84046661
*                                                              @D61NDJK 84061761
*------------------------------------------------------------* @D61NDJK 84076861
*                                                              @D61NDJK 84091961
*------------------------------------------------------------* @D61NDJK 84107061
*   ERROR EXIT.                                                @D61NDJK 84122161
*------------------------------------------------------------* @D61NDJK 84137261
*                                                              @D61NDJK 84152361
TERALEX0 DS    0H                                              @D61NDJK 84167461
 SGTAP  'SGCOV ERPT610',NR=(41,1) NO ERROR ENTRY IS AVAILABLE  TERALLOC 84189551
         SGTAP 'RETURN         ','RETURN TO CALLER         '   @D61NDJK 84197661
*                                                              @D61NDJK 84227861
*------------------------------------------------------------* @D61NDJK 84242961
*   NORMAL EXIT.                                               @D61NDJK 84258061
*------------------------------------------------------------* @D61NDJK 84273161
*                                                              @D61NDJK 84288261
TERALEX4 DS    0H                                              @D61NDJK 84303361
         SGTAP 'RETURN4        ','RETURN TO CALLER         ',  @D61NDJKX84318461
               OUTPUT=(RF)                                     @D61NDJK 84333561
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 84428651
         LTORG                                                 @D61NDJK 84514761
         EJECT                                                 @D61NDJK 84529861
*                                                              @D61NDJK 84544961
***************************************************************         84560061
*  FUNCTION                                                    @D61NDJK 84575161
*     PREPARE AN MDR RECORD FOR ASYNCHRONOUS RECORDING.        @D61NDJK 84590261
*                                                              @D61NDJK 84605361
*  INPUT                                                       @D61NDJK 84620461
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 84635561
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61NDJK 84650661
*                                                              @D61NDJK 84665761
*  OUTPUT ON RETURN TO RETURN+0                                @D61NDJK 84680861
*    - NONE. MDR RECORD COULD NOT BE PREPARED.                 @D61NDJK 84695961
*                                                              @D61NDJK 84711061
*  OUTPUT ON RETURN TO RETURN+4                                @D61NDJK 84726161
*    - NONE. MDR RECORD IS PREPARED FOR ASYNCHRONOUS           @D61NDJK 84741261
*      RECORDING.                                              @D61NDJK 84756361
*                                                              @D61NDJK 84771461
***************************************************************         84786561
 AGO  .GMDR                                                   *#SECURGL 84801661
.LMDR    AIF ('&TEST'(1,12) NE 'CALL  TERMDR'  ).LOBR         *#SECURGL 84816761
 AIF   ('&I'(2,4)  NE '2,3 '                   ).DSINVC       *#SECURGL 84831861
 AIF   ('&O'(2,4)  NE 'NONE'                   ).DSINVC       *#SECURGL 84846961
 AIF   (T'&E0      NE 'O'                      ).DSHEAD       *#SECURGL 84862061
 AGO  .DSINVC                                                 *#SECURGL 84877161
.GMDR     ANOP                                                *#SECURGL 84892261
.**************************************************************         84907361
TERMDR   SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 84922461
         USING ERBLKADR,R2                                     @D61NDJK 84937561
         USING PUBADR,R3                                       @D61NDJK 84952661
 SGTAP  'SGCOV ERPT610',NR=(42,0) TERMDR ENTERED                 TERMDR 84974751
*                                                              @D61NDJK 84982861
*------------------------------------------------------------* @D61NDJK 84997961
*                                                              @D61NDJK 85013061
*   ALLOCATE MDR WORK AREA IN SYSTEM GETVIS AREA.              @D61NDJK 85028161
*                                                              @D61NDJK 85043261
*------------------------------------------------------------* @D61NDJK 85058361
*                                                              @D61NDJK 85073461
*------------------------------------------------------------* @D61NDJK 85088561
*   ISSUE GETVIS REQUEST AND RESTORE WORK ENVIRONMENT.         @D61NDJK 85103661
*------------------------------------------------------------* @D61NDJK 85118761
*                                                              @D61NDJK 85133861
         LA    R0,TERMDWAL        PROVIDE LENGTH OF WORK AREA  @D61NDJK 85148961
*                                                              @D61NDJK 85164061
         MVC   TERMDSID(4),TERMDPFX  SET UP..                  @D61NDJK 85179161
         STH   R3,TERMDSID+4           GETVIS SUBPOOL ID       @D61NDJK 85194261
*                                                              @D61NDJK 85209361
         LR    R5,RA              SAVE WORK AREA POINTER       @D61NDJK 85219361
         DROP  RA                 RELEASE OLD WORK AREA POINTER@D61NDJK 85222661
         USING TERGLOB,R5         TAKE NEW WORK AREA POINTER   @D61NDJK 85225961
         SLR   R7,R7              ESTABLISH..                  @D61SDJK 85226961
         USING SYSS00,R7            LOW CORE ADDRESSABILITY    @D61SDJK 85227961
         L     RA,TCBPTR          PROVIDE SGETVIS SAVE AREA    @D61NDJK 85229361
         DROP  R7                                              @D61SDJK 85234361
*                                                              @D61NDJK 85239561
         SGETVIS LENGTH=(R0),PFIX=YES,SPID=TERMDSID,LOC=BELOW, @D61SDJKX85261651
               ADDRESS=TERMDWAA,PAGE=YES                       @D61NDJK 85269761
*                                                              @D61NDJK 85284861
         LR    RA,R5              RESTORE WORK AREA POINTER    @D61NDJK 85299961
         DROP  R5                 RELEASE OLD WORK AREA POINTER@D61NDJK 85304961
         USING TERGLOB,RA         TAKE NEW WORK AREA POINTER   @D61NDJK 85309961
*                                                              @D61NDJK 85315061
         LTR   RF,RF              MDR WORK AREA IS ALLOCATED?  @D61NDJK 85330161
         BNZ   TERMDEX0           NO                           @D61NDJK 85345261
 SGTAP  'SGCOV ERPT610',NR=(42,1) GETVIS REQUEST WAS SUCCESSFUL  TERMDR 85367351
*                                                              @D61NDJK 85375461
*------------------------------------------------------------* @D61NDJK 85390561
*                                                              @D61NDJK 85405661
*   SET UP MDR RECORD.                                         @D61NDJK 85420761
*                                                              @D61NDJK 85435861
*------------------------------------------------------------* @D61NDJK 85450961
*                                                              @D61NDJK 85466061
         L     R6,TERMDWAA        ESTABLISH ADDRESSABILITY..   @D61NDJK 85481161
         USING TERMDWA,R6           TO MDR WORK AREA           @D61NDJK 85496261
*                                                              @D61NDJK 85511361
         XC    TERMDWA(256),TERMDWA    CLEAR MDR WORK AREA     @D61SDJK 85531451
         XC    TERMDWA+256(TERMDWAL-256),TERMDWA+256           @D61SDJK 85536441
*                                                              @D61NDJK 85541561
         MVC   TERMDPTR(4),TERMDWAA  SET MDR WORK AREA ADDRESS @D61NDJK 85556661
*                                                              @D61NDJK 85571761
         MVC   TERMDDD1(32),ERRQSNS  SET DEVICE DEPENDENT DATA @D61NDJK 85586861
         LA    R7,TERMDLE1-TERMDHDL                            @D61SDJK 85606951
         STCM  R7,3,TERMDLEN      SET LENGTH OF MDR RECORD     @D61SDJK 85611941
*                                                              @D61NDJK 85617061
         TM    TERFLGPS,TERPSRBL  READ BUFFERED LOG WAS DONE?  @D61SDJK 85639151
         BZ    TERMD100           NO                           @D61NDJK 85647261
*                                                              @D61NDJK 85662361
         L     RF,TERLINK         ESTABLISH LINKAGE TO..       @D61SDJK 85681441
         USING TERLNKG,RF           SUPERVISOR PART OF..       @D61SDJK 85683431
         LA    R9,TERRBLDA          SGTAP AND GET POINTER..    @D61SDJK 85685421
         DROP  RF                   TO BUFFERED LOG DATA       @D61SDJK 85687411
         MVC   TERMDDD1(32),0(R9) COPY READ BUFFERED LOG DATA  @D61SDJK 85689401
         CLI   TERRBLLN+1,32      ONLY 32 LOG BYTES WERE READ? @D61NDJK 85692561
         BE    TERMD100           YES                          @D61NDJK 85707661
*                                                              @D61NDJK 85722761
         MVC   TERMDDD1(64),0(R9) COPY READ BUFFERED LOG DATA  @D61SDJK 85743841
         LA    R7,TERMDLE2-TERMDHDL                            @D61SDJK 85746831
         STCM  R7,3,TERMDLEN      SET LENGTH OF MDR RECORD     @D61SDJK 85749821
         CLI   TERRBLLN+1,64      ONLY 64 LOG BYTES WERE READ? @D61SDJK 85752811
         BE    TERMD100           YES                          @D61SDJK 85755801
*                                                              @D61SDJK 85758791
         MVC   TERMDDD1(256),0(R9) COPY READ BUFFERED LOG DATA @D61SDJK 85764771
         LA    R7,TERMDWAL-TERMDHDL                            @D61SDJK 85767761
         STCM  R7,3,TERMDLEN      SET LENGTH OF MDR RECORD     @D61SDJK 85770751
 SGTAP  'SGCOV ERPT610',NR=(42,2) BUFFERED LOG DATA ARE SET      TERMDR 85773741
*                                                              @D61NDJK 85783161
TERMD100 MVC   TERMDCUU(2),PUBCHANN  SET CUU OF FAILING DEVICE @D61NDJK 85798261
*                                                              @D61NDJK 85813361
         L     R5,TERAPUB2        GET PUB2 POINTER             @D61SDJK 85858451
         USING PUB2ADR,R5         DECLARE PUB2 BASE            @D61NDJK 85903961
         MVC   TERMDVS(6),P2TVOL  SET VOLUME SERIAL NUMBER     @D61NDJK 85919061
         CLC   TERMDVS(6),TERMDVS0  VOLSER NUMBER IS PRINTABLE?@D61NDJK 85934161
         BNE   TERMD150           YES                          @D61NDJK 85949261
*                                                              @D61NDJK 85964361
         MVC   TERMDVS(6),TERMDVSB  FILL VOLSER NO WITH BLANKS @D61NDJK 85979461
 SGTAP  'SGCOV ERPT610',NR=(42,3) VOLSER IS NOW PRINTABLE        TERMDR 85999551
*                                                              @D61NDJK 86009661
TERMD150 MVC   TERMDBLL(2),P2TBLK SET BLOCK LENGTH             @D61NDJK 86024761
         DROP  R5                 RELEASE PUB2 BASE            @D61NDJK 86039861
*                                                              @D61NDJK 86054961
*------------------------------------------------------------* @D61NDJK 86070061
*                                                              @D61NDJK 86085161
*   WORK ERROR ENTRY CAN BE PASSED TO TRANSIENT.               @D61NDJK 86100261
*                                                              @D61NDJK 86115361
*------------------------------------------------------------* @D61NDJK 86130461
*                                                              @D61NDJK 86145561
         OI    ERRQERPF,ERRQPMDR  INDICATE MDR RECORDING       @D61NDJK 86160661
*                                                              @D61NDJK 86175761
         TM    TERFLGMR,TERMR90M  IT SHALL BE A TYPE 90 MDR?   @D61NDJK 86190861
         BO    TERMD200           YES                          @D61NDJK 86205961
*                                                              @D61NDJK 86221061
         OI    ERRQERPF,ERRQPT91  INDICATE A TYPE 91 MDR       @D61NDJK 86236161
 SGTAP  'SGCOV ERPT610',NR=(42,4) A TYPE 91 MDR IS INDICATED     TERMDR 86258251
*                                                              @D61NDJK 86266361
TERMD200 MVC   ERRQCOMM,TERMDWAA  SET UP MDR WORK AREA ADDRESS @D61NDJK 86281461
         NI    TERFLGMR,XFF-TERMRMDR   MDR RECORD IS PREPARED  @D61NDJK 86296561
         B     TERMDEX4                                        @D61NDJK 86311661
*                                                              @D61NDJK 86326761
*------------------------------------------------------------* @D61NDJK 86341861
*                                                              @D61NDJK 86356961
*   EXIT HANDLING.                                             @D61NDJK 86372061
*                                                              @D61NDJK 86387161
*------------------------------------------------------------* @D61NDJK 86402261
*                                                              @D61NDJK 86417361
*------------------------------------------------------------* @D61NDJK 86432461
*   ERROR EXIT.                                                @D61NDJK 86447561
*------------------------------------------------------------* @D61NDJK 86462661
*                                                              @D61NDJK 86477761
TERMDEX0 DS    0H                                              @D61NDJK 86492861
 SGTAP  'SGCOV ERPT610',NR=(42,5) GETVIS REQUEST FAILED          TERMDR 86514951
         SGTAP 'RETURN         ','RETURN TO CALLER         '   @D61NDJK 86523061
*                                                              @D61NDJK 86553261
*------------------------------------------------------------* @D61NDJK 86568361
*   NORMAL EXIT.                                               @D61NDJK 86583461
*------------------------------------------------------------* @D61NDJK 86598561
*                                                              @D61NDJK 86613661
TERMDEX4 SGTAP 'RETURN4        ','RETURN TO CALLER         '   @D61NDJK 86628761
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 86643861
*                                                              @D61NDJK 86658961
*------------------------------------------------------------* @D61NDJK 86674061
*                                                              @D61NDJK 86689161
*   LOCAL VARIABLES USED IN TERMDR                             @D61NDJK 86704261
*                                                              @D61NDJK 86719361
*------------------------------------------------------------* @D61NDJK 86734461
*                                                              @D61NDJK 86749561
TERMDVS0 DC    XL6'00'            THESE FIELDS HELP TO MAKE    @D61NDJK 86764661
TERMDVSB DC    XL6'404040404040'  THE VOLSER NO. PRINTABLE     @D61NDJK 86779761
*------------------------------------------------------------* @D61NDJK 86794861
TERMDPFX DC   C'IMDR'             FIRST 4 CHARACTERS OF GETVIS @D61NDJK 86809961
*                                 SUBPOOL ID FOR MDR RECORDING @D61NDJK 86825061
*                                 REQUESTS                     @D61NDJK 86840161
.TPNOC01 ANOP                                                  @D61SDJK 86847161
*------------------------------------------------------------* @D61NDJK 86855261
*                                                              @D61NDJK 86870361
*   DSECT OF MDR WORK AREA.                                    @D61NDJK 86885461
*                                                              @D61NDJK 86900561
*------------------------------------------------------------* @D61NDJK 86915661
*                                                              @D61NDJK 86930761
TERMDWA  DSECT             MDR WORK AREA                       @D61NDJK 86945861
TERMDLEN DS   H            LENGTH OF MDR RECORD                @D61NDJK 86967951
TERMDPTR DS   F            POINTER TO MDR WORK AREA            @D61NDJK 86976061
TERMDREC DS   0H           MDR RECORD FORMAT                   @D61NDJK 86991161
TERMDHDL EQU  *-TERMDWA    LENGTH OF WORK AREA HEADER          @D61NDJK 86998661
TERMDCUU DS   H            CUU OF FAILING DEVICE               @D61NDJK 87006261
TERMDVS  DS   CL6          VOLUME SERIAL NO OF FAILING DEVICE  @D61NDJK 87021361
         DS   CL4          UNUSED                              @D61NDJK 87036461
TERMDBLL DS   H            BLOCK LENGTH OF FAILING DEVICE      @D61NDJK 87051561
TERMDIDL EQU  *-TERMDVS    LENGTH OF MDR SUB-ID FIELD          @D61NDJK 87066661
TERMDDD1 DS   CL32         DEVICE DEPENDENT DATA PART 1        @D61NDJK 87081761
TERMDLE1 EQU  *-TERMDWA    LENGTH OF MDR WORK AREA PART 1      @D61NDJK 87096861
TERMDDD2 DS   CL32         DEVICE DEPENDENT DATA PART 2        @D61NDJK 87111961
TERMDLE2 EQU  *-TERMDWA    LENGTH OF MDR WORK AREA PART 2      @D61SDJK 87116961
TERMDDD3 DS   CL192        DEVICE DEPENDENT DATA PART 3        @D61SDJK 87121961
TERMDWAL EQU  *-TERMDWA    LENGTH OF WHOLE MDR WORK AREA       @D61NDJK 87127061
*                                                              @D61NDJK 87142161
 AIF   ('&CODE'   NE  'YES').TPNOC02                           @D61SDJK 87149161
&SYSECT  CSECT ,                                               @D61NDJK 87157261
         LTORG                                                 @D61NDJK 87172361
         EJECT                                                 @D61NDJK 87187461
*                                                              @D61NDJK 87202561
***************************************************************         87217661
*  FUNCTION                                                    @D61NDJK 87232761
*     PREPARE AN OBR RECORD FOR ASYNCHRONOUS RECORDING.        @D61NDJK 87247861
*                                                              @D61NDJK 87262961
*  INPUT                                                       @D61NDJK 87278061
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61NDJK 87293161
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61NDJK 87308261
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61NDJK 87323361
*                                                              @D61NDJK 87338461
*  OUTPUT ON RETURN TO RETURN+0                                @D61NDJK 87353561
*    - NONE. OBR RECORD COULD NOT BE PREPARED.                 @D61NDJK 87368661
*                                                              @D61NDJK 87383761
*  OUTPUT ON RETURN TO RETURN+4                                @D61NDJK 87398861
*    - NONE. OBR RECORD IS PREPARED FOR ASYNCHRONOUS           @D61NDJK 87413961
*      RECORDING.                                              @D61NDJK 87429061
*                                                              @D61NDJK 87444161
***************************************************************         87459261
 AGO  .GOBR                                                   *#SECURGL 87474361
.LOBR    AIF ('&TEST'(1,12) NE 'CALL  TEROBR'  ).LA3          *#SECURGL 87496451
 AIF   ('&I'(2,6)  NE '1,2,3 '                 ).DSINVC       *#SECURGL 87504561
 AIF   ('&O'(2,4)  NE 'NONE'                   ).DSINVC       *#SECURGL 87519661
 AIF   (T'&E0      NE 'O'                      ).DSHEAD       *#SECURGL 87534761
 AGO  .DSINVC                                                 *#SECURGL 87549861
.GOBR     ANOP                                                *#SECURGL 87564961
.**************************************************************         87580061
TEROBR   SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 87595161
         USING CCBADR,R1                                       @D61NDJK 87610261
         USING ERBLKADR,R2                                     @D61NDJK 87625361
         USING PUBADR,R3                                       @D61NDJK 87640461
 SGTAP  'SGCOV ERPT610',NR=(43,0) TEROBR ENTERED                 TEROBR 87662551
*                                                              @D61NDJK 87670661
*------------------------------------------------------------* @D61NDJK 87685761
*                                                              @D61NDJK 87700861
*   ALLOCATE OBR WORK AREA IN SYSTEM GETVIS AREA.              @D61NDJK 87715961
*                                                              @D61NDJK 87731061
*------------------------------------------------------------* @D61NDJK 87746161
*                                                              @D61NDJK 87761261
*------------------------------------------------------------* @D61NDJK 87776361
*   ISSUE GETVIS REQUEST AND RESTORE WORK ENVIRONMENT.         @D61NDJK 87791461
*------------------------------------------------------------* @D61NDJK 87806561
*                                                              @D61NDJK 87821661
         LA    R0,TEROBWAL        PROVIDE LENGTH OF WORK AREA  @D61NDJK 87836761
*                                                              @D61NDJK 87851861
         MVC   TEROBSID(4),TEROBPFX  SET UP..                  @D61NDJK 87866961
         STH   R3,TEROBSID+4           GETVIS SUBPOOL ID       @D61NDJK 87882061
*                                                              @D61NDJK 87897161
         LR    R5,RA              SAVE WORK AREA POINTER       @D61NDJK 87907161
         DROP  RA                 RELEASE OLD WORK AREA POINTER@D61NDJK 87910461
         USING TERGLOB,R5         TAKE NEW WORK AREA POINTER   @D61NDJK 87913761
         SLR   R7,R7              ESTABLISH..                  @D61SDJK 87914761
         USING SYSS00,R7            LOW CORE ADDRESSABILITY    @D61SDJK 87915761
         L     RA,TCBPTR          PROVIDE SGETVIS SAVE AREA    @D61NDJK 87917161
         DROP  R7                                              @D61SDJK 87922161
*                                                              @D61NDJK 87927361
         SGETVIS LENGTH=(R0),PFIX=YES,SPID=TEROBSID,LOC=BELOW, @D61SDJKX87949451
               ADDRESS=TEROBWAA,PAGE=YES                       @D61NDJK 87957561
*                                                              @D61NDJK 87972661
         LR    RA,R5              RESTORE WORK AREA POINTER    @D61NDJK 87987761
         DROP  R5                 RELEASE OLD WORK AREA POINTER@D61NDJK 87992761
         USING TERGLOB,RA         TAKE NEW WORK AREA POINTER   @D61NDJK 87997761
*                                                              @D61NDJK 88002861
         LTR   RF,RF              OBR WORK AREA IS ALLOCATED?  @D61NDJK 88017961
         BNZ   TEROBEX0           NO                           @D61NDJK 88033061
 SGTAP  'SGCOV ERPT610',NR=(43,1) GETVIS REQUEST WAS SUCCESSFUL  TEROBR 88055151
*                                                              @D61NDJK 88063261
*------------------------------------------------------------* @D61NDJK 88078361
*                                                              @D61NDJK 88093461
*   SET UP OBR RECORD.                                         @D61NDJK 88108561
*                                                              @D61NDJK 88123661
*------------------------------------------------------------* @D61NDJK 88138761
*                                                              @D61NDJK 88153861
         L     R6,TEROBWAA        ESTABLISH ADDRESSABILITY..   @D61NDJK 88168961
         USING TEROBWA,R6           TO OBR WORK AREA           @D61NDJK 88184061
*                                                              @D61NDJK 88199161
         XC    TEROBWA(TEROBWAL),TEROBWA   CLEAR OBR WORK AREA @D61NDJK 88214261
*                                                              @D61NDJK 88229361
         LA    R7,TEROBWAL-TEROBHDL                            @D61SDJK 88249451
         STCM  R7,3,TEROBLEN      SET LENGTH OF OBR RECORD     @D61SDJK 88254441
*                                                              @D61NDJK 88259561
         MVC   TEROBPTR(4),TEROBWAA  SET OBR WORK AREA ADDRESS @D61NDJK 88274661
*                                                              @D61NDJK 88289761
         MVC   TEROBNAM(8),TERFJOBN  SET FAILING JOB/PRG. NAME @D61NDJK 88304861
*                                                              @D61NDJK 88319961
         ICM   R8,15,TERFCCWV     FAILING CCW IS AVAILABLE?    @D61NDJK 88331261
         BZ    TEROB050           NO                           @D61NDJK 88342561
         TM    TERFLG,TERCVREW    TAPE REW=UNL WAS SPECIFIED?  @D61NDJK 88346261
         BO    TEROB050           YES                          @D61NDJK 88349961
         MVC   TEROBCCW(8),0(R8)  SET UP FAILING CCW           @D61NDJK 88353861
*                                                              @D61NDJK 88365261
TEROB050 MVC   TEROBCSW(8),ERRQCSW  SET FAILING CSW            @D61NDJK 88380361
*                                                              @D61NDJK 88395461
         LA    R7,(TEROBLDD+7)/8  SET NUMBER OF DOUBLEWORDS..  @D61NDJK 88410561
         STC   R7,TEROBDDL          FOR DEVICE DEPENDENT DATA  @D61NDJK 88425661
*                                                              @D61NDJK 88440761
         MVC   TEROBCU0(1),ERRQPATH  SET PATH FAILURE INFO     @D61NDJK 88455861
         MVC   TEROBCUA(2),PUBCHANN  SET SECONDARY CUU ADDRESS @D61NDJK 88470961
*                                                              @D61NDJK 88486061
         L     R5,TERAPUBX        GET PUBX POINTER             @D61NDJK 88531361
         USING PBXADR,R5          DECLARE PUBX BASE POINTER    @D61NDJK 88576661
         MVC   TEROBCLS(2),PBXOBR SET OBR DEVICE TYPE          @D61NDJK 88591761
         DROP  R5                 RELEASE PUBX BASE            @D61NDJK 88606861
*                                                              @D61NDJK 88621961
         MVC   TEROBCUU(2),PUBCHANN  SET PRIMARY CUU ADDRESS   @D61NDJK 88637061
*                                                              @D61NDJK 88652161
         L     R5,TERAPUB2        GET PUB2 POINTER             @D61SDJK 88697251
         USING PUB2ADR,R5         DECLARE PUB2 BASE            @D61NDJK 88742761
         MVC   TEROBVS(6),P2TVOL  SET VOLUME SERIAL NUMBER     @D61NDJK 88757861
         CLC   TEROBVS,TEROBVS0   VOLSER NUMBER IS PRINTABLE?  @D61NDJK 88772961
         BNE   TEROB100           YES                          @D61NDJK 88788061
*                                                              @D61NDJK 88803161
 SGTAP  'SGCOV ERPT610',NR=(43,2) VOLSER IS NOW PRINTABLE        TEROBR 88825251
         MVC   TEROBVS(6),TEROBVSB  FILL VOLSER NO WITH BLANKS @D61NDJK 88833361
*                                                              @D61NDJK 88848461
TEROB100 MVC   TEROBBLL(2),P2TBLK SET BLOCK LENGTH             @D61NDJK 88863561
         DROP  R5                 RELEASE PUB2 BASE            @D61NDJK 88878661
*                                                              @D61NDJK 88893761
         MVI   TEROBNOS+1,L'TEROBSNS     SET NO OF SENSE BYTES @D61NDJK 88908861
*                                                              @D61NDJK 88923961
         MVC   TEROBRTC+1(1),TERRTLOG    SET RETRY COUNT       @D61NDJK 88939061
*                                                              @D61NDJK 88954161
         MVC   TEROBSNS(L'TEROBSNS),ERRQSNS  SET SENSE DATA    @D61NDJK 88969261
*                                                              @D61NDJK 88984361
.*  OLD TRANSIENTS PROVIDED AN IRB THAT WAS NEVER SET UP IN    @D61NDJK 88999461
.*  THE ERBLOC (TEROBSW0, TEROBSWX, TEROBSWE).                 @D61NDJK 89014561
.*                                                             @D61NDJK 89029661
*------------------------------------------------------------* @D61NDJK 89044761
*                                                              @D61NDJK 89059861
*   WORK ERROR ENTRY CAN BE PASSED TO TRANSIENT.               @D61NDJK 89074961
*                                                              @D61NDJK 89090061
*------------------------------------------------------------* @D61NDJK 89105161
*                                                              @D61NDJK 89120261
         OI    ERRQERPF,ERRQPOBR  INDICATE OBR RECORDING       @D61NDJK 89135361
         OI    ERRQERPF,ERRQPTEM  ASSUME A TEMPORARY OBR       @D61NDJK 89150461
*                                                              @D61NDJK 89165561
         TM    TERFLGMR,TERMRTO   IT SHALL BE A TEMPORARY OBR? @D61NDJK 89180661
         BO    TEROB200           YES                          @D61NDJK 89195761
*                                                              @D61NDJK 89210861
         NI    ERRQERPF,XFF-ERRQPTEM  INDICATE..               @D61NDJK 89225961
         OI    ERRQERPF,ERRQPPER            A PERMANENT OBR    @D61NDJK 89241061
 SGTAP  'SGCOV ERPT610',NR=(43,3) A PERMANENT OBR IS INDICATED   TEROBR 89263151
*                                                              @D61NDJK 89271261
TEROB200 MVC   ERRQCOMM,TEROBWAA  SET UP OBR WORK AREA ADDRESS @D61NDJK 89286361
         NI    TERFLGMR,XFF-TERMROBR-TERMRCR    OBR RECORD..   @D61SDJK 89308451
         B     TEROBEX4                           IS PREPARED  @D61NDJK 89316561
*                                                              @D61NDJK 89331661
*------------------------------------------------------------* @D61NDJK 89346761
*                                                              @D61NDJK 89361861
*   EXIT HANDLING.                                             @D61NDJK 89376961
*                                                              @D61NDJK 89392061
*------------------------------------------------------------* @D61NDJK 89407161
*                                                              @D61NDJK 89422261
*------------------------------------------------------------* @D61NDJK 89437361
*   ERROR EXIT.                                                @D61NDJK 89452461
*------------------------------------------------------------* @D61NDJK 89467561
*                                                              @D61NDJK 89482661
TEROBEX0 DS    0H                                              @D61NDJK 89497761
 SGTAP  'SGCOV ERPT610',NR=(43,4) GETVIS REQUEST FAILED          TEROBR 89508251
         SGTAP 'RETURN         ','RETURN TO CALLER         '   @D61NDJK 89512861
*                                                              @D61NDJK 89543061
*------------------------------------------------------------* @D61NDJK 89558161
*   NORMAL EXIT.                                               @D61NDJK 89573261
*------------------------------------------------------------* @D61NDJK 89588361
*                                                              @D61NDJK 89603461
TEROBEX4 SGTAP 'RETURN4        ','RETURN TO CALLER         '   @D61NDJK 89618561
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 89633661
*                                                              @D61NDJK 89648761
*                                                              @D61NDJK 89663861
*------------------------------------------------------------* @D61NDJK 89678961
*                                                              @D61NDJK 89694061
*   LOCAL VARIABLES USED IN TEROBR                             @D61NDJK 89709161
*                                                              @D61NDJK 89724261
*------------------------------------------------------------* @D61NDJK 89739361
*                                                              @D61NDJK 89754461
TEROBVS0 DC   XL6'00'             THESE FIELDS HELP TO MAKE    @D61NDJK 89769561
TEROBVSB DC   XL6'404040404040'   THE VOLSER NO. PRINTABLE     @D61NDJK 89784661
*------------------------------------------------------------* @D61NDJK 89799761
TEROBPFX DC   C'IOBR'             FIRST 4 CHARACTERS OF GETVIS @D61NDJK 89814861
*                                 SUBPOOL ID FOR OBR RECORDING @D61NDJK 89829961
*                                 REQUESTS                     @D61NDJK 89845061
.TPNOC02 ANOP                                                  @D61SDJK 89852061
*------------------------------------------------------------* @D61NDJK 89860161
*                                                              @D61NDJK 89875261
*   DSECT OF OBR WORK AREA.                                    @D61NDJK 89890361
*                                                              @D61NDJK 89905461
*------------------------------------------------------------* @D61NDJK 89920561
*                                                              @D61NDJK 89935661
TEROBWA  DSECT             OBR WORK AREA                       @D61NDJK 89950761
TEROBLEN DS   H            LENGTH OF OBR RECORD                @D61NDJK 89972851
TEROBPTR DS   F            POINTER TO OBR WORK AREA            @D61NDJK 89980961
TEROBREC DS   0H           OBR RECORD FORMAT                   @D61NDJK 89996061
TEROBHDL EQU  *-TEROBWA    LENGTH OF WORK AREA HEADER          @D61NDJK 90003561
TEROBNAM DS   CL8          FAILING JOB OR PROGRAM NAME         @D61NDJK 90011161
TEROBCCW DS   CL8          FAILING CCW                         @D61NDJK 90026261
TEROBCSW DS   CL8          FAILING CSW                         @D61NDJK 90041361
TEROBDDL DS   X            DEVICE DEPENDENT DATA LENGTH        @D61NDJK 90056461
TEROBCU0 DS   X            FAILING CHPID                       @D61NDJK 90071561
TEROBCUA DS   H            SECONDARY CUU OF FAILING DEVICE     @D61NDJK 90086661
TEROBDVT DS   CL2          DEVICE TYPE AND PUBOPTN FIELD       @D61NDJK 90101761
TEROBCLS DS   CL2          DEVICE CLASS                        @D61NDJK 90116861
TEROBSLN DS   X            SDR LENGTH                          @D61NDJK 90131961
         DS   X            UNUSED                              @D61NDJK 90147061
TEROBCUU DS   H            PRIMARY CUU OF FAILING DEVICE       @D61NDJK 90162161
TEROBRTC DS   H            RETRY COUNT                         @D61NDJK 90177261
TEROBNOS DS   H            NUMBER OF SENSE BYTES               @D61NDJK 90192361
TEROBVS  DS   CL6          VOLUME SERIAL NO OF FAILING DEVICE  @D61NDJK 90207461
TEROBBLL DS   H            BLOCK LENGTH OF FAILING DEVICE      @D61NDJK 90222561
TEROBSER DS   CL8          TAPE UNIT SERIAL                    @D61NDJK 90237661
TEROBLDD EQU  TEROBSNS-TEROBVS LENGTH OF DEVICE DEPENDENT DATA @D61NDJK 90252761
TEROBSNS DS   CL32         SENSE DATA                          @D61NDJK 90267861
TEROBSW0 DS   CL4          SUBCHANNEL STATUS WORD 0            @D61NDJK 90282961
TEROBSWX DS   CL8          SUBCHANNEL STATUS WORD 1-2          @D61NDJK 90298061
TEROBSWE DS   CL4          EXTENDED SUBCHANNEL STATUS WORD 0   @D61NDJK 90313161
TEROBWAL EQU  *-TEROBWA    LENGTH OF OBR RECORD WORK AREA      @D61NDJK 90328261
*                                                              @D61NDJK 90343361
 AIF   ('&CODE'   NE  'YES').TPNOC03                           @D61SDJK 90350361
&SYSECT  CSECT ,                                               @D61NDJK 90358461
         LTORG                                                 @D61NDJK 90373561
         EJECT                                                 @D61NDJK 90388661
*                                                              @D61NDJK 90403761
***************************************************************         90403831
*  FUNCTION                                                    @D61SDJK 90403901
*     PREPARE AN A3 RECORD FOR ASYNCHRONOUS RECORDING.         @D61SDJK 90403971
*                                                              @D61SDJK 90404041
*  INPUT                                                       @D61SDJK 90404111
*    - R1 CONTAINS THE ADDRESS OF A CCB.                       @D61SDJK 90404181
*    - R2 CONTAINS THE ADDRESS OF AN ERROR ENTRY.              @D61SDJK 90404251
*    - R3 CONTAINS THE ADDRESS OF A PUB DEVICE ENTRY.          @D61SDJK 90404321
*                                                              @D61SDJK 90404391
*  OUTPUT ON RETURN TO RETURN+0                                @D61SDJK 90404461
*    - NONE. A3 RECORD COULD NOT BE PREPARED.                  @D61SDJK 90404531
*                                                              @D61SDJK 90404601
*  OUTPUT ON RETURN TO RETURN+4                                @D61SDJK 90404671
*    - NONE. A3 RECORD IS PREPARED FOR ASYNCHRONOUS            @D61SDJK 90404741
*      RECORDING.                                              @D61SDJK 90404811
*                                                              @D61SDJK 90404881
***************************************************************         90404951
 AGO  .GA3                                                    *#SECURGL 90405021
.LA3     AIF ('&TEST'(1,12) NE 'CALL  TERA3 '  ).LERP         *#SECURGL 90405091
 AIF   ('&I'(2,6)  NE '1,2,3 '                 ).DSINVC       *#SECURGL 90405161
 AIF   ('&O'(2,4)  NE 'NONE'                   ).DSINVC       *#SECURGL 90405231
 AIF   (T'&E0      NE 'O'                      ).DSHEAD       *#SECURGL 90405301
 AGO  .DSINVC                                                 *#SECURGL 90405371
.GA3      ANOP                                                *#SECURGL 90405441
.**************************************************************         90405511
TERA3    SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61SDJK 90405581
         USING CCBADR,R1                                       @D61SDJK 90405651
         USING ERBLKADR,R2                                     @D61SDJK 90405721
         USING PUBADR,R3                                       @D61SDJK 90405791
 SGTAP  'SGCOV ERPT610',NR=(44,0) TERA3 ENTERED                   TERA3 90405861
*                                                              @D61SDJK 90406001
*------------------------------------------------------------* @D61SDJK 90406071
*                                                              @D61SDJK 90406141
*   ALLOCATE A3 WORK AREA IN SYSTEM GETVIS AREA.               @D61SDJK 90406211
*                                                              @D61SDJK 90406281
*------------------------------------------------------------* @D61SDJK 90406351
*                                                              @D61SDJK 90406421
*------------------------------------------------------------* @D61SDJK 90406491
*   ISSUE GETVIS REQUEST AND RESTORE WORK ENVIRONMENT.         @D61SDJK 90406561
*------------------------------------------------------------* @D61SDJK 90406631
*                                                              @D61SDJK 90406701
         LA    R0,TERA3WAL        PROVIDE LENGTH OF WORK AREA  @D61SDJK 90406771
*                                                              @D61SDJK 90406841
         MVC   TERA3SID(4),TERA3PFX  SET UP..                  @D61SDJK 90406911
         STH   R3,TERA3SID+4           GETVIS SUBPOOL ID       @D61SDJK 90406981
*                                                              @D61SDJK 90407051
         LR    R5,RA              SAVE WORK AREA POINTER       @D61SDJK 90407121
         DROP  RA                 RELEASE OLD WORK AREA POINTER@D61SDJK 90407191
         USING TERGLOB,R5         TAKE NEW WORK AREA POINTER   @D61SDJK 90407261
         SLR   R7,R7              ESTABLISH..                  @D61SDJK 90407331
         USING SYSS00,R7            LOW CORE ADDRESSABILITY    @D61SDJK 90407401
         L     RA,TCBPTR          PROVIDE SGETVIS SAVE AREA    @D61SDJK 90407471
         DROP  R7                                              @D61SDJK 90407541
*                                                              @D61SDJK 90407611
         SGETVIS LENGTH=(R0),PFIX=YES,SPID=TERA3SID,LOC=BELOW, @D61SDJKX90407681
               ADDRESS=TERA3WAA,PAGE=YES                       @D61SDJK 90407751
*                                                              @D61SDJK 90407821
         LR    RA,R5              RESTORE WORK AREA POINTER    @D61SDJK 90407891
         DROP  R5                 RELEASE OLD WORK AREA POINTER@D61SDJK 90407961
         USING TERGLOB,RA         TAKE NEW WORK AREA POINTER   @D61SDJK 90408031
*                                                              @D61SDJK 90408101
         LTR   RF,RF              A3 WORK AREA IS ALLOCATED?   @D61SDJK 90408171
         BNZ   TERA3EX0           NO                           @D61SDJK 90408241
*                                                              @D61SDJK 90408311
*------------------------------------------------------------* @D61SDJK 90408381
*                                                              @D61SDJK 90408451
*   SET UP A3 RECORD.                                          @D61SDJK 90408521
*                                                              @D61SDJK 90408591
*------------------------------------------------------------* @D61SDJK 90408661
*                                                              @D61SDJK 90408731
         L     R6,TERA3WAA        ESTABLISH ADDRESSABILITY..   @D61SDJK 90408801
         USING TERA3WA,R6           TO A3 WORK AREA            @D61SDJK 90408871
*                                                              @D61SDJK 90408941
         XC    TERA3WA(TERA3WAL),TERA3WA   CLEAR A3 WORK AREA  @D61SDJK 90409011
*                                                              @D61SDJK 90409081
         LA    R7,TERA3WAL-TERA3HDL                            @D61SDJK 90409151
         STCM  R7,3,TERA3LEN      SET LENGTH OF A3 RECORD      @D61SDJK 90409221
*                                                              @D61SDJK 90409291
         MVC   TERA3PTR(4),TERA3WAA  SET A3 WORK AREA ADDRESS  @D61SDJK 90409361
*                                                              @D61SDJK 90409431
         L     R5,TERAPUBX        GET PUBX POINTER             @D61SDJK 90409501
         USING PBXADR,R5          MAKE PUBX ADDRESSABLE        @D61SDJK 90409571
         MVI   TERA3DTO,TERA3DTL  SET DEVICE TYPE..            @D61SDJK 90409641
         MVC   TERA3DVT(3),PBXDVTYP NUMBER AND MODEL NUMBER    @D61SDJK 90409711
         MVI   TERA3CTO,TERA3CTL  SET CONTROL UNIT TYPE..      @D61SDJK 90409781
         MVC   TERA3CUT(3),PBXCUTYP NUMBER AND MODEL NUMBER    @D61SDJK 90409851
*                                                              @D61SDJK 90409921
         MVC   TERA3CU0(1),ERRQPATH  SET PATH FAILURE INFO     @D61SDJK 90409991
         MVC   TERA3CUA(2),PUBCHANN  SET SECONDARY CUU ADDRESS @D61SDJK 90410061
*                                                              @D61SDJK 90410131
         MVC   TERA3CLS(2),PBXOBR SET OBR DEVICE TYPE          @D61SDJK 90410201
         DROP  R5                 RELEASE PUBX BASE            @D61SDJK 90410271
*                                                              @D61SDJK 90410341
         MVC   TERA3CUU(2),PUBCHANN  SET PRIMARY CUU ADDRESS   @D61SDJK 90410411
*                                                              @D61SDJK 90410481
         MVI   TERA3SIL,L'TERA3SI SET LENGTH OF SI PORTION     @D61SDJK 90410551
         L     R5,TERAPUB2        GET PUB2 POINTER             @D61SDJK 90410621
         USING PUB2ADR,R5         MAKE PUB2 ADDRESSABLE        @D61SDJK 90410691
         MVC   TERA3VS(6),P2TVOL  SET VOLUME SERIAL NUMBER     @D61SDJK 90410761
         CLC   TERA3VS,TERA3VS0   VOLSER NUMBER IS PRINTABLE?  @D61SDJK 90410831
         BNE   TERA3100           YES                          @D61SDJK 90410901
*                                                              @D61SDJK 90410971
         MVC   TERA3VS(6),TERA3VSB  FILL VOLSER NO WITH BLANKS @D61SDJK 90411041
*                                                              @D61SDJK 90411111
TERA3100 MVC   TERA3BLL(2),P2TBLK SET BLOCK LENGTH             @D61SDJK 90411181
         DROP  R5                 RELEASE PUB2 BASE            @D61SDJK 90411251
*                                 SET LENGTH..                 @D61SDJK 90411321
         MVI   TERA3SSL,L'TERA3SSI  OF SSI PORTION             @D61SDJK 90411391
         MVC   TERA3SNS(L'TERA3SNS),ERRQSNS  SET SENSE DATA    @D61SDJK 90411461
*                                                              @D61SDJK 90411531
*------------------------------------------------------------* @D61SDJK 90411601
*                                                              @D61SDJK 90411671
*   WORK ERROR ENTRY CAN BE PASSED TO TRANSIENT.               @D61SDJK 90411741
*                                                              @D61SDJK 90411811
*------------------------------------------------------------* @D61SDJK 90411881
*                                                              @D61SDJK 90411951
         OI    ERRQERPF,ERRQPSIR  INDICATE A3 RECORDING        @D61SDJK 90412021
         MVC   ERRQCOMM,TERA3WAA  SET UP A3 WORK AREA ADDRESS  @D61SDJK 90412091
         NI    TERFLGMR,XFF-TERMRA3   A3 RECORD IS PREPARED    @D61SDJK 90412161
         B     TERA3EX4                                        @D61SDJK 90412231
*                                                              @D61SDJK 90412301
*------------------------------------------------------------* @D61SDJK 90412371
*                                                              @D61SDJK 90412441
*   EXIT HANDLING.                                             @D61SDJK 90412511
*                                                              @D61SDJK 90412581
*------------------------------------------------------------* @D61SDJK 90412651
*                                                              @D61SDJK 90412721
*------------------------------------------------------------* @D61SDJK 90412791
*   ERROR EXIT.                                                @D61SDJK 90412861
*------------------------------------------------------------* @D61SDJK 90412931
*                                                              @D61SDJK 90413001
TERA3EX0 DS    0H                                              @D61SDJK 90413071
 SGTAP  'SGCOV ERPT610',NR=(44,1) GETVIS REQUEST FAILED           TERA3 90413211
         SGTAP 'RETURN         ','RETURN TO CALLER         '   @D61SDJK 90413281
*                                                              @D61SDJK 90413351
*------------------------------------------------------------* @D61SDJK 90413421
*   NORMAL EXIT.                                               @D61SDJK 90413491
*------------------------------------------------------------* @D61SDJK 90413561
*                                                              @D61SDJK 90413631
TERA3EX4 SGTAP 'RETURN4        ','RETURN TO CALLER         '   @D61SDJK 90413701
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61SDJK 90413771
*                                                              @D61SDJK 90413841
*------------------------------------------------------------* @D61SDJK 90413911
*                                                              @D61SDJK 90413981
*   LOCAL VARIABLES USED IN TERA3                              @D61SDJK 90414051
*                                                              @D61SDJK 90414121
*------------------------------------------------------------* @D61SDJK 90414191
*                                                              @D61SDJK 90414261
TERA3VS0 DC   XL6'00'             THESE FIELDS HELP TO MAKE    @D61SDJK 90414331
TERA3VSB DC   XL6'404040404040'   THE VOLSER NO. PRINTABLE     @D61SDJK 90414401
*------------------------------------------------------------* @D61SDJK 90414471
TERA3PFX DC   C'IA3 '             FIRST 4 CHARACTERS OF GETVIS @D61SDJK 90414541
*                                 SUBPOOL ID FOR A3 RECORDING  @D61SDJK 90414611
*                                 REQUESTS                     @D61SDJK 90414681
.TPNOC03 ANOP                                                  @D61SDJK 90414751
*------------------------------------------------------------* @D61SDJK 90414821
*                                                              @D61SDJK 90414891
*   DSECT OF A3 WORK AREA.                                     @D61SDJK 90414961
*                                                              @D61SDJK 90415031
*------------------------------------------------------------* @D61SDJK 90415101
*                                                              @D61SDJK 90415171
TERA3WA  DSECT             A3 WORK AREA                        @D61SDJK 90415241
TERA3LEN DS   H            LENGTH OF A3 RECORD                 @D61SDJK 90415311
TERA3PTR DS   F            POINTER TO A3 WORK AREA             @D61SDJK 90415381
TERA3REC DS   0H           A3 RECORD FORMAT                    @D61SDJK 90415451
TERA3HDL EQU  *-TERA3WA    LENGTH OF WORK AREA HEADER          @D61SDJK 90415521
TERA3DTO DS   XL1          REPORTING DEVICE TYPE OFFSET        @D61SDJK 90415591
         DS   XL3          UNUSED                              @D61SDJK 90415661
TERA3DTL EQU  *-TERA3DTO   OFFSET TO BE STORED IN TERA3DTO     @D61SDJK 90415731
TERA3DVT DS   XL3          REPORTING DEVICE TYPE AND MODEL     @D61SDJK 90415801
TERA3CTO DS   XL1          REPORTING CU TYPE OFFSET            @D61SDJK 90415871
         DS   XL3          UNUSED                              @D61SDJK 90415941
TERA3CTL EQU  *-TERA3CTO   OFFSET TO BE STORED IN TERA3CTO     @D61SDJK 90416011
TERA3CUT DS   XL3          REPORTING CU TYPE AND MODEL         @D61SDJK 90416081
TERA3MAN DS   XL10         DEVICE MANUFACTURER IDENTIFIER      @D61SDJK 90416151
TERA3SSL DS   XL1          LENGTH OF SSI PORTION OF THE RECORD @D61SDJK 90416221
TERA3CU0 DS   X            FAILING CHPID                       @D61SDJK 90416291
TERA3CUA DS   H            SECONDARY CUU OF FAILING DEVICE     @D61SDJK 90416361
         DS   CL2          UNUSED                              @D61SDJK 90416431
TERA3CLS DS   CL2          DEVICE CLASS                        @D61SDJK 90416501
TERA3SIL DS   XL1          LENGTH OF SI PORTION OF THE RECORD  @D61SDJK 90416571
         DS   X            UNUSED                              @D61SDJK 90416641
TERA3CUU DS   H            PRIMARY CUU OF FAILING DEVICE       @D61SDJK 90416711
TERA3SI  DS   0XL8         DEVICE DEPENDENT INFO FROM HOST     @D61SDJK 90416781
TERA3VS  DS   CL6          VOLUME SERIAL NO OF FAILING DEVICE  @D61SDJK 90416851
TERA3BLL DS   H            BLOCK LENGTH OF FAILING DEVICE      @D61SDJK 90416921
TERA3SSI DS   0XL32        DEVICE DEPENDENT INFO FROM SUBSYSTEM@D61SDJK 90416991
TERA3SNS DS   CL32         SENSE DATA                          @D61SDJK 90417061
TERA3WAL EQU  *-TERA3WA    LENGTH OF A3 RECORD WORK AREA       @D61SDJK 90417131
*                                                              @D61SDJK 90417201
 AIF   ('&CODE'   NE  'YES').TPNOC04                           @D61SDJK 90417271
&SYSECT  CSECT ,                                               @D61SDJK 90417341
         LTORG                                                 @D61SDJK 90417411
         EJECT                                                 @D61SDJK 90417481
*                                                              @D61SDJK 90417551
***************************************************************         90418861
* FUNCTION                                                     @D61NDJK 90433961
*    ENQUEUE WORK ERROR ENTRY INTO ERP ERROR CHAIN.            @D61NDJK 90449061
*                                                              @D61NDJK 90464161
* INPUT                                                        @D61NDJK 90479261
*    - R2 POINTS TO A WORK ERROR ENTRY.                        @D61NDJK 90494361
*                                                              @D61NDJK 90509461
* OUTPUT                                                       @D61NDJK 90524561
*    - NONE                                                    @D61NDJK 90539661
*                                                              @D61NDJK 90554761
***************************************************************         90569861
 AGO  .GERP                                                   *#SECURGL 90584961
.LERP    AIF ('&TEST'(1,12) NE 'CALL  TERERP'  ).LTRACE       *#SECURGL 90600061
 AIF   ('&I'(2,2)  NE '2 '                     ).DSINVC       *#SECURGL 90615161
 AIF   ('&O'(2,4)  EQ 'NONE'                   ).DSHEAD       *#SECURGL 90630261
 AGO  .DSINVC                                                 *#SECURGL 90645361
.GERP     ANOP                                                *#SECURGL 90660461
.**************************************************************         90675561
TERERP   SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 90690661
         USING ERBLKADR,R2                                     @D61NDJK 90705761
 SGTAP  'SGCOV ERPT610',NR=(45,0) TERERP ENTERED                 TERERP 90727851
*                                                              @D61NDJK 90735961
*------------------------------------------------------------* @D61SDJK 90771051
*   BRANCH INTO SUPERVISOR PART OF SGTAP IN ORDER TO CALL      @D61SDJK 90791041
*   IOINTER POSTING ROUTINE.                                   @D61SDJK 90811031
*------------------------------------------------------------* @D61SDJK 90831021
*                                                              @D61SDJK 90851011
         NI    ERBLKFL1,X'FF'-NEEDTASK   ERP TASK HAS TO..     @D61SDJK 90877001
         OI    ERBLKFL1,NEEDERP            HANDLE THIS REQUEST @D61SDJK 90883001
         LR    RB,RD              SAVE STACK POINTER           @D61SDJK 90890991
         L     RF,TERLINK         ESTABLISH LINKAGE TO..       @D61SDJK 90910981
         USING TERLNKG,RF           SUPERVISOR PART OF..       @D61SDJK 90930971
         L     R9,TERERPST          SGTAP AND RETURN IN..      @D61SDJK 90950961
         L     RD,TERERSET          ORDER TO ENQUEUE THE..     @D61SDJK 90970951
         L     RF,TERCALL           WORK ERROR ENTRY           @D61SDJK 90990941
         DROP  RF                                              @D61SDJK 91010931
         BALR  RE,RF              =========================>>> @D61SDJK 91030921
         LR    RD,RB              RESTORE STACK POINTER        @D61SDJK 91050911
*                                                              @D61SDJK 91090891
*------------------------------------------------------------* @D61NDJK 91219161
*                                                              @D61NDJK 91234261
*   EXIT HANDLING.                                             @D61NDJK 91249361
*                                                              @D61NDJK 91264461
*------------------------------------------------------------* @D61NDJK 91279561
*                                                              @D61NDJK 91294661
 SGTAP  'SGCOV ERPT610',NR=(45,1) WORK ERROR ENTRY IS ENQUEUED   TERERP 91301661
TEREREX  SGTAP 'RETURN         ','RETURN TO CALLER         '   @D61NDJK 91309761
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 91324861
         LTORG                                                 @D61NDJK 91339961
         EJECT                                                 @D61NDJK 91355061
*                                                              @D61NDJK 91370161
***************************************************************         91385261
* FUNCTION                                                     @D61NDJK 91400361
*    WRITE TRACE ENTRIES INTO A TRACE AREA. THIS FUNCTION      @D61NDJK 91415461
*    SHALL PROVIDE THE NECESSARY INFORMATION FOR DEBUGGING     @D61NDJK 91430561
*                                                              @D61NDJK 91445661
*    A TRACE TABLE ENTRY HAS THE FOLLOWING PRINCIPLE FORMAT:   @D61NDJK 91460761
*                                                              @D61NDJK 91475861
*    EACH ENTRY HAS A LENGTH OF 48 BYTES. THE FIRST TWO        @D61SDJK 91497951
*    BYTES CONTAIN THE IO NUMBER, THE THIRD BYTE CONTAINS      @D61NDJK 91506061
*    THE NUMBER THAT IDENTIFIES THE TYPE OF ENTRY. THERE       @D61NDJK 91521161
*    ARE DIFFERENT TYPES OF ENTRIES GENERATED IN DIFFERENT     @D61NDJK 91536261
*    POSITIONS OF THE PROGRAM. THE NORMAL SEQUENCE OF          @D61NDJK 91551361
*    ENTRIES IS:                                               @D61NDJK 91566461
*    1) A TYPE 1 ENTRY GIVES THE ENTRY CONDITIONS FOR THE      @D61NDJK 91581561
*       RECOVERY LOOP                                          @D61NDJK 91596661
*    2) A TYPE 2 ENTRY IS PROVIDED AFTER RECOVERY ATTRIBUTES   @D61NDJK 91611761
*       ARE ASSIGNED.                                          @D61NDJK 91626861
*    3) A TYPE 3 ENTRY IS INSERTED RIGHT BEFORE THE DECISION   @D61NDJK 91641961
*       IS MADE WHETHER THE RECOVERY LOOP HAS TO BE LEFT       @D61NDJK 91657061
*    4) A TYPE 4 ENTRY IS WRITTEN IMMEDIATELY BEFORE EXITING   @D61NDJK 91672161
*       TO TAPEXIT                                             @D61NDJK 91687261
*    ADDITIONALY A TYPE 5 ENTRY MAY BE WRITTEN, IF READ        @D61NDJK 91702361
*    OPPOSITE OR READ ALTERNATE RECOVERY HAD TO BE DONE.       @D61SDJK 91724451
*                                                              @D61NDJK 91732561
*  INPUT                                                       @D61NDJK 91747661
*    - A TRACE TYPE INDICATION AT RETURN+0                     @D61NDJK 91762761
*                                                              @D61NDJK 91777861
*  OUTPUT ON RETURN TO RETURN+4                                @D61NDJK 91792961
*    - NONE. A TRACE TABLE ENTRY IS WRITTEN.                   @D61NDJK 91808061
*                                                              @D61NDJK 91823161
***************************************************************@D61NDJK 91838261
 AGO  .GTRACE                                                 *@D61NDJK 91853361
.LTRACE  AIF ('&TEST'(1,14) NE 'CALL  TERTRACE').DSINVS       *@D61NDJK 91868461
 AIF   (T'&NR      NE 'O'                      ).DSHEAD       *@D61NDJK 91883561
 AGO  .DSINVC                                                 *@D61NDJK 91898661
.GTRACE   ANOP                                                *@D61NDJK 91913761
.**************************************************************@D61NDJK 91928861
TERTRACE SGTAP 'HEADING        ','START OF CODEBLOCK'          @D61NDJK 91943961
*                                                              @D61NDJK 91959061
*------------------------------------------------------------* @D61NDJK 91974161
*                                                              @D61NDJK 91989261
*   DETERMINE ENTRY TYPE NUMBER AND INITIALIZE CURRENT         @D61NDJK 92004361
*   DEBUG ENTRY.                                               @D61NDJK 92019461
*                                                              @D61NDJK 92034561
*------------------------------------------------------------* @D61NDJK 92049661
*                                                              @D61NDJK 92064761
         LH    R4,TERDBGAC        POINT TO..                   @D61NDJK 92079861
         LA    R4,TERDEBUG(R4)      CURRENT ENTRY              @D61NDJK 92094961
         MVC   0(2,R4),TERDBGIO   SET I/O NR THAT IS PROCESSED @D61NDJK 92110061
         L     R5,4(,RE)          TAKE NR OF WANTED ENTRY TYPE @D61NDJK 92125161
         STC   R5,2(,R4)          WRITE IT INTO DEBUG ENTRY    @D61NDJK 92140261
         SLL   R5,2               MAKE IT INDEX IN BRANCH TAB  @D61NDJK 92155361
         C     R5,=A(TERTRANR)    IT IS A VALID ENTRY TYPE?    @D61NDJK 92170461
         BL    TERTRATB(R5)       YES                          @D61NDJK 92185561
*                                                              @D61NDJK 92200661
         B     TERTR900           ENTRY TYPE IS INVALID        @D61NDJK 92215761
*                                                              @D61NDJK 92230861
TERTRATB B     TERTR000           ROUTINE FOR ENTRY TYPE 0     @D61NDJK 92245961
         B     TERTR100              1                         @D61NDJK 92261061
         B     TERTR200              2                         @D61NDJK 92276161
         B     TERTR300              3                         @D61NDJK 92291261
         B     TERTR400              4                         @D61NDJK 92306361
         B     TERTR500              5                         @D61NDJK 92321461
TERTRANR EQU   (*-TERTRATB)                                    @D61NDJK 92336561
*                                                              @D61NDJK 92351661
*------------------------------------------------------------* @D61NDJK 92366761
*                                                              @D61NDJK 92381861
*   DEBUG ENTRY TYPE 0. UPDATE HEADER OF DEBUG AREA.           @D61NDJK 92396961
*                                                              @D61NDJK 92412061
*------------------------------------------------------------* @D61NDJK 92427161
*                                                              @D61NDJK 92442261
TERTR000 SLR   R5,R5                                           @D61NDJK 92457361
         ICM   R5,3,TERDBGNR      TAKE ACTUAL I/O NUMBER       @D61NDJK 92472461
         LA    R5,1(,R5)          INCREMENT I/O NUMBER         @D61NDJK 92487561
         STH   R5,TERDBGNR        SET CURRENT I/O NUMBER IN..  @D61NDJK 92502661
         STH   R5,TERDBGIO          DEBUG AREA HEADER AND..    @D61NDJK 92517761
         B     TERTRAEX             SAVE THAT NUMBER           @D61NDJK 92532861
*                                                              @D61NDJK 92547961
*------------------------------------------------------------* @D61NDJK 92563061
*                                                              @D61NDJK 92578161
*   DEBUG ENTRY TYPE 1.                                        @D61NDJK 92593261
*                                                              @D61NDJK 92608361
*------------------------------------------------------------* @D61NDJK 92623461
*                                                              @D61NDJK 92638561
*------------------------------------------------------------* @D61NDJK 92653661
*   SUPPLY SENSE BYTES 0-7 AND ADDITIONALY SENSE BYTE 31 FOR   @D61SDJK 92673751
*   3480-TYPE DEVICES OR 23 FOR TPA DEVICES.                   @D61SDJK 92678741
*------------------------------------------------------------* @D61NDJK 92683861
*                                                              @D61NDJK 92698961
TERTR100 MVC   3(1,R4),TERINWRK+ERRQLSNS-ERBLKADR              @D61NDJK 92714061
         MVC   4(8,R4),TERINWRK+ERRQSNS-ERBLKADR               @D61NDJK 92729161
         CLI   TERDEVTY,TERTPA                                 @D61SDJK 92746251
         BL    TERTR120                                        @D61SDJK 92748241
         MVC   12(1,R4),TERINWRK+ERRQSNS-ERBLKADR+23           @D61SDJK 92750231
         B     TERTR130                                        @D61SDJK 92752221
*                                                              @D61SDJK 92754211
TERTR120 MVC   12(1,R4),TERINWRK+ERRQSNS-ERBLKADR+31           @D61SDJK 92756201
*                                                              @D61NDJK 92759361
*------------------------------------------------------------* @D61NDJK 92774461
*   SUPPLY PUB ADDRESS, TASK ID IN CHANNEL QUEUE ENTRY,        @D61NDJK 92789561
*   FAILING DEVICE TYPE AND CCB ADDRESS.                       @D61NDJK 92804661
*------------------------------------------------------------* @D61NDJK 92819761
*                                                              @D61NDJK 92834861
TERTR130 DS    0H                                              @D66ODOW 92856951
         MVI   13(R4),X'00'                                    @D66ODOW 92856951
         MVC   44(2,R4),TERCHQID                               @D66ODOW 92856951
         MVC   14(2,R4),TERINWRK+ERRQPUB-ERBLKADR              @D61NDJK 92865061
         MVC   16(1,R4),TERDEVTY                               @D61NDJK 92880161
         MVC   17(3,R4),TERINWRK+ERRQCCB+1-ERBLKADR            @D61NDJK 92895261
*                                                              @D61NDJK 92910361
*------------------------------------------------------------* @D61NDJK 92925461
*   SUPPLY ORIGINAL ERROR FLAG, CHANNEL QUEUE CSW, POINTER TO  @D61SDJK 92945551
*   CURRENT DEBUG ENTRY.                                       @D61SDJK 92950541
*------------------------------------------------------------* @D61NDJK 92955661
*                                                              @D61NDJK 92970761
         MVC   20(1,R4),TEROEFLG                               @D61SDJK 93035851
         MVC   21(3,R4),TERCCB+CCBCSWW-CCBADR                  @D61NDJK 93091561
         MVC   24(2,R4),TERCCB+CCBSTA-CCBADR                   @D61NDJK 93106661
         MVC   26(2,R4),TERCCB+CCBCNT-CCBADR                   @D61NDJK 93121761
*                                                              @D61NDJK 93136861
         L     R5,X'270'          TAKE SYSTEM DEBUG HEADER PTR.@D61NDJK 93141161
         ST    R5,28(,R4)         SUPPLY THAT POINTER          @D61NDJK 93145461
         LA    R5,0(,R5)          SWITCH OFF UPPERMOST BIT     @D61NDJK 93149761
         LTR   R5,R5              DEBUG IS ACTIVE?             @D61NDJK 93154061
         BZ    TERTR150           NO                           @D61NDJK 93158361
         L     R5,0(,R5)          TAKE SYSTEM DEBUG AREA ADDR. @D61NDJK 93162661
         ST    R5,28(,R4)         SUPPLY THAT ADDRESS          @D61NDJK 93167061
         LA    R5,0(,R5)          SWITCH OFF UPPERMOST BIT     @D61NDJK 93182161
         LTR   R5,R5              DEBUG IS ACTIVE?             @D61NDJK 93197261
         BZ    TERTR150           NO                           @D61NDJK 93212361
         L     R5,0(,R5)          LOAD AND SUPPLY CURRENT..    @D61NDJK 93227461
         ST    R5,28(,R4)           SYSTEM DEBUG ENTRY POINTER @D61NDJK 93242561
*                                                              @D61NDJK 93257661
*------------------------------------------------------------* @D61SDJK 93262851
*   SUPPLY PUBX AND PUB2 ADDRESS OF FAILING DEVICE AND         @D61SDJK 93263041
*   ORIGINAL PATH FAILURE INFORMATION.                         @D61SDJK 93263231
*------------------------------------------------------------* @D61SDJK 93263421
*                                                              @D61SDJK 93263611
TERTR150 MVC   32(4,R4),TERAPUBX                               @D61SDJK 93263801
         MVC   36(4,R4),TERAPUB2                               @D61SDJK 93263991
         MVC   40(1,R4),TERINWRK+ERRQPATH-ERBLKADR             @D61SDJK 93264181
*                                                              @D61SDJK 93264371
*------------------------------------------------------------* @D61NDJK 93264561
*   SUPPLY FOOTPRINTS RECORDED DURING SGTAP INITIALIZATION     @D61SDJK 93264751
*   AND IN SUBROUTINE TERUCCB.                                 @D61SDJK 93264941
*------------------------------------------------------------* @D61NDJK 93265131
*                                                              @D61NDJK 93265321
         MVC   41(2,R4),TERT+0                                 @D61SDJK 93265511
         MVC   43(1,R4),TERT+5                                 @D61SDJK 93265701
         XC    46(2,R4),46(R4)                                 @D66ODOW 93265891
*                                                              @D61NDJK 93267661
         B     TERTR900                                        @D61NDJK 93272761
*                                                              @D61NDJK 93287861
*------------------------------------------------------------* @D61NDJK 93302961
*                                                              @D61NDJK 93318061
*   DEBUG ENTRY TYPE 2.                                        @D61NDJK 93333161
*                                                              @D61NDJK 93348261
*------------------------------------------------------------* @D61NDJK 93363361
*                                                              @D61NDJK 93378461
*------------------------------------------------------------* @D61NDJK 93393561
*   SUPPLY CONTROL FLAG, REAL AND VIRTUAL FAILING COMMAND      @D61SDJK 93415651
*   CCW ADDRESSES, VIRTUAL FAILING CCW ADDRESS AND OPCODE.     @D61NDJK 93423761
*------------------------------------------------------------* @D61NDJK 93438861
*                                                              @D61NDJK 93453961
TERTR200 MVC   3(1,R4),TERFLG     SGTAP CONTROL FLAG           @D61SDJK 93476051
         MVC   4(4,R4),TERFCCWV   VIRTUAL FAILING CCW ADDRESS  @D61NDJK 93484161
         MVC   8(4,R4),TERCCCWV   VIRT. FAILING CMD. CCW ADDR. @D61NDJK 93499261
         MVC   12(4,R4),TERCCCWR  REAL FAILING CMD. CCW ADDR.  @D61NDJK 93514361
         MVC   16(1,R4),TERCCCWO  OPCODE OF FAILING CMD. CCW   @D61NDJK 93529461
*                                                              @D61NDJK 93544561
*------------------------------------------------------------* @D61NDJK 93559661
*   SUPPLY RECOVERY ATTRIBUTES.                                @D61NDJK 93574761
*------------------------------------------------------------* @D61NDJK 93589861
*                                                              @D61NDJK 93604961
         MVC   17(1,R4),TERMECC   ERROR CLASSIFICATION CODE    @D61SDJK 93626051
         MVC   18(1,R4),TERRCVSR  RECOVERY ACTION SUBROUTINE   @D61SDJK 93632041
         MVC   19(1,R4),TERMSGID  MESSAGE ID                   @D61SDJK 93638031
         MVC   20(1,R4),TERFLGMR  MESSAGING AND RECORDING FLAG @D61SDJK 93644021
         MVC   21(1,R4),TERFLGPS  POSTING FLAG                 @D61SDJK 93650011
*                                                              @D61NDJK 93656001
*------------------------------------------------------------* @D61SDJK 93661991
*   RESERVED FOR FUTURE USE.                                   @D61SDJK 93669971
*------------------------------------------------------------* @D61SDJK 93673971
*                                                              @D61SDJK 93679961
         XC    22(8,R4),22(R4)                                 @D61SDJK 93695941
*                                                              @D61NDJK 93710661
*------------------------------------------------------------* @D61NDJK 93725761
*   SUPPLY FOOTPRINTS RECORDED IN SGTAP MAIN ROUTINE AND IN    @D61NDJK 93740861
*   SUBROUTINES TERUCCB, TERSCAN, TEREVAL, TERNEWT AND         @D61SDJK 93763941
*   TERBUMP.                                                   @D61SDJK 93766931
*------------------------------------------------------------* @D61NDJK 93771061
*                                                              @D61NDJK 93786161
         MVC   30(1,R4),TERT+1                                 @D61SDJK 93810251
         MVC   31(12,R4),TERT+5                                @D61SDJK 93819241
         XC    43(5,R4),43(R4)                                 @D61SDJK 93828231
*                                                              @D61SDJK 93837221
         B     TERTR900                                        @D61NDJK 93846561
*                                                              @D61NDJK 93861661
*------------------------------------------------------------* @D61NDJK 93876761
*                                                              @D61NDJK 93891861
*   DEBUG ENTRY TYPE 3.                                        @D61NDJK 93906961
*                                                              @D61NDJK 93922061
*------------------------------------------------------------* @D61NDJK 93937161
*                                                              @D61NDJK 93952261
*------------------------------------------------------------* @D61NDJK 93967361
*   SUPPLY THE RETRY COUNTER, THE LENGTH OF BUFFERED LOG       @D61NDJK 93982461
*   DATA, THE MODE SET/OVERRIDE DATA BYTE, THE RECOVERY        @D61SDJK 94007551
*   COMPLETION CODE AND SOME INFORMATION FROM THE ERROR ENTRY. @D61SDJK 94017541
*------------------------------------------------------------* @D61NDJK 94027761
*                                                              @D61NDJK 94042861
TERTR300 MVC   3(1,R4),TERRTCNT                                @D61NDJK 94057961
         MVC   4(2,R4),TERRBLLN                                @D61NDJK 94073061
         MVC   6(1,R4),TERMODE                                 @D61NDJK 94088161
         MVC   7(1,R4),TERRCVCC                                @D61NDJK 94103261
         MVC   8(1,R4),TERINWRK+ERRQFLG-ERBLKADR               @D61NDJK 94118361
         MVC   9(1,R4),TERINWRK+ERRQMSG-ERBLKADR               @D61NDJK 94133461
         MVC   10(1,R4),TERINWRK+ERRQCOMM+2-ERBLKADR           @D61NDJK 94148561
*                                                              @D61NDJK 94163661
*------------------------------------------------------------* @D61SDJK 94164261
*   SUPPLY ALL PUBX PATH MASKS.                                @D61SDJK 94164861
*------------------------------------------------------------* @D61SDJK 94165461
*                                                              @D61SDJK 94166061
         L     R5,TERAPUBX                                     @D61SDJK 94166661
         USING PBXADR,R5                                       @D61SDJK 94167261
         MVC   11(1,R4),PBXPIM                                 @D61SDJK 94167861
         MVC   12(1,R4),PBXPAM                                 @D61SDJK 94168461
         MVC   13(1,R4),PBXLPM                                 @D61SDJK 94169061
         MVC   14(1,R4),PBXNOOPR                               @D61SDJK 94169661
         MVC   15(1,R4),PBXNOQSD                               @D61SDJK 94170261
         MVC   16(1,R4),PBXPVPEN                               @D61SDJK 94170861
         MVC   17(1,R4),PBXNOERP                               @D61SDJK 94171461
         DROP  R5                                              @D61SDJK 94172061
*                                                              @D61SDJK 94172661
*------------------------------------------------------------* @D61SDJK 94173261
*   SUPPLY LAST ERROR CONDITION AND LOGGED RETRY COUNTER.      @D61SDJK 94173861
*------------------------------------------------------------* @D61SDJK 94174461
*                                                              @D61SDJK 94175061
         MVC   18(6,R4),TERLSTER                               @D61SDJK 94175661
         MVC   24(1,R4),TERRTLOG                               @D61SDJK 94176261
*                                                              @D61SDJK 94176861
*------------------------------------------------------------* @D61NDJK 94178761
*   SUPPLY FOOTPRINTS RECORDED IN TERSCAN, TERBUMP, TERDOREC,  @D61NDJK 94193861
*   TERRBL, TERRTY, TERURTY, TERCHKR, TERRESUM, TERPATH,       @D61SDJK 94223951
*   TERIO, TERGETDT, TERMSG, TERLOG, TERALLOC, TERMDR, TEROBR, @D61SDJK 94233941
*   TERA3 AND TERERP.                                          @D61SDJK 94243931
*------------------------------------------------------------* @D61NDJK 94254261
*                                                              @D61NDJK 94269361
         MVC   25(3,R4),TERT+6                                 @D61SDJK 94292451
         MVC   28(4,R4),TERT+17                                @D61SDJK 94300441
         MVC   32(4,R4),TERT+24                                @D61SDJK 94308431
         MVC   36(3,R4),TERT+30                                @D61SDJK 94316421
         MVC   39(7,R4),TERT+39                                @D61SDJK 94324411
         XC    46(2,R4),46(R4)                                 @D61SDJK 94332401
*                                                              @D61NDJK 94344861
         B     TERTR900                                        @D61NDJK 94359961
*                                                              @D61NDJK 94375061
*------------------------------------------------------------* @D61NDJK 94390161
*                                                              @D61NDJK 94405261
*   DEBUG ENTRY TYPE 4.                                        @D61NDJK 94420361
*                                                              @D61NDJK 94435461
*------------------------------------------------------------* @D61NDJK 94450561
*                                                              @D61NDJK 94465661
*------------------------------------------------------------* @D61NDJK 94480761
*   SUPPLY THE TAPEXIT RETURN CODE, THE LOW CORE CSW AND THE   @D61NDJK 94495861
*   POINTER TO THE CURRENT GLOBAL WORK AREA.                   @D61NDJK 94510961
*------------------------------------------------------------* @D61NDJK 94526061
*                                                              @D61NDJK 94541161
TERTR400 MVC   3(1,R4),TEREXITC                                @D61NDJK 94556261
         MVC   4(8,R4),TERWKCSW                                @D61NDJK 94571361
         ST    RA,12(R4)                                       @D61NDJK 94586461
*                                                              @D61NDJK 94601561
*------------------------------------------------------------* @D61NDJK 94616661
*   SUPPLY FOOTPRINTS RECORDED IN SGTAP MAIN ROUTINE AND       @D61NDJK 94631761
*   DURING FINAL PROCESSING.                                   @D61NDJK 94646861
*------------------------------------------------------------* @D61NDJK 94661961
*                                                              @D61NDJK 94677061
         MVC   16(4,R4),TERT+1                                 @D61NDJK 94692161
*                                                              @D61NDJK 94707261
         OC    TERTACCU,TERT      ACCUMULATE FOOTPRINTS        @D61NDJK 94722361
*                                                              @D61NDJK 94737461
*------------------------------------------------------------* @D61NDJK 94752561
*   SUPPLY LATEST PATH FAILURE INFORMATION, THE CHANNEL QUEUE  @D61NDJK 94772661
*   ADDRESS, THE ERROR QUEUE CSW, THE FAILING JOB NAME AND     @D61SDJK 94798751
*   THE CURRENT TOD CLOCK.                                     @D61SDJK 94804741
*------------------------------------------------------------* @D61NDJK 94812961
*                                                              @D61NDJK 94828061
         MVC   20(4,R4),TERINWRK+ERRQCHQA-ERBLKADR             @D61NDJK 94858261
         MVC   20(1,R4),TERINWRK+ERRQPATH-ERBLKADR             @D61NDJK 94865761
         MVC   24(8,R4),TERINWRK+ERRQCSW-ERBLKADR              @D61NDJK 94873361
         MVC   32(8,R4),TERFJOBN                               @D61SDJK 94878361
         STCK  40(R4)                                          @D61SDJK 94883361
*                                                              @D61NDJK 94888461
         B     TERTR900                                        @D61NDJK 94903561
*                                                              @D61NDJK 94918661
*------------------------------------------------------------* @D61NDJK 94933761
*                                                              @D61NDJK 94948861
*   DEBUG ENTRY TYPE 5.                                        @D61NDJK 94963961
*                                                              @D61NDJK 94979061
*------------------------------------------------------------* @D61NDJK 94994161
*                                                              @D61NDJK 95009261
*------------------------------------------------------------* @D61NDJK 95024361
*   SUPPLY THE READ OPPOSITE/ALTERNATE RECOVERY WORK FIELDS.   @D61SDJK 95046451
*------------------------------------------------------------* @D61NDJK 95054561
*                                                              @D61NDJK 95069661
TERTR500 MVC   3(1,R4),TERROFLG                                @D61NDJK 95084761
         MVC   4(4,R4),TERROWAL                                @D61NDJK 95099861
         MVC   8(4,R4),TERROACC                                @D61SDJK 95106861
*                                                              @D61NDJK 95114961
*------------------------------------------------------------* @D61NDJK 95130061
*   SUPPLY THE READ OPPOSITE/ALTERNATE RECOVERY CCWS.          @D61SDJK 95152151
*------------------------------------------------------------* @D61NDJK 95160261
*                                                              @D61NDJK 95163261
         MVC   12(8,R4),TERCCWRO                               @D61SDJK 95166261
         MVC   20(8,R4),TERCCWRA                               @D61SDJK 95169261
         MVC   28(8,R4),TERCCWRP                               @D61SDJK 95172261
*                                                              @D61NDJK 95175361
*------------------------------------------------------------* @D61NDJK 95235761
*   SUPPLY FOOTPRINTS RECORDED IN SUBROUTINES TERROR, TERRAR,  @D61SDJK 95260851
*   TERRDOA, TERSIMRD, TERCCWDO, TERXFER, AND TERBPIDA.        @D61SDJK 95270841
*------------------------------------------------------------* @D61NDJK 95281061
*                                                              @D61NDJK 95296161
         MVC   36(3,R4),TERT+21                                @D61SDJK 95316251
         MVC   39(2,R4),TERT+28                                @D61SDJK 95321241
         MVC   41(2,R4),TERT+33                                @D61SDJK 95326231
         MVC   43(2,R4),TERT+37                                @D61SDJK 95331221
         XC    45(3,R4),45(R4)                                 @D61SDJK 95336211
*                                                              @D61NDJK 95341461
*------------------------------------------------------------* @D61NDJK 95356561
*                                                              @D61NDJK 95371661
*   ADVANCE TO THE NEXT DEBUG ENTRY.                           @D61NDJK 95386761
*                                                              @D61NDJK 95401861
*------------------------------------------------------------* @D61NDJK 95416961
*                                                              @D61NDJK 95432061
TERTR900 LH    R4,TERDBGAC        ADVANCE TO THE NEXT ENTRY..  @D61NDJK 95447161
         LA    R4,48(,R4)           IN THE DEBUG AREA..        @D61SDJK 95468251
         L     R5,TERDBGMS          BY BUMPING IN THE..        @D61SDJK 95474241
         CR    R4,R5                WRAP AROUND AREA           @D61SDJK 95480231
         BL    TERTR950                                        @D61SDJK 95486221
         LA    R4,0                                            @D61SDJK 95492211
TERTR950 STH   R4,TERDBGAC                                     @D61SDJK 95498201
*                                                              @D61NDJK 95507561
*------------------------------------------------------------* @D61NDJK 95522661
*                                                              @D61NDJK 95537761
*   EXIT HANDLING.                                             @D61NDJK 95552861
*                                                              @D61NDJK 95567961
*------------------------------------------------------------* @D61NDJK 95583061
*                                                              @D61NDJK 95598161
TERTRAEX SGTAP 'RETURN4        ','RETURN TO CALLER         '   @D61NDJK 95613261
         SGTAP 'DROPALL        ','END OF CODEBLOCK'            @D61NDJK 95628361
         LTORG                                                 @D61NDJK 95643461
*                                                              @D61NDJK 95658561
*------------------------------------------------------------* @D61NDJK 95673661
*                                                              @D61NDJK 95688761
*   LOCAL VARIABLES USED IN TERTRACE                           @D61NDJK 95703861
*                                                              @D61NDJK 95718961
*------------------------------------------------------------* @D61NDJK 95734061
*                                                              @D61NDJK 95749161
*------------------------------------------------------------* @D61NDJK 95764261
*   FOOTPRINTS AND DEBUG AREA                                  @D61NDJK 95779361
*------------------------------------------------------------* @D61NDJK 95794461
*                                                              @D61NDJK 95809561
TERTACCU DC   XL46'00'     KEPT FOOTPRINTS FROM ALL..          @D61SDJK 95835641
*                            RUNS. THIS IS TO LEAVE..          @D61NDJK 95839761
*                            PERMANENT FOOTPRINTS..            @D61NDJK 95854861
*                            FROM IPL ONWARDS                  @D61NDJK 95869961
         ORG  ((((*+15-IJBTER)/16)*16)+IJBTER)                 @D61SDJK 95876961
TERDBGST DC   C'TERDEBUG'                                      @D61NDJK 95885061
TERDBGMS DC   A(X'17FF')   LENGTH OF WRAP AROUND AREA          @D61SDJK 95907151
TERDBGAC DC   H'0'         CURRENT OFFSET IN AREA              @D61NDJK 95915261
TERDBGNR DC   H'0'         NR OF I/O ERROR PROCESSED           @D61NDJK 95930361
         ORG  ((((*+15-IJBTER)/16)*16)+IJBTER)                 @D61SDJK 95955451
TERDEBUG DC   128XL48'00'  SPACE FOR 128 DEBUG ENTRIES         @D61SDJK 95965441
TERDBGLN EQU  *-TERDBGST                                       @D61SDJK 95970441
*                                                              @D61NDJK 95975661
         EJECT                                                 @D61NDJK 95990761
*                                                              @D61NDJK 95990781
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 95990801
*                                                                     * 95990821
*     FAST SENSE DATA ANALYSIS ROUTINE. CALLED BY SGTAP.              * 95990841
*                                                                     * 95990861
*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX* 95990881
*                                                              @D61NDJK 95990901
*------------------------------------------------------------* @D61NDJK 95990921
*                                                              @D61NDJK 95990941
*  FUNCTION                                                    @D61NDJK 95990961
*    THIS ROUTINE IS ENTERED BY                                @D61NDJK 95990981
*        SGTAP SUBROUTINE TEREVAL IN ORDER TO EVALUATE         @D61NDJK 95991001
*        SENSE DATA                                            @D61NDJK 95991021
*                                                              @D61NDJK 95991041
*    AND MAY BE ENTERED BY THE SENSE TASK IMMEDIATELY AFTER    @D61NDJK 95991061
*    IT RETRIEVED SENSE DATA. THIS SERVES TWO PURPOSES:        @D61NDJK 95991081
*        A) THE SENSE DATA MAY INDICATE, THAT A PATH GROUP     @D61NDJK 95991101
*           ID HAS TO BE SET AGAIN BY VSE. THIS CAN ONLY       @D61NDJK 95991121
*           BE DONE BY THE SENSE TASK, WHICH IS THE ONLY       @D61NDJK 95991141
*           TASK IN THE SYSTEM, THAT IS DOING IO WITHOUT       @D61NDJK 95991161
*           A WAIT. SO NO OTHER TASKS IO GETS STARTED AND      @D61NDJK 95991181
*           USES A PATH WHICH HAS NOT BEEN VERIFIED TO LEAD    @D61NDJK 95991201
*           TO THE CORRECT DEVICE. IF SENSE DATA INDICATE      @D61NDJK 95991221
*           THAT A PATH GROUP ID MAY HAVE BEEN LOST, THE       @D61NDJK 95991241
*           SENSE TASK HAS CORRECTED THE PATHING INFORMATION   @D61NDJK 95991261
*           BEFORE SGTAP IS ENTERED. SGTAP CAN KEEP ON         @D61NDJK 95991281
*           PROCESSING NORMALLY RETRIES OR OTHER RECOVERY      @D61NDJK 95991301
*           ACTIONS.                                           @D61NDJK 95991321
*        B) TERFAST IS PART OF MINIMAL ERROR RECOVERY FOR      @D61NDJK 95991341
*           USERS THAT HAVE SPECIFIED USER OWN ERROR ROUTINE   @D61NDJK 95991361
*           IN ITS CCB. THE SENSE DATA INDICATES WHETHER THE   @D61NDJK 95991381
*           ERROR CONDITION IS RETRYABLE, PERMANENT OR EVEN    @D61NDJK 95991401
*           IS TO IGNORE. FOR USERS WITH USER OWN ERROR        @D61NDJK 95991421
*           ROUTINE (EXCEPT ERP TASK), THE SENSE TASK MAY      @D61NDJK 95991441
*           NOW DIRECTLY PERFORM MINIMAL ERROR RECOVERY AFTER  @D61NDJK 95991461
*           HAVING SET UP A RECONLY DEVICE ERROR ENTRY WHICH   @D61NDJK 95991481
*           IS PASSED TO SGTAP FOR RECORDING.                  @D61NDJK 95991501
*                                                              @D61NDJK 95991521
*  INPUT:                                                      @D61NDJK 95991541
*    - RF = BASE ADDRESS OF ROUTINE. LOADED ON ENTRY           @D61NDJK 95991561
*    - RE = RETURN ADDRESS                                     @D61NDJK 95991581
*    - R2 = POINTER TO DEVICE ERROR ENTRY                      @D61NDJK 95991601
*                                                              @D61NDJK 95991621
*  RETURN IS TO  RE+0  IF SENSE DATA INDICATED THAT THE        @D61NDJK 95991641
*                      MINIMAL ERROR RECOVERY ACTION IS        @D61NDJK 95991661
*                      IGNORE.                                 @D61NDJK 95991681
*                RE+4  IF SENSE DATA INDICATED THAT THE        @D61NDJK 95991701
*                      MINIMAL ERROR RECOVERY ACTION IS        @D61NDJK 95991721
*                      RETRY.                                  @D61NDJK 95991741
*                RE+8  IF SENSE DATA INDICATED THAT THE        @D61NDJK 95991761
*                      PATH GROUP ID OF THE DEVICE WAS LOST.   @D61NDJK 95991781
*                      SNS TASK SHOULD DO PATH VERIFICATION    @D61NDJK 95991801
*                      BEFORE ENTERING SGTAP FOR FURTHER       @D61NDJK 95991821
*                      PROCESSING. MINIMAL ERROR RECOVERY      @D61NDJK 95991841
*                      ACTION BY SENSE TASK SHOULD BE RETRY.   @D61NDJK 95991861
*                RE+12 IF SENSE DATA INDICATED THAT THE        @D61NDJK 95991881
*                      MINIMAL ERROR RECOVERY ACTION IS        @D61NDJK 95991901
*                      DEFERRED RETRY.                         @D61NDJK 95991921
*                RE+16 IF SENSE DATA INDICATED THAT THE        @D61NDJK 95991941
*                      MINIMAL ERROR RECOVERY ACTION IS        @D61NDJK 95991961
*                      UNCONDITIONAL SURRENDER.                @D61NDJK 95991981
*                                                              @D61NDJK 95992001
*  OUTPUT        R15   CONTAINS THE MAIN ERROR CLASSIFICATION  @D61NDJK 95992021
*                      CODE FOR FURTHER SGTAP PROCESSING       @D61NDJK 95992041
*                                                              @D61NDJK 95992061
*------------------------------------------------------------* @D61NDJK 95992081
*                                                              @D61NDJK 95992101
TERFAST  DS    0H                                              @D61NDJK 95992121
         USING TERFAST,RF         BASE REGISTER OF ROUTINE     @D61NDJK 95992141
         USING ERBLKADR,R2        PTR TO DEVICE ERROR ENTRY    @D61NDJK 95992161
         STM   R0,RF,TERFASV      SAVE ALL REGS                @D61NDJK 95992181
         LR    RC,RF              TAKE RC AS BASE AS USUAL     @D61NDJK 95992201
         DROP  RF                                              @D61NDJK 95992221
         USING TERFAST,RC                                      @D61NDJK 95992241
*                                                              @D61NDJK 95992261
*------------------------------------------------------------* @D61NDJK 95992281
*   TAKE ERA CODE IN SENSE BYTE 3 AS MAIN ERROR                @D61NDJK 95992301
*   CLASSIFICATION CODE.                                       @D61NDJK 95992321
*------------------------------------------------------------* @D61NDJK 95992341
*                                                              @D61NDJK 95992361
         SLR   RF,RF              SET MECC TO ERA CODE FROM..  @D61NDJK 95992381
         ICM   RF,1,ERRQSNS+3       SENSE BYTE 3               @D61SDJK 95992401
*                                                              @D61NDJK 95992421
*------------------------------------------------------------* @D61NDJK 95992441
*   ANALYZE MAIN ERROR CLASSIFICATION CODE FOR EXIT            @D61NDJK 95992461
*   TO RE+0  - MINIMAL ERROR RECOVERY ACTION IS IGNORE         @D61NDJK 95992481
*      RE+4  - MINIMAL ERROR RECOVERY ACTION IS RETRY          @D61NDJK 95992501
*      RE+8  - SENSE TASK SHOULD ISSUE PATH VERIFICATION AND   @D61NDJK 95992521
*              MINIMAL ERROR RECOVERY ACTION IS RETRY          @D61NDJK 95992541
*      RE+12 - MINIMAL ERROR RECOVERY ACTION IS DEFERRED       @D61NDJK 95992561
*              RETRY                                           @D61NDJK 95992581
*      RE+16 - MINIMAL ERROR RECOVERY ACTION IS UNCONDITIONAL  @D61NDJK 95992601
*              SURRENDER                                       @D61NDJK 95992621
*------------------------------------------------------------* @D61NDJK 95992641
*                                                              @D61NDJK 95992661
         LR    R5,RF              FIND OUT IF WE..             @D61NDJK 95992681
         N     R5,=A(255)           SHOULD LEAVE TO +0         @D61NDJK 95992701
         C     R5,=A(TER2B)       ENVIRONMENTAL DATA PRESENT?  @D61NDJK 95992721
         BE    TERFAEX0           YES                          @D61NDJK 95992741
         C     R5,=A(TER52)       END OF VOLUME COMPLETE?      @D61NDJK 95992761
         BE    TERFAEX0           YES                          @D61NDJK 95992781
*                                 FIND OUT IF WE..             @D61NDJK 95992801
*                                   SHOULD LEAVE TO +4         @D61NDJK 95992821
         C     R5,=A(TER21)       DATA STREAMING NOT OPER?     @D61NDJK 95992841
         BE    TERFAEX4           YES                          @D61NDJK 95992861
         C     R5,=A(TER2A)       UNSOLIC. ENVIRONMENTAL DATA? @D61NDJK 95992881
         BE    TERFAEX4           YES                          @D61NDJK 95992901
         C     R5,=A(TER42)       DEGRADED MODE?               @D61NDJK 95992921
         BE    TERFAEX4           YES                          @D61NDJK 95992941
         C     R5,=A(TER48)       UNSOLIC. INFORMATIONAL DATA? @D61NDJK 95992961
         BE    TERFAEX4           YES                          @D61NDJK 95992981
         C     R5,=A(TER4C)       RECOVERED CHECK-ONE FAILURE? @D61NDJK 95993001
         BE    TERFAEX4           YES                          @D61NDJK 95993021
         C     R5,=A(TER50)       READ BUFFERED LOG OVERFLOW?  @D61NDJK 95993041
         BE    TERFAEX4           YES                          @D61NDJK 95993061
         C     R5,=A(TER51)       READ BUFFERED LOG EOV?       @D61NDJK 95993081
         BE    TERFAEX4           YES                          @D61NDJK 95993101
         C     R5,=A(TER53)       GLOBAL COMMAND INTERCEPT?    @D61NDJK 95993121
         BE    TERFAEX4           YES                          @D61NDJK 95993141
         C     R5,=A(TER54)       TEMP. CHANNEL INTERFACE REC.?@D61NDJK 95993161
         BE    TERFAEX4           YES                          @D61NDJK 95993181
*                                 FIND OUT IF WE..             @D61NDJK 95993201
*                                   SHOULD LEAVE TO +8         @D61NDJK 95993221
         C     R5,=A(TER4D)       RESETTING EVENT?             @D61NDJK 95993241
         BE    TERFAEX8           YES                          @D61NDJK 95993261
*                                 FIND OUT IF WE..             @D61NDJK 95993281
*                                   SHOULD LEAVE TO +12        @D61NDJK 95993301
         C     R5,=A(TER33)       LOAD FAILURE?                @D61NDJK 95993321
         BE    TERFAEXC           YES                          @D61NDJK 95993341
         C     R5,=A(TER34)       UNLOAD FAILURE?              @D61NDJK 95993361
         BE    TERFAEXC           YES                          @D61NDJK 95993381
         C     R5,=A(TER3A)       DRIVE SWITCHED TO NOT READY? @D61NDJK 95993401
         BE    TERFAEXC           YES                          @D61NDJK 95993421
         C     R5,=A(TER43)       DRIVE NOT READY              @D61NDJK 95993441
         BE    TERFAEXC           YES                          @D61NDJK 95993461
         C     R5,=A(TER46)       DRIVE NOT ONLINE?            @D61NDJK 95993481
         BE    TERFAEXC           YES                          @D61NDJK 95993501
*                                                              @D61NDJK 95993521
         B     TERFAEXG           LEAVE TO +16 FOR ALL..       @D61NDJK 95993541
*                                   OTHER CASES                @D61NDJK 95993561
TERFAEX0 LM    R0,RE,TERFASV                                   @D61NDJK 95993581
         B     0(,RE)                                          @D61NDJK 95993601
TERFAEX4 LM    R0,RE,TERFASV                                   @D61NDJK 95993621
         B     4(,RE)                                          @D61NDJK 95993641
TERFAEX8 LM    R0,RE,TERFASV                                   @D61NDJK 95993661
         B     8(,RE)                                          @D61NDJK 95993681
TERFAEXC LM    R0,RE,TERFASV                                   @D61NDJK 95993701
         B     12(,RE)                                         @D61NDJK 95993721
TERFAEXG LM    R0,RE,TERFASV                                   @D61NDJK 95993741
         B     16(,RE)                                         @D61NDJK 95993761
         SGTAP 'DROPALL        ','*'                           @D61NDJK 95993781
*                                                              @D61NDJK 95993801
TERFASV  DC    16F'0'             STACK FOR SUBROUTINE TERFAST @D61NDJK 95993821
*                                                              @D61NDJK 95993841
         LTORG                                                 @D61NDJK 95993861
         EJECT                                                          95993881
*                                                              @D61NDJK 95993901
.TPNOC04 ANOP                                                  @D61SDJK 95993921
*------------------------------------------------------------* @D61NDJK 95993941
*                                                              @D61NDJK 95993961
*   GLOBAL WORK AREA DSECT                                     @D61NDJK 95993981
*                                                              @D61NDJK 95994001
*------------------------------------------------------------* @D61NDJK 95994021
*------------------------------------------------------------* @D61NDJK 95994041
*                                                              @D61NDJK 95994061
*   BEGIN OF GLOBAL WORK AREA PART 1                           @D61NDJK 95994081
*                                                              @D61NDJK 95994101
*------------------------------------------------------------* @D61NDJK 95994121
*------------------------------------------------------------* @D61NDJK 95994141
*   SGTAP FLOW CONTROL FLAGS AND ORIGINAL ERROR PROPERTIES     @D61NDJK 95994161
*------------------------------------------------------------* @D61NDJK 95994181
TERGLOB  DSECT             GLOBAL WORK AREA                    @D61NDJK 95994201
*------------------------------------------------------------* @D61NDJK 95994221
         DS   8C           GLOBAL WORK AREA HEADER             @D61NDJK 95994241
*------------------------------------------------------------* @D61NDJK 95994261
TERGWAP1 DS   0F           BEGIN OF GLOBAL WORK AREA PART1     @D61NDJK 95994281
*------------------------------------------------------------* @D61NDJK 95994301
TERFLG   DS   X            MISCELLANEOUS BIT FLAGS             @D61NDJK 95994321
TERCVGAU EQU  B'10000000'  GLOBAL AREA IS ALREADY USED         @D61NDJK 95994341
TERCVCSW EQU  B'01000000'  PROVIDE TERCCB CSW AS LOW CORE CSW  @D61NDJK 95994361
TERCVPRF EQU  B'00100000'  FAILING CCW IS A PREFIX COMMAND CCW @D61NDJK 95994381
TERCVREW EQU  B'00010000'  TAPE UNL=REW WAS SPECIFIED          @D61NDJK 95994401
*        EQU  B'00001000'  RESERVED                            @D61NDJK 95994421
TERCVHIG EQU  B'00000100'  MESSAGE MUST BE HIGHLIGHTED         @D63HDJK 95994441
TERCVMSG EQU  B'00000010'  MESSAGING SHOULD BE DONE..          @D61NDJK 95994461
*                            WHILE WAITING FOR I/O COMPLETION  @D61NDJK 95994481
TERCVOIR EQU  B'00000001'  TAPE IS INTERVENTION REQUIRED       @DA43697 95994501
*------------------------------------------------------------* @D61NDJK 95994521
TEROEFLG DS   X            FLAGS CHARACTERIZING THE ORIG.ERROR @D61NDJK 95994541
TEROEUCU EQU  B'10000000'  USER CCB IS NOT AVAILABLE           @D61NDJK 95994561
TEROEUIC EQU  B'01000000'  UNSOLICITED INTERRUPT ERROR         @D61NDJK 95994581
TEROEPST EQU  B'00100000'  USER CCB IS ALREADY POSTED          @D61SDJK 95994601
TEROEMEL EQU  B'00010000'  MINIMAL ERP LAYER                   @D61NDJK 95994621
TEROEFOP EQU  B'00001000'  OPEN FILE INDICATED IN P2FLAGS      @D61NDJK 95994641
TEROESNS EQU  B'00000100'  USER ONLY WANTS TO SEE SENSE DATA   @D61SDJK 95994671
*        EQU  B'00000010'  RESERVED                            @D61NDJK 95994681
*        EQU  B'00000001'  RESERVED                            @D61NDJK 95994701
*------------------------------------------------------------* @D61NDJK 95994721
TERDEVTY DS   X            DEVICE TYPE CODE OF FAILING DEVICE  @D61NDJK 95994741
TER3424  EQU  X'00'        IT IS A 3424 DEVICE                 @D61NDJK 95994761
TER9348  EQU  X'01'        IT IS A 9348 DEVICE                 @D61NDJK 95994781
TER3480  EQU  X'02'        IT IS A 3480, 3490 OR 3490E DEVICE  @D61NDJK 95994801
TERTPA   EQU  X'03'        IT IS A TPA DEVICE                  @D61SDJK 95994821
*------------------------------------------------------------* @D61NDJK 95994841
         DS   X            RESERVED                            @D66ODOW 95994861
*------------------------------------------------------------* @D61NDJK 95994881
TERAPUBX DS   XL4          PUBX ADDRESS OF FAILING DEVICE      @D61NDJK 95994901
TERAPUB2 DS   XL4          PUB2 ADDRESS OF FAILING DEVICE      @D61NDJK 95994921
*------------------------------------------------------------* @D61SDJK 95994941
TERLSTER DS   XL6          THE LAST ERROR WE ENCOUNTERED...    @D61SDJK 95994961
*                            THE VALUE TAKEN FOR COMPARISON..  @D61SDJK 95994981
*                            IS  1) TERMECC,                   @D61SDJK 95995001
*                                2) CCW ADDRESS FROM CSW       @D61SDJK 95995001
*                                3) SENSE BYTE 4 & 5 (TPA ONLY)@D61SDJK 95995021
*------------------------------------------------------------* @D61NDJK 95995061
TERFJOBN DS   CL8          FAILING JOB NAME                    @D61NDJK 95995081
*------------------------------------------------------------* @D61NDJK 95995101
TERRTCNT DS   X            NUMBER OF CONSECUTIVE RETRIES DONE  @D61NDJK 95995121
TERRTLOG DS   X            RETRY COUNTER TO BE LOGGED IN OBR   @D61NDJK 95995141
TERRTLIM EQU  10           RETRY LIMIT                         @DY46166 95995161
*------------------------------------------------------------* @D61NDJK 95995181
TERCHQID DS   H            TASK-ID OF I/O REQUESTOR            @D66ODOW         
         AIF  (&IJBSGEN).INSUPV8                               @D66ODOW         
ARTID    EQU  32                                               @D66ODOW         
SVTTID   EQU  15                                               @D66ODOW         
.INSUPV8 ANOP                                                  @D66ODOW         
*------------------------------------------------------------* @D61NDJK 95995181
TERWKCSW DS   D            WORK CSW THAT WILL BE USED..        @D61NDJK 95995201
*                            TO UPDATE THE LOW CORE CSW        @D61NDJK 95995221
*------------------------------------------------------------* @D61NDJK 95995241
TEREXITC DS   X            EXIT CODE SELECTED AFTER RECOVERY   @D61NDJK 95995261
TEREXIGN EQU  X'00'        IGNORE EXIT CODE                    @D61NDJK 95995281
TEREXCAN EQU  X'01'        CANCEL EXIT CODE                    @D61NDJK 95995301
TEREXRTY EQU  X'02'        RETRY EXIT CODE                     @D61NDJK 95995321
TEREXDSP EQU  X'03'        DISPATCHER EXIT CODE                @D61NDJK 95995341
TEREXLBY EQU  X'04'        LONG BUSY EXIT CODE                 @D61SDJK 95995361
*------------------------------------------------------------* @D61NDJK 95995381
TERSVCCB DS   XL(16)       SAVE AREA FOR THE CCB IF SOME..     @D66ADAP 95995401
*                            REQUEST MUST BE EXECUTED FIRST    @D61NDJK 95995421
TERS2CCB DS   XL(16)       2ND SAVE AREA FOR THE CCB IF SOME.. @D66ADAP 95995441
*                            REQUEST MUST BE EXECUTED FIRST    @D61NDJK 95995461
TERCURPI DS   X            CURRENT PATH FAILURE INFORMATION    @D61NDJK 95995481
TERCURSL DS   X            CURRENT LENGTH OF SENSE DATA        @D61SDJK 95995501
TERSAVSR DS   XL(TERRATBL) SAVE AREA FOR RECOVERY ATTRIBUTES   @D61NDJK 95995521
*------------------------------------------------------------* @D61NDJK 95995541
*   COPY OF ORIGINAL ERROR ENTRY                               @D61NDJK 95995561
*------------------------------------------------------------* @D61NDJK 95995581
TERINWRK DS   XL(ERBLKHDL+L'ERRQ)                              @D61NDJK 95995601
*------------------------------------------------------------* @D61NDJK 95995621
*   SGTAP CCB                                                  @D61NDJK 95995641
*------------------------------------------------------------* @D61NDJK 95995661
         DS   0D           DOUBLE WORD BOUNDAY FOR SGTAP CCB   @D61NDJK 95995681
TERCCB   DS   XL24         SGTAP CCB                           @D61NDJK 95995701
TERSNS   DS   XL32         SENSE DATA RETURNED TO SGTAP        @D61NDJK 95995721
*------------------------------------------------------------* @D61NDJK 95995741
*   SGTAP CCWS                                                 @D61NDJK 95995761
*------------------------------------------------------------* @D61NDJK 95995781
         DS   0D           DOUBLE WORD BOUNDAY FOR RBL CCW     @D61NDJK 95995801
TERCCWRB DS   XL8          READ BUFFERED LOG CCW               @D61NDJK 95995821
TERRBLOP EQU  X'24'        READ BUFFERED LOG OPCODE            @D61NDJK 95995841
TERRBLBC EQU  256          NUMBER OF LOG DATA BYTES EXPECTED   @D61SDJK 95995861
*------------------------------------------------------------* @D61NDJK 95995981
         DS   0D           DOUBLE WORD BOUNDAY FOR RETRY..     @D61NDJK 95996001
*                            AND RESUME CCWS                   @D61NDJK 95996021
TERCCW00 DS   XL8          PREFIX 0 CCW                        @D61SDJK 95996041
TERCCW01 DS   XL8          PREFIX 1 CCW                        @D61SDJK 95996061
TERCCW02 DS   XL8          TIC CCW                             @D61SDJK 95996081
*------------------------------------------------------------* @D61NDJK 95996121
         DS   0D           DOUBLE WORD BOUNDAY FOR ROR/RAR CCWS@D61NDJK 95996141
TERCCWRA DS   XL8          READ ALTERNATE CCW                  @D61SDJK 95996161
TERCCWRO DS   XL8          READ OPPOSITE CCW                   @D61NDJK 95996181
TERCCWRP DS   XL8          REPOSITIONING CCW                   @D61NDJK 95996201
TERCCWFK DS   XL8          FAKE CCW (GETDADR ADDR. TRANSLATION)@D61NDJK 95996221
TERFSBOP EQU  X'37'        FORWARD SPACE BLOCK OPCODE          @D61NDJK 95996241
TERBSBOP EQU  X'27'        BACKSPACE BLOCK OPCODE              @D61NDJK 95996261
*------------------------------------------------------------* @D61NDJK 95996281
         DS   0D           DOUBLE WORD BOUNDAY FOR RUN CCW     @D61NDJK 95996301
TERCCWRU DS   XL8          REWIND UNLOAD CCW                   @D61NDJK 95996321
*------------------------------------------------------------* @D61NDJK 95996341
         DS   0D           DOUBLE WORD BOUNDAY FOR..           @D61NDJK 95996361
TERCCWCH DS   XL8            CHANNEL CHAINING/DATA CHECK CCW   @D61NDJK 95996381
TERRBOP  EQU  X'12'        READ BUFFER OPCODE                  @D61NDJK 95996401
*------------------------------------------------------------* @D61NDJK 95996421
*   FOOTPRINTS                                                 @D61NDJK 95996441
*------------------------------------------------------------* @D61NDJK 95996461
TERDBGIO DS   H            CURRENT I/O NUMBER IN DEBUG AREA    @D61NDJK 95996481
*------------------------------------------------------------* @D61NDJK 95996501
TERT     DS   XL46         TRACE BITMAP FOR FOOTPRINTS. THE..  @D61SDJK 95996531
*                            BITS IN IT ARE SET BY SGCOV..     @D61NDJK 95996541
*                            INVOCATIONS                       @D61NDJK 95996561
*------------------------------------------------------------* @D61NDJK 95996581
*                                                              @D61NDJK 95996601
*   BEGIN OF GLOBAL WORK AREA PART 2                           @D61NDJK 95996621
*                                                              @D61NDJK 95996641
*------------------------------------------------------------* @D61NDJK 95996661
*------------------------------------------------------------* @D61NDJK 95996681
TERGWAP2 DS   0F           BEGIN OF GLOBAL WORK AREA PART 2    @D61NDJK 95996701
*------------------------------------------------------------* @D61NDJK 95996721
TERGWAL1 EQU  *-TERGWAP1   LENGTH OF GLOBAL WORK AREA PART 1   @D61NDJK 95996741
*------------------------------------------------------------* @D61NDJK 95996761
*------------------------------------------------------------* @D61NDJK 95996781
*   ACTUAL ERROR PROPERTIES                                    @D61NDJK 95996801
*------------------------------------------------------------* @D61NDJK 95996821
TERFCCWV DS   A            VIRTUAL ADDRESS OF FAILING CCW      @D61NDJK 95996841
TERCCCWV DS   A            VIRTUAL ADDRESS OF FAILING CMD. CCW @D61NDJK 95996861
TERCCCWR DS   A            REAL ADDRESS OF FAILING CMD. CCW    @D61NDJK 95996881
TERCCCWO DS   X            OPCODE OF FAILING COMMAND CCW       @D61NDJK 95996901
*------------------------------------------------------------* @D61NDJK 95996921
TERMECC  DS   X            MAIN ERROR CLASSIFICATION CODE      @D61NDJK 95996941
*------------------------------------------------------------* @D61NDJK 95996961
TERRBLLN DS   H            LENGTH OF BUFFERED LOG DATA         @D61NDJK 95996981
*------------------------------------------------------------* @D61SDJK 95997001
TERMODE  DS   X            MODE SET/OVERRIDE DATA BYTE TO..    @D61SDJK 95997081
*                            BE USED FOR RETRIES               @D61SDJK 95997101
*------------------------------------------------------------* @D61NDJK 95997121
TERRCVCC DS   X            ERROR RECOVERY COMPLETION CODE      @D61NDJK 95997141
TERERSUC EQU  X'00'        SUCCESSFUL RECOVERY                 @D61NDJK 95997161
TERERUNS EQU  X'01'        RECOVERY EXHAUSTED OR UNSUCCESSFUL  @D61NDJK 95997181
TERERAEC EQU  X'02'        ANOTHER ERROR CONDITION OCCURRED    @D61NDJK 95997201
TERERRTY EQU  X'03'        USER RETRY IS NECESSARY             @D61NDJK 95997221
TERERLBY EQU  X'04'        LONG BUSY RECOVERY IS REQUIRED      @D61SDJK 95997241
*------------------------------------------------------------* @D61NDJK 95997261
*   RECOVERY ATTRIBUTES                                        @D61NDJK 95997281
*------------------------------------------------------------* @D61NDJK 95997301
TERRAVAL DS   0H           RECOVERY ATTRIBUTE TABLE ENTRY      @D61NDJK 95997321
TERRCVSR DS   X            INDEX FOR SUBROUTINE THAT..         @D61NDJK 95997341
*                            EXECUTES RECOVERY ACTION          @D61NDJK 95997361
TERMSGID DS   X            MESSAGE NUMBER ASSOCIATED..         @D61NDJK 95997381
*                            WITH THAT ERROR CONDITION         @D61NDJK 95997401
TERFLGMR DS   X            ATTRIBUTE FLAGS FOR MESSAGING..     @D61NDJK 95997421
*                            AND RECORDING                     @D61NDJK 95997441
TERMRPO  EQU  B'10000000'  UNCOND. RECORDING OF A PERMANENT OBR@D61NDJK 95997461
TERMRTO  EQU  B'01000000'  UNCOND. RECORDING OF A TEMPORARY OBR@D61NDJK 95997481
TERMR90M EQU  B'00100000'  UNCOND. RECORDING OF A TYPE 90 MDR  @D61NDJK 95997501
TERMR91M EQU  B'00010000'  UNCOND. RECORDING OF A TYPE 91 MDR  @D61NDJK 95997521
TERMRA3  EQU  B'00001000'  UNCOND. RECORDING OF AN A3          @D61SDJK 95997541
TERMRCR  EQU  B'00000100'  RECORDING ONLY IF ERROR PERSISTS    @D61NDJK 95997561
TERMRCM  EQU  B'00000010'  MESSAGING ONLY IF ERROR PERSISTS    @D61NDJK 95997581
TERMRIM  EQU  B'00000001'  UNCONDITIONAL MESSAGING             @D61NDJK 95997601
TERMRMDR EQU  TERMR90M+TERMR91M    AN MDR HAS TO BE RECORDED   @D61NDJK 95997621
TERMROBR EQU  TERMRPO+TERMRTO  OBR RECORDING MIGHT BE REQUIRED @D61NDJK 95997641
*                                                              @D61NDJK 95997661
TERFLGPS DS   X            ATTRIBUTE FLAGS FOR POSTING..       @D61NDJK 95997681
*                            I/O REQUEST                       @D61NDJK 95997701
TERPSRDC EQU  B'10000000'  INDICATE TAPE READ DATA CHECK IN CCB@D61NDJK 95997721
TERPSCNT EQU  B'01000000'  INCREMENT PUB2 ERROR COUNTERS       @D61NDJK 95997741
TERPSCLR EQU  B'00100000'  CLEAR PUB2 ERROR COUNTERS           @D61NDJK 95997761
TERPSMSG EQU  B'00010000'  ISSUE MESSAGE EVEN FOR SYSTEM TASKS @D61SDJK 95997791
TERPSAVR EQU  B'00001000'  ENSURE AUTOMATIC VOLUME RECOGNITION @D61NDJK 95997801
TERPSRBL EQU  B'00000100'  BUFFERED LOG DATA PENDING           @D61SDJK 95997821
TERPSUC  EQU  B'00000010'  SWITCH OFF UNIT CHECK BIT IN CSW    @D61NDJK 95997841
TERPSUE  EQU  B'00000001'  SWITCH ON UNIT EXCEPTION BIT IN CSW @D61NDJK 95997861
TERRATBL EQU  *-TERRAVAL   LENGTH OF ONE RECOVERY ACTION..     @D61NDJK 95997881
*                            TABLE ENTRY                       @D61NDJK 95997901
*------------------------------------------------------------* @D61NDJK 95997921
*   READ OPPOSITE/ALTERNATE RECOVERY WORK FIELDS               @D61SDJK 95997941
*------------------------------------------------------------* @D61NDJK 95997961
TERROFLG DS   X            READ OPP./ALT. RECOVERY CONTROL FLAG@D61SDJK 95997981
TERROREP EQU  B'10000000'  TAPE MUST BE REPOSITIONED           @D61NDJK 95998001
TERROPTC EQU  B'01000000'  PROTECTION CHECK IN READ SIMULATION @D61NDJK 95998021
TERROPGC EQU  B'00100000'  PROGRAM CHECK IN READ SIMULATION    @D61NDJK 95998041
TERROIL  EQU  B'00010000'  INCORRECT LENGTH IN READ SIMULATION @D61NDJK 95998061
TERRONOR EQU  B'00001000'  DO NOT RESUME USER'S CCW CHAIN      @D61NDJK 95998081
TERRORAR EQU  B'00000100'  WE ARE DOING READ ALTERNATE RECOVERY@D61SDJK 95998101
TERROERR EQU  TERROPTC+TERROPGC+TERROIL     ANY ERROR IN..     @D61NDJK 95998121
*                                             READ SIMULATION  @D61SDJK 95998141
*------------------------------------------------------------* @D61NDJK 95998161
TERROWAA DS   A            ADDRESS OF ROR/RAR WORK AREA        @D61SDJK 95998181
*------------------------------------------------------------* @D61NDJK 95998201
TERROSID DS   D            GETVIS SUBPOOL ID                   @D61NDJK 95998221
*------------------------------------------------------------* @D61NDJK 95998241
TERROWAL DS   F            LENGTH OF ROR/RAR WORK AREA         @D61SDJK 95998261
TERROMAX EQU  65536        MAXIMAL LENGTH OF ROR WORK AREA     @D61SDJK 95998281
*------------------------------------------------------------* @D61NDJK 95998301
TERROIDA DS   32A          IDA LIST OF READ OPP./ALT. CCW      @D61SDJK 95998321
*------------------------------------------------------------* @D61NDJK 95998341
TERROACC DS   F            ACCUMULATED USER BYTE COUNT IN A DC @D61NDJK 95998361
*------------------------------------------------------------* @D61NDJK 95998381
TERROPTR DS   F            POINTER TO AN IDAW IN A CCW IDAL    @D61NDJK 95998401
*------------------------------------------------------------* @D61NDJK 95998421
TERROCVT DS   F            REAL ADDRESS TO BE CONVERTED..      @D61NDJK 95998441
*                            BY GETDADR                        @D61NDJK 95998461
*------------------------------------------------------------* @D61NDJK 95998481
*   RECORDING WORK FIELDS                                      @D61NDJK 95998501
*------------------------------------------------------------* @D61NDJK 95998521
TERMDWAA DS   A            ADDRESS OF MDR WORK AREA            @D61NDJK 95998541
*------------------------------------------------------------* @D61NDJK 95998561
TERMDSID DS   D            GETVIS SUBPOOL ID FOR MDR RECORDS   @D61NDJK 95998581
*------------------------------------------------------------* @D61NDJK 95998601
TEROBWAA DS   A            ADDRESS OF OBR WORK AREA            @D61NDJK 95998621
*------------------------------------------------------------* @D61NDJK 95998641
TEROBSID DS   D            GETVIS SUBPOOL ID FOR OBR RECORDS   @D61NDJK 95998661
*------------------------------------------------------------* @D61SDJK 95998681
TERA3WAA DS   A            ADDRESS OF A3 WORK AREA             @D61SDJK 95998701
*------------------------------------------------------------* @D61SDJK 95998721
TERA3SID DS   D            GETVIS SUBPOOL ID FOR A3 RECORDS    @D61SDJK 95998741
*------------------------------------------------------------* @D61NDJK 95998761
*                                                              @D61NDJK 95998781
*   BEGIN OF GLOBAL WORK AREA PART 3                           @D61NDJK 95998801
*                                                              @D61NDJK 95998821
*------------------------------------------------------------* @D61NDJK 95998841
*------------------------------------------------------------* @D61NDJK 95998861
TERGWAP3 DS   0F           BEGIN OF GLOBAL WORK AREA PART 3    @D61NDJK 95998881
*------------------------------------------------------------* @D61NDJK 95998901
TERGWAL2 EQU  *-TERGWAP2   LENGTH OF GLOBAL WORK AREA PART 2   @D61NDJK 95998921
*------------------------------------------------------------* @D61SDJK 95998941
*   SGTAP LINKAGE POINTER                                      @D61SDJK 95998961
*------------------------------------------------------------* @D61SDJK 95998981
TERLINK  DS   A            LINKAGE POINTER FOR HIGH SVA..      @D61SDJK 95999001
*                            AND SUPERVISOR PART OF SGTAP      @D61SDJK 95999021
*------------------------------------------------------------* @D61NDJK 95999041
*   STACK OF SGTAP                                             @D61NDJK 95999061
*------------------------------------------------------------* @D61NDJK 95999081
TERCLSTK EQU  7            NR OF SAVE AREAS IN STACK           @D61NDJK 95999101
TERTERSV DS   (TERCLSTK*16)F  CALL STACK OF SGTAP..            @D61NDJK 95999121
*                               STACK IS ONLY PROTECTED FOR..  @D61NDJK 95999141
*                               DEBUG SUPERVISOR GENERATION    @D61NDJK 95999161
TERTERFF DS   X            END OF STACK INDICATION             @D61NDJK 95999181
         DS   0D                                               @D61NDJK 95999201
*------------------------------------------------------------* @D61NDJK 95999221
TERGWAL3 EQU  *-TERGWAP3   LENGTH OF GLOBAL WORK AREA PART 3   @D61NDJK 95999241
*------------------------------------------------------------* @D61NDJK 95999261
TERGWAL  EQU  *-TERGLOB    LENGTH OF GLOBAL WORK AREA          @D61NDJK 95999281
*------------------------------------------------------------* @D61NDJK 95999301
*                                                              @D61NDJK 95999321
*   END OF GLOBAL WORK AREA                                    @D61NDJK 95999341
*                                                              @D61NDJK 95999361
*------------------------------------------------------------* @D61NDJK 95999381
         LTORG                                                 @D61NDJK 95999401
         EJECT                                                 @D61NDJK 95999421
 AIF   ('&CODE'   EQ  'YES').TPCOD02                           @D61SDJK 95999441
&SYSECT  CSECT ,                                               @D61SDJK 95999461
*------------------------------------------------------------* @D61SDJK 95999481
*                                                              @D61SDJK 95999501
*   FIVE GLOBAL WORK AREAS ARE PROVIDED IN THE SUPERVISOR      @D61SDJK 95999521
*   RESIDENT PART OF SGTAP FOR TAPE ERROR RECOVERY PROCEDURES. @D61SDJK 95999541
*                                                              @D61SDJK 95999561
*------------------------------------------------------------* @D61SDJK 95999581
         DS   0D                                               @D61NDJK 95999601
TERCCB1  EQU  *+TERCCB-TERGLOB        CCB ADDR. IN WORK AREA 1 @D61NDJK 95999621
TERGLOB1 DC   C'TERGLOB1'             GLOBAL WORK AREA 1       @D61NDJK 95999641
         DC   (TERGWAL1)X'00'                                  @D61NDJK 95999661
         DC   (TERGWAL2)X'00'                                  @D61NDJK 95999681
         DC   (TERGWAL3)X'00'                                  @D61NDJK 95999701
*                                                              @D61NDJK 95999721
TERCCB2  EQU  *+TERCCB-TERGLOB        CCB ADDR. IN WORK AREA 2 @D61NDJK 95999741
TERGLOB2 DC   C'TERGLOB2'             GLOBAL WORK AREA 2       @D61NDJK 95999761
         DC   (TERGWAL1)X'00'                                  @D61NDJK 95999781
         DC   (TERGWAL2)X'00'                                  @D61NDJK 95999801
         DC   (TERGWAL3)X'00'                                  @D61NDJK 95999821
*                                                              @D61NDJK 95999841
TERCCB3  EQU  *+TERCCB-TERGLOB        CCB ADDR. IN WORK AREA 3 @D61NDJK 95999861
TERGLOB3 DC   C'TERGLOB3'             GLOBAL WORK AREA 3       @D61NDJK 95999881
         DC   (TERGWAL1)X'00'                                  @D61NDJK 95999901
         DC   (TERGWAL2)X'00'                                  @D61NDJK 95999921
         DC   (TERGWAL3)X'00'                                  @D61NDJK 95999941
*                                                              @D61NDJK 95999961
TERCCB4  EQU  *+TERCCB-TERGLOB        CCB ADDR. IN WORK AREA 4 @D61NDJK 95999981
TERGLOB4 DC   C'TERGLOB4'             GLOBAL WORK AREA 4       @D61NDJK 96000001
         DC   (TERGWAL1)X'00'                                  @D61NDJK 96000021
         DC   (TERGWAL2)X'00'                                  @D61NDJK 96000041
         DC   (TERGWAL3)X'00'                                  @D61NDJK 96000061
*                                                              @D61NDJK 96000081
TERCCB5  EQU  *+TERCCB-TERGLOB        CCB ADDR. IN WORK AREA 5 @D61NDJK 96000101
TERGLOB5 DC   C'TERGLOB5'             GLOBAL WORK AREA 5       @D61NDJK 96000121
         DC   (TERGWAL1)X'00'                                  @D61NDJK 96000141
         DC   (TERGWAL2)X'00'                                  @D61NDJK 96000161
         DC   (TERGWAL3)X'00'                                  @D61NDJK 96000181
*                                                              @D61NDJK 96000201
TERGLOBN EQU  (*-TERGLOB1)/TERGWAL    NUMBER OF WORK AREAS     @D61NDJK 96000221
         EJECT                                                          96000241
*                                                              @D61NDJK 96000261
.TPCOD02 ANOP                                                  @D61SDJK 96000281
 AIF   ('&CODE'   NE  'YES').TPNOC05                           @D61SDJK 96000301
         DSECT                                                 @D61SDJK 96000321
TERIOSAV EQU   0                  AVOID ASSEMBLY ERRORS IN..   @D61SDJK 96000341
TERCALRT EQU   0                    SVA PHASE BY SUPPLYING..   @D61SDJK 96000361
INTEQPST EQU   0                    DUMMIES FOR SUPERVISOR..   @D61SDJK 96000381
INTEQSET EQU   0                    ADDRESSES USED IN HIGH..   @D61SDJK 96000401
GETDADR  EQU   0                    SVA PART OF SGTAP          @D61SDJK 96000421
EMSGERRE EQU   0                                               @D61SDJK 96000441
EMSGERBL EQU   0                                               @D61SDJK 96000461
VIRTAD   EQU   0                                               @D61SDJK 96000481
*                                                              @D61SDJK 96000501
.TPNOC05 ANOP                                                  @D61SDJK 96000521
*------------------------------------------------------------* @D61SDJK 96000541
*                                                              @D61SDJK 96000561
*   LINKAGE AREA FOR HIGH SVA AND SUPERVISOR PART OF SGTAP     @D61SDJK 96000581
*                                                              @D61SDJK 96000601
*------------------------------------------------------------* @D61SDJK 96000621
*                                                              @D61SDJK 96000641
TERLNKG  DC   C'TERLINK:'                                      @D61SDJK 96000661
TERIOLVE DC   A(TERIOSAV)  RETURN ADDRESS TO SUPERVISOR PART.. @D61SDJK 96000681
*                            IF RECOVERY I/O HAS BEEN STARTED  @D61SDJK 96000701
TERCALL  DC   A(TERCALRT)  RETURN ADDRESS TO SUPERVISOR PART.. @D61SDJK 96000721
*                            IF A SUPVR. ROUTINE MUST BE CALLED@D61SDJK 96000741
TERERPST DC   A(INTEQPST)  ADDRESS OF IOINTER POSTING ROUTINE  @D61SDJK 96000761
TERERSET DC   A(INTEQSET)  BASE ADDRESS OF POSTING ROUTINE     @D61SDJK 96000781
TERGETDA DC   A(GETDADR)   ADDRESS OF GET DATA ADDRESS ROUTINE @D61SDJK 96000801
TERMSEMS DC   A(EMSGERRE)  ADDRESS OF MESSAGE WRITER ENTRY PNT.@D61SDJK 96000821
TERMSERB DC   A(EMSGERBL)  BASE ADDRESS OF MSG. WRITER ROUTINE @D61SDJK 96000841
TERVIRTA DC   A(VIRTAD)    ADDRESS OF VIRTAD ROUTINE           @D61SDJK 96000861
*                                                              @D61SDJK 96000881
*------------------------------------------------------------* @D61SDJK 96000901
*                                                              @D61SDJK 96000921
*   READ BUFFERED LOG DATA AREA.                               @D61SDJK 96000941
*                                                              @D61SDJK 96000961
*------------------------------------------------------------* @D61SDJK 96000981
*                                                              @D61SDJK 96001001
TERRBLDA DC   XL256'00'    BUFFERED LOG DATA                   @D61SDJK 96001021
*                                                              @D61SDJK 96001041
*------------------------------------------------------------* @D61NDJK 96001061
*                                                              @D61NDJK 96001081
*   LIST OF ALLOCATABLE WORK ERROR ENTRIES.                    @D61NDJK 96001101
*                                                              @D61NDJK 96001121
*------------------------------------------------------------* @D61NDJK 96001141
*                                                              @D61NDJK 96001161
         DC   C' TERAEB:'                                      @D61NDJK 96001181
TERAEB   DC   9XL(ERBLKHDL+L'ERRQ)'00'                         @D61NDJK 96001201
TERAEBE  DC   XL(ERBLKHDL+L'ERRQ)'00'  LAST ERROR BLOCK.       @D61NDJK 96001221
*                                                              @D61NDJK 96001241
*-------------------------------------------------------------*@D61NDJK 96001261
*                                                              @D61SDJK 96001281
*   SGTAP PATCH AREA                                           @D61NDJK 96001301
*                                                              @D61SDJK 96001321
*-------------------------------------------------------------*@D61NDJK 96001341
*                                                              @D61NDJK 96001361
TERTLVL2 DC    30F'0'            FOR LEVEL 2 TRAPS & CHANGES   @D61NDJK 96001381
*                                                              @D61NDJK 96005861
         AIF   (NOT &SGTAP).MTAPEXI                            @D61NDJK 96020961
         PRINT NOGEN                                           @D61NDJK 96036061
.MTAPEXI MEXIT                                                 @D61NDJK 96051161
.*                                                             @D61NDJK 96066261
.**************************************************************@DERPDGL 96081361
.* MECHANISMS TO HANDLE ALL SAFEGUARDING OF CALLS AND RETURNS  @DERPDGL 96096461
.* IN SGTAP.                                                   @DERPDGL 96111561
.**************************************************************@DERPDGL 96126661
.*                                                             @DERPDGL 96141761
.*     GIVE A NOTE FOR AN INVALID REGISTER CONVENTION          @DERPDGL 96156861
.*                                                             @DERPDGL 96171961
.DSINVC  MNOTE 8,'WRONG REGISTER CONVENTION'                   #SECURGL 96187061
         MEXIT                                                 #SECURGL 96202161
.**************************************************************@DERPDGL 96217261
.*                                                             @DERPDGL 96232361
.*     CHECK OTHER INVOCATIONS EXCEPT CALL SUBROUTINE          @DERPDGL 96247461
.*                                                             @DERPDGL 96262561
.DSINVS  ANOP                                                  #SECURGL 96277661
.*                                                             #SECURGL 96292761
.* RING1 SETC '                                    '(2,K'&SYSLIST(1)-2) 96307861
         AIF ('&TEST'(1,6)  EQ 'SGCOV '        ).MAKCOV        #SECURGL 96322961
&STRING1 SETC '                                    '                    96338061
&STRING2 SETC  '&SYSLIST(2)'(2,K'&SYSLIST(2)-2)                         96353161
         AIF ('&TEST'(1,7)  EQ 'RETURN '       ).MAKRET        #SECURGL 96368261
         AIF ('&TEST'(1,8)  EQ 'RETURN4 '      ).MAKRET4       #SECURGL 96383361
         AIF ('&TEST'(1,8)  EQ 'RETURN8 '      ).MAKRET8       #SECURGL 96398461
         AIF ('&TEST'(1,8)  EQ 'RETURN12'      ).MAKRETC       #SECURGL 96413561
         AIF ('&TEST'(1,8)  EQ 'HEADING '      ).MAKHEAD       #SECURGL 96428661
         AIF ('&TEST'(1,8)  EQ 'DROPALL '      ).MAKDROP       #SECURGL 96443761
         AIF ('&TEST'(1,12) EQ 'STARTINCLUDE'  ).MAKINCL       #SECURGL 96458861
         AIF ('&TEST'(1,12) EQ 'ENDINCLUDE  '  ).MAKEINC       #SECURGL 96473961
         MNOTE 8,'INVOCATION WITH UNKNOWN SUBJECT'             #SECURGL 96489061
         MEXIT                                                 #SECURGL 96504161
.**************************************************************#SECURGL 96519261
.*                                                             #SECURGL 96534361
.*    MAKE A STANDARD CALL TO ALL SUBROUTINES                  #SECURGL 96549461
.*                                                             #SECURGL 96564561
.DSHEAD  ANOP                                                  #SECURGL 96579661
&X       SETA  5  = LENGTH OF 'CALL' OR 'INCL' KEYWORD + QUOTE          96594761
.DSHEA2  ANOP                                                           96609861
&X       SETA  &X+1                                                     96624961
         AIF   ('&SUBJ'(&X,1) EQ ' ').DSHEA2                            96640061
&Y       SETA  &X                                                       96655161
&X       SETA  0                                                        96670261
.DSHEA4  ANOP                                                  @DERPDGL 96685361
&X       SETA  &X+1                                            @DERPDGL 96700461
         AIF   ('&SUBJ'(&X+&Y,1) NE ' ').DSHEA4                         96715561
&STRING  SETC  '&SUBJ'(&Y,&X)                                           96730661
&STRING1 SETC  '                                              '         96745761
.*                                                             @DERPDGL 96760861
.*   IF IT IS DEBUG GENERATE A SAFETY CHECK IF SAVE AREA EMPTY @DERPDGL 96775961
.*                                                             @DERPDGL 96791061
         AIF   (NOT &BGDEBUG).DSHEAB                                    96806161
&STRING3 SETC '16*4(RD),X''FF''&STRING1'(1,K'&SYSLIST(1)-5).'*'         96821261
&LABEL   CLI   &STRING3                                                 96836361
.DSHEAB  ANOP                                                  @DERPDGL 96851461
.*                                                             @DERPDGL 96866561
.*                                                             @DERPDGL 96881661
&STRING2 SETC  '&SYSLIST(2)'(2,K'&SYSLIST(2)-2)                         96896761
&STRING3 SETC 'R0,RF,16*4(RD)&STRING1'(1,K'&SYSLIST(1)-5)               96911861
&STRING3 SETC '&STRING3&STRING2'                                        96926961
         STM   &STRING3                                                 96942061
&STRING3 SETC '0H''0'',X''58C0'',S(*+6)&STRING1'(1,K'&SYSLIST(1)-4)     96957161
&STRING3 SETC '&STRING3 .'                                              96972261
         DC    &STRING3                                                 96987361
         AIF   (NOT &BGDEBUG).DSHEA5                                    97002461
&STRING3 SETC 'RE,4(,RC)&STRING1'(1,K'&SYSLIST(1)-5).'  .'              97017561
         BAL   &STRING3                                                 97032661
.DSHEA5  AIF   (&BGDEBUG).DSHEA6                                        97047761
&STRING3 SETC 'RE,0(,RC)&STRING1'(1,K'&SYSLIST(1)-5).'  .'              97062861
         BAL   &STRING3                                                 97077961
.DSHEA6  ANOP                                                           97093061
&STRING3 SETC 'AL4(&STRING)&STRING1'(1,K'&SYSLIST(1)-5).'  .'           97108161
         DC    &STRING3                                                 97123261
         AIF   (T'&E0 EQ  'O').DSHEA7                                   97138361
&STRING  SETC  '&E0'(2,K'&E0-2)                                         97153461
         B         &STRING                                              97168561
.DSHEA7  ANOP                                                           97183661
         AIF   (T'&E4 EQ  'O').DSHEA8                                   97198761
&STRING  SETC  '&E4'(2,K'&E4-2)                                         97213861
         B         &STRING                                              97228961
.DSHEA8  ANOP                                                           97244061
         AIF   (T'&E8 EQ  'O').DSHEA3                                   97259161
&STRING  SETC  '&E8'(2,K'&E8-2)                                         97274261
         B         &STRING                                              97289361
.DSHEA3  ANOP                                                           97304461
.*                                                             @DERPDGL 97319561
.*   PROCESS THE NUMBER PARAMETER NR GIVEN IN CASE OF TERTRACE @DERPDGL 97334661
.*                                                             @DERPDGL 97349761
         AIF   ('&STRING' NE 'TERTRACE').DSHEA10               @DERPDGL 97364861
&X       SETA  0                                               @DERPDGL 97379961
.DSHEA9  ANOP                                                  @DERPDGL 97395061
&X       SETA  &X+1                                            @DERPDGL 97410161
         AIF   ('&NR'(&X,1) NE ' ').DSHEA9                     @DERPDGL 97425261
&X       SETA  &X-2                                            @DERPDGL 97440361
&STRING  SETC  '&NR'(2,&X)                                     @DERPDGL 97455461
         DC    AL4(&STRING)                                    @DERPDGL 97470561
         MEXIT                                                 @DERPDGL 97485661
.DSHEA10 ANOP                                                  @DERPDGL 97500761
.*                                                             @DERPDGL 97515861
.*   PROCESS INFORMATIONAL INPUT OUTPUT CONVENTION HINTS       @DERPDGL 97530961
.*                                                             @DERPDGL 97546061
         AIF   (NOT &SGTAP OR NOT &BGDEBUG).QRHDEX             #SECURGL 97561161
&STRING  SETC  '&I'(2,K'&I-2)                                  #SECURGL 97576261
 MNOTE *,'        INPUT  =&STRING'                             #SECURGL 97591361
&STRING  SETC  '&O'(2,K'&O-2)                                  #SECURGL 97606461
 MNOTE *,'        OUTPUT =&STRING'                             #SECURGL 97621561
.QRHDEX  MEXIT                                                 #SECURGL 97636661
.**************************************************************#SECURGL 97651761
.*                                                             #SECURGL 97666861
.*    MAKE A COVERAGE POINT AND A TRACE EARMARKING POINT       #SECURGL 97681961
.*                                                             #SECURGL 97697061
.MAKCOV  ANOP                                                  #SECURGL 97712161
&X       SETA  6  = LENGTH OF 'SGCOV' KEYWORD PLUS QUOTE                97727261
.DCOV00  ANOP                                                           97742361
&X       SETA  &X+1                                                     97757461
         AIF   ('&SUBJ'(&X,1) EQ ' ').DCOV00                            97772561
&Y       SETA  &X                                                       97787661
&X       SETA  0                                                        97802761
.DCOV10  ANOP                                                  @DERPDGL 97817861
&X       SETA  &X+1                                            @DERPDGL 97832961
         AIF   ('&SUBJ'(&X+&Y,1) EQ '''').DCOV20                        97848061
         AIF   ('&SUBJ'(&X+&Y,1) NE ' ').DCOV10                         97863161
.DCOV20  ANOP                                                  @DERPDGL 97878261
&STRING  SETC  '&SUBJ'(&Y,&X)                                           97893361
         SGCOV &STRING                                                  97908461
&STRING  SETC  '8040201008040201'((&NR(2)+1)*2-1,2)                     97923561
         OI    TERT+&NR(1),X'&STRING'                                   97938661
         MEXIT                                                 @DERPDGL 97953761
.**************************************************************#SECURGL 97968861
.*                                                             #SECURGL 97983961
.*    MAKE A STANDARD HEADING FOR ALL SUBROUTINES              #SECURGL 97999061
.*                                                             #SECURGL 98014161
.MAKHEAD ANOP                                                  #SECURGL 98029261
         AIF   (T'&NAME EQ 'O').NONAME                         @DERPDGL 98044361
&STRING3 SETC  'C''&NAME'''                                             98059461
         DC    &STRING3                                                 98074561
.NONAME  ANOP                                                  @DERPDGL 98089661
&STRING3 SETC  '0H&STRING1'(1,K'&SYSLIST(1)+3).'&STRING2'               98104761
&NAME    DS    &STRING3                                                 98119861
&STRING3 SETC '*,RC&STRING1'(1,K'&SYSLIST(1)+3).'*'                     98134961
         USING &STRING3                                                 98150061
&STRING3 SETC 'TERGLOB,RA&STRING1'(1,K'&SYSLIST(1)+3).'*'               98165161
         USING &STRING3                                                 98180261
         AIF   (NOT &BGDEBUG).MAKHEA1                                   98195361
&STRING3 SETC 'R5,SYSERROR&STRING1'(1,K'&SYSLIST(1)+3).'*'              98210461
         BAL   &STRING3                                                 98225561
&LABSUF  SETC  '&NAME'(4,K'&NAME-3)                                     98240661
&LABEL   SETC  'T$N&LABSUF'                                    @DERPDGL 98255761
&STRING3 SETC '*-4&STRING1'(1,K'&SYSLIST(1)+3).'*'                      98270861
&LABEL   BE    &STRING3                                                 98285961
.MAKHEA1 ANOP                                                           98301061
&STRING3 SETC 'RD,16*4(,RD)&STRING1'(1,K'&SYSLIST(1)+3).'*'             98316161
         LA    &STRING3                                                 98331261
&STRING3 SETC 'RE,RE*4(,RD)&STRING1'(1,K'&SYSLIST(1)+3).'*'             98346361
         ST    &STRING3                                                 98361461
         MEXIT                                                          98376561
.**************************************************************#SECURGL 98391661
.*                                                             #SECURGL 98406761
.*    MAKE A STANDARD RETURN  FOR ALL SUBROUTINES              #SECURGL 98421861
.*                                                                      98436961
.MAKRETC ANOP                                                           98452061
&ROF     SETA  12+4                                            @DERPDGL 98467161
         AGO   .MAKRETB                                        @DERPDGL 98482261
.MAKRET8 ANOP                                                           98497361
&ROF     SETA  8+4                                             @DERPDGL 98512461
         AGO   .MAKRETB                                        @DERPDGL 98527561
.MAKRET4 ANOP                                                           98542661
&ROF     SETA  4+4                                             @DERPDGL 98557761
         AGO   .MAKRETB                                        @DERPDGL 98572861
.MAKRET  ANOP                                                           98587961
&ROF     SETA  0+4                                             @DERPDGL 98603061
.MAKRETB ANOP                                                  @DERPDGL 98618161
&STRING3 SETC  '0H&STRING1'(1,K'&SYSLIST(1)+3).'&STRING2'               98633261
&NAME    DS    &STRING3                                                 98648361
         AIF   ('&OUTPUT' EQ 'O').NOOUTPT                               98663461
&COUNT1  SETA  1                                                        98678561
.MAKRT10 AIF   ('&OUTPUT(&COUNT1)' EQ '').NOOUTPT                       98693661
&RX      SETC  '&OUTPUT(&COUNT1)'                                       98708761
&STRING3 SETC '&RX,&RX*4(,RD)&STRING1'(1,K'&SYSLIST(1)+3).'  .'         98723861
         ST    &STRING3                                                 98738961
&COUNT1  SETA  &COUNT1+1                                                98754061
         AGO   .MAKRT10                                                 98769161
.NOOUTPT ANOP                                                           98784261
&STRING3 SETC 'R0,RF,0(RD)&STRING1'(1,K'&SYSLIST(1)+3).'  .'            98799361
         LM    &STRING3                                                 98814461
.*                                                                      98829561
         AIF   (NOT &BGDEBUG).MAKRE10                                   98844661
&STRING3 SETC '16*4(RD),X''00''&STRING1'(1,K'&SYSLIST(1)+3).'  .'       98859761
         MVI   &STRING3                                                 98874861
.MAKRE10 ANOP                                                           98889961
.*                                                                      98905061
&STRING3 SETC '&ROF.(,RE)&STRING1'(1,K'&SYSLIST(1)+3).'  .'             98920161
         B     &STRING3                                                 98935261
         MEXIT                                                          98950361
.**************************************************************#SECURGL 98965461
.*                                                             #SECURGL 98980561
.*    MAKE A STANDARD DROP AT EACH END OF CODEBLOCK            #SECURGL 98995661
.*                                                             #SECURGL 99010761
.MAKDROP ANOP                                                  #SECURGL 99025861
&STRING3 SETC  '0H&STRING1'(1,K'&SYSLIST(1)+3).'&STRING2'               99040961
&NAME    DS    &STRING3                                                 99056061
&STRING3 SETC '*,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15'                   99071161
         USING &STRING3                                                 99086261
&STRING3 SETC '1,2,3,4,5,6,7,8,9,10,11,12,13,14,15'                     99101361
         DROP  &STRING3                                                 99116461
         MEXIT                                                 #SECURGL 99131561
.**************************************************************#SECURGL 99146661
.*                                                             #SECURGL 99161761
.*    MAKE A STANDARD INCLUDE BEGINNING                        #SECURGL 99176861
.*                                                             #SECURGL 99191961
.MAKINCL ANOP                                                  #SECURGL 99207061
&STRING3 SETC  '0H&STRING1'(1,K'&SYSLIST(1)+3).'&STRING2'               99222161
&NAME    DS    &STRING3                                                 99237261
         MEXIT                                                 #SECURGL 99252361
.**************************************************************#SECURGL 99267461
.*                                                             #SECURGL 99282561
.*    MAKE A STANDARD INCLUDE ENDING                           #SECURGL 99297661
.*                                                             #SECURGL 99312761
.MAKEINC ANOP                                                  #SECURGL 99327861
&STRING3 SETC  '0H&STRING1'(1,K'&SYSLIST(1)+3).'&STRING2'               99342961
&NAME    DS    &STRING3                                                 99358061
         MEXIT                                                 #SECURGL 99373161
         MEND                                                           99388261
