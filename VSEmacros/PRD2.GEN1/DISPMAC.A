         MACRO                                                          00001000
&NAME    DISPMAC &FUNC=,                                               *00002000
               &SFUNC=,                                        @D66ODOW*00003000
               &ERREXIT=,                                      @D66ODOW*00003000
               &INP1=,                                                 *00003000
               &INP2=,                                                 *00004000
               &INP3=,                                                 *00005000
               &INP4=,                                                 *00006000
               &WR1=                                                    00007000
         GBLB  &IJBSGEN                                        @D66ODOW 00008000
         GBLB  &IJBDSPQ           =1, IF EQUATE CHANERATED     @D61RDIS 00008000
         GBLC  &RTIB                                           @D66ODOW 00008000
         GBLC  &RPCB                                           @D66ODOW 00008000
         LCLC  &INDEX                                          @D61RDIS 00009000
         LCLC  &INDEX1                                         @D61RDIS 00010000
.*       IBM DISK OPERATING SYSTEM                            *         00011000
         SPACE 1                                                        00012000
***************************************************************         00013000
*        SUPERVISOR - DISPMAC - 5686-CF7-06                   *         00014000
         AGO   .ZZZ                                           *         00015000
*        LICENSED MATERIALS - PROPERTY OF IBM                 *         00016000
*        "RESTRICTED MATERIALS OF IBM"                        *         00017000
*        5686-CF7                                             *         00018000
*        (C) COPYRIGHT IBM CORP. 1994, 2004                   *         00018000
***************************************************************         00013000
.ZZZ     ANOP                                                 *         00020000
.* /* START OF SPECIFICATIONS                                           00021000
.*01  MODULE TYPE      = SUPERVISOR GENERATION MACRO                    00022000
.*01  DESCRIPTIVE NAME = PROVIDES ACCESS TO DISPATCHER SERVICES         00023000
.*01  NOTES            = CHANGE ACTIVITY                                00024000
.*    TURBO DISPATCHER                                         @D61RDIS 00025000
.*    SAVE STATUS INTO SECOND SAVE AREA                        @DY43697 00026000
.*    VSE/ESA 2.2 ENHANCEMENTS                                 @D61TDIS 00027000
.*    MORE THAN 255 TASKS AND 31 TASKS/PARTITION               @D66ODOW 00027000
.*    NEW FUNCTION CODE: DELAY INTERRUPTS                      @D68..IS 00027000
.*    NEW FUNCTION CODE: DELAY DISPATCHER CYCLE                @D68OMIS 00027000
.*    A000000-999999                                                    00028000
.*02  PROCESSOR        = ASSEMBLER                                      00029000
.*END OF SPECIFICATIONS       *******************************/          00030000
         AIF   (T'&FUNC EQ 'O').FUNCERR                        @D61RDIS 00031000
         AIF   (T'&NAME EQ 'O').NONAME                         @D61RDIS 00031000
&NAME    DS    0H                                              @D66ODOW         
.NONAME  ANOP                                                  @D66ODOW         
         AIF   ('&FUNC' EQ 'DISP').DISP                        @D61RDIS 00032000
         AIF   ('&FUNC' EQ 'RPOST').RPOST                      @D61RDIS 00033000
         AIF   ('&FUNC' EQ 'RPOST3').RPOST3                    @D61RDIS 00034000
         AIF   ('&FUNC' EQ 'RPOSTX').RPOSTX                    @D61RDIS 00035000
         AIF   ('&FUNC' EQ 'UNPOST').UNPOST                    @D61RDIS 00036000
         AIF   ('&FUNC' EQ 'REDISP').REDISP                    @D61RDIS 00037000
         AIF   ('&FUNC' EQ 'VSMDELAY').VSMDELA                 @D61RDIS 00038000
         AIF   ('&FUNC' EQ 'SETLT').SETLT                      @D61RDIS 00039000
         AIF   ('&FUNC' EQ 'SETLCALL').SETLCAL                 @D61RDIS 00040000
         AIF   ('&FUNC' EQ 'ALLBND').ALLBND                    @D61RDIS 00041000
         AIF   ('&FUNC' EQ 'DISPICS').DISPICS                  @D61RDIS 00042000
         AIF   ('&FUNC' EQ 'DISPICR').DISPICR                  @D61RDIS 00043000
         AIF   ('&FUNC' EQ 'PFQUERY').PFQUERY                  @D61RDIS 00044000
         AIF   ('&FUNC' EQ 'PFUPD').PFUPD                      @D61RDIS 00045000
         AIF   ('&FUNC' EQ 'INIT').INIT                        @D61RDIS 00046000
         AIF   ('&FUNC' EQ 'LOADDYN').LOADDYN                  @D61RDIS 00047000
         AIF   ('&FUNC' EQ 'DEALLOC').DEALLOC                  @D61RDIS 00048000
         AIF   ('&FUNC' EQ 'ALLOC').ALLOC                      @D61RDIS 00049000
         AIF   ('&FUNC' EQ 'SETDEF').SETDEF                    @D61RDIS 00050000
         AIF   ('&FUNC' EQ 'ENTSVC').ENTSVC                    @D61RDIS 00051000
         AIF   ('&FUNC' EQ 'ENTIO').ENTIO                      @D61RDIS 00052000
         AIF   ('&FUNC' EQ 'ENTEXT').ENTEXT                    @D61RDIS 00053000
         AIF   ('&FUNC' EQ 'UPDJA').UPDJA                      @D61RDIS 00054000
         AIF   ('&FUNC' EQ 'CHKINT').FUNCERR                   @D61RDIS 00055000
         AIF   ('&FUNC' EQ 'CHKINTD').FUNCERR                  @D61RDIS 00056000
         AIF   ('&FUNC' EQ 'ATTACH').ATTACH                    @D61RDIS 00057000
         AIF   ('&FUNC' EQ 'DETACH').DETACH                    @D61RDIS 00058000
         AIF   ('&FUNC' EQ 'CHAP').CHAP                        @D61RDIS 00059000
         AIF   ('&FUNC' EQ 'EOT').EOT                          @D61RDIS 00060000
         AIF   ('&FUNC' EQ 'TERML').TERML                      @D61RDIS 00061000
         AIF   ('&FUNC' EQ 'TERMH').TERMH                      @D61RDIS 00062000
         AIF   ('&FUNC' EQ 'SVC57').SVC57                      @D61RDIS 00063000
         AIF   ('&FUNC' EQ 'SVC133').SVC133                    @D61RDIS 00064000
         AIF   ('&FUNC' EQ 'ATTSTASK').ATTSTAS                 @D61RDIS 00065000
         AIF   ('&FUNC' EQ 'TDINFO').TDINFO                    @D61RDIS 00066000
         AIF   ('&FUNC' EQ 'NPQUERY').NPQUERY                  @D61RDIS 00067000
         AIF   ('&FUNC' EQ 'PTLB').PTLB                        @D61RDIS 00068000
         AIF   ('&FUNC' EQ 'PALB').PALB                        @D61RDIS 00069000
         AIF   ('&FUNC' EQ 'IPL').IPL                          @D61RDIS 00070000
         AIF   ('&FUNC' EQ 'CNCLEXIT').CNCLEXI                 @D61RDIS 00071000
         AIF   ('&FUNC' EQ 'DISPSTOP').DISPSTO                 @D61RDIS 00072000
         AIF   ('&FUNC' EQ 'GENENT').GENENT                    @D61RDIS 00073000
         AIF   ('&FUNC' EQ 'GETSAVAR').GETSAVR                 @D61RDIS 00074000
         AIF   ('&FUNC' EQ 'UPDCR0').UPDCR0                    @D61RDIS 00075000
         AIF   ('&FUNC' EQ 'SIGPTSK').SIGPTS                   @KXANN16 00076000
         AIF   ('&FUNC' EQ 'SETREADY').SETREAD                 @KXANN16 00077000
         AIF   ('&FUNC' EQ 'DEBGON').DEBGON                    @KXANN16 00078000
         AIF   ('&FUNC' EQ 'DEBGOFF').DEBGOFF                  @KXANN16 00079000
         AIF   ('&FUNC' EQ 'TPI').TPI                          @KXANN17 00080000
         AIF   ('&FUNC' EQ 'SDEXIT').SDEXIT                    @DY43697 00081000
         AIF   ('&FUNC' EQ 'PCENTRY').PCENTRY                  @D64XDIS 00082000
         AIF   ('&FUNC' EQ 'PCRETURN').PCRETUR                 @D64XDIS 00083000
         AIF   ('&FUNC' EQ 'CHAPMVS').CHAPMVS                  @D64ADIS 00084000
         AIF   ('&FUNC' EQ 'PARTST').PARTST                    @D61TDIS 00085000
         AIF   ('&FUNC' EQ 'SVC150').SVC150                    @D64ADIS 00086000
         AIF   ('&FUNC' EQ 'SCHEDULE').SCHED                   @D64ADIS 00087000
         AIF   ('&FUNC' EQ 'MVSSVC').MVSSVC                    @D64ADIS 00088000
         AIF   ('&FUNC' EQ 'FREELOCK').FREELOC                 @D64ADIS 00089000
         AIF   ('&FUNC' EQ 'POST82').POST82                    @DYXXXIS 00089500
         AIF   ('&FUNC' EQ 'TIB').NEXTTIB                      @D66ODOW 00089500
         AIF   ('&FUNC' EQ 'DELINT').FUNCERR                   @D68OMIS 00089500
         AIF   ('&FUNC' EQ 'DSPDELAY').DSPDELA                 @D68OMIS 00089500
.FUNCERR ANOP                                                  @D61RDIS 00090000
         MNOTE 5,'FUNC SPECIFICATION OMITTED OR INVALID'       @D61RDIS 00091000
         MEXIT                                                 @D61RDIS 00092000
.REGERR  ANOP                                                  @D61RDIS 00093000
         MNOTE 5,'NOT ENOUGH WORK REGISTERS SPECIFIED'         @D61RDIS 00094000
         MEXIT                                                 @D61RDIS 00095000
.TYPERR  ANOP                                                  @D61RDIS 00096000
         MNOTE 5,'TYPE SPECIFICATION OMITTED OR INVALID'       @D61RDIS 00097000
         MEXIT                                                 @D61RDIS 00098000
.FAILERR ANOP                                                  @D61RDIS 00099000
         MNOTE 5,'FAIL SPECIFICATION NOT ALLOWED'              @D61RDIS 00100000
         MEXIT                                                 @D61RDIS 00101000
.TIBERR  ANOP                                                  @D66ODOW 00099000
         MNOTE 5,'SFUNC SPECIFICATION INCORRECT'               @D66ODOW 00100000
         MEXIT                                                 @D61RDIS 00101000
.* -----------------------------------------------------------          00102000
.*       - SET FUNCTION CODES                                           00103000
.* -----------------------------------------------------------          00104000
.* -----------------------------------------------------------          00105000
.SVC57   ANOP                                                           00106000
* --------------------------------------------------------------        00107000
*          - PROCESS PRTY ROUTINE REQUEST                               00108000
* --------------------------------------------------------------        00109000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00110000
         LA    RF,0               GET FUNCTION CODE            @D61RDIS 00111000
         AGO   .COMMON                                         @D61RDIS 00112000
.* -----------------------------------------------------------          00113000
.* -----------------------------------------------------------          00114000
.LOADDYN ANOP                                                           00115000
* --------------------------------------------------------------        00116000
*          - PROCESS LOAD REQUEST OF DYNAMIC CLASS TABLE                00117000
* --------------------------------------------------------------        00118000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00119000
         LA    RF,4               GET FUNCTION CODE            @D61RDIS 00120000
         AGO   .COMMON                                         @D61RDIS 00121000
.* -----------------------------------------------------------          00122000
.* -----------------------------------------------------------          00123000
.ALLOC   ANOP                                                           00124000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00125000
* --------------------------------------------------------------        00126000
*          - PROCESS ALLOCATION OF DYNAMIC PARTITION                    00127000
*            INPUT  FOR FUNCTION: R1 - PCB ADDRESS                      00128000
* --------------------------------------------------------------        00129000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00130000
         LA    RF,16              GET FUNCTION CODE            @D61RDIS 00131000
         AGO   .COMMON                                         @D61RDIS 00132000
.* -----------------------------------------------------------          00133000
.* -----------------------------------------------------------          00134000
.DEALLOC ANOP                                                           00135000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00136000
* --------------------------------------------------------------        00137000
*          - PROCESS DEALLOCATION OF DYNAMIC PARTITION                  00138000
*            INPUT  FOR FUNCTION: R5 - PCB ADDRESS                      00139000
* --------------------------------------------------------------        00140000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00141000
         LA    RF,20              GET FUNCTION CODE            @D61RDIS 00142000
         AGO   .COMMON                                         @D61RDIS 00143000
.* -----------------------------------------------------------          00144000
.* -----------------------------------------------------------          00145000
.DISP    ANOP                                                           00146000
         LA    RF,24              GET FUNCTION CODE            @D61RDIS 00147000
* --------------------------------------------------------------        00148000
*          - PROCESS TASK SELECTION                                     00149000
*            OUTPUT FOR FUNCTION: RF - FUNCTION CODE FOR                00150000
*                                      FOLLOW-ON PROCESS                00151000
* --------------------------------------------------------------        00152000
         AGO   .COMMON                                         @D61RDIS 00153000
.* -----------------------------------------------------------          00154000
.* -----------------------------------------------------------          00155000
.RPOST   ANOP                                                           00156000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00157000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00158000
         LA    R8,0(,RE)          GET TIB ADDRESS              @D61RDIS 00159000
         LA    RF,28              GET FUNCTION CODE            @D61RDIS 00160000
* --------------------------------------------------------------        00161000
*          - READY TASK                                                 00162000
*            INPUT  FOR FUNCTION: RE - TIB ADDRESS                      00163000
* --------------------------------------------------------------        00164000
         AGO   .COMMON                                         @D61RDIS 00165000
.* -----------------------------------------------------------          00166000
.* -----------------------------------------------------------          00167000
.UNPOST  ANOP                                                           00168000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00169000
         LA    R8,0(,RE)          GET TIB ADDRESS              @D61RDIS 00170000
         LA    RF,32              GET FUNCTION CODE            @D61RDIS 00171000
* --------------------------------------------------------------        00172000
*          - PROCESS UNPOST FUNCTION                                    00173000
*            INPUT FOR FUNCTION: R8 - TIB ADDRESS                       00174000
* --------------------------------------------------------------        00175000
         AGO   .COMMON                                         @D61RDIS 00176000
.* -----------------------------------------------------------          00177000
.* -----------------------------------------------------------          00178000
.VSMDELA ANOP                                                           00179000
         LA    RF,36              GET FUNCTION CODE            @D61RDIS 00180000
* --------------------------------------------------------------        00181000
*          - VSAM CLEAN UP PROCESS                                      00182000
*            RETURN: FUNCTION WILL NOT RETURN                           00183000
* --------------------------------------------------------------        00184000
         AGO   .COMMON                                         @D61RDIS 00185000
.* -----------------------------------------------------------          00186000
.* -----------------------------------------------------------          00187000
.EOT     ANOP                                                           00188000
* --------------------------------------------------------------        00189000
*          - EOT HIGH PRIORITY REQUEST                                  00190000
*            INPUT FOR FUNCTION: NONE                                   00191000
* --------------------------------------------------------------        00192000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00193000
         LA    RF,40              GET FUNCTION CODE            @D61RDIS 00194000
         AGO   .COMMON                                         @D61RDIS 00195000
.* -----------------------------------------------------------          00196000
.* -----------------------------------------------------------          00197000
.SETLT   ANOP                                                           00198000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00199000
         LA    RF,44              GET FUNCTION CODE            @D61RDIS 00200000
* --------------------------------------------------------------        00201000
*          - SPECIAL LTA PROCESS                                        00202000
* --------------------------------------------------------------        00203000
         AGO   .COMMON                                         @D61RDIS 00204000
.* -----------------------------------------------------------          00205000
.* -----------------------------------------------------------          00206000
.TERML   ANOP                                                           00207000
* --------------------------------------------------------------        00208000
*          - SET DUMP ROUTINE OWNER TO TASK'S ORIGINAL PRIORITY         00209000
*            INPUT FOR FUNCTION: NONE                                   00210000
* --------------------------------------------------------------        00211000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00212000
         LA    R0,0               INDICATE REQUEST TYPE        @D61RDIS 00213000
         LA    RF,48              GET FUNCTION CODE            @D61RDIS 00214000
         AGO   .COMMON                                         @D61RDIS 00215000
.* -----------------------------------------------------------          00216000
.* -----------------------------------------------------------          00217000
.TERMH   ANOP                                                           00218000
* --------------------------------------------------------------        00219000
*          - SET DUMP ROUTINE OWNER TO HIGH PRIORITY                    00220000
*            INPUT FOR FUNCTION: NONE                                   00221000
* --------------------------------------------------------------        00222000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00223000
         LA    R0,1               INDICATE REQUEST TYPE        @D61RDIS 00224000
         LA    RF,48              GET FUNCTION CODE            @D61RDIS 00225000
         AGO   .COMMON                                         @D61RDIS 00226000
.* -----------------------------------------------------------          00227000
.* -----------------------------------------------------------          00228000
.RPOSTX  AIF   (T'&INP1 EQ 'O').REGERR                                  00229000
         AIF   (T'&INP2 EQ 'O').REGERR                                  00230000
* --------------------------------------------------------------        00231000
*          - POST ALL TASKS WITHIN PARTITION                            00232000
*            INPUT FOR FUNCTION:    - RESOURCE ID                       00233000
*                                R1 - TIBSTATE                          00234000
*                                RE - PCB ADDRESS                       00235000
* --------------------------------------------------------------        00236000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00237000
         SLR   R0,R0              CLEAR FOR INSERT             @D61RDIS 00238000
         IC    R0,RPOSTID         GET RESOURCE ID              @D61RDIS 00239000
         LA    R5,0(,RE)          GET PCB ADDRESS              @D61RDIS 00240000
         LA    RF,52              GET FUNCTION CODE            @D61RDIS 00241000
         AGO   .COMMON                                         @D61RDIS 00242000
.* -----------------------------------------------------------          00243000
.* -----------------------------------------------------------          00244000
.CHAP    ANOP                                                           00245000
* --------------------------------------------------------------        00246000
*          - CHANGE SUBTASK'S PRIORITY                                  00247000
*            INPUT FOR FUNCTION: NONE                                   00248000
* --------------------------------------------------------------        00249000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00250000
         LA    RF,56              GET FUNCTION CODE            @D61RDIS 00251000
         AGO   .COMMON                                         @D61RDIS 00252000
.* -----------------------------------------------------------          00253000
.* -----------------------------------------------------------          00254000
.SETLCAL AIF   (T'&INP1 EQ 'O').REGERR                                  00255000
* --------------------------------------------------------------        00256000
*          - PROCESS DISPATCHER FAST PATH                               00257000
*            INPUT  FOR FUNCTION: R1 - TASK ID                          00258000
*            OUTPUT FOR FUNCTION: R5 - PCB ADDRESS                      00259000
*                                 R8 - TIB ADDRESS                      00260000
*                                 RA - TCB ADDRESS                      00261000
*                                 RB - SAVE AREA ADDRESS                00262000
* --------------------------------------------------------------        00263000
         LA    RF,60              GET FUNCTION CODE            @D61RDIS 00264000
         AGO   .COMMON                                         @D61RDIS 00265000
.* -----------------------------------------------------------          00266000
.* -----------------------------------------------------------          00267000
.DISPICS AIF   (T'&INP1 EQ 'O').REGERR                                  00268000
* --------------------------------------------------------------        00269000
*          - SET ICCF PSEUDO PARTITION                                  00270000
*            INPUT  FOR FUNCTION: R8 - TIB ADDRESS                      00271000
* --------------------------------------------------------------        00272000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00273000
         LA    RF,68              GET FUNCTION CODE            @D61RDIS 00274000
         AGO   .COMMON                                         @D61RDIS 00275000
.* -----------------------------------------------------------          00276000
.* -----------------------------------------------------------          00277000
.DISPICR AIF   (T'&INP1 EQ 'O').REGERR                                  00278000
* --------------------------------------------------------------        00279000
*          - RESET ICCF PSEUDO PARTITION                                00280000
*            INPUT  FOR FUNCTION: R8 - TIB ADDRESS                      00281000
* --------------------------------------------------------------        00282000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00283000
         LA    RF,72              GET FUNCTION CODE            @D61RDIS 00284000
         AGO   .COMMON                                         @D61RDIS 00285000
.* -----------------------------------------------------------          00286000
.* -----------------------------------------------------------          00287000
.ATTACH  AIF   (T'&INP1 EQ 'O').REGERR                                  00288000
         AIF   (T'&INP2 EQ 'O').REGERR                                  00289000
* --------------------------------------------------------------        00290000
*          - MAKE SUBTASK DISPATCHABLE                                  00291000
*            INPUT FOR FUNCTION: R8 - SUBTASK'S TIB ADDRESS             00292000
*                                R9 - PCB ADDRESS                       00293000
* --------------------------------------------------------------        00294000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00295000
         LA    RF,76              GET FUNCTION CODE            @D61RDIS 00296000
         AGO   .COMMON                                         @D61RDIS 00297000
.* -----------------------------------------------------------          00298000
.* -----------------------------------------------------------          00299000
.DETACH  AIF   (T'&INP1 EQ 'O').REGERR                                  00300000
         AIF   (T'&INP2 EQ 'O').REGERR                                  00301000
* --------------------------------------------------------------        00302000
*          - MAKE SUBTASK UNDISPATCHABLE                                00303000
*            INPUT FOR FUNCTION: R5 - PCB ADDRESS                       00304000
*                                R8 - SUBTASK'S TIB ADDRESS             00305000
* --------------------------------------------------------------        00306000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00307000
         LA    RF,80              GET FUNCTION CODE            @D61RDIS 00308000
         AGO   .COMMON                                         @D61RDIS 00309000
.* -----------------------------------------------------------          00310000
.* -----------------------------------------------------------          00311000
.RPOST3  AIF   (T'&INP1 EQ 'O').REGERR                                  00312000
         AIF   (T'&INP2 EQ 'O').REGERR                                  00313000
* --------------------------------------------------------------        00314000
*          - POST HIGH PRIORITY WAITER                                  00315000
*            INPUT FOR FUNCTION: R5 - RESOURCE DESCRIPTOR               00316000
*                                RE - TIB ADDRESS                       00317000
* --------------------------------------------------------------        00318000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00319000
         LA    R8,0(,RE)          GET TIB ADDRESS              @D61RDIS 00320000
         LA    RF,92              GET FUNCTION CODE            @D61RDIS 00321000
         AGO   .COMMON                                         @D61RDIS 00322000
.* -----------------------------------------------------------          00323000
.* -----------------------------------------------------------          00324000
.PALB    ANOP                                                           00325000
* --------------------------------------------------------------        00326000
*          - PROCESS PALB                                               00327000
* --------------------------------------------------------------        00328000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00329000
         LA    RF,96              SET FUNCTION CODE            @D61RDIS 00330000
         AGO   .COMMONE                                        @D61RDIS 00331000
.* -----------------------------------------------------------          00332000
.* -----------------------------------------------------------          00333000
.INIT    ANOP                                                           00334000
* --------------------------------------------------------------        00335000
*          - CONTROL BLOCK INITIALIZATION                               00336000
* --------------------------------------------------------------        00337000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00338000
         LA    RF,104             GET FUNCTION CODE            @D61RDIS 00339000
         AGO   .COMMON                                         @D61RDIS 00340000
.* -----------------------------------------------------------          00341000
.* -----------------------------------------------------------          00342000
.ALLBND  ANOP                                                           00343000
* --------------------------------------------------------------        00344000
*          - ALLBOUND PROCESS                                           00345000
*            RETURN: FUNCTION WILL NOT RETURN                           00346000
* --------------------------------------------------------------        00347000
         LA    RF,108             GET FUNCTION CODE            @D61RDIS 00348000
         AGO   .COMMON                                         @D61RDIS 00349000
.* -----------------------------------------------------------          00350000
.* -----------------------------------------------------------          00351000
.REDISP  AIF   (T'&INP1 EQ 'O').REGERR                                  00352000
* --------------------------------------------------------------        00353000
*          - REDISPATCH TASK, IF NO TASK WITH HIGHER PRTY AVAIL.        00354000
*            INPUT FOR FUNCTION: R9 - OLD PSW                           00355000
*            RETURN: FUNCTION WILL NOT RETURN                           00356000
* --------------------------------------------------------------        00357000
         LA    RF,112             GET FUNCTION CODE            @D61RDIS 00358000
         AGO   .COMMON                                         @D61RDIS 00359000
.* -----------------------------------------------------------          00360000
.* -----------------------------------------------------------          00361000
.PFQUERY AIF   (T'&INP1 EQ 'O').REGERR                                  00362000
* --------------------------------------------------------------        00363000
*          - ANY PAGE FAULT PENDING FOR DEVICE ?                        00364000
*            INPUT  FOR FUNCTION: R1 - DEVICE MASK                      00365000
*            OUTPUT FOR FUNCTION: R1 - PCB ADDRESS OF PARTITION         00366000
*                                      = 0, IF NOT AVAILABLE            00367000
* --------------------------------------------------------------        00368000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00369000
         LA    RF,116             GET FUNCTION CODE            @D61RDIS 00370000
         AGO   .COMMON                                         @D61RDIS 00371000
.* -----------------------------------------------------------          00372000
.* -----------------------------------------------------------          00373000
.PFUPD   AIF   (T'&INP1 EQ 'O').REGERR                                  00374000
         AIF   (T'&INP2 EQ 'O').REGERR                                  00375000
         AIF   (T'&INP3 EQ 'O').REGERR                                  00376000
* --------------------------------------------------------------        00377000
*          - SET/RESET PAGE FAULT PENDING FOR DEVICE                    00378000
*            INPUT  FOR FUNCTION: R1 - DEVICE MASK                      00379000
*                                 R3 = 1 - SET PAGE FAULT PENDING       00380000
*                                 R3 = 0 - RESET PAGE FAULT PENDING     00381000
*                                 R5 - PCB ADDRESS OF PARTITION         00382000
* --------------------------------------------------------------        00383000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00384000
         LA    RF,120             GET FUNCTION CODE            @D61RDIS 00385000
         AGO   .COMMON                                         @D61RDIS 00386000
.* -----------------------------------------------------------          00387000
.* -----------------------------------------------------------          00388000
.SETDEF  AIF   (T'&INP1 EQ 'O').REGERR                                  00389000
* --------------------------------------------------------------        00390000
*          - CHECK IF SCB TO BE DEALLOCATED IS                          00391000
*            ACTIVE ON OTHER CPU                                        00392000
*            INPUT  FOR FUNCTION: R1 - SCB TO BE DEALLOCATED            00393000
* --------------------------------------------------------------        00394000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00395000
         LA    RF,124             GET FUNCTION CODE            @D61RDIS 00396000
         AGO   .COMMON                                         @D61RDIS 00397000
.* -----------------------------------------------------------          00398000
.* -----------------------------------------------------------          00399000
.ENTSVC  ANOP                                                           00400000
* --------------------------------------------------------------        00401000
*          - PROCESS TD FAST PATH SERVICES (FCT CODE 32 AND 36)         00402000
*          - LOCK NON-PARALLEL CODE                                     00403000
*          - PROCESS ACCOUNTING                                         00404000
* --------------------------------------------------------------        00405000
         STM   R9,R8,ERA          SAVE REGISTERS               @D61RDIS 00406000
         LA    RF,128             GET FUNCTION CODE            @D61RDIS 00407000
         AGO   .COMMON                                         @D61RDIS 00408000
.* -----------------------------------------------------------          00409000
.* -----------------------------------------------------------          00410000
.UPDJA   ANOP                                                           00411000
* --------------------------------------------------------------        00412000
*          - UPDATE JOB ACCOUNTING COUNTERS                             00413000
* --------------------------------------------------------------        00414000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00415000
         LA    RF,132             GET FUNCTION CODE            @D61RDIS 00416000
         AGO   .COMMON                                         @D61RDIS 00417000
.* -----------------------------------------------------------          00418000
.* -----------------------------------------------------------          00419000
.ENTEXT  ANOP                                                           00420000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00421000
* --------------------------------------------------------------        00422000
*          - EXTERNAL INTERRUPT PROCESS                                 00423000
*          - TRY TO OBTAIN NP LOCK                                      00424000
*          - WHEN NP LOCK OBTAINED,                                     00425000
*              -- DO JOB ACCOUNTING                                     00426000
*              -- SAVE STATUS                                           00427000
*              -- FREE WORK UNIT                                        00428000
*            OTHERWISE                                                  00429000
*              -- DELAY INTERRUPT                                       00430000
*                                                                       00431000
*            INPUT  FOR FUNCTION: RC - EXTERNAL OLD PSW                 00432000
*            WORK   FOR FUNCTION: R9, RB                                00433000
* --------------------------------------------------------------        00434000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00435000
         LA    RF,160             GET FUNCTION CODE            @D61RDIS 00436000
         AGO   .COMMON                                         @D61RDIS 00437000
.* -----------------------------------------------------------          00438000
.* -----------------------------------------------------------          00439000
.ENTIO   ANOP                                                           00440000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00441000
* --------------------------------------------------------------        00442000
*          - I/O INTERRUPT PROCESS                                      00443000
*          - TRY TO OBTAIN NP LOCK                                      00444000
*          - WHEN NP LOCK OBTAINED,                                     00445000
*              -- DO JOB ACCOUNTING                                     00446000
*              -- SAVE STATUS                                           00447000
*              -- FREE WORK UNIT                                        00448000
*            OTHERWISE                                                  00449000
*              -- DELAY INTERRUPT                                       00450000
*                                                                       00451000
*            INPUT  FOR FUNCTION: RC - EXTERNAL OLD PSW                 00452000
* --------------------------------------------------------------        00453000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00454000
         LA    RF,164             GET FUNCTION CODE            @D61RDIS 00455000
         AGO   .COMMON                                         @D61RDIS 00456000
.* -----------------------------------------------------------          00457000
.* -----------------------------------------------------------          00458000
.CHKINTD ANOP                                                           00459000
         AIF   (T'&WR1 EQ 'O').REGERR                                   00460000
&INDEX   SETC  'DMA0&SYSNDX'                                            00461000
&INDEX1  SETC  'DMA1&SYSNDX'                                            00462000
* --------------------------------------------------------------        00463000
*          - CHECK, IF I/O INTERRUPTS ARE PENDING                       00464000
*            WORK   FOR FUNCTION: &WR1                                  00465000
* --------------------------------------------------------------        00466000
         AGO   .CHKCOM                                         @D61RDIS 00467000
.* -----------------------------------------------------------          00468000
.* -----------------------------------------------------------          00469000
.CHKINT  ANOP                                                           00470000
         AIF   (T'&WR1 EQ 'O').REGERR                                   00471000
&INDEX   SETC  'DMA0&SYSNDX'                                            00472000
&INDEX1  SETC  'DMA1&SYSNDX'                                            00473000
* --------------------------------------------------------------        00474000
*          - CHECK, IF I/O INTERRUPTS ARE PENDING                       00475000
*          - FUNCTION WILL ENABLE INTERRUPTS AFTER RETURN               00476000
*            WORK   FOR FUNCTION: &WR1                                  00477000
* --------------------------------------------------------------        00478000
         L     &WR1,IJBTDATB      TAKE TDATAB   POINTER        @D61RDIS 00479000
         L     &WR1,0(,&WR1)      TAKE TDCOMREG POINTER        @D61RDIS 00480000
         TM    TDCFLAG3-TDCOMREG(&WR1),TDCIO  ANY IO QUEUED ?  @D61RDIS 00481000
         BZ    &INDEX1            SKIP REST IF NOT             @D61RDIS 00482000
.CHKCOM  ANOP                                                           00483000
         L     &WR1,TDCPUPTR      GET CPU'S CONTROL BLOCK      @D61RDIS 00484000
         TM    TCPFLAG1-TCPUADR(&WR1),TDCNPA  NP LOCK HELD ?   @D61RDIS 00485000
         BZ    &INDEX1            SKIP REST IF NOT             @D61RDIS 00486000
         L     &WR1,TCPUWRK-TCPUADR(,&WR1) GET WORK AREA ADDR. @D61RDIS 00487000
         STM   R0,RF,TWSAVI-TWCPADR(&WR1) SAVE REGISTERS       @D61RDIS 00488000
         L     RD,AENTIOPR        ADDRESS OF I/O SIMULATION RTN@D61RDIS 00489000
         BAS   R6,0(,RD)          TAKE RETURN ADDRESS          @D61RDIS 00490000
&INDEX   DS    0H                                              @D61RDIS 00491000
         L     R6,TDCPUPTR                  0 RESTORE ALL      @D61RDIS 00492000
         L     &WR1,TCPUWRK-TCPUADR(,&WR1)  4 REGISTERS EXCEPT @D61RDIS 00493000
         LM    R0,RF,TWSAVI-TWCPADR(&WR1)   8 WORK REG         @D61RDIS 00494000
&INDEX1  DS    0H                                              @D61RDIS 00495000
         AIF (&IJBDSPQ).GENEQ EQUATE ALREADY GENERATED         @D61RDIS 00496000
&IJBDSPQ SETB  1            INDICATE EQUATE GENERATED          @D61RDIS 00497000
CHKRTOFF EQU   &INDEX1-&INDEX OFFSET FOR RETURN VIA DISPATCHER @D61RDIS 00498000
.GENEQ   ANOP                                                           00499000
         AIF   ('&FUNC' EQ 'CHKINTD').CHKEXIT                  @D61RDIS 00500000
         STOSM PSWMASK,ENABLE     OPEN WINDOW FOR INTERRUPTS   @D61RDIS 00501000
.CHKEXIT ANOP                                                           00502000
         MEXIT                                                 @D61RDIS 00503000
.* -----------------------------------------------------------          00504000
.* -----------------------------------------------------------          00504000
.DELINT  ANOP                                                           00115000
* --------------------------------------------------------------        00116000
*          - DELAY I/O INTERRUPT                                        00117000
* --------------------------------------------------------------        00118000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D68..IS 00119000
         LA    RF,284             GET FUNCTION CODE            @D68..IS 00120000
         AGO   .COMMONE                                        @D68..IS 00121000
.* -----------------------------------------------------------          00504000
.* -----------------------------------------------------------          00504000
.DSPDELA ANOP                                                           00115000
* --------------------------------------------------------------        00116000
*          - DELAY DISPATCHER CYCLE                                     00117000
*                         REG 0 = TID OF TASK TO BE DELAYED             00117000
*                                 OR ZERO, IF TID OF LOW CORE           00117000
* --------------------------------------------------------------        00118000
         AIF   (T'&INP1 EQ 'O').REGERR                         @D68OMIS 00136000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D68OMIS 00119000
         LA    RF,284             GET FUNCTION CODE            @D68OMIS 00120000
         AGO   .COMMON                                         @D68OMIS 00121000
.* -----------------------------------------------------------          00505000
.* -----------------------------------------------------------          00505000
.SVC133  ANOP                                                           00506000
* --------------------------------------------------------------        00507000
*          - SVC 133 PROCESS                                            00508000
*            APPLICATION HAS TO RUN IN NON-PARALLEL STATE               00509000
*                                                                       00510000
*            INPUT  FOR FUNCTION: R9 - =0 - NON-PARALLEL APPLICATION    00511000
*                                      =4 - PARALLEL APPLICATION        00512000
* --------------------------------------------------------------        00513000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00514000
         LA    RF,172             GET FUNCTION CODE            @D61RDIS 00515000
         AGO   .COMMON                                         @D61RDIS 00516000
.* -----------------------------------------------------------          00517000
.* -----------------------------------------------------------          00518000
.ATTSTAS ANOP                                                           00519000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00520000
* --------------------------------------------------------------        00521000
*          - ATTACH SYSTEM TASK                                         00522000
*                                                                       00523000
*            INPUT  FOR FUNCTION: R1 - PARAMETER LIST ADDRESS           00524000
*            OUTPUT FOR FUNCTION: R1 - TASK ID OF ATTACHED SYSTEM TASK  00525000
* --------------------------------------------------------------        00526000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00527000
         LA    RF,176             GET FUNCTION CODE            @D61RDIS 00528000
         AGO   .COMMON                                         @D61RDIS 00529000
.* -----------------------------------------------------------          00530000
.* -----------------------------------------------------------          00531000
.TDINFO  ANOP                                                           00532000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00533000
* --------------------------------------------------------------        00534000
*          - RETRIEVE TURBO DISPATCHER INFORMATION                      00535000
*                                                                       00536000
*            INPUT  FOR FUNCTION: R1 - ADDRESS OF AREA, WHERE           00537000
*                                      THE INFORMATION IS TO BE         00538000
*                                      STORED (ALREADY VALIDATED)       00539000
*            OUTPUT FOR FUNCTION: RF - RETURN CODE                      00540000
*                                      =  0 - INFORMATION STORED        00541000
*                                      =  8 - OLD DISPATCHER ACTIVE     00542000
*                                             NO INFORMATION AVAIL.     00543000
*                                      = 12 - INVALID PARAMETER LIST    00544000
* --------------------------------------------------------------        00545000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00546000
         LA    RF,180             GET FUNCTION CODE            @D61RDIS 00547000
         AGO   .COMMON                                         @D61RDIS 00548000
.* -----------------------------------------------------------          00549000
.* -----------------------------------------------------------          00550000
.NPQUERY ANOP                                                           00551000
* --------------------------------------------------------------        00552000
*          - CHECK, IF KEY 0 TASK WANTS TO BE DISPATCHED PARALLEL       00553000
*            CALLER HAS TO BE IN DISABLED STATE                         00554000
*                                                                       00555000
*            OUTPUT FOR FUNCTION: RF - =1 - TASK WILL BE DISPATCHED     00556000
*                                           IN NON-PARALLEL MODE        00557000
*                                      =0 - TASK WILL BE DISPATCHED     00558000
*                                           IN PARALLEL MODE            00559000
* --------------------------------------------------------------        00560000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00561000
         LA    RF,184             GET FUNCTION CODE            @D61RDIS 00562000
         AGO   .COMMONE                                        @D61RDIS 00563000
.* -----------------------------------------------------------          00564000
.* -----------------------------------------------------------          00565000
.IPL     ANOP                                                           00566000
* --------------------------------------------------------------        00567000
*          - IPL INITIALIZATION                                         00568000
* --------------------------------------------------------------        00569000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00570000
         LA    RF,188             GET FUNCTION CODE            @D61RDIS 00571000
         AGO   .COMMON                                         @D61RDIS 00572000
.* -----------------------------------------------------------          00573000
.* -----------------------------------------------------------          00574000
.PTLB    ANOP                                                           00575000
* --------------------------------------------------------------        00576000
*          - REQUESTS PTLB FOR ALL ACTIVE CPUS                          00577000
* --------------------------------------------------------------        00578000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00579000
         LA    RF,192             GET FUNCTION CODE            @D61RDIS 00580000
         AGO   .COMMON                                         @D61RDIS 00581000
.* -----------------------------------------------------------          00582000
.* -----------------------------------------------------------          00583000
.CNCLEXI ANOP                                                           00584000
* --------------------------------------------------------------        00585000
*          - CANCEL EXIT PROCESS                                        00586000
* --------------------------------------------------------------        00587000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00588000
         LA    RF,196             GET FUNCTION CODE            @D61RDIS 00589000
         AGO   .COMMON                                         @D61RDIS 00590000
.* -----------------------------------------------------------          00591000
.DISPSTO ANOP                                                           00592000
* --------------------------------------------------------------        00593000
*          - TASK TO BE STOPPED (DISPATCHER EXIT)                       00594000
*            SERVICE WILL RETURN TO DISPATCHER                          00595000
* --------------------------------------------------------------        00596000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00597000
         LA    RF,200             GET FUNCTION CODE            @D61RDIS 00598000
         AGO   .COMMON                                         @D61RDIS 00599000
.* -----------------------------------------------------------          00600000
.GENENT  ANOP                                                           00601000
* --------------------------------------------------------------        00602000
*          - SAVE STATUS INTO USER'S FIRST SAVE AREA                    00603000
*            (PAGE FAULTS MAY OCCUR)                                    00604000
* --------------------------------------------------------------        00605000
         AIF   (T'&WR1 EQ 'O').REGERR                                   00606000
         L     &WR1,TDCPUPTR      GET CPU'S CONTROL BLOCK      @D61RDIS 00607000
         L     &WR1,TCPUWRK-TCPUADR(,&WR1) GET WORK AREA ADDR. @D61RDIS 00608000
         STM   R0,RF,TWSAVE-TWCPADR(&WR1) SAVE REGISTERS       @D61RDIS 00609000
         LR    R1,RE              GET SAVE AREA INDICATION     @D64XDIS 00610000
         LA    RF,204             GET FUNCTION CODE            @D61RDIS 00611000
         AGO   .COMMON                                         @D61RDIS 00612000
.* -----------------------------------------------------------          00613000
.GETSAVR ANOP                                                           00614000
* --------------------------------------------------------------        00615000
*          - GET ADDRESS OF FIRST SAVE AREA                             00616000
*                                                                       00617000
*            INPUT  FOR FUNCTION: RA - TCB ADDRESS                      00618000
*            OUTPUT FOR FUNCTION: R1 - SAVE AREA ADDRESS                00619000
* --------------------------------------------------------------        00620000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00621000
         LA    RF,208             GET FUNCTION CODE            @D61RDIS 00622000
         AGO   .COMMON                                         @D61RDIS 00623000
.* -----------------------------------------------------------          00624000
.UPDCR0  ANOP                                                           00625000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00626000
* --------------------------------------------------------------        00627000
*          - ENABLE/DISABLE VMCF, SERVICE SIGNAL INTERRUPTS, ETC.       00628000
*            (UPDATE CONTROL REGISTER 0 CONTENTS)                       00629000
*            THESE INTERRUPTS ARE ENABLED ONLY ON IPLED CPU             00630000
*                                                                       00631000
*            INPUT  FOR FUNCTION: R0 - MASK TO ENABLE/DISABLE           00632000
*                                      CORRESP. INTERRUPT SUBCLASS      00633000
*                                      R0 - NEGATIVE = DISABLE          00634000
*                                           POSITIVE = ENABLE           00635000
* --------------------------------------------------------------        00636000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61RDIS 00637000
         LA    RF,212             GET FUNCTION CODE            @D61RDIS 00638000
         AGO   .COMMONE                                        @D61RDIS 00639000
.* -----------------------------------------------------------          00640000
.SIGPTS  ANOP                                                           00641000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00642000
* --------------------------------------------------------------        00643000
*          - IF TASK IS ACTIVE ON DIFFERENT CPU, SEND SIGP              00644000
*            TO THIS CPU                                                00645000
*                                                                       00646000
*            INPUT  FOR FUNCTION: R8 - TIB ADDRESS                      00647000
* --------------------------------------------------------------        00648000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @KXANN16 00649000
         LA    R0,0               INDICATE STANDARD PROCESS    @KXANN16 00650000
         LA    RF,216             GET FUNCTION CODE            @KXANN16 00651000
         AGO   .COMMON                                         @KXANN16 00652000
.* -----------------------------------------------------------          00653000
.SETREAD ANOP                                                           00654000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00655000
         AIF   (T'&INP2 EQ 'O').REGERR                                  00656000
* --------------------------------------------------------------        00657000
*          - IF TASK IS ACTIVE ON DIFFERENT CPU, SEND SIGP              00658000
*            TO THIS CPU (SETREADY PROCESS)                             00659000
*                                                                       00660000
*            INPUT  FOR FUNCTION: R4 - RESOURCE DESCRIPTOR ADDRESS      00661000
*                                 R8 - TIB ADDRESS                      00662000
* --------------------------------------------------------------        00663000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @KXANN16 00664000
         LA    R0,1               INDICATE SETREADY PROCESS    @KXANN16 00665000
         LA    RF,216             GET FUNCTION CODE            @KXANN16 00666000
         AGO   .COMMON                                         @KXANN16 00667000
.* -----------------------------------------------------------          00668000
.DEBGON  ANOP                                                           00669000
* --------------------------------------------------------------        00670000
*          - ACTIVATE TURBO DISPATCHER DEBUG TRACE                      00671000
* --------------------------------------------------------------        00672000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @KXANN16 00673000
         LA    R0,1               SET ON INDICATOR             @KXANN16 00674000
         LA    RF,220             GET FUNCTION CODE            @KXANN16 00675000
         AGO   .COMMONE                                        @KXANN16 00676000
.* -----------------------------------------------------------          00677000
.DEBGOFF ANOP                                                           00678000
* --------------------------------------------------------------        00679000
*          - DEACTIVATE TURBO DISPATCHER DEBUG TRACE                    00680000
* --------------------------------------------------------------        00681000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @KXANN16 00682000
         LA    R0,0               SET OFF INDICATOR            @KXANN16 00683000
         LA    RF,220             GET FUNCTION CODE            @KXANN16 00684000
         AGO   .COMMONE                                        @KXANN16 00685000
.* -----------------------------------------------------------          00686000
.TPI     ANOP                                                           00687000
* --------------------------------------------------------------        00688000
*          - CHECK, IF DELAYED I/O INTERRUPTS AVAILABLE                 00689000
* --------------------------------------------------------------        00690000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @KXANN17 00691000
         LA    RF,224             GET FUNCTION CODE            @KXANN17 00692000
         AGO   .COMMON                                         @KXANN17 00693000
.* -----------------------------------------------------------          00694000
.SDEXIT  ANOP                                                           00695000
* --------------------------------------------------------------        00696000
*          - SCHEDULE DISPATCHER EXIT                                   00697000
*            INPUT  FOR FUNCTION: R1 - DISPATCHER EXIT ADDRESS          00698000
*            WORK   FOR FUNCTION: R5                                    00699000
* --------------------------------------------------------------        00700000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00701000
         AIF   (T'&WR1 EQ 'O').REGERR                                   00702000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @DY43697 00703000
         LA    RF,228             GET FUNCTION CODE            @DY43697 00704000
         AGO   .COMMON                                         @DY43697 00705000
.PCENTRY ANOP                                                           00706000
* --------------------------------------------------------------        00707000
*          - OBTAIN NON-PARALLEL LOCK                                   00708000
*            SET UP HOME SPACE, IF NECESSARY                            00709000
* --------------------------------------------------------------        00710000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D64XDIS 00711000
         LA    RF,248             GET FUNCTION CODE            @D64XDIS 00712000
         AGO   .COMMON                                         @D64XDIS 00713000
.* -----------------------------------------------------------          00714000
.PCRETUR ANOP                                                           00715000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00716000
* --------------------------------------------------------------        00717000
*          - RELEASE NON-PARALLEL LOCK, IF POSSIBLE                     00718000
*            RESTORE CROSS MEMORY ENVIRONMENT, IF NECESSARY             00719000
*                                                                       00720000
*            INPUT  FOR FUNCTION: RC - OLD PSW                          00721000
* --------------------------------------------------------------        00722000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D64XDIS 00723000
         LA    RF,252             GET FUNCTION CODE            @D64XDIS 00724000
         AGO   .COMMON                                         @D64XDIS 00725000
.* -----------------------------------------------------------          00726000
.CHAPMVS ANOP                                                           00727000
* --------------------------------------------------------------        00728000
*          - CHANGE SUBTASK'S PRIORITY (MVS SIMULATION)                 00729000
*            INPUT FOR FUNCTION:                                        00730000
*                                R1 - TIB ADDRESS OF SUBTASK            00731000
*                                     WHERE PRIORITY IS TO BE CHANGED   00732000
* --------------------------------------------------------------        00733000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00734000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D64ADIS 00735000
         LA    RF,232             GET FUNCTION CODE            @D64ADIS 00736000
         AGO   .COMMON                                         @D64ADIS 00737000
.* -----------------------------------------------------------          00738000
.PARTST  ANOP                                                           00739000
* --------------------------------------------------------------        00740000
*          - RETRIEVE PARTITION STATUS                                  00741000
*            INPUT  FOR FUNCTION: R5 - PARTITION/CLASS PCB ADDRESS      00742000
*            OUTPUT FOR FUNCTION: RF - SHARE VALUE OF PART./CLASS       00743000
* --------------------------------------------------------------        00744000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D61TDIS 00745000
         LA    RF,256             GET FUNCTION CODE            @D61TDIS 00746000
         AGO   .COMMON                                         @D61TDIS 00747000
.* -----------------------------------------------------------          00748000
.SVC150  ANOP                                                           00749000
* --------------------------------------------------------------        00750000
*          - INITIATE PARALLEL PROCESS                                  00751000
* --------------------------------------------------------------        00752000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D64ADIS 00753000
         LA    RF,260             GET FUNCTION CODE            @D64ADIS 00754000
         AGO   .COMMON                                         @D64ADIS 00755000
.* -----------------------------------------------------------          00756000
.SCHED   ANOP                                                           00757000
* --------------------------------------------------------------        00758000
*          - SCHEDULE A DISPATCHER EXIT                                 00759000
*            WITH LOWER PRIORITY THAN TIBFLAG EXITS                     00760000
*            INPUT  FOR FUNCTION: R0 - TYPE OF EXIT                     00761000
*                                      = 0 - EXIT FOR TASKING           00762000
*                                 R1 - ADDRESS OF EXIT TO BE CALLED     00763000
*                                 R2 - ADDRESS OF PARAMETER LIST        00764000
*                                 R8 - TIB ADDRESS, WHERE EXIT          00765000
*                                      IS TO BE SCHEDULED               00766000
* --------------------------------------------------------------        00767000
         AIF   (T'&INP1 EQ 'O').REGERR                                  00768000
         AIF   (T'&INP2 EQ 'O').REGERR                                  00769000
         AIF   (T'&INP3 EQ 'O').REGERR                                  00770000
.*       AIF   (T'&INP4 EQ 'O').REGERR                                  00771000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D64ADIS 00772000
         LA    RF,264             GET FUNCTION CODE            @D64ADIS 00773000
         AGO   .COMMON                                         @D64ADIS 00774000
.* -----------------------------------------------------------          00775000
.MVSSVC  ANOP                                                           00776000
* --------------------------------------------------------------        00777000
*          - INITIATE PARALLEL PROCESS                                  00778000
* --------------------------------------------------------------        00779000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D64ADIS 00780000
         LA    RF,268             GET FUNCTION CODE            @D64ADIS 00781000
         AGO   .COMMON                                         @D64ADIS 00782000
.* -----------------------------------------------------------          00783000
.FREELOC ANOP                                                           00784000
* --------------------------------------------------------------        00785000
*          - FREE LOCKS OF SETLOCK ROUTINES                             00786000
* --------------------------------------------------------------        00787000
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @D64ADIS 00788000
         LA    RF,272             GET FUNCTION CODE            @D64ADIS 00789000
         AGO   .COMMON                                         @D64ADIS 00790000
.* -----------------------------------------------------------          00791000
.POST82  ANOP                                                  @DYXXXIS 00791080
* --------------------------------------------------------------        00791160
*          - POST ALL WAITBND TASKS WITHIN ACTIVE PARTITION             00791240
*            INPUT  FOR FUNCTION: R1 - TYPE OF EXIT                     00791320
*                                      = 0 - RETRANSLATION              00791400
*                                      = 4 - MOVECCB (DISP. EXIT)       00791480
* --------------------------------------------------------------        00791560
         AIF   (T'&INP1 EQ 'O').REGERR                                  00791640
         STM   R0,RF,TDSAVE       SAVE REGISTERS               @DYXXXIS 00791720
         LA    RF,276             GET FUNCTION CODE            @DYXXXIS 00791800
         AGO   .COMMON                                         @DYXXXIS 00791880
.* -----------------------------------------------------------          00792000
.NEXTTIB ANOP                                                  @D66ODOW         
* --------------------------------------------------------------                
*          - RETURN TIB ADDRESS                                                 
*            INPUT  FOR FUNCTION: SFUNC = NEXTLOW/NEXTHIGH                      
*                                 INP1  = (8) :TIB-ADDRESS OR 0                 
*                                 INP2  = (5) :PCB ADDRESS                      
*            OUTPUT : SUBTASK WITH NEXT LOWER/HIGHER                            
*                                  PRIORITY IF R8 CONTAINS TIB ADDRESS          
*                     TASK WITH HIGHEST/LOWEST PRIORITY WITHIN                  
*                                  PARTITION IF R8 IS ZERO                      
* --------------------------------------------------------------                
         AIF   (T'&ERREXIT NE 'O').NXTIB00                     @D66ODOW         
         MNOTE 8,'ERREXIT IS REQUIRED PARAMETER'               @D66ODOW 00091000
         MEXIT                                                 @D66ODOW         
.NXTIB00 ANOP                                                  @D66ODOW         
&RTIB    SETC  '8'                                             @D66ODOW         
         AIF   (T'&INP1 EQ 'O').NXTIB10                        @D66ODOW         
&RTIB    SETC  '&INP1(1)'                                      @D66ODOW         
.NXTIB10 ANOP                                                  @D66ODOW         
&RPCB    SETC  '5'                                             @D66ODOW         
         AIF   (T'&INP2 EQ 'O').NXTIB20                        @D66ODOW         
&RPCB    SETC  '&INP2(1)'                                      @D66ODOW         
.NXTIB20 ANOP                                                  @D66ODOW         
         STM   0,15,TDSAVE        SAVE REGISTERS               @D66ODOW         
         LH    15,PCEPIK-PCBADR(,&RPCB) PIK OF SPECIFIED PART  @D66ODOW         
         LTR   &RTIB,&RTIB                                     @D66ODOW         
         BZ    *+8                                             @D66ODOW         
         LH    15,TIBRTID-TIBADR(,&RTIB) TID OF SPECFIED TASK  @D66ODOW         
         AIF   ('&SFUNC' EQ 'NEXTLOW').NXTIB30                 @D66ODOW         
         AIF   ('&SFUNC' NE 'NEXTHIGH').TIBERR                 @D66ODOW         
         LA    0,1                INDICATE NEXTHIGH            @D66ODOW         
         AGO   .NXTIB40                                        @D66ODOW         
.NXTIB30 ANOP                                                  @D66ODOW         
         SR    0,0                INDICATE NEXTLOW             @D66ODOW         
.NXTIB40 ANOP                                                  @D66ODOW         
         AIF   ('&RTIB' EQ '8').NXTIB60                        @D66ODOW         
         LR    8,&RTIB                                         @D66ODOW         
.NXTIB60 ANOP                                                  @D66ODOW         
         AIF   ('&RPCB' EQ '5').NXTIB70                        @D66ODOW         
         LR    5,&RPCB                                         @D66ODOW         
.NXTIB70 ANOP                                                  @D66ODOW         
         LR    1,15                                            @D66ODOW         
         LA    15,280             GET FUNCTION CODE            @D66ODOW         
         AGO   .COMMONE                                        @D66ODOW         
.* -----------------------------------------------------------          00792500
.*       - COMMON PATH (EXTERNAL CALLERS)                               00793000
.* -----------------------------------------------------------          00794000
.COMMONE ANOP                                                           00795000
         AIF   (&IJBSGEN).COMMON                               @D66ODOW 00796000
         ASYSCOM 13                     GET SYSCOM ADDRESS     @D66ODOW 00796000
         L     13,IJBSPAVT-SYSCOM(,13)  GET SUPAVT ADDRESS     @D66ODOW 00797000
         L     13,ADISPRT-SUPAVT(,13)   GET DISP ROUTINE ADDR. @D66ODOW 00798000
         AGO   .COMMON1                                        @D61RDIS 00799000
.* -----------------------------------------------------------          00800000
.* -----------------------------------------------------------          00801000
.*       - COMMON PATH (CALLERS FROM SUPERVISOR)                        00802000
.* -----------------------------------------------------------          00803000
.COMMON  ANOP                                                           00804000
         L     RD,ADISPRT         GET DISP ROUTINE ADDRESS     @D61RDIS 00805000
.COMMON1 ANOP                                                           00806000
         BASSM 14,13               CALL IJBDISP ROUTINE        @D66ODOW 00807000
         AIF   ('&FUNC' EQ 'ENTSVC').RESTERA                   @D61RDIS 00808000
         AIF   ('&FUNC' EQ 'DISP').NOREST                      @D61RDIS 00809000
         AIF   ('&FUNC' EQ 'VSMDELAY').NOREST                  @D61RDIS 00810000
         AIF   ('&FUNC' EQ 'SETLCALL').NOREST                  @D61RDIS 00811000
         AIF   ('&FUNC' EQ 'ALLBND').NOREST                    @D61RDIS 00812000
         AIF   ('&FUNC' EQ 'REDISP').NOREST                    @D61RDIS 00813000
         AIF   ('&FUNC' EQ 'INIT').NOREST                      @D61RDIS 00814000
         AIF   ('&FUNC' EQ 'LOADDYN').NOREST                   @D61RDIS 00815000
         AIF   ('&FUNC' EQ 'ATTSTASK').NOREST                  @D61RDIS 00816000
         AIF   ('&FUNC' EQ 'TDINFO').NOREST                    @D61RDIS 00817000
         AIF   ('&FUNC' EQ 'DISPSTOP').NOREST                  @D61RDIS 00818000
         AIF   ('&FUNC' EQ 'GENENT').NOREST                    @D61RDIS 00819000
         AIF   ('&FUNC' EQ 'SVC150').NOREST                    @D61RDIS 00820000
         AIF   ('&FUNC' EQ 'TIB').TIBREST                      @D66ODOW         
         LM    0,15,TDSAVE        RESTORE REGISTERS            @D66ODOW 00821000
         MEXIT                                                          00822000
.* --------------------------------------------------------------       00823000
.* --------------------------------------------------------------       00824000
.RESTERA ANOP                                                           00825000
         LM    R9,R8,ERA          RESTORE REGISTERS            @D61RDIS 00826000
         MEXIT                                                          00827000
.* --------------------------------------------------------------               
.* --------------------------------------------------------------               
.TIBREST ANOP                                                  @D66ODOW         
         BASR  1,0                SET TEMPORARY BASE           @D66ODOW         
         STCM  8,15,26(1)         SAVE                         @D67ODOW         
         STCM  15,15,30(1)        .... OUTPUT                  @D67ODOW         
         LTR   15,15              CHECK RETURN CODE            @D66ODOW         
         LM    0,15,TDSAVE        RESTORE REGISTER             @D66ODOW         
         BNZ   &ERREXIT           CONTINUE WITH ERROR          @D66ODOW         
         ICM   &RTIB,15,*+8       TIB ADDR TO CORRECT REGISTER @D66ODOW         
         B     *+12               SKIP SAVE AREA               @D67ODOW         
         DC    X'00000000'        SAVE AREA FOR TIB            @D66ODOW         
         DC    X'00000000'        SAVE AREA FOR RETCODE        @D67ODOW         
         MEXIT                                                 @D66ODOW         
.* --------------------------------------------------------------       00828000
.* --------------------------------------------------------------       00829000
.NOREST  ANOP                                                           00830000
         MEND                                                           00832000
