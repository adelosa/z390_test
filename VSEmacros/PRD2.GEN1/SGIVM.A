*%GOTO  IVMCI; /*PLS COMMENT TO AVOID UNMATCHED QUOTE PROBLEMS          00020000
         MACRO                                                          00040000
         SGIVM &DSECT=YES                                               00060000
         GBLA  &NPART             NUMBER OF PARTITION SPECIFIED         00080000
         GBLA  &NCLASS            NUMBER OF DYNAMIC CLASSES    @D51IDIS 00100000
         GBLB  &IJBSGEN           SUPERVISOR GENERATION                 00120000
         GBLB  &SGIVM             COMPONENT NAME FOR PRINT              00140000
         GBLB  &BGVM              MODE=VM GENERATED ?          @D51IDIS 00160000
         GBLB  &BGDEBUG           DEBUG OPTION                          00180000
         GBLC  &P(13)             PARTITION IDENTIFIER                  00200061
         LCLC  &CS                TEMPORARY VALUE                       00220000
         LCLC  &BL                TEMPORARY VALUE                       00240000
         LCLA  &X                 TEMPORARY VALUE                       00260000
         LCLA  &NUM               MAX. NUMBER OF INTRIES       @D51IDIS 00280000
.*       IBM DISK OPERATING SYSTEM                            *         00300000
***************************************************************         00320000
*        SUPERVISOR - SGIVM    - 5686-VSE                     *@D61NDMZ 00340061
*        LICENSED MATERIALS - PROPERTY OF IBM                 *         00360000
*        THIS MACRO IS "RESTRICTED MATERIALS OF IBM"          *         00380000
*        5690-VSE (C) COPYRIGHT IBM CORP. 1989, 1995          *         00400061
*        SEE COPYRIGHT INSTRUCTIONS                           *         00420000
***************************************************************         00440000
         SPACE 4                                                        00460000
.**** START OF SPECIFICATIONS ***************************************** 00480000
.*                                                                      00500000
.*01* MODULE-TYPE = MACRO                                               00520000
.*                                                                      00540000
.*01* DESCRIPTIVE NAME = A) MAPPING OF IAF SYSTEM AND                   00560000
.*                          PARTITION CONTROL BLOCKS (DSECT=YES)        00580000
.*                       B) ATTENTION ROUTINE ONLY (DSECT=AR):          00600000
.*                          FIRST PART OF IVMCIMSS MAPPING              00620000
.*                       C) VSE/SP COMPONENTS/IAF (DSECT=MSS):          00640000
.*                          INVPARML AND IVMCIMSS MAPPING               00660000
.*                       D) SUPERVISOR ONLY (DSECT=NO):                 00680000
.*                          1) INITIALIZATION OF INVENT PROCESSOR       00700000
.*                          2) DATA COLLECTION INITIALIZATION           00720000
.*                             (CALLED BY SUPERVISOR HOOKS)             00740000
.*                          3) INTERMEDIATE RECORD HANDLER              00760000
.*                             SERVICES AND SUBROUTINES                 00780000
.*                          4) INTERMEDIATE RECORD HANDLER              00800000
.*                             (IMR) SYSTEM TASK                        00820000
.*                          5) IAF SVC 117                              00840000
.*                          6) MAPPING AND INLINE CODE OF               00860000
.*                             IAF CONTROL BLOCKS                       00880000
.*                                                                      00900000
.*  STATUS           =  NEW MACRO - FIRST RELEASE AF 4.1.1              00920000
.*                                                                      00940000
.*  FUNCTION         =  SHOW LAYOUT OF IAF CONTROL BLOCKS               00960000
.*                      AND CODE                                        00980000
.*  NOTES            =  NONE                                            01000000
.*  DEPENDENCIES     =  NONE                                            01020000
.*  RESTRICTIONS     =  NONE                                            01040000
.*  REGISTER CONVENT.=  NONE                                            01060000
.*  REGISTER CONVENT.=  R3 - BASE REGISTER FOR 4)                       01080000
.*                      RC - BASE REGISTER FOR 5)                       01100000
.*                      RD - BASE REGISTER FOR 1), 2) AND 3),           01120000
.*                           IVMCIMSS ADDRESS                           01140000
.*  PATCH LABEL      =  NONE                                            01160000
.*  MACRO TYPE       =  ASSEMBLER                                       01180000
.*  PROCESSOR        =  ASM                                             01200000
.*  MACRO SIZE       =  SEE OUTPUT                                      01220000
.*  ATTRIBUTES       =  MAPPING DSECT AND/OR INLINE CODE                01240000
.*  ENTRY POINT      =  IVMENTRY                                        01260000
.*                      MSSARCMD                                        01280000
.*                      IMRGATE                                         01300000
.*                      GETBUFF                                         01320000
.*                      ENQBUFF                                         01340000
.*                      SVC117                                          01360000
.*  PURPOSE          =  SEE FUNCTION                                    01380000
.*  LINKAGE          =  DEPENDENT ON ENTRY POINT                        01400000
.*  CALLER           =  SUPERVISOR OR OTHER IAF ROUTINES, POWER         01420000
.*  INPUT            =  SEE MACRO PARAMETER                             01440000
.*  OUTPUT           =  DSECT OR INLINE CODE OF IAF SUPVR. HOOKS        01460000
.*                                                                      01480000
.*  EXIT NORMAL      =  MACRO EXPANSION                                 01500000
.*                                                                      01520000
.*  EXIT ERROR       =  NONE                                            01540000
.*                                                                      01560000
.*  EXTERNAL REFEREN.=  SUPERVISOR CONTROL BLOCKS AND FIELDS            01580000
.*  ROUTINES         =  DISPATCHER AND IAF SVA ROUTINES                 01600000
.*  DATA AREAS       =  SUPERVISOR AND IAF DATA AREAS                   01620000
.*  CONTROL BLOCKS   =  SUPERVISOR AND IAF CONTROL BLOCKS               01640000
.*  TABLES           =  NONE                                            01660000
.*  MACROS           =  INVENTRY, IVMCIPHD                              01680000
.*  CHANGE ACTIVITIES=  NEW MACRO - FIRST RELEASE AF 4.1.1     @D31ZDIS 01700000
.*    VSIC 1.2.0                                               @D31FMIS 01720000
.*    'RETRIEVAL FROM PUNCH QUEUE' CHANGED TO 'RETRIEVAL FROM           01740000
.*    LIST QUEUE' (NOT REFLECTED IN ALL LABELS)                @D31FMIS 01760000
.*    CANCEL CODE TRANSLATED TO HEX OUTPUT VALUE               @D31FMIS 01780000
.*    SUPPORT FOR ADDITIONAL CICS MONITORING INFORMATION       @D31FMIS 01790000
.*    MORE PARTITION SUPPORT                                   @D51IDIS 01800000
.*    'ASSGN MACRO FAILED' MSG SUPPRESSED - BAM ERROR RESET    @DY40063 01806600
.*    VSIC NO LONGER SUPPORTED - CODE GENERATION PARTIALLY     @D61NDIS 01808861
.*                   CODE GENERATION PARTIALLY DROPPED         @D61NDIS 01811061
.*                                                                      01813200
.*  MODIFIED REGISTER=  SEE DESCRIPTION OF ENTRY POINT                  01820000
.*                                                                      01840000
.**** END OF SPECIFICATIONS ******************************************* 01860000
.*                                                                      01880000
         AIF   (&IJBSGEN).NOWARN                                        01900000
*********************************************************************** 01920000
* WARNING: THE FOLLOWING MAPPING REFERS TO AN INTERNAL SUPERVISOR     * 01940000
*          CONTROL BLOCK. IT MAY CHANGE ANY TIME AND IS NOT COMMITTED * 01960000
*          AS AN INTERFACE OF ANY LEVEL.                              * 01980000
*********************************************************************** 02000000
         AGO   .DSECT                                                   02020000
.NOWARN  ANOP                                                           02040000
         AIF   (NOT &BGDEBUG OR NOT &SGIVM).DSECT                       02060000
         PRINT GEN                                                      02080000
 TITLE 'DOS SUPERVISOR      SGIVM - INVENTORY ASSIST FACILITY (IAF)'    02100000
.DSECT   ANOP                                                           02120000
         AIF ('&DSECT' EQ 'AR').MSS1    SGIVM CALLED BY AR ?            02140000
**********************************************************************  02160000
* INVPARML - PARAMETER LIST DSECT FOR INVENTRY FUNC=INVENT              02180000
*********************************************************************** 02200000
         SPACE 1                                                        02220000
INVPARML DSECT                                                          02240000
PRMLOPC  DS    X       FLAG BYTE (OPERATIONS)                           02260000
PRMON    EQU   X'80'     0  ALL PARTITIONS TO BE MONITORED (INVENT ON)  02280000
PRMONPA  EQU   X'40'     1  PARTITIONS IN SYSLOG ID BUFFER TO BE        02300000
*                           MONITORED (INVENT ON,PART=...)              02320000
PRMONNP  EQU   X'20'     2  PARTITIONS NOT TO BE MONITORED IN           02340000
*                           SYSLOG ID BUFFER (INVENT ON,NOTPART=...)    02360000
PRMOFF   EQU   X'10'     3  DEACTIVATE MONITORING (INVENT OFF)          02380000
PRMFORCE EQU   X'08'     4  FORCED DEACTIVATION (INVENT OFF,FORCE)      02400000
PRMDISPL EQU   X'04'     5  DISPLAY CURRENT STATE (INVENT)              02420000
PRMREL2  EQU   X'02'     6  RELEASE 2 INDICATOR                @D31FMIS 02440000
*                        7  NOT USED                                    02460000
PRMALL   EQU   PRMON+PRMONPA+PRMONNP+PRMOFF+PRMFORCE+PRMDISPL           02480000
*                           ALL POSSIBLE OPERATIONS                     02500000
PRMSTATE DS    X       FLAG BYTE (MONITOR STATE)                        02520000
PRMSON   EQU   X'80'     0  IAF ACTIVE                                  02540000
PRMSOFF  EQU   X'40'     1  IAF INACTIVE                                02560000
PRMDELOF EQU   X'20'     2  DELAYED DEACTIVATION                        02580000
PRMFOROF EQU   X'10'     3  FORCED DEACTIVATION                         02600000
PRMOPEN  EQU   X'08'     4  IMR FILE OPENED                             02620000
PRMNOTOP EQU   X'04'     5  IMR FILE NOT OPENED                         02640000
*                       6-7 NOT USED                                    02660000
PRMLACT  DS    H       NUMBER OF SYSLOG IDS IN BUFFER (ACTIVATION)      02680000
PRMARPT  DS    F       ADDRESS OF SYSLOG ID BUFFER    (ACTIVATION)      02700000
PRMRET   DS    H       ADDITIONAL RETURN CODE INFORMATION               02720000
PRMLDACT DS    H       NUMBER OF SYSLOG IDS IN BUFFER (DEACTIVATION)    02740000
PRMDAPT  DS    F       ADDRESS OF SYSLOG ID BUFFER    (DEACTIVATION)    02760000
PRMLEN   EQU   *-PRMLOPC EQUATE FOR PARML LENGTH                        02780000
PRMLOPC2 DS    X       FLAG BYTE (OPERATIONS 2)                @D31FMIS 02800000
PRMIMRON EQU   X'80'     0  ACTIVATE LST RETRIEVEL (IMR=ON)    @D31FMIS 02820000
PRMIMROF EQU   X'40'     1  DEACT.   LST RETRIEVEL (IMR=OFF)   @D31FMIS 02840000
PRMCICON EQU   X'20'     2  ACTIVATE CICS MONITORING (CICS=ON) @D31FMIS 02860000
PRMCICOF EQU   X'10'     3  DEACT.   CICS MONITORING (CICS=OFF)@D31FMIS 02880000
*                       4-7 NOT USED                           @D31FMIS 02900000
PRMSTAT2 DS    X       FLAG BYTE (MONITOR STATE 2)             @D31FMIS 02920000
PRMCONF  EQU   X'80'     0  IVMPLMV NOT FOUND IN SVA           @D31FMIS 02940000
PRMPUON  EQU   X'40'     1  LST QUEUE RETRIEVAL ACTIVE         @D31FMIS 02960000
PRMPUOFF EQU   X'20'     2  LST QUEUE RETRIEVAL INACTIVE       @D31FMIS 02980000
PRMPUDAC EQU   X'10'     3  LST QUEUE RETRIEVAL DEL. DEACT.    @D31FMIS 03000000
PRMSCION EQU   X'08'     4  CICS MONITORING ACTIVE             @D31FMIS 03020000
PRMSCIOF EQU   X'04'     5  CICS MONITORING INACTIVE           @D31FMIS 03040000
PRMSLAVE EQU   X'02'     6  SLAVE NODE                         @D31FMIS 03060000
*                        7  NOT USED                           @D31FMIS 03080000
PRMSNODE DS    CL8      PNET ID OF RECEIVING NODE              @D31FMIS 03100000
PRMSCLAS DS    CL1      LST CLASS OF RECEIVING NODE            @D31FMIS 03120000
         DS    X       NOT USED                                @D31FMIS 03140000
PRMACTPT DS    F       ADDRESS OF BUFFER CONTAINING ACTIVE ENTR@D31FMIS 03160000
PRMACTLN DS    H       NUMBER OF ENTRIES WITHIN ABOVE BUFFER   @D31FMIS 03180000
         DS    H       NOT USED                                @D31FMIS 03185000
PRMCICPT DS    F       ADDRESS OF BUFFER CONT. ACTIVE CICS ENTR@D31FMIS 03190000
PRMCICLN DS    H       NUMBER OF ENTRIES WITHIN ABOVE BUFFER   @D31FMIS 03195000
PRMLEN2  EQU   *-PRMLOPC EQUATE FOR PARML LENGTH RELEASE 2     @D31FMIS 03200000
         EJECT ,                                                        03220000
         AIF ('&DSECT' EQ 'MSS').MSS1   IVMCIMSS SHOULD BE GENERATED    03240000
         IVMCIIMR                                                       03260000
         EJECT ,                                               @D31FMIS 03280000
         IVMCCONF                                              @D31FMIS 03300000
         EJECT ,                                                        03320000
*******************************************************************     03340000
* IVMCIMSP - DSECT, IAF'S PARTITION CONTROL BLOCK                       03360000
*            (IN FIXED STORAGE LOCATION)                                03380000
*******************************************************************     03400000
IVMCIMSP DSECT              DSECT FOR IAF'S PART. CONTROL BLOCK         03420000
MSPLEN   DS    H            LENGTH OF CONTROL BLOCK                     03440000
MSPARTST DS    X            FLAG BYTE (MONITOR STATE OF PARTITION)      03460000
MSPON    EQU   X'80'          0  MONITORING ACTIVE (ON)                 03480000
MSPOFF   EQU   X'40'          1  MONITORING INACTIVE (OFF)              03500000
MSPIGN   EQU   X'20'          2  DO NOT MONITOR SVC HOOK (ENTSVC)       03520000
MSPDELOF EQU   X'10'          3  DELAYED DEACTIVATION                   03540000
*                            4-7 NOT USED                               03560000
MSPSFLAG DS    X            FLAG BYTE (MONITORING INDICATION)           03580000
MSPSVC0C EQU   X'80'          0  SVC 0 CONSOLE I/O MONITORED            03600000
MSPCICSE EQU   X'40'          1  CICS MONITORING ENABLED       @D31FMIS 03613300
*                            2-7 NOT USED                      @D31FMIS 03626600
MSPAPCB  DS    F            CORRESPONDING PCB ADDRESS                   03640000
MSPMONLV DS    H            MONITOR LEVEL                               03660000
MSPARTFG DS    X            SUBSYSTEM INFORMATION FLAGS                 03680000
         DS    X            NOT USED                                    03700000
MSPBUFDS DS    F            POINTER TO BUFFER DESCRIPTOR                03720000
MSPASAVE DS    F            SAVE AREA POINTER TO IVMCISAV               03740000
MSPLENQ  EQU   *-IVMCIMSP   EQUATE FOR IVMCIMSP LENGTH                  03760000
         EJECT ,                                                        03780000
*******************************************************************     03800000
* IVMCISAV - DSECT, IAF'S SPECIAL SAVE AREA (PER PARTITION,             03820000
*            IN FIXED STORAGE LOCATION)                                 03840000
*******************************************************************     03860000
IVMCISAV DSECT              DSECT FOR IAF'S SPECIAL SAVE AREA           03880000
MSPSSV00 DS    F            SUPERVISOR ROUTINE SAVE AREA REGISTER 0     03900000
MSPSSV02 DS    F            SUPERVISOR ROUTINE SAVE AREA REGISTER 2     03920000
MSPSSV04 DS    F            SUPERVISOR ROUTINE SAVE AREA REGISTER 4     03940000
MSPSSV05 DS    F            SUPERVISOR ROUTINE SAVE AREA REGISTER 5     03960000
MSPSSV06 DS    F            SUPERVISOR ROUTINE SAVE AREA REGISTER 6     03980000
MSPSSV08 DS    F            SUPERVISOR ROUTINE SAVE AREA REGISTER 8     04000000
MSPSSV0E DS    F            SUPERVISOR ROUTINE SAVE AREA REGISTER E     04020000
MSPSSLNQ EQU   *-IVMCISAV   EQUATE FOR SAVE AREA LENGTH (SUP.ROUTINE)   04040000
MSPDSV00 DS    F            SVA ROUTINE SAVE AREA REGISTER 0            04060000
MSPDSV01 DS    F            SVA ROUTINE SAVE AREA REGISTER 1            04080000
MSPDSV02 DS    F            SVA ROUTINE SAVE AREA REGISTER 2            04100000
MSPDSV03 DS    F            SVA ROUTINE SAVE AREA REGISTER 3            04120000
MSPDSV04 DS    F            SVA ROUTINE SAVE AREA REGISTER 4            04140000
MSPDSV05 DS    F            SVA ROUTINE SAVE AREA REGISTER 5            04160000
MSPDSV06 DS    F            SVA ROUTINE SAVE AREA REGISTER 6            04180000
MSPDSV07 DS    F            SVA ROUTINE SAVE AREA REGISTER 7            04200000
MSPDSV08 DS    F            SVA ROUTINE SAVE AREA REGISTER 8            04220000
MSPDSV09 DS    F            SVA ROUTINE SAVE AREA REGISTER 9            04240000
MSPDSV0A DS    F            SVA ROUTINE SAVE AREA REGISTER A            04260000
MSPDSV0B DS    F            SVA ROUTINE SAVE AREA REGISTER B            04280000
MSPDSV0C DS    F            SVA ROUTINE SAVE AREA REGISTER C            04300000
MSPDSV0D DS    F            SVA ROUTINE SAVE AREA REGISTER D            04320000
MSPDSV0E DS    F            SVA ROUTINE SAVE AREA REGISTER E            04340000
MSPDSV0F DS    F            SVA ROUTINE SAVE AREA REGISTER F            04360000
MSPSIVMP DS    F            ADDRESS OF CORRESPONDING IVMCIMSP           04380000
MSPIMRHD DS    CL(IHDLEN)   SVA ROUTINE SAVE AREA FOR IMR HEADER        04400000
MSPFCHWK DS    CL(LFCHWORK) SAVE AREA FOR FETCH WORK AREA               04420000
MSPSLENQ EQU   *-IVMCISAV   EQUATE FOR SAVE AREA LENGTH                 04440000
         EJECT ,                                                        04460000
*******************************************************************     04480000
* BUFDESCR - DSECT, BUFFER DESCRIPTOR CONTROL BLOCK                     04500000
*            ALLOCATED FOR A NEW BUFFER                                 04520000
*            (IN FIXED STORAGE LOCATION)                                04540000
*******************************************************************     04560000
BUFDESCR DSECT              DSECT FOR BUFFER DESCRIPTOR                 04580000
BUFDESLN DS    H            LENGTH OF CONTROL BLOCK                     04600000
BUFPIK   DS    H            PIK OF DESCRIPTOR OWNER                     04620000
BUFPTR   DS    F            POINTER TO BUFFER                           04640000
BUFCHAIN DS    F            A) FULL BUFFER CHAIN: IF ENQUEUED,          04660000
*                              POINTER TO NEXT BUFDESCR,                04680000
*                              LAST IN CHAIN IS ZERO                    04700000
*                           B) FREE BUFFER CHAIN: IF ENQUEUED,          04720000
*                              POINTER TO NEXT BUFDESCR,                04740000
*                              LAST IN CHAIN IS ZERO                    04760000
*                           C) NOT ENQUEUED: ZERO                       04780000
BUFLENQ  EQU   *-BUFDESCR   EQUATE FOR BUFDESCR LENGTH                  04800000
         EJECT ,                                                        04820000
         AIF (('&DSECT' EQ 'NO') OR ('&DSECT' EQ 'YES')).PARMOK         04840000
         AIF ('&DSECT' EQ 'YES').MSS1   GENERATE IVMCIMSS DSECT         04860000
         MNOTE 4,'INVALID DSECT OPERAND SPECIFIED, DSECT ASSUMED'       04880000
         AGO   .MSS1        CONTINUE WITH IVMCIMSS DSECT                04900000
.PARMOK  ANOP                                                           04920000
         AIF ('&DSECT' EQ 'YES').MSS1   GENERATE IVMCIMSS DSECT         04940000
         AIF   (&IJBSGEN).INLINE                                        04960000
         MNOTE 4,'DSECT=NO NOT ALLOWED, DSECT=YES ASSUMED'              04980000
         AGO   .MSS1        CONTINUE WITH IVMCIMSS DSECT                05000000
.INLINE  ANOP                                                           05020000
         INVENTRY FUNC=EQU,TYPE=SUP                                     05040000
         EJECT ,                                                        05060000
         INVENTRY FUNC=EQU,TYPE=PWR                                     05080000
         EJECT ,                                                        05100000
         IVMCIPHD DSECT=YES                                             05120000
**********************************************************************  05140000
*      IAF ROUTINES                                                     05160000
**********************************************************************  05180000
*      FUNCTIONS:                                                       05200000
*        1) INITIALIZATION OF INVENT PROCESSOR                          05220000
*        2) DATA COLLECTION INITIALIZATION                              05240000
*           (CALLED BY SUPERVISOR HOOKS)                                05260000
*        3) INTERMEDIATE RECORD HANDLER SERVICES AND SUBROUTINES        05280000
*        4) INTERMEDIATE RECORD HANDLER (IMR) SYSTEM TASK               05300000
*        5) IAF SVC 117                                                 05320000
*      ENTRY POINTS: IVMENTRY - GENERAL ENTRY (ADDRESSED BY SYSCOM)     05340000
*                               FOR SUPERVISOR HOOKS                    05360000
*                    MSSARCMD - ENTRY CALLED BY ATTENTION ROUTINE       05380000
*                    IMRGATE  - OCCUPY AND RELEASE A RESOURCE           05400000
*                    GETBUFF  - GET A FREE BUFFER FOR DATA COLLECTION   05420000
*                    ENQBUFF  - ENQUEUE A FULL BUFFER INTO              05440000
*                               THE FULL BUFFER QUEUE                   05460000
*                    IMRHTASK - ENTRY FOR SYSTEM TASK,                  05480000
*                               SOME SYSTEM TASK SUBROUTINES            05500000
*                               ARE CALLED BY SUPERVISOR ROUTINES       05520000
*                    SVC117   - IAF SVC                                 05540000
*      REGISTER USAGE:                                                  05560000
*        R3 - BASE REGISTER FOR 4)                                      05580000
*        RC - BASE REGISTER FOR 5)                                      05600000
*        RD - BASE REGISTER FOR 1), 2) AND 3),                          05620000
*             IVMCIMSS ADDRESS                                          05640000
**********************************************************************  05660000
IJBSUP50 CSECT                  RESUME CSECT                            05680000
         DC    CL8'SGIVM'       MACRO NAME                              05700000
         DC    CL8'11/23/93'    DATE OF LAST CHANGE            @D61NDIS 05720061
         DC    CL8'@DY40063'    LAST APAR FIX                  @DY40063 05740000
         EJECT ,                                                        05760000
**********************************************************************  05780000
* IVMENTRY - COMMON ENTRY POINT FOR SUPERVISOR HOOKS                    05800000
*            INPUT:                                                     05820000
*              R8 - TIB POINTER                                         05840000
*              R9 - RETURN ADDRESS                                      05860000
*              RC - SVC CODE (WHEN ENTERED FROM ENTSVC)                 05880000
*              RD - IVMENTRY ENTRY POINT ADDRESS                        05900000
*              RF - FUNCTION VALUE (OPTIONAL)                           05920000
*            WORK:                                                      05940000
*              R3, R7                                                   05960000
**********************************************************************  05980000
         USING IVMENTRY,RD                                              06000000
*SGLINK IVMENTRY,S,INPUT=(R8,R9,RC,RD,RF),WORK=(R3,R7)                  06020000
IVMENTRY DS    0F           ENTRY POINT FOR IAF'S SYSTEM SERVICES       06040000
IVMCIMSS EQU   *            START OF IAF'S SYSTEM CONTROL BLOCK         06060000
         AIF   (&BGVM).NVM003                                  @D51IDIS 06080000
&NUM     SETA  &NCLASS+&NPART GET TOTAL NUMBER OF ENTRIES      @D51IDIS 06100000
         AGO   .NVM004                                         @D51IDIS 06120000
.NVM003  ANOP                                                  @D51IDIS 06140000
&NUM     SETA  &NPART         GET TOTAL NUMBER OF ENTRIES      @D51IDIS 06160000
.NVM004  ANOP                                                  @D51IDIS 06180000
*------------------------------------------------------------------     06200000
*          - START OF IVMCIMSS INLINE INFORMATION                       06220000
*            IAF'S SYSTEM CONTROL BLOCK (IN FIXED STORAGE LOCATION)     06240000
*------------------------------------------------------------------     06260000
         B     IVMSTART     START OF IAF ROUTINES                       06280000
         SPACE 4                                                        06300000
*******************************************************************     06320000
* MSSARCMD - ENTRY POINT FOR ATTENTION ROUTINE (INVENT COMMAND)         06340000
*            MSSARCMD CALLS THE INVENT SVA PHASE. THE SVA PHASE         06360000
*            RETURNS TO THE ATTENTION ROUTINE.                          06380000
*            INPUT:                                                     06400000
*              R0 - LENGTH OF COMMAND MINUS ONE                         06420000
*              R1 - ADDRESS OF COMMAND                                  06440000
*              R2 - LENGTH OF WHOLE COMMAND                             06460000
*                   (INCLUDING COMMAND PARAMETERS)                      06480000
*              RD - ADDRESS OF IVMCIMSS                                 06500000
*              RE - RETURN ADDRESS                                      06520000
*            OUTPUT:                                                    06540000
*              RF - RETURN CODE                                         06560000
*                   0 - COMMAND ACCEPTED                                06580000
*                   4 - NO IAF COMMAND                                  06600000
*                   8 - COMMAND PROCESSOR ACTIVE                        06620000
*            WORK:                                                      06640000
*              RD                                                       06660000
*******************************************************************     06680000
*SGLINK MSSARCMD,S,INPUT=(R0,R1,R2,RD,RE),WORK=(RD),OUTPUT=(RF)         06700000
MSSARCMD B     IVMSTINV     START OF INVENT COMMAND PROCESSOR           06720000
&CS      SETC  'C'                                                      06740000
&BL      SETC  ''                                                       06760000
         AGO   .INL1                                                    06780000
.MSS1    ANOP                                                           06800000
*******************************************************************     06820000
* IVMCIMSS - DSECT, IAF'S SYSTEM CONTROL BLOCK                          06840000
         AIF ('&DSECT' NE 'AR').NOAR1      NOT CALLED BY AR ?           06860000
*            (ATTENTION ROUTINE LAYOUT)                                 06880000
*******************************************************************     06900000
         AGO   .NOCSECT                                                 06920000
.NOAR1   ANOP                                                           06940000
*            (IN FIXED STORAGE LOCATION)                                06960000
*******************************************************************     06980000
.NOCSECT ANOP                                                           07000000
IVMCIMSS DSECT              DSECT FOR IAF'S SYSTEM CONTROL BLOCK        07020000
         DS    F            ENTRY POINT FOR IAF'S SYSTEM SERVICES       07040000
MSSARCMD DS    F            ENTRY POINT FOR AR INVENT COMMAND           07060000
         AIF ('&DSECT' EQ 'AR').AR1      CALLED BY AR ?                 07080000
&CS      SETC  'S'                                                      07100000
&BL      SETC  ' '                                                      07120000
.INL1    ANOP                                                           07140000
MSSMONST D&CS  X&BL.'40'    FLAG BYTE (MONITOR STATE OF SYSTEM)         07160000
MSSON    EQU   PRMSON         0  MONITORING ACTIVE (ON)                 07180000
MSSOFF   EQU   PRMSOFF        1  MONITORING INACTIVE (OFF)              07200000
MSSDELOF EQU   PRMDELOF       2  MONITORING DELAYED OFF                 07220000
MSSFORCE EQU   PRMFOROF       3  MONITORING FORCED                      07240000
*                            4-7 NOT USED                               07260000
MSSSTATE D&CS  X&BL.'00'    FLAG BYTE (STATE OF SYSTEM)                 07280000
MSSIMROB EQU   X'80'          0  BAM OPEN SUCCESSFUL DONE               07300000
MSSIMROW EQU   X'40'          1  OPENIMR WRITE SUCCESSFUL               07320000
MSSIMROR EQU   X'20'          2  OPENIMR READ SUCCESSFUL                07340000
MSSPWACT EQU   X'10'          3  POWER ACTIVE                           07360000
*                            4-7 NOT USED                               07380000
MSSMONS2 D&CS  X&BL.'00'    FLAG BYTE (MONITOR STATE 2)        @D31FMIS 07400000
MSSCCSON EQU   X'80'          0  CICS MONITORING ACTIVE        @D31FMIS 07420000
MSSPNET  EQU   X'40'          1  RECEIVE VIA PNET ON           @D31FMIS 07440000
MSSPNETC EQU   X'20'          2  COMM. REQUEST ESTABLISHED     @D31FMIS 07460000
MSSPNETD EQU   X'10'          3  DEACTIV. PNET COMMUNICATION   @D31FMIS 07480000
MSSSLAVE EQU   X'08'          4  MONITORING ON SLAVE           @D31FMIS 07500000
*                            5-7 NOT USED                      @D31FMIS 07520000
         D&CS  X&BL.'00'    NOT USED                           @D31FMIS 07540000
MSSSERV  D&CS  X&BL.'00'    FLAG BYTE (SERVICE ROUTINE INDICATOR,       07560000
*                                      EXCLUSIVE USAGE)                 07580000
MSSIGRA  EQU   X'80'          0  IVMIGR UTILITY ACTIVE                  07600000
MSSIDB   EQU   X'40'          1  IDB UPDATE ROUTINES ACTIVE             07620000
*                            2-7 NOT USED                               07640000
         D&CS  3X&BL.'00'   MUST BE ZERO BECAUSE OF CS INSTRUCTION      07660000
MSSIGRAT D&CS  H&BL.'0'     TASK ID OF IVMIGR UTILITY                   07680000
MSSIDBT  EQU   MSSIGRAT     TASK ID OF IDB UPDATE ROUTINES              07700000
         D&CS  H&BL.'0'     NOT USED                                    07720000
MSSPARTN D&CS  H&BL.'0'     NUMBER OF MONITORED PARTITIONS              07740000
MSSIERR  D&CS  X&BL.'00'    FLAG BYTE (SPECIAL RET.CODE BY SERVICE)     07760000
MSSLABEL EQU   X'80'          0  LABEL                                  07780000
MSSGVCE  EQU   X'40'          1  GETVCE                                 07800000
MSSASSG  EQU   X'20'          2  ASSIGN                                 07820000
MSSSGVS  EQU   X'10'          3  SGETVIS                                07840000
MSSXPCC  EQU   X'08'          4  XPCC                          @D31FMIS 07860000
MSSXPWR  EQU   X'04'          5  VSE/POWER SERVICE             @D31FMIS 07880000
MSSXBAM  EQU   X'02'          6  BAM SERVICE                   @D31FMIS 07900000
*                             7  NOT USED                      @D31FMIS 07920000
MSSIEMAC EQU   MSSLABEL+MSSGVCE+MSSASSG+MSSSGVS                         07940000
MSSIRET  D&CS  X&BL.'00'    RET.CODE GIVEN BY ABOVE SERVICE             07960000
MSSIMR   D&CS  A&BL.(0)     POINTER TO IMR COMM. CONTROL BLOCK          07980000
MSSIMRUS D&CS  H&BL.'0'     PERCENTAGE OF USED IMR BLOCKS (0 TO 100)    08000000
MSSCONDE EQU   80           PERCENTAGE VALUE OF FOLLOWING FIELD         08020000
MSSCOND  D&CS  AL2&BL.(MSSCONDE)  PERCENTAGE, WHEN IDB ...              08040000
*                                 ... ROUTINES TO BE POSTED             08060000
MSSNODE  D&CS  CL8&BL.'VSE1'    NODE ID FOR IDB RECORDS                 08080000
MSSNPART D&CS  AL2&BL.(&NPART) NUMBER OF GENERATED PARTITIONS           08100000
MSSDCRET D&CS  H&BL.'0'       RETURN CODE TO ISSUE MSG IVM017           08120000
MSSCTID  D&CS  A&BL.(TID)     ADDRESS OF CURRENT TASK ID                08140000
MSSPLCT  D&CS  A&BL.(IJBPLCT) ADDRESS OF LIBRARIAN LCT POINTER          08160000
IMRGATEA D&CS  A&BL.(IMRGATE) ADDRESS OF IMRGATE ROUTINE                08180000
ENQBUFFA D&CS  A&BL.(ENQBUFF) ADDRESS OF ENQBUFF ROUTINE                08200000
GETBUFFA D&CS  A&BL.(GETBUFF) ADDRESS OF GETBUFF ROUTINE                08220000
MSSPTYPE D&CS  CL8&BL.' '     POWER DEFAULT SLI TYPE                    08240000
MSSIOWRK D&CS  A&BL.(0)       ADDRESS OF IMR IO WORK AREA               08260000
MSSPIERR D&CS  X&BL.'00'    FLAG BYTE (SPECIAL RET.CODE FOR IDB UPD.)   08280000
MSSPLAB  EQU   X'80'          0  LABEL                                  08300000
MSSPGVCE EQU   X'40'          1  GETVCE                                 08320000
MSSPASSG EQU   X'20'          2  ASSIGN                                 08340000
MSSPGVS  EQU   X'10'          3  SGETVIS                                08360000
*                            4-7 NOT USED                               08380000
MSSPIRET D&CS  X&BL.'00'    RET.CODE GIVEN BY ABOVE SERVICE             08400000
MSSWDESC D&CS  H&BL.'10'    WRITE DESCRIPTOR REC. EVERY X PUTS          08420000
         AIF ('&CS' EQ 'C').INL3   CONTINUE WITH INLINE CODE   @D31FMIS 08440000
MSSLENQ  EQU   *-IVMCIMSS   EQUATE FOR IVMCIMSS LENGTH                  08460000
.INL3    ANOP                                                  @D31FMIS 08480000
MSSCISLN D&CS  AL2&BL.(MSPSLENQ) LENGTH OF IVMCISAV            @D31FMIS 08500000
MSSENTRN D&CS  AL2&BL.(&NUM)   NUMBER OF BUFFER ENTRIES        @D31FMIS 08520000
         D&CS  X&BL.'00'    NOT USED                           @D31FMIS 08540000
MSSMONS3 D&CS  X&BL.'00'    FLAG BYTE (MONITOR STATE 2)        @D51IDIS 08560000
MSSONALL EQU   X'80'          0  INVENT ON ALL REQUESTED       @D51IDIS 08580000
*                            1-7 NOT USED                      @D51IDIS 08600000
MSSIRES  D&CS  X&BL.'00'    REASON CODE OF MSSIERR SERVICE     @D31FMIS 08620000
MSSIFCB  D&CS  X&BL.'00'    FEEDBACK CODE FROM XPCC (MSSIERR)  @D31FMIS 08640000
MSSCONF  D&CS  A&BL.(0)     ADDRESS TO CONFIG PHASE            @D31FMIS 08660000
         D&CS  3X&BL.'00'   NOT USED                           @D31FMIS 08680000
MSSFUNCI D&CS  X&BL.'08'    MESSAGE INSERT LENGTH              @D31FMIS 08700000
MSSFUNCT D&CS  CL8&BL.' '   FUNCTION NAME                      @D31FMIS 08720000
MSSUNNOI D&CS  X&BL.'08'    MESSAGE INSERT LENGTH              @D31FMIS 08740000
MSSUNNOD D&CS  CL8&BL.' '   UNKNOWN NODE ID                    @D31FMIS 08760000
         AIF ('&CS' EQ 'C').INL2   CONTINUE WITH INLINE CODE            08780000
MSSLENQ2 EQU   *-IVMCIMSS   EQUATE FOR IVMCIMSS LENGTH         @D31FMIS 08800000
.AR1     ANOP                                                           08820000
         MEXIT              LEAVE MACRO                                 08840000
.INL2    ANOP                                                           08860000
         AGO   .NOGEN0         DO NO LONGER GENERATE THIS PART @D61NDIS 08870061
         SPACE 2                                                        08880000
*******************************************************************     08900000
*          - INTERNAL PART OF IVMCIMSS                                  08920000
*******************************************************************     08940000
         D&CS  CL8'CIMSSINT' START OF INTERNAL PART                     08960000
IMRHAREA D&CS  F&BL.'0'     POINTER TO AREA OF ALLOCATED                08980000
*                           BUFFER DESCRIPTORS, SAVE AREAS AND          09000000
*                           PARTITION CONTROL BLOCKS                    09020000
IMRHBMAX EQU   &NPART*2     MAX. VALUE OF ALLOCATED BUFFERS             09040000
*                           TWO BUFFERS PER PARTITION                   09060000
IMRHSIZ1 EQU   IMRHBMAX*BUFLENQ  TOTAL BUFFER DESCRIPTOR LENGTH         09080000
IMRHSIZ2 EQU   MSPSLENQ*&NPART   TOTAL SAVE AREA LENGTH                 09100000
IMRHSIZ3 EQU   MSPLENQ*&NPART    TOTAL IVMCIMSP LENGTH                  09120000
IMRHSIZE EQU   IMRHSIZ1+IMRHSIZ2+IMRHSIZ3                               09140000
*                                  ... INCLUDING SAVE AREAS             09160000
IMRHLEN  D&CS  AL2&BL.(IMRHSIZE) LENGTH OF ABOVE AREA                   09180000
IMRHFLAG D&CS  X&BL.'00'    FLAG BYTE (INTERNAL IMRH STATE)             09200000
IMRHSYS  EQU   X'80'          0  SYSTEM TASK ACTIVE                     09220000
IMRHAB   EQU   X'40'          1  ABNORMAL TERMINATION OF SYST.TASK      09240000
IMRHEOT  EQU   X'20'          2  SYSTEM TASK IN TERMINATION             09260000
IMRHINVA EQU   X'10'          3  INVENT SVC ACTIVE                      09280000
IMRHSYSP EQU   X'08'          4  SYSTEM TASK ALREADY POSTED             09300000
IMRHPREQ EQU   X'04'          5  SYSTEM TASK TO BE POSTED               09320000
*                            6-7 NOT USED                               09340000
IMRHSFL  EQU   IMRHSYS+IMRHAB+IMRHEOT+IMRHSYSP+IMRHPREQ                 09360000
IMRHFLG1 D&CS  X&BL.'00'    FLAG BYTE (BUFFER PROCESSING STATE)         09380000
IMRHFALL EQU   X'80'          0  FREE ALL IMRH AREAS                    09400000
IMRHWAIT EQU   X'40'          1  NO FREE BUFFERS AVAILABLE,             09420000
*                                SOME TASKS WAITING                     09440000
IMRSEVER EQU   X'20'          2  SEVERE ERROR OCCURRED                  09460000
*                            3-7 NOT USED                               09480000
IMRHIERR D&CS  X&BL.'00'    FLAG BYTE (MESSAGE INDICATOR)               09500000
IMRHSGV  EQU   X'80'          0  SYSTEM GETVIS ERROR                    09520000
IMRHTWT  EQU   X'40'          1  TASKS WAITING MESSAGE                  09540000
IMRHDC   EQU   X'20'          2  DATA COLLECTION ERROR MESSAGE          09560000
*                            3-7 NOT USED                               09580000
IMRHIEFL D&CS  X&BL.'02'    LENGTH OF FOLLOWING FIELD                   09600000
IMRHIELG D&CS  H&BL.'00'    SYSLOG ID OF PARTITION, WHERE DC FAILS      09620000
*        FULL BUFFER CHAIN POINTER                                      09640000
IMRHFST  D&CS  A&BL.(0)     POINTER TO FIRST BUFFER DESCR.              09660000
IMRHLST  D&CS  A&BL.(0)     POINTER TO LAST BUFFER DESCR.               09680000
IMRHFREE D&CS  A&BL.(0)     POINTER TO FREE BUFFER CHAIN                09700000
IMRHFPTR D&CS  A&BL.(0)     POINTER TO AREA OF UNUSED BUFFER            09720000
*                           DESCRIPTOR SPACE                            09740000
IMRHHIGH D&CS  A&BL.(0)     POINTER TO HIGH WATER MARK OF BUFFER        09760000
*                           DESCRIPTOR SPACE (LAST ALLOCATED            09780000
*                           BYTE + 1)                                   09800000
IMRHICT  D&CS  H&BL.'0'     NO. OF GATED TASKS (BY IMRGATE)             09820000
         D&CS  H&BL.'0'     NOT USED                                    09840000
IMRHCOCT D&CS  H&BL.'0'     NO. OF CONCURR. TASKS IN DATA COLLECT.      09860000
IMRHTCT  D&CS  AL2&BL.(IMRHBMAX) NO. OF ALLOCATED BUFFER DESCRIPTORS    09880000
IMRHUCT  D&CS  H&BL.'0'     NO. OF USED BUFFER DESCRIPTORS              09900000
*                           (= ALLOCATED BUFFERS)                       09920000
IMRHFUCT D&CS  H&BL.'0'     NO. OF BUFFERS IN FULL BUFFER CHAIN         09940000
IMRHFRCT D&CS  H&BL.'0'     NO. OF BUFFERS IN FREE BUFFER CHAIN         09960000
IMRHRETS D&CS  H&BL.'00'    RET.CODE SAVED FOR SYSTEM TASK              09980000
IMRHBMON DC    X'00000000'  CURRENT BIT STRING OF MONITORED PART.       10000000
IMRHSAVE D&CS  3F&BL.'0'        REGISTER SAVE AREA                      10020000
IMRHARSV D&CS  (MSPSSLNQ)X&BL.'0' AR REGISTER SAVE AREA                 10040000
IMRHMSPA D&CS  A&BL.(0)     POINTER TO AREA OF IVMCIMSP C.BLOCKS        10060000
IMRHUSAV DC    F&BL.'0'     SAVE AREA OF SVC 117 USER                   10080000
IMRHAABS DC    A&BL.(IMRHABSV) AB EXIT SAVE AREA ADDRESS                10100000
IMRHSINV D&CS  2F&BL.'0'    REGISTER SAVE AREA FOR IVMPIINV    @D31FMIS 10120000
IMRHFLG2 D&CS  X&BL.'00'    FLAG BYTE (RELEASE 2)              @D31FMIS 10140000
IMRHNMSG EQU   X'80'          0  IAF INACTIVE MSG ALREADY WRITT@D31FMIS 10160000
IMRHNRES EQU   X'40'          1  DO NOT RESET MONITORING       @D31FMIS 10180000
IMRHTRHX EQU   X'20'          2  MSG HEX TRANSLATION REQUIRED  @D31FMIS 10200000
IMRH2CHR EQU   X'10'          3  SECOND INSERT=CHAR.STRING PTR.@D31FMIS 10220000
*                            4-7 NOT USED                      @D31FMIS 10240000
         D&CS  3X&BL.'00'   NOT USED                           @D31FMIS 10260000
SPIVM    CRSPID NAME=IPIVM  NAME OF GETVIS SUBPOOL             @D51IDIS 10280000
         AIF   (&BGVM).NVM998                                  @D51IDIS 10300000
ACPCBTAB DC    A(PCBCTAB)   TABLE OF CPCB ADDRESSES            @D51IDIS 10320000
.NVM998  ANOP                                                  @D51IDIS 10340000
         EJECT ,                                                        10360000
**********************************************************************  10380000
* IVMHKTAB - SVC HOOK TABLE                                             10400000
**********************************************************************  10420000
IVMHKTAB DS    0F                                                       10440000
         DC    5X'00'       NOT USED                 SVC  00 - 04       10460000
         DC    AL1(SVMVCM)  ENTRY FOR MVCOM          SVC  05            10480000
         DC    6X'00'       NOT USED                 SVC  06 - 11       10500000
         DC    AL1(SV1213)  ENTRY FOR                SVC  12            10520000
         DC    AL1(SV1213)  ENTRY FOR                SVC  13            10540000
         DC    2X'00'       NOT USED                 SVC  14 - 15       10560000
         DC    AL1(SVSTXT)  ENTRY FOR STXIT PC       SVC  16            10580000
         DC    AL1(SVEXIT)  ENTRY FOR EXIT PC        SVC  17            10600000
         DC    AL1(SVSTXT)  ENTRY FOR STXIT IT       SVC  18            10620000
         DC    AL1(SVEXIT)  ENTRY FOR EXIT IT        SVC  19            10640000
         DC    AL1(SVSTXT)  ENTRY FOR STXIT OC       SVC  20            10660000
         DC    AL1(SVEXIT)  ENTRY FOR EXIT OC        SVC  21            10680000
         DC    11X'00'      NOT USED                 SVC  22 - 32       10700000
         DC    AL1(SVCMRG)  ENTRY FOR COMREG         SVC  33            10720000
         DC    3X'00'       NOT USED                 SVC  34 - 36       10740000
         DC    AL1(SVSTXT)  ENTRY FOR STXIT AB       SVC  37            10760000
         DC    AL1(SVATCH)  ENTRY FOR ATTACH         SVC  38            10780000
         DC    AL1(SVDTCH)  ENTRY FOR DETACH         SVC  39            10800000
         DC    X'00'        NOT USED                 SVC  40            10820000
         DC    AL1(SVDEQ)   ENTRY FOR DEQ            SVC  41            10840000
         DC    AL1(SVENQ)   ENTRY FOR ENQ            SVC  42            10860000
         DC    13X'00'      NOT USED                 SVC  43 - 55       10880000
         DC    AL1(SVCPCL)  ENTRY FOR CPCLOSE        SVC  56            10900000
         DC    3X'00'       NOT USED                 SVC  57 - 59       10920000
         DC    AL1(SVGETD)  ENTRY FOR GETDADR        SVC  60            10940000
         DC    2X'00'       NOT USED                 SVC  61 - 62       10960000
         DC    AL1(SVLOCK)  ENTRY FOR USE            SVC  63            10980000
         DC    AL1(SVLOCK)  ENTRY FOR RELEASE        SVC  64            11000000
         DC    X'00'        NOT USED                 SVC  65            11020000
         DC    AL1(SVRMOD)  ENTRY FOR RUNMODE        SVC  66            11040000
         DC    AL1(SVPFIX)  ENTRY FOR PFIX           SVC  67            11060000
         DC    AL1(SVPFRE)  ENTRY FOR PFREE          SVC  68            11080000
         DC    2X'00'       NOT USED                 SVC  69 - 70       11100000
         DC    AL1(SVSPFA)  ENTRY FOR SETPFA         SVC  71            11120000
         DC    6X'00'       NOT USED                 SVC  72 - 77       11140000
         DC    AL1(SVCHAP)  ENTRY FOR CHAP           SVC  78            11160000
         DC    6X'00'       NOT USED                 SVC  79 - 84       11180000
         DC    AL1(SVRPAG)  ENTRY FOR RELPAG         SVC  85            11200000
         DC    AL1(SVFCPG)  ENTRY FOR FCPGOUT        SVC  86            11220000
         DC    AL1(SVPAGIN) ENTRY FOR PAGEIN         SVC  87            11240000
         DC    AL1(SVTPIN)  ENTRY FOR TPIN           SVC  88            11260000
         DC    AL1(SVTPOT)  ENTRY FOR TPOUT          SVC  89            11280000
         DC    2X'00'       NOT USED                 SVC  90 - 91       11300000
         DC    AL1(SVXECB)  ENTRY FOR XECBTAB        SVC  92            11320000
         DC    AL1(SVXPST)  ENTRY FOR XPOST          SVC  93            11340000
         DC    AL1(SVXWAT)  ENTRY FOR XWAIT          SVC  94            11360000
         DC    AL1(SVEXIT)  ENTRY FOR EXIT AB        SVC  95            11380000
         DC    AL1(SVEXIT)  ENTRY FOR EXIT TT        SVC  96            11400000
         DC    AL1(SVSTXT)  ENTRY FOR STXIT TT       SVC  97            11420000
         DC    AL1(SVEXTR)  ENTRY FOR EXTRACT        SVC  98            11440000
         DC    6X'00'       NOT USED                 SVC  99 - 104      11460000
         DC    AL1(SVSUBS)  ENTRY FOR SUBSID         SVC 105            11480000
         DC    2X'00'       NOT USED                 SVC 106 - 107      11500000
         DC    AL1(SVSECK)  ENTRY FOR SECHECK        SVC 108            11520000
         DC    X'00'        NOT USED                 SVC 109            11540000
         DC    AL1(SVLOCK)  ENTRY FOR LOCK/UNLOCK    SVC 110            11560000
         DC    2X'00'       NOT USED                 SVC 111 - 112      11580000
         DC    AL1(SVXPCC)  ENTRY FOR XPCC           SVC 113            11600000
IVMHKTLN EQU   *-IVMHKTAB   EQUATE FOR LENGTH                           11620000
         DS    0H                                                       11640000
IVMHKTL  DC    AL2(IVMHKTLN) LENGTH OF SVC FUNCTION CODE TABLE          11660000
         SPACE 1                                                        11680000
         DROP  RD                                                       11700000
         EJECT ,                                                        11720000
**********************************************************************  11740000
* IVMSTINV - CALLS THE INVENT SVA PHASE. THE SVA PHASE                  11760000
*            RETURNS TO THE ATTENTION ROUTINE.                          11780000
**********************************************************************  11800000
         USING IVMENTRY,RD                                              11820000
IVMSTINV DS    0F                                                       11840000
         L     RF,ASVASVDL  GET ADDRESS TO SUPERVISOR SUBDIRECTORY      11860000
         USING SVASVDL,RF                                               11880000
         L     RF,AIVMPISV  GET ENTRY POINT OF SVA PHASE                11900000
         DROP  RF                                                       11920000
         LTR   RF,RF        IVMPISVA PHASE AVAILABLE ?                  11940000
         BZ    IVMSTIV1     NO, SET RETURN CODE AND RETURN              11960000
         ST    R5,IMRHSINV  SAVE REGISTER 5                    @D31FMIS 11980000
         ST    RE,IMRHSINV+4 SAVE REGISTER E                   @D31FMIS 12000000
         LA    R5,&NUM      GET NUMBER OF BUFFER ENTRIES       @D51IDIS 12020000
         LA    RE,IVMSTIVR  SET UP RETURN ADDRESS              @D31FMIS 12040000
*---------------------------------------------------------------------  12060000
*                CALL IVMPIINV ROUTINE                                  12080000
*            INPUT:                                                     12100000
*              R0 - LENGTH OF COMMAND MINUS ONE                         12120000
*              R1 - ADDRESS OF COMMAND                                  12140000
*              R2 - LENGTH OF WHOLE COMMAND                             12160000
*                   (INCLUDING COMMAND PARAMETERS)                      12180000
*              R5 - MAX. NUMBER OF BUFFER ENTRIES              @D31FMIS 12200000
*              RE - RETURN ADDRESS                                      12220000
*              RF - IVMPIINV ROUTINE ADDRESS                            12240000
*            OUTPUT:                                                    12260000
*              RF - RETURN CODE                                         12280000
*                   0 - COMMAND ACCEPTED                                12300000
*                   4 - NO IAF COMMAND                                  12320000
*                   8 - COMMAND PROCESSOR ACTIVE                        12340000
*            WORK:                                                      12360000
*              RD                                                       12380000
*---------------------------------------------------------------------  12400000
         USING IVMCIPHD,RF                                              12420000
         L     RF,PHDPIINV  GET ROUTINE ADDRESS                         12440000
         DROP  RF                                                       12460000
         BR    RF           ENTER SVA ROUTINE                           12480000
         EJECT ,                                                        12500000
*---------------------------------------------------------------------  12520000
* IVMSTIVR - RETURN FROM IVMPIINV ROUTINE                               12540000
*---------------------------------------------------------------------  12560000
IVMSTIVR DS    0H                                                       12580000
         L     RD,IJBIVMCB   GET BASE ADDRESS                           12600000
         TM    IMRHFLAG,IMRHPREQ POSTING OF IMR TASK REQUIRED ?         12620000
         BZ    IVMSTI1R      NO, RESTORE REG.S AND RETURN      @D31FMIS 12640000
         NI    IMRHFLAG,XFF-IMRHPREQ RESET IMR TASK POST INDICATION     12660000
         ST    R6,IMRHARSV     SAVE REGISTER 6                 @D31FMIS 12680000
         ST    R8,IMRHARSV+4   SAVE REGISTER 8                 @D31FMIS 12700000
         ST    RF,IMRHARSV+8   SAVE REGISTER F                 @D31FMIS 12720000
         L     R6,DISPAD       GET DISPATCHER ADDRESS          @D31FMIS 12740000
         BAL   R5,IMRHPSYS  POST SYSTEM TASK                   @D31FMIS 12760000
*SGLINK  IMRHPSYS,INPUT=(R5,RD),OUTPUT=(R6),WORK=(R8,RE,RF)    @D31FMIS 12780000
         L     R6,IMRHARSV     RESTORE REGISTER 6              @D31FMIS 12800000
         L     R8,IMRHARSV+4   RESTORE REGISTER 8              @D31FMIS 12820000
         L     RF,IMRHARSV+8   RESTORE REGISTER F              @D31FMIS 12840000
IVMSTI1R DS    0H                                              @D31FMIS 12860000
         L     R5,IMRHSINV   RESTORE REGISTER 5                @D31FMIS 12880000
         L     RE,IMRHSINV+4 RESTORE REGISTER E                @D31FMIS 12900000
         BR    RE           RETURN TO CALLER                   @D31FMIS 12920000
         SPACE 2                                                        12940000
*---------------------------------------------------------------------  12960000
* IVMSTIV1 - SET RETURN CODE AND RETURN                                 12980000
*---------------------------------------------------------------------  13000000
IVMSTIV1 DS    0F                                                       13020000
.NOGEN0  ANOP                                                  @D61NDIS 13023361
**********************************************************************  13026661
* IVMSTINV - RETURNS TO THE ATTENTION ROUTINE.                          13029961
**********************************************************************  13033261
IVMSTINV DS    0F                                                       13036561
         LA    RF,4         SET RETURN CODE (NO IAF COMMAND)            13040000
         BR    RE           RETURN TO CALLER                            13060000
         EJECT ,                                                        13062261
**********************************************************************  13064461
* IVMSTART - ROUTINE WILL BE ENTERED BY IVMENTRY.                       13066661
*            MAIN ROUTINE TO PROCESS HOOKS                              13068861
**********************************************************************  13071061
IVMSTART DS    0F                                                       13073261
         BR    R9           RETURN TO CALLER                            13075461
         AGO   .NOGEN1         DO NO LONGER GENERATE THIS PART @D61NDIS 13077661
         EJECT ,                                                        13080000
**********************************************************************  13100000
* IVMSTART - ROUTINE WILL BE ENTERED BY IVMENTRY.                       13120000
*            MAIN ROUTINE TO PROCESS HOOKS                              13140000
**********************************************************************  13160000
         USING IVMENTRY,RD                                              13170061
IVMSTART DS    0F                                                       13180000
         TM    MSSMONST,MSSFORCE IMRH SYSTEM FORCED ?                   13200000
         BOR   R9           YES, RETURN TO CALLER                       13220000
         USING TIBADR,R8                                                13240000
         TM    TIBFLAG2,ICCFPP ICCF PSEUDO PARTITION ?                  13260000
         BOR   R9           YES, RETURN TO CALLER                       13280000
         CH    RF,IVMEOTH   ENTERED BY END OF APPLICATION ?             13300000
         BE    IVMSTR0      YES, DO NOT CHECK FOR EOT                   13320000
         TM    TIBFLAG1,EOTINPR+TERMACT EOT OR DUMP ROUTINE ACTIVE ?    13340000
         BNZR  R9           YES, RETURN TO CALLER                       13360000
         DROP  R8           RELEASE TIBADR BASE                         13380000
IVMSTR0  DS    0H                                                       13400000
         L     RB,CRADDR    GET COMREG POINTER                          13420000
         USING COMREG,RB                                                13440000
*        POWER PARTITION OR POWER CONTROLLED PARTITION ?                13460000
         TM    POWFLG1,POWUPART+POWPART                                 13480000
         BZ    IVMSTR2      NO, RETURN TO CALLER                        13500000
         DROP  RB           RELEASE COMREG BASE                         13520000
         L     RB,PCBPTR    GET PCB POINTER                             13540000
         USING PCBADR,RB                                                13560000
         CLC   PCBSSFL1(2),IVMNOSUB  SUBSYSTEM PARTITION ?              13580000
         BNE   IVMSTRT0     YES, CHECK FOR SUBSYST. TO BE MONITORED     13600000
         USING TCBADR,RA                                                13620000
         TM    TCBIVMHK,TCBHKSVC ENTERED FROM ENTSVC ?                  13640000
         BZ    IVMSTRT1     NO, CONTINUE                                13660000
         DROP  RB           RELEASE PCBADR BASE                         13680000
         LH    RB,INTINFO+2 GET SVC CODE                                13700000
         DROP  RA                                                       13720000
         CH    RB,IVMHKTL   ABOVE BOUNDARY ?                            13740000
         BH    IVMSTR2      YES, RETURN TO ENTSVC                       13760000
         AL    RB,AIVMHKTB  GET ADDRESS OF HOOK TABLE                   13780000
         SLR   RF,RF        CLEAR REGISTER                              13800000
         ICM   RF,1,0(RB)   GET HOOK TABLE VALUE, ZERO ?                13820000
         BZ    IVMSTR2      YES, RETURN TO ENTSVC                       13840000
*                           RB AND RF HAVE TO BE RESTORED               13860000
         EJECT ,                                                        13880000
*---------------------------------------------------------------------  13900000
* IVMSTRTA - WHEN THE MONITOR CALL HANDLER IS AVAILABLE,                13920000
*            IT WILL BE CALLED.                                         13940000
*            INPUT:                                                     13960000
*              R9 - RETURN ADDRESS                                      13980000
*              RA - TCB POINTER                                         14000000
*              RD - ADDRESS OF IVMCIMSS                                 14020000
*              RF - FUNCTION VALUE OF HOOK                              14040000
*---------------------------------------------------------------------  14060000
IVMSTRTA DS    0H           COMMON ENTRY TO ENTER SVA ROUTINE           14080000
         USING TCBADR,RA                                                14100000
         OI    TCBIVMHK,TCBHKDCA SET TASK IN DATA COLLECTION            14120000
         DROP  RA                                                       14140000
         LA    RE,8         SET RETURN CODE FOR MONITOR CALL            14160000
         L     RA,ASVASVDL  GET ADDRESS TO SUPERVISOR SUBDIRECTORY      14180000
         USING SVASVDL,RA                                               14200000
         L     RA,AIVMPIMD  GET ENTRY POINT OF SVA PHASE                14220000
         DROP  RA                                                       14240000
         LTR   RA,RA        IVMPISVA PHASE AVAILABLE ?                  14260000
         BZ    IVMSTRA1     NO, RELOAD REGISTERS AND RETURN             14280000
*---------------------------------------------------------------------  14300000
*                CALL IVMPIMCH ROUTINE                                  14320000
*                INPUT:                                                 14340000
*                  R1 - ADDRESS OF PARAMETER LIST (OPTIONAL)            14360000
*                  R8 - RETURN REGISTER                                 14380000
*                  RA - ENTRY POINT OF IVMPIMCH                         14400000
*                  RD - ADDRESS OF IVMCIMSS                             14420000
*                  RF - FUNCTION VALUE OF HOOK                          14440000
*                WORK:                                                  14460000
*                  RE TO R8                                             14480000
*---------------------------------------------------------------------  14500000
         USING IVMCIMDC,RA                                              14520000
         L     RA,PHDMCHND  GET MONITOR CALL HANDLER ADDRESS            14540000
         TM    MSSMONST,MSSFORCE IMRH SYSTEM FORCED ?                   14560000
         BO    IVMSTRA1     YES, RELOAD REGISTERS AND RETURN            14580000
         LH    RE,IMRHCOCT  GET TASK COUNTER                            14600000
         LA    RE,1(,RE)    INCREASE BY ONE                             14620000
         STH   RE,IMRHCOCT  SAVE NEW VALUE                              14640000
         BALR  R8,RA        ENTER SVA ROUTINE                           14660000
         DROP  RA                                                       14680000
         LH    RE,IMRHCOCT  GET TASK COUNTER                            14700000
         BCTR  RE,0         DECREASE BY ONE                             14720000
         STH   RE,IMRHCOCT  SAVE NEW VALUE                              14740000
         LTR   RE,RE        ANY TASK IN DATA COLLECTION                 14760000
         BNZ   IVMSTRA0     YES, SET RETURN CODE AND RETURN             14780000
         TM    MSSMONST,MSSFORCE FORCED SYSTEM ?                        14800000
         BZ    IVMSTRA0     NO, SET RETURN CODE AND RETURN              14820000
         OI    IMRHFLG1,IMRHFALL INDICATE FREE ALL AREAS                14840000
         BAL   R5,IMRHPSYS  POST SYSTEM TASK                            14860000
*SGLINK  IMRHPSYS,INPUT=(R5,RD),OUTPUT=(R6),WORK=(R8,RE,RF)             14880000
IVMSTRA0 DS    0H                                                       14900000
         SLR   RE,RE        SET RETURN CODE FOR MONITOR CALL            14920000
         EJECT ,                                                        14940000
*---------------------------------------------------------------------  14960000
* IVMSTRA1 - PROCESS RETURN TO CALLER OR DISPATCHER                     14980000
*---------------------------------------------------------------------  15000000
IVMSTRA1 DS    0H                                                       15020000
         L     R6,DISPAD    GET DISPATCHER BASE                         15040000
         L     R8,TIBPTR    GET CURRENT TIB POINTER                     15060000
         L     RA,TCBPTR    GET TCB POINTER                             15080000
         USING TCBADR,RA                                                15100000
         NI    TCBIVMHK,XFF-TCBHKDCA FREE DATA COLLECTION               15120000
         TM    TCBIVMHK,TCBHKSVC+TCBHKCHK+TCBHKPCK                      15140000
*                                         ENTERED FROM SPECIAL HOOK ?   15160000
         BZR   R9           NO, RETURN TO CALLER                        15180000
         L     RB,TCBSAVE   GET TASK'S SAVE AREA ADDRESS                15200000
         USING SVEARA,RB                                                15220000
         TM    TCBIVMHK,TCBHKPCK ENTERED FROM SGPCK                     15240000
         BO    IVMSTTR1     YES, SAVE RETURN CODE                       15260000
         L     R0,SVER00    RESTORE REGISTERS 0                         15280000
         L     R1,SVER01    RESTORE REGISTERS 1                         15300000
         TM    TCBIVMHK,TCBHKCHK ENTERED FROM CHKPT ?                   15320000
         BOR   R9           YES, RETURN TO CALLER                       15340000
         L     RE,SVER0E    RESTORE REGISTERS E                         15360000
         L     RF,SVER0F    RESTORE REGISTERS F                         15380000
         LM    R2,R5,SVER02 RESTORE REGISTERS 2 TO 5                    15400000
         L     R7,SVER07    RESTORE REGISTERS 7                         15420000
         BR    R9           RETURN TO CALLER                            15440000
         DROP  RA                                                       15460000
         DROP  RB                                                       15480000
         SPACE 4                                                        15500000
*---------------------------------------------------------------------  15520000
* IVMSTR2  - RETURN IMMEDIATELLY TO CALLER                              15540000
*            REGISTER RB AND RF HAVE TO BE RESTORED BEFORE RETURN       15560000
*---------------------------------------------------------------------  15580000
IVMSTR2  DS    0H                                                       15600000
         USING TCBADR,RA                                                15620000
         L     RB,TCBSAVE   GET TASK'S SAVE AREA ADDRESS                15640000
         TM    TCBIVMHK,TCBHKPCK ENTERED FROM SGPCK                     15660000
         BOR   R9           YES, RETURN TO CALLER                       15680000
         USING SVEARA,RB                                                15700000
         L     RF,SVER0F    RESTORE REGISTER F                          15720000
         DROP  RB                                                       15740000
         DROP  RA                                                       15760000
         BR    R9           RETURN TO CALLER                            15780000
         EJECT ,                                                        15800000
*---------------------------------------------------------------------  15820000
* IVMSTRT0 - CHECK FOR SUBSYSTEMS: POWER, ICCF, CICS                    15840000
*            IGNORE MONITORING, WHEN ENTERED FROM ENTSVC HOOK           15860000
*            INPUT:                                                     15880000
*              RA - TCB ADDRESS                                         15900000
*              RB - PCB ADDRESS                                         15920000
*              RD - ADDRESS OF IVMCIMSS AND BASE                        15940000
*              RF - FUNCTION VALUE OF HOOK                              15960000
*            WORK:                                                      15980000
*              R8                                                       16000000
*---------------------------------------------------------------------  16020000
IVMSTRT0 DS    0H                                                       16040000
         USING TCBADR,RA                                                16060000
         TM    TCBIVMHK,TCBHKSVC ENTERED FROM ENTSVC ?                  16080000
         BO    IVMSTR2      YES, RETURN TO CALLER                       16100000
         USING PCBADR,RB                                                16120000
         TM    PCBSSFLG,PWR+CICS+ICCF POWER, ICCF OR CICS ?             16140000
         BZ    IVMSTR2      NO, RETURN TO CALLER                        16160000
         TM    PCBSSFLG,PWR IS IT POWER PARTITION ?                     16180000
         BZ    IVMSTRT1     NO, CONTINUE                                16200000
         TM    MSSSTATE,MSSPWACT IS POWER PART. ALREADY INITIALIZED ?   16220000
         BO    IVMSTRT1     YES, CONTINUE                               16240000
         TM    IJBFLG03,IJBPOWA IS POWER ACTIVE ?                       16260000
         BZ    IVMSTR2      NO, RETURN TO CALLER                        16280000
         L     RB,PCBIVMPT  GET IVMCIMSP ADDRESS                        16300000
         USING IVMCIMSP,RB                                              16320000
         LA    R8,POWLV     GET MONITOR LEVEL FOR POWER PARTITION       16340000
         STH   R8,MSPMONLV  STORE IT INTO IVMCIMSP                      16360000
         MVI   MSPARTFG,POWERFG SET SUBSYSTEM INFO. FLAG                16380000
         OI    MSSSTATE,MSSPWACT INITIALIZATION FOR POWER PART. DONE    16400000
         TM    MSPARTST,MSPON PARTITION ALREADY SPECIFIED IN INVENT     16420000
         BO    IVMSTRT2     YES, CONTINUE                               16440000
         LH    R8,MSSPARTN  INCREASE NUMBER OF ...                      16460000
         LA    R8,1(,R8)             ...                                16480000
         STH   R8,MSSPARTN  ... MONITORED PARTITIONS                    16500000
IVMSTRT2 DS    0H                                                       16520000
         MVI   MSPARTST,MSPIGN+MSPON SET MONITORING ON                  16540000
         DROP  RA                                                       16560000
         DROP  RB                                                       16580000
         EJECT ,                                                        16600000
*---------------------------------------------------------------------  16620000
* IVMSTRT1 - PROCESSES HOOK CALLS FROM SGPCK AND SPECIAL HOOKS          16640000
*            INPUT:                                                     16660000
*              RA - TCB ADDRESS                                         16680000
*              RD - ADDRESS OF IVMCIMSS AND BASE                        16700000
*              RF - FUNCTION VALUE OF HOOK                              16720000
*            WORK:                                                      16740000
*              R8                                                       16760000
*---------------------------------------------------------------------  16780000
IVMSTRT1 DS    0H           WHEN ENTERED FROM SGPCK AND SPECIAL HOOKS   16800000
         USING TCBADR,RA                                                16820000
         TM    TCBIVMHK,TCBHKPCK ENTPCK HOOK ?                          16840000
         BZ    IVMSTRTA     NO, CONTINUE WITH SVA ROUTINE               16860000
         DROP  RA                                                       16880000
         L     R8,IMRHSAVE  RESTORE REGISTER                            16900000
         L     RB,PGMINF    GET PGM CHECK INTERRUPTION CODE             16920000
         LA    RC,PCOLDPS   IDENTIFY OLD PSW                            16940000
         DROP  RD                                                       16960000
         L     RD,AFLIH     GET INTERRUPT HANDLER BASE                  16980000
         USING FLIH,RD                                                  17000000
         BAL   R9,GENENT1   SAVE TASKS PSW AND REGISTERS                17020000
*SGLINK GENENT,INPUT=(R9,RB,RC,RD),OUTPUT=(R6,RA),WORK=(RB)             17040000
         MVI   RID+1,REENTRID IDENTIFY REENTRABLE ROUTINE               17060000
         DROP  RD           RELEASE FLIH BASE                           17080000
         L     RD,IJBIVMCB  GET IAF BASE                                17100000
         USING IVMENTRY,RD                                              17120000
         LTR   RF,RF        INVENTRY FUNC=MONSTATE ?                    17140000
         BNZ   IVMSTRTA     NO, CONTINUE WITH SVA ROUTINE               17160000
         EJECT ,                                                        17180000
*---------------------------------------------------------------------  17200000
* IVMSTTR0 - SET RETURN CODE FOR INVENTRY FUNC=MONSTATE                 17220000
*---------------------------------------------------------------------  17240000
IVMSTTR0 DS    0H                                                       17260000
         LA    RE,8         SET RETURN CODE FOR MONITOR CALL            17280000
         L     RF,ASVASVDL  GET ADDRESS TO SUPERVISOR SUBDIRECTORY      17300000
         USING SVASVDL,RF                                               17320000
         L     RF,AIVMPISV  GET ENTRY POINT OF SVA PHASE                17340000
         DROP  RF                                                       17360000
         LTR   RF,RF        IVMPISVA PHASE AVAILABLE ?                  17380000
         BZ    IVMSTTR2     NO, RELOAD REGISTERS AND RETURN             17400000
         SLR   RE,RE        SET RETURN CODE FOR MONITOR CALL            17420000
IVMSTTR2 DS    0H                                                       17440000
         LA    R9,4         SET RETURN CODE FOR MONITOR CALL            17460000
         L     R8,TIBPTR    GET TIB POINTER                             17480000
         USING TIBADR,R8                                                17500000
         TM    TIBFLAG3,SEIZEBIT SYSTEM SEIZED BY THIS TASK ?           17520000
         BO    IVMSTTR3     YES, CONTINUE                               17540000
         DROP  R8                                                       17560000
         SLR   R9,R9        SET RETURN CODE FOR MONITOR CALL            17580000
IVMSTTR3 DS    0H                                                       17600000
         USING SVEARA,RB                                                17620000
         ST    R9,SVER0F    STORE RETURN CODE                           17640000
*---------------------------------------------------------------------  17660000
* IVMSTTR1 - SET MONITOR CALL RETURN CODE AND RETURN                    17680000
*---------------------------------------------------------------------  17700000
IVMSTTR1 DS    0H                                                       17720000
         USING TCBADR,RA                                                17740000
         ST    RE,SVER00    STORE RETURN CODE                           17760000
         NI    TCBIVMHK,XFF-TCBHKPCK CLEAR HOOK KIND                    17780000
         BR    R6           RETURN TO DISPATCHER                        17800000
         DROP  RA                                                       17820000
         DROP  RB                                                       17840000
         SPACE 4                                                        17860000
AIVMHKTB DC    A(IVMHKTAB)  ADDRESS OF HOOK TABLE                       17880000
IVMEOTH  DC    AL2(SVEOT)   FUNCTION CODE FOR EOT HOOK                  17900000
IVMNOSUB DC    X'0000'      NO SUBSYSTEMS TO BE MONITORED               17920000
         DROP  RD                                                       17940000
         EJECT ,                                                        17960000
**********************************************************************  17980000
*          - IAFS' SUBROUTINES                                          18000000
**********************************************************************  18020000
         SPACE 2                                                        18040000
**********************************************************************  18060000
*          - EXTERNAL SUBROUTINES                                       18080000
**********************************************************************  18100000
* IMRGATE  - OCCUPIES OR FREES A RESOURCE                               18120000
*            DEPENDENT ON THE FUNCTION CODE.                            18140000
*            INPUT:                                                     18160000
*              R0 - FUNCTION CODE                                       18180000
*                       0 - OCCUPY A RESOURCE                           18200000
*                   NOT 0 - RELEASE A RESOURCE                          18220000
*              R5 - IVMCIMSP ADDRESS OF PARTITION TO BE GATED           18240000
*              RC - RETURN ADDRESS                                      18260000
*              RD - ADDRESS OF IMRGATE ROUTINE                          18280000
*            OUTPUT:                                                    18300000
*              RD - ADDRESS OF IVMCIMSS                                 18320000
*              RF - RETURN CODE                                         18340000
*                   R0 = 0   => 0 = RESOURCE OCCUPIED                   18360000
*                               8 = SEVERE ERROR OCCURRED               18380000
*                   R0 NOT 0 => 0 = RESOURCE RELEASED                   18400000
*            WORK:                                                      18420000
*              R5                                                       18440000
**********************************************************************  18460000
         USING IVMENTRY,RD                                              18480000
*SGLINK  IMRGATE,S,INPUT=(R0,R5,RC,RD),WORK=(R5),OUTPUT=(RD,RF)         18500000
IMRGATE  DS    0H           GATING FUNCTION TO OCCUPY OR RELEASE        18520000
*                           A RESOURCE                                  18540000
         L     RD,IJBIVMCB  GET BASE ADDRESS                            18560000
         USING IVMCIMSP,R5                                              18580000
         L     RF,MSPAPCB   GET CORRESPONDING PCB                       18600000
         DROP  R5                                                       18620000
         USING PCBADR,RF                                                18640000
         LA    R5,SRQIVMTS  GET ADDRESS OF RESOURCE DESCRIPTOR          18660000
         DROP  RF                                                       18680000
         LTR   R0,R0        OCCUPY A RESOURCE ?                         18700000
         BNZ   IMRGATXF     NO, RELEASE RESOURCE                        18720000
         EJECT ,                                                        18740000
*---------------------------------------------------------------------  18760000
* IMRGATXU - SET RESOURCE DESCRIPTOR TO NOT FREE (IF IT IS FREE)        18780000
*            INPUT:                                                     18800000
*              R5 = ADDRESS OF RESOURCE DESCRIPTOR                      18820000
*              RD = IAF'S SYSTEM CONTROL BLOCK                          18840000
*---------------------------------------------------------------------  18860000
IMRGATXU DS    0H                                                       18880000
         TM    MSSMONST,MSSFORCE IMRH SYSTEM FORCED ?                   18900000
         BO    IMRGATE3     YES, SET RET.CODE AND RETURN                18920000
         LR    R0,R2        SAVE REGISTER 2                             18940000
         LR    RF,RE        SAVE REGISTER E                             18960000
         BAL   R2,IMRGATEU  OCCUPY RESOURCE                             18980000
*SGLINK  IMRGATEU,INPUT=(R2,R5,RD),WORK=(RE)                            19000000
         B     IMRGATE2     SYSTEM FORCED                               19020000
         LR    RE,RF        RESTORE REGISTER E                          19040000
         LR    R2,R0        RESTORE REGISTER 2                          19060000
         LH    RF,IMRHICT   GET TASK COUNTER                            19080000
         LA    RF,1(,RF)    INCREASE BY ONE                             19100000
         STH   RF,IMRHICT   SAVE NEW VALUE                              19120000
*---------------------------------------------------------------------  19140000
*          - SET RETURN CODE AND RETURN  (RETURN CODE = 0)              19160000
*---------------------------------------------------------------------  19180000
         SLR   RF,RF        SET RETURN CODE 0                           19200000
         LR    R0,RF        SET INITIAL VALUE                           19220000
         BR    RC           RETURN TO CALLER                            19240000
         SPACE 2                                                        19260000
*---------------------------------------------------------------------  19280000
* IMRGATE3 - SET RETURN CODE AND RETURN (FORCED SYSTEM)                 19300000
*---------------------------------------------------------------------  19320000
IMRGATE2 DS    0H           SYSTEM FORCED, SET RET.CODE AND RETURN      19340000
         LR    RE,RF        RESTORE REGISTER E                          19360000
         LR    R2,R0        RESTORE REGISTER 2                          19380000
IMRGATE3 DS    0H           SYSTEM FORCED, SET RET.CODE AND RETURN      19400000
         LA    RF,8         SET RETURN CODE                             19420000
         BR    RC           RETURN TO CALLER                            19440000
         EJECT ,                                                        19460000
*---------------------------------------------------------------------  19480000
* IMRGATXF - RELEASE A RESOURCE                                         19500000
*            INPUT:                                                     19520000
*              R5 = RESOURCE TO BE FREED                                19540000
*              RD = IAF'S SYSTEM CONTROL BLOCK                          19560000
*              RF = PCB POINTER OF PARTITION TO BE FREED                19580000
*---------------------------------------------------------------------  19600000
IMRGATXF DS    0H                                                       19620000
         ST    R6,IMRHSAVE    SAVE REGISTER 6                           19640000
         ST    R8,IMRHSAVE+4  SAVE REGISTER 8                           19660000
         ST    RE,IMRHSAVE+8  SAVE REGISTER E                           19680000
         L     R6,DISPAD    GET DISPATCHER BASE ADDRESS                 19700000
         LR    R8,R2        SAVE REGISTER                               19720000
         BAL   R2,IMRGATEF  FREE RESOURCE                               19740000
*SGLINK  IMRGATEF,INPUT=(R2,R5,R6,RD),WORK=(R5,RE,RF)                   19760000
         LR    R2,R8        RESTORE REGISTER                            19780000
         LH    RF,IMRHICT   GET TASK COUNTER                            19800000
         BCTR  RF,0         DECREASE BY ONE                             19820000
         STH   RF,IMRHICT   SAVE NEW VALUE                              19840000
*---------------------------------------------------------------------  19860000
*          - SET RETURN CODE AND RETURN  (RETURN CODE = 0)              19880000
*---------------------------------------------------------------------  19900000
         L     R6,IMRHSAVE    RESTORE REGISTER 6                        19920000
         L     R8,IMRHSAVE+4  RESTORE REGISTER 8                        19940000
         L     RE,IMRHSAVE+8  RESTORE REGISTER E                        19960000
         SLR   RF,RF        SET RETURN CODE 0                           19980000
         BR    RC           RETURN TO CALLER                            20000000
         DROP  RD           RELEASE IVMENTRY BASE                       20020000
         EJECT ,                                                        20040000
**********************************************************************  20060000
* ENQBUFF  - EQUEUES A FULL BUFFER INTO THE FULL BUFFER QUEUE OR        20080000
*            PROPAGATES TERMINATION OF IMRH PROCESSING.                 20100000
*            CALLED BY: DATA COLLECTION ROUTINES                        20120000
*            INPUT:                                                     20140000
*              R0 - FUNCTION CODE                                       20160000
*                   = POSITIVE - (NORMAL) ADDRESS OF IVMCIMSP OF        20180000
*                                PARTITION TO BE SERVICED,              20200000
*                                ENQUEUE A FULL BUFFER INTO THE         20220000
*                                FULL BUFFER QUEUE AND POST THE         20240000
*                                IMRH SYSTEM TASK, IF NECESSARY         20260000
*                   = 0        - (FREE) FREE ALL AREAS ALLOCATED FOR    20280000
*                                DATA COLLECTION AFTER ALL BUFFERS      20300000
*                                ARE WRITTEN TO THE E.G. IMR FILE       20320000
*                   = NEGATIVE - (FORCE) FORCE THE IMRH SYSTEM, THAT    20340000
*                                IS INTERRUPT BUFFER PROCESSING,        20360000
*                                FREE ALL AREAS ALLOCATED               20380000
*                                FOR DATA COLLECTION                    20400000
*              RC - RETURN ADDRESS                                      20420000
*              RD - ADDRESS OF ENQBUFF ROUTINE                          20440000
*            OUTPUT:                                                    20460000
*              RD - ADDRESS OF IVMCIMSS                                 20480000
*            WORK: RF                                                   20500000
**********************************************************************  20520000
         USING IVMENTRY,RD                                              20540000
*SGLINK  ENQBUFF,S,INPUT=(R0,RC,RD),WORK=(RF),OUTPUT=(RD)               20560000
ENQBUFF  DS    0H                                                       20580000
         L     RD,IJBIVMCB  GET BASE ADDRESS                            20600000
         LA    RF,IMRHARSV  GET SPECIAL SAVE AREA ADDRESS (AR TASK)     20620000
         CLC   ARTIDH(2),TID REQUEST FROM AR ?                          20640000
         BE    ENQBUFAR     YES, PROCESS REQUEST WITH SPECIAL SAVE AREA 20660000
         LTR   RF,R0        FUNCTION = NORMAL REQUESTED ?               20680000
         BP    ENQBUFFX     YES, GET SAVE AREA ADDRESS OF DELIVERED MSP 20700000
         L     RF,PCBPTR    GET PCB POINTER                             20720000
         USING PCBADR,RF                                                20740000
         L     RF,PCBIVMPT  GET POINTER TO IVMCIMSP                     20760000
ENQBUFFX DS    0H                                                       20780000
         USING IVMCIMSP,RF                                              20800000
         L     RF,MSPASAVE  GET SPECIAL SAVE AREA                       20820000
         DROP  RF                                                       20840000
ENQBUFAR DS    0H                                                       20860000
         USING IVMCISAV,RF                                              20880000
         ST    R2,MSPSSV02  SAVE REGISTER 2                             20900000
         ST    R4,MSPSSV04  SAVE REGISTER 4                             20920000
         ST    R5,MSPSSV05  SAVE REGISTER 5                             20940000
         ST    R6,MSPSSV06  SAVE REGISTER 6                             20960000
         ST    R8,MSPSSV08  SAVE REGISTER 8                             20980000
         ST    RE,MSPSSV0E  SAVE REGISTER E                             21000000
         LR    R4,RF        MOVE SAVE AREA ADDRESS                      21020000
         DROP  RF                                                       21040000
         LTR   R0,R0        FUNCTION = FORCE REQUESTED ?                21060000
         BM    ENQBUFFO     YES, PROCESS IT                             21080000
         TM    MSSMONST,MSSFORCE IMRH SYSTEM FORCED ?                   21100000
         BO    ENQBUFF3     YES, IGNORE REQUEST                         21120000
         LTR   R0,R0        FUNCTION = FREE REQUESTED ?                 21140000
         BZ    ENQBUFFR     YES, PROCESS IT                             21160000
         LA    R2,ARTID     GET AR TID                                  21180000
         CH    R2,TID       REQUEST FROM AR ?                           21200000
         BE    ENQBUFF3     YES, IGNORE REQUEST                         21220000
         EJECT ,                                                        21240000
**********************************************************************  21260000
*          - FUNCTION = NORMAL                                          21280000
**********************************************************************  21300000
         LA    R5,SRQIMRH   GET RESOURCE DESCRIPTOR POINTER             21320000
         BAL   R2,IMRGATEU  OCCUPY RESOURCE                             21340000
*SGLINK  IMRGATEU,INPUT=(R2,R5,RD),WORK=(RE)                            21360000
*                           IMRH SYSTEM FORCED,                         21380000
         B     ENQBUFF3     RESTORE REGISTERS AND RETURN TO CALLER      21400000
         LR    R2,R0        GET IVMCIMSP ADDRESS                        21420000
         USING IVMCIMSP,R2                                              21440000
         L     R8,MSPBUFDS  GET POINTER TO BUFFER DESCRIPTOR            21460000
         SLR   RE,RE        CLEAR REGISTER                              21480000
         ST    RE,MSPBUFDS  CLEAR BUFFER DESCRIPTOR POINTER             21500000
         DROP  R2           RELEASE IVMCIMSP                            21520000
         L     RE,IMRHLST   GET POINTER TO LAST ELEMENT                 21540000
         LTR   RE,RE        CHAIN EMPTY ?                               21560000
         BZ    ENQBUFF1     YES, ENQUEUE BUFFER                         21580000
         ST    R8,IMRHLST   SET NEW LAST ELEMENT                        21600000
         USING BUFDESCR,RE  OLD LAST ELEMENT                            21620000
         ST    R8,BUFCHAIN  UPDATE BUFFER DESCR. CHAIN POINTER          21640000
         DROP  RE           RELEASE BUFFER DESCRIPTOR BASE              21660000
*        BUFCHAIN POINTER OF NEW LAST ELEMENT IS ZERO                   21680000
         LH    R2,IMRHFUCT  GET FULL BUFFER COUNT                       21700000
         LA    R2,1(,R2)    INCREASE BY ONE                             21720000
ENQBUFF2 DS    0H                                                       21740000
         STH   R2,IMRHFUCT  SAVE NEW VALUE                              21760000
ENQBUFFC DS    0H                                                       21780000
         LA    R5,SRQIMRH   GET RESOURCE DESCRIPTOR POINTER             21800000
         L     R6,DISPAD    GET DISPATCHER BASE                         21820000
         BAL   R2,IMRGATEF  FREE RESOURCE                               21840000
*SGLINK  IMRGATEF,INPUT=(R2,R5,R6,RD),WORK=(R5,RE,RF)                   21860000
         EJECT ,                                                        21880000
*---------------------------------------------------------------------  21900000
*          - RESTORE REGISTERS AND RETURN                               21920000
*---------------------------------------------------------------------  21940000
ENQBUFF3 DS    0H                                                       21960000
         USING IVMCISAV,R4                                              21980000
         L     R2,MSPSSV02    RESTORE REGISTER 2                        22000000
         L     R5,MSPSSV05    RESTORE REGISTER 5                        22020000
         L     R6,MSPSSV06    RESTORE REGISTER 6                        22040000
         L     R8,MSPSSV08    RESTORE REGISTER 8                        22060000
         L     RE,MSPSSV0E    RESTORE REGISTER E                        22080000
         L     R4,MSPSSV04    RESTORE REGISTER 4                        22100000
         DROP  R4                                                       22120000
         BR    RC           RETURN TO CALLER                            22140000
         SPACE 2                                                        22160000
*---------------------------------------------------------------------  22180000
*          - ENQUEUE FIRST BUFFER DESCRIPTOR                            22200000
*---------------------------------------------------------------------  22220000
ENQBUFF1 DS    0H           ENQUEUE FIRST ELEMENT                       22240000
         ST    R8,IMRHFST   UPDATE POINTER TO FIRST ELEMENT             22260000
         ST    R8,IMRHLST   UPDATE POINTER TO LAST ELEMENT              22280000
*        BUFCHAIN POINTER OF NEW LAST ELEMENT IS ZERO                   22300000
         LA    R2,1         SET BUFFER COUNT TO ONE                     22320000
         LA    R5,ENQBUFF2  RELEASE RESOURCE AFTER POST OF SYSTEM TASK  22340000
         B     IMRHPSYS     POST SYSTEM TASK                            22360000
*SGLINK  IMRHPSYS,INPUT=(R5,RD),OUTPUT=(R6),WORK=(R8,RE,RF)             22380000
         EJECT ,                                                        22400000
**********************************************************************  22420000
* ENQBUFFR - FUNCTION = FREE                                            22440000
**********************************************************************  22460000
ENQBUFFR DS    0H                                                       22480000
         OI    IMRHFLG1,IMRHFALL INDICATE AREAS ARE TO BE FREED         22500000
         LA    R5,ENQBUFF3  RESTORE REGISTERS AFTER POST OF SYST.TASK   22520000
         B     IMRHPSYS     POST SYSTEM TASK                            22540000
*SGLINK  IMRHPSYS,INPUT=(R5,RD),OUTPUT=(R6),WORK=(R8,RE,RF)             22560000
         SPACE 4                                                        22580000
**********************************************************************  22600000
* ENQBUFFO - FUNCTION = FORCE                                           22620000
**********************************************************************  22640000
ENQBUFFO DS    0F                                                       22660000
         L     R6,DISPAD    GET DISPATCHER BASE                         22680000
         LA    R5,IMRFORCE  INDICATE SYSTEM FORCED                      22700000
         BAL   R2,IMRHERR   CALL ERROR ROUTINE                          22720000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     22740000
         ICM   RF,3,IMRHCOCT TASKS IN DATA COLLECTION ?                 22760000
         BNZ   ENQBUFF3     YES, DO NOT POST SYSTEM TASK                22780000
         OI    IMRHFLG1,IMRHFALL INDICATE ALL AREAS TO BE FREED         22800000
         LA    R5,ENQBUFF3  RESTORE REGISTERS AFTER POST OF SYST.TASK   22820000
         B     IMRHPSYS     POST SYSTEM TASK                            22840000
*SGLINK  IMRHPSYS,INPUT=(R5,RD),OUTPUT=(R6),WORK=(R8,RE,RF)             22860000
         DROP  RD           RELEASE IVMENTRY BASE                       22880000
         EJECT ,                                                        22900000
**********************************************************************  22920000
* GETBUFF  - CHECKS, IF A BUFFER IS AVAILABLE FOR THE SPECIFIED PART.   22940000
*          - ALLOCATES TWO BUFFERS, IF NECESSARY                        22960000
*          - POSTS TASKS WAITING FOR A FREE BUFFER,                     22980000
*            WHEN NEW ONES ARE ALLOCATED                                23000000
*          - RETURNS THE POINTER OF ONE BUFFER DESCRIPTOR AFTERWARDS    23020000
*            CALLED BY: DATA COLLECTION ROUTINES                        23040000
*                                                                       23060000
*            INPUT:                                                     23080000
*              R9 - IVMCIMSP OF PARTITION TO BE SERVICED                23100000
*              RC - RETURN ADDRESS                                      23120000
*              RD - ADDRESS OF GETBUFF ROUTINE                          23140000
*            OUTPUT:                                                    23160000
*              R1 - POINTER TO BUFFER DESCRIPTOR                        23180000
*              RD - ADDRESS OF IVMCIMSS                                 23200000
*              RF - RETURN CODE                                         23220000
*                   = 0 - GETBUFF COMPLETED SUCCESSFUL                  23240000
*                   = 8 - SEVERE ERROR OCCURRED, MONITORING             23260000
*                         NO LONGER POSSIBLE                            23280000
*            WORK:                                                      23300000
*              R3, R9                                                   23320000
**********************************************************************  23340000
         USING IVMENTRY,RD                                              23360000
*SGLINK  GETBUFF,S,INPUT=(R9,RC,RD),WORK=(R3,R9),OUTPUT=(R1,RD,RF)      23380000
GETBUFF  DS    0H                                                       23400000
         L     RD,IJBIVMCB  GET BASE ADDRESS                            23420000
         TM    MSSMONST,MSSFORCE IMRH SYSTEM FORCED ?                   23440000
         BO    GETBUFFE     SET RETURN CODE AND RETURN                  23460000
         SLR   RF,RF        SET RETURN CODE 0                           23480000
         USING IVMCIMSP,R9                                              23500000
         ICM   R1,15,MSPBUFDS GET BUFDESCR ADDRESS                      23520000
         BNZR  RC           YES, RETURN TO CALLER                       23540000
         L     R3,MSPASAVE  GET SPECIAL SAVE AREA                       23560000
         USING IVMCISAV,R3                                              23580000
         ST    R0,MSPSSV00  SAVE REGISTER 0                             23600000
         ST    R2,MSPSSV02  SAVE REGISTER 2                             23620000
         ST    R5,MSPSSV05  SAVE REGISTER 5                             23640000
         ST    R6,MSPSSV06  SAVE REGISTER 6                             23660000
         ST    R8,MSPSSV08  SAVE REGISTER 8                             23680000
         ST    RE,MSPSSV0E  SAVE REGISTER E                             23700000
         DROP  R3                                                       23720000
         DROP  R9                                                       23740000
*---------------------------------------------------------------------  23760000
*          - TRY TO ALLOCATE A BUFFER FOR THE REQUESTING PARTITION      23780000
*---------------------------------------------------------------------  23800000
*          - ENTRY POINT WHEN TASK IS POSTED AFTER                      23820000
*            WAITING FOR A FREE BUFFER                                  23840000
*---------------------------------------------------------------------  23860000
GETBUFAG DS    0H                                                       23880000
         LA    R5,SRQIMRHF  GET RESOURCE DESCRIPTOR POINTER             23900000
         BAL   R2,IMRGATEU  OCCUPY RESOURCE                             23920000
*SGLINK  IMRGATEU,INPUT=(R2,R5,RD),WORK=(RE)                            23940000
*                           IMRH SYSTEM FORCED,                         23960000
         B     GETBUFFC     SET RETURN CODE AND RETURN                  23980000
         L     R1,IMRHFREE  GET FIRST BUFFER IN FREE QUEUE              24000000
         LTR   R1,R1        BUFFER AVAILABLE ?                          24020000
         BZ    GETBUFAL     NO, TRY TO ALLOCATE ONE                     24040000
         USING BUFDESCR,R1                                              24060000
         L     R2,BUFCHAIN  REMOVE BUFFER ...                           24080000
         ST    R2,IMRHFREE            ... FROM QUEUE                    24100000
         L     R2,BUFPTR    GET BUFFER ADDRESS                          24120000
         USING IVMCIIMR,R2                                              24140000
         SLR   R6,R6        CLEAR REGISTER                              24160000
         STH   R6,IHDOFREE  INDICATE BUFFER IS FREE                     24180000
         DROP  R2                                                       24200000
         DROP  R1                                                       24220000
         LH    R2,IMRHFRCT  DECREASE ...                                24240000
         BCTR  R2,0              ... FREE                               24260000
         STH   R2,IMRHFRCT            ... BUFFER COUNT                  24280000
         L     R6,DISPAD    GET DISPATCHER BASE                         24300000
*---------------------------------------------------------------------  24320000
*          - UPDATE BUFFER DESCR., SET RETURN CODE AND RETURN           24340000
*---------------------------------------------------------------------  24360000
         USING IVMCIMSP,R9                                              24380000
GETBUFRT DS    0H                                                       24400000
         L     R2,MSPAPCB   GET CORRESPONDING PCB                       24420000
         USING PCBADR,R2                                                24440000
         LH    R2,PCBPIK    GET PARTITIONS'S PIK                        24460000
         DROP  R2                                                       24480000
         USING BUFDESCR,R1                                              24500000
         STH   R2,BUFPIK    SET NEW OWNER                               24520000
         SLR   R2,R2        CLEAR REGISTER                              24540000
         ST    R2,BUFCHAIN  RESET CHAIN FIELD                           24560000
         ST    R1,MSPBUFDS  MAKE BUFFER ADDRESSABLE BY PCB              24580000
         DROP  R1                                                       24600000
         DROP  R9                                                       24620000
         SLR   R0,R0        SET RETURN CODE 0                           24640000
         SPACE 4                                                        24660000
*---------------------------------------------------------------------  24680000
*          - FREE FREE BUFFER QUEUE RESOURCE,                           24700000
*            RESTORE REGISTERS AND RETURN                               24720000
*---------------------------------------------------------------------  24740000
GETBURET DS    0H                                                       24760000
         LA    R5,SRQIMRHF  GET RESOURCE DESCRIPTOR POINTER             24780000
         BAL   R2,IMRGATEF  FREE RESOURCE                               24800000
*SGLINK  IMRGATEF,INPUT=(R2,R5,R6,RD),WORK=(R5,RE,RF)                   24820000
GETBURE1 DS    0H                                                       24840000
         LR    RF,R0        SET RETURN CODE                             24860000
         USING IVMCISAV,R3                                              24880000
         L     R0,MSPSSV00    RESTORE REGISTER 0                        24900000
         L     R2,MSPSSV02    RESTORE REGISTER 2                        24920000
         L     R5,MSPSSV05    RESTORE REGISTER 5                        24940000
         L     R6,MSPSSV06    RESTORE REGISTER 6                        24960000
         L     R8,MSPSSV08    RESTORE REGISTER 8                        24980000
         L     RE,MSPSSV0E    RESTORE REGISTER E                        25000000
         DROP  R3                                                       25020000
         BR    RC           RETURN TO CALLER                            25040000
         EJECT ,                                                        25060000
*---------------------------------------------------------------------  25080000
*          - TRY TO ALLOCATE A NEW BUFFER                               25100000
*---------------------------------------------------------------------  25120000
GETBUFAL DS    0F                                                       25140000
         BAL   R2,GETBUFFL  GET TWO NEW BUFFER DESCRIPTOR ELEMENTS      25160000
*SGLINK  GETBUFFL,INPUT=(R2,RD),OUTPUT=(R5,R6,RF),WORK=(R0)             25180000
         LTR   RF,RF        ERROR OCCURRED ?                            25200000
         BM    GETBUFEW     YES, WAIT FOR A FREE BUFFER                 25220000
         LR    R2,RA        SAVE REGISTER A                             25240000
         L     RA,TCBPTR    GET TCB ADDRESS                             25260000
         L     R0,PAGESIZE  GET 2*BUFFER SIZE (= PAGE SIZE)             25280000
*        SGETVIS SPID=SPIVM,PFIX=YES,ADDRESS=(1),LENGTH=(0)             25300000
         SGETVIS SPID=SPIVM,PFIX=YES,ADDRESS=(1),LENGTH=(0)             25320000
         LR    RA,R2        RESTORE REGISTER A                          25340000
         LTR   RF,RF        ERROR OCCURRED ?                            25360000
         BNZ   GETBUFSG     YES, PROCESS ERROR CODE                     25380000
         LH    R2,IMRHUCT   INCREASE ...                                25400000
         LA    R2,2(,R2)         ... ALLOCATED ...                      25420000
         STH   R2,IMRHUCT                  ... BUFFER COUNT             25440000
         USING BUFDESCR,R5                                              25460000
         ST    R1,BUFPTR    SET ADDRESS OF FIRST BUFFER                 25480000
         DROP  R5                                                       25500000
         USING BUFDESCR,R6                                              25520000
         SRL   R0,1         DIVIDE ALLOCATED PAGE BY 2                  25540000
         AR    R0,R1                                                    25560000
         ST    R0,BUFPTR    SET ADDRESS OF SECOND BUFFER                25580000
         ST    R6,IMRHFREE  ENQUEUE 2ND BUFFER ...                      25600000
         DROP  R6                                                       25620000
         LA    R0,1         SET FREE ...                                25640000
         STH   R0,IMRHFRCT       ... BUFFER COUNT                       25660000
         LR    R1,R5        SET BUFDESR ADDRESS INTO OUTPUT REGISTER    25680000
         L     R6,DISPAD    GET DISPATCHER BASE                         25700000
*---------------------------------------------------------------------  25720000
*          - WAITING TASKS ARE ONLY POSSIBLE,                           25740000
*            WHEN THE MAX. NUMBER OF BUFFER DESCRIPTORS                 25760000
*            IS CHANGED AFTER IPL                                       25780000
*---------------------------------------------------------------------  25800000
         LA    RF,GETBUFRT  RETURN TO BUFFER DESCRIPTOR UPDATE          25820000
         B     IMRHPWTS     POST ANY TASKS WAITING FOR A FREE BUFFER    25840000
*SGLINK  IMRHPWTS,INPUT=(R6,RD,RF),WORK=(R5,RE)                         25860000
         EJECT ,                                                        25880000
*---------------------------------------------------------------------  25900000
*          - WAIT FOR A FREE BUFFER                                     25920000
*---------------------------------------------------------------------  25940000
GETBUFEW DS    0H                                                       25960000
         L     R6,DISPAD    GET DISPATCHER BASE                         25980000
         LA    R5,IMRNOBUF  INDICATE NO MORE BUFFERS AVAILABLE          26000000
         BAL   R2,IMRHERR   CALL ERROR ROUTINE                          26020000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     26040000
         LA    R5,SRQIMRHF  GET RESOURCE DESCRIPTOR POINTER             26060000
         BAL   R2,IMRGATEF  FREE RESOURCE                               26080000
*SGLINK  IMRGATEF,INPUT=(R2,R5,R6,RD),WORK=(R5,RE,RF)                   26100000
         OI    IMRHFLG1,IMRHWAIT INDICATE TASK IS WAITING               26120000
*                                FOR A FREE BUFFER                      26140000
         LA    R5,SRQFRBUF  GET RESOURCE DESCRIPTOR POINTER             26160000
         LR    R8,RC        SAVE REGISTER                               26180000
         BAL   RC,RWAIT     WAIT FOR A FREE BUFFER                      26200000
*SGLINK  RWAIT,INPUT=(R5,RC)                                            26220000
         LR    RC,R8        RESTORE REGISTER                            26240000
         TM    MSSMONST,MSSFORCE SYSTEM IN FORCED STATE ?               26260000
         BZ    GETBUFAG     NO, TRY BUFFER ALLOCATION AGAIN             26280000
GETBUFFC DS    0H                                                       26300000
         LA    R0,8         SET RETURN CODE 8                           26320000
         B     GETBURE1     RESTORE REGISTERS AND RETURN                26340000
         SPACE 4                                                        26360000
*---------------------------------------------------------------------  26380000
*          - BUFFER ALLOCATION FAILED (SYSTEM GETVIS ERROR)             26400000
*---------------------------------------------------------------------  26420000
GETBUFSG DS    0H                                                       26440000
         L     R6,DISPAD    GET DISPATCHER BASE                         26460000
         ST    R5,IMRHFPTR  FREE BUFFER DESCRIPTORS                     26480000
         LA    R5,IMRSVIS   INDICATE SYSTEM GETVIS REQUESTED            26500000
GETBUFS1 DS    0H                                                       26520000
         BAL   R2,IMRHERR   CALL ERROR ROUTINE                          26540000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     26560000
         LA    R0,8         SET RETURN CODE 8                           26580000
         B     GETBURET     RESTORE REGISTERS AND RETURN                26600000
         SPACE 4                                                        26620000
*---------------------------------------------------------------------  26640000
*          - SET RETURN CODE (SYSTEM IN FORCED STATE)                   26660000
*---------------------------------------------------------------------  26680000
GETBUFFE DS    0H                                                       26700000
         LA    RF,8         SET RETURN CODE                             26720000
         BR    RC           RETURN TO CALLER                            26740000
         DROP RD            RELEASE IVMENTRY BASE                       26760000
         EJECT ,                                                        26780000
**********************************************************************  26800000
*          - INTERNAL SUBROUTINES                                       26820000
**********************************************************************  26840000
         USING IVMENTRY,RD                                              26860000
**********************************************************************  26880000
* GETBUFFL - ALLOCATES TWO BUFFER DESCRIPTORS AND RETURNS               26900000
*            THEIR POINTERS                                             26920000
*            INPUT:                                                     26940000
*              R2 - RETURN ADDRESS                                      26960000
*              RD - IVMENTRY BASE ADDRESS                               26980000
*            OUTPUT:                                                    27000000
*              R5 - FIRST BUFFER DESCRIPTOR ADDRESS                     27020000
*              R6 - SECOND BUFFER DESCRIPTOR ADDRESS                    27040000
*              RF - RETURN CODE                                         27060000
*                   0 - REQUEST COMPLETED SUCCESSFULLY                  27080000
*                   NEGATIVE - BUFDESCR SPACE EXHAUSTED                 27100000
*            WORK:                                                      27120000
*              R0                                                       27140000
**********************************************************************  27160000
*SGLINK  GETBUFFL,S,INPUT=(R2,RD),OUTPUT=(R5,R6,RF),WORK=(R0)           27180000
GETBUFFL DS    0F                                                       27200000
         L     R5,IMRHFPTR  GET POINTER TO UNUSED BUFDESCR SPACE        27220000
         LA    R0,2*BUFLENQ(,R5) GET NEW START OF FREE SPACE            27240000
         C     R0,IMRHHIGH  BUFDESCR SPACE EXHAUSTED ?                  27260000
         BH    GETBUFLR     YES, SET RETURN CODE AND RETURN             27280000
         LA    RF,BUFLENQ   GET BUFFER DESCRIPTOR LENGTH                27300000
         USING BUFDESCR,R5                                              27320000
         STH   RF,BUFDESLN  SET LENGTH OF DESCRIPTOR                    27340000
         DROP  R5                                                       27360000
         LA    R6,BUFLENQ(,R5) GET SECOND BUFDESCR ADDRESS              27380000
         USING BUFDESCR,R6                                              27400000
         STH   RF,BUFDESLN  SET LENGTH OF DESCRIPTOR                    27420000
         DROP  R6                                                       27440000
         ST    R0,IMRHFPTR  SET POINTER TO NEW FREE AREA                27460000
         SLR   RF,RF        SET RETURN CODE 0                           27480000
         BR    R2           RETURN TO CALLER                            27500000
         SPACE 4                                                        27520000
*---------------------------------------------------------------------  27540000
*          - SET RETURN CODE (BUFDESCR SPACE EXHAUSTED)                 27560000
*---------------------------------------------------------------------  27580000
GETBUFLR DS    0F                                                       27600000
         SLR   RF,RF        SET NEGATIVE ...                            27620000
         BCTR  RF,0                  ... RETURN CODE                    27640000
         BR    R2           RETURN TO CALLER                            27660000
         EJECT ,                                                        27680000
**********************************************************************  27700000
* IMRGATEU - OCCUPY RESOURCE                                            27720000
*            INPUT:                                                     27740000
*              R2 - RETURN ADDRESS                                      27760000
*              R5 - RESOURCE DESCRIPTOR ADDRESS                         27780000
*              RD - IVMENTRY BASE ADDRESS                               27800000
*            RETURN:                                                    27820000
*               0 + RETURN ADDRESS = SYSTEM FORCED                      27840000
*                                    (SERVICE ROUTINES ONLY)            27860000
*                                    RESOURCE NOT OCCUPIED              27880000
*               4 + RETURN ADDRESS = NORMAL PROCESSING                  27900000
*            WORK:                                                      27920000
*              RE                                                       27940000
**********************************************************************  27960000
         USING RQADR,R5                                                 27980000
*SGLINK  IMRGATEU,S,INPUT=(R2,R5,RD),WORK=(RE)                          28000000
IMRGATEU DS    0F           GATING FUNCTION FOR UPDATE                  28020000
         LR    RE,RC        SAVE REGISTER                               28040000
IMRGATU2 DS    0H                                                       28060000
         CLI   RBYTE,FREE   RESOURCE OCCUPIED BY OTHER TASK ?           28080000
         BE    IMRGATU1     NO, OCCUPY RESOURCE                         28100000
         BAL   RC,RWAIT     WAIT TO BE POSTED                           28120000
*SGLINK  RWAIT,INPUT=(R5,RC)                                            28140000
*---------------------------------------------------------------------  28160000
*          - CHECK FOR SERVICE ROUTINES (IMRGATE, ENQBUFF, GETBUFF)     28180000
*            SERVICE ROUTINES MUST RESIDE BEFORE IMRGATEU               28200000
*---------------------------------------------------------------------  28220000
         LA    RC,IMRGATEU  GET SUBROUTINE ADDRESS                      28240000
         LA    R2,0(,R2)    CLEAR HIGH ORDER BYTE FOR COMPARE           28260000
         CR    R2,RC        CALLED BY SERVICE ROUTINES ?                28280000
         BH    IMRGATU2     NO, TRY TO OCCUPY RESOURCE                  28300000
         TM    MSSMONST,MSSFORCE IMRH SYSTEM FORCED ?                   28320000
         BZ    IMRGATU2     NO, TRY TO OCCUPY RESOURCE                  28340000
         LR    RC,RE        RESTORE REGISTER                            28360000
         BR    R2           RETURN TO CALLER                            28380000
         SPACE 2                                                        28400000
*---------------------------------------------------------------------  28420000
* IMRGATU1 - OCCUPY RESOURCE                                            28440000
*---------------------------------------------------------------------  28460000
IMRGATU1 DS    0H                                                       28480000
         LR    RC,RE         RESTORE REGISTER                           28500000
         MVI   RBYTE,NOTFREE OCCUPY RESOURCE                            28520000
         LH    RE,TID        GET TASK ID                                28540000
         STC   RE,RQOWNER    SET RESOURCE OWNER                         28560000
         B     4(,R2)        RETURN TO CALLER                           28580000
         DROP  R5                                                       28600000
         EJECT ,                                                        28620000
**********************************************************************  28640000
* IMRGATEF - FREE OCCUPIED RESOURCE                                     28660000
*            INPUT:                                                     28680000
*              R2 - RETURN ADDRESS                                      28700000
*              R5 - RESOURCE DESCRIPTOR ADDRESS                         28720000
*              R6 - DISPATCHER ADDRESS                                  28740000
*              RD - IVMENTRY BASE ADDRESS                               28760000
*            WORK:                                                      28780000
*              R5,RE,RF                                                 28800000
**********************************************************************  28820000
         USING RQADR,R5                                                 28840000
         USING DISP,R6                                                  28860000
*SGLINK  IMRGATEF,S,INPUT=(R2,R5,R6,RD),WORK=(R5,RE,RF)                 28880000
IMRGATEF DS    0H          GATING FUNCTION TO FREE A RESOURCE           28900000
         CLC   TID+1(1),RQOWNER FREED BY RESOURCE OWNER ?               28920000
         BNER  R2          NO, RETURN                                   28940000
         MVI   RQOWNER,ZERO CLEAR RESOURCE OWNER FIELD                  28960000
         LR    RF,R2       SET RETURN FROM RPOST                        28980000
         B     RPOST       POST ANY WAITERS                             29000000
*SGLINK  RPOST,INPUT=(R5,R6,RF),WORK=(R5,RE)                            29020000
         DROP  R5                                                       29040000
         DROP  R6                                                       29060000
         EJECT ,                                                        29080000
**********************************************************************  29100000
* IMRHPWTS - POST TASKS WAITING FOR A FREE BUFFER                       29120000
*            INPUT:                                                     29140000
*              R6 - DISPATCHER ADDRESS                                  29160000
*              RD - IVMENTRY BASE ADDRESS                               29180000
*              RF - RETURN ADDRESS                                      29200000
*            WORK:                                                      29220000
*              R5,RE                                                    29240000
**********************************************************************  29260000
*SGLINK  IMRHPWTS,S,INPUT=(R6,RD,RF),WORK=(R5,RE)                       29280000
IMRHPWTS DS    0H                                                       29300000
         TM    IMRHFLG1,IMRHWAIT SOME TASKS WAITING ?                   29320000
         BZR   RF          NO, RETURN TO CALLER                         29340000
         NI    IMRHFLG1,XFF-IMRHWAIT RESET INDICATOR                    29360000
         LA    R5,SRQFRBUF GET ADDRESS TO RESOURCE DESCRIPTOR           29380000
         USING DISP,R6                                                  29400000
         B     RPOST       POST ANY WAITERS                             29420000
*SGLINK  RPOST,INPUT=(R5,R6,RF),WORK=(R5,RE)                            29440000
         DROP  R6                                                       29460000
         EJECT ,                                                        29480000
**********************************************************************  29500000
* IMRHRTIO - RESTORES THE ORIGINAL SAVE AREA ADDRESS INTO THE TCB,      29520000
*            IS CALLED BY SGAP MACRO AND SVC 117 IMR I/O PROCESSING.    29540000
*            THIS ROUTINE MUST NOT BE INTERRUPTED.                      29560000
*            INPUT:                                                     29580000
*              R2 - RETURN ADDRESS                                      29600000
*              R6 - DISPATCHER ADDRESS                                  29620000
*              RA - TCB ADDRESS                                         29640000
*              RD - IVMENTRY BASE ADDRESS                               29660000
*            WORK:                                                      29680000
*              R5,RE,RF                                                 29700000
**********************************************************************  29720000
*SGLINK  IMRHRTIO,S,INPUT=(R2,R6,RA,RD),WORK=(R5,RE,RF)                 29740000
IMRHRTIO DS    0H                                                       29760000
         ST    RB,IMRHSDCX  SAVE REGISTER B                             29780000
         USING TCBADR,RA                                                29800000
         L     RB,IMRHUSAV  GET USER'S SAVE AREA                        29820000
         ST    RB,TCBSAVE   RESTORE SAVE AREA ADDRESS                   29840000
         NI    TCBIVMHK,XFF-TCBHKIOA INDICATE IMR PROCESSING IS FREE    29860000
         DROP  RA                                                       29880000
         L     RB,IMRHSDCX  RESTORE REGISTER B                          29900000
         LA    R5,SRQIMR    RESOURCE DESCRIPTOR FOR IMR FILE REQUESTS   29920000
         B     IMRGATEF     FREE RESOURCE                               29940000
*SGLINK  IMRGATEF,INPUT=(R2,R5,R6,RD),WORK=(R5,RE,RF)                   29960000
         EJECT ,                                                        29980000
**********************************************************************  30000000
* IMRHRTDC - INITIATES A MESSAGE AND FORCES THE IAF SYSTEM,             30020000
*            IS CALLED, WHEN DATA COLLECTION ROUTINES ARE CANCELLED.    30040000
*            THIS ROUTINE MUST NOT BE INTERRUPTED.                      30060000
*            INPUT:                                                     30080000
*              R2 - RETURN ADDRESS                                      30100000
*              R6 - DISPATCHER ADDRESS                                  30120000
*              RA - TCB ADDRESS                                         30140000
*              RD - IVMENTRY BASE ADDRESS                               30160000
*            WORK:                                                      30180000
*              R5,RE,RF                                                 30200000
**********************************************************************  30220000
*SGLINK  IMRHRTDC,S,INPUT=(R2,R6,RA,RD),WORK=(R5,RE,RF)                 30240000
IMRHRTDC DS    0H                                                       30260000
         USING TCBADR,RA                                                30280000
         NI    TCBIVMHK,XFF-TCBHKDCA FREE DATA COLLECTION               30300000
         DROP  RA                                                       30320000
         ST    R0,IMRHSDC0  SAVE REGISTER 0                             30340000
         ST    RC,IMRHSDCX  SAVE REGISTER C                             30360000
         LH    RE,IMRHCOCT  GET TASK COUNTER                            30380000
         BCTR  RE,0         DECREASE BY ONE                             30400000
         STH   RE,IMRHCOCT  SAVE NEW VALUE                              30420000
         LA    R0,4         SET RETURN CODE FOR ERROR MESSAGE           30440000
         STH   R0,MSSDCRET  STORE RETURN CODE                           30460000
         SLR   R0,R0        SET NEGATIVE ...                            30480000
         BCTR  R0,0               ... FUNCTION CODE                     30500000
         BAL   RC,ENQBUFF   FORCE IAF SYSTEM                            30520000
*SGLINK  ENQBUFF,INPUT=(R0,RC,RD),WORK=(RF),OUTPUT=(RD)                 30540000
         L     R5,PCBPTR    GET CURRENT PCB POINTER                     30560000
         USING PCBADR,R5                                                30580000
         L     R5,PCBIVMPT  GET CORRESPONDING IVMCIMSP                  30600000
         USING IVMCIMSP,R5                                              30620000
         LA    RC,POWLV     GET POWER INDICATOR                         30640000
         CH    RC,MSPMONLV  POWER PARTITION ?                           30660000
         BE    IMRHRTD0     YES, SCAN PARTITIONS                        30680000
         BAL   RC,IMRGATE FREE PARTITION RESOURCE                       30700000
*SGLINK  IMRGATE,INPUT=(R0,R5,RC,RD),WORK=(R5),OUTPUT=(RD,RF)           30720000
IMRHRTDR DS    0H                                                       30740000
         L     R0,IMRHSDC0  RESTORE REGISTER 0                          30760000
         L     RC,IMRHSDCX  RESTORE REGISTER C                          30780000
         BR    R2           RETURN TO CANCEL PROCESSING                 30800000
         EJECT ,                                                        30820000
*---------------------------------------------------------------------  30840000
* IMRHRTD0 - POST ALL TASKS WAITING FOR DATA COLLECTION,                30860000
*            WHERE POWER OWNS THE RESOURCE                              30880000
*---------------------------------------------------------------------  30900000
IMRHRTD0 DS    0H                                                       30920000
         USING PCBADR,R5                                                30940000
         USING DISP,R6                                                  30960000
         USING RQADR,RC                                                 30980000
         L     RE,APCBATAB  GET ADDRESS OF PCB ADDRESS TABLE   @D51IDIS 31000000
IMRHRTDL DS    0H           START LOOP OVER PCBS                        31020000
         LA    RE,4(,RE)    POINT TO NEXT PCB POINTER          @D51IDIS 31040000
         L     R5,0(,RE)    LOAD PCB POINTER                   @D51IDIS 31060000
         LTR   R5,R5        PCB ADDRESS AVAILABLE ?            @D51IDIS 31080000
         BZ    IMRHRTDL     NO, PROCESS NEXT ENTRY             @D51IDIS 31100000
         BM    IMRHRTDR     ---> END OF TABLE                  @D51IDIS 31120000
         LA    RC,SRQIVMTS  GET RESOURCE DESCRIPTOR ADDRESS             31140000
         CLC   TID+1(1),RQOWNER OCCUPIED BY POWER ?                     31160000
         BNE   IMRHRTDL     NO, CONTINUE LOOP                           31180000
         L     R5,PCBIVMPT  GET CORRESPONDING IVMCIMSP                  31200000
         BAL   RC,IMRGATE   FREE PARTITION RESOURCE                     31220000
*SGLINK  IMRGATE,INPUT=(R0,R5,RC,RD),WORK=(R5),OUTPUT=(RD,RF)           31240000
         B     IMRHRTDL     CONTINUE LOOP                               31260000
         DROP  R5                                                       31280000
         DROP  R6                                                       31300000
         DROP  RC                                                       31320000
         SPACE 2                                                        31340000
*---------------------------------------------------------------------  31360000
*          - REGISTER SAVE AREA                                         31380000
*---------------------------------------------------------------------  31400000
IMRHSDC0 DC    F'0'         SAVE AREA FOR REGISTER 0                    31420000
IMRHSDCX DC    F'0'         SAVE AREA FOR REGISTER B OR C               31440000
         EJECT ,                                                        31460000
**********************************************************************  31480000
* IMRHPSYS - POST SYSTEM TASK, IF NOT YET ACTIVE                        31500000
*            INPUT:                                                     31520000
*              R5 - RETURN ADDRESS                                      31540000
*              RD - IVMENTRY BASE ADDRESS                               31560000
*            OUTPUT:                                                    31580000
*              R6 - DISPATCHER ADDRESS                                  31600000
*            WORK:                                                      31620000
*              R8,RE,RF                                                 31640000
**********************************************************************  31660000
*SGLINK  IMRHPSYS,S,INPUT=(R5,RD),OUTPUT=(R6),WORK=(R8,RE,RF)           31680000
IMRHPSYS DS    0H                                                       31700000
         L     R6,DISPAD    GET DISPATCHER BASE                         31720000
         TM    IMRHFLAG,IMRHSYS+IMRHSYSP SYSTEM TASK ACTIVE OR POSTED ? 31740000
         BNZR  R5          YES, RETURN TO CALLER                        31760000
         L     R8,AIMRTIB  GET IMRH SYSTEM TASK TIB                     31780000
         USING DISP,R6                                                  31800000
         BAL   RF,POST     ACTIVATE IMRH SYSTEM TASK                    31820000
*SGLINK  POST,INPUT=(R6,R8,RF),WORK=(RE)                                31840000
         DROP  R6                                                       31860000
         OI    IMRHFLAG,IMRHSYSP INDICATE SYSTEM TASK POSTED            31880000
         BR    R5          RETURN TO CALLER                             31900000
         EJECT ,                                                        31920000
**********************************************************************  31940000
* IMRHFRGV - RELEASE THE SPACE ALLOCATED FOR BUFFER DESCRIPTORS,        31960000
*            BUFFERS, SAVE AREAS AND PARTITION RELATED CONTROL BLOCKS   31980000
*            CALLED BY: SYSTEM TASK AND SVC 117 IN CASE OF ERROR        32000000
*            INPUT:                                                     32020000
*              R2 - RETURN REGISTER                                     32040000
*              R6 - DISPATCHER BASE REGISTER                            32060000
*              RD - BASE REGISTER                                       32080000
*            WORK:                                                      32100000
*              R1, R9, RA                                               32120000
**********************************************************************  32140000
*SGLINK IMRHFRGV,S,INPUT=(R2,R6,RD),WORK=(R1,R9,RA)                     32160000
IMRHFRGV DS    0F                                                       32180000
*---------------------------------------------------------------------  32200000
*          - CLEAR POINTER TO IVMCIMSP IN ALL PCBS                      32220000
*---------------------------------------------------------------------  32240000
         USING DISP,R6                                                  32260000
         SLR   R9,R9        CLEAR REGISTER                              32280000
         L     R1,APCBATAB  GET ADDRESS OF PCBATAB             @D51IDIS 32300000
IMRHFREL DS    0H           START LOOP OVER PCBS                        32320000
         LA    R1,4(,R1)    POINT TO NEXT PCB                  @D51IDIS 32340000
         L     RA,0(,R1)    LOAD PCB POINTER                   @D51IDIS 32360000
         LTR   RA,RA        PCB ADDRESS AVAILABLE ?            @D51IDIS 32380000
         BZ    IMRHFREL     NO, PROCESS NEXT ENTRY             @D51IDIS 32400000
         BM    IMRHFRG1     ---> END OF TABLE                  @D51IDIS 32420000
         USING PCBADR,RA                                                32440000
         ST    R9,PCBIVMPT  CLEAR POINTER TO IVMCIMSP                   32460000
         DROP  RA                                                       32480000
         B     IMRHFREL     CONTINUE LOOP                               32500000
         DROP  R6                                                       32520000
         EJECT ,                                                        32540000
IMRHFRG1 DS    0H                                                       32560000
         AIF   (&BGVM).NVM999                                  @D51IDIS 32580000
*---------------------------------------------------------------------  32600000
*          - CLEAR MONITORING INDICATIONS IN CPCBS                      32620000
*---------------------------------------------------------------------  32640000
*              INITIALIZE LOOP                                          32660000
         ICM   R5,15,IJBCLTAB CLASS TABLE AVAILABLE ?          @D51IDIS 32680000
         BZ    IMRHFRG2       NO, RETURN TO MAIN PATH          @D51IDIS 32700000
         L     R9,ACPCBTAB  GET ADDRESS OF CPCB TABLE          @D51IDIS 32720000
         LR    R7,R9        GET END INDICATOR FOR LOOP         @D51IDIS 32740000
IMRHFRG0 DS    0H                                              @D51IDIS 32760000
         L     R5,0(,R9)    GET FIRST CPCB ADDRESS             @D51IDIS 32780000
         USING CPCBADR,R5                                      @D51IDIS 32800000
         NI    CPCBFLG1,XFF-CPCBIAFA RESET INDICATION          @D51IDIS 32820000
         LA    R9,4(,R9)    POINT TO NEXT CPCB ADDRESS         @D51IDIS 32840000
         C     R7,0(,R9)    ALL CPCB ENTRIES PROCESSED         @D51IDIS 32860000
         BNE   IMRHFRG0     NO, PROCESS NEXT ENTRY             @D51IDIS 32880000
         DROP  R5                                              @D51IDIS 32900000
         EJECT ,                                                        32920000
IMRHFRG2 DS    0H                                                       32940000
.NVM999  ANOP                                                  @D51IDIS 32960000
*---------------------------------------------------------------------  32980000
*          - FREE STORAGE AREA AND CLEAR RELATED IVMCIMSS FIELDS        33000000
*---------------------------------------------------------------------  33020000
         LR    R9,RF        SAVE REGISTER                               33040000
         L     RA,TCBPTR    GET TCB ADDRESS                             33060000
*        SFREEVIS SPID=SPIVM                                            33080000
         SFREEVIS SPID=SPIVM                                            33100000
.* CHECK FOR RETURN CODE NOT NECESSARY                                  33120000
         LR    RF,R9        RESTORE REGISTER                            33140000
         NI    MSSSTATE,XFF-MSSPWACT POWER INITIALIZATION RESET         33160000
         SLR   R9,R9        CLEAR REGISTER                              33180000
         ST    R9,IMRHAREA  CLEAR ADDRESS OF ALLOCATED BUFDESCR.S       33200000
*                           AND SAVE AREAS                              33220000
         ST    R9,IMRHFPTR  CLEAR POINTER TO UNUSED BUFDESCR SPACE      33240000
         ST    R9,IMRHHIGH  CLEAR HIGH WATER MARK                       33260000
         ST    R9,IMRHMSPA  CLEAR POINTER TO IVMCIMSP AREA              33280000
         ST    R9,IMRHFST   INDICATE FULL BUFFER QUEUE EMPTY            33300000
         ST    R9,IMRHLST   INDICATE FULL BUFFER QUEUE EMPTY            33320000
         ST    R9,IMRHFREE  INDICATE FREE BUFFER EMPTY                  33340000
         ST    R9,IMRHBMON  CLEAR BIT STRING                            33360000
         STH   R9,IMRHUCT   CLEAR USED COUNT                            33380000
         STH   R9,IMRHFUCT  CLEAR FULL BUFFER COUNT                     33400000
         STH   R9,IMRHFRCT  CLEAR FREE BUFFER COUNT                     33420000
         STH   R9,IMRHCOCT  CLEAR NO. OF CONCURR.TASKS IN DATA COLL.    33440000
         STH   R9,IMRHICT   CLEAR NO. OF GATED TASKS                    33460000
         STH   R9,IMRHRETS  CLEAR RETURN CODE                           33480000
         STH   R9,MSSPARTN  CLEAR NUMBER OF MONITORED PARTITIONS        33500000
         STH   R9,MSSDCRET  CLEAR RETURN CODE                           33520000
         BR    R2           RETURN TO CALLER                            33540000
         EJECT ,                                                        33560000
**********************************************************************  33580000
* IMRHERR  - COMMON ERROR (MESSAGE) ROUTINE                             33600000
* IMRHERRA - COMMON ERROR (MESSAGE) ROUTINE FOR AB EXIT ROUTINES        33620000
*            INPUT:                                                     33640000
*              R0 - CANCEL CODE (AB EXIT ROUTINE ONLY)                  33660000
*              R2 - RETURN ADDRESS                                      33680000
*              R5 - FUNCTION CODE                                       33700000
*              R6 - DISPATCHER ADDRESS                                  33720000
*              RD - IVMENTRY BASE ADDRESS                               33740000
*              RF - FUNCTION RETURN CODE                                33760000
*            OUTPUT:                                                    33780000
*              RF - RETURN CODE                                         33800000
*                   0 = SYSTEM TASK CONTINUES NORMALLY                  33820000
*                   8 = SEVERE ERROR - IAF FORCED                       33840000
*            WORK:                                                      33860000
*              R5, R8, RE                                               33880000
**********************************************************************  33900000
*SGLINK  IMRHERR,S,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)   33920000
IMRHERR  DS    0F          COMMON ERROR ROUTINE                         33940000
         SPACE 2                                                        33960000
*SGLINK  IMRHERRA,S,INPUT=(R0,R2,R5,R6,RD,RF),WORK=(R5,R8,RE),         X33980000
               OUTPUT=(RF)                                              34000000
IMRHERRA EQU   *           COMMON ERROR ROUTINE FOR ABNORMAL TERM.      34020000
         L     R5,IMRHERTB(R5) LOAD ADDRESS OF ERROR ROUTINE            34040000
         BR    R5                                                       34060000
         SPACE 2                                                        34080000
*---------------------------------------------------------------------  34100000
*          - ERROR ROUTINE TABLE                                        34120000
*---------------------------------------------------------------------  34140000
IMRHERTB DS    0F                                                       34160000
IMRSTAB  EQU   0            ABNORMAL TERMINATION OF SYSTEM TASK         34180000
         DC    A(IMRHEAB)                                               34200000
IMRSTAB2 EQU   4            2. ABNORMAL TERMINATION OF SYSTEM TASK      34220000
         DC    A(IMRHEAB2)                                              34240000
IMREOT   EQU   8            DEACTIVATION COMPLETE                       34260000
         DC    A(IMRHEEOT)                                              34280000
IMROPEN  EQU   12           IMR FILE OPEN ERROR                         34300000
         DC    A(IMRHEOPE)                                              34320000
IMRPUT   EQU   16           IMR FILE PUT ERROR                          34340000
         DC    A(IMRHEPUT)                                              34360000
IMRCLOSE EQU   20           IMR FILE CLOSE ERROR                        34380000
         DC    A(IMRHECLO)                                              34400000
IMRPIDB  EQU   24           COMMAND PRELEASE ISSUED                     34420000
         DC    A(IMRHEPID)                                              34440000
IMRPIDBN EQU   28           NOT POSSIBLE TO ENTER PRELEASE COMMAND      34460000
         DC    A(IMRHEPIN)                                              34480000
IMRSVIS  EQU   32           SYSTEM GETVIS ERROR                         34500000
         DC    A(IMRHESVI)                                              34520000
IMRNOBUF EQU   36           NO MORE BUFFERS AVAILABLE                   34540000
         DC    A(IMRHEOBU)                                              34560000
IMRFORCE EQU   40           IMRH SYSTEM FORCED                          34580000
         DC    A(IMRHEFO)                                               34600000
IMROPLST EQU   44           RETRIEVAL FROM LIST  QUEUE OPEN ERR@D31FMIS 34620000
         DC    A(IMRHEOPU)                                     @D31FMIS 34640000
IMRGELST EQU   48           RETRIEVAL FROM LIST  QUEUE GET ERR @D31FMIS 34660000
         DC    A(IMRHEGPU)                                     @D31FMIS 34680000
IMRCLLST EQU   52           RETRIEVAL FROM LIST  QUEUE CLOSE ER@D31FMIS 34700000
         DC    A(IMRHECPU)                                              34720000
IMREMON  EQU   56           MONITORING TERMINATED              @D31FMIS 34740000
         DC    A(IMRHEMON)                                              34760000
IMRELST  EQU   60           RETRIEVAL FROM LIST  QUEUE DEACT.  @D31FMIS 34780000
         DC    A(IMRHELST)                                              34800000
         EJECT ,                                                        34820000
*---------------------------------------------------------------------  34840000
* IMRHEAB  - ABNORMAL TERMINATION OF SYSTEM TASK                        34860000
*---------------------------------------------------------------------  34880000
IMRHEAB  DS    0F                                                       34900000
         LR    RF,R0       MOVE CANCEL CODE                             34920000
         LA    R5,IMRMSG25 GET ADDRESS OF MESSAGE NUMBER                34940000
         OI    IMRHFLG2,IMRHTRHX HEX TRANSLATION REQUIRED      @D31FMIS 34960000
         B     IMRHE1CO    CONTINUE WITH COMMON ERROR ROUTINE           34980000
         SPACE 2                                                        35000000
*---------------------------------------------------------------------  35020000
* IMRHEAB2 - 2. ABNORMAL TERMINATION OF SYSTEM TASK                     35040000
*---------------------------------------------------------------------  35060000
IMRHEAB2 DS    0H                                                       35080000
         LR    RF,R0       MOVE CANCEL CODE                             35100000
         LA    R5,IMRMSG26 GET ADDRESS OF MESSAGE NUMBER                35120000
         OI    IMRHFLG2,IMRHTRHX HEX TRANSLATION REQUIRED      @D31FMIS 35140000
         B     IMRHE1CO    CONTINUE WITH COMMON ERROR ROUTINE           35160000
         SPACE 2                                                        35180000
*---------------------------------------------------------------------  35200000
* IMRHEMON - MONITORING DEACTIVATED                                     35220000
*---------------------------------------------------------------------  35240000
IMRHEMON DS    0H                                              @D31FMIS 35260000
         LA    R5,IMRMSG02 GET ADDRESS OF MESSAGE NUMBER       @D31FMIS 35280000
         B     IMRHE0CO    CONTINUE WITH COMMON ERROR ROUTINE  @D31FMIS 35300000
         SPACE 2                                                        35320000
*---------------------------------------------------------------------  35340000
* IMRHELST - LIST  QUEUE RETRIEVAL DEACTIVATED                          35360000
*---------------------------------------------------------------------  35380000
IMRHELST DS    0H                                              @D31FMIS 35400000
         LA    R5,IMRMSG33 GET ADDRESS OF MESSAGE NUMBER       @D31FMIS 35420000
         B     IMRHE0CO    CONTINUE WITH COMMON ERROR ROUTINE  @D31FMIS 35440000
         SPACE 2                                                        35460000
*---------------------------------------------------------------------  35480000
* IMRHEEOT - DEACTIVATION COMPLETE                                      35500000
*---------------------------------------------------------------------  35520000
IMRHEEOT DS    0H                                                       35540000
         LA    R5,IMRMSG27 GET ADDRESS OF MESSAGE NUMBER                35560000
         B     IMRHE0CO    CONTINUE WITH COMMON ERROR ROUTINE           35580000
         EJECT ,                                                        35600000
*---------------------------------------------------------------------  35620000
* IMRHEOPE - IMR FILE OPEN ERROR                                        35640000
*---------------------------------------------------------------------  35660000
IMRHEOPE DS    0H                                                       35680000
         LA    RE,IMREOPEN GET ADDRESS OF 1. INSERT                     35700000
         B     IMRHEFCO    CONTINUE WITH COMMON ERROR ROUTINE           35720000
         SPACE 4                                                        35740000
*---------------------------------------------------------------------  35760000
* IMRHEPUT - IMR FILE PUT ERROR                                         35780000
*---------------------------------------------------------------------  35800000
IMRHEPUT DS    0H                                                       35820000
         LA    RE,IMREPUT  GET ADDRESS OF 1. INSERT                     35840000
         B     IMRHEFCO    CONTINUE WITH COMMON ERROR ROUTINE           35860000
         SPACE 4                                                        35880000
*---------------------------------------------------------------------  35900000
* IMRHECLO - IMR FILE CLOSE ERROR                                       35920000
*---------------------------------------------------------------------  35940000
IMRHECLO DS    0H                                                       35960000
         LA    RE,IMRECLOS GET ADDRESS OF 1. INSERT                     35980000
         B     IMRHEFCO    CONTINUE WITH COMMON ERROR ROUTINE           36000000
         EJECT ,                                                        36020000
*---------------------------------------------------------------------  36040000
* IMRHEOBU - NO MORE BUFFERS AVAILABLE                                  36060000
*---------------------------------------------------------------------  36080000
IMRHEOBU DS    0H                                                       36100000
         LA    R5,IMRTID   GET TASK ID OF SYSTEM TASK                   36120000
         CH    R5,TID      REQUEST FROM SYSTEM TASK ?                   36140000
         BE    IMRHEOB1    YES, WRITE MESSAGE                           36160000
         OI    IMRHIERR,IMRHTWT SET FLAG FOR SYSTEM TASK                36180000
         BAL   R5,IMRHPSYS     POST SYSTEM TASK                         36200000
*SGLINK  IMRHPSYS,INPUT=(R5,RD),OUTPUT=(R6),WORK=(R8,RE,RF)             36220000
         SLR   RF,RF       SET RETURN CODE 0                            36240000
         BR    R2          RETURN TO CALLER                             36260000
         SPACE 2                                                        36280000
IMRHEOB1 DS    0H                                                       36300000
         NI    IMRHIERR,XFF-IMRHTWT RESET FLAG                          36320000
         LA    R5,IMRMSG24 GET ADDRESS OF MESSAGE NUMBER                36340000
         B     IMRHE0CO    CONTINUE WITH COMMON ERROR ROUTINE           36360000
         SPACE 4                                                        36380000
*---------------------------------------------------------------------  36400000
* IMRHEPID - PRELEASE COMMAND ISSUED                                    36420000
*---------------------------------------------------------------------  36440000
IMRHEPID DS    0H                                                       36460000
         LA    R5,IMRMSG23 GET ADDRESS OF MESSAGE NUMBER                36480000
         LH    RF,MSSIMRUS GET PERCENTAGE VALUE (IMR FILE)              36500000
         B     IMRHE1CO    CONTINUE WITH COMMON ERROR ROUTINE           36520000
         SPACE 4                                                        36540000
*---------------------------------------------------------------------  36560000
* IMRHEPIN - NOT POSSIBLE TO ENTER PRELEASE COMMAND                     36580000
*---------------------------------------------------------------------  36600000
IMRHEPIN DS    0H                                                       36620000
         LA    R5,IMRMSG22 GET ADDRESS OF MESSAGE NUMBER                36640000
         LH    RF,MSSIMRUS GET PERCENTAGE VALUE (IMR FILE)              36660000
         B     IMRHE1CO    CONTINUE WITH COMMON ERROR ROUTINE           36680000
         EJECT ,                                                        36700000
*---------------------------------------------------------------------  36720000
* IMRHESVI - SYSTEM GETVIS ERROR                                        36740000
*---------------------------------------------------------------------  36760000
IMRHESVI DS    0H                                                       36780000
         LA    R5,IMRTID   GET TASK ID OF SYSTEM TASK                   36800000
         CH    R5,TID      REQUEST FROM SYSTEM TASK ?                   36820000
         BE    IMRHESV1    YES, WRITE MESSAGE                           36840000
         OI    IMRHIERR,IMRHSGV SET FLAG FOR SYSTEM TASK                36860000
         STH   RF,IMRHRETS SAVE RETURN CODE                             36880000
         BAL   R5,IMRHPSYS     POST SYSTEM TASK                         36900000
*SGLINK  IMRHPSYS,INPUT=(R5,RD),OUTPUT=(R6),WORK=(R8,RE,RF)             36920000
         BAL   RF,IMRHERMO RESET MONITOR CALL CLASS                     36940000
*SGLINK  IMRHERMO,INPUT=(R6,RD,RF),WORK=(R5,RE)                         36960000
         LA    RF,8        SET RETURN CODE 8                            36980000
         BR    R2          RETURN TO CALLER                             37000000
         SPACE 2                                                        37020000
IMRHESV1 DS    0H                                                       37040000
         NI    IMRHIERR,XFF-IMRHSGV RESET FLAG                          37060000
         LH    RF,IMRHRETS GET RETURN CODE                              37080000
         B     IMRHESV3    CONTINUE WITH COMMON ERROR ROUTINE  @D31FMIS 37100000
         SPACE 2                                                        37120000
IMRHESV2 DS    0H                                                       37140000
         SLR   RF,RF        CLEAR REGISTER 5 FOR INSERT                 37160000
         IC    RF,MSSIRET   GET MACRO RETURN CODE                       37180000
         MVI   MSSIERR,ZERO CLEAR MESSAGE INDICATOR                     37200000
         MVI   MSSIRET,ZERO CLEAR RETURN CODE                           37220000
IMRHESV3 DS    0H                                              @D31FMIS 37240000
         LA    R5,IMRMSG15 GET ADDRESS OF MESSAGE NUMBER       @D31FMIS 37260000
         OI    IMRHFLG2,IMRHTRHX HEX TRANSLATION REQUIRED      @D31FMIS 37280000
         B     IMRHE1CO    CONTINUE WITH COMMON ERROR ROUTINE           37300000
         EJECT ,                                                        37320000
*---------------------------------------------------------------------  37340000
* IMRHEFO  - FORCE THE IMRH SYSTEM                                      37360000
*---------------------------------------------------------------------  37380000
IMRHEFO  DS    0H                                                       37400000
         LA    R5,ARTID    GET TASK ID OF AR                            37420000
         CH    R5,TID      REQUEST FROM SYSTEM TASK ?                   37440000
         BH    IMRHEFO1    YES, WRITE MESSAGE (IMR TASK)                37460000
         BE    IMRHEFO2    YES, CONTINUE (AR TASK)                      37480000
         ICM   RF,3,MSSDCRET DATA COLLECTION IN ERROR ?                 37500000
         BZ    IMRHEFO2    NO, DO NOT ISSUE MESSAGE                     37520000
         OI    IMRHIERR,IMRHDC SET FLAG FOR SYSTEM TASK                 37540000
         L     RF,PCBPTR   GET PCB POINTER                     @D51IDIS 37560000
         USING PCBADR,RF                                       @D51IDIS 37580000
         LH    RF,PCELID   GET SYSLOG ID                       @D51IDIS 37600000
         DROP  RF                                                       37620000
         STH   RF,IMRHIELG STORE SYSLOG ID                              37640000
         BAL   R5,IMRHPSYS POST SYSTEM TASK                             37660000
*SGLINK  IMRHPSYS,INPUT=(R5,RD),OUTPUT=(R6),WORK=(R8,RE,RF)             37680000
IMRHEFO2 DS    0H                                                       37700000
         BAL   RF,IMRHERMO RESET MONITOR CALL CLASS                     37720000
*SGLINK  IMRHERMO,INPUT=(R6,RD,RF),WORK=(R5,RE)                         37740000
         LA    RF,8        SET RETURN CODE 8                            37760000
         BR    R2          RETURN TO CALLER                             37780000
         SPACE 2                                                        37800000
IMRHEFO1 DS    0H                                                       37820000
         NI    IMRHIERR,XFF-IMRHDC RESET FLAG                           37840000
         LH    RF,MSSDCRET GET RETURN CODE                              37860000
         SLR   R5,R5       CLEAR REGISTER                               37880000
         STH   R5,MSSDCRET CLEAR RETURN CODE                            37900000
         LA    RE,IMRHIEFL GET ADDRESS OF 1. INSERT                     37920000
         LA    R5,IMRMSG17 GET ADDRESS OF MESSAGE NUMBER                37940000
         LA    R8,IMRHECCO WRITE MESSAGE AFTER IMRHE2CO ROUTINE         37960000
         B     IMRHE2CO    PREPARE MSG HANDLER INPUT                    37980000
*SGLINK  IMRHE2CO,INPUT=(R5,R8,RD,RE,RF),WORK=(R5,RF)                   38000000
         EJECT ,                                                        38020000
*---------------------------------------------------------------------  38040000
* IMRHEOPU - LIST  RETRIEVAL OPEN  ERROR                                38060000
*---------------------------------------------------------------------  38080000
IMRHEOPU DS    0H                                              @D31FMIS 38100000
         LA    RE,IMREOLST GET ADDRESS OF 1. INSERT            @D31FMIS 38120000
IMRHEOP1 DS    0H                                              @D31FMIS 38140000
         TM    MSSIERR,MSSXBAM   BAM ERROR ?                   @D31FMIS 38160000
         BO    IMRHEFCO    YES, CONTINUE WITH COMMON ERROR ROUT@D31FMIS 38180000
*        OI    IMRHFLG2,IMRHNRES DO NOT RESET MONITORING       @D31FMIS 38200000
         B     IMRHEFCN    CONTINUE WITH COMMON ERROR ROUTINE  @D31FMIS 38220000
         SPACE 2                                                        38240000
*---------------------------------------------------------------------  38260000
* IMRHEGPU - LIST  RETRIEVAL GET   ERROR                                38280000
*---------------------------------------------------------------------  38300000
IMRHEGPU DS    0H                                              @D31FMIS 38320000
         LA    RE,IMREGLST GET ADDRESS OF 1. INSERT            @D31FMIS 38380000
         TM    MSSIERR,MSSXBAM   BAM ERROR ?                   @D31FMIS 38388000
         BO    IMRHEFCO    YES, CONTINUE WITH COMMON ERROR ROUT@D31FMIS 38396000
         C     RF,F4       RETURN CODE 4 ?                     @D31FMIS 38404000
         BNE   IMRHEFCN    NO, CONTINUE WITH COMMON ERROR ROUT.@D31FMIS 38412000
         SPACE 2                                                        38420000
*---------------------------------------------------------------------  38440000
* IMRHEGP0 - UNNOWN NODE ID MESSAGE                                     38460000
*---------------------------------------------------------------------  38480000
IMRHEGP0 DS    0H                                              @D31FMIS 38500000
         LA    R5,IMRMSG34 GET ADDRESS OF MESSAGE NUMBER       @D31FMIS 38520000
         STH   R5,IMRHEMSN  STORE MSG NUMBER                   @D31FMIS 38540000
         LA    RF,MSSUNNOI GET ADDRESS OF FIRST INSERT         @D31FMIS 38560000
         ST    RF,IMRHEMSG+4 STORE 1. INSERT POINTER INTO TABLE@D31FMIS 38580000
         NI    IMRHEMSG,XFF-X'80' RESET END OF LIST INDICATOR  @D31FMIS 38600000
         OI    IMRHEMSG+4,X'80' INDICATE END OF TABLE          @D31FMIS 38620000
         B     IMRHECCO    ENTER MESSAGE HANDLER               @D31FMIS 38640000
         SPACE 2                                                        38660000
*---------------------------------------------------------------------  38680000
* IMRHECPU - LIST  RETRIEVAL CLOSE ERROR                                38700000
*---------------------------------------------------------------------  38720000
IMRHECPU DS    0H                                              @D31FMIS 38740000
         LA    RE,IMRECLST GET ADDRESS OF 1. INSERT            @D31FMIS 38760000
         B     IMRHEOP1    CONTINUE WITH COMMON ERROR ROUTINE  @D31FMIS 38780000
         EJECT ,                                                        38800000
*---------------------------------------------------------------------  38820000
* IMRHE0CO - COMMON ERROR ROUTINE (NO INSERT)                           38840000
*            INPUT:                                                     38860000
*              R5 - MSG NUMBER                                          38880000
*              RD - IVMENTRY BASE ADDRESS                               38900000
*---------------------------------------------------------------------  38920000
IMRHE0CO DS    0F                                                       38940000
         STH   R5,IMRHEMSN  STORE MSG NUMBER                            38960000
         OI    IMRHEMSG,X'80' INDICATE END OF TABLE                     38980000
         B     IMRHECCO    ENTER MESSAGE HANDLER                        39000000
         SPACE 3                                                        39020000
*---------------------------------------------------------------------  39040000
* IMRHE1CO - COMMON ERROR ROUTINE (ONE INSERT)                          39060000
*            INPUT:                                                     39080000
*              R5 - MSG NUMBER                                          39100000
*              RD - IVMENTRY BASE ADDRESS                               39120000
*              RF - 1. INSERT                                           39140000
*            WORK:                                                      39160000
*              RF                                                       39180000
*---------------------------------------------------------------------  39200000
IMRHE1CO DS    0F                                                       39220000
         STH   R5,IMRHEMSN STORE MSG NUMBER                             39240000
         BAL   R5,IMRHETR  TRANSLATE RETURN CODE                        39260000
*SGLINK  IMRHETR,INPUT=(R5,RD,RF),OUTPUT=(RF)                           39280000
         ST    RF,IMRHEMSG+4 STORE 1. INSERT POINTER INTO TABLE         39300000
         NI    IMRHEMSG,XFF-X'80' RESET END OF LIST INDICATOR           39320000
         OI    IMRHEMSG+4,X'80' INDICATE END OF TABLE                   39340000
         B     IMRHECCO    ENTER MESSAGE HANDLER                        39360000
         SPACE 3                                                        39380000
*---------------------------------------------------------------------  39400000
* IMRHE2CO - COMMON ERROR ROUTINE (TWO INSERTS)                         39420000
*            INPUT:                                                     39440000
*              R5 - MSG NUMBER                                          39460000
*              R8 - RETURN ADDRESS                                      39480000
*              RD - IVMENTRY BASE ADDRESS                               39500000
*              RE - ADDRESS OF 1. INSERT                                39520000
*              RF - 2. INSERT                                           39540000
*            WORK:                                                      39560000
*              R5, RF                                                   39580000
*---------------------------------------------------------------------  39600000
*SGLINK  IMRHE2CO,S,INPUT=(R5,R8,RD,RE,RF),WORK=(R5,RF)                 39620000
IMRHE2CO DS    0F                                                       39640000
         STH   R5,IMRHEMSN STORE MSG NUMBER                             39660000
         ST    RE,IMRHEMSG+4 STORE 1. INSERT POINTER INTO TABLE         39680000
         BAL   R5,IMRHETR  TRANSLATE RETURN CODE                        39700000
*SGLINK  IMRHETR,INPUT=(R5,RD,RF),OUTPUT=(RF)                           39720000
         ST    RF,IMRHEMSG+8 STORE 2. INSERT POINTER INTO TABLE         39740000
         NI    IMRHEMSG,XFF-X'80' RESET END OF LIST INDICATOR           39760000
         OI    IMRHEMSG+8,X'80' INDICATE END OF TABLE                   39780000
         BR    R8          RETURN TO CALLER                             39800000
         EJECT ,                                                        39820000
*---------------------------------------------------------------------  39840000
* IMRHE3CO - COMMON ERROR ROUTINE (THREE INSERTS)                       39860000
*            INPUT:                                                     39880000
*              R5 - MSG NUMBER                                          39900000
*              R8 - RETURN ADDRESS                                      39920000
*              R9 - 3. INSERT                                           39940000
*              RD - IVMENTRY BASE ADDRESS                               39960000
*              RE - ADDRESS OF 1. INSERT                                39980000
*              RF - 2. INSERT                                           40000000
*            WORK:                                                      40020000
*              R5, RF                                                   40040000
*---------------------------------------------------------------------  40060000
*SGLINK  IMRHE3CO,S,INPUT=(R5,R8,R9,RD,RE,RF),WORK=(R5,RF)     @D31FMIS 40080000
IMRHE3CO DS    0H                                              @D31FMIS 40100000
         STH   R5,IMRHEMSN STORE MSG NUMBER                    @D31FMIS 40120000
         ST    RE,IMRHEMSG+4 STORE 1. INSERT PTR INTO TABLE    @D31FMIS 40140000
         TM    IMRHFLG2,IMRH2CHR IS 2. CHAR. STRING ADDRESS    @D31FMIS 40160000
         BO    IMRHE3CX    YES, TRANSLATE TO HEX CHARACTERS    @D31FMIS 40180000
         BAL   R5,IMRHETR  TRANSLATE RETURN CODE               @D31FMIS 40200000
*SGLINK  IMRHETR,INPUT=(R5,RD,RF),OUTPUT=(RF)                  @D31FMIS 40220000
         MVC   IMRHEINS(6),0(RF) SAVE 2. INSERT                @D31FMIS 40240000
         LA    RF,IMRHEINS GET ADDRESS OF 2. INSERT            @D31FMIS 40260000
IMRHE3CX DS    0H                                              @D31FMIS 40280000
         ST    RF,IMRHEMSG+8 STORE 2. INSERT PTR INTO TABLE    @D31FMIS 40300000
         LR    RF,R9       GET 3. INSERT                       @D31FMIS 40320000
         BAL   R5,IMRHETR  TRANSLATE RETURN CODE               @D31FMIS 40340000
*SGLINK  IMRHETR,INPUT=(R5,RD,RF),OUTPUT=(RF)                  @D31FMIS 40360000
         ST    RF,IMRHEMSG+12 STORE 3. INSERT PTR INTO TABLE   @D31FMIS 40380000
         NI    IMRHEMSG,XFF-X'80' RESET END OF LIST INDIC.     @D31FMIS 40400000
         OI    IMRHEMSG+12,X'80' INDICATE END OF TABLE         @D31FMIS 40420000
         BR    R8          RETURN TO CALLER                    @D31FMIS 40440000
         EJECT ,                                                        40460000
*---------------------------------------------------------------------  40480000
* IMRHEFCO - COMMON IMR FILE ERROR ROUTINE                              40500000
*            INPUT:                                                     40520000
*              RD - IVMENTRY BASE ADDRESS                               40540000
*              RE - 1. INSERT                                           40560000
*              RF - 2. INSERT                                           40580000
*            WORK:                                                      40600000
*              R5, R8, RE, RF                                           40620000
*---------------------------------------------------------------------  40640000
IMRHEFCO DS    0F                                                       40660000
         LA    R5,IMRMSG20 GET ADDRESS OF MESSAGE NUMBER                40680000
         BAL   R8,IMRHE2CO PREPARE MSG HANDLER INPUT                    40700000
*SGLINK  IMRHE2CO,INPUT=(R5,R8,RD,RE,RF),WORK=(R5,RF)                   40720000
         TM    IMRHFLG2,IMRHNRES MONITORING RESET NECESSARY ?  @D31FMIS 40740000
         BO    IMRHEFOO     NO, CONTINUE                       @D31FMIS 40760000
         BAL   RF,IMRHERMO RESET MONITOR CALL CLASS                     40780000
*SGLINK  IMRHERMO,INPUT=(R6,RD,RF),WORK=(R5,RE)                         40800000
IMRHEFOO DS    0H                                              @D31FMIS 40820000
         NI    IMRHFLG2,XFF-IMRHNRES RESET INDICATION          @D31FMIS 40840000
         NI    MSSIERR,XFF-MSSXBAM RESET BAM ERROR INDICATION  @DY40063 40850000
         TM    MSSIERR,X'FF'    MACRO CALL FAILED ?            @D31FMIS 40860000
         BZ    IMRHECCO     NO, CONTINUE                                40880000
         TM    MSSMONS2,MSSSLAVE REQUEST ON SLAVE ?            @D31FMIS 40900000
         BO    IMRHEFCN     YES, SKIP IMR FILE MESSAGE         @D31FMIS 40920000
         BAL   R5,IMRHCMSG  CALL SVA MESSAGE HANDLER                    40940000
*SGLINK  IMRHCMSG,INPUT=(R5,RD),WORK=(R8,RE,RF)                         40960000
IMRHEFCN DS    0H                                              @D31FMIS 40980000
         TM    MSSIERR,MSSSGVS  SYSTEM GETVIS REQUEST FAILED            41000000
*                               DURING IMR OPEN FAILED ?                41020000
         BO    IMRHESV2     YES, GIVE CORRESP. MESSAGE                  41040000
         TM    MSSIERR,MSSXPWR  POWER REQUEST FAILED ?         @D31FMIS 41060000
         BO    IMRHEPWR     YES, GIVE CORRESP. MESSAGE         @D31FMIS 41080000
         TM    MSSIERR,MSSXPCC  XPCC  REQUEST FAILED ?         @D31FMIS 41100000
         BO    IMRHEXPC     YES, GIVE CORRESP. MESSAGE         @D31FMIS 41120000
         LA    R5,IMRMS512  GET ADDRESS OF MESSAGE NUMBER      @D31FMIS 41140000
         LA    RE,IMRELAB   GET ADDRESS FOR FIRST INSERT                41160000
         TM    MSSIERR,MSSLABEL LABEL MACRO CALLED                      41180000
*                               DURING IMR OPEN FAILED ?                41200000
         BO    IMRHEFC1     YES, CONTINUE                               41220000
         LA    RE,IMREGVC   GET ADDRESS FOR FIRST INSERT                41240000
         TM    MSSIERR,MSSGVCE  GETVCE MACRO CALLED                     41260000
*                               DURING IMR OPEN FAILED ?                41280000
         BO    IMRHEFC1     YES, CONTINUE                               41300000
         LA    RE,IMREASS   GET ADDRESS FOR FIRST INSERT                41320000
IMRHEFC1 DS    0H                                                       41340000
         ST    R9,IMRHRSAV  SAVE REGISTER 9                    @D31FMIS 41360000
         SLR   R9,R9        CLEAR REGISTER 9 FOR INSERT        @D31FMIS 41380000
         IC    R9,MSSIRET   GET MACRO RETURN CODE              @D31FMIS 41400000
         MVI   MSSIERR,ZERO CLEAR MESSAGE INDICATOR                     41420000
         MVI   MSSIRET,ZERO CLEAR RETURN CODE                           41440000
         LA    RF,IMREMOD   GET ADDRESS OF MODULE NAME         @D31FMIS 41460000
         OI    IMRHFLG2,IMRH2CHR INPUT:2. INSERT=STRING ADDRESS@D31FMIS 41480000
         BAL   R8,IMRHE3CO PREPARE MSG HANDLER INPUT (3 INSERTS@D31FMIS 41500000
*SGLINK  IMRHE3CO,INPUT=(R5,R8,R9,RD,RE,RF),WORK=(R5,RF)       @D31FMIS 41520000
         L     R9,IMRHRSAV  RESTORE REGISTER 9                 @D31FMIS 41540000
         NI    IMRHFLG2,XFF-IMRH2CHR RESET INDICATION          @D31FMIS 41560000
         EJECT ,                                                        41580000
*---------------------------------------------------------------------  41600000
* IMRHECCO - CALL MESSAGE HANDLER                                       41620000
*            INPUT:                                                     41640000
*              RD - IVMENTRY BASE ADDRESS                               41660000
*---------------------------------------------------------------------  41680000
IMRHECCO DS    0H                                                       41700000
         NI    IMRHFLG2,XFF-IMRHTRHX RESET INDICATION          @D31FMIS 41720000
         BAL   R5,IMRHCMSG  CALL SVA MESSAGE HANDLER                    41740000
*SGLINK  IMRHCMSG,INPUT=(R5,RD),WORK=(R8,RE,RF)                         41760000
         SLR   RF,RF       SET RETURN CODE 0                            41780000
         TM    MSSMONST,MSSFORCE FORCED SYSTEM ?                        41800000
         BZR   R2          NO, RETURN TO CALLER                         41820000
         LA    RF,8        SET RETURN CODE                              41840000
         ICM   R5,3,IMRHCOCT TASKS IN DATA COLLECTION                   41860000
         BNZR  R2          YES, RETURN TO CALLER                        41880000
         OI    IMRHFLG1,IMRHFALL INDICATE ALL AREAS TO BE FREED         41900000
         BR    R2          RETURN TO CALLER                             41920000
         SPACE 2                                               @D31FMIS 41940000
*---------------------------------------------------------------------  41960000
* IMRHEPWR - POWER REQUEST FAILED - GIVE CORRESPONDING MESSAGE          41980000
*            INPUT:                                                     42000000
*              RD - IVMENTRY BASE ADDRESS                               42020000
*---------------------------------------------------------------------  42040000
IMRHEPWR DS    0H                                              @D31FMIS 42060000
         LA    R5,IMRMS549 GET MESSAGE NUMBER                  @D31FMIS 42080000
IMRHEPWC DS    0H                                              @D31FMIS 42100000
         OI    IMRHFLG2,IMRHTRHX HEX TRANSLATION REQUIRED      @D31FMIS 42120000
         LA    RE,MSSFUNCI GET ADDRESS OF FIRST INSERT         @D31FMIS 42140000
         ST    R9,IMRHRSAV  SAVE REGISTER 9                    @D31FMIS 42160000
         SLR   R9,R9        CLEAR REGISTER 9 FOR INSERT        @D31FMIS 42180000
         SLR   RF,RF        CLEAR REGISTER F FOR INSERT        @D31FMIS 42200000
         IC    R9,MSSIRES   GET MACRO REASON CODE              @D31FMIS 42220000
         IC    RF,MSSIRET   GET MACRO RETURN CODE              @D31FMIS 42240000
         MVI   MSSIERR,ZERO CLEAR MESSAGE INDICATOR            @D31FMIS 42260000
         MVI   MSSIRET,ZERO CLEAR RETURN CODE                  @D31FMIS 42280000
         MVI   MSSIRES,ZERO CLEAR REASON CODE                  @D31FMIS 42300000
         BAL   R8,IMRHE3CO PREPARE MSG HANDLER INPUT (3 INSERTS@D31FMIS 42320000
*SGLINK  IMRHE3CO,INPUT=(R5,R8,R9,RD,RE,RF),WORK=(R5,RF)       @D31FMIS 42340000
         L     R9,IMRHRSAV  RESTORE REGISTER 9                 @D31FMIS 42360000
         B     IMRHECCO    ENTER COMMON ROUTINE                @D31FMIS 42380000
         SPACE 2                                               @D31FMIS 42400000
*---------------------------------------------------------------------  42420000
* IMRHEXPC - XPCC  REQUEST FAILED - GIVE CORRESPONDING MESSAGE          42440000
*            INPUT:                                                     42460000
*              RD - IVMENTRY BASE ADDRESS                               42480000
*---------------------------------------------------------------------  42500000
IMRHEXPC DS    0H                                              @D31FMIS 42520000
         LA    R5,IMRMS550 GET MESSAGE NUMBER                  @D31FMIS 42540000
         B     IMRHEPWC    ENTER COMMON ROUTINE                @D31FMIS 42560000
         EJECT ,                                                        42580000
**********************************************************************  42600000
* IMRHCMSG - CALL SVA MESSAGE ROUTINE                                   42620000
*            INPUT:                                                     42640000
*              R5 - RETURN ADDRESS                                      42660000
*              RD - IVMENTRY BASE ADDRESS                               42680000
*            WORK:                                                      42700000
*              R8, RE, RF                                               42720000
**********************************************************************  42740000
*SGLINK  IMRHCMSG,S,INPUT=(R5,RD),WORK=(R8,RE,RF)                       42760000
IMRHCMSG DS    0H                                                       42780000
         L     RF,ASVASVDL  GET ADDRESS TO SUPERVISOR SUBDIRECTORY      42800000
         USING SVASVDL,RF                                               42820000
         L     RF,AIVMPISV  GET ENTRY POINT OF SVA PHASE                42840000
         DROP  RF                                                       42860000
         USING IVMCIPHD,RF                                              42880000
         L     RF,PHDPIMSG  GET ROUTINE ADDRESS                         42900000
         LTR   RF,RF        IVMPIMSG ROUTINE AVAILABLE ?                42920000
         BZR   R5           NO, RETURN TO CALLER                        42940000
         DROP  RF                                                       42960000
         LR    R8,R1        SAVE REGISTER                               42980000
         LA    R1,IMRHEMSG  GET ADDRESS OF PARAMETER LIST               43000000
         DROP  RD                                                       43020000
         SLR   RD,RD        CLEAR REGISTER                              43040000
*---------------------------------------------------------------------  43060000
*                CALL IVMPIMSG ROUTINE                                  43080000
*            INPUT:                                                     43100000
*              R1 - ADDRESS OF PARAMETER LIST                           43120000
*              RD - SET TO ZERO                                         43140000
*              RE - RETURN ADDRESS                                      43160000
*              RF - IVMPIMSG ROUTINE ADDRESS                            43180000
*            OUTPUT:                                                    43200000
*              RF - RETURN CODE                                         43220000
*                   0 - COMMAND ACCEPTED                                43240000
*                   8 - MESSAGE HANDLER FAILED                          43260000
*            WORK:                                                      43280000
*              RD                                                       43300000
*---------------------------------------------------------------------  43320000
         BALR  RE,RF        ENTER SVA ROUTINE                           43340000
         L     RD,IJBIVMCB  GET IVMCIMSS ADDRESS                        43360000
         USING IVMENTRY,RD                                              43380000
* WHEN THE MESSAGE ROUTINE FAILS, THE MESSAGE WILL BE IGNORED           43400000
         LR    R1,R8        RESTORE REGISTER                            43420000
         BR    R5           RETURN TO CALLER                            43440000
         EJECT ,                                                        43460000
**********************************************************************  43480000
* IMRHERMO - RESET MONITOR CALL CLASS                                   43500000
*            INPUT:                                                     43520000
*              R6 - DISPATCHER ADDRESS                                  43540000
*              RD - IVMENTRY BASE ADDRESS                               43560000
*              RF - RETURN ADDRESS                                      43580000
*            WORK:                                                      43600000
*              R5, RE                                                   43620000
**********************************************************************  43640000
*SGLINK  IMRHERMO,S,INPUT=(R6,RD,RF),WORK=(R5,RE)                       43660000
IMRHERMO DS    0H                                                       43680000
         STCTL CR8,CR8,IMRHSAVE  GET CONTROL REGISTER 8                 43700000
         NC    IMRHSAVE,IMRHEMSK RESET IAF MC BIT                       43720000
         LCTL  CR8,CR8,IMRHSAVE  SET CONTROL REGISTER                   43740000
         MVI   MSSMONST,MSSFORCE FORCE MONITORING                       43760000
         NI    MSSMONS2,XFF-MSSCCSON RESET CICS MON.           @D31FMIS 43780000
         NI    MSSMONS3,XFF-MSSONALL RESET ALL REQUEST         @D51IDIS 43800000
         B     IMRHPWTS     POST ANY TASKS WAITING FOR A FREE BUFFER    43820000
*SGLINK  IMRHPWTS,INPUT=(R6,RD,RF),WORK=(R5,RE)                         43840000
         EJECT ,                                               @D31FMIS 43860000
**********************************************************************  43880000
* IMRHETR  - TRANSLATE HEX VALUES INTO 3 BYTE CHARACTER VALUES          43900000
*            INPUT:                                                     43920000
*              R5 - RETURN ADDRESS                                      43940000
*              RD - IVMENTRY BASE ADDRESS                               43960000
*              RF - HEX VALUE                                           43980000
*            OUTPUT:                                                    44000000
*              RF - ADDRESS TO INSERT VALUE                             44020000
**********************************************************************  44040000
*SGLINK  IMRHETR,S,INPUT=(R5,RD,RF),OUTPUT=(RF)                         44060000
IMRHETR  DS    0H          COMMON ERROR ROUTINE                         44080000
         TM    IMRHFLG2,IMRHTRHX HEX TRANSLATION REQUIRED ?    @D31FMIS 44100000
         BO    IMRHETRX    YES, TRANSLATE TO HEX CHARACTERS    @D31FMIS 44120000
         LA    RF,0(,RF)   CLEAR HIGH ORDER BYTE                        44140000
         CVD   RF,IMRHEPRT CONVERT RET.CODE INTO DECIMAL                44160000
         UNPK  IMRHEPRT+1(3),IMRHEPRT+6(2) CHANGE TO PRINTABLE CHAR.    44180000
         LA    RF,IMRHEPRT-1 START TO REMOVE LEADING BLANKS             44200000
IMRHETR0 DS    0H                                                       44220000
         LA    RF,1(,RF)     POINT TO FIRST/NEXT BYTE                   44240000
         MVI   0(RF),X'40'   SET BYTE TO BLANK                          44260000
         CLI   1(RF),X'F0'   NEXT BYTE LEADING ZERO ?                   44280000
         BE    IMRHETR0      YES, PROCESS NEXT BYTE                     44300000
         OI    IMRHEPRT+3,X'F0' SET LAST CHARACTER TO PRINTABLE FORM    44320000
         MVI   IMRHEPRT,X'03' SET LENGTH OF FIELD FOR INSERT            44340000
         LA    RF,IMRHEPRT POINT TO INSERT FIELDS                       44360000
         BR    R5          RETURN TO CALLER                             44380000
         SPACE 2                                               @D31FMIS 44400000
*---------------------------------------------------------------------  44420000
* IMRHETRX - TRANSLATE TO HEX CHARACTERS                                44440000
*---------------------------------------------------------------------  44460000
IMRHETRX DS    0H                                              @D31FMIS 44480000
         STC   RF,IMREXCHR+3 SAVE HEX VALUE                    @D31FMIS 44500000
         UNPK  IMREXCHR+3(3),IMREXCHR+3(2) UNPACK HEX VALUE    @D31FMIS 44520000
         TR    IMREXCHR+3(2),IMRETRTB-X'F0' TRANSL.TO PRINTABLE@D31FMIS 44540000
         MVI   IMREXCHR+5,X'7D' SET ' TO END OF STRING         @D31FMIS 44560000
         LA    RF,IMREXCHR POINT TO INSERT FIELDS              @D31FMIS 44580000
         BR    R5          RETURN TO CALLER                    @D31FMIS 44600000
         EJECT ,                                                        44620000
*---------------------------------------------------------------------  44640000
*          - WORK AREAS FOR ERROR ROUTINE                               44660000
*---------------------------------------------------------------------  44680000
IMRHEPRT DC    D'0'              WORK FIELD TO CONVERT THE ...          44700000
*                                  ... RETURN CODE INTO CHARACTERS      44720000
IMRHEMSK DC    XL4'FFFFFBFF'     MASK TO RESET IAF MC BIT               44740000
IMRHAMSK DC    XL4'00000400'     MASK TO SET IAF MC BIT                 44760000
IMRHEMSG DS    0F                POINTER TABLE FOR MESSAGE HANDLER      44780000
         DC    A(IMRHEMSN)       POINTER TO MESSAGE NUMBER              44800000
         DC    F'0'              POINTER TO 1. INSERT                   44820000
         DC    F'0'              POINTER TO 2. INSERT                   44840000
         DC    F'0'              POINTER TO 3. INSERT                   44860000
         DC    F'0'              POINTER TO 4. INSERT                   44880000
*---------------------------------------------------------------------  44900000
* MESSAGE NUMBERS FOR IMRH MESSAGES                                     44920000
*---------------------------------------------------------------------  44940000
IMRHRSAV DC    F'0'              REGISTER SAVE AREA                     44960000
IMRHEMSN DC    H'0'              MESSAGE NUMBER                         44980000
IMRMSG02 EQU   2                 MONITORING DEACTIVATED        @D31FMIS 45000000
IMRMSG15 EQU   15                SYSTEM GETVIS FAILURE                  45020000
IMRMSG17 EQU   17                DATA COLLECTION IN ERROR               45040000
IMRMSG20 EQU   20                IMR FILE ERROR                         45060000
IMRMSG22 EQU   22                NOT POSSIBLE TO EXECUTE PRELEASE       45080000
IMRMSG23 EQU   23                PRELEASE COMMAND ISSUED                45100000
IMRMSG24 EQU   24                BUFFER SPACE EXHAUSTED                 45120000
IMRMSG25 EQU   25                IMR SYSTEM TASK CANCELLED              45140000
IMRMSG26 EQU   26                IMR SYSTEM TASK CANCELLED TWICE        45160000
IMRMSG27 EQU   27                DEACTIVATION COMPLETE                  45180000
IMRMSG33 EQU   33                LIST  QUEUE RETRIEVAL DEACT.  @D31FMIS 45200000
IMRMSG34 EQU   34                UNKNOWN NODE ID               @D31FMIS 45220000
IMRMS512 EQU   512               MACRO FAILED                  @D31FMIS 45240000
IMRMS549 EQU   549               MACRO FAILED  - POWER         @D31FMIS 45260000
IMRMS550 EQU   550               MACRO FAILED  - XPCC          @D31FMIS 45280000
*---------------------------------------------------------------------  45300000
* INSERTS FOR "IMR FILE ERROR" MESSAGE                                  45320000
*---------------------------------------------------------------------  45340000
IMREOPEN DC    X'04',CL4'OPEN'                                          45360000
IMREPUT  DC    X'03',CL3'PUT'                                           45380000
IMRECLOS DC    X'05',CL5'CLOSE'                                         45400000
IMREASS  DC    X'06',CL6'ASSIGN'                                        45420000
IMREGVC  DC    X'06',CL6'GETVCE'                                        45440000
IMRELAB  DC    X'05',CL5'LABEL'                                         45460000
IMREOLST DC    X'07',CL7'OPENLST'                              @D31FMIS 45480000
IMRECLST DC    X'08',CL8'CLOSELST'                             @D31FMIS 45500000
IMREGLST DC    X'06',CL6'GETLST'                               @D31FMIS 45520000
IMREMOD  DC    X'08',CL8'IVMPIIMR'                             @D31FMIS 45540000
IMRHEINS DC    CL6' '            WORK FIELD FOR 2. INSERT      @D31FMIS 45560000
         DS    0H                                              @D31FMIS 45580000
IMRETRTB DC    C'0123456789ABCDEF' HEX. TRANSLATE TABLE        @D31FMIS 45600000
IMREXCHR DC    X'05',CL5'X'''                                  @D31FMIS 45620000
         DROP  RD                                                       45640000
.NOGEN1  ANOP                                                  @D61NDIS 45650061
         SPACE 2                                               @D61NDIS 45673361
IMRGATE  DS    0F           DUMMY LABEL                        @D61NDIS 45674061
ENQBUFF  DS    0F           DUMMY LABEL                        @D61NDIS 45674761
GETBUFF  DS    0F           DUMMY LABEL                        @D61NDIS 45675461
         LA    RF,8         INDICATE SEVERE ERROR              @D61NDIS 45676161
         BR    RC           RETRURN TO CALLER                  @D61NDIS 45676861
         AGO   .NOGEN2             DO NOT GENERATE THIS PART   @D61NDIS 45677561
         EJECT ,                                                        45678261
**********************************************************************  45680000
* IMRHTASK - IMRH SYSTEM TASK                                           45700000
*            IMRHTASK RUNS ASYNCHRONEOUS TO THE BUFFER ENQUEUER         45720000
*            IN DISABLED STATE.                                         45740000
*            TASKS:                                                     45760000
*            1) WORKING ON THE FULL BUFFER CHAIN:                       45780000
*               IMRHTASK IS POSTED BY THE ENQBUFF ROUTINE, WHEN THE     45800000
*               FIRST ELEMENT WAS ENQUEUED INTO THE FULL BUFFER CHAIN.  45820000
*            2) DEACTIVATION OF IAF:                                    45840000
*               IMRHTASK FREES AREAS ALLOCATED FOR IAF PROCESSING.      45860000
*            REGISTER USAGE:                                            45880000
*              R2 - SUBROUTINE RETURN REGISTER (IVMENTRY ROUTINES)      45900000
*              R3 - BASE REGISTER                                       45920000
*              R6 - DISPATCHER BASE ADDRESS                             45940000
*              R7 - SUBROUTINE RETURN REGISTER (IMRHTASK ROUTINES)      45960000
*              R8 - SUBROUTINE RETURN REGISTER (IMRHTASK ROUTINES)      45980000
*              RD - POINTER TO IVMCIMSS CONTROL BLOCK                   46000000
**********************************************************************  46020000
         USING IMRHTASK,R3                                              46040000
         USING IVMENTRY,RD                                              46060000
IMRHTASK DS    0F                                                       46080000
         STXIT AB,IMRHABR,IMRHABSV,OPTION=NODUMP                        46100000
*---------------------------------------------------------------------  46120000
* IMRHTAS1 - RESTART POINT AFTER DEACTIVATION                           46140000
*---------------------------------------------------------------------  46160000
IMRHTAS1 DS    0H                                                       46180000
         OI    IMRHFLAG,IMRHSYS INDICATE SYSTEM TASK ACTIVE             46200000
         TM    MSSSTATE,MSSIMROW IMR FILE OPENED FOR WRITE ?   @D31FMIS 46220000
         BZ    IMRHTASO     NO, TRY TO PROCESS OPEN            @D31FMIS 46240000
         EJECT ,                                                        46260000
*---------------------------------------------------------------------  46280000
* IMRHSTLP - LOOP AS LONG AS BUFFERS ARE AVAILABLE                      46300000
*---------------------------------------------------------------------  46320000
IMRHSTLP DS    0H           START LOOP - WORK ON FULL BUFFER QUEUE      46340000
         CLI   IMRHIERR,ZERO MESSAGE TO BE GIVEN ?                      46360000
         BNE   IMRHSTS1     YES, CALL ERROR ROUTINE                     46380000
         TM    MSSMONST,MSSOFF IAF INACTIVE ?                  @D31FMIS 46400000
         BO    IMRHLSTX     YES, CHECK FOR LST QUEUE RETRIEVAL @D31FMIS 46420000
         TM    MSSMONST,MSSFORCE FORCED IMRH SYSTEM ?                   46440000
         BO    IMRHSTST     YES, DEACTIVATE SYSTEM TASK                 46460000
*---------------------------------------------------------------------  46480000
*          - WRITE ALL BUFFERS IN FULL                                  46500000
*            BUFFER QUEUE TO IMR FILE                                   46520000
*---------------------------------------------------------------------  46540000
         BAL   R7,IMRHSELB   REMOVE ONE BUFFER FROM QUEUE               46560000
*SGLINK IMRHSELB,INPUT=(R3,R6,R7,RD),OUTPUT=(R0,R1),                   X46580000
               WORK=(R2,R5,RE,RF)                                       46600000
         LTR   R0,R0         ONE BUFFER DEQUEUED ?                      46620000
         BNZ   IMRHSTST      NO, DEACTIVATE SYSTEM TASK                 46640000
         BAL   R8,IMRHWRIT   WRITE BUFFER TO IMR FILE                   46660000
*SGLINK IMRHWRIT,INPUT=(R1,R3,R6,R8,RD),OUTPUT=(R1,R5,RF),             X46680000
               WORK=(R0,R2,R4,R7,R9,RE)                                 46700000
         LTR   RF,RF         ERROR OCCURRED OR MESSAGE TO BE WRITTEN ?  46720000
         BZ    IMRHSTLP      NO, DEQUEUE NEXT BUFFER                    46740000
         BAL   R2,IMRHERR    ENTER ERROR ROUTINE                        46760000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     46780000
         LTR   RF,RF         IAF SYSTEM FORCED ?                        46800000
         BZ    IMRHSTLP      NO, DEQUEUE NEXT BUFFER                    46820000
         EJECT ,                                                        46840000
*---------------------------------------------------------------------  46860000
* IMRHSTST - FREE ALL AREAS AND DEACTIVATE SYSTEM TASK                  46880000
*---------------------------------------------------------------------  46900000
IMRHSTST DS    0H                                                       46920000
         TM    IMRHFLG1,IMRHFALL ALLOCATED AREAS TO BE FREED ?          46940000
         BZ    IMRHLSTX     NO, CHECK IF RETRIEVAL IS NECESSARY@D31FMIS 46960000
         TM    IMRHFLAG,IMRHINVA INVENT SVC PROCESSING ACTIVE ?         46980000
         BO    IMRHTAS2      YES, WAIT TO BE POSTED                     47000000
         ICM   R1,15,IMRHAREA IAF AREAS ALREADY DEALLOCATED ?  @D31FMIS 47005000
         BZ    IMRHEOTR     YES, DEACTIVATE SYSTEM TASK        @D31FMIS 47010000
*SGLINK  IMRHEOTR,INPUT=(R3,R6,RD)                                      47015000
         BAL   R2,IMRHFRGV  FREE ALLOCATED AREAS                        47020000
*SGLINK IMRHFRGV,INPUT=(R2,R6,RD),WORK=(R1,R9,RA)                       47040000
         B     IMRHEOTR     DEACTIVATE SYSTEM TASK                      47060000
*SGLINK  IMRHEOTR,INPUT=(R3,R6,RD)                                      47080000
         SPACE 2                                                        47100000
*---------------------------------------------------------------------  47120000
*          - CALL ERROR ROUTINE FOR FLAGGED MESSAGES                    47140000
*            GIVE ONLY ONE MESSAGE IN CASE OF FORCED SYSTEM             47160000
*---------------------------------------------------------------------  47180000
IMRHSTS1 DS    0F                                                       47200000
         LA    R5,IMRSVIS   SET FUNCTION CODE                           47220000
         TM    IMRHIERR,IMRHSGV SYSTEM GETVIS ERROR ?                   47240000
         BO    IMRHSTS2     YES, WRITE MESSAGE                          47260000
         LA    R5,IMRFORCE  SET FUNCTION CODE                           47280000
         TM    IMRHIERR,IMRHDC  FORCED BY DATA COLLECTION ?             47300000
         BO    IMRHSTS2     YES, WRITE MESSAGE                          47320000
         LA    R5,IMRNOBUF  SET FUNCTION CODE                           47340000
IMRHSTS2 DS    0H                                                       47360000
         BAL   R2,IMRHERR    ENTER ERROR ROUTINE                        47380000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     47400000
         LTR   RF,RF        RETURN CODE ZERO ?                          47420000
         BZ    IMRHSTLP     YES, TRY TO DEQUEUE NEXT BUFFER             47440000
         B     IMRHSTST     TRY TO DEALLOCATE IMRH AREAS                47460000
         SPACE 2                                                        47480000
*---------------------------------------------------------------------  47500000
* IMRHTAS2 - WAIT TO BE POSTED BY INVENT ROUTINE                        47520000
*---------------------------------------------------------------------  47540000
IMRHTAS2 DS    0F                                                       47560000
         OI    IMRHFLAG,IMRHPREQ INDICATE POST OF IMR TASK REQUIRED     47580000
*                            DEACTIVATE SYSTEM TASK                     47600000
         B     IMRHDEAC     DEACTIVATE SYSTEM TASK             @D31FMIS 47620000
*SGLINK IMRHDEAC,INPUT=(R3,R6,RD)                                       47640000
         EJECT ,                                                        47660000
*---------------------------------------------------------------------  47680000
* IMRHLSTX - PROCESS LIST  QUEUE RETRIEVAL                              47700000
*---------------------------------------------------------------------  47720000
IMRHLSTX DS    0H                                              @D31FMIS 47740000
         TM    MSSMONST,MSSFORCE FORCED IMRH SYSTEM ?          @D31FMIS 47760000
         BO    IMRHDEAC     YES, DEACTIVATE SYSTEM TASK        @D31FMIS 47780000
*SGLINK IMRHDEAC,INPUT=(R3,R6,RD)                                       47800000
         TM    MSSMONS2,MSSPNET  RETRIEVAL FROM LST QUEUE ?    @D31FMIS 47820000
         BZ    IMRHDEAC     NO, DEACTIVATE SYSTEM TASK         @D31FMIS 47840000
*SGLINK IMRHDEAC,INPUT=(R3,R6,RD)                                       47860000
         TM    MSSMONS2,MSSPNETC COMMUNICATION ESTABLISHED ?   @D31FMIS 47880000
         BZ    IMRHLSTO     NO, START RETRIEVAL FROM LST QUEUE @D31FMIS 47900000
IMRHLST1 DS    0H                                              @D31FMIS 47920000
*        IMR   GETLST                                          @D31FMIS 47940000
         IMR   GETLST                                          @D31FMIS 47960000
         LA    R5,IMRGELST  SET FUNCTION CODE                  @D31FMIS 47980000
         C     RF,F4        RETURN CODE 4 ?                    @D31FMIS 48000000
         BL    IMRHLSTW     = 0, CHECK IF BUFFERS AVAIL.       @D31FMIS 48020000
         BH    IMRHPU1O     > 4, WRITE MESSAGE AND DEACTIVATE  @D31FMIS 48040000
         BAL   R2,IMRHERR   ENTER ERROR ROUTINE                @D31FMIS 48060000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     48080000
         B     IMRHSTLP     = 4, CHECK IF BUFFERS AVAIL.       @D31FMIS 48100000
         EJECT ,                                                        48120000
*---------------------------------------------------------------------  48140000
* IMRHTASO - OPEN IMR FILE                                              48160000
*---------------------------------------------------------------------  48180000
IMRHTASO DS    0H                                                       48200000
*        IMR   OPEN                                            @D31FMIS 48220000
         IMR   OPEN                                            @D31FMIS 48240000
         LTR   RF,RF        ERROR OCCURED ?                    @D31FMIS 48260000
         BZ    IMRHSTLP     NO, CONTINUE                       @D31FMIS 48280000
         LA    R5,IMROPEN   SET FUNCTION CODE, WHEN ERROR      @D31FMIS 48300000
         BAL   R2,IMRHERR   ENTER ERROR ROUTINE                @D31FMIS 48320000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     48340000
         B     IMRHSTLP     RETURN TO MAIN PATH                @D31FMIS 48360000
         SPACE 2                                                        48380000
*---------------------------------------------------------------------  48400000
* IMRHLSTO - OPEN LIST QUEUE                                            48420000
*---------------------------------------------------------------------  48440000
IMRHLSTO DS    0H                                              @D31FMIS 48460000
*        IMR   OPENLST                                         @D31FMIS 48480000
         IMR   OPENLST                                         @D31FMIS 48500000
         LTR   RF,RF        ERROR OCCURED ?                    @D31FMIS 48520000
         BZ    IMRHLST1     NO, RETURN TO MAIN PATH            @D31FMIS 48540000
         LA    R5,IMROPLST  SET FUNCTION CODE                  @D31FMIS 48560000
IMRHPU1O DS    0H                                              @D31FMIS 48580000
         BAL   R2,IMRHERR   ENTER ERROR ROUTINE                @D31FMIS 48600000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     48620000
*        B     IMRHLSTE     DEACTIVATE LIST  RETRIEVAL         @D31FMIS 48640000
         EJECT ,                                                        48660000
*---------------------------------------------------------------------  48680000
* IMRHLSTE - DEACTIVATE LIST  QUEUE RETRIEVAL                           48700000
*---------------------------------------------------------------------  48720000
IMRHLSTE DS    0H                                              @D31FMIS 48740000
         TM    MSSMONS2,MSSPNETC COMMUNICATION ESTABLISHED ?   @D31FMIS 48760000
         BZ    IMRHPU0E     NO, SKIP CLOSE PROCESS             @D31FMIS 48780000
*        IMR   CLOSELST                                        @D31FMIS 48800000
         IMR   CLOSELST                                        @D31FMIS 48820000
         LTR   RF,RF        ERROR OCCURED ?                    @D31FMIS 48840000
         BZ    IMRHPU0E     NO, CONTINUE                       @D31FMIS 48860000
         LA    R5,IMRCLLST  SET FUNCTION CODE                  @D31FMIS 48880000
         BAL   R2,IMRHERR   ENTER ERROR ROUTINE                @D31FMIS 48900000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     48920000
IMRHPU0E DS    0H                                              @D31FMIS 48940000
         NI    MSSMONS2,XFF-MSSPNET-MSSPNETC-MSSPNETD RESET    @D31FMIS 48960000
         LA    R5,IMRELST   SET FUNCTION CODE                  @D31FMIS 48980000
         BAL   R2,IMRHERR   ENTER ERROR ROUTINE                @D31FMIS 49000000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     49020000
         TM    MSSMONST,MSSOFF IAF INACTIVE ?                  @D31FMIS 49040000
         BZ    IMRHSTLP     NO, CHECK IF BUFFERS AVAIL.        @D31FMIS 49060000
         B     IMRHEOTR     DEACTIVATE SYSTEM TASK             @D31FMIS 49080000
*SGLINK  IMRHEOTR,INPUT=(R3,R6,RD)                                      49100000
         SPACE 2                                                        49120000
*---------------------------------------------------------------------  49140000
* IMRHLSTW - WAIT A TIME PERIOD AND START RETRIEVAL AGAIN               49160000
*---------------------------------------------------------------------  49180000
IMRHLSTW DS    0H                                              @D31FMIS 49200000
         TM    MSSMONS2,MSSPNETD DEACTIVATION IN PROCESS ?     @D31FMIS 49220000
         BO    IMRHLSTE     YES, DEACTIVATE SYSTEM TASK        @D31FMIS 49240000
         L     R1,IMRHTIM2  GET TIME INTERVAL ...              @D31FMIS 49260000
         LA    R0,IMRHECB   GET ECB ADDRESS                    @D31FMIS 49280000
         SVC   24           SET TIME INTERVAL                  @D31FMIS 49300000
*        WAIT  (1)           ... AND WAIT TO BE POSTED         @D31FMIS 49320000
         WAIT  (1)                                             @D31FMIS 49340000
         B     IMRHSTLP     CHECK IF BUFFERS AVAILABLE         @D31FMIS 49360000
         DROP  R3                                                       49380000
         DROP  RD                                                       49400000
         EJECT ,                                                        49420000
         EJECT ,                                                        50080000
         USING IMRHTASK,R3                                              50100000
**********************************************************************  50120000
* IMRHWRIT - 1) OPENS THE IMR FILE (IF NOT YET DONE),                   50140000
*            2) WRITES THE FULL BUFFER TO THE IMR FILE,                 50160000
*            3) POSTS THE IDB MANAGER (IF NECESSARY) AND                50180000
*            4) FREES IT AFTERWARDS                                     50200000
*            INPUT:                                                     50220000
*              R1 - BUFFER DESCRIPTOR ADDRESS                           50240000
*              R3 - BASE REGISTER                                       50260000
*              R6 - DISPATCHER BASE ADDRESS                             50280000
*              R8 - RETURN REGISTER                                     50300000
*              RD - ADDRESS OF IVMCIMSS                                 50320000
*            OUTPUT:                                                    50340000
*              R1 - BUFFER DESCRIPTOR POINTER (IN CASE OF ERROR ONLY)   50360000
*                   0 OTHERWISE                                         50380000
*              R5 - FUNCTION CODE FOR ERROR (MESSAGE) ROUTINE           50400000
*              RF - RETURN CODE                                         50420000
*            WORK:                                                      50440000
*              R0, R2, R4, R7, R9, RE                                   50460000
**********************************************************************  50480000
         USING IVMENTRY,RD                                              50500000
*SGLINK IMRHWRIT,S,INPUT=(R1,R3,R6,R8,RD),OUTPUT=(R1,R5,RF),           X50520000
               WORK=(R0,R2,R4,R7,R9,RE)                                 50540000
IMRHWRIT DS    0F                                                       50560000
         LR    R9,R1        SAVE BUFFER DESCRIPTOR ADDRESS              50580000
         USING BUFDESCR,R9                                              50600000
         L     R1,BUFPTR    GET BUFFER ADDRESS                          50620000
         DROP  R9                                                       50640000
*---------------------------------------------------------------------  50660000
*          - WRITE BUFFER TO IMR FILE                                   50680000
*---------------------------------------------------------------------  50700000
*        IMR   PUT,BUFFER=(1)                                           50720000
         IMR   PUT,BUFFER=(1)                                           50740000
         LTR   RF,RF        ERROR OCCURED ?                             50760000
         BNZ   IMRHPTER     YES, RETURN TO CALLER                       50780000
*---------------------------------------------------------------------  50800000
*          - FREE BUFFER                                                50820000
*---------------------------------------------------------------------  50840000
         BAL   R7,IMRHFRBU  FREE BUFFER                                 50860000
*SGLINK IMRHFRBU,INPUT=(R3,R6,R7,R9,RD),WORK=(R2,R5,RE,RF)              50880000
         SLR   R1,R1        CLEAR REGISTER 1                            50900000
         BAL   R4,IMRHPOST  POST IDB ROUTINES                           50920000
*SGLINK IMRHPOST,INPUT=(R1,R3,R4,RD),OUTPUT=(R5,RF),                   X50940000
               WORK=(R0,R1,R9,RE)                                       50960000
         SLR   R1,R1        CLEAR REGISTER 1                            50980000
         BR    R8           RETURN TO CALLER                            51000000
         EJECT ,                                                        51020000
*---------------------------------------------------------------------  51040000
*          - PROCESS PUT ERROR                                          51060000
*---------------------------------------------------------------------  51080000
IMRHPTER DS    0F                                                       51100000
         LA    R5,IMRPUT    SET FUNCTION CODE                           51120000
         LR    R1,R9        RESTORE BUFFER DESCRIPTOR POINTER           51140000
         BR    R8           RETURN TO CALLER                            51160000
         DROP  RD                                                       51180000
         EJECT ,                                                        51200000
**********************************************************************  51220000
* IMRHPOST - 1) WHEN THE IDB ROUTINES ARE ALREADY ACTIVE,               51240000
*               RETURN TO THE CALLER                                    51260000
*            2) OTHERWISE IMRHPOST TRIES TO RELEASE THE                 51280000
*               IDB ROUTINE JOB FROM THE POWER RDR QUEUE VIA            51300000
*               THE ATTENTION ROUTINE INTERFACE SVC                     51320000
*            3) IMRHPOST INITIATES A MESSAGE                            51340000
*            INPUT:                                                     51360000
*              R1 - FUNCTION CODE                                       51380000
*                   0     = POST IDB ROUTINES, WHEN IMR FILE            51400000
*                           MORE THAN XX % FULL                         51420000
*                   NOT 0 = POST IDB ROUTINES UNCONDITIONALLY           51440000
*              R3 - BASE REGISTER                                       51460000
*              R4 - RETURN REGISTER                                     51480000
*              RD - IVMCIMSS ADDRESS                                    51500000
*            OUTPUT:                                                    51520000
*              R5 - MESSAGE FUNCTION CODE                               51540000
*              RF - RETURN CODE                                         51560000
*                   0 = IDB ROUTINES ACTIVE                             51580000
*                   8 = TRIED TO ACTIVATE IDB ROUTINES,                 51600000
*                       MESSAGE HAS TO BE WRITTEN.                      51620000
*            WORK:                                                      51640000
*              R0, R1, R9, RE                                           51660000
**********************************************************************  51680000
         USING IVMENTRY,RD                                              51700000
*SGLINK IMRHPOST,S,INPUT=(R1,R3,R4,RD),OUTPUT=(R5,RF),                 X51720000
               WORK=(R0,R1,R9,RE)                                       51740000
IMRHPOST DS    0F                                                       51760000
         SLR   RF,RF        SET RETURN CODE 0                           51780000
         TM    MSSSERV,MSSIDB IDB UPDATE ROUTINES ACTIVE ?              51800000
         BOR   R4           YES, RETURN TO CALLER                       51820000
         LH    R0,MSSIMRUS  GET PERCENTAGE OF USED IMR BLOCKS           51840000
         LTR   R0,R0        IMR FILE EMPTY                              51860000
         BZR   R4           YES, RETURN TO CALLER                       51880000
         TM    IJBFLG03,IJBPOWA  POWER PART. INITIALIZED ?              51900000
         BZ    IMRHPOR1     NO, DO NOT ISSUE PRELEASE COMMAND           51920000
         LTR   R1,R1        POST IDB ROUTINES UNCONDITIONALLY ?         51940000
         BNZ   IMRHPOR0     YES, TRY TO RELEASE THE IDB UPDATE JOB      51960000
         CH    R0,MSSCOND   IMR FILE MORE THAN SPEC. VALUE FULL ?       51980000
         BLR   R4           NO, RETURN TO CALLER                        52000000
IMRHPOR0 DS    0H                                                       52020000
         LA    R5,IMRPIDB   SET FUNCTION CODE FOR MESSAGE               52040000
         LA    R9,IMRHMXCT  RETRY COUNT FOR COMMAND                     52060000
         LR    RE,R1        SAVE FUNCTION CODE                          52080000
IMRHPORT DS    0H                                                       52100000
         SLR   R0,R0        SET FUNCTION CODE 0                         52120000
         LA    R1,IMRHPCMD  GET PARAMETER FIELD                         52140000
         SVC   30           EXECUTE COMMAND                             52160000
         LTR   RF,RF        COMMAND EXECUTED ?                          52180000
         BZ    IMRHPOR2     YES, RETURN TO CALLER                       52200000
         L     R1,IMRHTIME  GET TIME INTERVAL ...                       52220000
         LA    R0,IMRHECB   GET ECB ADDRESS                             52240000
         SVC   24           SET TIME INTERVAL                           52260000
*        WAIT  (1)           ... AND WAIT TO BE POSTED                  52280000
         WAIT  (1)                                                      52300000
         BCT   R9,IMRHPORT  RETRY TO ISSUE COMMAND                      52320000
IMRHPOR1 DS    0H                                                       52340000
         LA    R5,IMRPIDBN  SET FUNCTION CODE FOR MESSAGE               52360000
*---------------------------------------------------------------------  52380000
*          - WRITE MESSAGE, WHEN IMR FILE IS MORE THAN                  52400000
*            80, 85, 90, 95, 96, 97, 98, 99 PER CENT FULL.              52420000
*---------------------------------------------------------------------  52440000
IMRHPOR2 DS    0H                                                       52460000
         LA    R1,MSSCONDE  GET INITIAL PERCENTAGE VALUE                52480000
         LTR   RE,RE        POST IDB ROUTINES UNCONDITIONALLY ?         52500000
         BNZ   IMRHPOR3     RESET PERCENTAGE VALUE                      52520000
         CH    R1,MSSIMRUS  IMR FILE LESS THAN INIT. VALUE FULL ?       52540000
         BH    IMRHPOR3     YES, UPDATE PERCENTAGE FIELD                52560000
         LH    R1,MSSCOND   GET PERCENTAGE VALUE                        52580000
         LA    R1,1(,R1)    INCREASE FULL PERCENTAGE FOR NEXT MESSAGE   52600000
         CH    R1,IMRHAPC   IMR FILE ALMOST FULL ?                      52620000
         BNL   IMRHPOR3     YES, UPDATE PERCENTAGE FIELD                52640000
         LA    R1,4(,R1)    INCREASE FULL PERCENTAGE ...                52660000
IMRHPOR3 DS    0H                                                       52680000
         STH   R1,MSSCOND                        ... FOR NEXT MESSAGE   52700000
         LA    RF,8         SET RETURN CODE 8                           52720000
         BR    R4           RETURN TO CALLER                            52740000
         SPACE 4                                                        52760000
*---------------------------------------------------------------------  52780000
*          - WORK AREAS FOR IMRHPOST ROUTINE                            52800000
*---------------------------------------------------------------------  52820000
IMRHECB  TECB               ECB FOR SETTIME                             52840000
IMRHTIME DC    F'153600'    TIMER VALUE (2 SECONDS)            @D31FMIS 52860000
IMRHTIM2 DC    F'768000'    TIMER VALUE (10 SECONDS)           @D31FMIS 52880000
IMRHPCMD DC    AL2(IMRHCBLN),AL4(IMRHCBUF) PARAMETER LIST               52900000
IMRHCBUF DC    C'PRELEASE RDR,IVMIDBR' COMMAND BUFFER                   52920000
IMRHCBLN EQU   *-IMRHCBUF   LENGTH OF COMMAND BUFFER                    52940000
IMRHAPC  DC    H'95'        WRITE MESSAGE, WHEN 95 % REACHED ...        52960000
*                           ... AFTER 96, 97, 98 AND 99 %               52980000
IMRHMXCT EQU   10           RETRY COUNT FOR COMMAND                     53000000
         DROP  RD                                                       53020000
         EJECT ,                                                        53040000
**********************************************************************  53060000
* IMRHFRBU - ENQUEUES A FREE BUFFER INTO THE FREE BUFFER CHAIN          53080000
*            AND POSTS TASKS WAITING FOR A FREE BUFFER                  53100000
*            INPUT:                                                     53120000
*              R3 - BASE REGISTER                                       53140000
*              R6 - DISPATCHER BASE ADDRESS                             53160000
*              R7 - RETURN REGISTER                                     53180000
*              R9 - BUFFER DESCRIPTOR ADDRESS                           53200000
*              RD - IVMCIMSS ADDRESS                                    53220000
*            WORK:                                                      53240000
*              R2, R5, RE, RF                                           53260000
**********************************************************************  53280000
         USING IVMENTRY,RD                                              53300000
*SGLINK IMRHFRBU,S,INPUT=(R3,R6,R7,R9,RD),WORK=(R2,R5,RE,RF)            53320000
IMRHFRBU DS    0F                                                       53340000
         LA    R5,SRQIMRHF  GET ADDRESS TO RESOURCE DESCRIPTOR          53360000
         BAL   R2,IMRGATEU  OCCUPY RESOURCE                             53380000
*SGLINK  IMRGATEU,INPUT=(R2,R5,RD),WORK=(RE)                            53400000
         NOP   4(,R2)       IMRGATEU RETURNS WITH R2 + 4                53420000
         USING BUFDESCR,R9                                              53440000
         SLR   RE,RE                                                    53460000
         STH   RE,BUFPIK    RESET PARTITION ID                          53480000
         L     RE,IMRHFREE  ENQUEUE BUFFER INTO ...                     53500000
         ST    RE,BUFCHAIN           ...                                53520000
         ST    R9,IMRHFREE  ... FREE BUFFER CHAIN                       53540000
         DROP  R9                                                       53560000
         LH    RE,IMRHFRCT  INCREASE ...                                53580000
         LA    RE,1(,RE)             ...                                53600000
         STH   RE,IMRHFRCT           ... FREE BUFFER COUNT              53620000
* DO NOT CLEAR BUFFER FOR DEBUGGING PURPOSES                            53640000
         BAL   R2,IMRGATEF  FREE RESOURCE                               53660000
*SGLINK  IMRGATEF,INPUT=(R2,R5,R6,RD),WORK=(R5,RE,RF)                   53680000
         LR    RF,R7        SET RETURN FROM IMRHPWTS                    53700000
         B     IMRHPWTS     POST ANY TASKS WAITING FOR A FREE BUFFER    53720000
*SGLINK  IMRHPWTS,INPUT=(R6,RD,RF),WORK=(R5,RE)                         53740000
         DROP  RD                                                       53760000
         EJECT ,                                                        53780000
**********************************************************************  53800000
* IMRHSELB - WHEN THE FULL BUFFER QUEUE IS NOT EMPTY,                   53820000
*            IMRHSELB RETURNS THE POINTER TO A BUFFER DESCRIPTOR        53840000
*            AND DEQUEUES IT FROM THE FULL BUFFER CHAIN                 53860000
*            INPUT:                                                     53880000
*              R3 - BASE REGISTER                                       53900000
*              R6 - DISPATCHER BASE ADDRESS                             53920000
*              R7 - RETURN REGISTER                                     53940000
*              RD - ADDRESS OF IVMCIMSS                                 53960000
*            OUTPUT:                                                    53980000
*              R0 - RETURN CODE: 0 - ONE ELEMENT DEQUEUED               54000000
*                                8 - CHAIN IS EMPTY                     54020000
*              R1 - BUFFER DESCRIPTOR ADDR. (IF AVAILABLE, 0 OTHERW.)   54040000
*            WORK:                                                      54060000
*              R2, R5, RE, RF                                           54080000
**********************************************************************  54100000
         USING IVMENTRY,RD                                              54120000
*SGLINK IMRHSELB,S,INPUT=(R3,R6,R7,RD),OUTPUT=(R0,R1),                 X54140000
               WORK=(R2,R5,RE,RF)                                       54160000
IMRHSELB DS    0F                                                       54180000
*---------------------------------------------------------------------  54200000
*          - OCCUPY FULL BUFFER RESOURCE                                54220000
*---------------------------------------------------------------------  54240000
         LA    R5,SRQIMRH   RESOURCE DESCRIPTOR FOR IMR FILE REQUESTS   54260000
         BAL   R2,IMRGATEU  OCCUPY RESOURCE                             54280000
*SGLINK  IMRGATEU,INPUT=(R2,R5,RD),WORK=(RE)                            54300000
         NOP   4(,R2)       IMRGATEU RETURNS WITH R2 + 4                54320000
         LA    R0,8         SET RETURN CODE                             54340000
         L     R1,IMRHFST   GET FIRST ELEMENT                           54360000
         LTR   R1,R1        CHAIN EMPTY ?                               54380000
         BZ    IMRHSFR      FREE RESOURCE AND RETURN                    54400000
         SLR   R0,R0 SET RETURN CODE 0                                  54420000
*---------------------------------------------------------------------  54440000
*          - DEQUEUE ONE BUFFER FROM FULL BUFFER QUEUE                  54460000
*---------------------------------------------------------------------  54480000
         USING BUFDESCR,R1                                              54500000
         L     RF,BUFCHAIN  REMOVE BUFFER ...                           54520000
         ST    RF,IMRHFST            ... FROM QUEUE                     54540000
         ST    R0,BUFCHAIN  RESET CHAIN POINTER                         54560000
         DROP  R1                                                       54580000
         LH    RE,IMRHFUCT  DECREASE ...                                54600000
         BCTR  RE,0              ... FULL BUFFER ...                    54620000
         STH   RE,IMRHFUCT                   ... COUNT                  54640000
         LTR   RE,RE        ANY FULL BUFFER IN QUEUE ?                  54660000
         BNZ   IMRHSFR      YES, CONTINUE                               54680000
         ST    R0,IMRHLST   RESET POINTER TO LAST BUFDESCR              54700000
*---------------------------------------------------------------------  54720000
*          - FREE FULL BUFFER RESOURCE                                  54740000
*---------------------------------------------------------------------  54760000
IMRHSFR  DS    0H                                                       54780000
         BAL   R2,IMRGATEF  FREE FULL BUFFER RESOURCE                   54800000
*SGLINK  IMRGATEF,INPUT=(R2,R5,R6,RD),WORK=(R5,RE,RF)                   54820000
         BR    R7           RETURN TO CALLER                            54840000
         DROP  RD                                                       54860000
         EJECT ,                                                        54880000
**********************************************************************  54900000
*          - IMRH SYSTEM TASK EXIT ROUTINES                             54920000
**********************************************************************  54940000
         SPACE 2                                                        54960000
**********************************************************************  54980000
* IMRHABR  - IMRH AB EXIT ROUTINE                                       55000000
*            INPUT:                                                     55020000
*              R0 - CANCEL CODE                                         55040000
**********************************************************************  55060000
         DROP  R3                                                       55080000
IMRHABR  DS    0F           AB EXIT START LABEL                         55100000
         BALR  R4,0                                                     55120000
         USING *,R4         USE TEMPORARY BASE ...                      55140000
         L     R3,IMRHBASE  ... TO GET IMRHTASK BASE                    55160000
         DROP  R4                                                       55180000
         USING IMRHTASK,R3  ESTABLISH IMRHTASK BASE                     55200000
         L     R6,DISPAD    GET DISPATCHER BASE                         55220000
         L     RD,IJBIVMCB  GET POINTER TO SYSTEM CONTROL BLOCK         55240000
         USING IVMENTRY,RD                                              55260000
* RESET MC CLASS AND POST ANY TASKS WAITING FOR A FREE BUFFER           55280000
         BAL   RF,IMRHERMO  FORCE THE IMRH SYSTEM                       55300000
*SGLINK  IMRHERMO,INPUT=(R6,RD,RF),WORK=(R5,RE)                         55320000
         LA    R5,SRQIMRH   GET ADDRESS OF FULL BUFFER RESOURCE         55340000
         BAL   R2,IMRGATEF  FREE FULL BUFFER RESOURCE                   55360000
*SGLINK  IMRGATEF,INPUT=(R2,R5,R6,RD),WORK=(R5,RE,RF)                   55380000
         LA    R5,SRQIMRHF  GET ADDRESS OF FREE BUFFER RESOURCE         55400000
         BAL   R2,IMRGATEF  FREE FREE BUFFER RESOURCE                   55420000
*SGLINK  IMRGATEF,INPUT=(R2,R5,R6,RD),WORK=(R5,RE,RF)                   55440000
         TM    IMRHFLAG,IMRHAB SECOND ABNORMAL TERMINATION ?            55460000
         BO    IMRHABER     YES, GIVE MESSAGE AND TERMINATE             55480000
         OI    IMRHFLAG,IMRHAB SET ABNORMAL TERMINATION COND.           55500000
         LA    R5,IMRSTAB   SET MESSAGE CODE                            55520000
         BAL   R2,IMRHERRA  ENTER ERROR ROUTINE                         55540000
*SGLINK  IMRHERRA,INPUT=(R0,R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF) 55560000
         TM    IMRHFLAG,IMRHEOT ALREADY IN TERMINATION ?                55580000
         BO    IMRHAEOJ     YES, DEACTIVATE SYSTEM TASK                 55600000
         EXIT  AB           LEAVE EXIT                                  55620000
         ICM   R1,3,IMRHCOCT  TASKS IN DATA COLLECTION ?                55640000
         BNZ   IMRHDEAC     YES, DEACTIVATE SYSTEM TASK                 55660000
*SGLINK IMRHDEAC,INPUT=(R3,R6,RD)                                       55680000
         OI    IMRHFLG1,IMRHFALL ALL AREAS TO BE FREED                  55700000
         BR    R3           START SYSTEM TASK AGAIN                     55720000
         EJECT ,                                                        55740000
*---------------------------------------------------------------------  55760000
*          - HANDLE SECOND ABNORMAL TERMINATION                         55780000
*---------------------------------------------------------------------  55800000
IMRHABER DS    0H           SECOND ABNORMAL TERMINATION                 55820000
         LA    R5,IMRSTAB2  SET FUNCTION CODE                           55840000
         BAL   R2,IMRHERRA  ENTER ERROR ROUTINE                         55860000
*SGLINK  IMRHERRA,INPUT=(R0,R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF) 55880000
         OI    IMRHFLG1,IMRSEVER INDICATE SEVERE ERROR SITUATION        55900000
IMRHAEOJ DS    0H           DEACTIVATE SYSTEM TASK ...                  55920000
*                           ... BY END-OF-TASK PROCESSING               55940000
         EOJ                                                            55960000
         DROP  RD                                                       55980000
         EJECT ,                                                        56000000
**********************************************************************  56020000
* IMRHEOTR - TERMINATE SYSTEM TASK PROCESSING                           56040000
*            CALLED BY: IMRHTASK, IMRHABR                               56060000
*            INPUT:                                                     56080000
*              R3 - BASE ADDRESS OF IMRHTASK                            56100000
*              R6 - DISPATCHER ADDRESS                                  56120000
*              RD - ADDRESS OF IAF'S SYSTEM CONTROL BLOCK               56140000
**********************************************************************  56160000
         USING IVMENTRY,RD                                              56180000
*SGLINK  IMRHEOTR,S,INPUT=(R3,R6,RD)                                    56200000
IMRHEOTR DS    0H               TERMINATE SYSTEM TASK PROCESSING        56220000
         OI    IMRHFLAG,IMRHEOT INDICATE TERMINATION IN PROCESS         56240000
         TM    MSSMONS2,MSSPNET  RETRIEVAL FROM LST QUEUE ?    @D31FMIS 56260000
         BO    IMRHEOT1     YES, DON'T CLOSE IMR FILE          @D31FMIS 56280000
         TM    MSSSTATE,MSSIMROW IMR FILE OPENED FOR WRITE ?            56300000
         BZ    IMRHEOT1         DEACTIVATE SYSTEM TASK                  56320000
         LA    R1,1         POST IDB ROUTINE UNCONDITIONALLY   @D31FMIS 56340000
         BAL   R4,IMRHPOST  POST IDB ROUTINES ...              @D31FMIS 56360000
*SGLINK IMRHPOST,INPUT=(R1,R3,R4,RD),OUTPUT=(R5,RF),                   X56380000
               WORK=(R0,R1,R9,RE)                                       56400000
         LTR   RF,RF        MESSAGE TO BE WRITTEN ?            @D31FMIS 56420000
         BZ    IMRHEOT0     NO, DEACTIVATE SYSTEM TASK         @D31FMIS 56440000
         BAL   R2,IMRHERR   ENTER ERROR ROUTINE                @D31FMIS 56460000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     56480000
IMRHEOT0 DS    0H                                              @D31FMIS 56500000
*        IMR   CLOSE        CLOSE IMR FILE                              56520000
         IMR   CLOSE        CLOSE IMR FILE                              56540000
         LTR   RF,RF        ANY ERORR OCCURRED ?                        56560000
         BZ    IMRHEOT1     DEACTIVATE SYSTEM TASK                      56580000
         LA    R5,IMRCLOSE  SET FUNCTION CODE                           56600000
         BAL   R2,IMRHERR   ENTER ERROR ROUTINE                         56620000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     56640000
         EJECT ,                                                        56660000
*---------------------------------------------------------------------  56680000
* IMRHEOT1 - RESET IAF MONITORING, IF NECESSARY                         56700000
*---------------------------------------------------------------------  56720000
IMRHEOT1 DS    0H                                                       56740000
         TM    MSSMONST,MSSOFF MONITORING INACTIVE ?           @D31FMIS 56760000
         BO    IMRHEOT2     YES, DON'T RESET STATUS            @D31FMIS 56780000
         TM    IMRHFLG2,IMRHNMSG MESSAGE ALREADY WRITTEN ?     @D31FMIS 56800000
         BO    IMRHEOT2     YES, DON'T WRITE MESSAGE AGAIN     @D31FMIS 56820000
* DELAY OUTPUT OF COMPLETION MESSAGE                                    56840000
         L     R1,IMRHTIME  GET TIME INTERVAL                           56860000
         LA    R0,IMRHECB   GET ECB ADDRESS                             56880000
         SVC   24           SET TIME INTERVAL                           56900000
         WAIT  (1)           ... AND WAIT TO BE POSTED                  56920000
         NI    MSSMONS2,XFF-MSSCCSON RESET CICS MON.           @D31FMIS 56940000
         NI    MSSMONS3,XFF-MSSONALL RESET ALL REQUEST         @D31FMIS 56960000
         LA    R5,IMREMON   SET FUNCTION CODE                  @D31FMIS 56980000
         BAL   R2,IMRHERR   ENTER ERROR ROUTINE                @D31FMIS 57000000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     57020000
         OI    IMRHFLG2,IMRHNMSG INDICATE IAF INACT. MSG WRITT.@D31FMIS 57040000
IMRHEOT2 DS    0H                                              @D31FMIS 57060000
         TM    MSSMONS2,MSSPNET  RETRIEVAL FROM LST QUEUE ?    @D31FMIS 57080000
         BO    IMRHEOTP     YES, DON'T DEACTIVATE SYSTEM TASK  @D31FMIS 57100000
         LA    R5,IMREOT    SET FUNCTION CODE                           57120000
         BAL   R2,IMRHERR   ENTER ERROR ROUTINE                         57140000
*SGLINK  IMRHERR,INPUT=(R2,R5,R6,RD,RF),WORK=(R5,R8,RE),OUTPUT=(RF)     57160000
*                           DEACTIVATE SYSTEM TASK ...                  57180000
*                           ... BY END-OF-TASK PROCESSING               57200000
         EOJ                                                            57220000
         SPACE 2                                                        57240000
*---------------------------------------------------------------------  57260000
* IMRHEOTP - RESET IAF MONITORING                                       57280000
*---------------------------------------------------------------------  57300000
IMRHEOTP DS    0H                                              @D31FMIS 57320000
         MVI   IMRHFLG1,ZERO   RESET BUFFER PROC. STATE        @D31FMIS 57340000
         TM    MSSMONST,MSSFORCE MONITORING IN FORCED STATE ?  @D31FMIS 57360000
         BO    IMRHLSTE     YES, DEACTIVATE LIST  QUEUE RETRIEV@D31FMIS 57380000
         MVI   MSSMONST,MSSOFF CLEAR MONITOR STATE BYTE        @D31FMIS 57400000
         NI    IMRHFLG2,XFF-IMRHNMSG RESET INDICATION          @D31FMIS 57420000
         B     IMRHLSTW     RETURN TO LIST  RETRIEVAL          @D31FMIS 57440000
         DROP  RD                                                       57460000
         EJECT ,                                                        57480000
**********************************************************************  57500000
* IMRSTADR - IMRH END OF SYSTEM TASK ROUTINE                            57520000
*            CALLED AFTER END-OF-TASK ROUTINE                           57540000
*            AND DEACTIVATES THE SYSTEM TASK AND TRIES TO               57560000
*            START IT AGAIN AFTER A NEW ACTIVATION                      57580000
**********************************************************************  57600000
IMRSTADR DS    0H               END-OF-SYSTEM-TASK ROUTINE              57620000
         DROP  R3                                                       57640000
         MVI   RID+1,USERTID    SET USER RID                            57660000
         BALR  R4,0             ESTABLISH BASE ADDRESS                  57680000
         USING *,R4                                                     57700000
         L     R3,IMRHBASE      GET IMRH BASE ADDRESS                   57720000
         DROP  R4                                                       57740000
         USING IMRHTASK,R3                                              57760000
         L     RD,IJBIVMCB  GET POINTER TO SYSTEM CONTROL BLOCK         57780000
         USING IVMENTRY,RD                                              57800000
         TM    IMRHFLG1,IMRSEVER SEVERE ERROR OCCURRED ?                57820000
         BO    IMRSTAD0        YES, DO NOT CLEAR MON. STATE             57840000
         MVI   MSSMONST,MSSOFF CLEAR MONITOR STATE BYTE                 57860000
         MVI   MSSMONS2,ZERO   CLEAR MONITOR STATE BYTE 2      @D31FMIS 57880000
         MVI   MSSMONS3,ZERO   CLEAR MONITOR STATE BYTE 3      @D51IDIS 57900000
IMRSTAD0 DS    0H                                                       57920000
         NI    IMRHFLG2,XFF-IMRHNMSG RESET INDICATION          @D31FMIS 57940000
         NI    IMRHFLAG,XFF-IMRHSFL CLEAR STATE FLAG                    57960000
         MVI   IMRHFLG1,ZERO    CLEAR FLAGS                             57980000
         MVI   IMRHIERR,ZERO    CLEAR FLAGS                             58000000
         SLR   R0,R0            CLEAR REGISTER                          58020000
         ST    R0,IMRHBMON      CLEAR BIT STRING                        58040000
         DROP  RD                                                       58060000
         TSTOP ,                DEACTIVATE SYSTEM TASK                  58080000
         DROP  R3                                                       58100000
         BALR  R4,0             ESTABLISH BASE ADDRESS                  58120000
         USING *,R4                                                     58140000
         L     R3,IMRHBASE      GET IMRH BASE ADDRESS                   58160000
         DROP  R4                                                       58180000
         BR    R3               ACTIVATE SYSTEM TASK                    58200000
         SPACE 4                                                        58220000
**********************************************************************  58240000
*         - IMRHTASK BASE ADDRESS                                       58260000
**********************************************************************  58280000
         USING IMRHTASK,R3                                              58300000
IMRHBASE DC    A(IMRHTASK)  IMRHTASK ROUTINES' BASE ADDRESS             58320000
IMRHABSV DS    CL72         IMRHTASK AB EXIT SAVE AREA                  58340000
         DROP  R3                                                       58360000
**********************************************************************  58364061
* SVC117   - NO LONGER SUPPORTED                                        58366061
**********************************************************************  58368061
         USING DISP,R6                                                  58370061
SVC117   DS    0F                                              @D61NDIS 58372061
         B     ERR21        YES, ILLEGAL SVC                   @D61NDIS 58374061
         DROP  R6                                              @D61NDIS 58376061
         EJECT ,                                                        58380000
**********************************************************************  58400000
* SVC117   - THE IAF SVC IS CALLED FOR                                  58420000
*            1) ACTIVATION, DEACTIVATION AND DISPLAY OF IAF             58440000
*               REQUESTED BY AN INVENT COMMAND OR                       58460000
*               IVMIGR CONTROL STATEMENT: INVENT     (FC = 0)           58480000
*               INPUT:                                                  58500000
*                 R1  - POINTER TO PARAMETER LIST                       58520000
*            2) IMR FILE ROUTINE REQUESTS            (FC = 1 - 9)       58540000
*               INPUT:                                                  58560000
*                 R1 - BUFFER ADDRESS                                   58580000
*            3) MONITOR STATE OF A PARTITION         (FC < 0)           58600000
*               (NO LONGER SUPPORTED: HANDELED BY MONITOR CALL)         58620000
*            COMMON REGISTERS:                                          58640000
*            INPUT:                                                     58660000
*              R6  - DISPATCHER BASE ADDRESS                            58680000
*              RB  - SAVE AREA ADDRESS                                  58700000
*              RC  - BASE REGISTER                                      58720000
*              RF  - FUNCTION CODE                                      58740000
*            OUTPUT:                                                    58760000
*              RETURN CODE (PP SAVE AREA)                               58780000
*                DESCRIBED IN S117ER.. ROUTINE                          58800000
**********************************************************************  58820000
         USING SVC117,RC                                                58840000
SVC117   DS    0F                                                       58860000
         L     RA,ASVASVDL  GET SUPERV. SUBDIRECTORY TABLE ADDR.        58880000
         USING SVASVDL,RA                                               58900000
         L     R5,AIVMPIMD  GET ENTRY POINT OF IVMPIMDC PHASE           58920000
         L     RA,AIVMPISV  GET ENTRY POINT OF IVMPISVA PHASE           58940000
         DROP  RA                                                       58960000
         L     RD,IJBIVMCB  GET IVMCIMSS CONTROL BLOCK                  58980000
         USING IVMENTRY,RD                                              59000000
         LTR   RA,RA        IVMPISVA PHASE AVAILABLE ?                  59020000
         BZ    S117ER48     NO, SET RETURN CODE AND RETURN              59040000
         LTR   R5,R5        IVMPIMDC PHASE AVAILABLE ?                  59060000
         BZ    S117ER48     NO, SET RETURN CODE AND RETURN              59080000
*SGLINK  S117ER48,INPUT=(R6,RB,RC,RD,RF)                                59100000
         USING DISP,R6                                                  59120000
         LTR   RF,RF        FUNCTION CODE NEGATIVE ?                    59140000
         BZ    S117INV      ZERO, PROCESS INVENT REQUEST                59160000
*SGLINK  S117INV,INPUT=(R1,R6,RA,RB,RC,RD)                              59180000
         BM    ERR21        YES, ILLEGAL SVC                            59200000
         LA    R5,IMRTID   GET TASK ID OF SYSTEM TASK                   59220000
         LH    R0,TID      GET CURRENT TASK ID                          59240000
         CR    R5,R0       REQUEST FROM SYSTEM TASK ?                   59260000
         BE    S117IMRS    YES, CONTINUE                                59280000
         CH    R0,MSSIDBT  CALLED BY IDB UPDATE ROUTINES ?              59300000
         BNE   ERR21       NO, ILLEGAL SVC                              59320000
S117IMRS DS    0H                                                       59340000
         CH    RF,FUNC08   RETURN FROM IVMPISVA ROUTINE ?               59360000
         BE    S117IMRR    YES, SWAP SAVE AREAS AND RETURN TO USER      59380000
         CH    RF,HIGHFC   VALID FUNCTION CODE ?                        59400000
         BH    ERR21       NO, ILLEGAL SVC                              59420000
         DROP  R6                                                       59440000
         DROP  RD                                                       59460000
         EJECT ,                                                        59480000
**********************************************************************  59500000
* S117IMR  - PROCESS IMR FILE ROUTINE REQUEST                           59520000
*            INPUT:                                                     59540000
*              R0  - CURRENT TASK ID                                    59560000
*              R1  - BUFFER ADDRESS                                     59580000
*              R6  - DISPATCHER BASE ADDRESS                            59600000
*              R8  - CURRENT TIB ADDRESS                                59620000
*              RA  - ENTRY POINT OF SVA PHASE                           59640000
*              RB  - PP SAVE AREA                                       59660000
*              RC  - BASE REGISTER                                      59680000
*              RD  - ADDRESS OF IVMCIMSS                                59700000
*              RF  - FUNCTION CODE                                      59720000
**********************************************************************  59740000
         USING IVMENTRY,RD                                              59760000
S117IMR  DS    0H                                                       59780000
         LA    R5,SRQIMR    RESOURCE DESCRIPTOR FOR IMR FILE REQUESTS   59800000
         BAL   R2,IMRGATEU  OCCUPY RESOURCE                             59820000
*SGLINK  IMRGATEU,INPUT=(R2,R5,RD),WORK=(RE)                            59840000
         NOP   4(,R2)       IMRGATEU RETURNS WITH R2 + 4                59860000
         LA    R5,IMRTID    GET TID OF SYSTEM TASK                      59880000
         CR    R5,R0        REQUEST FROM SYSTEM TASK ?                  59900000
         BE    S117IMR1     YES, CONTINUE                               59920000
         USING TIBADR,R8                                                59940000
         OI    TIBFLAG1,SYSACT SYSTEM CODE ACTIVE                       59960000
         DROP  R8                                                       59980000
S117IMR1 DS    0H                                                       60000000
         USING IVMCIPHD,RA                                              60020000
         L     R2,PHDIMRSV  GET SAVE AREA OF IVMPIIMR ROUTINE           60040000
         ST    RB,0(,R2)    SAVE CURRENT SAVE AREA                      60060000
         ST    RB,IMRHUSAV  SAVE CURRENT SAVE AREA                      60080000
         LA    R2,8(,R2)    POINT TO NEW SAVE AREA                      60100000
         L     RB,TCBPTR    GET CURRENT TCB POINTER                     60120000
         USING TCBADR,RB                                                60140000
         ST    R2,TCBSAVE   SET NEW SAVE AREA                           60160000
         OI    TCBIVMHK,TCBHKIOA INDICATE IMR FILE I/O ACTIVE           60180000
         DROP  RB                                                       60200000
         USING SVEARA,R2                                                60220000
         ST    R0,SVER00    STORE CURRENT TASK ID                       60240000
         ST    R1,SVER01    STORE BUFFER ADDRESS                        60260000
         L     RA,PHDIMRRT  GET IMR I/O HANDLER ADDRESS                 60280000
         DROP  RA                                                       60300000
         ST    RA,SVER0A    STORE IVMPIIMR ENTRY POINT                  60320000
         ST    RD,SVER0D    STORE IVMCIMSS ADDRESS                      60340000
         ST    RF,SVER0F    STORE FUNCTION CODE                         60360000
         L     RB,APBASE    GET SGAP BASE ADDRESS                       60380000
         USING SGAP,RB                                                  60400000
         MVC   SVEPSW(4),PSWFRAME COPY STANDARD PSW FRAME               60420000
         DROP  RB                                                       60440000
         L     R5,PCBPTR    GET CURRENT PCB POINTER                     60460000
         USING PCBADR,R5                                                60480000
         TM    PCBFLAG,PERACT  PER BIT IN PCBFLAG SET ?                 60500000
         BZ    S117IMRN     NO, CONTINUE                                60520000
         OI    SVEPSW,PERMASK ENABLE PROGRAM EVENT RECORDING            60540000
S117IMRN DS    0H                                                       60560000
         ST    RA,SVEPSW2   SET IVMPIIMR ENTRY POINT                    60580000
         EJECT ,                                                        60600000
*---------------------------------------------------------------------  60620000
*                CALL IVMPIIMR ROUTINE VIA DISPATCHER                   60640000
*                INPUT:                                                 60660000
*                  R0 - CURRENT TASK ID                                 60680000
*                  R1 - BUFFER ADDRESS                                  60700000
*                  RA - ENTRY POINT OF IVMPIIMR                         60720000
*                  RD - ADDRESS OF IVMCIMSS                             60740000
*                  RF - FUNCTION VALUE                                  60760000
*                OUTPUT:                                                60780000
*                  RF - RETURN CODE                                     60800000
*                       (IN IVMPIIMR SAVE AREA)                         60820000
*                       0 - REQUEST SUCCESSFUL                          60840000
*                       4 - END-OF-FILE                                 60860000
*                       8 - MACRO OR I/O ERROR                          60880000
*                      12 - PROCESSING ERROR (SEE IVMPIIMR RET.CODES)   60900000
*                      16 - INVALID STATE (REQUEST IGNORED)             60920000
*---------------------------------------------------------------------  60940000
         BR    R6           ENTER DISPATCHER                            60960000
         DROP  R2                                                       60980000
         DROP  R5                                                       61000000
         DROP  RD                                                       61020000
         EJECT ,                                                        61040000
**********************************************************************  61060000
* S117IMRR - RETURN FROM IVMPIIMR ROUTINE                               61080000
*            SWAP SAVE AREAS AND RETURN TO DISPATCHER                   61100000
*            INPUT:                                                     61120000
*              R0  - CURRENT TASK ID                                    61140000
*              R1  - RETURN CODE OF IVMPIIMR ROUTINE                    61160000
*              R6  - DISPATCHER BASE ADDRESS                            61180000
*              R8  - CURRENT TIB ADDRESS                                61200000
*              RC  - BASE REGISTER                                      61220000
*              RD  - ADDRESS OF IVMCIMSS                                61240000
**********************************************************************  61260000
         USING IVMENTRY,RD                                              61280000
         USING DISP,R6                                                  61300000
S117IMRR DS    0H                                                       61320000
         LA    R5,IMRTID    GET TID OF SYSTEM TASK                      61340000
         CR    R5,R0        REQUEST FROM SYSTEM TASK ?                  61360000
         BE    S117IMR2     YES, CONTINUE                               61380000
         USING TIBADR,R8                                                61400000
         NI    TIBFLAG1,XFF-SYSACT RESET SYSTEM CODE ACTIVE             61420000
         DROP  R8                                                       61440000
S117IMR2 DS    0H                                                       61460000
         L     RA,TCBPTR    GET TCB POINTER                             61480000
         USING TCBADR,RA                                                61500000
         TM    TCBIVMHK,TCBHKIOA IMR FILE I/O ACTIVE ?                  61520000
         BZ    ERR21        NO, ILLEGAL SVC                             61540000
         LR    R2,R6        RETURN TO DISPATCHER AFTER IMRHRTIO         61560000
         L     RB,IMRHUSAV  GET USER'S SAVE AREA                        61580000
         USING SVEARA,RB                                                61600000
         ST    R1,SVER0F    STORE RETURN CODE                           61620000
         DROP  RB                                                       61640000
         B     IMRHRTIO     POST ANY WAITERS AND SWITCH SAVE AREAS      61660000
*SGLINK  IMRHRTIO,INPUT=(R2,R6,RA,RD),WORK=(R5,RE,RF)                   61680000
         DROP  R6                                                       61700000
         DROP  RA                                                       61720000
         DROP  RD                                                       61740000
         SPACE 2                                                        61760000
*---------------------------------------------------------------------  61780000
*          - WORK AREAS FOR IMR FILE REQUESTS                           61800000
*---------------------------------------------------------------------  61820000
FUNC08   DC    H'8'         FUNCTION CODE 8 (RETURN FROM IVMPIIMR)      61840000
HIGHFC   DC    H'12'        HIGHEST POSSIBLE FUNCTION CODE     @D31FMIS 61860000
S117MAST DC    CL1'Y'       MASTER NODE INDICATION             @D31FMIS 61880000
         EJECT ,                                                        61900000
**********************************************************************  61920000
* S117INV  - PROCESS INVENT REQUEST                                     61940000
*            INPUT:                                                     61960000
*              R1  - POINTER TO PARAMETER LIST                          61980000
*              R6  - DISPATCHER BASE ADDRESS                            62000000
*              RA  - ENTRY POINT OF SVA PHASE                           62020000
*              RB  - PP SAVE AREA                                       62040000
*              RC  - BASE REGISTER                                      62060000
*              RD  - ADDRESS OF IVMCIMSS                                62080000
**********************************************************************  62100000
         USING IVMENTRY,RD                                              62120000
*SGLINK  S117INV,S,INPUT=(R1,R6,RA,RB,RC,RD)                            62140000
S117INV  DS    0F                                                       62160000
         LH    R2,TID       GET CURRENT TASK ID                         62180000
         CH    R2,ARTIDH    REQUEST FROM ATTENTION ROUTINE ?            62200000
         BE    S117INGO     YES, CONTINUE                               62220000
         USING DISP,R6                                                  62240000
         TM    MSSSERV,MSSIGRA REQUEST FROM IVMIGR ?                    62260000
         BZ    ERR21        NO, ILLEGAL SVC                             62280000
         CH    R2,MSSIGRAT CALLED BY IVMIGR UTILITY ?                   62300000
         BNE   ERR21       NO, ILLEGAL SVC                              62320000
S117INGO DS    0H                                                       62340000
         TM    IMRHFLAG,IMRHINVA INVENT PROCESSING ALREADY ACTIVE ?     62360000
         BO    S117ER08     YES, SET RETURN CODE AND RETURN             62380000
*SGLINK  S117ER08,INPUT=(R6,RB,RC)                                      62400000
         OI    IMRHFLAG,IMRHINVA INDICATE INVENT PROCESSING ACTIVE      62420000
*---------------------------------------------------------------------  62440000
*          - PARAMETER LIST VALIDATION                                  62460000
*---------------------------------------------------------------------  62480000
         LA    R2,PRMLEN-1  GET LENGTH OF PARAMETER LIST - 1            62500000
         AR    R2,R1        CALC. END ADDRESS                           62520000
         LA    RF,S117ER16  INDICATE ADDRESS OF PARAMETER LIST INVALID  62540000
         BAL   R8,VALIDAD   VALIDATE PARAMETER LIST                     62560000
*SGLINK  VALIDAD,INPUT=(R1,R2,R6,R8),WORK=(R2),OUTPUT=(R5)              62580000
         B     S117RGSV     INVALID ADDRESS, SET RETURN CODE            62600000
         B     S117RGSV     INVALID ADDRESS, SET RETURN CODE            62620000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                62640000
         LR    R3,R1        SAVE PARAMATER LIST                         62660000
         EJECT ,                                                        62680000
*------------------------------------------------------------- @D31FMIS 62700000
*          - VALIDATION OF RELEASE 2 PARAMETER LIST            @D31FMIS 62720000
*------------------------------------------------------------- @D31FMIS 62740000
         USING INVPARML,R3                                     @D31FMIS 62760000
         TM    PRMLOPC,PRMREL2 RELEASE 2 REQUEST ?             @D31FMIS 62780000
         BZ    S117ING1        NO, PROCESS AS RELEASE 1        @D31FMIS 62800000
         LA    R2,PRMLEN2-1 GET LENGTH OF PARAMETER LIST - 1   @D31FMIS 62820000
         AR    R2,R1        CALC. END ADDRESS                  @D31FMIS 62840000
         LA    RF,S117ER16  IND. ADDRESS OF PARAMETER LIST INV.@D31FMIS 62860000
         BAL   R8,VALIDAD   VALIDATE PARAMETER LIST            @D31FMIS 62880000
*SGLINK  VALIDAD,INPUT=(R1,R2,R6,R8),WORK=(R2),OUTPUT=(R5)     @D31FMIS 62900000
         B     S117RGSV     INVALID ADDRESS, SET RETURN CODE   @D31FMIS 62920000
         B     S117RGSV     INVALID ADDRESS, SET RETURN CODE   @D31FMIS 62940000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                       @D31FMIS 62960000
         L     R5,ASVASVDL  GET SUPERV. SUBDIRECTORY TABLE ADDR@D31FMIS 62980000
         USING SVASVDL,R5                                      @D31FMIS 63000000
         OI    PRMSTAT2,PRMCONF INDICATE IVMPLMV NOT FOUND     @D31FMIS 63020000
         LA    RF,S117EA48  IND. ADDRESS NOT AVAILABLE         @D31FMIS 63040000
         ICM   R5,15,AIVMPLMV  GET ENTRY POINT OF IVMPLMV PHASE@D31FMIS 63060000
         BZ    S117RGSV     NO, SET RETURN CODE AND RETURN     @D31FMIS 63080000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                       @D31FMIS 63100000
         DROP  R5                                              @D31FMIS 63120000
         NI    PRMSTAT2,XFF-PRMCONF RESET INDICATOR            @D31FMIS 63140000
         ST    R5,MSSCONF   SAVE ENTRY POINT ADDRESS           @D31FMIS 63160000
         USING IVMCCONF,R5                                     @D31FMIS 63180000
         MVC   MSSNODE,CONFONOD UPDATE NODE ID                 @D31FMIS 63200000
         TM    PRMLOPC2,PRMCICON+PRMCICOF CICS MONITORING REQ.?@D31FMIS 63220000
         BNZ   S117CICS     YES, PROCESS REQUEST               @D31FMIS 63240000
         NI    MSSMONS2,XFF-MSSSLAVE RESET SLAVE INDICATION    @D31FMIS 63260000
         CLC   CONFPM,S117MAST MASTER NODE ?                   @D31FMIS 63280000
         BE    S117ING0     YES, DO NOT SAVE SLAVE INFO.       @D31FMIS 63300000
         CLI   CONFPM,X'40' NOT SLAVE, NOT MASTER ?            @D31FMIS 63320000
         BE    S117ING0     YES, DO NOT SAVE SLAVE INFO.       @D31FMIS 63340000
         OI    MSSMONS2,MSSSLAVE SET SLAVE INDICATION          @D31FMIS 63360000
         OI    PRMSTAT2,PRMSLAVE SET SLAVE INDICATION          @D31FMIS 63380000
         MVC   PRMSNODE,CONFSNOD MOVE RECEIVING NODE ID        @D31FMIS 63400000
         MVC   PRMSCLAS,CONFCCL  MOVE LST CLASS OF REC. NODE   @D31FMIS 63420000
         DROP  R5                                              @D31FMIS 63440000
S117ING0 DS    0H                                              @D31FMIS 63460000
         TM    PRMLOPC2,PRMIMRON+PRMIMROF IMR=ON|OFF REQUEST ? @D31FMIS 63480000
         BNZ   S117LST      YES, PROCESS REQUEST               @D31FMIS 63500000
         EJECT ,                                                        63520000
*---------------------------------------------------------------------  63540000
*          - BUFFER VALIDATION                                          63560000
*---------------------------------------------------------------------  63580000
         LA    RF,S117ER20  INDICATE ADDRESS OF BUFFER MISSING @D31FMIS 63600000
         ICM   R1,15,PRMCICPT GET ADDR. OF CICS BUFF., AVAIL.? @D31FMIS 63605000
         BZ    S117RGSV     NO,  SET RETURN CODE AND RETURN    @D31FMIS 63610000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                       @D31FMIS 63615000
         ICM   R1,15,PRMACTPT GET ADDRESS OF BUFFER, AVAIL. ?  @D31FMIS 63620000
         BZ    S117RGSV     NO,  SET RETURN CODE AND RETURN    @D31FMIS 63640000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                       @D31FMIS 63660000
         ICM   R1,15,PRMDAPT GET ADDRESS OF 2. BUFFER, AVAIL. ?@D31FMIS 63680000
         BZ    S117RGSV     NO,  SET RETURN CODE AND RETURN    @D31FMIS 63700000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                       @D31FMIS 63720000
         ICM   R1,15,PRMARPT GET ADDRESS OF 1. BUFFER, AVAIL. ?@D31FMIS 63740000
         BZ    S117RGSV     NO,  SET RETURN CODE AND RETURN    @D31FMIS 63760000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                       @D31FMIS 63780000
         LA    R2,8*&NUM-1  CALCULATE MAX. LENGTH OF BUFFER    @D31FMIS 63800000
         AR    R2,R1        CALC. END ADDRESS                  @D31FMIS 63820000
         LA    RF,S117ER16  INDICATE PARAMETER LIST INVALID    @D31FMIS 63840000
         BAL   R8,VALIDAD   VALIDATE PARAMETER LIST            @D31FMIS 63860000
*SGLINK  VALIDAD,INPUT=(R1,R2,R6,R8),WORK=(R2),OUTPUT=(R5)     @D31FMIS 63880000
         B     S117RGSV     INVALID ADDRESS, SET RETURN CODE   @D31FMIS 63900000
         B     S117RGSV     INVALID ADDRESS, SET RETURN CODE   @D31FMIS 63920000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                       @D31FMIS 63940000
         LA    R2,8*&NUM-1+PRMLEN2 GET TOTAL INPUT LENGTH      @D31FMIS 63960000
         AR    R2,R3        CALC. END ADDRESS                  @D31FMIS 63980000
         CLC   0(1,R3),0(R2) BRING AREA INTO STORAGE           @D31FMIS 64000000
         B     S117ING2     CONTINUE PROCESSING                @D31FMIS 64020000
         EJECT ,                                                        64040000
*---------------------------------------------------------------------  64060000
*            **** RELEASE 1 BUFFER VALIDATION ****                      64080000
* S117ING1 - VALIDATION FOR FIRST SYSLOG ID BUFFER                      64100000
*---------------------------------------------------------------------  64120000
S117ING1 DS    0H                                              @D31FMIS 64140000
         LA    RF,S117ER20  INDICATE ADDRESS OF BUFFER MISSING          64160000
         L     R1,PRMARPT   GET ADDRESS OF SYSLOG ID BUFFER             64180000
         LTR   R1,R1        FIRST SYSLOG ID BUFFER ADDRESS MISSING ?    64200000
         BZ    S117RGSV     YES, SET RETURN CODE AND RETURN             64220000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                64240000
         LA    R2,2*&NPART-1 CALCULATE MAX. LENGTH OF BUFFER            64260000
         AR    R2,R1        CALC. END ADDRESS                           64280000
         LA    RF,S117ER16  INDICATE PARAMETER LIST INVALID             64300000
         BAL   R8,VALIDAD   VALIDATE PARAMETER LIST                     64320000
*SGLINK  VALIDAD,INPUT=(R1,R2,R6,R8),WORK=(R2),OUTPUT=(R5)              64340000
         B     S117RGSV     INVALID ADDRESS, SET RETURN CODE            64360000
         B     S117RGSV     INVALID ADDRESS, SET RETURN CODE            64380000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                64400000
*---------------------------------------------------------------------  64420000
*          - VALIDATION FOR SECOND SYSLOG ID BUFFER                     64440000
*---------------------------------------------------------------------  64460000
         LA    RF,S117ER20  INDICATE ADDRESS OF BUFFER MISSING          64480000
         L     R1,PRMDAPT   GET SECOND SYSLOG ID BUFFER                 64500000
         LTR   R1,R1        SECOND SYSLOG ID BUFFER SPECIFIED ?         64520000
         BZ    S117RGSV     NO, SET RETURN CODE AND RETURN              64540000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                64560000
         LA    R2,2*&NPART-1 CALCULATE MAX. LENGTH OF BUFFER            64580000
         AR    R2,R1        CALC. END ADDRESS                           64600000
         LA    RF,S117ER16  INDICATE PARAMETER LIST INVALID             64620000
         BAL   R8,VALIDAD   VALIDATE PARAMETER LIST                     64640000
*SGLINK  VALIDAD,INPUT=(R1,R2,R6,R8),WORK=(R2),OUTPUT=(R5)              64660000
         DROP  R6                                                       64680000
         B     S117RGSV     INVALID ADDRESS, SET RETURN CODE            64700000
         B     S117RGSV     INVALID ADDRESS, SET RETURN CODE            64720000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                64740000
         L     R1,PRMARPT   RELOAD FIRST BUFFER ADDRESS                 64760000
         EJECT ,                                                        64780000
*---------------------------------------------------------------------  64800000
* S117ING2 - VALIDATION OF INVENT REQUEST                               64820000
*---------------------------------------------------------------------  64840000
S117ING2 DS    0H                                              @D31FMIS 64860000
         TM    PRMLOPC,PRMALL INVENT OPERATION REQUESTED ?              64880000
         BZ    S117RGSV     SET RETURN CODE AND RETURN                  64900000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                64920000
         TM    PRMLOPC,PRMONPA+PRMONNP PARTIAL ACTIVATION ?             64940000
         BZ    S117IVAL     NO, CONTINUE                                64960000
         LH    R4,PRMLACT   GET NUMBER OF SYSLOG IDS                    64980000
         LTR   R4,R4        ZERO ?                                      65000000
         BZ    S117RGSV     YES, SET RETURN CODE AND RETURN             65020000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                65040000
S117IVAL DS    0H                                                       65060000
         TM    PRMLOPC,PRMFORCE FORCED DEACTIVATION REQUESTED ?         65080000
         BO    S117INNO     YES, PROCESS REQUEST                        65100000
         LA    RF,S117ER32  INDICATE ABNORMAL TERMINATION PENDING       65120000
         TM    MSSMONST,MSSFORCE MONITORING IN FORCED STATE ?           65140000
         BO    S117RGSV     YES, SET RETURN CODE AND RETURN             65160000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                65180000
         TM    PRMLOPC,PRMDISPL DISPLAY REQUEST ?                       65200000
         BO    S117DISP        YES, PROCESS DISPLAY REQUEST             65220000
         DROP  R3                                                       65240000
         LA    RF,S117ER12  INDICATE DELAYED DEACTIVATION IN PROC.      65260000
         TM    MSSMONST,MSSDELOF DELAYED DEACTIVATION ?                 65280000
         BO    S117RGSV     YES, SET RETURN CODE AND RETURN             65300000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                65320000
*---------------------------------------------------------------------  65340000
*          - END OF VALIDATION                                          65360000
*---------------------------------------------------------------------  65380000
         EJECT ,                                                        65400000
**********************************************************************  65420000
*          - INVENT PROCESSING ROUTINES                                 65440000
*            INPUT:                                                     65460000
*              R1  - POINTER TO SYSLOG ID BUFFER                        65480000
*              R3  - POINTER TO PARAMETER LIST                          65500000
*              R4  - NUMBER OF SYSLOG ID BUFFER ENTRIES (INVENT ON)     65520000
*              R6  - DISPATCHER BASE ADDRESS = RETURN ADDRESS           65540000
*              RC  - BASE REGISTER                                      65560000
*              RB  - PP SAVE AREA                                       65580000
*              RD  - ADDRESS OF IVMCIMSS                                65600000
**********************************************************************  65620000
*          - CHECK FOR OTHER THAN INVENT ON                             65640000
*---------------------------------------------------------------------  65660000
         USING INVPARML,R3                                              65680000
         TM    PRMLOPC,PRMON+PRMONPA+PRMONNP ACTIVATION REQUEST ?       65700000
         BZ    S117INNO     NO, CHECK FOR DEACTIVATION                  65720000
**********************************************************************  65740000
*          - INVENT ACTIVATION ROUTINE                                  65760000
**********************************************************************  65780000
         BAL   R2,S117IOSP  ALLOCATE SPACE, IF NECESSARY                65800000
*SGLINK  S117IOSP,INPUT=(R2,R3,R6,RC,RD),OUTPUT=(RF),                  X65820000
               WORK=(R0,R1,R4,R5,RE)                                    65840000
         LTR   RF,RF        ERROR OCCURRED ?                            65860000
         BNZ   S117ER28     YES, SET RETURN CODE AND RETURN             65880000
*SGLINK  S117ER28,INPUT=(R3,R6,RB,RC,RD,RF)                             65900000
         L     R1,PRMARPT   GET ADDRESS OF SYSLOG ID BUFFER             65920000
         L     R9,S117PBTA  GET BIT STRING                              65940000
         AIF   (&BGVM).NVM900                                  @D51IDIS 65960000
         SLR   R0,R0        INDICATE INITIALIZATION ...        @D51IDIS 65980000
         BCTR  R0,0                      ... TO BE DONE        @D51IDIS 66000000
         BAL   R2,S117IWRK  INITIALZE WORK AREA                @D51IDIS 66020000
*SGLINK  S117IWRK,INPUT=(R0,R2,RC,RD),WORK=(R0,R4,R7,RA,RE)             66040000
.NVM900  ANOP                                                  @D51IDIS 66060000
         ICM   RA,15,MSSCONF   RELEASE 2 REQUEST ?             @D51IDIS 66080000
         BZ    S117IO1         NO, PROCESS AS RELEASE 1        @D51IDIS 66100000
         OI    MSSMONS3,MSSONALL INDICATE ALL REQUEST          @D51IDIS 66120000
S117IO1  DS    0H                                              @D51IDIS 66140000
         TM    PRMLOPC,PRMON ACTIVATION REQUEST FOR ALL GEN. PART. ?    66160000
         BO    S117IOAC     YES, MOVE PIK LIST INTO WORK AREA           66180000
         NI    MSSMONS3,XFF-MSSONALL RESET ALL REQUEST         @D51IDIS 66200000
         BAL   R2,S117LGCH  CHECK SYSLOG IDS / TRANSLATE TO PIK         66220000
*SGLINK  S117LGCH,INPUT=(R1,R2,R3,RC),OUTPUT=(R9,RF),                  X66240000
               WORK=(R0,R5,R7,R8,RA)                                    66260000
         LTR   RF,RF        INVALID SYSLOG IDS FOUND ?                  66280000
         BNZ   S117ER40     YES, HANDLE ERROR CONDITION                 66300000
*SGLINK  S117ER40,INPUT=(R3,R6,RB,RC,RD,RF)                             66320000
         TM    PRMLOPC,PRMONNP EXCLUSION REQUEST ?                      66340000
         BZ    S117IONN     NO, CONTINUE                                66360000
         BAL   R2,S117GNO   CHECK IF ALL POSSIBLE SYSLOG IDS SPEC.      66380000
*SGLINK  S117GNO,INPUT=(R2,R9,RC),OUTPUT=(RF),WORK=(R4,R5,R7,R8)        66400000
         LTR   RF,RF        ALL SYSLOG IDS SPECIFIED ?                  66420000
         BZ    S117ER24     YES, HANDLE ERROR CONDITION                 66440000
*SGLINK  S117ER24,INPUT=(R6,RB,RC,RD)                                   66460000
         X     R9,S117PBTA  BITS OF PARTITIONS TO BE MONITORED          66480000
         EJECT ,                                                        66500000
*---------------------------------------------------------------------  66520000
* S117IONN - DEACTIVATE MONITORING FOR PART.S TO BE DEACTIVATED         66540000
*---------------------------------------------------------------------  66560000
S117IONN DS    0H                                                       66580000
         L     R5,IMRHBMON  GET BIT STRING ...                          66600000
*                                      ... OF MONITORED PARTITIONS      66620000
         LR    RF,R5        SAVE BIT STRING                             66640000
         XR    R5,R9        PRODUCE BIT STRING OF PART.S ...            66660000
         NR    R5,RF            ... NO LONGER TO BE MONITORED           66680000
         LTR   R5,R5        ANY PARTITION FOUND ?                       66700000
         BZ    S117IOAC     NO, CONTINUE                                66720000
         LA    R0,1         FUNCTION CODE FOR S117IOK ROUTINE           66740000
         BAL   RE,S117IOK   DEACTIVATE MONITORING                       66760000
*SGLINK  S117IOK,INPUT=(R0,R5,R6,RB,RC,RD,RE),                         X66780000
               WORK=(R1,R2,R4,R5,R7,R8,RF)                              66800000
         SPACE 2                                                        66820000
*---------------------------------------------------------------------  66840000
* S117IOAC - GET PARTITIONS, WHERE MONITORING IS NOT YET ACTIVE         66860000
*---------------------------------------------------------------------  66880000
S117IOAC DS    0H                                                       66900000
         L     R5,IMRHBMON  GET BIT STRING ...                          66920000
*                                      ... OF MONITORED PARTITIONS      66940000
         XR    R5,R9        PRODUCE BIT STRING ...                      66960000
         NR    R5,R9            ... OF PART.S NOT YET MONITORED         66980000
         LTR   R5,R5        ANY PARTITION FOUND ?                       67000000
         BZ    S117IOAG     NO, CONTINUE                                67020000
         SLR   R0,R0        FUNCTION CODE FOR S117IOK ROUTINE           67040000
         BAL   RE,S117IOK   ACTIVATE MONITORING                         67060000
*SGLINK  S117IOK,INPUT=(R0,R5,R6,RB,RC,RD,RE),                         X67080000
               WORK=(R1,R2,R4,R5,R7,R8,RF)                              67100000
S117IOAG DS    0H                                                       67120000
         ST    R9,IMRHBMON  SAVE STRING                                 67140000
*---------------------------------------------------------------------  67160000
*         - CHECK FOR FIRST ACTIVATION                                  67180000
*---------------------------------------------------------------------  67200000
         TM    MSSMONST,MSSON IAF ALREADY ACTIVE ?                      67220000
         BO    S117DISP     YES, UPDATE PARAMETER LIST                  67240000
         LA    RF,S117ER32  INDICATE ABNORMAL TERMINATION PENDING       67260000
         TM    MSSMONST,MSSFORCE MONITORING FORCED IN BETWEEN ?         67280000
         BO    S117RGSV     YES, STORE RETURN CODE AND RETURN           67300000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                67320000
         STCTL CR8,CR8,S117SAVE  GET CONTROL REGISTER 8                 67340000
         OC    S117SAVE,IMRHAMSK SET IAF MC BIT                         67360000
         LCTL  CR8,CR8,S117SAVE  SET CONTROL REGISTER                   67380000
         MVI   MSSMONST,MSSON    SET IAF ACTIVE                         67400000
         OI    IMRHFLAG,IMRHPREQ POSTING OF IMR TASK REQUIRED           67420000
*                                TO OPEN IMR FILE                       67440000
         B     S117DISP     UPDATE PARAMETER LIST                       67460000
         DROP  R3                                                       67480000
         EJECT ,                                                        67500000
**********************************************************************  67520000
*          - INVENT DEACTIVATION ROUTINE                                67540000
**********************************************************************  67560000
         USING INVPARML,R3                                              67580000
S117INNO DS    0F                                                       67600000
         LA    RF,S117ER36     SET RETURN CODE                          67620000
         TM    MSSMONST,MSSOFF MONITORING ALREADY DEACTIVATED ?         67640000
         BO    S117RGSV        YES, SET RETURN CODE AND RETURN          67660000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                67680000
         AIF   (&BGVM).NVM910                                  @D51IDIS 67700000
         LA    R0,1         INDICATE MONITORING TO BE RESET    @D51IDIS 67720000
         BAL   R2,S117IWRK  INITIALZE WORK AREA                @D51IDIS 67740000
*SGLINK  S117IWRK,INPUT=(R0,R2,RC,RD),WORK=(R0,R4,R7,RA,RE)             67760000
         NI    S117SPER,XFF-S117ER04 DO NOT RETURN RC=4        @D51IDIS 67780000
.NVM910  ANOP                                                  @D51IDIS 67800000
         NI    MSSMONS3,XFF-MSSONALL RESET ALL REQUEST         @D51IDIS 67820000
         TM    PRMLOPC,PRMOFF  NORMAL DEACTIVATION REQUEST ?            67840000
         BO    S117SDEA        YES, CALL SVA ROUTINE                    67860000
         DROP  R3                                                       67880000
*---------------------------------------------------------------------  67900000
*          - FORCED DEACTIVATION REQUEST                                67920000
*---------------------------------------------------------------------  67940000
         BAL   RF,IMRHERMO RESET MONITOR CALL CLASS                     67960000
*SGLINK  IMRHERMO,INPUT=(R6,RD,RF),WORK=(R5,RE)                         67980000
         ICM   RF,3,IMRHCOCT TASKS IN DATA COLLECTION ?                 68000000
         BNZ   S117INND     YES, RETURN STATE INFORMATION               68020000
         OI    IMRHFLG1,IMRHFALL INDICATE ALL AREAS TO BE FREED         68040000
         OI    IMRHFLAG,IMRHPREQ POSTING OF IMR TASK REQUIRED           68060000
         B     S117INND        RETURN INFO. FOR MESSAGE DISPLAY         68080000
         EJECT ,                                                        68100000
*---------------------------------------------------------------------  68120000
* S117SDEA - NORMAL DEACTIVATION REQUEST                                68140000
*---------------------------------------------------------------------  68160000
S117SDEA DS    0H                                                       68180000
         LA    RE,S117INND  GET CONTINUATION ADDRESS           @D51IDIS 68200000
*---------------------------------------------------------------------  68220000
* S117DEA  - PROCESS IAF DEACTIVATION                                   68240000
*            CALLED BY: SVC 117, PLOAD (SVC 43), POWER TERMINATION      68260000
*                       (S43RESET)                                      68280000
*            INPUT:                                                     68300000
*              RC - SVC117 BASE ADDRESS                                 68320000
*              RD - ADDRESS OF IVMCIMSS                                 68340000
*              RE - RETURN REGISTER                                     68360000
*            WORK:                                                      68380000
*              R0,R1,R2,R4,R5,R7,R8                                     68400000
*---------------------------------------------------------------------  68420000
*SGLINK S117DEA,S,INPUT=(RC,RD,RE),WORK=(R0,R1,R2,R3,R4,R5,R7,R8,RA,RF) 68440000
S117DEA  DS    0H                                              @D51IDIS 68460000
         L     RA,ASVASVDL  GET SUPERV. SUBDIRECTORY TABLE ADDR         68480000
         USING SVASVDL,RA                                               68500000
         L     RA,AIVMPIMD  GET ENTRY POINT OF IVMPIMSC PHASE           68520000
         USING IVMCIMDC,RA                                              68540000
         SLR   R0,R0           INDICATE NORMAL DEACTIVATION REQUIRED    68560000
         L     RF,PHDMLMOF  GET POINTER TO DEACTIVATION ROUTINE         68580000
*---------------------------------------------------------------------  68600000
*          - CALL IVMPIMOF SVA PHASE ROUTINE                            68620000
*            INPUT:                                                     68640000
*              R0 - IVMPIMOF FUNCTION CODE                              68660000
*                           0 - NORMAL DEACTIVATION                     68680000
*                          <0 - FORCED DEACTIVATION                     68700000
*                          >0 - NORMAL DEACTIVATION WITH PIK LIST       68720000
*              RD - ADDRESS OF IVMCIMSS                                 68740000
*              RE - RETURN REGISTER                                     68760000
*              RF - ENTRY POINT REGISTER                                68780000
*            WORK:                                                      68800000
*              R0,R1,R2,R4,R5,R7,R8                                     68820000
*---------------------------------------------------------------------  68840000
         MVI   RID+1,SYSTEMID IDENTIFY NOT INTERRUPTABLE ROUT. @D51IDIS 68860000
         BR    RF           ENTER SVA ROUTINE                  @D51IDIS 68880000
         DROP  RA                                                       68900000
         SPACE 2                                                        68920000
*---------------------------------------------------------------------  68940000
* S117INND - RESET PARTITIONS' BIT STRING                               68960000
*---------------------------------------------------------------------  68980000
S117INND DS    0H                                                       69000000
         MVI   RID+1,REENTRID IDENTIFY REENTRABLE ROUTINE      @D51IDIS 69020000
         SLR   R2,R2        CLEAR REGISTER                              69040000
         ST    R2,IMRHBMON  CLEAR BIT STRING                            69060000
         EJECT ,                                                        69080000
**********************************************************************  69100000
* S117DISP - INVENT DISPLAY ROUTINE                                     69120000
**********************************************************************  69140000
         USING INVPARML,R3                                              69160000
S117DISP DS    0H                                                       69180000
         SLR   R4,R4        CLEAR REGISTER                              69200000
         IC    R4,MSSMONST  GET STATUS BYTE                             69220000
         STC   R4,PRMSTATE  MOVE STATE TO PARAMETER LIST                69240000
         TM    MSSMONST,MSSOFF IAF INACTIVE ?                           69260000
         BO    S117DISX     YES, PROCESS REL. 2 DISPLAY        @D31FMIS 69280000
*---------------------------------------------------------------------  69300000
*          - RETURN IMR FILE STATE                                      69320000
*---------------------------------------------------------------------  69340000
         OI    PRMSTATE,PRMNOTOP INDICATE FILE NOT OPENED               69360000
         TM    MSSSTATE,MSSIMROW IMR FILE OPENED FOR WRITE ?            69380000
         BZ    S117DIS1     NO, CONTINUE                                69400000
         LH    R4,MSSIMRUS  GET USED IMR FILE SPACE                     69420000
         STH   R4,PRMRET    STORE IT INTO PARAMETER LIST                69440000
         OI    PRMSTATE,PRMOPEN SET OPEN INDICATOR                      69460000
         NI    PRMSTATE,XFF-PRMNOTOP RESET NOT-OPENED INDICATOR         69480000
*---------------------------------------------------------------------  69500000
* S117DIS1 - BUILD STRINGS FOR SYSLOG ID BUFFER(S)                      69520000
*---------------------------------------------------------------------  69540000
         USING PCBADR,R4                                                69560000
         USING IVMCIMSP,R5                                              69580000
S117DIS1 DS    0H                                                       69600000
         L     R1,PRMARPT   GET FIRST SYSLOG ID BUFFER                  69620000
         L     R2,PRMDAPT   GET SECOND SYSLOG ID BUFFER                 69640000
         SLR   RE,RE        CLEAR INDEX FOR FIRST BUFFER                69660000
         SLR   RF,RF        CLEAR INDEX FOR SECOND BUFFER               69680000
         L     R8,APCBATAB  GET ADDRESS OF PCBATAB             @D51IDIS 69700000
         TM    PRMLOPC,PRMREL2 RELEASE 2 REQUEST ?             @D31FMIS 69720000
         BZ    S117DISL     NO, DO NOT UPDATE THIRD BUFFER     @D31FMIS 69740000
         L     R9,PRMACTPT  GET THIRD SYSLOG ID BUFFER         @D31FMIS 69760000
         SLR   RA,RA        CLEAR INDEX FOR THIRD BUFFER       @D31FMIS 69780000
S117DISL DS    0H                                                       69800000
         LA    R8,4(,R8)    POINT TO NEXT PCB                  @D51IDIS 69820000
         L     R4,0(,R8)    LOAD PCB POINTER                   @D51IDIS 69840000
         LTR   R4,R4        CHECK IF PCB AVAILABLE             @D51IDIS 69860000
         BZ    S117DISL     PCB NOT AVAILABLE                  @D51IDIS 69880000
         BM    S117DISE     --> END OF TABLE                   @D51IDIS 69900000
         ICM   R5,15,PCBIVMPT  GET CORRESPONDING IVMCIMSP      @D51IDIS 69920000
         BZ    S117DISL     --> NOT AVAILABLE, LOOP            @D51IDIS 69940000
         LH    R6,PCELID    GET CORRESPONDING SYSLOG ID        @D51IDIS 69960000
         TM    MSPARTST,MSPON+MSPDELOF MONITORING ACTIVE ?              69980000
         BZ    S117DISL     NO, CONTINUE LOOP                           70000000
         BO    S117DIS2     MOVE SYSLOG ID TO SECOND BUFFER             70020000
         TM    MSSMONST,MSSDELOF+MSSFORCE IAF DEACTIVATION/FORCED ?     70040000
         BNZ   S117DIS2     MOVE SYSLOG ID TO SECOND BUFFER             70060000
         AIF   (&BGVM).NVM915                                  @D51IDIS 70080000
         TM    PCEFLAG,PCEDYNP DYNAMIC PARTITION ?             @D51IDIS 70100000
         BO    S117DIS3     YES, DO NOT MOVE LOGID TO 1. BUFFER@D51IDIS 70120000
.NVM915  ANOP                                                  @D51IDIS 70140000
         STH   R6,0(RE,R1)  MOVE IT TO FIRST BUFFER            @D51IDIS 70160000
         LA    RE,2(,RE)    INCREASE BUFFER INDEX                       70180000
         EJECT ,                                               @D51IDIS 70200000
*---------------------------------------------------------------------  70220000
* S117DIS3 - UPDATE THIRD BUFFER                                        70240000
*---------------------------------------------------------------------  70260000
S117DIS3 DS    0H                                              @D51IDIS 70280000
         TM    PRMLOPC,PRMREL2 RELEASE 2 REQUEST ?             @D31FMIS 70300000
         BZ    S117DISL     NO, DO NOT UPDATE THIRD BUFFER     @D51FMIS 70320000
         L     R5,PCBIVMPT  GET CORRESPONDING IVMCIMSP         @D51IDIS 70340000
         CLI   MSPMONLV+1,ACTLV MONITORING ACTIVE ?            @D31FMIS 70360000
         BE    S117DISL     NO, DO NOT UPDATE THIRD BUFFER     @D51IDIS 70380000
         DROP  R5                                                       70400000
         L     R7,PCECOMRA  GET COMREG ADDRESS                 @D51IDIS 70420000
         USING COMREG,R7                                       @D51IDIS 70440000
         CLI   POWFLG1,ZERO POWER OR POWER CONTROLLED PART.?   @D31FMIS 70460000
         BE    S117DISL     NO, DO NOT UPDATE THIRD BUFFER     @D51IDIS 70480000
         TM    POWFLG1,POWPDORM+POWWPART PART. ACTIVE ?        @D31FMIS 70500000
         BNZ   S117DISL     NO, DO NOT UPDATE THIRD BUFFER     @D51IDIS 70520000
         DROP  R7                                              @D51IDIS 70540000
         AIF   (&BGVM).NVM912                                  @D51IDIS 70560000
         LR    R0,R9        GET BUFFER START ADDRESS           @D51IDIS 70580000
         LA    R5,0(RA,R9)  GET BUFFER ENTRY ADDRESS           @D51IDIS 70600000
         LH    R6,PCELID    GET CORRESPONDING SYSLOG ID        @D51IDIS 70620000
         BAL   R7,S117GETC  GET CLASS CHARACTER                @D51IDIS 70640000
*SGLINK S117GETC,INPUT=(R0,R4,R5,R6,R7,RC),OUTPUT=(R6),WORK=(R5)        70653300
         B     S117DISL     CONTINUE LOOP                      @D31FMIS 70666600
.NVM912  ANOP                                                  @D51IDIS 70680000
         STH   R6,0(RA,R9)  MOVE IT TO THIRD BUFFER            @D31FMIS 70700000
         LA    RA,2(,RA)    INCREASE BUFFER INDEX              @D31FMIS 70720000
         B     S117DISL     CONTINUE LOOP                      @D51IDIS 70740000
         EJECT ,                                                        70760000
*---------------------------------------------------------------------  70780000
* S117DIS2 - MOVE SYSLOG ID TO SECOND BUFFER                            70800000
*---------------------------------------------------------------------  70820000
S117DIS2 DS    0H                                                       70840000
         AIF   (&BGVM).NVM913                                  @D51IDIS 70860000
         LR    R0,R2        GET BUFFER START ADDRESS           @D51IDIS 70880000
         LA    R5,0(RF,R2)  GET BUFFER ENTRY ADDRESS           @D51IDIS 70900000
         BAL   R7,S117GETC  GET CLASS CHARACTER                @D51IDIS 70920000
*SGLINK S117GETC,INPUT=(R0,R4,R5,R6,R7,RC),OUTPUT=(R6),WORK=(R5)        70940000
         B     S117DIS3     CONTINUE LOOP                      @D31FMIS 70950000
.NVM913  ANOP                                                  @D51IDIS 70960000
         STH   R6,0(RF,R2)  MOVE IT TO SECOND BUFFER                    70980000
         LA    RF,2(,RF)    INCREASE BUFFER INDEX                       71000000
         B     S117DIS3     CONTINUE LOOP                      @D51IDIS 71020000
         SPACE 2                                                        71040000
         AIF   (&BGVM).NVM911                                  @D51IDIS 71060000
*---------------------------------------------------------------------  71080000
* S117GETC - IF A DYNAMIC PARTITION IS FOUND,                           71100000
*            CHECK IF CORRESPONDING CLASS ALREADY IN BUFFER             71120000
*            INPUT:                                                     71140000
*              R0 - BUFFER TO BE SCANNED                                71160000
*              R4 - PCB ADDRESS                                         71180000
*              R5 - ADDR. OF CURRENT BUFFER END                         71200000
*              R6 - SYSLOG ID                                           71220000
*              R7 - RETURN ADDRESS                                      71240000
*              RC - BASE REGISTER                                       71260000
*            OUTPUT:                                                    71280000
*              R6 - CLASS TO BE MOVED                                   71300000
*            RETURN:                                                    71305000
*              R7 + 0 - CONTINUE LOOP                                   71310000
*              R7 + 4 - NOT YET IN BUFFER                               71315000
*            WORK:                                                      71320000
*              R5                                                       71340000
*---------------------------------------------------------------------  71360000
*SGLINK S117GETC,S,INPUT=(R0,R4,R5,R6,R7,RC),OUTPUT=(R6),WORK=(R5)      71380000
S117GETC DS    0H                                                       71400000
         TM    PCEFLAG,PCEDYNP DYNAMIC PARTITION ?             @D51IDIS 71420000
         BZ    4(,R7)       NO, RETURN TO CALLER               @D31FMIS 71440000
         STH   R6,S117CLWK  SAVE SYSLOG ID                     @D51IDIS 71460000
         MVI   S117CLWK+1,XFF TRANSLATE SYSLOG ID TO CLASS     @D51IDIS 71480000
S117GETL DS    0H                                                       71500000
         S     R5,F2        POINT TO LAST MOVED ENTRY          @D51IDIS 71520000
         CLC   0(2,R5),S117CLWK CLASS ALREADY IN BUFFER ?      @D51IDIS 71540000
         BER   R7           YES, RETURN TO MAIN PATH           @D31FMIS 71560000
         CR    R0,R5        ALL BUFFER ENTRIES SCANNED ?       @D51IDIS 71580000
         BL    S117GETL     NO, CHECK NEXT ENTRY               @D51IDIS 71600000
         LH    R6,S117CLWK  GET CLASS FIELD                    @D51IDIS 71620000
         B     4(,R7)       RETURN TO MAIN PATH                @D31FMIS 71640000
         SPACE 2                                               @D51IDIS 71660000
S117CLWK DC    H'0'         SYSLOG ID WORK AREA                @D51IDIS 71680000
         SPACE 2                                                        71700000
.NVM911  ANOP                                                  @D51IDIS 71720000
         DROP  R4                                                       71740000
         EJECT ,                                                        71760000
*---------------------------------------------------------------------  71780000
* S117DISE - SET NUMBER OF BUFFER ENTRIES                               71800000
*---------------------------------------------------------------------  71820000
S117DISE DS    0H                                                       71840000
         L     R6,DISPAD    GET DISPATCHER BASE                @D51IDIS 71860000
         SRL   RF,1         GET NUMBER OF MOVED SYSLOG IDS              71880000
         STH   RF,PRMLDACT  SET NUMBER OF BUFFER ENTRIES (SEC. BUFFER)  71900000
         TM    PRMLOPC,PRMREL2 RELEASE 2 REQUEST ?             @D31FMIS 71920000
         BZ    S117DI2E     NO, DO NOT UPDATE THIRD BUFFER     @D51FMIS 71940000
         SRL   RA,1         GET NUMBER OF MOVED SYSLOG IDS     @D31FMIS 71960000
         STH   RA,PRMACTLN  SET NUMBER OF BUFFER ENTRIES (3.)  @D31FMIS 71980000
         AIF   (&BGVM).NVM914                                  @D51IDIS 72000000
*---------------------------------------------------------------------  72020000
*          - CHECK MONITORING INDICATIONS IN CPCBS                      72040000
*---------------------------------------------------------------------  72060000
*              INITIALIZE LOOP                                          72080000
         ICM   R5,15,IJBCLTAB CLASS TABLE AVAILABLE ?          @D51IDIS 72100000
         BZ    S117DI2E       NO, SAVE NO. OF BUFFER ENTRIES   @D51IDIS 72120000
         L     R9,ACPCBTAB  GET ADDRESS OF CPCB TABLE          @D51IDIS 72140000
         LR    R7,R9        GET END INDICATOR FOR LOOP         @D51IDIS 72160000
S117DI0E DS    0H                                              @D51IDIS 72180000
         L     R5,0(,R9)    GET FIRST CPCB ADDRESS             @D51IDIS 72200000
         USING CPCBADR,R5                                      @D51IDIS 72220000
         TM    CPCBFLG1,CPCBIAFA MONITORING TO BE ACTIVATED ?  @D51IDIS 72240000
         BZ    S117DI1E     NO, SKIP CPCB                      @D51IDIS 72260000
         LH    R0,CPCBCLSS  GET CLASS CHARACTER                @D51IDIS 72280000
         STH   R0,0(RE,R1)  MOVE IT TO FIRST BUFFER            @D51IDIS 72300000
         LA    RE,2(,RE)    INCREASE BUFFER INDEX                       72320000
S117DI1E DS    0H                                              @D51IDIS 72340000
         LA    R9,4(,R9)    POINT TO NEXT CPCB ADDRESS         @D51IDIS 72360000
         C     R7,0(,R9)    ALL CPCB ENTRIES PROCESSED         @D51IDIS 72380000
         BNE   S117DI0E     NO, PROCESS NEXT ENTRY             @D51IDIS 72400000
         DROP  R5                                              @D51IDIS 72420000
.NVM914  ANOP                                                  @D51IDIS 72440000
S117DI2E DS    0H                                              @D51IDIS 72460000
         SRL   RE,1         GET NUMBER OF MOVED SYSLOG IDS              72480000
         STH   RE,PRMLACT   SET NUMBER OF BUFFER ENTRIES (FIRST BUFFER) 72500000
*        B     S117DISX     PROCESS REL. 2 DISPLAY             @D31FMIS 72520000
         EJECT ,                                                        72540000
*---------------------------------------------------------------------  72560000
* S117DISX - PROCESS REL. 2 DISPLAY REQUEST IF NECESSARY                72580000
*---------------------------------------------------------------------  72600000
S117DISX DS    0H                                              @D31FMIS 72620000
         TM    PRMLOPC,PRMREL2 RELEASE 2 REQUEST ?             @D31FMIS 72640000
         BZ    S117ER00     NO, STORE RETURN CODE AND RETURN   @D31FMIS 72660000
*SGLINK  S117ER00,INPUT=(R6,RB,RC,RD)                          @D31FMIS 72680000
         OI    PRMSTAT2,PRMSCIOF SET OFF INDICATION IN INVPARML@D31FMIS 72700000
         TM    MSSMONS2,MSSCCSON CICS MONITORING ACTIVE ?      @D31FMIS 72720000
         BZ    S117DI0X     NO, CONTINUE                       @D31FMIS 72740000
         OI    PRMSTAT2,PRMSCION SET INDICATION IN INVPARML    @D31FMIS 72760000
         NI    PRMSTAT2,XFF-PRMSCIOF RESET OFF INDICATION      @D31FMIS 72780000
*---------------------------------------------------------------------  72780400
*          - PREPARE CICS MONITORING BUFFER                             72780800
*---------------------------------------------------------------------  72781200
         L     R1,PRMCICPT  GET CICS SYSLOG ID BUFFER          @D31FMIS 72781600
         L     R8,APCBATAB  GET ADDRESS OF PCBATAB             @D31FMIS 72782000
         SLR   RE,RE        CLEAR BUFFER INDEX                 @D31FMIS 72782400
S117DI01 DS    0H                                              @D31FMIS 72782800
         LA    R8,4(,R8)    POINT TO NEXT PCB ADDRESS          @D31FMIS 72783200
         L     R4,0(,R8)    LOAD PCB POINTER                   @D31FMIS 72783600
         LTR   R4,R4        CHECK IF PCB AVAILABLE             @D31FMIS 72784000
         BZ    S117DI01     PCB NOT AVAILABLE                  @D31FMIS 72784400
         BM    S117DI02     --> END OF TABLE                   @D31FMIS 72784800
         USING PCBADR,R4                                       @D31FMIS 72785200
         ICM   R5,15,PCBIVMPT  GET CORRESP. IVMCIMSP, AVAIL.?  @D31FMIS 72785600
         BZ    S117DI01     NO, CONTINUE LOOP                  @D31FMIS 72786000
         USING IVMCIMSP,R5                                     @D31FMIS 72786400
         TM    MSPSFLAG,MSPCICSE CICS MONITORING ENABLED ?     @D31FMIS 72786800
         BZ    S117DI01     NO, CONTINUE LOOP                  @D31FMIS 72787200
         DROP  R5                                              @D31FMIS 72787600
         LH    R6,PCELID    GET SYSLOG ID                      @D31FMIS 72788000
         AIF   (&BGVM).NVM91X                                  @D31FMIS 72788400
         LR    R0,R1        GET BUFFER START ADDRESS           @D31FMIS 72788800
         LA    R5,0(RE,R1)  GET BUFFER ENTRY ADDRESS           @D31FMIS 72789200
         BAL   R7,S117GETC  GET CLASS CHARACTER                @D31FMIS 72789600
*SGLINK S117GETC,INPUT=(R0,R4,R5,R6,R7,RC),OUTPUT=(R6),WORK=(R5)        72790000
         B     S117DI01     CONTINUE LOOP                      @D31FMIS 72790400
.NVM91X  ANOP                                                  @D31FMIS 72790800
         STH   R6,0(RE,R1)  MOVE IT TO CICS BUFFER             @D31FMIS 72791200
         LA    RE,2(,RE)    INCREASE BUFFER INDEX              @D31FMIS 72791600
         B     S117DI01     CONTINUE LOOP                      @D31FMIS 72792000
         DROP  R4                                              @D31FMIS 72792400
         SPACE 2                                               @D31FMIS 72792800
S117DI02 DS    0H                                              @D31FMIS 72793200
         L     R6,DISPAD    RESTORE DISPATCHER ADDRESS         @D31FMIS 72793600
         SRL   RE,1         GET NUMBER OF MOVED SYSLOG IDS     @D31FMIS 72794000
         STH   RE,PRMCICLN  SET NUMBER OF BUFFER ENTRIES       @D31FMIS 72794400
         EJECT ,                                               @D31FMIS 72794800
*---------------------------------------------------------------------  72795200
* S117DI0X - RETURN PNET INFORMATION, IF NECESSARY                      72795600
*---------------------------------------------------------------------  72796000
S117DI0X DS    0H                                              @D31FMIS 72800000
         L     R5,ASVASVDL  GET SUPERV. SUBDIRECTORY TABLE ADDR@D31FMIS 72820000
         USING SVASVDL,R5                                      @D31FMIS 72840000
         L     R5,AIVMPLMV  GET ENTRY POINT OF IVMPLMV PHASE   @D31FMIS 72860000
         USING IVMCCONF,R5                                     @D31FMIS 72880000
         CLC   CONFPM,S117MAST ARE WE EXECUTING ON MASTER ?    @D31FMIS 72900000
         BNE   S117ER00     NO, SET RETURN CODE AND RETURN     @D31FMIS 72920000
*SGLINK  S117ER00,INPUT=(R6,RB,RC,RD)                          @D31FMIS 72940000
         DROP  R5                                              @D31FMIS 72960000
         OI    PRMSTAT2,PRMPUOFF SET INDICATION IN INVPARML    @D31FMIS 72980000
         TM    MSSMONS2,MSSPNET  RETRIEVAL FROM LST ACTIVE ?   @D31FMIS 73000000
         BZ    S117DI1X     NO, CONTINUE                       @D31FMIS 73020000
         OI    PRMSTAT2,PRMPUON  SET INDICATION IN INVPARML    @D31FMIS 73040000
         NI    PRMSTAT2,XFF-PRMPUOFF RESET OFF INDICATION      @D31FMIS 73060000
S117DI1X DS    0H                                              @D31FMIS 73080000
         TM    MSSMONS2,MSSPNETD RETRIEVAL FROM LST IN DEACT.? @D31FMIS 73100000
         BZ    S117ER00     NO, STORE RETURN CODE AND RETURN   @D31FMIS 73120000
*SGLINK  S117ER00,INPUT=(R6,RB,RC,RD)                          @D31FMIS 73140000
         OI    PRMSTAT2,PRMPUDAC SET INDICATION IN INVPARML    @D31FMIS 73160000
         NI    PRMSTAT2,XFF-PRMPUOFF RESET OFF INDICATION      @D31FMIS 73180000
         B     S117ER00     STORE RETURN CODE AND RETURN       @D31FMIS 73200000
*SGLINK  S117ER00,INPUT=(R6,RB,RC,RD)                          @D31FMIS 73220000
         DROP  R3                                                       73240000
         DROP  RD                                                       73260000
         EJECT ,                                                        73280000
**********************************************************************  73300000
* S117CICS - CICS MONITORING ROUTINES                                   73320000
*            INPUT:                                                     73340000
*              R3  - POINTER TO PARAMETER LIST                          73360000
*              R6  - DISPATCHER BASE ADDRESS - RETURN REGISTER          73380000
*              RB  - PP SAVE AREA                                       73400000
*              RC  - BASE REGISTER                                      73420000
*              RD  - IVMCIMSS ADDRESS                                   73440000
**********************************************************************  73460000
         USING INVPARML,R3                                     @D31FMIS 73480000
         USING IVMENTRY,RD                                     @D31FMIS 73500000
S117CICS DS    0F                                              @D31FMIS 73520000
         NI    MSSMONS2,XFF-MSSCCSON RESET CICS MONITORING     @D31FMIS 73540000
         TM    PRMLOPC2,PRMCICON CICS MONITORING TO BE ACT. ?  @D31FMIS 73560000
         BZ    S117ER00     NO, SET RETURN CODE AND RETURN     @D31FMIS 73580000
*SGLINK  S117ER00,INPUT=(R6,RB,RC,RD)                          @D31FMIS 73600000
         LA    RF,S117ER32  INDICATE FORCED  DEACTIVATION      @D31FMIS 73700000
         TM    MSSMONST,MSSFORCE IAF FORCED ?                  @D31FMIS 73720000
         BO    S117RGSV     YES, STORE RETURN CODE AND RETURN  @D31FMIS 73740000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                       @D31FMIS 73760000
         LA    RF,S117ER36  INDICATE INACTIVE                  @D31FMIS 73780000
         TM    MSSMONST,MSSOFF   IAF INACTIVE ?                @D31FMIS 73800000
         BO    S117RGSV     YES, STORE RETURN CODE AND RETURN  @D31FMIS 73820000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                       @D31FMIS 73840000
         OI    MSSMONS2,MSSCCSON SET CICS MONITORING ACTIVE    @D31FMIS 73860000
         B     S117ER00     STORE RETURN CODE AND RETURN       @D31FMIS 73880000
*SGLINK  S117ER00,INPUT=(R6,RB,RC,RD)                          @D31FMIS 73900000
         DROP  R3                                              @D31FMIS 73920000
         DROP  RD                                              @D31FMIS 73940000
         EJECT ,                                                        73960000
**********************************************************************  73980000
* S117LST  - LIST  RETRIEVAL REQUESTS                                   74000000
*            INPUT:                                                     74020000
*              R3  - POINTER TO PARAMETER LIST                          74040000
*              R5  - IVMCCONF ADDRESS                                   74060000
*              R6  - DISPATCHER BASE ADDRESS - RETURN REGISTER          74080000
*              RB  - PP SAVE AREA                                       74100000
*              RC  - BASE REGISTER                                      74120000
*              RD  - IVMCIMSS ADDRESS                                   74140000
**********************************************************************  74160000
         USING INVPARML,R3                                     @D31FMIS 74180000
         USING IVMCCONF,R5                                     @D31FMIS 74200000
         USING IVMENTRY,RD                                     @D31FMIS 74220000
S117LST  DS    0F                                              @D31FMIS 74240000
         LA    RF,S117ER04  IND. NOT A MASTER NODE             @D31FMIS 74260000
         CLC   CONFPM,S117MAST MASTER NODE ?                   @D31FMIS 74280000
         BNE   S117RGSV     NO, SET RETURN CODE AND RETURN     @D31FMIS 74300000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                74320000
         LA    RF,S117ER12  IND. DEACTIVATION IN PROCESS       @D31FMIS 74340000
         TM    MSSMONS2,MSSPNETD DELAYED DEACTIVATION ?        @D31FMIS 74360000
         BO    S117RGSV     YES, SET RETURN CODE AND RETURN    @D31FMIS 74380000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                74400000
         TM    PRMLOPC2,PRMIMRON ACTIVATION REQUESTED ?        @D31FMIS 74420000
         BZ    S117LST1     NO, PROCESS DEACTIVATION REQUEST   @D31FMIS 74440000
         OI    MSSMONS2,MSSPNET  INDICATE ACTIVATION REQUEST   @D31FMIS 74460000
         OI    IMRHFLAG,IMRHPREQ POST OF SYSTEM TASK REQUIRED  @D31FMIS 74480000
         B     S117ER00     STORE RETURN CODE AND RETURN       @D31FMIS 74500000
*SGLINK  S117ER00,INPUT=(R6,RB,RC,RD)                          @D31FMIS 74520000
         SPACE 2                                                        74540000
S117LST1 DS    0F                                              @D31FMIS 74560000
         TM    MSSMONS2,MSSPNET  ALREADY INACTIVE ?            @D31FMIS 74580000
         BZ    S117ER24     YES, SET RETURN CODE AND RETURN    @D31FMIS 74600000
*SGLINK  S117ER24,INPUT=(R6,RB,RC,RD)                                   74620000
         OI    MSSMONS2,MSSPNETD INDICATE DEACTIVATION REQUEST @D31FMIS 74640000
         OI    IMRHFLAG,IMRHPREQ POST OF SYSTEM TASK REQUIRED  @D31FMIS 74660000
         B     S117ER00     STORE RETURN CODE AND RETURN       @D31FMIS 74680000
*SGLINK  S117ER00,INPUT=(R6,RB,RC,RD)                          @D31FMIS 74700000
         DROP  R3                                              @D31FMIS 74720000
         DROP  R5                                              @D31FMIS 74740000
         DROP  RD                                              @D31FMIS 74760000
         EJECT ,                                                        74780000
**********************************************************************  74800000
*         - SVC 117 COMMON ROUTINES                                     74820000
**********************************************************************  74840000
         SPACE 4                                                        74860000
**********************************************************************  74880000
* S117ER.. - RETURN CODE ROUTINE                                        74900000
*            INPUT:                                                     74920000
*              R3  - POINTER TO PARAMETER LIST (RETCODE = 40 ONLY)      74940000
*              R6  - DISPATCHER BASE ADDRESS - RETURN REGISTER          74960000
*              RB  - PP SAVE AREA                                       74980000
*              RC  - BASE REGISTER                                      75000000
*              RD  - IVMCIMSS ADDRESS                                   75020000
*              RF  - DEPENDENT ON SVC 117 RETURN CODE                   75040000
*            OUTPUT:                                                    75060000
*              RETURN CODE IN PP SAVE AREA                              75080000
*                0 - SUCCESSFUL COMPLETION                              75100000
*                4 - PARTITIONS NOT SPECIFIED DEACTIVATED               75120000
*                8 - PROCESSING ROUTINE ACTIVE                          75140000
*               12 - DELAYED DEACTIVATION IN PROCESS                    75160000
*               16 - PARAMETER LIST INVALID                             75180000
*               20 - ADDRESS OF SYSLOG ID BUFFER MISSING                75200000
*               24 - ALL PARTITIONS SPECIFIED IN NOTPART                75220000
*               28 - SYSTEM GETVIS FAILURE                              75240000
*               32 - ABNORMAL TERMINATION PENDING                       75260000
*               36 - IAF DEACTIVATED                                    75280000
*               40 - INVALID SYSLOG IDS FOUND                           75300000
*               48 - SVA PHASE NOT AVAILABLE                            75320000
*               SPECIAL RETURN CODES FOR IMR FILE SERVICES              75340000
**********************************************************************  75360000
         USING IVMENTRY,RD                                              75380000
*SGLINK  S117ER00,S,INPUT=(R6,RB,RC,RD)                                 75400000
S117ER00 DS    0F                                                       75420000
         SLR   RF,RF        SET RETURN CODE                             75440000
         TM    S117SPER,S117ER04 RETURN CODE 4 TO BE SET ?              75460000
         BZ    S117RGSV     NO CONTINUE                                 75480000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                75500000
         LA    RF,S117ER04  SET RETURN CODE                             75520000
         NI    S117SPER,XFF-S117ER04 CLEAR RETURN CODE                  75540000
*SGLINK  S117RGSV,S,INPUT=(R6,RB,RC,RD,RF)                              75560000
S117RGSV DS    0H           COMMON RETURN                               75580000
         USING SVEARA,RB                                                75600000
         ST    RF,SVER0F    STORE RETURN CODE                           75620000
         DROP  RB                                                       75640000
         NI    IMRHFLAG,XFF-IMRHINVA RESET INVENT PROCESSING ACTIVE     75660000
         CLC   ARTIDH(2),TID REQUEST FROM AR ?                          75680000
         BER   R6           YES, RETURN TO DISPATCHER                   75700000
         TM    IMRHFLAG,IMRHPREQ POSTING OF IMR TASK REQUIRED ?         75720000
         BZR   R6           NO, RETURN TO DISPATCHER                    75740000
         NI    IMRHFLAG,XFF-IMRHPREQ RESET IMR TASK POST INDICATION     75760000
         LR    R5,R6        RETURN TO DISPATCHER AFTER IMRHPSYS         75780000
         B     IMRHPSYS     POST SYSTEM TASK                            75800000
*SGLINK  IMRHPSYS,INPUT=(R5,RD),OUTPUT=(R6),WORK=(R8,RE,RF)             75820000
         EJECT ,                                                        75840000
S117ER04 EQU   4            PARTITIONS NOT SPECIFIED DEACTIVATED        75860000
         SPACE 4                                                        75880000
*SGLINK  S117ER08,S,INPUT=(R6,RB,RC)                                    75900000
S117ER08 DS    0H           PROCESSING ROUTINE ACTIVE                   75920000
         LA    RF,8         INDICATE PROCESSING ROUTINE ACTIVE          75940000
         USING SVEARA,RB                                                75960000
         ST    RF,SVER0F    STORE RETURN CODE                           75980000
         DROP  RB                                                       76000000
         BR    R6           RETURN TO DISPATCHER                        76020000
         SPACE 4                                                        76040000
S117ER12 EQU   12           INDICATE DELAYED DEACTIVATION IN PROC.      76060000
S117ER16 EQU   16           INDICATE PARAMETER LIST INVALID             76080000
S117ER20 EQU   20           INDICATE ADDRESS OF SYSLOG ID BUFF MISSING  76100000
         SPACE 4                                                        76120000
*SGLINK  S117ER24,S,INPUT=(R6,RB,RC,RD)                                 76140000
S117ER24 DS    0F                                                       76160000
         LA    RF,24        INDICATE ALL PARTITIONS SPEC. IN NOTPART    76180000
         B     S117EX40     CONTINUE WITH COMMON RETURN ROUTINE         76200000
*SGLINK  S117EX40,INPUT=(R6,RB,RC,RD,RF)                                76220000
         SPACE 4                                                        76240000
*SGLINK  S117ER28,S,INPUT=(R3,R6,RB,RC,RD,RF)                           76260000
S117ER28 DS    0F                                                       76280000
         USING INVPARML,R3                                              76300000
         STH   RF,PRMRET    STORE GETVIS RETURN CODE                    76320000
         DROP  R3                                                       76340000
         LA    RF,28        INDICATE SYSTEM GETVIS FAILURE              76360000
         B     S117RGSV     CONTINUE WITH COMMON RETURN ROUTINE         76380000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                76400000
         SPACE 4                                                        76420000
S117ER32 EQU   32           INDICATE ABNORMAL TERMINATION PENDING       76440000
S117ER36 EQU   36           INDICATE IAF DEACTIVATED                    76460000
         EJECT ,                                                        76480000
*SGLINK  S117ER40,S,INPUT=(R3,R6,RB,RC,RD,RF)                           76500000
S117ER40 DS    0F           INVALID SYSLOG IDS FOUND                    76520000
         SRL   RF,1         DIVIDE INDEX BY TWO                         76540000
         USING INVPARML,R3                                              76560000
         STH   RF,PRMLACT   STORE IT INTO PARAMETER LIST                76580000
         DROP  R3                                                       76600000
         LA    RF,40        SET RETURN CODE                             76620000
*SGLINK  S117EX40,S,INPUT=(R6,RB,RC,RD,RF)                              76640000
S117EX40 DS    0H           INVALID SYSLOG IDS FOUND                    76660000
         TM    MSSMONST,MSSOFF MONITORING INACTIVE ?                    76680000
         BZ    S117RGSV     NO, CONTINUE WITH COMMON RETURN ROUTINE     76700000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                76720000
         BAL   R2,IMRHFRGV  FREE ALLOCATED AREAS                        76740000
*SGLINK IMRHFRGV,INPUT=(R2,R6,RD),WORK=(R1,R9,RA)                       76760000
         B     S117RGSV     CONTINUE WITH COMMON RETURN ROUTINE         76780000
*SGLINK  S117RGSV,INPUT=(R6,RB,RC,RD,RF)                                76800000
         SPACE 4                                                        76820000
*SGLINK  S117ER48,S,INPUT=(R6,RB,RC,RD,RF)                              76840000
S117EA48 EQU   48           SVA PHASE NOT AVAILABLE                     76860000
S117ER48 DS    0F           SVA PHASE NOT AVAILABLE                     76880000
         USING DISP,R6                                                  76900000
         LTR   RF,RF        FUNCTION CODE NEGATIVE ?                    76920000
         BM    ERR21        YES, ILLEGAL SVC                            76940000
         CH    RF,HIGHFC    VALID FUNCTION CODE ?                       76960000
         BH    ERR21        NO, ILLEGAL SVC                             76980000
         DROP  R6                                                       77000000
         LA    RF,48        SET RETURN CODE                             77020000
         USING SVEARA,RB                                                77040000
         ST    RF,SVER0F    STORE RETURN CODE                           77060000
         DROP  RB                                                       77080000
         BR    R6           RETURN TO DISPATCHER                        77100000
         DROP  RD                                                       77120000
         EJECT ,                                                        77140000
**********************************************************************  77160000
* S117IOSP - ALLOCATION OF BUFFER DESCRIPTORS, SAVE AREAS AND           77180000
*            PARTITION RELATED CONTROL BLOCKS                           77200000
*            INPUT:                                                     77220000
*              R2  - RETURN REGISTER                                    77240000
*              R3  - POINTER TO PARAMETER LIST                          77260000
*              R6  - DISPATCHER BASE ADDRESS                            77280000
*              RC  - BASE REGISTER                                      77300000
*              RD  - ADDRESS OF IVMCIMSS                                77320000
*            OUTPUT:                                                    77340000
*              RF - RETURN CODE                                         77360000
*                   0     = ALLOCATED AREAS AVAILABLE                   77380000
*                   NOT 0 = GETVIS ERROR CODE                           77400000
*            WORK:                                                      77420000
*              R0, R1, R4, R5, RE                                       77440000
**********************************************************************  77460000
         USING IVMENTRY,RD                                              77480000
*SGLINK  S117IOSP,S,INPUT=(R2,R3,R6,RC,RD),OUTPUT=(RF),                X77500000
               WORK=(R0,R1,R4,R5,RE)                                    77520000
S117IOSP DS    0F                                                       77540000
         SLR   RF,RF        SET RETURN CODE 0                           77560000
         TM    MSSMONST,MSSON MONITORING ALREADY ACTIVE ?               77580000
         BOR   R2           YES, RETURN TO CALLER                       77600000
         LR    RE,RA        SAVE REGISTER A                             77620000
         L     RA,TCBPTR    GET TCB ADDRESS                             77640000
         LH    R0,IMRHLEN   GET SIZE TO BE ALLOCATED                    77660000
         LA    R5,IMRHSIZ1  SAVE BUFFER DESCRIPTOR LENGTH      @D51IDIS 77680000
         AIF   (&BGVM).NVM799                                  @D51IDIS 77700000
         USING INVPARML,R3                                     @D51IDIS 77720000
         TM    PRMLOPC,PRMREL2 RELEASE 2 REQUEST ?             @D51IDIS 77740000
         BZ    S117IOS1        NO, PROCESS AS RELEASE 1        @D51IDIS 77760000
         DROP  R3                                                       77780000
         L     RF,IJBCLIM   GET ADDRESS OF LIMITS TABLE        @D51IDIS 77800000
         USING CLIM,RF                                         @D51IDIS 77820000
         LH    RF,CSPART    GET MAX. NUMBER OF PARTITIONS      @D51IDIS 77840000
         DROP  RF                                                       77860000
         CH    RF,IJBNPART  MORE THAN 12 PARTITIONS ALLOCATED ?@D51IDIS 77880000
         BE    S117IOS1     NO, USE RELEASE 1 BUFDESCR ALLOC   @D51IDIS 77900000
         LR    R1,RF        CALCULATE MAX. NUMBER OF BUFFER ...@D51IDIS 77920000
         SRL   R1,1         ... DESCRIPTORS TO BE ALLOCATED ...@D51IDIS 77940000
         AR    R1,RF        ... = 1.5 * NPARTS                 @D51IDIS 77960000
         LA    RF,BUFLENQ   GET BUFFER DESCRIPTOR LENGTH       @D51IDIS 77980000
         MR    R0,RF        GET TOTAL BUFFER DESCRIPTOR LENGTH @D51IDIS 78000000
         LR    R5,R1        SAVE BUFFER DESCRIPTOR LENGTH      @D51IDIS 78020000
         LA    R1,IMRHSIZ2  GET TOTAL ...                      @D51IDIS 78040000
         LA    R0,IMRHSIZ3(R1,R5)     ... LENGTH               @D51IDIS 78060000
S117IOS1 DS    0H                                                       78080000
.NVM799  ANOP                                                           78100000
*        SGETVIS SPID=SPIVM,PFIX=YES,ADDRESS=(1),LENGTH=(0)             78120000
         SGETVIS SPID=SPIVM,PFIX=YES,ADDRESS=(1),LENGTH=(0)             78140000
         LR    RA,RE        RESTORE REGISTER A                          78160000
         LTR   RF,RF        ERROR OCCURED ?                             78180000
         BNZR  R2           YES, SET RETURN CODE AND RETURN             78200000
         EJECT ,                                                        78220000
*---------------------------------------------------------------------  78240000
*          - SPLIT ALLOCATED AREA INTO SPACE FOR BUFFER DESCRIPTORS,    78260000
*            SAVE AREAS AND IVMCIMSPS                                   78280000
*---------------------------------------------------------------------  78300000
         ST    R1,IMRHAREA  SAVE ADDRESS OF ALLOCATED AREA              78320000
         ST    R1,IMRHFPTR  SET POINTER TO FREE BUFFER                  78340000
*                           DESCRIPTOR SPACE                            78360000
         LA    R1,0(R5,R1) SET HIGH WATER MARK ...             @D51IDIS 78380000
         ST    R1,IMRHHIGH            ... = POINTER TO SAVE AREAS       78400000
         LA    R5,IMRHSIZ2(,R1) SET POINTER TO IVMCIMSP                 78420000
         ST    R5,IMRHMSPA  SAVE POINTER TO IVMCIMSP AREA               78440000
*---------------------------------------------------------------------  78460000
*          - SET IVMCIMSP ADDRESS INTO PCB, SAVE AREA ADDRESS           78480000
*            INTO IVMCIMSP AND INITIALIZE IVMCIMSP AND IVMCISAV         78500000
*---------------------------------------------------------------------  78520000
         USING IVMCISAV,R1                                              78540000
         USING PCBADR,R4                                                78560000
         USING IVMCIMSP,R5                                              78580000
         USING DISP,R6                                                  78600000
         L     RE,APCBATAB  GET ADDRESS OF PCB ADDRESS TABLE   @D51IDIS 78620000
         LA    RE,4+&NPART*4(,RE) INITIALIZE STATIC PCB LOOP   @D51IDIS 78640000
S117IOSV DS    0H           START LOOP OVER PCBS                        78660000
         S     RE,F4        GET NEXT POINTER TO PCB ADDRESS             78680000
         L     R4,0(,RE)    LOAD PCB POINTER                            78700000
         C     R4,ASYSPCB   ALL STATIC PCBS PROCESSED ?        @D51IDIS 78720000
         BER   R2           YES, RETURN TO CALLER                       78740000
         ST    R5,PCBIVMPT  SET POINTER TO IVMCIMSP                     78760000
         ST    R4,MSPAPCB   SET POINTER TO CORRESP. PCB                 78780000
         ST    R1,MSPASAVE  SET PARTITION'S SAVE AREA                   78800000
         ST    R5,MSPSIVMP  STORE IVMCIMSP ADDRESS                      78820000
         OI    MSPARTST,MSPOFF+MSPIGN  SET MONITORING INACTIVE          78840000
         LA    R4,MSPLENQ   GET LENGTH OF IVMCIMSP                      78860000
         STH   R4,MSPLEN    SET LENGTH INTO IVMCIMSP                    78880000
         LA    R1,MSPSLENQ(,R1) POINT TO NEXT FREE AREA (SAVE AREA)     78900000
         LA    R5,MSPLENQ(,R5)  POINT TO NEXT FREE AREA (IVMCIMSP)      78920000
         B     S117IOSV     CONTINUE LOOP                               78940000
         DROP  R1                                                       78960000
         DROP  R4                                                       78980000
         DROP  R5                                                       79000000
         DROP  R6                                                       79020000
         DROP  RD                                                       79040000
         EJECT ,                                                        79060000
**********************************************************************  79080000
* S117IOK - INVENT ACTIVATION - ACTIVATE/DEACTIVATE IAF                 79100000
*           INPUT:                                                      79120000
*             R0  - FUNCTION CODE                                       79140000
*                   0 - ACTIVATION REQUESTED                            79160000
*                   1 - DEACTIVATION REQUESTED                          79180000
*             R5  - BIT STRING OF PART.S TO BE ACTIVATED/ DEACTIVATED   79200000
*             R6  - DISPATCHER BASE ADDRESS                             79220000
*             RB  - PP SAVE AREA ADDRESS                                79240000
*             RC  - BASE REGISTER                                       79260000
*             RD  - ADDRESS OF IVMCIMSS                                 79280000
*             RE  - RETURN REGISTER                                     79300000
*           WORK:                                                       79320000
*             R1, R2, R4, R5, R7, R8, RF                                79340000
**********************************************************************  79360000
*SGLINK  S117IOK,S,INPUT=(R0,R5,R6,RB,RC,RD,RE),                       X79380000
               WORK=(R1,R2,R4,R5,R7,R8,RF)                              79400000
S117IOK  DS    0F                                                       79420000
         LA    R1,S117PIKW  GET ADDRESS OF PIK WORK AREA                79440000
         LA    RF,S117PIK   GET POINTER TO PIK LIST                     79460000
         BAL   R2,S117GID   TRANSLATE BIT STRING TO PIKS                79480000
*SGLINK  S117GID,INPUT=(R0,R1,R2,R5,RC,RD,RF),OUTPUT=(R7),             X79500000
               WORK=(R4,R5,R8)                                          79520000
         LTR   R7,R7        ANY ADDITIONAL PARTITION                    79540000
         BZR   RE           NO, RETURN TO CALLER                        79560000
         ST    R0,0(R7,R1) INDICATE END OF LIST                         79580000
*---------------------------------------------------------------------  79600000
*          - CALL SVA PHASE ROUTINE                                     79620000
*            INPUT:                                                     79640000
*              R0 - (IVMPIMOF ONLY) FUNCTION CODE                       79660000
*                           0 - NORMAL DEACTIVATION                     79680000
*                          <0 - FORCED DEACTIVATION                     79700000
*                          >0 - NORMAL DEACTIVATION WITH PIK LIST       79720000
*              R1 - PIK LIST ADDRESS (OPTIONAL)                         79740000
*              RD - ADDRESS OF IVMCIMSS                                 79760000
*              RE - RETURN REGISTER                                     79780000
*              RF - ENTRY POINT REGISTER                                79800000
*            WORK:                                                      79820000
*              R0,R1,R2,R4,R5,R7,R8                                     79840000
*---------------------------------------------------------------------  79860000
         L     RA,ASVASVDL  GET SUPERV. SUBDIRECTORY TABLE ADDR.        79880000
         USING SVASVDL,RA                                               79900000
         L     RA,AIVMPIMD  GET ENTRY POINT OF SVA PHASE                79920000
         USING IVMCIMDC,RA                                              79940000
         L     RF,PHDMLMON  GET POINTER TO ACTIVATION ROUTINE           79960000
         LTR   R0,R0        ACTIVATION REQUEST ?                        79980000
         BZR   RF           YES, PROCESS IT                             80000000
         OI    S117SPER,S117ER04 INDICATE RETURN CODE 4                 80020000
*                                TO BE RETURNED                         80040000
         L     RF,PHDMLMOF  GET POINTER TO DEACTIVATION ROUTINE         80060000
         BR    RF           ENTER SVA ROUTINE                           80080000
         DROP  RA                                                       80100000
         EJECT ,                                                        80120000
**********************************************************************  80140000
* S117LGCH - INVENT ACTIVATION - CHECK SYSLOG IDS / CLASSES             80160000
*            INPUT:                                                     80180000
*              R1  - POINTER TO SYSLOG ID BUFFER                        80200000
*              R2  - RETURN ADDRESS                                     80220000
*              R3  - POINTER TO PARAMETER LIST                          80240000
*              RC  - BASE REGISTER                                      80260000
*            OUTPUT:                                                    80280000
*              R9  - BIT STRING OF SYSLOG IDS TRANSFERRED IN BUFFER     80300000
*              RF  - INDEX FOR SYSLOG ID BUFFER (RCODE=40 ONLY)         80320000
*            WORK:                                                      80340000
*              R0, R5, R7, R8, RA                                       80360000
**********************************************************************  80380000
*SGLINK  S117LGCH,S,INPUT=(R1,R2,R3,RC),OUTPUT=(R9,RF),                X80400000
               WORK=(R0,R5,R7,R8,RA)                                    80420000
S117LGCH DS    0F                                                       80440000
*              INITIALIZE LOOP                                          80460000
         USING INVPARML,R3                                     @D51IDIS 80480000
         LH    R0,PRMLACT   GET NUMBER OF SYSLOG IDS           @D51IDIS 80500000
         DROP  R3                                              @D51IDIS 80520000
         SLL   R0,1         MULTIPLY NO. OF BUFFER ENTRIES BY 2         80540000
         SLR   R9,R9        RESET SYSLOG ID BIT STRING                  80560000
         LR    RA,R9        RESET INDEX VALUE (SYSLOG ID BUFFER)        80580000
         LR    RF,R9        RESET INDEX VALUE (NOT FOUND)               80600000
S117LGC0 DS    0H                                                       80620000
         SLR   R5,R5        RESET INDEX VALUE (GENERATED SYSLOG IDS)    80640000
         L     R8,S117SHBT  GET BIT STRING FOR SHIFT OPERATION          80660000
         LH    R7,0(RA,R1)  GET SYSLOG ID FROM BUFFER                   80680000
S117LGCL DS    0H                                                       80700000
*---------------------------------------------------------------------  80720000
*              LOOK FOR SYSLOG ID IN GENERATED SYSLOG ID STRING         80740000
*---------------------------------------------------------------------  80760000
         CH    R7,S117SID(R5) EQUAL TO GENERATED SYSLOG ID ?            80780000
         BE    S117LGC1     YES, SYSLOG ID FOUND                        80800000
         SRL   R8,1         SHIFT ONE POSITION                          80820000
         LA    R5,2(,R5)    PROCESS NEXT ENTRY OF GENERATED SYSLOG IDS  80840000
         CH    R5,S117MAXL  ALL POSSIBLE SYSLOG IDS SCANNED ?           80860000
         BL    S117LGCL     NO, LOOP                                    80880000
         STH   R7,0(RF,R1)  SAVE INVALID SYSLOG ID                      80900000
         LA    RF,2(,RF)    INCREMENT "NOT FOUND" INDEX                 80920000
         B     S117LGC2     CONTINUE WITH NEXT BUFFER ENTRY             80940000
         SPACE 2                                                        80960000
*---------------------------------------------------------------------  80980000
*       CLASS/SYSLOG ID FOUND                                           81000000
*---------------------------------------------------------------------  81020000
S117LGC1 DS    0H                                              @D51IDIS 81040000
         OR    R9,R8        INDICATE SYSLOG ID FOUND                    81060000
S117LGC2 DS    0H                                                       81080000
         LA    RA,2(,RA)    PROCESS NEXT ENTRY OF SYSLOG ID BUFFER      81100000
         CR    RA,R0        ALL BUFFER ENTRIES PROCESSED ?              81120000
         BL    S117LGC0     NO, LOOK FOR SYSLOG ID                      81140000
         BR    R2           RETURN TO CALLER                            81160000
         EJECT ,                                                        81180000
**********************************************************************  81200000
* S117GID - TRANSLATE BIT STRING TO CORRESPONDING PIKS AND              81220000
*           SETS MONITORING INDICATION IN CLASS TABLE ENTRIES           81240000
*           INPUT:                                                      81260000
*             R0  - FUNCTION CODE                                       81280000
*             R1  - PIK STRING ADDRESS (TO AREA)                        81300000
*             R2  - RETURN REGISTER                                     81320000
*             R5  - BIT STRING OF PART.S TO BE ACTIVATED/ DEACTIVATED   81340000
*             RC  - BASE REGISTER                                       81360000
*             RD  - IVMCIMSS ADDRESS                                    81380000
*             RF  - SYSLOG ID/PIK STRING ADDRESS (FROM AREA)            81400000
*           OUTPUT:                                                     81420000
*             R7  - INDEX FOR MOVED PIKS                                81440000
*           WORK:                                                       81460000
*             R4, R5, R8                                                81480000
**********************************************************************  81500000
*SGLINK  S117GID,S,INPUT=(R0,R1,R2,R5,RC,RD,RF),OUTPUT=(R7),           X81520000
               WORK=(R4,R5,R8)                                          81540000
         USING IVMCIMSS,RD                                     @D51IDIS 81560000
S117GID  DS    0F                                                       81580000
         SLR   R4,R4        RESET INDEX VALUE                           81600000
         LR    R7,R4        RESET INDEX VALUE                           81620000
S117GID0 DS    0H           START OF LOOP                               81640000
         L     R8,S117SHBT  GET BIT STRING (FIRST BIT ON)               81660000
         NR    R8,R5        LOOK FOR PARTITION TO BE MONITORED          81680000
         BZ    S117GID1     NO, CONTINUE                                81700000
         LH    R8,0(R4,RF)  GET SYSLOG ID/PARTITION KEY                 81720000
         AIF   (&BGVM).NVM800                                  @D51IDIS 81740000
         CH    R4,S117MAXS  ALL STATIC PARTITIONS PROCESSED ?  @D51IDIS 81760000
         BNL   S117GID2     NO, CONTINUE                       @D51IDIS 81780000
.NVM800  ANOP                                                  @D51IDIS 81800000
         STH   R8,0(R7,R1)  MOVE SYSLOG ID/PIK TO WORK AREA             81820000
         LA    R7,2(,R7)    INCREASE INDEX VALUE                        81840000
S117GID1 DS    0H                                                       81860000
         SLL   R5,1         LOOK FOR NEXT PARTITION                     81880000
         LA    R4,2(,R4)    INCREASE INDEX VALUE                        81900000
         CH    R4,S117MAXL  ALL POSSIBLE SYSLOG IDS SCANNED ?           81920000
         BL    S117GID0     NO, LOOP                                    81940000
         BR    R2            RETURN TO CALLER                           81960000
         DROP  RD                                              @D51IDIS 81980000
         AIF   (&BGVM).NVM801                                  @D51IDIS 82000000
         EJECT ,                                                        82020000
*---------------------------------------------------------------------  82040000
* S117GID2 -   LOOK FOR SYSLOG ID IN GENERATED SYSLOG ID STRING         82060000
*---------------------------------------------------------------------  82080000
         USING IVMCIMSS,RD                                     @D51IDIS 82100000
S117GID2 DS    0H                                              @D51IDIS 82120000
         ICM   RA,15,MSSCONF   RELEASE 2 REQUEST ?             @D51IDIS 82140000
         BZ    S117GID1        NO, PROCESS AS RELEASE 1        @D51IDIS 82160000
         ICM   RA,15,IJBCLTAB CLASS TABLE AVAILABLE ?          @D51IDIS 82180000
         BZ    S117GID1       NO, RETURN TO MAIN PATH          @D51IDIS 82200000
         L     RA,ACPCBTAB  GET ADDRESS OF CPCB TABLE          @D51IDIS 82220000
         L     RA,0(R8,RA)  GET CPCB ADDRESS                   @D51IDIS 82240000
         STM   R2,R5,S117SAVE SAVE REGISTERS                   @D51IDIS 82260000
         BAL   R2,S117MCLS  PROCESS ACT./DEACT. OF CLASS       @D51IDIS 82280000
*SGLINK S117MCLS,INPUT=(R0,R2,RA,RC,RD),WORK=(R3,R4,R5)                 82300000
         LM    R2,R5,S117SAVE RESTORE REGISTERS                @D51IDIS 82320000
         B     S117GID1     RETURN TO MAIN PATH                @D51IDIS 82340000
         DROP  RD                                              @D51IDIS 82360000
         EJECT ,                                                        82380000
**********************************************************************  82400000
* S117MCLS - MAINTAIN IAF ACTIVATION/DEACTIVATION FOR ONE CLASS         82420000
*           INPUT:                                                      82440000
*             R0  - FUNCTION CODE                                       82460000
*             R2  - RETURN REGISTER                                     82480000
*             RA  - CPCB ADDRESS                                        82500000
*             RC  - BASE REGISTER                                       82520000
*             RD  - IVMCIMSS ADDRESS                                    82540000
*           OUTPUT:                                                     82560000
*             NONE                                                      82580000
*           WORK:                                                       82600000
*             R3, R4, R5                                                82620000
**********************************************************************  82640000
         USING CPCBADR,RA                                      @D51IDIS 82660000
         USING IVMCIMSS,RD                                     @D51IDIS 82680000
*SGLINK S117MCLS,S,INPUT=(R0,R2,RA,RC,RD),WORK=(R3,R4,R5)               82700000
S117MCLS DS    0H                                              @D51IDIS 82720000
         LTR   R0,R0        DEACTIVATION REQUEST ?             @D51IDIS 82740000
         BNZ   S117MCL0     YES, PROCESS IT                    @D51IDIS 82760000
         CLI   CPCBCLSS,XFF CPCB FREE ?                        @D51IDIS 82780000
         BER   R2           YES, RETURN TO CALLER              @D51IDIS 82800000
         OI    CPCBFLG1,CPCBIAFA IND. MONITORING TO BE ACTIVAT.@D51IDIS 82820000
         B     S117MCL1     SCAN AVAIL. PCBS                   @D51IDIS 82840000
         SPACE 1                                               @D51IDIS 82860000
*---------------------------------------------------------------------  82880000
* S117MCL3 - PROCESS DEACTIVATION OF A DYNAMIC CLASS                    82900000
*---------------------------------------------------------------------  82920000
S117MCL0 DS    0H                                              @D51IDIS 82940000
         TM    CPCBFLG1,CPCBIAFA IAF ALREADY ACTIVE FOR CLASS ?@D51IDIS 82960000
         BZR   R2           NO, RETURN TO CALLER               @D51IDIS 82980000
         NI    CPCBFLG1,XFF-CPCBIAFA IND.MONIT.TO BE DEACTIVAT.@D51IDIS 83000000
S117MCL1 DS    0H                                              @D51IDIS 83020000
         ICM   R4,15,CPCBPLOW AT LEAST ONE PCB AVAILABLE ?     @D51IDIS 83040000
         BZR   R2           NO, RETURN TO CALLER               @D51IDIS 83060000
         LA    R3,CPCBCBPT  GET FIRST PCB ADDRESS              @D51IDIS 83080000
         B     S117MCL2     START LOOP OVER PCBS               @D51IDIS 83100000
         EJECT ,                                               @D51IDIS 83120000
*---------------------------------------------------------------------  83140000
* S117MCLL - LOOP FOR ALL ALLOCATED PARTITIONS WITHIN CLASS             83160000
*---------------------------------------------------------------------  83180000
S117MCLL DS    0H                                              @D51IDIS 83200000
         CR    R3,R4        ALL PCBS PROCESSED ?               @D51IDIS 83220000
         BNLR  R2           YES,  RETURN TO CALLER             @D51IDIS 83240000
         LA    R3,4(,R3)    POINT TO NEXT PCB                  @D51IDIS 83260000
S117MCL2 DS    0H                                              @D51IDIS 83280000
         L     R5,0(,R3)    GET PCB ADDRESS                    @D51IDIS 83300000
         USING PCBADR,R5                                       @D51IDIS 83320000
         ICM   R5,15,PCBIVMPT IVMCIMSP AVAILABLE ?             @D51IDIS 83340000
         BZ    S117MCLL     NO, LOOP                           @D51IDIS 83360000
         USING IVMCIMSP,R5                                     @D51IDIS 83380000
         TM    MSPARTST,MSPON IAF ACTIVE FOR PARTITION ?       @D51IDIS 83400000
         BZ    S117MCLL     NO, LOOP                           @D51IDIS 83420000
         NI    MSPARTST,XFF-MSPDELOF RESET DEL.DEACT.INDICATION@D51IDIS 83440000
         LTR   R0,R0        ACTIVATION REQUEST ?               @D51IDIS 83460000
         BZ    S117MCLL     YES, LOOP                          @D51IDIS 83480000
         OI    MSPARTST,MSPDELOF SET PARTITION IN DEACTIVATION @D51IDIS 83500000
         OI    S117SPER,S117ER04 INDICATE RETURN CODE 4        @D51IDIS 83520000
         B     S117MCLL     LOOP FOR ALL PARTITIONS OF CLASS   @D51IDIS 83540000
         DROP  R5                                              @D51IDIS 83560000
         DROP  RA                                              @D51IDIS 83580000
         DROP  RD                                              @D51IDIS 83600000
         EJECT ,                                                        83620000
**********************************************************************  83640000
* S117IWRK - INITIALZE WORK AREA OF CLASS RELATED ENTRIES               83660000
*            INPUT:                                                     83680000
*              R0  - FUNCTION CODE                                      83700000
*                    NEGATIVE = INITIALZE WORK STRING                   83720000
*                       0     = IND. ALL CLASSES TO BE MONITORED        83740000
*                       1     = REMOVE MONITOR INDICATION               83760000
*              R2  - RETURN ADDRESS                                     83780000
*              RC  - BASE REGISTER                                      83800000
*              RD  - IVMCIMSS ADDRESS                                   83820000
*            WORK:                                                      83840000
*              R0, R4, R7, RA, RE                                       83860000
**********************************************************************  83880000
         USING IVMCIMSS,RD                                     @D51IDIS 83900000
*SGLINK  S117IWRK,S,INPUT=(R0,R2,RC,RD),WORK=(R0,R4,R7,RA,RE)           83920000
S117IWRK DS    0F                                                       83940000
*              INITIALIZE LOOP                                          83960000
         ICM   R4,15,IJBCLTAB CLASS TABLE AVAILABLE ?          @D51IDIS 83980000
         BZ    S117IWRE       NO, CLEAR CLASS CHARACTERS       @D51IDIS 84000000
         LA    R4,S117SIDC  GET WORK STRING ADDRESS            @D51IDIS 84020000
         L     RE,ACPCBTAB  GET ADDRESS OF CPCB TABLE          @D51IDIS 84040000
         LR    R7,RE        GET END INDICATOR FOR LOOP         @D51IDIS 84060000
S117IWRL DS    0H                                              @D51IDIS 84080000
         L     RA,0(,RE)    GET FIRST CPCB ADDRESS             @D51IDIS 84100000
         USING CPCBADR,RA                                      @D51IDIS 84120000
         LTR   R0,R0        INITIALIZATION TO BE DONE ?        @D51IDIS 84140000
         BNM   S117IWR2     NO, CHECK FOR OTHER FUNCTION       @D51IDIS 84160000
         MVC   0(2,R4),CPCBCLSS MOVE CLASS CHARACTER           @D51IDIS 84180000
         LA    R4,2(,R4)    POINT TO NEXT WORK STRING ENTRY    @D51IDIS 84200000
S117IWR1 DS    0H                                              @D51IDIS 84220000
         LA    RE,4(,RE)    POINT TO NEXT CPCB ADDRESS         @D51IDIS 84240000
         C     R7,0(,RE)    ALL CPCB ENTRIES PROCESSED         @D51IDIS 84260000
         BNE   S117IWRL     NO, PROCESS NEXT ENTRY             @D51IDIS 84280000
         BR    R2           RETURN TO CALLER                   @D51IDIS 84300000
         SPACE 2                                               @D51IDIS 84320000
S117IWR2 DS    0H                                              @D51IDIS 84340000
         STM   R2,R5,S117SAVE SAVE REGISTERS                   @D51IDIS 84360000
         BAL   R2,S117MCLS  PROCESS ACT./DEACT. OF CLASS       @D51IDIS 84380000
*SGLINK S117MCLS,INPUT=(R0,R2,RA,RC,RD),WORK=(R3,R4,R5)                 84400000
         LM    R2,R5,S117SAVE RESTORE REGISTERS                @D51IDIS 84420000
         B     S117IWR1     RETURN TO MAIN PATH                @D51IDIS 84440000
         DROP  RA                                              @D51IDIS 84460000
         DROP  RD                                              @D51IDIS 84480000
         SPACE 2                                               @D51IDIS 84500000
S117IWRE DS    0H                                                       84520000
         XC    S117SIDC(S117SICL),S117SIDC CLEAR CLASS CHAR.S  @D51IDIS 84540000
         BR    R2           RETURN TO CALLER                   @D51IDIS 84560000
.NVM801  ANOP                                                  @D51IDIS 84580000
         EJECT ,                                                        84600000
**********************************************************************  84620000
* S117GNO - IS CALLED FOR INVENT ON,NOTPART=...                         84640000
*           AND CHECKS, IF ALL PARTITIONS ARE SPECIFIED.                84660000
*           INPUT:                                                      84680000
*             R2  - RETURN REGISTER                                     84700000
*             R9  - BIT STRING OF PART.S SPECIFIED                      84720000
*             RC  - BASE REGISTER                                       84740000
*           OUTPUT:                                                     84760000
*             RF  - RETURN REGISTER                                     84780000
*                       0 - ALL PARTITIONS ARE SPECIFIED                84800000
*                   NOT 0 - OTHERWISE                                   84820000
*           WORK:                                                       84840000
*             R4, R5, R8                                                84860000
**********************************************************************  84880000
*SGLINK  S117GNO,S,INPUT=(R2,R9,RC),OUTPUT=(RF),WORK=(R4,R5,R7,R8)      84900000
S117GNO  DS    0F                                                       84920000
         LR    R5,R9        GET BIT STRING                              84940000
         LA    RF,&NPART    INITIALIZE COUNT OF SPEC. LOG IDS  @D51IDIS 84960000
         AIF   (&BGVM).NVM802                                  @D51IDIS 84980000
         ICM   R4,15,IJBCLTAB CLASS TABLE AVAILABLE ?          @D51IDIS 85000000
         BZ    S117GNOS       NO, DO ONLY CHECK FOR STATIC PART@D51IDIS 85020000
         LA    RF,&NUM      INITIALIZE COUNT OF SPEC. LOG IDS  @D51IDIS 85040000
S117GNOS DS    0H                                              @D51IDIS 85060000
.NVM802  ANOP                                                  @D51IDIS 85080000
         LR    R4,RF        INITIALIZE LOOP COUNT              @D51IDIS 85100000
S117GNO0 DS    0H           START OF LOOP                               85120000
         L     R8,S117SHBT  GET BIT STRING (FIRST BIT ON)               85140000
         NR    R8,R5        LOOK FOR PARTITION TO BE MONITORED          85160000
         BZ    S117GNO1     NO, CONTINUE                                85180000
         BCTR  RF,0         DECREASE INDEX VALUE                        85200000
S117GNO1 DS    0H                                                       85220000
         SLL   R5,1         LOOK FOR NEXT PARTITION                     85240000
         BCT   R4,S117GNO0  LOOP UNTIL ALL POSS.LOG IDS SCANNED@D51IDIS 85260000
         BR    R2           RETURN TO CALLER                            85280000
         EJECT ,                                                        85300000
**********************************************************************  85320000
*         - INVENT SVC DATA AREAS                                       85340000
**********************************************************************  85360000
         DS    0D                                                       85380000
S117SAVE DC    4F'0'                                           @D51IDIS 85400000
*      SYSLOG IDS OF MONITORED PARTITIONS                               85420000
&X       SETA  1                                                        85440000
S117SID  DS    0F                                                       85460000
.S117SLP ANOP                                                           85480000
         DC    C'&P(&X)'                                                85500000
&X       SETA  &X+1                                                     85520000
         AIF   (&X LE &NPART).S117SLP                                   85540000
         AIF   (&BGVM).NVM000                                  @D51IDIS 85560000
&X       SETA  &NCLASS*2                                       @D51IDIS 85580000
S117SIDC EQU   *                                                        85600000
         DC    &X.C' '                                         @D51IDIS 85620000
S117SICL EQU   *-S117SIDC                                               85640000
.NVM000  ANOP                                                  @D51IDIS 85660000
&X       SETA  1                                               @D51IDIS 85680000
S117PIK  DS    0F                                                       85700000
.S117PLP ANOP                                                           85720000
         DC    AL2(&X*16)                                               85740000
&X       SETA  &X+1                                                     85760000
         AIF   (&X LE &NPART).S117PLP                                   85780000
         AIF   (&BGVM).NVM001                                  @D51IDIS 85800000
&X       SETA  0                                               @D51IDIS 85820000
.S117PL1 ANOP                                                  @D51IDIS 85840000
         DC    AL2(&X*4)                                       @D51IDIS 85860000
&X       SETA  &X+1                                            @D51IDIS 85880000
         AIF   (&X LT &NCLASS).S117PL1                         @D51IDIS 85900000
.NVM001  ANOP                                                  @D51IDIS 85920000
S117PIKW DC    CL(2*&NPART+4)' '                                        85940000
* SUPPORT MAX. 32 PARTITIONS                                            85960000
S117SHBT DC    X'80000000'  BIT STRING FOR SHIFT OPERATION              85980000
S117PBTA DC    X'FFFFFFFF'  BIT STRING (INVENT ON, W/O PARAMETER)       86000000
S117SPER DC    X'00'        SPECIAL RETURN CODE HANDLING                86020000
         DS    0F                                                       86040000
S117MAXS DC    AL2(&NPART*2) MAX. LENGTH OF PARAMETER LIST     @D51IDIS 86060000
S117MAXL DC    AL2(&NUM*2)   MAX. LENGTH OF PARAMETER LIST     @D51IDIS 86080000
         DROP  RC                                                       86100000
.NOGEN2  ANOP                                                  @D61NDIS 86110061
         MEND                                                           86120000
* END OF PLS COMMENT */ %IVMCI : ;                                      86140000
* /*-----------------------------------------------------------------*  86160000
*  *  IVMCIMSS - IAF'S SYSTEM CONTROL BLOCK                          *  86180000
*  *-----------------------------------------------------------------*/ 86200000
* DECLARE                                                   /*D31ZDIS*/ 86220000
* 1   IVMCIMSS BASED,     /* MAP OF IVMCIMSS                         */ 86240000
*  2  *        PTR(32),   /* ENTRY POINT FOR HOOKS                   */ 86260000
*  2  MSSARCMD PTR(32),   /* ENTRY POINT FOR INVENT COMMAND          */ 86280000
*  2  MSSMONST BIT(8),    /* FLAG BYTE (MONITOR STATE OF SYSTEM)     */ 86300000
*   3 MSSON    BIT(1),    /*   0  MONITORING ACTIVE (ON)             */ 86320000
*   3 MSSOFF   BIT(1),    /*   1  MONITORING INACTIVE (OFF)          */ 86340000
*   3 MSSDELOF BIT(1),    /*   2  MONITORING DELAYED OFF             */ 86360000
*   3 MSSFORCE BIT(1),    /*   3  MONITORING FORCED                  */ 86380000
*   3 *        BIT(4),    /*  4-7 NOT USED                           */ 86400000
*  2  MSSSTATE BIT(8),    /* FLAG BYTE (STATE OF SYSTEM)             */ 86420000
*   3 MSSIMROB BIT(1),    /*   0  BAM OPEN SUCCESSFUL DONE           */ 86440000
*   3 MSSIMROW BIT(1),    /*   1  OPENIMR WRITE SUCCESSFUL           */ 86460000
*   3 MSSIMROR BIT(1),    /*   2  OPENIMR READ SUCCESSFUL            */ 86480000
*   3 MSSPWACT BIT(1),    /*   3  POWER ACTIVE                       */ 86500000
*   3 *        BIT(4),    /*  4-7 NOT USED                           */ 86520000
*  2 MSSMONS2  BIT(8),    /* FLAG BYTE (MONITOR STATE 2)     @D31FMIS*/ 86540000
*   3 MSSCCSON BIT(1),    /*   0  CICS MONITORING ACTIVE     @D31FMIS*/ 86560000
*   3 MSSPNET  BIT(1),    /*   1  RECEIVE VIA PNET ON        @D31FMIS*/ 86580000
*   3 MSSPNETC BIT(1),    /*   2  COMM. REQUEST ESTABLISHED  @D31FMIS*/ 86600000
*   3 MSSPNETD BIT(1),    /*   3  DEACTIV. PNET COMMUNICATION@D31FMIS*/ 86620000
*   3 *        BIT(4),    /*  4-7 NOT USED                   @D31FMIS*/ 86640000
*  2  *        BIT(8),    /* NOT USED                        @D31FMIS*/ 86660000
*  2  *        PTR(32),   /* SERVICE ROUTINE INDICATOR               */ 86680000
*   3 MSSSERV  BIT(8),    /* FLAG BYTE (SERVICE ROUTINE INDICATOR)   */ 86700000
*    4 MSSIGRA BIT(1),    /*   0  IVMIGR UTILITY ACTIVE              */ 86720000
*    4 MSSIDB  BIT(1),    /*   1  IDB UPDATE ROUTINES ACTIVE         */ 86740000
*    4 *       BIT(6),    /*  2-7 NOT USED                           */ 86760000
*   3 *        PTR(24),   /* MUST BE ZERO BECAUSE OF CS INSTRUCTION  */ 86780000
*  2  MSSIGRAT PTR(16),   /* TASK ID OF IVMIGR UTILITY               */ 86800000
*   3 MSSIDBT  PTR(16),   /* TASK ID OF IDB UPDATE ROUTINES          */ 86820000
*  2  *        PTR(16),   /* NOT USED                                */ 86840000
*  2  MSSPARTN PTR(16),   /* NUMBER OF MONITORED PARTITIONS          */ 86860000
*  2  MSSIERR  BIT(8),    /* FLAG BYTE (SPECIAL RET.CODE FOR IMR TASK*/ 86880000
*   3 MSSLABEL BIT(1),    /*   0  LABEL                              */ 86900000
*   3 MSSGVCE  BIT(1),    /*   1  GETVCE                             */ 86920000
*   3 MSSASSG  BIT(1),    /*   2  ASSIGN                             */ 86940000
*   3 MSSSGVS  BIT(1),    /*   3  SGETVIS                            */ 86960000
*   3 MSSXPCC  BIT(1),    /*   4  XPCC                       @D31FMIS*/ 86980000
*   3 MSSXPWR  BIT(1),    /*   5  VSE/POWER SERVICE          @D31FMIS*/ 87000000
*   3 MSSXBAM  BIT(1),    /*   6  BAM SERVICE                @D31FMIS*/ 87020000
*   3 *        BIT(1),    /*   7  NOT USED                   @D31FMIS*/ 87040000
*  2  MSSIRET  PTR(8),    /* RET.CODE GIVEN BY ABOVE SERVICE         */ 87060000
*  2  MSSIMR   PTR(32),   /* POINTER TO IMR COMM. CONTROL BLOCK      */ 87080000
*  2  MSSIMRUS PTR(16),   /* PERCENTAGE OF USED IMR BLOCKS (0 TO 100)*/ 87100000
*  2  MSSCOND  PTR(16),   /* PERCENTAGE, WHEN IDB ROUTINES POSTED    */ 87120000
*  2  MSSNODE  CHAR(8),   /* NODE ID FOR IDB RECORDS                 */ 87140000
*  2  MSSNPART PTR(16),   /* NUMBER OF GENERATED PARTITIONS (NPARTS) */ 87160000
*  2  *        PTR(16),   /* NOT USED                                */ 87180000
*  2  MSSCTID  PTR(32),   /* POINTER TO CURRENT TASK ID (TID)        */ 87200000
*  2  MSSPLCT  PTR(32),   /* ADDRESS OF LIBRARIAN LCT POINTER        */ 87220000
*  2  IMRGATEA PTR(32),   /* ADDRESS OF IMRGATE ROUTINE              */ 87240000
*  2  ENQBUFFA PTR(32),   /* ADDRESS OF ENQBUFF ROUTINE              */ 87260000
*  2  GETBUFFA PTR(32),   /* ADDRESS OF GETBUFF ROUTINE              */ 87280000
*  2  MSSPTYPE CHAR(8),   /* POWER DEFAULT SLI TYPE                  */ 87300000
*  2  MSSIOWRK PTR(32),   /* ADDRESS OF IMR IO WORK AREA             */ 87320000
*  2  MSSPIERR BIT(8),    /* FLAG BYTE (SPECIAL RET.CODE FOR IDB UPD.*/ 87340000
*   3 MSSPLAB  BIT(1),    /*   0  LABEL                              */ 87360000
*   3 MSSPGVCE BIT(1),    /*   1  GETVCE                             */ 87380000
*   3 MSSPASSG BIT(1),    /*   2  ASSIGN                             */ 87400000
*   3 MSSPGVS  BIT(1),    /*   3  SGETVIS                            */ 87420000
*   3 *        BIT(4),    /*  4-7 NOT USED                           */ 87440000
*  2 MSSPIRET  PTR(8),    /* RET.CODE GIVEN BY ABOVE SERVICE         */ 87460000
*  2 MSSWDESC  PTR(16),   /* WRITE DESCRIPTOR REC. EVERY X PUTS      */ 87480000
*  2 MSSCISLN  FIXED(16), /* LENGTH OF IVMCISAV              @D31FMIS*/ 87500000
*  2 MSSENTRN  FIXED(16), /* NUMBER OF BUFFER ENTRIES        @D31FMIS*/ 87520000
*  2 *         BIT(8),    /* NOT USED                        @D31FMIS*/ 87540000
*  2 MSSMONS3  BIT(8),    /* FLAG BYTE                       @D31FMIS*/ 87560000
*  2 MSSIRES   BIN(8),    /* REASON CODE OF MSSIERR SERVICE  @D31FMIS*/ 87580000
*  2 MSSIFCB   BIN(8),    /* FEEDBACK CODE FROM XPCC (MSSIERR@D31FMIS*/ 87600000
*  2 MSSCONF   PTR(31),   /* ADDRESS TO CONFIG PHASE         @D31FMIS*/ 87620000
*  2 *         CHAR(3),   /* NOT USED                        @D31FMIS*/ 87640000
*  2 MSSFUNCI  CHAR(9),   /* FUNCTION NAME AND LENGTH FOR MSG@D31FMIS*/ 87660000
*   3 MSSFCTLN BIN(8),    /* LENGTH OF FOLLOWING STRING      @D31FMIS*/ 87680000
*   3 MSSFUNCT CHAR(8),   /* FUNCTION NAME                   @D31FMIS*/ 87700000
*  2 MSSUNNOI  CHAR(9),   /* UNKNOWN NODE ID AND MSG LENGTH  @D31FMIS*/ 87720000
*   3 MSSUNNLN BIN(8),    /* LENGTH FOR FOLLOWING STRING     @D31FMIS*/ 87740000
*   3 MSSUNNOD CHAR(8);   /* UNKNOWN NODE ID                 @D31FMIS*/ 87760000
*                                                                       87780000
*                                                                       87800000
* /*-----------------------------------------------------------------*  87820000
*  *  INVPARML - PARAMETER LIST MAPPING FOR INVENTRY FUNC=INVENT     *  87840000
*  *-----------------------------------------------------------------*/ 87860000
* DECLARE                                                   /*D31ZDIS*/ 87880000
* 1   INVPARML BASED,    /* MAP OF INVENTRY PARAMETER LIST           */ 87900000
*  2  PRMLOPC  BIT(8),   /*  FLAG BYTE (OPERATIONS)                  */ 87920000
*   3 PRMON    BIT(1),   /*    0  ALL PARTITIONS TO BE                  87940000
*                                 MONITORED (INVENT ON)              */ 87960000
*   3 PRMONPA  BIT(1),   /*    1  PARTITIONS IN SYSLOG ID BUFFER TO     87980000
*                                 BE MONITORED (INVENT ON,PART=...)  */ 88000000
*   3 PRMONNP  BIT(1),   /*    2  PARTITIONS NOT TO BE MONITORED IN     88020000
*                                 SYSLOG ID BUFFER                      88040000
*                                 (INVENT ON,NOTPART=...)            */ 88060000
*   3 PRMOFF   BIT(1),   /*    3  DEACTIVATE MONITORING (INVENT OFF) */ 88080000
*   3 PRMFORCE BIT(1),   /*    4  FORCED DEACT. (INVENT OFF,FORCE)   */ 88100000
*   3 PRMDISPL BIT(1),   /*    5  DISPLAY CURRENT STATE (INVENT)     */ 88120000
*   3 PRMREL2  BIT(1),   /*    6  RELEASE 2 INDICATOR        @D31FMIS*/ 88140000
*   3 *        BIT(1),   /*    7  NOT USED                   @D31FMIS*/ 88160000
*  2  PRMSTATE BIT(8),   /*  FLAG BYTE (MONITOR STATE)               */ 88180000
*   3 PRMSON   BIT(1),   /*    0  IAF ACTIVE                         */ 88200000
*   3 PRMSOFF  BIT(1),   /*    1  IAF INACTIVE                       */ 88220000
*   3 PRMDELOF BIT(1),   /*    2  DELAYED DEACTIVATION               */ 88240000
*   3 PRMFOROF BIT(1),   /*    3  FORCED DEACTIVATION                */ 88260000
*   3 PRMOPEN  BIT(1),   /*    4  IMR FILE OPENED                    */ 88280000
*   3 PRMNOTOP BIT(1),   /*    5  IMR FILE NOT OPENED                */ 88300000
*   3 *        BIT(2),   /*   6-7 NOT USED                           */ 88320000
*  2  PRMLACT  PTR(16),  /*  NUMBER OF SYSLOG IDS IN BUFFER (ACT.)   */ 88340000
*  2  PRMARPT  PTR(32),  /*  ADDRESS OF SYSLOG ID BUFFER    (ACT.)   */ 88360000
*  2  PRMRET   PTR(16),  /*  ADDITIONAL RETURN CODE INFORMATION      */ 88380000
*  2  PRMLDACT PTR(16),  /*  NUMBER OF SYSLOG IDS IN BUFFER (DEACT.) */ 88400000
*  2  PRMDAPT  PTR(32),  /*  ADDRESS OF SYSLOG ID BUFFER    (DEACT.) */ 88420000
*  2  PRMLOPC2 BIT(8),   /*  FLAG BYTE (OPERATIONS 2)        @D31FMIS*/ 88440000
*   3 PRMIMRON BIT(1),   /*    0  ACT. LST RETRIEVEL (IMR=ON)@D31FMIS*/ 88460000
*   3 PRMIMROF BIT(1),   /*    1  DEACT.  LST RETR. (IMR=OFF)@D31FMIS*/ 88480000
*   3 PRMCICON BIT(1),   /*    2  ACT. CICS MON. (CICS=ON)   @D31FMIS*/ 88500000
*   3 PRMCICOF BIT(1),   /*    3  DEACT. CICS MON.(CICS=OFF) @D31FMIS*/ 88520000
*   3 *        BIT(4),   /*   4-7 NOT USED                   @D31FMIS*/ 88540000
*  2  PRMSTAT2 BIT(8),   /*  FLAG BYTE (MONITOR STATE 2)     @D31FMIS*/ 88560000
*   3 PRMCONF  BIT(1),   /*    0  IVMPLMV NOT FOUND IN SVA   @D31FMIS*/ 88580000
*   3 PRMPUON  BIT(1),   /*    1  LST QUEUE RETRIEVAL ACTIVE @D31FMIS*/ 88600000
*   3 PRMPUOFF BIT(1),   /*    2  LST QUEUE RETRIEVAL INACT. @D31FMIS*/ 88620000
*   3 PRMPUDAC BIT(1),   /*    3  LST QUEUE RETR. DEL. DEACT.@D31FMIS*/ 88640000
*   3 PRMSCION BIT(1),   /*    4  CICS MONITORING ACTIVE     @D31FMIS*/ 88660000
*   3 PRMSCIOF BIT(1),   /*    5  CICS MONITORING INACTIVE   @D31FMIS*/ 88680000
*   3 PRMSLAVE BIT(1),   /*    6  SLAVE NODE                 @D31FMIS*/ 88700000
*   3 *        BIT(1),   /*    7  NOT USED                   @D31FMIS*/ 88720000
*  2  PRMSNODE CHAR(8),  /*  PNET ID OF RECEIVING NODE       @D31FMIS*/ 88740000
*  2  PRMSCLAS CHAR(1),  /*  LST CLASS OF RECEIVING NODE     @D31FMIS*/ 88760000
*  2  *        CHAR(1),  /*  NOT USED                        @D31FMIS*/ 88780000
*  2  PRMACTPT PTR(32),  /*  BUFF.ADDR.CONTAINING ACTIVE ENTR@D31FMIS*/ 88800000
*  2  PRMACTLN PTR(16),  /*  NO.OF ENTRIES WITHIN ABOVE BUFF.@D31FMIS*/ 88808000
*  2  *        PTR(16),  /*  NOT USED                        @D31FMIS*/ 88816000
*  2  PRMCICPT PTR(32),  /*  ADDR.OF BUFFER CONT.ACT.CICS ENT@D31FMIS*/ 88824000
*  2  PRMCICLN PTR(16);  /*  NO.OF ENTRIES WITHIN ABOVE BUFF.@D31FMIS*/ 88832000
*                                                                       88840000
*                                                                       88860000
* /*-----------------------------------------------------------------*  88880000
*  *  IVMCIMSP - IAF'S PARTITION CONTROL BLOCK                       *  88900000
*  *-----------------------------------------------------------------*/ 88920000
* DECLARE                                                   /*D31ZDIS*/ 88940000
* 1   IVMCIMSP BASED,    /* MAP OF IAF'S PARTITION CONTROL BLOCK     */ 88960000
*  2  MSPLEN   PTR(16),  /* LENGTH OF CONTROL BLOCK                  */ 88980000
*  2  MSPARTST BIT(8),   /* FLAG BYTE (MONITOR STATE OF PARTITION)   */ 89000000
*   3 MSPON    BIT(1),   /*   0  MONITORING ACTIVE (ON)              */ 89020000
*   3 MSPOFF   BIT(1),   /*   1  MONITORING INACTIVE (OFF)           */ 89040000
*   3 MSPIGN   BIT(1),   /*   2  DO NOT MONITOR SVC HOOK (ENTSVC)    */ 89060000
*   3 MSPDELOF BIT(1),   /*   3  DELAYED DEACTIVATION                */ 89080000
*   3 *        BIT(4),   /*  4-7 NOT USED                            */ 89100000
*  2  MSPSFLAG BIT(8),   /* FLAG BYTE (MONITORING INDICATION)        */ 89120000
*   3 MSPSVC0C BIT(1),   /*   0  SVC 0 CONSOLE I/O                   */ 89140000
*   3 MSPCICSE BIT(1),   /*   1  CICS MONITORING ENABLED     @D31FMIS*/ 89153300
*   3 *        BIT(6),   /*  2-7 NOT USED                    @D31FMIS*/ 89166600
*  2  MSPAPCB  PTR(32),  /* CORRESPONDING PCB ADDRESS                */ 89180000
*  2  MSPMONLV PTR(16),  /* MONITOR LEVEL                            */ 89200000
*  2  MSPARTFG BIT(8),   /* SUBSYSTEM INFORMATION FLAGS              */ 89220000
*  2  *        PTR(8),   /* NOT USED                                 */ 89240000
*  2  MSPBUFDS PTR(32),  /* POINTER TO BUFFER DESCRIPTOR             */ 89260000
*  2  MSPASAVE PTR(32);  /* SAVE AREA POINTER TO IVMCISAV            */ 89280000
