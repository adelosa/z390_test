*%GOTO MFCPDCL; /*ASSEMBLER VERSION INCLUDED WITHIN A PLS COMMENT       00001000
         MACRO                                                          00002000
         FCPDCL                                                         00003000
.**************************************************************         00004000
.*       IBM DISK OPERATING SYSTEM                            *         00005000
*        FCPDCL - 5686-CF7-06                                 *         00006000
         AGO   .ZZZ                                           *         00007000
*        LICENSED MATERIALS - PROPERTY OF IBM                 *         00008000
*        "RESTRICTED MATERIALS OF IBM"                        *         00009000
*        5686-CF7                                             *         00010000
*        (C) COPYRIGHT IBM CORP. 2004, 2005                   *         00011490
.ZZZ     ANOP                                                 *         00012000
.** START OF SPECIFICATIONS ******************************************* 00013000
.*01* MODULE-TYPE = MACRO                                             * 00014000
.*                                                                    * 00015000
.*01* DESCRIPTIVE NAME = This macro describes the layout of           * 00016000
.*                       FCP releated control blocks                  * 00017000
.*                                                                    * 00018000
.*  CHANGE ACTIVITIES=  NEW MACRO   FIRST RELEASE z/VSE 3.1    @D68DDMZ 00019000
.*                                                                      00020000
.*  A000000-999999                                             @D68DDMZ 00021000
.** END OF SPECICATIONS *********************************************** 00022000
              OSADCLC NAME=FCP                                          00023000
              AGO .SKIP  OSADCLC generates following code               00024000
FCP_CARD      DSECT                                                     00025000
FCPSPNAM      DS  CL8                                                   00026000
              DS  CL4                                                   00027000
FCP_CARD_NEXT DS  A                                                     00028000
FCP_CARD_PREV DS  A                                                     00029000
FCP_CARD_NEXTR DS A            Real addr of next FCP  card              00030000
FCP_CARD_REAL DS  A            Real addr of FCP  card                   00031000
FCP_DEV_DSCI  DS  X            Must be on fw bdy, used by CS            00032000
FCP_DEV_FLG2  DS  X            Device features                          00033000
THININT       EQU X'80'                                                 00034000
              DS  H            Reserved for future use                  00035000
.SKIP         ANOP       end of OSADCLC generated code                  00036000
FCP_PUBX      DS  A            Pubx pointer                             00037000
FCP_PUBIDX    DS  H            pub index                                00038000
FCP_DEVTCODE  DS  X            VSE device type code                     00039000
FCP_DEVTQUAL  DS  X            Device type qualifier                    00040000
FCP_DEVTYPE   DS  H            Device type number                       00041000
FCP_CUTYPE    DS  H            Cu unit type number                      00042000
FCP_DEVMODEL  DS  X            Device type model number                 00043000
FCP_CUMODEL   DS  X            CU unit type model number                00044000
FCP_FEAT      DS  X            Features taken from store qdio           00045000
FCP_PCI       EQU X'80'        PCI generated                            00046000
FCP_SIGR      EQU X'40'        siga read needed                         00047000
FCP_SIGW      EQU X'20'        siga write needed                        00048000
FCP_SIGS      EQU X'10'        siga sync needed                         00049000
FCP_FLG1      DS  X            Add. device features                     00050000
FCP_LPM       DS  X            LPM needed for IPL from scsi             00051000
              DS  X            Reserved for future use                  00052000
FCP_CHPID     DS  X            Chpid of device                          00053000
FCP_STATUS    DS  X            Status byte                              00054000
FCP_CLSUB_DONE EQU X'80'       clear subchannel performed               00055000
FCP_IPL_STG1   EQU X'40'       IPL stage 1                              00056000
FCP_IPL_STG2   EQU X'20'       IPL stage 2                              00057000
FCP_FREECB     EQU X'10'       Free copy blocks during fcpterm          00058000
FCP_VMSYS      EQU X'08'       Running under VM                         00059000
FCP_IPL_DEV3   EQU X'04'       IPL stage 2, end of 3 device system      00060000
FCP_NMSG       EQU X'02'       WTOR not yet usable, set by ijbfcp       00061000
*                              reset by IPL                             00062000
FCP_TDMP       EQU X'01'       TAPE SA dump                             00063000
FCP_STATUS1   DS  X            Status byte                              00064000
FCP_REMAPP    EQU X'80'        Remove appendage                         00065000
FCP_QDIOA     EQU X'40'        Fcp qdio activated (est/act)             00066000
*             EQU X'20'        Reserved for future use                  00067000
*             EQU X'10'        Reserved for future use                  00068000
FCP_CREATED   EQU X'08'        Fcp created with this request            00069000
FCP_OPEN      EQU X'04'        Summary bit, fcp adapter open            00070000
FCP_CLINP     EQU X'02'        Close adapter in progress. Skip close    00071000
*                              port, close lun to avoid timeout in      00072000
*                              case siga initiated function does not    00073000
*                              complete.                                00074000
FCP_DSFCP     EQU X'01'        Default SFCP area (538 entries)          00075000
              DS  3X           Reserved for future use                  00076000
fcp_lic_version DS F           Lic version                              00077000
fcp_fc_topology DS F           Fibre channel network topology           00078000
fcp_adapter_typ DS F           Adapter type                             00079000
fcp_fc_portid   DS F           Local fibre channel port id              00080000
fcp_portname    DS XL8         Portname associated with chpid           00081000
fcp_nodename    DS XL8         Nodename                                 00082000
fcpmaxda        DS F           Max. data transfer size                  00083000
fcpnsbal        DS H           Max. sbal entries for one transfer       00084000
                DS H           Reserved                                 00085000
fcpsfcpl        DS F           Address of sendfcp parameterlist         00086000
fcp_portc       DS A           chain of ports attached to FCP           00087000
fcp_nsoutbuf    DS A           outbuf buffer for nameserver rq.         00088000
fcp_nsinbuf     DS A           input buffer for nameserver rq.          00089000
fcp_portns      DS A           ptr to port of nameserver                00090000
fcp_fsfchain    DS A           chain of ongoing fsf requests            00091000
fcp_astread     DS A           addr of status read buffers              00092000
fcp_afsfstr     DS A           addr of status read fsfreq cbs           00093000
fcp_aqdio       DS A           addr of QDIO control blocks              00094000
fcp_lqdio       DS F           length of QDIO control blocks            00095000
fcp_hostcfeat   DS F           Host connection features                 00096490
fcp_errecb      DS 0A          ecb posted by QDIO appendage to          00097000
*                              terminate ongoing FCP request            00098000
*                              initiated by system task (init or        00099000
*                              recovery function)                       00100000
                DS H           unused part of ecb                       00101000
                DS X                                                    00102000
fcp_trabit      EQU X'80'      traffic bit                              00103000
                DS X           unused part of ecb                       00104000
fcp_recflg      DS X           recovery flag                            00105000
fcp_receq       EQU X'40'      adapter rec. request enqueued            00106000
fcp_recac       EQU X'20'      adapter rec. request active              00107000
fcp_pioerr      EQU X'10'      adapter not usable, rec. failed          00108000
fcp_recout      EQU X'08'      recovery not scheduled because           00109000
***                            ...no req element available              00110000
fcp_termonly    EQU X'04'      ...and perform termination only          00111000
fcp_ldmsg       EQU X'01'      link down message written                00112000
fcp_mreccnt     DS X           max. count for adapter recovery          00113000
fcp_areccnt     DS X           act. adapter recovery count              00114000
                DS X           reserved for future use                  00115000
inbound_processed_count DS X                                            00116000
inbound_next_buffer_to_process DS X                                     00117000
inbound_last_queued_buffer DS  X                                        00118000
inbound_next_buffer_init DS X                                           00119000
element         DS  X                                                   00120000
                DS  XL3                                                 00121000
inbound_slsbptr DS  A                                                   00122000
inbound_sbal    DS  512X                                                00123000
outbound_used_buffers DS X                                              00124000
outbound_first_free_buffer DS X                                         00125000
outbound_last_processed DS X                                            00126000
                        DS X                                            00127000
outbound_slsbptr DS A                                                   00128000
outbound_sbal   DS  512X                                                00129000
fcp_qfmt        DS X              adapter type set in qib , qdr         00130000
fcp_pfmt        DS X              set in qib, always zero               00131000
fcp_qest        DS 0XL3                                                 00132000
fcp_qest_code   DS X              qdio establish command code           00133000
fcp_qest_lng    DS XL2            qdio establish input length           00134000
fcp_qact        DS 0XL3                                                 00135000
fcp_qact_code   DS X              qdio activate  command code           00136000
fcp_qact_lng    DS XL2            qdio activate  input length           00137000
fcp_reqseqno    DS F              request sequence number in QTCB       00138000
msg_info        DS XL12                                                 00139000
fcp_devno       DS H              cuu of device                         00140000
                DS H              reserved for future use               00141000
fcp_sigai       DS 0F                                                   00142000
fcp_subcc       DS H              set to 0001                           00143000
fcp_subch       DS H              subchannel of device                  00144000
real_ccb        DS A              addr of copy block                    00145000
                DS A              reserved for future use               00146000
ccw1            DS XL8            format 1 ccw                          00147000
ccb             DS XL16           ccb                                   00148000
sensearea       DS XL32           sense area                            00149000
unit_addr2      DS X              relative no of device                 00150000
                DS X              reserved for future use               00151000
devno_flag      DS X              flag byte                             00152000
app_defined     EQU X'80'                                               00153000
cunit_cula      DS X              cula nedded for fcp  ??               00154000
qdrptr          DS A              ptr to qdr                            00155000
qibptr          DS A              ptr to qib                            00156000
amsgarea        DS A              ptr to message area                   00157000
fcp_srfsfchain  DS A              chain of ongoing status read fsf req  00158000
                DS XL4            align fcp_erp on 16 bytes bdy         00159000
fcp_erp         DS XL(FERPLEN)    erp control block                     00160000
                SPACE 5                                                 00161000
***  For each Open Port, one Fcpport control block is allocated         00162000
FCPPORT       DSECT                                                     00163000
PORTEYEC      DS    XL4   eye catcher                                   00164000
PORTNEXT      DS    F     next scsiport cb                              00165000
PORTPREV      DS    F     previous scsiport cb                          00166000
PORTFCPP      DS    F     fcp cb where port is attached to              00167000
PORTWWPN      DS    XL8   64 bit own wwpn                               00168000
PORTD_ID      DS    XL4   last 3 bytes contain d_id of port             00169000
PORTHANDLE    DS    XL4   port handle returned by open port             00170000
PORTLUNC      DS    F     ptr to LUN chain defined for this port        00171000
PORTFLAG      DS    X     flag-byte                                     00172000
PORTOPEN        EQU X'80' port is open                                  00173000
PORTCREAT       EQU X'40' port cb created by this request, reset        00174000
***                       ....after successful def scsi                 00175000
PORTCLPP        EQU X'20' close physical port requested, reset          00176000
***                       ....after completion                          00177000
PORT_RECFLG   DS    X     Recovery flag byte                            00178000
PORTNOPER       EQU X'80' Port not operational                          00179000
*                         -  Adapter not operational                    00180000
PORTRECEQ       EQU X'40' Port recovery request enqueued                00181000
PORTRECAC       EQU X'20' Port recovery request active                  00182000
PORTIOERR       EQU X'10' Port not usable, recovery failed              00183000
PORTRECOUT      EQU X'08' Port recovery not scheduled because           00184000
***                       .. no req element available                   00185000
PORT_MRECCNT    DS  X     Max. count for port recovery                  00186000
PORT_ARECCNT    DS  X     Act. port recovery count                      00187000
              DS    XL8   align in multiples of 16                      00188000
PORT_ERP      DS    XL(FERPLEN)                                         00189000
                SPACE 5                                                 00190000
***  For each Open LUN, one scsilun control block is allocated          00191000
FCPLUN        DSECT                                                     00192000
LUNEYEC       DS    XL4   eye catcher                                   00193000
LUNNEXT       DS    F     ptr to next lun cb                            00194000
LUNPREV       DS    F     ptr to previous lun cb                        00195000
LUNPORT       DS    F     port to which lun is attached                 00196000
LUNID         DS    XL8   8-bytes lun                                   00197000
LUNHANDLE     DS    XL4   lun handle as returned by open lun            00198000
LUNFLAG       DS    X     flag byte                                     00199000
LUNOPEN         EQU X'80' lun is opened                                 00200000
LUNCREAT        EQU X'40' lun created by this request, reset            00201000
LUN_RECFLG    DS    X     Recovery flag byte                            00202000
LUNNOPER        EQU X'80' LUN not operational                           00203000
*                         -  Adapter not operational                    00204000
LUNRECEQ        EQU X'40' lun recovery request enqueued                 00205000
LUNRECAC        EQU X'20' lun recovery request active                   00206000
LUNIOERR        EQU X'10' lun not usable, recovery failed               00207000
LUNRECOUT       EQU X'08' LUN recovery not scheduled because            00208000
***                       .. no req element available                   00209000
LUNWATTN        EQU X'04' LUN waiting for AVR processing (set / reset   00209300
***                       by IJBSCSI (not done, future enhancement)     00209600
LUNFBA        DS    XL2   FBA cuu                                       00210000
LUNQTCB       DS    A     Sendfcp QTCB associated with Lun              00211000
LUNQTCBA      DS    A     Abort QTCB associated with Lun                00212000
LUNPUBX       DS    A     Corresponding pubx                            00213000
LUN_MRECCNT   DS    X     Max. count for LUN recovery                   00214000
LUN_ARECCNT   DS    X     Act. LUN recovery count                       00215000
              DS    XL2   allocate in multiples of 16                   00216000
LUN_ERP       DS    XL(FERPLEN)                                         00217000
                SPACE 5                                                 00218000
FERPREQ         DSECT                                                   00219000
FERP_ACTION    DS     X'00'   RECOVERY ACTION TO BE TAKEN               00220000
FERP_ROADAPT    EQU   X'80'   REOPEN ADAPTER                            00221000
FERP_ROPHYSP    EQU   X'40'   REOPEN PORT (CLOSE PHYSICAL)              00222000
FERP_ROPORT     EQU   X'20'   REOPEN PORT                               00223000
FERP_ROLUN      EQU   X'10'   REOPEN UNIT                               00224000
FERP_TERMONLY   EQU   X'01'   additionally to ROADAPT if only           00225000
***                           ..adapter termination                     00226000
               DS     X'00'   RESERVED                                  00227000
FERP_STATUS1   DS     X'00'   STATUS BYTE                               00228000
FERP_STATUS2   DS     X'00'   STATUS BYTE                               00229000
FERP_FCP       DS     F       POINTER TO FCP_CARD                       00230000
FERP_PORT      DS     F       POINTER TO PORT CB                        00231000
FERP_LUN       DS     F       PTR TO LUN CB                             00232000
FERP_FSFREQ    DS     F       FSFREQ ONGOING FOR THIS ACTION            00233000
               DS     XL12    Align in multiples of 16                  00234000
FERPLEN        EQU    *-FERPREQ                                         00235000
               space 5                                                  00236000
*********************************************************************** 00237000
***         DSECT for Copy Blocks                                   *** 00238000
*********************************************************************** 00239000
COPY_BLOCK      DSECT                                                   00240000
CB_CCB          DS     CL8                                              00241000
CB_CCWPTR       DS     A                                                00242000
                DS     CL4                                              00243000
CB_SENSE_CCW    DS     0CL8                                             00244000
CB_SNS_CCWCOD1  DS     CL1                                              00245000
CB_SNS_CCWFLAG1 DS     CL1                                              00246000
CB_SNS_CCWLNG1  DS     CL2                                              00247000
CB_SNS_CCWBUF1  DS     A                                                00248000
CB_CCW          DS     0CL8                                             00249000
CB_CCWCOD1      DS     CL1                                              00250000
CB_CCWFLAG1     DS     CL1                                              00251000
CB_CCWLNG1      DS     CL2                                              00252000
CB_CCWBUF1      DS     A                                                00253000
                DS     CL28                                             00254000
CB_CARDPTR      DS     A                                                00255000
CB_PUBPTR       DS     A                                                00256000
CB_CHAINPTR     DS     A                                                00257000
               space 5                                                  00258000
*********************************************************************** 00259000
***         Reason codes                                            *** 00260000
*********************************************************************** 00261000
RSN0001  EQU   X'0001'       FCP not added, no pub                      00262000
RSN0002  EQU   X'0002'       FCP not added, no pubx                     00263000
RSN0003  EQU   X'0003'       Extract failed                             00264000
RSN0004  EQU   X'0004'       Not an FCP device, maybe not operational   00265000
RSN0005  EQU   X'0005'       Getvis failed                              00266000
RSN0006  EQU   X'0006'       Pfix failed                                00267000
RSN0007  EQU   X'0007'       No copy blocks avail.                      00268000
RSN0008  EQU   X'0008'       Establish or activate failed               00269000
RSN0009  EQU   X'0009'       Siga-r failed, fcpqdioi                    00270000
RSN000A  EQU   X'000A'       Siga-s failed, fcpsbal                     00271000
RSN000B  EQU   X'000B'       Siga-s failed, doqdio CC=1                 00272000
RSN000C  EQU   X'000C'       Siga-w failed, doqdio CC=1                 00273000
RSN000D  EQU   X'000D'       Xconfig with protocol error                00274000
RSN000E  EQU   X'000E'       Openport with protocol error               00275000
RSN000F  EQU   X'000F'       Openlun  with protocol error               00276000
RSN0010  EQU   X'0010'       Send generic with protocol error           00277000
RSN0011  EQU   X'0011'       Close port with protocol error             00278000
RSN0012  EQU   X'0012'       Close lun with protocol error              00279000
RSN0013  EQU   X'0013'       Close physical port with prot. error       00280000
RSN0014  EQU   X'0014'       Send els with protocol error               00281000
RSN0015  EQU   X'0015'       Reserved                                   00282000
RSN0016  EQU   X'0016'       Reserved                                   00283000
RSN0017  EQU   X'0017'       Adapter status after nameserver request    00284000
RSN0018  EQU   X'0018'       Adapter status after open port             00285000
RSN0019  EQU   X'0019'       Reserved                                   00286000
RSN001A  EQU   X'001A'       timeout after close port                   00287000
RSN001B  EQU   X'001B'       timeout after close lun ??                 00288000
RSN001C  EQU   X'001C'       timeout after close phys. port             00289000
RSN001D  EQU   X'001D'       adapter status after send els              00290000
RSN001E  EQU   X'001E'       Reserved                                   00291000
RSN001F  EQU   X'001F'       VSE timer expired used by various subr.    00292000
RSN0020  EQU   X'0020'       Fcp error ecb posted                       00293000
RSN0021  EQU   X'0021'                                                  00294000
* Nameserver failure                                                    00295000
RSN0022  EQU   X'0022'       FSF error                                  00296000
RSN0023  EQU   X'0023'       Nameserver request failed                  00297000
* Port failure                                                          00298000
RSN0024  EQU   X'0024'       fsf error during openport                  00299000
RSN0025  EQU   X'0025'       max number of ports exc                    00300000
RSN0026  EQU   X'0026'       FSF status during close port               00301000
RSN0027  EQU   X'0027'       FSF status during send els                 00302000
* Xconfig failure                                                       00303000
RSN0028  EQU   X'0028'       Invalid network topology                   00304000
RSN0029  EQU   X'0029'       prot_host failure during xconfig           00305000
* Lun failure                                                           00306000
RSN002A  EQU   X'002A'       Lun already open or access denied          00307000
RSN002B  EQU   X'002B'       Max. number of luns exceeded               00308000
RSN002C  EQU   X'002C'       Lun already open                           00309000
RSN002D  EQU   X'002D'       FSF failure during open lun                00310000
RSN002E  EQU   X'002E'       FSF status during close lun                00311000
RSN002F  EQU   X'002F'       LUN already opened on this chpid           00312000
RSN0030  EQU   X'0030'       All outbound buffers in use                00313000
* Close adapter failure                                                 00314000
RSN0031  EQU   X'0031'       Close adapter: FCP not initialized         00315000
RSN0032  EQU   X'0032'       Close adapter: Freevis failure             00316000
* Send els failure                                                      00317000
RSN0040  EQU   X'0040'       Send els - port not longer valid           00318000
* Xconfig failure                                                       00318200
RSN0045  EQU   X'0045'       Store clock does not work                  00318400
RSN0046  EQU   X'0046'       NPIV failure                               00318600
* Invalid LUN number                                                    00319000
RSN0050  EQU   X'0050'       Fields not zero when periph. addressing    00320000
RSN0051  EQU   X'0051'       Fields not zero when flat space addr.      00321000
RSN0052  EQU   X'0052'       Unsupported address method                 00322000
* Open failure                                                          00323000
RSN0055  EQU   X'0055'       Multipath not allowed for lock file device 00324000
RSN0056  EQU   X'0056'       Access denied during Open LUN              00325000
RSN0057  EQU   X'0057'       Access denied during Open Port             00326000
* Error in fcpfcard routine                                             00327000
RSN0060  EQU   X'0060'       Device not operational                     00328000
RSN0061  EQU   X'0061'       Not an FCP device                          00329000
* Error in do_chsc routine  - no thin interrupt support                 00330000
RSN0065  EQU   X'0065'       CHCS with CC                               00331000
RSN0066  EQU   X'0066'       CHCS completed unsuccessfully              00332000
* Error in fcp_enqueue_adapter routine                                  00333000
RSN0070  EQU   X'0070'       Maximum number of adapters defined         00334000
RSN0071  EQU   X'0071'       Exchange config data incomplete            00335000
RSN0072  EQU   X'0072'       Unexpected fsf status during xconfig       00336000
RSN0073  EQU   X'0073'       SIGA-s CC=3                                00337000
RSN0074  EQU   X'0074'       SIGA-w CC=3                                00338000
* Reason code set fcpgnext routine                                      00339000
* In debug mode, IJBFCPAP writes a debug entry in the SCSI trace        00340000
* area. Furthermore a general message is issued by IJBFCPAP.            00341000
RSN0080  EQU   X'0080'       Siga-s CC                                  00342000
RSN0081  EQU   X'0081'       Siga-s CC                                  00343000
RSN0082  EQU   X'0082'       SLSB halted                                00344000
RSN0083  EQU   X'0083'       SLSB in error                              00345000
RSN0084  EQU   X'0084'       Unexpected SLSB                            00346000
RSN0085  EQU   X'0085'       SIGA-S CC in fcp_return_buffer             00347000
RSN0086  EQU   X'0086'       SIGA-read did not complete with cc=1       00348000
* Reason code set doioipl routine                                       00349000
RSN0090  EQU   X'0090'       CC after clear subchannel                  00350000
RSN0091  EQU   X'0091'       CC after test  subchannel                  00351000
RSN0092  EQU   X'0092'       Unexpected device / subchannel status      00352000
RSN0093  EQU   X'0093'       CC after start subchannel                  00353000
RSN0094  EQU   X'0094'       CC after test  subchannel (tsch)           00354000
RSN0095  EQU   X'0095'       Unexpected device / subchannel status      00355000
RSN0096  EQU   X'0096'       TSCH with CC                               00356000
RSN0097  EQU   X'0097'       Not a PCI interrupt                        00357000
RSN0098  EQU   X'0098'       Invalid output from fcpgnext               00358000
RSN0099  EQU   X'0099'       FSF_FCP_RSP_AVAILABLE                      00359000
RSN009A  EQU   X'009A'       Unexpected fsf status                      00360000
RSN009B  EQU   X'009B'       Unexpected qtcb status                     00361000
RSN009C  EQU   X'009C'       SSCH for sense with CC /= 0                00362000
RSN009D  EQU   X'009D'       TSCH after sense with unexpected CC        00363000
RSN009E  EQU   X'009E'       Unit check with sense data available       00364000
*********************************************************************** 00365000
***         Reason code set by I/O interrupt appendage              *** 00366000
*********************************************************************** 00367000
RSN0100  EQU   X'0100'     protocol error                               00368000
RSN0101  EQU   X'0101'     link is down                                 00369000
RSN0102  EQU   X'0102'     PROT_FSF_STATUS_PRESENTED                    00370000
RSN0103  EQU   X'0103'     FSF_port_boxed (port recovery scheduled)     00371000
RSN0104  EQU   X'0104'     SIGA failed                                  00372000
RSN0105  EQU   X'0105'     Access rights violation                      00373000
RSN0106  EQU   X'0106'     unsolicited interrupt 'port closed'          00374000
RSN0107  EQU   X'0107'     unsolicited interrupt 'bit error threshold'  00375000
RSN0108  EQU   X'0108'     unsolicited interrupt 'link down'            00376000
RSN0109  EQU   X'0109'     unsolicited interrupt 'link up'              00377000
RSN010A  EQU   X'010A'     unsolicited interrupt 'incomming ELS'        00378000
RSN010B  EQU   X'010B'     I/O error (unit check) on FCP device         00379000
RSN010C  EQU   X'010C'     I/O error on FCP device                      00380000
RSN010D  EQU   X'010D'     adapter is offline, restart                  00381000
***                        ..only possible with ONLINE command          00382000
RSN010E  EQU   X'010E'     timeout was presented for establish command  00383000
RSN010F  EQU   X'010F'     temporary resource problem,use ONLINE        00384000
***                        ...command to restart adapter recovery       00385000
RSN0110  EQU   X'0110'     machine check presented or 'ready interrupt' 00386000
***                        ...due to online command                     00387000
RSN0111  EQU   X'0111'     presented fsf-status not expected (not       00388000
***                        ...defined at implementation)                00389000
RSN0112  EQU   X'0112'     presented unsoliceted status not             00390000
***                        ...expected (not defined at implementation)  00391000
RSN0113  EQU   X'0113'     presented ELS type not handled               00392000
RSN0114  EQU   X'0114'     FSF Status LUN boxed, LUN recovery           00393000
***         Reason code set FCPDEL routine                          *** 00394000
RSN0130  EQU   X'0130'     Invalid input provided by SYSDEF             00395000
RSN0131  EQU   X'0131'     Invalid input provided by SYSDEF             00396000
                MEND                                                    00397000
* END OF PLX COMMENT */ %MFCPDCL: ;                                     00398000
*/********************************************************************/ 00399000
*/*                                                                  */ 00400000
*/*  Macro Name: FCPDCL                                              */ 00401000
*/*                                                                  */ 00402000
*/*  This macro contains declarations used by IJBFCP.                */ 00403000
*/*  The first part of the macro must be common with OSADCL since    */ 00404000
*/*  it is used in supervisor thin interrupt handler and the logic   */ 00405000
*/*  is common for both FCP, OSA Express and HiperSockets adapter.   */ 00406000
*/*                                                                  */ 00407000
*/*   LICENSED MATERIALS - PROPERTY OF IBM                           */ 00408000
*/*   "RESTRICTED MATERIALS OF IBM"                                  */ 00409000
*/*   5686-CF7                                                       */ 00410000
*/*   (C) COPYRIGHT IBM CORP. 2004                                   */ 00411000
*/*                                                                  */ 00412000
*/* Change Activity                                                  */ 00413000
*/* First Release z/VSE 3.1                                  @D68DDMZ*/ 00414000
*/*                                                                  */ 00415000
*/*                                                                  */ 00416000
*/* A - 000000-999999                                        @D68DDMZ*/ 00417000
*/* Part used in thin_int must be common with osa express            */ 00418000
*/********************************************************************/ 00419000
*/********************************************************************/ 00420000
*/* QDIO Constants                                                   */ 00421000
*/********************************************************************/ 00422000
*DCL                                                                    00423000
* QDIO_MAX_BUFFERS_PER_Q fixed(8) constant(128);                        00424000
*                                     /* max buffers per queue, arch.*/ 00425000
*DCL                                                                    00426000
* QDIO_MAX_BUFFERS_PER_IQ fixed(8) constant(128);/* to be evaluated  */ 00427000
*                                                                       00428000
*DCL                                                                    00429000
* QDIO_MAX_BUFFERS_PER_OQ fixed(8) constant(128);/* to be evaluated  */ 00430000
*DCL                                                                    00431000
* QDIO_MAX_ELEMENTS_PER_BUFFER fixed(8) constant(16); /* hardware    */ 00432000
*DCL ONESBAL fixed(8)   constant(1); /*                              */ 00433000
*/********************************************************************/ 00434000
*/*  Error  constants                                                */ 00435000
*/********************************************************************/ 00436000
*/* Return codes set by Fcp_init                                     */ 00437000
*/*  Do NOT change the values: Used by IPL in this sequence          */ 00438000
*/* Return code 0 - Fcp_init completed successfully                  */ 00439000
*DCL NOTOPER  fixed(31) constant(4);/* Device not operational        */ 00440000
*DCL ENOMEM   fixed(31) constant(8);/* Storage could not be allocated*/ 00441000
*DCL EIO      fixed(31) constant(12);/* I/O error                    */ 00442000
*DCL CONFIGER fixed(31) constant(16);/* Configuration error          */ 00443000
*DCL GETVR based(addr(EIO));                                            00444000
*/* Return codes used by Fcp_sfcp (not ipl stage 1)                  */ 00445000
*/* Return code 0 : OK                                               */ 00446000
*/* Return code 4 : Device not operationl (NOTOPER)                  */ 00447000
*DCL RECONG based(addr(ENOMEM));    /* Recovery ongoing  = 8         */ 00448000
*DCL RECFAIL based(addr(EIO));      /* Recovery failed   = 12        */ 00449000
*DCL FCPBUSY  fixed(31) constant(20);/* All output buffers in use    */ 00450000
*/* Return codes used by Fcp_sfcp (ipl stage 1)                      */ 00451000
*/* Return code 0 : OK (sendfcp completed successfully)              */ 00452000
*/* Return code 4 : Sendfcp with fcp response data available         */ 00453000
*/* Return code 8 : Any kind of error                                */ 00454000
*DCL IO_FCPR based(addr(NOTOPER)); /* FCP response data available    */ 00455000
*DCL IO_ERR  based(addr(ENOMEM));  /* IO error                       */ 00456000
*/* Return codes used by fcpcport                                    */ 00457000
*DCL ADAPREC based(addr(NOTOPER));  /* Adapter recovery initiated    */ 00458000
*DCL PORTREC based(addr(ENOMEM));   /* Initiate port recovery        */ 00459000
*/********************************************************************/ 00460000
*/* Reason codes                                                     */ 00461000
*/********************************************************************/ 00462000
*DCL RSN0001 fixed(16) constant('0001'x); /* FCP not added, no pub   */ 00463000
*DCL RSN0002 fixed(16) constant('0002'x); /* FCP not added, no pubx  */ 00464000
*DCL RSN0003 fixed(16) constant('0003'x); /* Extract failed          */ 00465000
*DCL RSN0004 fixed(16) constant('0004'x); /* Not an FCP device       */ 00466000
*DCL RSN0005 fixed(16) constant('0005'x); /* Getvis failed           */ 00467000
*DCL RSN0006 fixed(16) constant('0006'x); /* Pfix failed             */ 00468000
*DCL RSN0007 fixed(16) constant('0007'x); /* No copy blocks avail.   */ 00469000
*DCL RSN0008 fixed(16) constant('0008'x); /* Est.or Activate failed  */ 00470000
*DCL RSN0009 fixed(16) constant('0009'x); /* Siga-r failed, fcpqdioi */ 00471000
*DCL RSN000A fixed(16) constant('000A'x); /* Siga-s failed, fcpsbal  */ 00472000
*DCL RSN000B fixed(16) constant('000B'x); /* Siga-s failed, doqdio   */ 00473000
*DCL RSN000C fixed(16) constant('000C'x); /* Siga-w failed, doqdio   */ 00474000
*DCL RSN000D fixed(16) constant('000D'x); /* Xconfig with qtcb error */ 00475000
*DCL RSN000E fixed(16) constant('000E'x); /* Openport with qtcb error*/ 00476000
*DCL RSN000F fixed(16) constant('000F'x); /* Openlun with qtcb error */ 00477000
*DCL RSN0010 fixed(16) constant('0010'x); /* Sendgeneric with qtcb er*/ 00478000
*DCL RSN0011 fixed(16) constant('0011'x); /* Close prot with qtcb err*/ 00479000
*DCL RSN0012 fixed(16) constant('0012'x); /* Close lun with qtcb err */ 00480000
*DCL RSN0013 fixed(16) constant('0013'x); /* Close phys. port qtcb er*/ 00481000
*DCL RSN0014 fixed(16) constant('0014'x); /* Send els with prot. err */ 00482000
*DCL RSN0015 fixed(16) constant('0015'x); /* Reserved                */ 00483000
*DCL RSN0016 fixed(16) constant('0016'x); /* Reserved                */ 00484000
*DCL RSN0017 fixed(16) constant('0017'x); /* Adapter stat. aft. NSERV*/ 00485000
*DCL RSN0018 fixed(16) constant('0018'x); /* Adapter stat. aft. OPORT*/ 00486000
*DCL RSN0019 fixed(16) constant('0019'x); /* Reserved                */ 00487000
*DCL RSN001A fixed(16) constant('001A'x); /* Timeout after closeport */ 00488000
*DCL RSN001B fixed(16) constant('001B'x); /* Timeout after closelun  */ 00489000
*DCL RSN001C fixed(16) constant('001C'x); /* Timeout after cl.phy.por*/ 00490000
*DCL RSN001D fixed(16) constant('001D'x); /* Adap. stat. after sendel*/ 00491000
*DCL RSN001E fixed(16) constant('001E'x); /* Reserved                */ 00492000
*DCL RSN001F fixed(16) constant('001F'x); /* VSE timer expired       */ 00493000
*DCL RSN0020 fixed(16) constant('0020'x); /* FCP error ecb posted    */ 00494000
*DCL RSN0021 fixed(16) constant('0021'x); /* Reserved                */ 00495000
*DCL RSN0022 fixed(16) constant('0022'x); /* FSF error aft. send gen.*/ 00496000
*DCL RSN0023 fixed(16) constant('0023'x); /* Nameserver request fail */ 00497000
*DCL RSN0024 fixed(16) constant('0024'x); /* FSF error dur. openport */ 00498000
*DCL RSN0025 fixed(16) constant('0025'x); /* Max no of ports exceeded*/ 00499000
*DCL RSN0026 fixed(16) constant('0026'x); /* FSF status - close port */ 00500000
*DCL RSN0027 fixed(16) constant('0027'x); /* FSF status - send els   */ 00501000
*DCL RSN0028 fixed(16) constant('0028'x); /* Invalid network topol.  */ 00502000
*DCL RSN0029 fixed(16) constant('0029'x); /* prothost when xconfig   */ 00503000
*DCL RSN002A fixed(16) constant('002A'x); /* Lun alr.open,acc. denied*/ 00504000
*DCL RSN002B fixed(16) constant('002B'x); /* max number of luns exc  */ 00505000
*DCL RSN002C fixed(16) constant('002C'x); /* Lun already open        */ 00506000
*DCL RSN002D fixed(16) constant('002D'x); /* FSF failure openlun     */ 00507000
*DCL RSN002E fixed(16) constant('002E'x); /* FSF status - close lun  */ 00508000
*DCL RSN002F fixed(16) constant('002F'x); /* LUN alr. opened on chpid*/ 00509000
*DCL RSN0030 fixed(16) constant('0030'x); /* All outbound buf.used . */ 00510000
*/* Close adapter failure                                            */ 00511000
*DCL RSN0031 fixed(16) constant('0031'x); /* FCP not initialized     */ 00512000
*DCL RSN0032 fixed(16) constant('0032'x); /* Freevis failure         */ 00513000
*/* Send els failure                                                 */ 00514000
*DCL RSN0040 fixed(16) constant('0040'x); /* Send els failure        */ 00515000
*/* Xconfig failure                                                  */ 00515200
*DCL RSN0045 fixed(16) constant('0045'x); /* STCK failed             */ 00515400
*DCL RSN0046 fixed(16) constant('0046'x); /* NPIV failure    @D28ODMZ*/ 00515600
*/* Invalid LUN number                                               */ 00516000
*DCL RSN0050 fixed(16) constant('0050'x); /* LUN fields not zero     */ 00517000
*DCL RSN0051 fixed(16) constant('0051'x); /* LUN fields not zero     */ 00518000
*DCL RSN0052 fixed(16) constant('0052'x); /* Unsupp. addr. method    */ 00519000
*DCL RSN0055 fixed(16) constant('0055'x); /* Lock file device        */ 00520000
*DCL RSN0056 fixed(16) constant('0056'x); /* Open lun access denied  */ 00521000
*DCL RSN0057 fixed(16) constant('0057'x); /* Open port access denied */ 00522000
*DCL RSN0060 fixed(16) constant('0060'x); /* Device not operational  */ 00523000
*DCL RSN0061 fixed(16) constant('0061'x); /* Device not a FCP device */ 00524000
*DCL RSN0065 fixed(16) constant('0065'x); /* CHCS with CC            */ 00525000
*DCL RSN0066 fixed(16) constant('0066'x); /* CHCS not successful     */ 00526000
*DCL RSN0070 fixed(16) constant('0070'x); /* Max. no of FCPs defined */ 00527000
*DCL RSN0071 fixed(16) constant('0071'x); /* Xconfig data incomplete */ 00528000
*DCL RSN0072 fixed(16) constant('0072'x); /* Xconfig unexpec. fsfstat*/ 00529000
*DCL RSN0073 fixed(16) constant('0073'x); /* Siga-s cc=3             */ 00530000
*DCL RSN0074 fixed(16) constant('0074'x); /* Siga-w cc=3             */ 00531000
*/* Reason code set fcpgnext routine                                 */ 00532000
*DCL RSN0080 fixed(16) constant('0080'x); /* Siga-s CC               */ 00533000
*DCL RSN0081 fixed(16) constant('0081'x); /* SIGA-s CC               */ 00534000
*DCL RSN0082 fixed(16) constant('0082'x); /* SLSB halted             */ 00535000
*DCL RSN0083 fixed(16) constant('0083'x); /* SLSB in error           */ 00536000
*DCL RSN0084 fixed(16) constant('0084'x); /* Unexpected SLSB         */ 00537000
*DCL RSN0085 fixed(16) constant('0085'x); /* SIGA-s CC in return_buf */ 00538000
*DCL RSN0086 fixed(16) constant('0086'x); /* SIGA-r without CC=1     */ 00539000
*/* Reason code set by doioipl routine                               */ 00540000
*DCL RSN0090 fixed(16) constant('0090'x); /* CC after CSCH           */ 00541000
*DCL RSN0091 fixed(16) constant('0091'x); /* CC after TSCH (CSCH)    */ 00542000
*DCL RSN0092 fixed(16) constant('0092'x); /* Inv. device/subch. stat.*/ 00543000
*DCL RSN0093 fixed(16) constant('0093'x); /* CC after SSCH           */ 00544000
*DCL RSN0094 fixed(16) constant('0094'x); /* CC after TSCH           */ 00545000
*DCL RSN0095 fixed(16) constant('0095'x); /* Inv. device/subch. stat.*/ 00546000
*DCL RSN0096 fixed(16) constant('0096'x); /* TSCH with CC doqdio app */ 00547000
*DCL RSN0097 fixed(16) constant('0097'x); /* Not a PCI interrupt     */ 00548000
*DCL RSN0098 fixed(16) constant('0098'x); /* Fcpgnext with inv.output*/ 00549000
*DCL RSN0099 fixed(16) constant('0099'x); /* FSF_FCP_RSP_AVAILABLE   */ 00550000
*DCL RSN009A fixed(16) constant('009A'x); /* Unexpected FSF status   */ 00551000
*DCL RSN009B fixed(16) constant('009B'x); /* Unexpected protocol sta.*/ 00552000
*DCL RSN009C fixed(16) constant('009C'x); /* SSCH with CC            */ 00553000
*DCL RSN009D fixed(16) constant('009D'x); /* TSCH with CC            */ 00554000
*DCL RSN009E fixed(16) constant('009E'x); /* Unit check with sns     */ 00555000
*/* Reason code set by I/O interrupt appendage                       */ 00556000
*DCL RSN0100 fixed(16) constant('0100'x); /* protocol error          */ 00557000
*DCL RSN0101 fixed(16) constant('0101'x); /* link is down            */ 00558000
*DCL RSN0102 fixed(16) constant('0102'x); /*PROT_FSF_STATUS_PRESENTED*/ 00559000
*DCL RSN0103 fixed(16) constant('0103'x); /* FSF_port_boxed             00560000
                                            (port recovery scheduled)*/ 00561000
*DCL RSN0104 fixed(16) constant('0104'x); /* SIGA failed             */ 00562000
*DCL RSN0105 fixed(16) constant('0105'x); /* Access rights violation */ 00563000
*DCL RSN0106 fixed(16) constant('0106'x); /* unsolicited interrupt      00564000
                                           port closed               */ 00565000
*DCL RSN0107 fixed(16) constant('0107'x); /* unsolicited interrupt      00566000
                                           bit error threshold       */ 00567000
*DCL RSN0108 fixed(16) constant('0108'x); /* unsolicited interrupt      00568000
                                           link down                 */ 00569000
*DCL RSN0109 fixed(16) constant('0109'x); /* unsolicited interrupt      00570000
                                           link up                   */ 00571000
*DCL RSN010A fixed(16) constant('010A'x); /* unsolicited interrupt      00572000
                                           incomming ELS             */ 00573000
*DCL RSN010B fixed(16) constant('010B'x); /* I/O error (unit check)     00574000
                                           on FCP device             */ 00575000
*DCL RSN010C fixed(16) constant('010C'x); /* I/O error (other then      00576000
                                           unit check) on FCP device */ 00577000
*DCL RSN010D fixed(16) constant('010D'x); /* adapter is offline,        00578000
                                           restart only possible        00579000
                                           with ONLINE command       */ 00580000
*DCL RSN010E fixed(16) constant('010E'x); /* timeout after establish */ 00581000
*DCL RSN010F fixed(16) constant('010F'x); /* temporary resource problem 00582000
                                           use ONLINE cmd to restart */ 00583000
*DCL RSN0110 fixed(16) constant('0110'x); /* machine check presented    00584000
                                           or 'ready interrupt' due     00585000
                                           to ONLINE command         */ 00586000
*DCL RSN0111 fixed(16) constant('0111'x); /* presented fsf-staus not    00587000
                       expected (not defined at implementation)      */ 00588000
*DCL RSN0112 fixed(16) constant('0112'x); /* presented unsoliceted      00589000
                       status not          status not expected (not     00590000
                                           defined at implementation)*/ 00591000
*DCL RSN0113 fixed(16) constant('0113'x); /* presented ELS type         00592000
                                             not handled             */ 00593000
*DCL RSN0114 fixed(16) constant('0114'x); /* LUN boxed, lun recovery */ 00594000
*/* Reason code set by fcpdel routine                                */ 00595000
*DCL RSN0130 fixed(16) constant('0130'x); /* Invalid input by sysdef */ 00596000
*DCL RSN0131 fixed(16) constant('0131'x); /* Invalid input by sysdef */ 00597000
*/********************************************************************/ 00598000
*/* General used constants                                           */ 00599000
*/********************************************************************/ 00600000
 DCL                                                                    00601000
    PAGE_SIZE fixed(16) constant(4096);                                 00602000
 DCL                                                                    00603000
     ON       BIT(1) CONSTANT('1'B),                                    00604000
     OFF      BIT(1) CONSTANT('0'B);                                    00605000
 /********************************************************************/ 00606000
 /* FCP specific constants                                           */ 00607000
 /********************************************************************/ 00608000
 DCL DIDNAMES fixed(32) constant('00FFFFFC'x); /* d_id nameserver    */ 00609000
 DCL FCP_SERVCLASS_DEF bit(32) constant('00000003'x);/* serv class 3 */ 00610000
 /* We use service class 3. Service class defines the way acknow. is */ 00611000
 /* done. The method of service class 2 is not supported by all dev. */ 00612000
 DCL FCP_CT_REVISION fixed(8) constant('01'x);/* Prior fc-gs-3       */ 00613000
 DCL FCP_CT_DIRECTORY_SERVICE fixed(8) constant('FC'x);                 00614000
 DCL FCP_CT_NAME_SERVER fixed(8) constant('02'x);                       00615000
 DCL FCP_CT_SYNCHRONOUS fixed(8) constant('00'x);                       00616000
 DCL FCP_CT_GID_PN fixed(16) constant('0121'x);                         00617000
 /* The adapter allows 3FC words (4K -16 / 4).The send genric payload*/ 00618000
 /* for nameserver questioning is 2 words (without 16bytes preamble  */ 00619000
 DCL FCP_CT_MAX_SIZE fixed(16) constant('0002'x);                       00620000
 DCL FCP_CT_ACCEPT fixed(16) constant('8002'x);                         00621000
 DCL FCP_NAMES_TIMOUT fixed(8) constant('05'x); /* what is meaningful*/ 00622000
 /* When the Send_els does not complete, the hardware retries        */ 00623000
 /* the command internally. The timer is copied.                     */ 00624000
 DCL FCP_ADISC_TIMOUT fixed(8) constant('05'x); /* what is meaningful*/ 00625000
 DCL NOSTAT_READ fixed(8) constant('08'x);   /* No of status read    */ 00626000
 DCL MRECCNT fixed(8) constant('05'x); /* Max. recovery count        */ 00627000
 DCL SWNET_SHRA fixed(32) constant('00000002'X);                        00628000
 /* VSE constraints                                                  */ 00629000
 /* 8 Channel queue entries are reserved for fcp                     */ 00630000
 /* When more entries are used, a deadlock in IPL occurs, since      */ 00631000
 /* not enough pre-allocated channel queue entries are available     */ 00632000
 /* This count is also used in IUI during DEF SCSI processing, to    */ 00633000
 /* prevent that more than 10 different fcp adapters are used.       */ 00634000
 DCL MAX_FCPDEV fixed(8) constant('0A'x);/* Number of allowed fcps   */ 00635000
 /********************************************************************/ 00636000
 /*  Based  Variables                                                */ 00637000
 /********************************************************************/ 00638000
 /********************************************************************/ 00639000
 /*                                                                  */ 00640000
 /* Define card control block                                        */ 00641000
 /*                                                                  */ 00642000
 /********************************************************************/ 00643000
*%OSALVL = '1';          /* GET OSADCLC INLINE CODE                  */ 00644000
*%INCLUDE SYSLIB(OSADCLC);                                              00645000
    3 fcp_pubx           ptr(31), /* pubx pointer                    */ 00646000
    3 fcp_pubidx       fixed(16), /* pub index                       */ 00647000
    3 fcp_devtcode     fixed(8),  /* vse device type code            */ 00648000
    3 fcp_devtqual     fixed(8),  /* device type qualifier           */ 00649000
    3 fcp_devtype      fixed(16), /* device type number              */ 00650000
    3 fcp_cutype       fixed(16), /* cu unit type number             */ 00651000
    3 fcp_devmodel     fixed(8),  /* device type model number        */ 00652000
    3 fcp_cumodel      fixed(8),  /* cu unit type model number       */ 00653000
    3 fcp_feat         bit(8),    /* features taken from store qdio  */ 00654000
     4 fcp_pci  bit(1),           /* pci generated                   */ 00655000
     4 fcp_sigr bit(1),           /* siga read needed                */ 00656000
     4 fcp_sigw bit(1),           /* siga write needed               */ 00657000
     4 fcp_sigs bit(1),           /* siga sync under vm needed       */ 00658000
     4 *        bit(4),           /* reserved                        */ 00659000
    3 fcp_flg1         bit(8),    /* add. device features            */ 00660000
     4 fcp_aintf       bit(1),    /* adapter interrupt facility      */ 00661000
     4 fcp_scsc        bit(1),    /* set csc command supported       */ 00662000
     4 fcp_scscf       bit(1),    /* set csc fast command supported  */ 00663000
     4 *               bit(5),    /* reserved                        */ 00664000
    3 fcp_lpm          bit(8),    /* LPM needed for IPL from scsi    */ 00665000
    3 *                char(1),   /* reserved                        */ 00666000
    3 fcp_chpid        char(1),   /* chpid of device                 */ 00667000
    3 fcp_status       bit(8),    /* status byte                     */ 00668000
     4 fcp_clsub_done  bit(1),    /* Reserved                        */ 00669000
     4 fcp_ipl_stg1    bit(1),    /* IPL stage 1                     */ 00670000
     4 fcp_ipl_stg2    bit(1),    /* IPL stage 2                     */ 00671000
     4 fcp_freecb      bit(1),    /* Free copy blocks during fcpterm */ 00672000
     4 fcp_vmsys       bit(1),    /* VMSYS not reliable in ipl stg1  */ 00673000
     4 fcp_ipl_dev3    bit(1),    /* IPL stage 2, end of 3 dev.system*/ 00674000
     4 fcp_nmsg        bit(1),    /* WTOR not yet usable             */ 00675000
     4 fcp_tdmp        bit(1),    /* Tape SA dump                    */ 00676000
    3 fcp_status1      bit(8),    /* status byte                     */ 00677000
     4 fcp_remapp      bit(1),    /* Remove appendage                */ 00678000
     4 fcp_qdioa       bit(1),    /* fcp qdio activated (est/act)    */ 00679000
     4 *               bit(1),    /* Reserved for future use         */ 00680000
     4 *               bit(1),    /* Reserved for future use         */ 00681000
     4 fcp_created     bit(1),    /* fcp created with this request   */ 00682000
     4 fcp_open        bit(1),    /* summary bit, fcp adapter open   */ 00683000
     4 fcp_clinp       bit(1),    /* close adapter in progress       */ 00684000
     4 fcp_dsfcp       bit(1),    /* default sfcp area (538 entries) */ 00685000
    3 *               char(3),    /* reserved for future use         */ 00686000
    /*****************************************************************/ 00687000
    /* FCP Configuration data                                        */ 00688000
    /*****************************************************************/ 00689000
    3 fcp_lic_version  bin(32),   /* Lic version                     */ 00690000
    3 fcp_fc_topology  bin(32),   /* Fibre channel network topology  */ 00691000
    3 fcp_adapter_typ  bin(32),   /* Adapter type                    */ 00692000
    3 fcp_fc_portid    bin(32),   /* Local fibre channel port id     */ 00693000
    3 fcp_portname     char(8),   /* Portname assoc. with chpid      */ 00694000
    3 fcp_nodename     char(8),   /* Nodename                        */ 00695000
    3 fcpmaxda         fixed(32), /* Max. data transfer size,           00696000
                                     returned by xconfig             */ 00697000
    3 fcpnsbal         fixed(16), /* calculated by ijbfcp            */ 00698000
    3 *                fixed(16), /* reserved                        */ 00699000
    3 fcpsfcpl         ptr(31),   /* Addr of sendfcp parameterlist   */ 00700000
    /*****************************************************************/ 00701000
    /* FCP specific data                                             */ 00702000
    /*****************************************************************/ 00703000
    3 fcp_portc        ptr(31),   /* chain of ports attached to FCP  */ 00704000
    3 fcp_genoutbuf ptr(31) union,/* general output buffer           */ 00705000
     4 fcp_nsoutbuf     ptr(31),  /* outbuf buffer for nameserver rq.*/ 00706000
     4 fcp_elsoutbuf    ptr(31),  /* outbuf buffer for els command   */ 00707000
    3 fcp_geninbuf  ptr(31) union,/* general input buffer            */ 00708000
     4 fcp_nsinbuf      ptr(31),  /* input buffer for nameserver rq. */ 00709000
     4 fcp_elsinbuf     ptr(31),  /* input buffer for els command    */ 00710000
    3 fcp_portns       ptr(31),   /* ptr to port of nameserver       */ 00711000
    /*****************************************************************/ 00712000
    /* FCP recovery specific data                                    */ 00713000
    /*****************************************************************/ 00714000
    3 fcp_fsfchain     ptr(31),   /* chain of ongoing fsf requests   */ 00715000
    3 fcp_astread      ptr(31),   /* addr of status read buffers     */ 00716000
    3 fcp_afsfstr      ptr(31),   /* addr of status read fsfreq cbs  */ 00717000
    3 fcp_aqdio        fixed(32), /* addr of QDIO control blocks     */ 00718000
    3 fcp_lqdio        fixed(32), /* length of QDIO control blocks   */ 00719000
    3 fcp_hostcfeat    fixed(32), /* Host connection feature @D28ODMZ*/ 00720490
    3 fcp_errecb       fixed(32), /* ecb posted by QDIO appendage to    00721000
                                     terminate ongoing FCP request      00722000
                                     initiated by system task (init or  00723000
                                     recovery function)              */ 00724000
     4 *               char(2),   /*                                 */ 00725000
     4 fcp_trabit      bit(1),    /* traffic bit                     */ 00726000
     4 *               bit(7),    /*                                 */ 00727000
     4 *               char(1),   /*                                 */ 00728000
    3 fcp_recflg       bit(8),                                          00729000
     4 *               bit(1),    /*                                 */ 00730000
     4 fcp_receq       bit(1),    /* adapter rec. request enqueued   */ 00731000
     4 fcp_recac       bit(1),    /* adapter rec. request active     */ 00732000
     4 fcp_pioerr      bit(1),    /* adapter not usable, rec. failed */ 00733000
     4 fcp_recout      bit(1),    /* adapter recovery not scheduled     00734000
                                     but required                    */ 00735000
     4 fcp_termonly    bit(1),    /* ... perform termination only    */ 00736000
     4 *               bit(1),    /*                                 */ 00737000
     4 fcp_ldmsg       bit(1),    /* link down message written       */ 00738000
    3 fcp_mreccnt      fixed(8),  /* max. count for adapter recovery */ 00739000
    3 fcp_areccnt      fixed(8),  /* act. adapter recovery count,       00740000
                                     reset after succesfull recovery */ 00741000
    3 *                char(1),   /* reserved for future use         */ 00742000
    /*****************************************************************/ 00743000
    /* inbound buffer management                                     */ 00744000
    /*****************************************************************/ 00745000
    3 inbound_processed_count fixed(8),                                 00746000
    3 inbound_next_buffer_to_process fixed(8),                          00747000
    3 inbound_last_queued_buffer fixed(8),/*last buffer given to        00748000
                                            the card                 */ 00749000
    3 inbound_next_buffer_init fixed(8),/*needed for ongoing queueing*/ 00750000
    3 element fixed(8), /* number of sbale to be processed next      */ 00751000
    3 *                        char(3), /* reserved for future use   */ 00752000
    3 inbound_slsbptr          ptr(31),                                 00753000
    3 inbound_sbal(QDIO_MAX_BUFFERS_PER_Q) ptr(31),/* each ptr          00754000
                                          points to a sbal           */ 00755000
    /*****************************************************************/ 00756000
    /* outbound buffer management                                    */ 00757000
    /*****************************************************************/ 00758000
    3 outbound_used_buffers fixed(8),                                   00759000
    3 outbound_first_free_buffer fixed(8),                              00760000
    3 outbound_last_processed fixed(8),                                 00761000
    3 *          fixed(8),                                              00762000
    3 outbound_slsbptr  ptr(31),                                        00763000
    3 outbound_sbal(QDIO_MAX_BUFFERS_PER_Q) ptr(31),                    00764000
    /*****************************************************************/ 00765000
    /* adapter specfic data                                          */ 00766000
    /*****************************************************************/ 00767000
    3 fcp_qfmt bin(8),          /* adapter type set in qib , qdr     */ 00768000
    3 fcp_pfmt bin(8),          /* set in qib, always zero           */ 00769000
    3 fcp_qest,                                                         00770000
     4 fcp_qest_code fixed(8),  /* qdio establish command code       */ 00771000
     4 fcp_qest_lng  char(2),   /* qdio establish input length       */ 00772000
    3 fcp_qact,                                                         00773000
     4 fcp_qact_code fixed(8),  /* qdio activate  command code       */ 00774000
     4 fcp_qact_lng  char(2),   /* qdio activate  input length       */ 00775000
    /*****************************************************************/ 00776000
    /* Request sequence number. Must be incremented for each         */ 00777000
    /* successfully initiated (SIGA) request. Set in QTCB.           */ 00778000
    /* Not set/incremented for status read.                          */ 00779000
    /*****************************************************************/ 00780000
    3 fcp_reqseqno   fixed(31), /* request sequence number in QTCB   */ 00781000
    3 msg_info,                 /* error info if msg_pending=on      */ 00782000
     4 msg_ccsw,                                                        00783000
       5 msg_ccode char(1),     /* failing command code              */ 00784000
       5 msg_csw ,              /* csw at uc time                    */ 00785000
         6 *         char(1),                                           00786000
         6 msg_ccwaddr char(3),                                         00787000
         6 msg_ustatus ,                                                00788000
           7 *         bit(6),                                          00789000
           7 msg_uc    bit(1),                                          00790000
           7 *         bit(1),                                          00791000
         6 msg_cstatus char(1),                                         00792000
         6 *         char(2),                                           00793000
     4 *          char(3),      /* not used                          */ 00794000
    3 fcp_devno fixed(15),      /* cuu of device                     */ 00795000
    3 *         fixed(15),      /* reserved for future use           */ 00796000
    3 fcp_sigai fixed(31),      /* input for siga                    */ 00797000
     4 fcp_subcc fixed(15),     /* set to 0001                       */ 00798000
     4 fcp_subch fixed(15),     /* subchannel of device              */ 00799000
      5 fcp_subch1 char(2),     /* needed for comparison with ffff   */ 00800000
    3 real_ccb ptr(31),         /* addr of copy block                */ 00801000
    3 *        ptr(31),         /* reserved for future use           */ 00802000
    3 ccw1 char(8) bdy(dword),  /* format 1 ccw                      */ 00803000
     4 ccwcode char(1),                                                 00804000
     4 ccwflag char(1),                                                 00805000
     4 ccwlng  char(2),                                                 00806000
     4 ccwbuf  ptr(31),                                                 00807000
    3 ccb  char(16),            /* ccb                               */ 00808000
    3 sensearea char(32),       /* sense area                        */ 00809000
    3 unit_addr2 fixed(8),      /* relative no of device             */ 00810000
    3 *          fixed(8),      /* reserved for future use           */ 00811000
    3 devno_flag,               /* flag byte                         */ 00812000
     4 app_defined       bit(1),                                        00813000
     4 *                 bit(7),                                        00814000
    3 cunit_cula fixed(8),      /* cula nedded for fcp       ????????*/ 00815000
    3 qdrptr ptr(31),           /* ptr to qdr                        */ 00816000
    3 qibptr ptr(31),           /* ptr to qib                        */ 00817000
    3 amsgarea ptr(31),         /* ptr to message area               */ 00818000
    3 fcp_srfsfchain ptr(31),   /* chain of status read fsf requests */ 00819000
    3 *              ptr(31),   /* align fcp_erp on 16 bytes bdy     */ 00820000
    3 fcp_erp char(length(ferpreq)),/*erp control block              */ 00821000
  2  fcpcardr char(4096-length(fcpcard1));                              00822000
                                                                        00823000
 /*  For each Open Port, one scsiport control block is allocated     */ 00824000
 DCL 1 fcpport based bdy(word),                                         00825000
  2 porteyec      char(4), /* eye catcher                            */ 00826000
  2 portnext      ptr(31), /* next scsiport cb                       */ 00827000
  2 portprev      ptr(31), /* previous scsiport cb                   */ 00828000
  2 portfcpp      ptr(31), /* fcp cb where port is attached to       */ 00829000
  2 portwwpn      char(8), /* 64 bit own wwpn                        */ 00830000
  2 portd_id       bit(32),/* last 3 bytes contain d_id of port      */ 00831000
   3 *             bit(8), /* first byte not part of did             */ 00832000
   3 *      bit(24) union, /* last 3 bytes contain d_id of port      */ 00833000
    4 portd_id3    bit(24),/* domain area port supplied              */ 00834000
    4 *            bit(24),/*                                        */ 00835000
     5 portd_id2   bit(16),/* domain and area supplied               */ 00836000
     5 *           bit(8), /* port not supplied                      */ 00837000
    4 *            bit(24),/*                                        */ 00838000
     5 portd_id1   bit(8), /* domain supplied                        */ 00839000
     5 *           bit(16),/* area and port not supplied             */ 00840000
  2 porthandle    bit(32), /* port handle returned by open port      */ 00841000
  2 portlunc      ptr(31), /* ptr to LUN chain defined for this port */ 00842000
  2 portflag      bit(8),  /*                                        */ 00843000
   3 portopen     bit(1),  /* portopen=1: port is open               */ 00844000
                           /* portopen=0: port is closed             */ 00845000
   3 portcreat    bit(1),  /* port cb created by this request, reset    00846000
                              after successful def scsi              */ 00847000
   3 portclpp     bit(1),  /* close physical port requested, reset      00848000
                              after completion                       */ 00849000
   3 *            bit(5),  /*                                        */ 00850000
  2 port_recflg   bit(8),  /* port recovery flag                     */ 00851000
   3 portnoper    bit(1),  /* port recovery request enqueued         */ 00852000
   3 portreceq    bit(1),  /* port recovery request enqueued         */ 00853000
   3 portrecac    bit(1),  /* port recovery request active           */ 00854000
   3 portioerr    bit(1),  /* port not usable, recovery failed       */ 00855000
   3 portrecout   bit(1),  /* port recovery not scheduled but req'd  */ 00856000
   3 *            bit(3),  /*                                        */ 00857000
  2 port_mreccnt  fixed(8),/* max. count for port recovery           */ 00858000
  2 port_areccnt  fixed(8),/* act. port recovery count               */ 00859000
  2 *            char(8),  /* align in multiples of 16               */ 00860000
  2 port_erp     char(length(ferpreq));                                 00861000
                                                                        00862000
 /*  For each Open LUN, one scsilun control block is allocated       */ 00863000
 DCL 1 fcplun  based bdy(word),                                         00864000
  2 luneyec       char(4), /* eye catcher                            */ 00865000
  2 lunnext       ptr(31), /* ptr to next lun cb                     */ 00866000
  2 lunprev       ptr(31), /* ptr to previous lun cb                 */ 00867000
  2 lunport       ptr(31), /* port to which lun is attached          */ 00868000
  2 lunid         char(8), /* 8-bytes lun                            */ 00869000
  2 lunhandle     bit(32), /* lun handle as returned by open lun     */ 00870000
  2 lunflag       bit(8),  /*                                        */ 00871000
   3 lunopen       bit(1), /* lunopen=1: lun is opened               */ 00872000
                           /* lunopen=0: lun is closed               */ 00873000
   3 luncreat      bit(1), /* lun created by this request, reset        00874000
                              after successful def scsi              */ 00875000
   3 *             bit(6), /*                                        */ 00876000
  2 lun_recflg     bit(8), /* LUN recovery flag                      */ 00877000
   3 lunnoper      bit(1), /* LUN not operational                    */ 00878000
   3 lunreceq      bit(1), /* lun recovery request enqueued          */ 00879000
   3 lunrecac      bit(1), /* lun recovery request active            */ 00880000
   3 lunioerr      bit(1), /* lun not usable, recovery failed        */ 00881000
   3 lunrecout     bit(1), /* lun recovery not scheduled but req'd   */ 00882000
   3 lunwattn      bit(1), /* lun waiting for AVR processing         */ 00883290
   3 *             bit(2), /* reserved                               */ 00883580
  2 lunfba       fixed(16),/* fba cuu                                */ 00884000
  2 lunqtcb        ptr(31),/* sendfcp qtcb associated with lun       */ 00885000
  2 lunqtcba       ptr(31),/* abort qtcb associated with lun         */ 00886000
  2 lunpubx        ptr(31),/* corresponding pubx                     */ 00887000
  2 lun_mreccnt   fixed(8),/* max. count for lun  recovery           */ 00888000
  2 lun_areccnt   fixed(8),/* act. lun  recovery count               */ 00889000
  2 *              char(2),/* align erp on 16 bytes bdy              */ 00890000
  2 lun_erp      char(length(ferpreq));                                 00891000
 DCL 1 gen_payload based bdy(word) union,/* general payload, max 4K  */ 00892000
 /* Allocation assumes,that two payloads fit in one page, see ijbfcp */ 00893000
  2 fcct_iu bdy(word),      /* payload passed to nameserver          */ 00894000
 /* Two fcct_iu araes are a multiple of 16.                          */ 00895000
   3 revision     fixed(8), /* x'01' prior version of fc-gs-3        */ 00896000
   3 IN_ID        fixed(24),/* zero on input                         */ 00897000
   3 GS_Type      fixed(8), /* type of service, x'FC' directory serv.*/ 00898000
   3 GS_Subtype   fixed(8), /* x'02' name server                     */ 00899000
   3 Options      fixed(8), /* x'00' synchronous/single exchange     */ 00900000
   3 *            fixed(8), /* reserved                              */ 00901000
   3 cmd_rsp_code fixed(16),/* x'0121' (GID_PN) get port identifier  */ 00902000
   3 max_res_size fixed(16),/* (4096-16)/4 (no of response words)    */ 00903000
   3 *            fixed(8), /* reserved                              */ 00904000
   3 reason_code  fixed(8), /*                                       */ 00905000
   3 reason_code_expl fixed(8),/*                                    */ 00906000
   3 vendor_unique fixed(8), /*                                      */ 00907000
   3 wwpn_data char(8) bdy(word), /* wwpn for which we need the d_id */ 00908000
    4 d_id_data   fixed(32),/* d_id                                  */ 00909000
    4 *           char(4),  /*                                       */ 00910000
  2 els_payload bdy(word),                                              00911000
   3 adisc_payload bdy(word),                                           00912000
    4 adisc_cmd    bit(8), /* command code 52                        */ 00913000
     5 adisc_rep   bit(8), /* 02 in reply payload                    */ 00914000
    4 *            char(3),/* must be zero                           */ 00915000
    4 adisc_did    bin(32),/* did of originator/responder            */ 00916000
    4 adisc_portn  char(8),/* n_port_name of originator/responder    */ 00917000
    4 adisc_noden  char(8),/* node_name of originator/responder      */ 00918000
    4 adisc_did1   bin(32);/* did of originator/responder            */ 00919000
 DCL 1 ferpreq  based,     /* recovery request control block         */ 00920000
  2  ferp_action bit(8),   /* recovery action to be taken            */ 00921000
    3 ferp_roadapt bit(1), /* reopen adapter                         */ 00922000
    3 ferp_rophysp bit(1), /* reopen port (close physical)           */ 00923000
    3 ferp_roport  bit(1), /* reopen port                            */ 00924000
    3 ferp_rolun   bit(1), /* reopen unit                            */ 00925000
    3 *            bit(3), /* reserved                               */ 00926000
    3 ferp_termonly bit(1),/* reserved                               */ 00927000
  2  *           bit(8),   /* reserved                               */ 00928000
  2  ferp_status1 bit(8),  /* status byte                            */ 00929000
   3 *            bit(8),  /* reserved for future use                */ 00930000
  2  ferp_status2 bit(8),  /* status byte                            */ 00931000
  2  ferp_fcp    ptr(31),  /* pointer to fcp_card                    */ 00932000
  2  ferp_port   ptr(31),  /* pointer to port cb (holds port to be      00933000
                              opened during init                     */ 00934000
  2  ferp_lun    ptr(31),  /* pointer to lun cb (holds lun to be        00935000
                              opened during init                     */ 00936000
  2  ferp_fsfreq ptr(31),  /* fsfreq ongoing for this action         */ 00937000
  2  *          char(12);  /* allocate in multiples of 16            */ 00938000
 Dcl 1 COPY_BLOCK BASED BDY(WORD),                                      00939000
    2 Copy_block1,                                                      00940000
      3 CB_CCB,                                                         00941000
       4 *         CHAR(8),                                             00942000
       4 CB_CCWPTR PTR(31),                                             00943000
       4 *         CHAR(4),                                             00944000
      3 CB_SENSE_CCW,                                                   00945000
       4 CB_SNS_CCWCOD1  CHAR(1),                                       00946000
       4 CB_SNS_CCWFLAG1 CHAR(1),                                       00947000
       4 CB_SNS_CCWLNG1  CHAR(2),                                       00948000
       4 CB_SNS_CCWBUF1  PTR(31),                                       00949000
      3 CB_CCW,                                                         00950000
       4 CB_CCWCOD1  CHAR(1),                                           00951000
       4 CB_CCWFLAG1 CHAR(1),                                           00952000
       4 CB_CCWLNG1  CHAR(2),                                           00953000
       4 CB_CCWBUF1  PTR(31),                                           00954000
      3 *             CHAR(27),                                         00955000
      3 CB_FLAG      BIT(8),                                            00956000
    2   CB_CARDPTR    PTR(31),                                          00957000
    2   CB_PUBPTR     PTR(31),                                          00958000
    2   CB_CHAINPTR   PTR(31);                                          00959000
